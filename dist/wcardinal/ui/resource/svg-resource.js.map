{"version":3,"file":"svg-resource.js","sourceRoot":"","sources":["../../../../src/main/typescript/wcardinal/ui/resource/svg-resource.ts"],"names":[],"mappings":"AAAA;;;GAGG;;AAEH,OAAO,EAAE,SAAS,EAAE,MAAM,SAAS,CAAC;AAEpC;IAAiC,+BAA2B;IAM3D,qBAAa,MAAc,EAAE,OAAY;QAAzC,YACC,kBAAO,IAAI,KAAK,EAAE,CAAE,SAUpB;QAbS,WAAK,GAAyB,IAAI,CAAC;QAI5C,KAAI,CAAC,MAAM,GAAG,CAAC,CAAC;QAChB,KAAI,CAAC,OAAO,GAAG,CAAC,CAAC;QACjB,KAAI,CAAC,GAAG,GAAG,MAAM,CAAC;QAElB,SAAS,CAAC,iBAAiB,CAAC,WAAW,CAAE,KAAI,CAAC,MAAM,EAAE,KAAI,CAAC,GAAG,EAAE,OAAO,IAAI,OAAO,CAAC,WAAW,CAAE,CAAC;QAEjG,IAAI,CAAE,OAAO,IAAI,OAAO,CAAC,QAAQ,KAAK,KAAK,EAAG;YAC7C,KAAI,CAAC,IAAI,EAAE,CAAC;SACZ;;IACF,CAAC;IAED,0BAAI,GAAJ;QAAA,iBAkCC;QAjCA,IAAI,IAAI,CAAC,KAAK,EAAG;YAChB,OAAO,IAAI,CAAC,KAAK,CAAC;SAClB;QAED,IAAI,CAAC,KAAK,GAAG,IAAI,OAAO,CAAC,UAAE,OAAO;YACjC,IAAM,KAAK,GAAqB,KAAI,CAAC,MAAM,CAAC;YAE5C,KAAK,CAAC,OAAO,GAAG,UAAE,KAAK;gBACtB,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC;gBACpB,KAAY,CAAC,OAAO,CAAC,GAAG,CAAE,KAAK,CAAE,CAAC,CAAC,mBAAmB;YACxD,CAAC,CAAC;YAEF,IAAM,EAAE,GAAG,SAAS,CAAC,SAAS,CAAC;YAE/B,yDAAyD;YACzD,IAAI,CAAC,IAAI,EAAE,CAAC,OAAO,CAAE,UAAU,CAAE,IAAI,CAAC,IAAI,EAAE,CAAC,OAAO,CAAE,OAAO,CAAE,EAAG;gBACjE,KAAK,CAAC,MAAM,GAAG;oBACd,UAAU,CAAC;wBACV,KAAI,CAAC,MAAM,CAAE,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,MAAM,CAAE,CAAC;wBACzC,OAAO,EAAE,CAAC;oBACX,CAAC,EAAE,CAAC,CAAC,CAAC;gBACP,CAAC,CAAC;aACF;iBAAM;gBACN,KAAK,CAAC,MAAM,GAAG;oBACd,KAAI,CAAC,MAAM,CAAE,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,MAAM,CAAE,CAAC;oBACzC,OAAO,EAAE,CAAC;gBACX,CAAC,CAAC;aACF;YAED,KAAK,CAAC,GAAG,GAAG,KAAI,CAAC,GAAG,CAAC;QACtB,CAAC,CAAC,CAAC;QAEH,OAAO,IAAI,CAAC,KAAK,CAAC;IACnB,CAAC;IAEM,gBAAI,GAAX,UAAa,MAAe,EAAE,SAAiB;QAC9C,4BAA4B;QAC5B,OAAO,SAAS,KAAK,KAAK;YACzB,yBAAyB;eACtB,CAAC,OAAO,MAAM,KAAK,QAAQ,IAAI,MAAM,CAAC,OAAO,CAAC,2BAA2B,CAAC,KAAK,CAAC,CAAC;YACpF,uBAAuB;eACpB,CAAC,OAAO,MAAM,KAAK,QAAQ,IAAI,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;IAClE,CAAC;IACF,kBAAC;AAAD,CAAC,AA/DD,CAAiC,SAAS,CAAC,iBAAiB,GA+D3D","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { resources } from \"pixi.js\";\r\n\r\nexport class SVGResource extends resources.BaseImageResource {\r\n\treadonly source!: HTMLImageElement;\r\n\treadonly svg: string;\r\n\r\n\tprotected _load: Promise<void> | null = null;\r\n\r\n\tconstructor( source: string, options: any ) {\r\n\t\tsuper( new Image() );\r\n\t\tthis._width = 0;\r\n\t\tthis._height = 0;\r\n\t\tthis.svg = source;\r\n\r\n\t\tresources.BaseImageResource.crossOrigin( this.source, this.svg, options && options.crossorigin );\r\n\r\n\t\tif( ! options || options.autoLoad !== false ) {\r\n\t\t\tthis.load();\r\n\t\t}\r\n\t}\r\n\r\n\tload(): Promise<void> {\r\n\t\tif( this._load ) {\r\n\t\t\treturn this._load;\r\n\t\t}\r\n\r\n\t\tthis._load = new Promise(( resolve ): void => {\r\n\t\t\tconst image: HTMLImageElement = this.source;\r\n\r\n\t\t\timage.onerror = ( event ): void => {\r\n\t\t\t\timage.onerror = null;\r\n\t\t\t\t(this as any).onError.run( event ); // TODO: Fix PixiJS\r\n\t\t\t};\r\n\r\n\t\t\tconst ua = navigator.userAgent;\r\n\r\n\t\t\t// IE and Edge generates wrong images without setTimeout.\r\n\t\t\tif( 0 <= ua.indexOf( \"Trident/\" ) || 0 <= ua.indexOf( \"Edge/\" ) ) {\r\n\t\t\t\timage.onload = (): void => {\r\n\t\t\t\t\tsetTimeout((): void => {\r\n\t\t\t\t\t\tthis.resize( image.width, image.height );\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\timage.onload = (): void => {\r\n\t\t\t\t\tthis.resize( image.width, image.height );\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\timage.src = this.svg;\r\n\t\t});\r\n\r\n\t\treturn this._load;\r\n\t}\r\n\r\n\tstatic test( source: unknown, extension: string ) {\r\n\t\t// url file extension is SVG\r\n\t\treturn extension === \"svg\"\r\n\t\t\t// source is SVG data-uri\r\n\t\t\t|| (typeof source === \"string\" && source.indexOf(\"data:image/svg+xml;base64\") === 0)\r\n\t\t\t// source is SVG inline\r\n\t\t\t|| (typeof source === \"string\" && source.indexOf(\"<svg\") === 0);\r\n\t}\r\n}\r\n"]}