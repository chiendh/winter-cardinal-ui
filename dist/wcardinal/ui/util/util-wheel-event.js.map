{"version":3,"file":"util-wheel-event.js","sourceRoot":"","sources":["../../../../src/main/typescript/wcardinal/ui/util/util-wheel-event.ts"],"names":[],"mappings":"AAAA;;;GAGG;AAGH,OAAO,EAAE,OAAO,EAAE,MAAM,mBAAmB,CAAC;AAU5C;;;;;;;;;EASE;AACF;IAQC;QALQ,YAAO,GAAkB,IAAI,CAAC;QAC9B,eAAU,GAAW,CAAC,CAAC;QACvB,gBAAW,GAAkB,IAAI,CAAC;QAClC,gBAAW,GAAkB,IAAI,CAAC;QAGzC,IAAI,CAAC,MAAM,GAAG,CAAE,SAAS,IAAI,QAAQ,IAAI,CAAC,IAAK,QAAgB,CAAC,YAAY,CAAC,CAAC;YAC7E,CAAE,OAAO,CAAE,CAAC,CAAC,CAAC,CAAE,YAAY,EAAE,gBAAgB,EAAE,qBAAqB,CAAE,CACvE,CAAC;IACH,CAAC;IAED,2BAAE,GAAF,UAAI,MAAmB,EAAE,OAA0C,EAAE,UAA2B;QAA3B,2BAAA,EAAA,kBAA2B;QAC/F,IAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1B,KAAK,IAAI,CAAC,GAAG,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,EAAG;YAC5C,IAAM,MAAI,GAAG,KAAK,CAAE,CAAC,CAAE,CAAC;YACxB,MAAM,CAAC,gBAAgB,CAAE,MAAI,EAAE,OAAO,EAAE,UAAU,CAAE,CAAC;SACrD;IACF,CAAC;IAED,4BAAG,GAAH,UAAK,MAAmB,EAAE,OAA0C,EAAE,UAA2B;QAA3B,2BAAA,EAAA,kBAA2B;QAChG,IAAM,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC;QAC1B,KAAK,IAAI,CAAC,GAAG,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,EAAG;YAC5C,IAAM,MAAI,GAAG,KAAK,CAAE,CAAC,CAAE,CAAC;YACxB,MAAM,CAAC,mBAAmB,CAAE,MAAI,EAAE,OAAO,EAAE,UAAU,CAAE,CAAC;SACxD;IACF,CAAC;IAED,sCAAa,GAAb;QACC,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,EAAG;YAC9B,IAAM,KAAK,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC,GAAG,CAAE,OAAO,CAAgB,CAAC;YACjE,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,aAAa,EAAE,CAAC;SACzC;QACD,OAAO,IAAI,CAAC,WAAW,CAAC;IACzB,CAAC;IAED,sCAAa,GAAb;QACC,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,EAAG;YAC9B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,aAAa,EAAE,GAAG,EAAE,CAAC;SAC7C;QACD,OAAO,IAAI,CAAC,WAAW,CAAC;IACzB,CAAC;IAED,kCAAS,GAAT,UAAW,CAAM;QAChB,IAAI,MAAM,GAAG,CAAC,CAAC;QACf,IAAI,MAAM,GAAG,CAAC,CAAC;QAEf,+BAA+B;QAC/B,IAAK,QAAQ,IAAI,CAAC,EAAG;YACpB,MAAM,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;SACvB;QACD,IAAK,YAAY,IAAI,CAAC,EAAG;YACxB,MAAM,GAAG,CAAC,CAAC,UAAU,CAAC;SACtB;QACD,IAAK,aAAa,IAAI,CAAC,EAAG;YACzB,MAAM,GAAG,CAAC,CAAC,WAAW,CAAC;SACvB;QACD,IAAK,aAAa,IAAI,CAAC,EAAG;YACzB,MAAM,GAAG,CAAC,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;SAC5B;QAED,oEAAoE;QACpE,IAAK,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,eAAe,EAAG;YAClD,MAAM,GAAG,MAAM,GAAG,CAAC,CAAC,CAAC;YACrB,MAAM,GAAG,CAAC,CAAC;SACX;QAED,uCAAuC;QACvC,IAAK,QAAQ,IAAI,CAAC,EAAG;YACpB,MAAM,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;SACvB;QACD,IAAK,QAAQ,IAAI,CAAC,EAAG;YACpB,MAAM,GAAG,CAAC,CAAC,MAAM,CAAC;SAClB;QAED,2DAA2D;QAC3D,IAAK,MAAM,KAAK,CAAC,IAAI,MAAM,KAAK,CAAC,EAAG;YACnC,OAAO,IAAI,CAAC;SACZ;QAED,4DAA4D;QAC5D,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAE,CAAC;QAE3D,gEAAgE;QAChE,8CAA8C;QAC9C,yCAAyC;QACzC,IAAM,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QACvB,IAAI,IAAI,CAAC,UAAU,GAAG,GAAG,IAAI,GAAG,EAAG;YAClC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;SACpB;QACD,IAAI,CAAC,UAAU,GAAG,GAAG,CAAC;QAEtB,EAAE;QACF,IAAM,YAAY,GAAG,CAAC,CAAC,CAAC,IAAI,KAAK,YAAY,IAAI,KAAK,GAAG,GAAG,KAAK,CAAC,CAAC,CAAC;QACpE,IAAK,CAAE,IAAI,CAAC,OAAO,IAAI,KAAK,GAAG,IAAI,CAAC,OAAO,EAAG;YAC7C,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;YAErB,mCAAmC;YACnC,IAAK,YAAY,EAAG;gBACnB,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC;aACnB;SACD;QAED,mCAAmC;QACnC,IAAK,YAAY,EAAG;YACnB,+BAA+B;YAC/B,KAAK,IAAK,EAAE,CAAC;YACb,MAAM,IAAI,EAAE,CAAC;YACb,MAAM,IAAI,EAAE,CAAC;SACb;QAED,+CAA+C;QAC/C,IAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,KAAK,GAAI,IAAI,CAAC,KAAK,CAAE,KAAK,GAAI,MAAM,CAAE,CAAC;QACvC,MAAM,GAAG,IAAI,CAAE,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAE,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC;QACjE,MAAM,GAAG,IAAI,CAAE,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAE,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC;QAEjE,OAAO;QACP,IAAM,IAAI,GAAG,CAAC,CAAC,SAAS,IAAI,CAAC,CAAC;QAC9B,IAAI,IAAI,KAAK,CAAC,EAAG;YAChB,IAAM,KAAK,GAAG,CAAE,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE,CAAE,CAAC;YAC3E,KAAK,IAAI,KAAK,CAAC;YACf,MAAM,IAAI,KAAK,CAAC;YAChB,MAAM,IAAI,KAAK,CAAC;SAChB;QAED,OAAO;YACN,IAAI,MAAA;YACJ,KAAK,OAAA;YACL,MAAM,QAAA;YACN,MAAM,QAAA;YACN,MAAM,QAAA;SACN,CAAC;IACH,CAAC;IAEM,0BAAW,GAAlB;QACC,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,EAAG;YAC3B,IAAI,CAAC,QAAQ,GAAG,IAAI,cAAc,EAAE,CAAC;SACrC;QACD,OAAO,IAAI,CAAC,QAAQ,CAAC;IACtB,CAAC;IACF,qBAAC;AAAD,CAAC,AA/ID,IA+IC","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DThemeFont } from \"../d-font\";\r\nimport { DThemes } from \"../theme/d-themes\";\r\n\r\nexport interface UtilWheelEventDeltas {\r\n\tmode: number;\r\n\tdelta: number;\r\n\tdeltaX: number;\r\n\tdeltaY: number;\r\n\tlowest: number;\r\n}\r\n\r\n/*!\r\n* jQuery Mousewheel 3.1.13\r\n*\r\n* Copyright jQuery Foundation and other contributors\r\n* Released under the MIT license\r\n* http://jquery.org/license\r\n*\r\n* See also https://github.com/mapbox/mapbox-gl-js/blob/001c7b9/js/ui/handler/scroll_zoom.js\r\n* and https://github.com/openlayers/openlayers/blob/v5.2.0/src/ol/interaction/MouseWheelZoom.js#L51\r\n*/\r\nexport class UtilWheelEvent {\r\n\tprivate static INSTANCE: UtilWheelEvent | null;\r\n\tprivate _names: Array<\"wheel\" | \"mousewheel\" | \"DOMMouseScroll\" | \"MozMousePixelScroll\">;\r\n\tprivate _lowest: number | null = null;\r\n\tprivate _timestamp: number = 0;\r\n\tprivate _lineHeight: number | null = null;\r\n\tprivate _pageHeight: number | null = null;\r\n\r\n\tconstructor() {\r\n\t\tthis._names = ( \"onwheel\" in document || 9 <= (document as any).documentMode ?\r\n\t\t\t[ \"wheel\" ] : [ \"mousewheel\", \"DOMMouseScroll\", \"MozMousePixelScroll\" ]\r\n\t\t);\r\n\t}\r\n\r\n\ton( target: HTMLElement, handler: ( e: WheelEvent | Event ) => void, useCapture: boolean = false ) {\r\n\t\tconst names = this._names;\r\n\t\tfor( let i = names.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst name = names[ i ];\r\n\t\t\ttarget.addEventListener( name, handler, useCapture );\r\n\t\t}\r\n\t}\r\n\r\n\toff( target: HTMLElement, handler: ( e: WheelEvent | Event ) => void, useCapture: boolean = false ) {\r\n\t\tconst names = this._names;\r\n\t\tfor( let i = names.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst name = names[ i ];\r\n\t\t\ttarget.removeEventListener( name, handler, useCapture );\r\n\t\t}\r\n\t}\r\n\r\n\tgetLineHeight(): number {\r\n\t\tif( this._lineHeight == null ) {\r\n\t\t\tconst theme = DThemes.getInstance().get( \"DBase\" ) as DThemeFont;\r\n\t\t\tthis._lineHeight = theme.getLineHeight();\r\n\t\t}\r\n\t\treturn this._lineHeight;\r\n\t}\r\n\r\n\tgetPageHeight(): number {\r\n\t\tif( this._pageHeight == null ) {\r\n\t\t\tthis._pageHeight = this.getLineHeight() * 12;\r\n\t\t}\r\n\t\treturn this._pageHeight;\r\n\t}\r\n\r\n\tnormalize( e: any ): UtilWheelEventDeltas | null {\r\n\t\tlet deltaX = 0;\r\n\t\tlet deltaY = 0;\r\n\r\n\t\t// Old school scrollwheel delta\r\n\t\tif ( \"detail\" in e ) {\r\n\t\t\tdeltaY = e.detail * -1;\r\n\t\t}\r\n\t\tif ( \"wheelDelta\" in e ) {\r\n\t\t\tdeltaY = e.wheelDelta;\r\n\t\t}\r\n\t\tif ( \"wheelDeltaY\" in e ) {\r\n\t\t\tdeltaY = e.wheelDeltaY;\r\n\t\t}\r\n\t\tif ( \"wheelDeltaX\" in e ) {\r\n\t\t\tdeltaX = e.wheelDeltaX * -1;\r\n\t\t}\r\n\r\n\t\t// Firefox < 17 horizontal scrolling related to DOMMouseScroll event\r\n\t\tif ( \"axis\" in e && e.axis === e.HORIZONTAL_AXIS ) {\r\n\t\t\tdeltaX = deltaY * -1;\r\n\t\t\tdeltaY = 0;\r\n\t\t}\r\n\r\n\t\t// New school wheel delta (wheel event)\r\n\t\tif ( \"deltaY\" in e ) {\r\n\t\t\tdeltaY = e.deltaY * -1;\r\n\t\t}\r\n\t\tif ( \"deltaX\" in e ) {\r\n\t\t\tdeltaX = e.deltaX;\r\n\t\t}\r\n\r\n\t\t// No change actually happened, no reason to go any further\r\n\t\tif ( deltaY === 0 && deltaX === 0 ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// Store lowest absolute delta to normalize the delta values\r\n\t\tlet delta = Math.max( Math.abs(deltaY), Math.abs(deltaX) );\r\n\r\n\t\t// Reset the this._lowest to better handle multiple device types\r\n\t\t// that give different a different lowestDelta\r\n\t\t// Ex: trackpad = 3 and mouse wheel = 120\r\n\t\tconst now = Date.now();\r\n\t\tif( this._timestamp + 200 <= now ) {\r\n\t\t\tthis._lowest = null;\r\n\t\t}\r\n\t\tthis._timestamp = now;\r\n\r\n\t\t//\r\n\t\tconst shouldAdjust = (e.type === \"mousewheel\" && delta % 120 === 0);\r\n\t\tif ( ! this._lowest || delta < this._lowest ) {\r\n\t\t\tthis._lowest = delta;\r\n\r\n\t\t\t// Adjust older deltas if necessary\r\n\t\t\tif ( shouldAdjust ) {\r\n\t\t\t\tthis._lowest /= 40;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Adjust older deltas if necessary\r\n\t\tif ( shouldAdjust ) {\r\n\t\t\t// Divide all the things by 40!\r\n\t\t\tdelta  /= 40;\r\n\t\t\tdeltaX /= 40;\r\n\t\t\tdeltaY /= 40;\r\n\t\t}\r\n\r\n\t\t// Get a whole, normalized value for the deltas\r\n\t\tconst lowest = this._lowest;\r\n\t\tdelta  = Math.floor( delta  / lowest );\r\n\t\tdeltaX = Math[ 1 <= deltaX ? \"floor\" : \"ceil\" ](deltaX / lowest);\r\n\t\tdeltaY = Math[ 1 <= deltaY ? \"floor\" : \"ceil\" ](deltaY / lowest);\r\n\r\n\t\t// Mode\r\n\t\tconst mode = e.deltaMode || 0;\r\n\t\tif( mode !== 0 ) {\r\n\t\t\tconst scale = ( mode === 1 ? this.getLineHeight() : this.getPageHeight() );\r\n\t\t\tdelta *= scale;\r\n\t\t\tdeltaX *= scale;\r\n\t\t\tdeltaY *= scale;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tmode,\r\n\t\t\tdelta,\r\n\t\t\tdeltaX,\r\n\t\t\tdeltaY,\r\n\t\t\tlowest\r\n\t\t};\r\n\t}\r\n\r\n\tstatic getInstance(): UtilWheelEvent {\r\n\t\tif( this.INSTANCE == null ) {\r\n\t\t\tthis.INSTANCE = new UtilWheelEvent();\r\n\t\t}\r\n\t\treturn this.INSTANCE;\r\n\t}\r\n}\r\n"]}