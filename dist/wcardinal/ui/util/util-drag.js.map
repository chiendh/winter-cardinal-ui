{"version":3,"file":"util-drag.js","sourceRoot":"","sources":["../../../../src/main/typescript/wcardinal/ui/util/util-drag.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point } from \"pixi.js\";\r\nimport { DApplications } from \"../d-applications\";\r\nimport { DBase } from \"../d-base\";\r\nimport { DMouseModifier } from \"../d-mouse-modifier\";\r\nimport { DMouseModifiers } from \"../d-mouse-modifiers\";\r\nimport { UtilDragEasing, UtilDragEasingOptions } from \"./util-drag-easing\";\r\nimport { UtilPointerEvent } from \"./util-pointer-event\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport InteractionManager = interaction.InteractionManager;\r\n\r\nexport type UtilDragOnMove = ( dx: number, dy: number, x: number, y: number, ds: number ) => void;\r\nexport type UtilDragOnStart = () => void;\r\nexport type UtilDragOnEnd = () => void;\r\nexport type UtilDragChecker = ( e: InteractionEvent, modifier: DMouseModifier, target: DBase ) => boolean;\r\n\r\nexport interface UtilDragCheckerOptions {\r\n\tstart?: UtilDragChecker;\r\n\tmove?: UtilDragChecker;\r\n}\r\n\r\nexport interface UtilDragOnOptions {\r\n\tstart?: UtilDragOnStart;\r\n\tmove?: UtilDragOnMove;\r\n\tend?: UtilDragOnEnd;\r\n}\r\n\r\nexport interface UtilDragOptions {\r\n\ttarget: DBase;\r\n\ttouch?: boolean;\r\n\tmodifier?: DMouseModifier;\r\n\tchecker?: UtilDragCheckerOptions;\r\n\teasing?: boolean | UtilDragEasingOptions;\r\n\tbind?: boolean;\r\n\ton?: UtilDragOnOptions;\r\n}\r\n\r\nconst toEasingOptions = ( options: true | UtilDragEasingOptions | undefined ): UtilDragEasingOptions | undefined => {\r\n\treturn ( options == null || options === true ?\r\n\t\tundefined : options\r\n\t);\r\n};\r\n\r\nconst toChecker = ( options?: UtilDragOptions ): { start: UtilDragChecker, move: UtilDragChecker } => {\r\n\tconst checker = options && options.checker;\r\n\tconst defaultChecker = DMouseModifiers.match;\r\n\tif( checker ) {\r\n\t\treturn {\r\n\t\t\tstart: checker.start || defaultChecker,\r\n\t\t\tmove: checker.move || defaultChecker\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tstart: defaultChecker,\r\n\t\tmove: defaultChecker\r\n\t};\r\n};\r\n\r\nexport class UtilDrag {\r\n\tprotected static EPSILON = 0.00001;\r\n\tprotected _target: DBase<any, any>;\r\n\tprotected _onDownBound: ( e: InteractionEvent ) => void;\r\n\tprotected _onMoveBound: ( e: InteractionEvent ) => void;\r\n\tprotected _onEndBound: ( e: InteractionEvent ) => void;\r\n\tprotected _onStart?: UtilDragOnStart;\r\n\tprotected _onMove?: UtilDragOnMove;\r\n\tprotected _onEnd?: UtilDragOnEnd;\r\n\tprotected _down: string;\r\n\tprotected _move: string;\r\n\tprotected _up: string;\r\n\tprotected _easing?: UtilDragEasing;\r\n\tprotected _modifier: DMouseModifier;\r\n\tprotected _checker: { start: UtilDragChecker, move: UtilDragChecker };\r\n\tprotected _interactionManager: InteractionManager | null;\r\n\tprotected _center: Point;\r\n\tprotected _scale: number;\r\n\tprotected _scalingCenter: Point;\r\n\tprotected _time: number;\r\n\r\n\tconstructor( options: UtilDragOptions ) {\r\n\t\tconst target = this._target = options.target;\r\n\t\tconst on = options.on;\r\n\t\tif( on ) {\r\n\t\t\tthis._onStart = on.start;\r\n\t\t\tthis._onMove = on.move;\r\n\t\t\tthis._onEnd = on.end;\r\n\t\t}\r\n\t\tthis._modifier = (options && options.modifier) || DMouseModifier.NONE;\r\n\t\tthis._checker = toChecker( options );\r\n\t\tthis._interactionManager = null;\r\n\t\tthis._center = new Point();\r\n\t\tthis._scale = 1;\r\n\t\tthis._scalingCenter = new Point();\r\n\t\tthis._time = 0;\r\n\r\n\t\tconst easing = options.easing;\r\n\t\tif( easing == null || easing !== false ) {\r\n\t\t\tconst onEasingMoveBound = ( dx: number, dy: number, ds: number, time: number ): void => {\r\n\t\t\t\tthis.onEasingMove( dx, dy, ds, time );\r\n\t\t\t};\r\n\t\t\tthis._easing = new UtilDragEasing( onEasingMoveBound, toEasingOptions( easing ) );\r\n\t\t}\r\n\r\n\t\tthis._onDownBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onDown( e );\r\n\t\t};\r\n\r\n\t\tthis._onMoveBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onMove( e );\r\n\t\t};\r\n\r\n\t\tthis._onEndBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onEnd( e );\r\n\t\t};\r\n\r\n\t\tif( options.touch ) {\r\n\t\t\tthis._down = \"touchstart\";\r\n\t\t\tthis._move = \"touchmove\";\r\n\t\t\tthis._up = \"touchend\";\r\n\t\t} else {\r\n\t\t\tthis._down = UtilPointerEvent.down;\r\n\t\t\tthis._move = UtilPointerEvent.move;\r\n\t\t\tthis._up = UtilPointerEvent.up;\r\n\t\t}\r\n\r\n\t\tif( options.bind !== false ) {\r\n\t\t\ttarget.on( this._down, this._onDownBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected calcCenterAndScale(\r\n\t\te: InteractionEvent, center: Point,\r\n\t\tinteractionManager: InteractionManager\r\n\t): number {\r\n\t\tconst oe = e.data.originalEvent;\r\n\t\tconst global = e.data.global;\r\n\t\tif( \"touches\" in oe ) {\r\n\t\t\tconst touches = oe.touches;\r\n\t\t\tconst touchesLength = touches.length;\r\n\t\t\tif( 0 < touchesLength ) {\r\n\t\t\t\t// Update the center\r\n\t\t\t\tconst first = touches[ 0 ];\r\n\t\t\t\tlet centerX = first.clientX;\r\n\t\t\t\tlet centerY = first.clientY;\r\n\t\t\t\tfor( let i = 1, imax = touches.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst touch = touches[ i ];\r\n\t\t\t\t\tcenterX += touch.clientX;\r\n\t\t\t\t\tcenterY += touch.clientY;\r\n\t\t\t\t}\r\n\t\t\t\tcenterX /= touchesLength;\r\n\t\t\t\tcenterY /= touchesLength;\r\n\t\t\t\tinteractionManager.mapPositionToPoint( center, centerX, centerY );\r\n\r\n\t\t\t\tif( 1 < touchesLength ) {\r\n\t\t\t\t\t// Calculate the maximum distance from the center\r\n\t\t\t\t\tlet squareDistance = 0;\r\n\t\t\t\t\tfor( let i = 1, imax = touches.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst touch = touches[ i ];\r\n\t\t\t\t\t\tconst dx = touch.clientX - centerX;\r\n\t\t\t\t\t\tconst dy = touch.clientY - centerY;\r\n\t\t\t\t\t\tsquareDistance = Math.max( squareDistance, dx * dx + dy * dy );\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn Math.sqrt( squareDistance );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcenter.copyFrom( global );\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tonDown( e: InteractionEvent ): void {\r\n\t\tconst target = this._target;\r\n\t\tif( this._checker.start( e, this._modifier, target ) ) {\r\n\t\t\tconst layer = DApplications.getLayer( target );\r\n\t\t\tif( layer ) {\r\n\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\tif( target.isDragging() ) {\r\n\t\t\t\t\tconst interactionManager = this._interactionManager;\r\n\t\t\t\t\tif( interactionManager ) {\r\n\t\t\t\t\t\tconst center = this._center;\r\n\t\t\t\t\t\tthis._scale = this.calcCenterAndScale( e, center, interactionManager );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget.setDragging( true );\r\n\r\n\t\t\t\t\t// Interaction manager\r\n\t\t\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\r\n\t\t\t\t\tthis._interactionManager = interactionManager;\r\n\r\n\t\t\t\t\t// Update the center\r\n\t\t\t\t\tconst center = this._center;\r\n\t\t\t\t\tthis._scale = this.calcCenterAndScale( e, center, interactionManager );\r\n\r\n\t\t\t\t\t//\r\n\t\t\t\t\tthis._time = e.data.originalEvent.timeStamp;\r\n\r\n\t\t\t\t\t// Easing util\r\n\t\t\t\t\tconst easing = this._easing;\r\n\t\t\t\t\tif( easing ) {\r\n\t\t\t\t\t\teasing.onStart();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// User-defined handler\r\n\t\t\t\t\tconst onStart = this._onStart;\r\n\t\t\t\t\tif( onStart != null ) {\r\n\t\t\t\t\t\tonStart();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Event handler\r\n\t\t\t\t\tinteractionManager.on( this._move, this._onMoveBound );\r\n\t\t\t\t\tinteractionManager.on( this._up, this._onEndBound );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onMove( e: InteractionEvent ): void {\r\n\t\tconst target = this._target;\r\n\t\tif( target.isDragging() && this._checker.move( e, this._modifier, target ) ) {\r\n\t\t\tconst interactionManager = this._interactionManager;\r\n\t\t\tif( interactionManager ) {\r\n\t\t\t\t// Update the center\r\n\t\t\t\tconst center = this._center;\r\n\t\t\t\tconst centerX = center.x;\r\n\t\t\t\tconst centerY = center.y;\r\n\t\t\t\tconst newScale = this.calcCenterAndScale( e, center, interactionManager );\r\n\t\t\t\tconst oldScale = this._scale;\r\n\t\t\t\tthis._scale = newScale;\r\n\t\t\t\tconst oldTime = this._time;\r\n\t\t\t\tconst newTime = e.data.originalEvent.timeStamp;\r\n\t\t\t\tthis._time = newTime;\r\n\r\n\t\t\t\t// Calculate the position\r\n\t\t\t\tconst dx = center.x - centerX;\r\n\t\t\t\tconst dy = center.y - centerY;\r\n\t\t\t\tconst dt = newTime - oldTime;\r\n\t\t\t\tconst ds = ( UtilDrag.EPSILON < oldScale ? newScale / oldScale : 1 );\r\n\r\n\t\t\t\t// Easing util\r\n\t\t\t\tconst easing = this._easing;\r\n\t\t\t\tif( easing ) {\r\n\t\t\t\t\teasing.onMove( dx, dy, ds, dt );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// User-defined handler\r\n\t\t\t\tconst onMove = this._onMove;\r\n\t\t\t\tif( onMove != null ) {\r\n\t\t\t\t\tif( dx !== 0 || dy !== 0 || ds !== 1 ) {\r\n\t\t\t\t\t\tonMove( dx, dy, center.x, center.y, ds );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onEnd( e: InteractionEvent ): void {\r\n\t\tconst target = this._target;\r\n\t\tif( target.isDragging() ) {\r\n\t\t\tconst interactionManager = this._interactionManager;\r\n\t\t\tif( interactionManager ) {\r\n\t\t\t\t// Update the center\r\n\t\t\t\tconst center = this._center;\r\n\t\t\t\tthis._scalingCenter.copyFrom( center );\r\n\t\t\t\tthis._scale = this.calcCenterAndScale( e, center, interactionManager );\r\n\r\n\t\t\t\t// Finalize\r\n\t\t\t\tconst oe = e.data.originalEvent;\r\n\t\t\t\tif( \"touches\" in oe ? oe.touches.length <= 0 : true ) {\r\n\t\t\t\t\ttarget.setDragging( false );\r\n\r\n\t\t\t\t\t// Event handler\r\n\t\t\t\t\tthis._interactionManager = null;\r\n\t\t\t\t\tinteractionManager.off( this._move, this._onMoveBound );\r\n\t\t\t\t\tinteractionManager.off( this._up, this._onEndBound );\r\n\r\n\t\t\t\t\t// User-defined handler\r\n\t\t\t\t\tconst onEnd = this._onEnd;\r\n\t\t\t\t\tif( onEnd != null ) {\r\n\t\t\t\t\t\tonEnd();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Easing util\r\n\t\t\t\t\tconst easing = this._easing;\r\n\t\t\t\t\tif( easing ) {\r\n\t\t\t\t\t\teasing.onEnd( e.data.originalEvent.timeStamp - this._time );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onEasingMove( dx: number, dy: number, ds: number, time: number ): void {\r\n\t\tconst onMove = this._onMove;\r\n\t\tif( onMove != null ) {\r\n\t\t\tif( dx !== 0 || dy !== 0 || ds !== 1 ) {\r\n\t\t\t\tconst scalingCenter = this._scalingCenter;\r\n\t\t\t\tscalingCenter.set(\r\n\t\t\t\t\tscalingCenter.x + dx,\r\n\t\t\t\t\tscalingCenter.y + dy\r\n\t\t\t\t);\r\n\t\t\t\tonMove( dx, dy, scalingCenter.x, scalingCenter.y, ds );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tconst easing = this._easing;\r\n\t\tif( easing ) {\r\n\t\t\teasing.stop();\r\n\t\t}\r\n\t}\r\n}\r\n"]}