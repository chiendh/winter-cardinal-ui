{"version":3,"file":"util-pointer-event.js","sourceRoot":"","sources":["../../../../src/main/typescript/wcardinal/ui/util/util-pointer-event.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, interaction, Point } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DApplicationTarget } from \"../d-application-like\";\r\nimport { DApplications } from \"../d-applications\";\r\n\r\nexport type UtilPointerEventClickHandler = ( e: InteractionEvent ) => void;\r\n\r\nexport interface UtilPointerEventClickTarget extends DApplicationTarget {\r\n\ton( name: string, handler: UtilPointerEventClickHandler ): void;\r\n}\r\n\r\nexport class UtilPointerEvent {\r\n\tstatic CLICK_DISTANCE_THRESHOLD: number = 10;\r\n\tstatic DBLCLICK_INTERVAL_THRESHOLD: number = 333;\r\n\tstatic LONG_CLICK_THRESHOLD: number = 750;\r\n\r\n\tstatic get touchable(): boolean {\r\n\t\treturn ( \"ontouchstart\" in document );\r\n\t}\r\n\r\n\tstatic get tap(): string {\r\n\t\treturn \"pointertap\";\r\n\t}\r\n\r\n\tstatic get down(): string {\r\n\t\treturn \"pointerdown\";\r\n\t}\r\n\r\n\tstatic get enter(): string {\r\n\t\treturn \"pointerenter\";\r\n\t}\r\n\r\n\tstatic get leave(): string {\r\n\t\treturn \"pointerleave\";\r\n\t}\r\n\r\n\tstatic get move(): string {\r\n\t\treturn \"pointermove\";\r\n\t}\r\n\r\n\tstatic get out(): string {\r\n\t\treturn \"pointerout\";\r\n\t}\r\n\r\n\tstatic get over(): string {\r\n\t\treturn \"pointerover\";\r\n\t}\r\n\r\n\tstatic get up(): string {\r\n\t\treturn \"pointerup\";\r\n\t}\r\n\r\n\tstatic get cancel(): string {\r\n\t\treturn \"pointercancel\";\r\n\t}\r\n\r\n\tstatic toGlobal(\r\n\t\te: MouseEvent | TouchEvent,\r\n\t\tinteractionManager: interaction.InteractionManager,\r\n\t\tresult: Point\r\n\t): Point {\r\n\t\tif( \"touches\" in e ) {\r\n\t\t\tconst touches = e.changedTouches;\r\n\t\t\tconst touch = touches[ touches.length - 1 ];\r\n\t\t\tif( touch != null ) {\r\n\t\t\t\tinteractionManager.mapPositionToPoint( result, touch.clientX, touch.clientY );\r\n\t\t\t} else {\r\n\t\t\t\tinteractionManager.mapPositionToPoint( result, 0, 0 );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tinteractionManager.mapPositionToPoint( result, e.clientX, e.clientY );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic onClick( target: UtilPointerEventClickTarget, handler: UtilPointerEventClickHandler ): void {\r\n\t\tif( ! this.touchable ) {\r\n\t\t\ttarget.on( \"click\", handler );\r\n\t\t} else {\r\n\t\t\tlet isDowned = false;\r\n\t\t\tlet downX = 0;\r\n\t\t\tlet downY = 0;\r\n\t\t\tlet interactionManagerBound: interaction.InteractionManager | null = null;\r\n\t\t\tconst cleanup = (): void => {\r\n\t\t\t\tisDowned = false;\r\n\t\t\t\tif( interactionManagerBound ) {\r\n\t\t\t\t\tinteractionManagerBound.off( up, onUp );\r\n\t\t\t\t\tinteractionManagerBound = null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconst isValidDistance = ( e: InteractionEvent ): boolean => {\r\n\t\t\t\tconst global = e.data.global;\r\n\t\t\t\tconst dx = Math.abs( downX - global.x );\r\n\t\t\t\tconst dy = Math.abs( downY - global.y );\r\n\t\t\t\tconst threshold = this.CLICK_DISTANCE_THRESHOLD;\r\n\t\t\t\treturn ( dx <= threshold && dy <= threshold );\r\n\t\t\t};\r\n\t\t\ttarget.on( \"click\", ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tcleanup();\r\n\t\t\t\t}\r\n\t\t\t\thandler( e );\r\n\t\t\t});\r\n\t\t\tconst up = this.up;\r\n\t\t\tconst onUp = ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tcleanup();\r\n\t\t\t\t\tif( this.contains( target, e.target ) ) {\r\n\t\t\t\t\t\tif( isValidDistance( e ) ) {\r\n\t\t\t\t\t\t\thandler( e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\ttarget.on( this.down, ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tconst global = e.data.global;\r\n\t\t\t\t\tdownX = global.x;\r\n\t\t\t\t\tdownY = global.y;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tisDowned = true;\r\n\t\t\t\t\tconst global = e.data.global;\r\n\t\t\t\t\tdownX = global.x;\r\n\t\t\t\t\tdownY = global.y;\r\n\t\t\t\t\tif( interactionManagerBound ) {\r\n\t\t\t\t\t\tinteractionManagerBound.off( up, onUp );\r\n\t\t\t\t\t\tinteractionManagerBound = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst layer = DApplications.getLayer( target );\r\n\t\t\t\t\tif( layer ) {\r\n\t\t\t\t\t\tinteractionManagerBound = layer.renderer.plugins.interaction;\r\n\t\t\t\t\t\tinteractionManagerBound.once( up, onUp );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onLongClick(\r\n\t\ttarget: UtilPointerEventClickTarget,\r\n\t\tonClick: UtilPointerEventClickHandler,\r\n\t\tonLongClick: UtilPointerEventClickHandler\r\n\t): void {\r\n\t\tif( ! this.touchable ) {\r\n\t\t\ttarget.on( \"click\", onClick );\r\n\t\t} else {\r\n\t\t\tlet isDowned = false;\r\n\t\t\tlet downX = 0;\r\n\t\t\tlet downY = 0;\r\n\t\t\tlet timeoutId: number | null = null;\r\n\t\t\tlet interactionManagerBound: interaction.InteractionManager | null = null;\r\n\t\t\tconst cleanupTimeout = (): void => {\r\n\t\t\t\tif( timeoutId != null ) {\r\n\t\t\t\t\tclearTimeout( timeoutId );\r\n\t\t\t\t\ttimeoutId = null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconst cleanup = (): void => {\r\n\t\t\t\tisDowned = false;\r\n\t\t\t\tif( interactionManagerBound ) {\r\n\t\t\t\t\tinteractionManagerBound.off( up, onUp );\r\n\t\t\t\t\tinteractionManagerBound.off( move, onMove );\r\n\t\t\t\t\tinteractionManagerBound = null;\r\n\t\t\t\t}\r\n\t\t\t\tcleanupTimeout();\r\n\t\t\t};\r\n\t\t\tconst isValidDistance = ( e: InteractionEvent ): boolean => {\r\n\t\t\t\tconst global = e.data.global;\r\n\t\t\t\tconst dx = Math.abs( downX - global.x );\r\n\t\t\t\tconst dy = Math.abs( downY - global.y );\r\n\t\t\t\tconst threshold = this.CLICK_DISTANCE_THRESHOLD;\r\n\t\t\t\treturn ( dx < threshold && dy < threshold );\r\n\t\t\t};\r\n\t\t\ttarget.on( \"click\", ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tcleanup();\r\n\t\t\t\t}\r\n\t\t\t\tonClick( e );\r\n\t\t\t});\r\n\t\t\tconst up = this.up;\r\n\t\t\tconst move = this.move;\r\n\t\t\tconst onUp = ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tcleanup();\r\n\t\t\t\t\tif( this.contains( target, e.target ) ) {\r\n\t\t\t\t\t\tif( isValidDistance( e ) ) {\r\n\t\t\t\t\t\t\tonClick( e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconst onMove = ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tif( this.contains( target, e.target ) ) {\r\n\t\t\t\t\t\tif( ! isValidDistance( e ) ) {\r\n\t\t\t\t\t\t\tcleanup();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\ttarget.on( this.down, ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( ! isDowned ) {\r\n\t\t\t\t\tisDowned = true;\r\n\t\t\t\t\tconst global = e.data.global;\r\n\t\t\t\t\tdownX = global.x;\r\n\t\t\t\t\tdownY = global.y;\r\n\t\t\t\t\tcleanupTimeout();\r\n\t\t\t\t\tconst oe = e.data.originalEvent;\r\n\t\t\t\t\tif( \"touches\" in oe ) {\r\n\t\t\t\t\t\ttimeoutId = window.setTimeout((): void => {\r\n\t\t\t\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\t\t\t\tcleanup();\r\n\t\t\t\t\t\t\t\tonLongClick( e );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, this.LONG_CLICK_THRESHOLD );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( interactionManagerBound ) {\r\n\t\t\t\t\t\tinteractionManagerBound.off( up, onUp );\r\n\t\t\t\t\t\tinteractionManagerBound.off( move, onMove );\r\n\t\t\t\t\t\tinteractionManagerBound = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst layer = DApplications.getLayer( target );\r\n\t\t\t\t\tif( layer ) {\r\n\t\t\t\t\t\tinteractionManagerBound = layer.renderer.plugins.interaction;\r\n\t\t\t\t\t\tinteractionManagerBound.once( up, onUp );\r\n\t\t\t\t\t\tinteractionManagerBound.on( move, onMove );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onDblClick( target: HTMLElement, handler: ( e: MouseEvent | TouchEvent ) => void ): void {\r\n\t\tif( ! this.touchable ) {\r\n\t\t\ttarget.addEventListener( \"dblclick\", handler );\r\n\t\t} else {\r\n\t\t\tlet isDowned = 0;\r\n\t\t\tlet downX = 0;\r\n\t\t\tlet downY = 0;\r\n\t\t\tlet clickTime = 0;\r\n\r\n\t\t\ttarget.addEventListener( \"dblclick\", handler );\r\n\r\n\t\t\ttarget.addEventListener( \"touchend\", ( e: TouchEvent ): void => {\r\n\t\t\t\tif( isDowned === 1 || isDowned === 3 ) {\r\n\t\t\t\t\tconst touches = e.changedTouches;\r\n\t\t\t\t\tconst touch: Touch | null = touches[ touches.length - 1 ];\r\n\t\t\t\t\tif( touch != null ) {\r\n\t\t\t\t\t\tconst dx = downX - touch.clientX;\r\n\t\t\t\t\t\tconst dy = downY - touch.clientY;\r\n\t\t\t\t\t\tif( Math.abs( dx ) + Math.abs( dy ) < this.CLICK_DISTANCE_THRESHOLD ) {\r\n\t\t\t\t\t\t\tisDowned += 1;\r\n\t\t\t\t\t\t\tif( isDowned === 4 ) {\r\n\t\t\t\t\t\t\t\tisDowned = 0;\r\n\t\t\t\t\t\t\t\tconst elapsedTime = e.timeStamp - clickTime;\r\n\t\t\t\t\t\t\t\tif( elapsedTime < this.DBLCLICK_INTERVAL_THRESHOLD ) {\r\n\t\t\t\t\t\t\t\t\thandler( e );\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tclickTime = e.timeStamp;\r\n\t\t\t\t\t\t\t\t\tisDowned = 2;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tclickTime = e.timeStamp;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tisDowned = 0;\r\n\t\t\t});\r\n\r\n\t\t\ttarget.addEventListener( \"touchstart\", ( e: TouchEvent ): void => {\r\n\t\t\t\tif( isDowned === 0 ) {\r\n\t\t\t\t\tconst touch: Touch | null = e.touches.item( e.touches.length - 1 );\r\n\t\t\t\t\tif( touch != null ) {\r\n\t\t\t\t\t\tisDowned = 1;\r\n\t\t\t\t\t\tdownX = touch.clientX;\r\n\t\t\t\t\t\tdownY = touch.clientY;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if( isDowned === 2 ) {\r\n\t\t\t\t\tconst touch: Touch | null = e.touches.item( e.touches.length - 1 );\r\n\t\t\t\t\tif( touch != null ) {\r\n\t\t\t\t\t\tisDowned = 3;\r\n\t\t\t\t\t\tdownX = touch.clientX;\r\n\t\t\t\t\t\tdownY = touch.clientY;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tisDowned = 0;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstatic contains( target: unknown, targetOrChild: DisplayObject | null ): boolean {\r\n\t\tlet current = targetOrChild;\r\n\t\twhile( current != null && current !== target ) {\r\n\t\t\tcurrent = current.parent;\r\n\t\t}\r\n\t\treturn current === target;\r\n\t}\r\n}\r\n"]}