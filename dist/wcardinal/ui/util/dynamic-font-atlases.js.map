{"version":3,"file":"dynamic-font-atlases.js","sourceRoot":"","sources":["../../../../src/main/typescript/wcardinal/ui/util/dynamic-font-atlases.ts"],"names":[],"mappings":"AAAA;;;GAGG;AAGH,OAAO,EAAE,gBAAgB,EAAE,MAAM,sBAAsB,CAAC;AAExD,IAAM,MAAM,GAAG,UAAE,KAAuB;IACvC,KAAK,CAAC,MAAM,EAAE,CAAC;AAChB,CAAC,CAAC;AAEF,IAAM,SAAS,GAAG,UAAE,YAA2C;IAC9D,YAAY,CAAC,OAAO,CAAE,MAAM,CAAE,CAAC;AAChC,CAAC,CAAC;AAEF,IAAM,OAAO,GAAG,UAAE,KAAuB;IACxC,KAAK,CAAC,MAAM,EAAE,CAAC;AAChB,CAAC,CAAC;AAEF,IAAM,UAAU,GAAG,UAAE,YAA2C;IAC/D,YAAY,CAAC,OAAO,CAAE,OAAO,CAAE,CAAC;AACjC,CAAC,CAAC;AAEF;IAIC,4BAAa,KAA4B;QAAzC,iBAOC;QANA,IAAI,CAAC,QAAQ,GAAG,IAAI,GAAG,EAAyC,CAAC;QACjE,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,QAAQ,CAAC,UAAU,CAAC;QAE7C,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAE,WAAW,EAAE;YAC/B,KAAI,CAAC,MAAM,EAAE,CAAC;QACf,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,gCAAG,GAAH,UAAK,MAAc,EAAE,QAAgB,EAAE,SAAiB,EAAE,OAAe;QACxE,IAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC9B,IAAI,YAAY,GAAG,OAAO,CAAC,GAAG,CAAE,MAAM,CAAE,CAAC;QACzC,IAAI,YAAY,IAAI,IAAI,EAAG;YAC1B,YAAY,GAAG,IAAI,GAAG,EAA4B,CAAC;YACnD,OAAO,CAAC,GAAG,CAAE,MAAM,EAAE,YAAY,CAAE,CAAC;SACpC;QACD,IAAI,KAAK,GAAG,YAAY,CAAC,GAAG,CAAE,SAAS,CAAE,CAAC;QAC1C,IAAI,KAAK,IAAI,IAAI,EAAG;YACnB,KAAK,GAAG,IAAI,gBAAgB,CAAE,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,WAAW,CAAE,CAAC;YAC9E,YAAY,CAAC,GAAG,CAAE,SAAS,EAAE,KAAK,CAAE,CAAC;SACrC;QACD,KAAK,CAAC,GAAG,CAAE,OAAO,CAAE,CAAC;IACtB,CAAC;IAED,mCAAM,GAAN,UAAQ,MAAc,EAAE,SAAiB,EAAE,OAAe;QACzD,IAAM,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAE,MAAM,CAAE,CAAC;QACjD,IAAI,YAAY,IAAI,IAAI,EAAG;YAC1B,IAAM,KAAK,GAAG,YAAY,CAAC,GAAG,CAAE,SAAS,CAAE,CAAC;YAC5C,IAAI,KAAK,IAAI,IAAI,EAAG;gBACnB,KAAK,CAAC,MAAM,CAAE,OAAO,CAAE,CAAC;aACxB;SACD;IACF,CAAC;IAED,gCAAG,GAAH,UAAK,MAAc,EAAE,SAAiB;QACrC,IAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC9B,IAAM,YAAY,GAAG,OAAO,CAAC,GAAG,CAAE,MAAM,CAAE,CAAC;QAC3C,IAAI,YAAY,IAAI,IAAI,EAAG;YAC1B,OAAO,IAAI,CAAC;SACZ;QACD,IAAM,KAAK,GAAG,YAAY,CAAC,GAAG,CAAE,SAAS,CAAE,CAAC;QAC5C,IAAI,KAAK,IAAI,IAAI,EAAG;YACnB,OAAO,IAAI,CAAC;SACZ;QACD,OAAO,KAAK,CAAC;IACd,CAAC;IAED,mCAAM,GAAN;QACC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAE,SAAS,CAAE,CAAC;IACpC,CAAC;IAED,oCAAO,GAAP;QACC,IAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC9B,OAAO,CAAC,OAAO,CAAE,UAAU,CAAE,CAAC;QAC9B,OAAO,CAAC,KAAK,EAAE,CAAC;IACjB,CAAC;IACF,yBAAC;AAAD,CAAC,AA5DD,IA4DC","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DApplicationLayerLike } from \"../d-application-layer-like\";\r\nimport { DynamicFontAtlas } from \"./dynamic-font-atlas\";\r\n\r\nconst update = ( atlas: DynamicFontAtlas ): void => {\r\n\tatlas.update();\r\n};\r\n\r\nconst updateAll = ( colorToAltas: Map<number, DynamicFontAtlas> ): void => {\r\n\tcolorToAltas.forEach( update );\r\n};\r\n\r\nconst destroy = ( atlas: DynamicFontAtlas ): void => {\r\n\tatlas.update();\r\n};\r\n\r\nconst destroyAll = ( colorToAltas: Map<number, DynamicFontAtlas> ): void => {\r\n\tcolorToAltas.forEach( destroy );\r\n};\r\n\r\nexport class DynamicFontAtlases {\r\n\tprotected _atlases: Map<string, Map<number, DynamicFontAtlas>>;\r\n\tprotected _resolution: number;\r\n\r\n\tconstructor( layer: DApplicationLayerLike ) {\r\n\t\tthis._atlases = new Map<string, Map<number, DynamicFontAtlas>>();\r\n\t\tthis._resolution = layer.renderer.resolution;\r\n\r\n\t\tlayer.renderer.on( \"prerender\", (): void => {\r\n\t\t\tthis.update();\r\n\t\t});\r\n\t}\r\n\r\n\tadd( fontId: string, fontSize: number, fontColor: number, targets: string ): void {\r\n\t\tconst atlases = this._atlases;\r\n\t\tlet colorToAtlas = atlases.get( fontId );\r\n\t\tif( colorToAtlas == null ) {\r\n\t\t\tcolorToAtlas = new Map<number, DynamicFontAtlas>();\r\n\t\t\tatlases.set( fontId, colorToAtlas );\r\n\t\t}\r\n\t\tlet atlas = colorToAtlas.get( fontColor );\r\n\t\tif( atlas == null ) {\r\n\t\t\tatlas = new DynamicFontAtlas( fontId, fontSize, fontColor, this._resolution );\r\n\t\t\tcolorToAtlas.set( fontColor, atlas );\r\n\t\t}\r\n\t\tatlas.add( targets );\r\n\t}\r\n\r\n\tremove( fontId: string, fontColor: number, targets: string ): void {\r\n\t\tconst colorToAtlas = this._atlases.get( fontId );\r\n\t\tif( colorToAtlas != null ) {\r\n\t\t\tconst atlas = colorToAtlas.get( fontColor );\r\n\t\t\tif( atlas != null ) {\r\n\t\t\t\tatlas.remove( targets );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget( fontId: string, fontColor: number ): DynamicFontAtlas | null {\r\n\t\tconst atlases = this._atlases;\r\n\t\tconst colorToAtlas = atlases.get( fontId );\r\n\t\tif( colorToAtlas == null ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst atlas = colorToAtlas.get( fontColor );\r\n\t\tif( atlas == null ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn atlas;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tthis._atlases.forEach( updateAll );\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tconst atlases = this._atlases;\r\n\t\tatlases.forEach( destroyAll );\r\n\t\tatlases.clear();\r\n\t}\r\n}\r\n"]}