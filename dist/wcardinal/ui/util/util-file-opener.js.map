{"version":3,"file":"util-file-opener.js","sourceRoot":"","sources":["../../../../src/main/typescript/wcardinal/ui/util/util-file-opener.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * An output format.\r\n */\r\nexport enum UtilFileAs {\r\n\tTEXT,\r\n\tDATA_URL,\r\n\tBINARY_STRING,\r\n\tARRAY_BUTTER\r\n}\r\n\r\nexport interface UtilFileFacade {\r\n\temit( name: string, ...args: any[] ): void;\r\n}\r\n\r\n/**\r\n * An `open` event handler.\r\n *\r\n * @param result a file contents\r\n * @param self an event emitter\r\n */\r\nexport type UtilFileOnOpen<RESULT, SELF> = ( result: RESULT, self: SELF ) => void;\r\n\r\n/**\r\n * Mappings of event names and halders.\r\n */\r\nexport interface UtilFileOnOptions<SELF> {\r\n\t/**\r\n\t * Triggered when a file is opened.\r\n\t */\r\n\topen?: UtilFileOnOpen<string, SELF> | UtilFileOnOpen<ArrayBuffer, SELF>;\r\n\r\n\t/**\r\n\t * Triggered when an operation is aborted.\r\n\t *\r\n\t * @param e an event object\r\n\t * @param en event emitter\r\n\t */\r\n\tabort?: ( e: ProgressEvent, self: SELF ) => void;\r\n\r\n\t/**\r\n\t * Triggered when an operation is canceled.\r\n\t *\r\n\t * @param en event emitter\r\n\t */\r\n\tcancel?: ( self: SELF ) => void;\r\n}\r\n\r\nexport class UtilFileOpener {\r\n\tprotected _input: HTMLInputElement | null;\r\n\tprotected _as: UtilFileAs;\r\n\tprotected _facade: UtilFileFacade;\r\n\r\n\tconstructor( as: UtilFileAs, facade: UtilFileFacade ) {\r\n\t\tthis._input = null;\r\n\t\tthis._as = as;\r\n\t\tthis._facade = facade;\r\n\t}\r\n\r\n\topen() {\r\n\t\tconst input = this.getOrCreateInput();\r\n\t\tif( input != null ) {\r\n\t\t\tinput.click();\r\n\t\t} else {\r\n\t\t\tthis.onCancel();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getOrCreateInput(): HTMLInputElement | null {\r\n\t\tif( \"FileReader\" in window && this._input == null ) {\r\n\t\t\tconst input = this._input = document.createElement( \"input\" );\r\n\t\t\tinput.setAttribute( \"type\", \"file\" );\r\n\t\t\tinput.setAttribute( \"style\", \"display:none\" );\r\n\t\t\tinput.addEventListener( \"change\", ( e: Event ): void => {\r\n\t\t\t\tthis.onInputChange( input );\r\n\t\t\t\tinput.value = \"\";\r\n\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t});\r\n\t\t\tdocument.body.appendChild( input );\r\n\t\t}\r\n\t\treturn this._input;\r\n\t}\r\n\r\n\tprotected onInputChange( input: HTMLInputElement ) {\r\n\t\tconst files = input.files;\r\n\t\tif( files != null && 0 < files.length ) {\r\n\t\t\tconst file = files[ 0 ];\r\n\t\t\tconst fileReader = new FileReader();\r\n\t\t\tfileReader.onload = ( e: ProgressEvent ) => {\r\n\t\t\t\tif( e.target != null ) {\r\n\t\t\t\t\tconst target = e.target as any;\r\n\t\t\t\t\tthis.onOpen( target.result );\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tfileReader.onabort = ( e: ProgressEvent ) => {\r\n\t\t\t\tthis.onAboart( e );\r\n\t\t\t};\r\n\t\t\tswitch( this._as ) {\r\n\t\t\tcase UtilFileAs.TEXT:\r\n\t\t\t\tfileReader.readAsText( file );\r\n\t\t\t\tbreak;\r\n\t\t\tcase UtilFileAs.DATA_URL:\r\n\t\t\t\tfileReader.readAsDataURL( file );\r\n\t\t\t\tbreak;\r\n\t\t\tcase UtilFileAs.BINARY_STRING:\r\n\t\t\t\tfileReader.readAsBinaryString( file );\r\n\t\t\t\tbreak;\r\n\t\t\tcase UtilFileAs.ARRAY_BUTTER:\r\n\t\t\t\tfileReader.readAsArrayBuffer( file );\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tfileReader.readAsText( file );\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.onCancel();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onOpen( result: string | ArrayBuffer ): void {\r\n\t\tconst facade = this._facade;\r\n\t\tfacade.emit( \"open\", result, facade );\r\n\t}\r\n\r\n\tprotected onAboart( e: ProgressEvent ): void {\r\n\t\tconst facade = this._facade;\r\n\t\tfacade.emit( \"abort\", e, facade );\r\n\t}\r\n\r\n\tprotected onCancel(): void {\r\n\t\tconst facade = this._facade;\r\n\t\tfacade.emit( \"cancel\", facade );\r\n\t}\r\n}\r\n"]}