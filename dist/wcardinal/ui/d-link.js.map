{"version":3,"file":"d-link.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-link.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, interaction } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DLinkMenuItemId } from \"./d-link-menu-item-id\";\r\nimport { DLinkTarget } from \"./d-link-target\";\r\nimport { DMenu, DMenuOptions } from \"./d-menu\";\r\nimport { Closeable } from \"./d-menu-context\";\r\nimport { DMenuItem } from \"./d-menu-item\";\r\nimport { DMenus } from \"./d-menus\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilClipboard } from \"./util/util-clipboard\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport type DLinkUrlMaker = () => string | null | Promise<string | null>;\r\nexport type DLinkChecker = () => boolean | Promise<boolean>;\r\n\r\nexport interface DLinkOptions {\r\n\turl?: string | DLinkUrlMaker;\r\n\ttarget?: DLinkTarget;\r\n\tchecker?: DLinkChecker;\r\n\tmenu?: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\r\n}\r\n\r\nexport interface DThemeLink {\r\n\tgetLinkMenuOptions(): DMenuOptions<DLinkMenuItemId>;\r\n}\r\n\r\nexport class DLink {\r\n\tprotected _url?: string | DLinkUrlMaker;\r\n\tprotected _target?: DLinkTarget;\r\n\tprotected _checker?: DLinkChecker;\r\n\tprotected _menu?: DMenu<DLinkMenuItemId>;\r\n\tprotected _menuOptions?: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\r\n\tprotected _theme: DThemeLink;\r\n\r\n\tconstructor( theme: DThemeLink, options?: DLinkOptions ) {\r\n\t\tif( options ) {\r\n\t\t\tthis._url = options.url;\r\n\t\t\tthis._target = options.target;\r\n\t\t\tthis._checker = options.checker;\r\n\t\t\tthis._menuOptions = options.menu;\r\n\t\t}\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tget url(): string | null | Promise<string | null> {\r\n\t\tconst url = this._url;\r\n\t\tif( isString( url ) ) {\r\n\t\t\treturn url;\r\n\t\t} else if( url == null ) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\treturn url();\r\n\t\t}\r\n\t}\r\n\r\n\tget target(): DLinkTarget | undefined {\r\n\t\treturn this._target;\r\n\t}\r\n\r\n\tget menu(): DMenu<DLinkMenuItemId> {\r\n\t\tlet menu = this._menu;\r\n\t\tif( menu == null ) {\r\n\t\t\tconst options = this._menuOptions || this._theme.getLinkMenuOptions();\r\n\t\t\tmenu = this.toMenu( options );\r\n\t\t\tthis._menu = menu;\r\n\t\t\tmenu.on( \"select\", (\r\n\t\t\t\tvalue: DLinkMenuItemId,\r\n\t\t\t\titem: DMenuItem<DLinkMenuItemId>,\r\n\t\t\t\tcloseable: Closeable\r\n\t\t\t): void => {\r\n\t\t\t\tthis.onMenuSelect( value, item, closeable );\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn menu;\r\n\t}\r\n\r\n\tprotected toMenu( options: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId> ): DMenu<DLinkMenuItemId> {\r\n\t\tif( options instanceof DisplayObject ) {\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\treturn this.newMenu( options );\r\n\t}\r\n\r\n\tprotected newMenu( options: DMenuOptions<DLinkMenuItemId> ): DMenu<DLinkMenuItemId> {\r\n\t\treturn DMenus.newMenu( options );\r\n\t}\r\n\r\n\tprotected onMenuSelect(\r\n\t\tvalue: DLinkMenuItemId,\r\n\t\titem: DMenuItem<DLinkMenuItemId>,\r\n\t\tcloseable: Closeable\r\n\t): void {\r\n\t\tswitch( value ) {\r\n\t\tcase DLinkMenuItemId.OPEN_LINK_IN_NEW_WINDOW:\r\n\t\t\tthis.open( true );\r\n\t\t\tbreak;\r\n\t\tcase DLinkMenuItemId.COPY_LINK_ADDRESS:\r\n\t\t\tconst url = this.url;\r\n\t\t\tif( url != null ) {\r\n\t\t\t\tif( isString( url ) ) {\r\n\t\t\t\t\tthis.copy( url );\r\n\t\t\t\t} else {\r\n\t\t\t\t\turl.then(( resolved: string | null ): void => {\r\n\t\t\t\t\t\tif( resolved != null ) {\r\n\t\t\t\t\t\t\tthis.copy( resolved );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( url: string ): void {\r\n\t\tconst a = document.createElement( \"a\" );\r\n\t\ta.href = url;\r\n\t\tUtilClipboard.copy( a.href );\r\n\t}\r\n\r\n\tapply( target: DBase, onSelect: ( e: interaction.InteractionEvent ) => void ): void {\r\n\t\tconst onClick = ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( target.isActionable() ) {\r\n\t\t\t\tonSelect( e );\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst onLongClick = ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( target.isActionable() ) {\r\n\t\t\t\tconst menu = this.menu;\r\n\t\t\t\tif( menu.isHidden() ) {\r\n\t\t\t\t\tmenu.open( target );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tif( this._target === DLinkTarget.NEW_WINDOW ) {\r\n\t\t\tUtilPointerEvent.onClick( target, onClick );\r\n\t\t} else {\r\n\t\t\tUtilPointerEvent.onLongClick( target, onClick, onLongClick );\r\n\t\t}\r\n\t}\r\n\r\n\topen( inNewWindow: boolean ): void {\r\n\t\tconst url = this.url;\r\n\t\tif( url != null ) {\r\n\t\t\tif( isString( url )  ) {\r\n\t\t\t\tthis.check( url, inNewWindow );\r\n\t\t\t} else {\r\n\t\t\t\turl.then(( resolved: string | null ): void => {\r\n\t\t\t\t\tif( resolved ) {\r\n\t\t\t\t\t\tthis.check( resolved, inNewWindow );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcheck( url: string, inNewWindow: boolean ): void {\r\n\t\tconst checker = this._checker;\r\n\t\tif( checker ) {\r\n\t\t\tconst checked = checker();\r\n\t\t\tif( checked === true ) {\r\n\t\t\t\tthis.exec( url, inNewWindow );\r\n\t\t\t} else if( checked === false ) {\r\n\t\t\t\t// DO NOTHING\r\n\t\t\t} else {\r\n\t\t\t\tchecked.then(( resolved: boolean ): void => {\r\n\t\t\t\t\tif( resolved ) {\r\n\t\t\t\t\t\tthis.exec( url, inNewWindow );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.exec( url, inNewWindow );\r\n\t\t}\r\n\t}\r\n\r\n\texec( url: string, inNewWindow: boolean ): void {\r\n\t\tif( inNewWindow ) {\r\n\t\t\tconst a = document.createElement( \"a\" );\r\n\t\t\ta.href = url;\r\n\t\t\ta.target = \"_blank\";\r\n\t\t\ta.style.display = \"none\";\r\n\t\t\ta.rel = \"noopener noreferrer\";\r\n\t\t\tdocument.body.appendChild( a );\r\n\t\t\ta.click();\r\n\t\t\tsetTimeout((): void => {\r\n\t\t\t\tdocument.body.removeChild( a );\r\n\t\t\t}, 100);\r\n\t\t} else {\r\n\t\t\twindow.location.href = url;\r\n\t\t}\r\n\t}\r\n\r\n\tinNewWindow( e?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent ): boolean {\r\n\t\tif( this._target === DLinkTarget.NEW_WINDOW ) {\r\n\t\t\treturn true;\r\n\t\t} else if( e != null ) {\r\n\t\t\tconst oe = ( e instanceof interaction.InteractionEvent ? e.data.originalEvent : e );\r\n\t\t\treturn (\r\n\t\t\t\t( oe.ctrlKey || oe.shiftKey || oe.altKey || oe.metaKey ) ||\r\n\t\t\t\t( \"button\" in oe && oe.button !== 0 )\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n}\r\n"]}