{"version":3,"file":"d-input.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-input.ts"],"names":[],"mappings":"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","sourcesContent":["import { interaction } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DHtmlElement, DHtmlElementOptions, DThemeHtmlElement } from \"./d-html-element\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\n\r\nexport interface DInputEditingOptions<VALUE = unknown> {\r\n\tformatter?: ( value: VALUE ) => string;\r\n\tunformatter?: ( text: string ) => VALUE;\r\n\tvalidator?: ( value: VALUE ) => string | null;\r\n}\r\n\r\nexport interface DInputOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeInput = DThemeInput\r\n> extends DHtmlElementOptions<VALUE, HTMLInputElement, THEME> {\r\n\tdescription?: string;\r\n\tediting?: DInputEditingOptions<VALUE>;\r\n}\r\n\r\nexport interface DThemeInput extends DThemeHtmlElement<HTMLInputElement> {\r\n\tgetEditingFormatter(): ( value: any, caller: any ) => string;\r\n\tgetEditingUnformatter(): ( text: string, caller: any ) => any;\r\n\tgetEditingValidator(): ( value: any, caller: any ) => unknown;\r\n}\r\n\r\nexport abstract class DInput<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeInput = DThemeInput,\r\n\tOPTIONS extends DInputOptions<VALUE, THEME> = DInputOptions<VALUE, THEME>\r\n> extends DHtmlElement<VALUE, HTMLInputElement, THEME, OPTIONS> {\r\n\tprotected _description!: string;\r\n\r\n\tprotected _onInputKeyDownBound!: ( e: KeyboardEvent ) => void;\r\n\tprotected _onInputChangeBound!: ( e: Event ) => void;\r\n\tprotected _onInputInputBound!: ( e: Event ) => void;\r\n\r\n\tprotected _editingFormatter!: ( value: VALUE, caller: any ) => string;\r\n\tprotected _editingUnformatter!: ( text: string, caller: any ) => VALUE;\r\n\tprotected _editingValidator!: ( value: VALUE, caller: any ) => unknown;\r\n\tprotected _editingValidationResult!: unknown;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tthis._editingValidationResult = null;\r\n\t\tthis._editingValidator = ( options && options.editing && options.editing.validator ) ||\r\n\t\t\tthis.theme.getEditingValidator();\r\n\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._description = ( options && options.description ) || \"\";\r\n\r\n\t\tthis._editingFormatter = ( options && options.editing && options.editing.formatter ) ||\r\n\t\t\t( options && options.text && options.text.formatter ) ||\r\n\t\t\tthis.theme.getEditingFormatter();\r\n\t\tthis._editingUnformatter = ( options && options.editing && options.editing.unformatter ) ||\r\n\t\t\tthis.theme.getEditingUnformatter();\r\n\r\n\t\tthis._onInputKeyDownBound = ( e: KeyboardEvent ): void => {\r\n\t\t\tthis.onInputKeyDown( e );\r\n\t\t};\r\n\t\tthis._onInputChangeBound = (): void => {\r\n\t\t\tthis.onInputChange();\r\n\t\t};\r\n\t\tthis._onInputInputBound = ( e: Event ): void => {\r\n\t\t\tthis.onInputInput( e );\r\n\t\t};\r\n\t}\r\n\r\n\tget value(): VALUE {\r\n\t\treturn this._textValueComputed;\r\n\t}\r\n\r\n\tset value( value: VALUE ) {\r\n\t\tthis.text = value;\r\n\t}\r\n\r\n\tprotected onTextChange(): void {\r\n\t\tsuper.onTextChange();\r\n\t\tthis.validate();\r\n\t}\r\n\r\n\tvalidate(): unknown {\r\n\t\tconst result = this._editingValidator( this._textValueComputed, this );\r\n\t\tif( this._editingValidationResult !== result ) {\r\n\t\t\tthis._editingValidationResult = result;\r\n\t\t\tthis.setInvalid( result != null );\r\n\t\t\tif( this.isHovered() ) {\r\n\t\t\t\tthis.applyTitle();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected applyTitle(): void {\r\n\t\tconst editingValidationResult = this._editingValidationResult;\r\n\t\tif( isString( editingValidationResult ) ) {\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.view.title = editingValidationResult;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsuper.applyTitle();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onStart(): void {\r\n\t\tsuper.onStart();\r\n\r\n\t\tconst text = this._text;\r\n\t\tif( text != null ) {\r\n\t\t\ttext.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onCancel(): void {\r\n\t\tsuper.onCancel();\r\n\r\n\t\tconst text = this._text;\r\n\t\tif( text != null ) {\r\n\t\t\ttext.visible = true;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onEnd(): void {\r\n\t\tsuper.onEnd();\r\n\t\tthis.onInputChange();\r\n\t}\r\n\r\n\tprotected onElementAttached(\r\n\t\telement: HTMLInputElement, before: HTMLDivElement | null, after: HTMLDivElement | null\r\n\t): void {\r\n\t\tsuper.onElementAttached( element, before, after );\r\n\t\telement.type = this.getInputType();\r\n\t\telement.value = this._editingFormatter( this._textValueComputed, this );\r\n\t\telement.addEventListener( \"keydown\", this._onInputKeyDownBound );\r\n\t\telement.addEventListener( \"change\", this._onInputChangeBound );\r\n\t\telement.addEventListener( \"input\", this._onInputInputBound );\r\n\t}\r\n\r\n\tprotected onElementDetached(\r\n\t\telement: HTMLInputElement, before: HTMLDivElement | null, after: HTMLDivElement | null\r\n\t): void {\r\n\t\tsuper.onElementDetached( element, before, after );\r\n\t\telement.removeEventListener( \"keydown\", this._onInputKeyDownBound );\r\n\t\telement.removeEventListener( \"change\", this._onInputChangeBound );\r\n\t\telement.removeEventListener( \"input\", this._onInputInputBound );\r\n\t}\r\n\r\n\tprotected onInputKeyDown( e: KeyboardEvent ) {\r\n\t\tif( UtilKeyboardEvent.isOkKey( e ) ) {\r\n\t\t\tthis.end();\r\n\t\t\tthis.emit( \"enter\", this );\r\n\t\t} else if( UtilKeyboardEvent.isCancelKey( e ) ) {\r\n\t\t\tthis.cancel();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onInputChange() {\r\n\t\tif( this._isElementShown ) {\r\n\t\t\tconst element = this._element;\r\n\t\t\tif( element != null ) {\r\n\t\t\t\tconst newValue = this.toValue( element.value );\r\n\t\t\t\tconst oldValue = this._textValueComputed;\r\n\t\t\t\tif( oldValue !== newValue ) {\r\n\t\t\t\t\tthis.text = newValue;\r\n\t\t\t\t\tthis.emit( \"change\", newValue, oldValue, this );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onInputInput( e: Event ) {\r\n\t\tif( e.target instanceof HTMLInputElement ) {\r\n\t\t\tthis.emit( \"input\", this.toValue( e.target.value ), this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onDownThis( e: interaction.InteractionEvent ): void {\r\n\t\tif( this.isFocused() ) {\r\n\t\t\tthis.start();\r\n\t\t}\r\n\t\tsuper.onDownThis( e );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DInput\";\r\n\t}\r\n\r\n\tprotected abstract toValue( valueAsString: string ): VALUE;\r\n\tprotected abstract getInputType(): string;\r\n}\r\n"]}