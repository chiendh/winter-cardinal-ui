{"version":3,"file":"d-application.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-application.ts"],"names":[],"mappings":"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","sourcesContent":["import { Container, Renderer } from \"pixi.js\";\r\nimport { DApplicationLayer } from \"./d-application-layer\";\r\nimport { DApplicationLayerOptions } from \"./d-application-layer-options\";\r\nimport { DApplicationLike } from \"./d-application-like\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DPaddingLike } from \"./d-padding\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport interface DApplicationBackgroundOptions {\r\n\tcolor?: number;\r\n}\r\n\r\nexport interface DApplicationOptions {\r\n\t/**\r\n\t * A root element selector or a root element.\r\n\t * `HTMLCanvasElement` and other DOM elements are created in this element.\r\n\t * The default root element is `document.body`.\r\n\t */\r\n\troot?: string | HTMLElement;\r\n\r\n\t/**\r\n\t * Padding settings.\r\n\t */\r\n\tpadding?: number | DPaddingLike;\r\n\r\n\t/**\r\n\t * A canvas width.\r\n\t */\r\n\twidth?: number;\r\n\r\n\t/**\r\n\t * A canvas height.\r\n\t */\r\n\theight?: number;\r\n\r\n\t/**\r\n\t * A background setting.\r\n\t */\r\n\tbackground?: DApplicationBackgroundOptions;\r\n\r\n\t/**\r\n\t * An antialias setting.\r\n\t */\r\n\tantialias?: boolean;\r\n\r\n\t/**\r\n\t * A resolution.\r\n\t * The default value is `devicePixelRatio`.\r\n\t */\r\n\tresolution?: number;\r\n\r\n\t/**\r\n\t * An overlay layer setting.\r\n\t * The overlay layer is used by modal UI elements including DDialog\r\n\t * to provide the better interoperability with DOM-based UI elements\r\n\t * and WebGL-based UI elements.\r\n\t * However, an extra layer requires extra memory.\r\n\t * Set to true to enable the overlay layer.\r\n\t * The default value is false.\r\n\t */\r\n\toverlay?: boolean;\r\n}\r\n\r\nexport class DApplication implements DApplicationLike {\r\n\tprotected _options?: DApplicationOptions;\r\n\tprotected _root: HTMLElement;\r\n\tprotected _base: DApplicationLayer;\r\n\tprotected _overlay?: DApplicationLayer;\r\n\tprotected _resolution: number;\r\n\tprotected _isOverlayEnabled: boolean;\r\n\r\n\tconstructor( options?: DApplicationOptions ) {\r\n\t\tDApplications.add( this );\r\n\r\n\t\t// Root\r\n\t\tthis._root = this.toRootElement( options );\r\n\r\n\t\t// Resolution\r\n\t\tconst resolution = ( options && options.resolution != null ?\r\n\t\t\toptions.resolution : (window.devicePixelRatio || 1)\r\n\t\t);\r\n\t\tthis._resolution = resolution;\r\n\r\n\t\t// Remove the accessibility plugin\r\n\t\tdelete (Renderer as any).__plugins.accessibility;\r\n\r\n\t\t// Options\r\n\t\tthis._options = options;\r\n\r\n\t\t// Base layer\r\n\t\tconst base = this._base = this.newLayerBase( options );\r\n\r\n\t\t// Overlay layer\r\n\t\tthis._isOverlayEnabled = !! ( options && options.overlay );\r\n\t\tif( ! this._isOverlayEnabled ) {\r\n\t\t\tthis._overlay = base;\r\n\t\t}\r\n\t}\r\n\r\n\tget stage(): Container {\r\n\t\treturn this._base.stage;\r\n\t}\r\n\r\n\tgetRootElement(): HTMLElement {\r\n\t\treturn this._root;\r\n\t}\r\n\r\n\tgetResolution(): number {\r\n\t\treturn this._resolution;\r\n\t}\r\n\r\n\tprotected toRootElement( options?: DApplicationOptions ): HTMLElement {\r\n\t\tconst root = options && options.root;\r\n\t\tif( root != null ) {\r\n\t\t\tif( isString( root ) ) {\r\n\t\t\t\tconst found = document.querySelector<HTMLElement>( root );\r\n\t\t\t\tif( found ) {\r\n\t\t\t\t\treturn found;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn root;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn document.body;\r\n\t}\r\n\r\n\tprotected toLayerBaseOptions( options?: DApplicationOptions ): DApplicationLayerOptions {\r\n\t\tconst root = this._root;\r\n\t\tconst resolution = this._resolution;\r\n\t\tif( options ) {\r\n\t\t\treturn new DApplicationLayerOptions({\r\n\t\t\t\troot,\r\n\t\t\t\tpadding: options.padding,\r\n\t\t\t\twidth: options.width,\r\n\t\t\t\theight: options.height,\r\n\t\t\t\tbackground: options.background,\r\n\t\t\t\tresolution,\r\n\t\t\t\tantialias: options.antialias,\r\n\t\t\t\toverlay: false\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn new DApplicationLayerOptions({\r\n\t\t\troot,\r\n\t\t\tresolution,\r\n\t\t\toverlay: false\r\n\t\t});\r\n\t}\r\n\r\n\tprotected newLayerBase( options?: DApplicationOptions ): DApplicationLayer {\r\n\t\treturn new DApplicationLayer( this, this.toLayerBaseOptions( options ) );\r\n\t}\r\n\r\n\tgetLayerBase(): DApplicationLayer {\r\n\t\treturn  this._base;\r\n\t}\r\n\r\n\tprotected toLayerOverlayOptions( options?: DApplicationOptions ): DApplicationLayerOptions {\r\n\t\tconst root = this._root;\r\n\t\tconst resolution = this._resolution;\r\n\t\tif( options ) {\r\n\t\t\treturn new DApplicationLayerOptions({\r\n\t\t\t\troot,\r\n\t\t\t\tpadding: options.padding,\r\n\t\t\t\twidth: options.width,\r\n\t\t\t\theight: options.height,\r\n\t\t\t\tbackground: {\r\n\t\t\t\t\tcolor: null\r\n\t\t\t\t},\r\n\t\t\t\tresolution,\r\n\t\t\t\tantialias: options.antialias,\r\n\t\t\t\toverlay: true\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn new DApplicationLayerOptions({\r\n\t\t\troot,\r\n\t\t\tresolution,\r\n\t\t\toverlay: true\r\n\t\t});\r\n\t}\r\n\r\n\tprotected newLayerOverlay( options?: DApplicationOptions ): DApplicationLayer {\r\n\t\treturn new DApplicationLayer( this, this.toLayerOverlayOptions( options ) );\r\n\t}\r\n\r\n\tgetLayerOverlay(): DApplicationLayer {\r\n\t\tif( this._isOverlayEnabled ) {\r\n\t\t\tif( this._overlay == null ) {\r\n\t\t\t\tthis._overlay = this.newLayerOverlay( this._options );\r\n\t\t\t}\r\n\t\t\treturn this._overlay;\r\n\t\t} else {\r\n\t\t\treturn this._base;\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tif( this._isOverlayEnabled ) {\r\n\t\t\tconst base = this._base;\r\n\t\t\tbase.update();\r\n\r\n\t\t\tconst overlay = this._overlay;\r\n\t\t\tif( overlay ) {\r\n\t\t\t\toverlay.update();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn this._base.update();\r\n\t\t}\r\n\t}\r\n\r\n\trender(): void {\r\n\t\tif( this._isOverlayEnabled ) {\r\n\t\t\tconst base = this._base;\r\n\t\t\tbase.render();\r\n\r\n\t\t\tconst overlay = this._overlay;\r\n\t\t\tif( overlay ) {\r\n\t\t\t\toverlay.render();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn this._base.render();\r\n\t\t}\r\n\t}\r\n}\r\n"]}