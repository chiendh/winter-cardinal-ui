{"version":3,"file":"d-diagram-shape.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-diagram-shape.ts"],"names":[],"mappings":"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","sourcesContent":["import { utils } from \"pixi.js\";\r\nimport { DApplicationTarget } from \"./d-application-like\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DDiagramCanvasIdMap } from \"./d-diagram-canvas-id-map\";\r\nimport { EShape } from \"./shape/e-shape\";\r\n\r\nexport interface DDiagramShapeLayer {\r\n\tchildren: EShape[];\r\n}\r\n\r\nexport interface DDiagramShapeLayerContainer {\r\n\tchildren: DDiagramShapeLayer[];\r\n}\r\n\r\nexport interface DDiagramShapeCanvas {\r\n\tlayer: DDiagramShapeLayerContainer;\r\n\tids: DDiagramCanvasIdMap;\r\n\tactionables: EShape[];\r\n}\r\n\r\nexport interface DDiagramShapeDiagram extends DApplicationTarget {\r\n\tcanvas: DDiagramShapeCanvas | null;\r\n}\r\n\r\n/**\r\n * A shape helper class for diagrams.\r\n */\r\nexport class DDiagramShape extends utils.EventEmitter {\r\n\tprotected _diagram: DDiagramShapeDiagram;\r\n\tprotected _updateBound: () => void;\r\n\r\n\tconstructor( diagram: DDiagramShapeDiagram ) {\r\n\t\tsuper();\r\n\t\tthis._diagram = diagram;\r\n\t\tthis._updateBound = (): void => {\r\n\t\t\tDApplications.update( diagram );\r\n\t\t};\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst diagram = this._diagram;\r\n\t\tconst canvas = diagram.canvas;\r\n\t\tif( canvas ) {\r\n\t\t\tconst actionables = canvas.actionables;\r\n\t\t\tif( 0 < actionables.length ) {\r\n\t\t\t\tlet effect = -1;\r\n\t\t\t\tconst time = Date.now();\r\n\t\t\t\tfor( let i = 0, imax = actionables.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst actionable = actionables[ i ];\r\n\t\t\t\t\tactionable.update( time );\r\n\t\t\t\t\tconst runtime = actionable.runtime;\r\n\t\t\t\t\tif( runtime && time < runtime.effect ) {\r\n\t\t\t\t\t\tconst runtimeEffect = runtime.effect;\r\n\t\t\t\t\t\tif( time < runtimeEffect ) {\r\n\t\t\t\t\t\t\teffect = ( effect < 0 ? runtimeEffect : Math.min( effect, runtimeEffect ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif( 0 <= effect ) {\r\n\t\t\t\t\tsetTimeout( this._updateBound, effect - Date.now() );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget( id: string ): EShape | null {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tconst shapes = ( canvas && canvas.ids[ id ] );\r\n\t\treturn ( shapes && 0 < shapes.length ? shapes[ 0 ] : null );\r\n\t}\r\n\r\n\tgetAll( id: string ): EShape[] {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\treturn ( canvas && canvas.ids[ id ] ) || [];\r\n\t}\r\n\r\n\teach( callback: ( shape: EShape ) => (boolean | void), reverse = false ): EShape | null {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst layers = canvas.layer.children;\r\n\t\t\tif( ! reverse ) {\r\n\t\t\t\tfor( let i = 0, imax = layers.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst layer = layers[ i ];\r\n\t\t\t\t\tconst children = layer.children;\r\n\t\t\t\t\tfor( let j = 0, jmax = children.length; j < jmax; ++j ) {\r\n\t\t\t\t\t\tconst child = children[ j ];\r\n\t\t\t\t\t\tif( callback( child ) === false ) {\r\n\t\t\t\t\t\t\treturn child;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = layers.length - 1; 0 <= i; --i ) {\r\n\t\t\t\t\tconst layer = layers[ i ];\r\n\t\t\t\t\tconst children = layer.children;\r\n\t\t\t\t\tfor( let j = children.length - 1; 0 <= j; --j ) {\r\n\t\t\t\t\t\tconst child = children[ j ];\r\n\t\t\t\t\t\tif( callback( child ) === false ) {\r\n\t\t\t\t\t\t\treturn child;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n"]}