{"version":3,"file":"e-shape-action-runtime-transform-rotate.js","sourceRoot":"","sources":["../../../../../src/main/typescript/wcardinal/ui/shape/action/e-shape-action-runtime-transform-rotate.ts"],"names":[],"mappings":"AAAA;;;GAGG;;AAGH,OAAO,EAAiB,kBAAkB,EAAE,MAAM,oBAAoB,CAAC;AAEvE,OAAO,EAAE,8BAA8B,EAAE,MAAM,sCAAsC,CAAC;AAGtF,IAAM,aAAa,GAAG,cAAc,OAAA,CAAC,EAAD,CAAC,CAAC;AAEtC;IAAwD,sDAA8B;IAKrF,4CAAa,KAAuC,EAAE,KAAyB;QAA/E,YACC,kBAAO,KAAK,EAAE,KAAK,CAAE,SAIrB;QAHA,KAAI,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;QAC7B,KAAI,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;QAC7B,KAAI,CAAC,MAAM,GAAG,KAAI,CAAC,YAAY,CAAE,MAAI,KAAK,CAAC,MAAM,wBAAqB,EAAE,aAAa,EAAE,GAAG,CAAE,CAAC;;IAC9F,CAAC;IAES,2DAAc,GAAxB,UACC,KAAa,EAAE,OAAsB,EACrC,WAAmB,EAAE,WAAmB,EACxC,OAAe,EAAE,OAAe;QAEhC,IAAM,YAAY,GAAG,CAAE,CAAC,OAAO,CAAC,OAAO,GAAG,kBAAkB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAE,CAAC;QAC5E,IAAM,aAAa,GAAG,CAAE,CAAC,OAAO,CAAC,OAAO,GAAG,kBAAkB,CAAC,MAAM,CAAC,KAAK,CAAC,CAAE,CAAC;QAC9E,IAAM,EAAE,GAAG,CAAC,CAAC,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAC7E,IAAM,EAAE,GAAG,CAAC,CAAC,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAC9E,IAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,CAAE,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,CAAE,CAAC;QAC5D,IAAM,CAAC,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,CAAE,GAAG,IAAI,CAAC,GAAG,CAAE,WAAW,CAAE,CAAC;QAC5D,IAAM,QAAQ,GAAG,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC;QAC1C,IAAM,gBAAgB,GAAG,CAAE,CAAC,OAAO,CAAC,OAAO,GAAG,kBAAkB,CAAC,UAAU,CAAC,KAAK,CAAC,CAAE,CAAC;QACrF,IAAM,gBAAgB,GAAG,CAAE,CAAC,OAAO,CAAC,OAAO,GAAG,kBAAkB,CAAC,UAAU,CAAC,KAAK,CAAC,CAAE,CAAC;QACrF,IAAM,YAAY,GAAG,CAAE,gBAAgB,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAE,CAAC;QACnE,IAAM,YAAY,GAAG,CAAE,gBAAgB,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAE,CAAC;QACnE,OAAO,CAAC,OAAO,IAAI,kBAAkB,CAAC,QAAQ,CAAC;QAC/C,QAAQ,CAAC,GAAG,CACX,YAAY,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,EAC9B,YAAY,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAC9B,CAAC;IACH,CAAC;IACF,yCAAC;AAAD,CAAC,AAlCD,CAAwD,8BAA8B,GAkCrF","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueTransformRotate } from \"./e-shape-action-value-transform-rotate\";\r\n\r\nconst amountDefault = (): number => 0;\r\n\r\nexport class EShapeActionRuntimeTransformRotate extends EShapeActionRuntimeConditional {\r\n\tprotected originY: number;\r\n\tprotected originX: number;\r\n\tprotected readonly amount: EShapeActionExpression<number>;\r\n\r\n\tconstructor( value: EShapeActionValueTransformRotate, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( value, reset );\r\n\t\tthis.originX = value.originX;\r\n\t\tthis.originY = value.originY;\r\n\t\tthis.amount = this.toExpression( `(${value.amount}) * (Math.PI / 180)`, amountDefault, \"0\" );\r\n\t}\r\n\r\n\tprotected adjustPosition(\r\n\t\tshape: EShape, runtime: EShapeRuntime,\r\n\t\toldRotation: number, newRotation: number,\r\n\t\toriginX: number, originY: number\r\n\t): void {\r\n\t\tconst writtenWidth = ( (runtime.written & EShapeRuntimeReset.WIDTH) !== 0 );\r\n\t\tconst writtenHeight = ( (runtime.written & EShapeRuntimeReset.HEIGHT) !== 0 );\r\n\t\tconst dx = (-0.5 + originX) * (writtenWidth ? shape.size.x : runtime.size.x);\r\n\t\tconst dy = (-0.5 + originY) * (writtenHeight ? shape.size.y : runtime.size.y);\r\n\t\tconst s = Math.sin( oldRotation ) - Math.sin( newRotation );\r\n\t\tconst c = Math.cos( oldRotation ) - Math.cos( newRotation );\r\n\t\tconst position = shape.transform.position;\r\n\t\tconst writtenPositionX = ( (runtime.written & EShapeRuntimeReset.POSITION_X) !== 0 );\r\n\t\tconst writtenPositionY = ( (runtime.written & EShapeRuntimeReset.POSITION_Y) !== 0 );\r\n\t\tconst oldPositionX = ( writtenPositionX ? position.x : runtime.x );\r\n\t\tconst oldPositionY = ( writtenPositionY ? position.y : runtime.y );\r\n\t\truntime.written |= EShapeRuntimeReset.POSITION;\r\n\t\tposition.set(\r\n\t\t\toldPositionX + dx * c - dy * s,\r\n\t\t\toldPositionY + dx * s + dy * c\r\n\t\t);\r\n\t}\r\n}\r\n"]}