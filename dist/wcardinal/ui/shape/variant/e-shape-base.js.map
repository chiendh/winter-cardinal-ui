{"version":3,"file":"e-shape-base.js","sourceRoot":"","sources":["../../../../../src/main/typescript/wcardinal/ui/shape/variant/e-shape-base.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, IPoint, Matrix, Point, Rectangle, Texture, Transform, utils } from \"pixi.js\";\r\nimport { DApplications } from \"../../d-applications\";\r\nimport { DBaseState } from \"../../d-base-state\";\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeAction } from \"../action/e-shape-action\";\r\nimport { EShape, EShapeCopyPart } from \"../e-shape\";\r\nimport { EShapeContainer } from \"../e-shape-container\";\r\nimport { EShapeCorner } from \"../e-shape-corner\";\r\nimport { EShapeEditor } from \"../e-shape-editor\";\r\nimport { EShapeFill } from \"../e-shape-fill\";\r\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\r\nimport { EShapeLayout } from \"../e-shape-layout\";\r\nimport { EShapePoints } from \"../e-shape-points\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeRuntime, EShapeRuntimeState } from \"../e-shape-runtime\";\r\nimport { EShapeStroke } from \"../e-shape-stroke\";\r\nimport { EShapeTag } from \"../e-shape-tag\";\r\nimport { EShapeText } from \"../e-shape-text\";\r\nimport { EShapeTransform, EShapeTransformImpl } from \"../e-shape-transform\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploaded } from \"../e-shape-uploaded\";\r\nimport { EShapeGradients } from \"./e-shape-gradients\";\r\n\r\nexport abstract class EShapeBase extends utils.EventEmitter implements EShape {\r\n\tprotected static WORK_RECT = new Rectangle();\r\n\tid: string;\r\n\treadonly type: EShapeType;\r\n\tabstract readonly size: IPoint;\r\n\tabstract readonly fill: EShapeFill;\r\n\tabstract readonly stroke: EShapeStroke;\r\n\treadonly transform: EShapeTransform;\r\n\tabstract radius: number;\r\n\tabstract corner: EShapeCorner;\r\n\tpoints?: EShapePoints;\r\n\timage?: HTMLImageElement;\r\n\timageSrc?: string;\r\n\ttexture?: Texture;\r\n\tabstract gradient?: EShapeGradientLike;\r\n\tabstract readonly text: EShapeText;\r\n\tabstract readonly tag: EShapeTag;\r\n\treadonly action: EShapeAction;\r\n\tabstract cursor: string;\r\n\tinteractive: boolean;\r\n\tshortcut?: string;\r\n\ttitle?: string;\r\n\tprotected _visible: boolean;\r\n\tprotected _onTransformChangeLock: number;\r\n\tprotected _isOnTransformChanged: boolean;\r\n\tprotected _uploadedUpdateLock: number;\r\n\tprotected _isUploadedUpdated: boolean;\r\n\tprotected _isUploadedUpdatedRecursively: boolean;\r\n\r\n\tprotected _bounds?: Rectangle;\r\n\tprotected _boundsTransformId: number;\r\n\tprotected _boundsInternal?: Rectangle;\r\n\tprotected _boundsInternalTransformId: number;\r\n\tprotected _boundsLocal?: Rectangle;\r\n\tprotected _boundsLocalTransformId: number;\r\n\r\n\tprotected _state: DBaseState;\r\n\tprotected _stateLocal: DBaseState;\r\n\r\n\t// Hierarchy\r\n\tparent: EShapeContainer | EShape | null;\r\n\tchildren: EShape[];\r\n\tlayout?: EShapeLayout;\r\n\r\n\t// Working space\r\n\tindex: number; // A work space for sorting.\r\n\tselected: boolean;\r\n\treference: number; // Count of references from commands\r\n\r\n\t// Working space for the viewer\r\n\truntime?: EShapeRuntime;\r\n\r\n\t// Working space for the editor\r\n\teditor?: EShapeEditor;\r\n\r\n\t// Working space for the renderer\r\n\tuploaded?: EShapeUploaded;\r\n\r\n\tconstructor( type: EShapeType ) {\r\n\t\tsuper();\r\n\t\tthis.id = \"\";\r\n\t\tthis.type = type;\r\n\t\tthis.transform = this.newTransform();\r\n\t\tthis._onTransformChangeLock = 0;\r\n\t\tthis._isOnTransformChanged = false;\r\n\t\tthis.action = new EShapeAction();\r\n\t\tthis._visible = true;\r\n\t\tthis._uploadedUpdateLock = 0;\r\n\t\tthis._isUploadedUpdated = false;\r\n\t\tthis._isUploadedUpdatedRecursively = false;\r\n\r\n\t\tthis._boundsTransformId = NaN;\r\n\t\tthis._boundsInternalTransformId = NaN;\r\n\t\tthis._boundsLocalTransformId = NaN;\r\n\r\n\t\tthis._state = this._stateLocal = DBaseState.UNFOCUSABLE;\r\n\t\tthis.interactive = false;\r\n\r\n\t\t//\r\n\t\tthis.parent = null;\r\n\t\tthis.children = [];\r\n\r\n\t\t//\r\n\t\tthis.selected = false;\r\n\t\tthis.index = 0;\r\n\t\tthis.reference = 0;\r\n\t}\r\n\r\n\tprotected newTransform(): EShapeTransform {\r\n\t\treturn new EShapeTransformImpl( this );\r\n\t}\r\n\r\n\tonSizeChange(): void {\r\n\t\tthis._boundsTransformId = NaN;\r\n\t\tthis._boundsInternalTransformId = NaN;\r\n\t\tthis._boundsLocalTransformId = NaN;\r\n\r\n\t\tthis.onTransformChange_();\r\n\t\tthis.updateUploaded();\r\n\t}\r\n\r\n\tonTransformChange(): void {\r\n\t\tthis.onTransformChange_();\r\n\t\tthis.updateUploadedRecursively();\r\n\t}\r\n\r\n\tprotected onTransformChange_(): void {\r\n\t\tif( this._onTransformChangeLock === 0 ) {\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.onChildTransformChange();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._isOnTransformChanged = true;\r\n\t\t}\r\n\t}\r\n\r\n\tdisallowOnTransformChange(): void {\r\n\t\tthis._onTransformChangeLock += 1;\r\n\t\tif( this._onTransformChangeLock === 1 ) {\r\n\t\t\tthis._isOnTransformChanged = false;\r\n\t\t}\r\n\t}\r\n\r\n\tallowOnTransformChange( invokeOnTransformChange: boolean ): void {\r\n\t\tthis._onTransformChangeLock -= 1;\r\n\t\tif( this._onTransformChangeLock === 0 ) {\r\n\t\t\tif( this._isOnTransformChanged ) {\r\n\t\t\t\tthis._isOnTransformChanged = false;\r\n\t\t\t\tif( invokeOnTransformChange ) {\r\n\t\t\t\t\tthis.onTransformChange();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonChildTransformChange(): void {\r\n\t\t//\r\n\t}\r\n\r\n\tdisallowUploadedUpdate(): void {\r\n\t\tthis._uploadedUpdateLock += 1;\r\n\t\tif( this._uploadedUpdateLock === 1 ) {\r\n\t\t\tthis._isUploadedUpdated = false;\r\n\t\t\tthis._isUploadedUpdatedRecursively = false;\r\n\t\t}\r\n\t}\r\n\r\n\tallowUploadedUpdate(): void {\r\n\t\tthis._uploadedUpdateLock -= 1;\r\n\t\tif( this._uploadedUpdateLock === 0 ) {\r\n\t\t\tif( this._isUploadedUpdatedRecursively ) {\r\n\t\t\t\tthis._isUploadedUpdatedRecursively = false;\r\n\t\t\t\tthis._isUploadedUpdated = false;\r\n\t\t\t\tthis.updateUploadedRecursively();\r\n\t\t\t} else if( this._isUploadedUpdated ) {\r\n\t\t\t\tthis._isUploadedUpdated = false;\r\n\t\t\t\tthis.updateUploaded();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateUploadedRecursively(): void {\r\n\t\tif( this._uploadedUpdateLock === 0 ) {\r\n\t\t\tthis.updateUploaded();\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tchildren[ i ].updateUploadedRecursively();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._isUploadedUpdatedRecursively = true;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateUploaded(): void {\r\n\t\tif( this._uploadedUpdateLock === 0 ) {\r\n\t\t\tconst uploaded = this.uploaded;\r\n\t\t\tif( uploaded != null ) {\r\n\t\t\t\tuploaded.update( this );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._isUploadedUpdated = true;\r\n\t\t}\r\n\t}\r\n\r\n\t//\r\n\tget root(): EShape {\r\n\t\tlet root: EShape = this;\r\n\t\twhile( root.parent instanceof EShapeBase ) {\r\n\t\t\troot = root.parent;\r\n\t\t}\r\n\t\treturn root;\r\n\t}\r\n\r\n\t//\r\n\tget visible(): boolean {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent instanceof EShapeBase ) {\r\n\t\t\treturn parent.visible && this._visible;\r\n\t\t} else {\r\n\t\t\treturn this._visible;\r\n\t\t}\r\n\t}\r\n\r\n\tset visible( visible: boolean ) {\r\n\t\tif( this._visible !== visible ) {\r\n\t\t\tthis._visible = visible;\r\n\t\t\tthis.updateUploadedRecursively();\r\n\t\t}\r\n\t}\r\n\r\n\t//\r\n\tabstract clone(): EShape;\r\n\r\n\t//\r\n\ttoDirty() {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent != null ) {\r\n\t\t\tparent.toDirty();\r\n\t\t}\r\n\t}\r\n\r\n\t// Hierarchy\r\n\tattach( parent: EShapeContainer | EShape, at?: number ): this {\r\n\t\tthis.detach();\r\n\t\tthis.parent = parent;\r\n\t\tconst children = parent.children;\r\n\t\tif( at != null && 0 <= at && at < children.length ) {\r\n\t\t\tchildren.splice( at, 0, this );\r\n\t\t} else {\r\n\t\t\tchildren.push( this );\r\n\t\t}\r\n\t\tthis.uploaded = undefined;\r\n\t\tparent.onChildTransformChange();\r\n\t\tparent.toDirty();\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdetach(): this {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent != null ) {\r\n\t\t\tthis.parent = null;\r\n\t\t\tthis.uploaded = undefined;\r\n\t\t\tconst children = parent.children;\r\n\t\t\tconst index = children.indexOf( this );\r\n\t\t\tif( 0 <= index ) {\r\n\t\t\t\tchildren.splice( index, 1 );\r\n\t\t\t\tparent.onChildTransformChange();\r\n\t\t\t\tparent.toDirty();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// Transform\r\n\tupdateTransform() {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent ) {\r\n\t\t\tif( parent.parent ) {\r\n\t\t\t\tparent.updateTransform();\r\n\t\t\t}\r\n\t\t\tthis.transform.updateTransform(parent.transform);\r\n\t\t} else {\r\n\t\t\tthis.transform.updateTransform((Transform as any).IDENTITY);\r\n\t\t}\r\n\t}\r\n\r\n\t// Serialization\r\n\tserializeChildren( manager: EShapeResourceManagerSerialization ): DDiagramSerializedItem[] {\r\n\t\tconst children = this.children;\r\n\t\tconst childrenSerialized = [];\r\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\r\n\t\t\tconst child = children[i];\r\n\t\t\tchildrenSerialized.push(child.serialize(manager));\r\n\t\t}\r\n\t\treturn childrenSerialized;\r\n\t}\r\n\r\n\tserializeImage( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst image = this.image;\r\n\t\treturn (image != null ? manager.add( image.src ) : -1);\r\n\t}\r\n\r\n\tserializeGradient( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn EShapeGradients.toGradientId( this.gradient, manager );\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): DDiagramSerializedItem {\r\n\t\tconst transform = this.transform;\r\n\t\tconst position = transform.position;\r\n\t\tconst pivot = transform.pivot;\r\n\t\tconst size = this.size;\r\n\t\tconst shortcut = this.shortcut;\r\n\t\tconst shortcutId = ( shortcut != null ? manager.add( shortcut ) : -1 );\r\n\t\tconst title = this.title;\r\n\t\tconst titleId = ( title != null ? manager.add( title ) : -1 );\r\n\t\treturn [\r\n\t\t\tthis.type,\r\n\t\t\tmanager.add(this.id),\r\n\t\t\tposition.x,\r\n\t\t\tposition.y,\r\n\t\t\tsize.x,\r\n\t\t\tsize.y,\r\n\t\t\ttransform.rotation,\r\n\t\t\ttransform.skew.x,\r\n\t\t\tthis.fill.serialize( manager ),\r\n\t\t\tthis.stroke.serialize( manager ),\r\n\t\t\tmanager.add( this.cursor.trim() ),\r\n\t\t\tthis.text.serialize( manager ),\r\n\t\t\tthis.tag.serialize( manager ),\r\n\t\t\tthis.radius,\r\n\t\t\tthis.corner,\r\n\t\t\t-1,\r\n\t\t\t-1,\r\n\t\t\tthis.action.serialize( manager ),\r\n\t\t\tthis.serializeImage( manager ),\r\n\t\t\tthis.serializeGradient( manager ),\r\n\t\t\tthis.serializeChildren( manager ),\r\n\t\t\tpivot.x,\r\n\t\t\tpivot.y,\r\n\t\t\t( this.interactive ? 1 : 0 ) | ( this.unfocusable ? 2 : 0 ),\r\n\t\t\tshortcutId,\r\n\t\t\ttitleId\r\n\t\t];\r\n\t}\r\n\r\n\t// Hit test\r\n\ttoLocalRect( point: IPoint, result: Rectangle ): Rectangle {\r\n\t\tconst x = point.x;\r\n\t\tconst y = point.y;\r\n\t\tconst size = this.size;\r\n\t\tconst sx = 0.5 * size.x;\r\n\t\tconst sy = 0.5 * size.y;\r\n\t\tconst pivot = this.transform.pivot;\r\n\t\tconst dx = x - pivot.x;\r\n\t\tconst dy = y - pivot.y;\r\n\t\tconst stroke = this.stroke;\r\n\t\tconst s = stroke.width * stroke.align;\r\n\t\tif( 0 <= sx ) {\r\n\t\t\tif( 0 <= sy ) {\r\n\t\t\t\tresult.x = +dx;\r\n\t\t\t\tresult.y = +dy;\r\n\t\t\t\tresult.width = +sx + s;\r\n\t\t\t\tresult.height = +sy + s;\r\n\t\t\t} else {\r\n\t\t\t\tresult.x = +dx;\r\n\t\t\t\tresult.y = -dy;\r\n\t\t\t\tresult.width = +sx + s;\r\n\t\t\t\tresult.height = -sy + s;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( 0 <= sy ) {\r\n\t\t\t\tresult.x = -dx;\r\n\t\t\t\tresult.y = +dy;\r\n\t\t\t\tresult.width = -sx + s;\r\n\t\t\t\tresult.height = +sy + s;\r\n\t\t\t} else {\r\n\t\t\t\tresult.x = -dx;\r\n\t\t\t\tresult.y = -dy;\r\n\t\t\t\tresult.width = -sx + s;\r\n\t\t\t\tresult.height = -sy + s;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcontains( point: Point ): EShape | null {\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\tif( this.containsAbs( rect.x, rect.y, rect.width, rect.height ) ) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tconst x = point.x;\r\n\t\tconst y = point.y;\r\n\t\treturn this.containsText( x, y, point ) || this.containsChildren( x, y, point );\r\n\t}\r\n\r\n\tprotected containsText( x: number, y: number, work: Point ): EShape | null {\r\n\t\tconst text = this.text;\r\n\t\tconst textAtlas = text.atlas;\r\n\t\tif( textAtlas != null ) {\r\n\t\t\tconst textWorld = text.world;\r\n\t\t\tif( textWorld != null ) {\r\n\t\t\t\twork.set( x, y );\r\n\t\t\t\tthis.transform.internalTransform.apply( work, work );\r\n\t\t\t\tconst tx = work.x - textWorld[ 0 ];\r\n\t\t\t\tconst ty = work.y - textWorld[ 1 ];\r\n\t\t\t\tconst th = textWorld[ 2 ] * tx + textWorld[ 3 ] * ty;\r\n\t\t\t\tconst tv = textWorld[ 4 ] * tx + textWorld[ 5 ] * ty;\r\n\t\t\t\tif( 0 <= th && th <= textWorld[ 6 ] && 0 <= tv && tv <= textWorld[ 7 ] ) {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected containsChildren( x: number, y: number, work: Point ): EShape | null {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\twork.set( x, y );\r\n\t\t\tchild.updateTransform();\r\n\t\t\tchild.transform.localTransform.applyInverse( work, work );\r\n\t\t\tconst childResult = child.contains( work );\r\n\t\t\tif( childResult != null ) {\r\n\t\t\t\tif( this.shadowed ) {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn childResult;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcontainsBBox( point: IPoint ): boolean {\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\treturn this.containsAbsBBox( rect.x, rect.y, rect.width, rect.height );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\treturn this.containsAbsBBox( x, y, ax, ay );\r\n\t}\r\n\r\n\tcontainsAbsBBox( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\treturn (-ax <= x && x <= +ax && -ay <= y && y <= +ay);\r\n\t}\r\n\r\n\tselect( point: Point ): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t//\r\n\ttoGlobal( position: IPoint, result: Point, skipUpdate?: boolean ): Point {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tresult.copyFrom( position );\r\n\t\tthis.transform.worldTransform.apply( result, result );\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttoLocal( position: IPoint, from?: DisplayObject, result?: Point, skipUpdate?: boolean ): Point {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tif( result === undefined ) {\r\n\t\t\tresult = new Point();\r\n\t\t}\r\n\t\tresult.copyFrom( position );\r\n\t\tthis.transform.worldTransform.applyInverse( result, result );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetBounds( work: Point, skipUpdate: boolean, result: Rectangle ): Rectangle {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tconst bounds = this._bounds = ( this._bounds || new Rectangle() );\r\n\t\tconst worldId = this.transform.getWorldId();\r\n\t\tif( worldId !== this._boundsTransformId ) {\r\n\t\t\tthis._boundsTransformId = worldId;\r\n\t\t\tthis.getBounds_( this.transform.worldTransform, work, bounds );\r\n\t\t}\r\n\t\tresult.copyFrom( bounds );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetBoundsInternal( work: Point, skipUpdate: boolean, result: Rectangle ): Rectangle {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tconst boundsInternal = this._boundsInternal = ( this._boundsInternal || new Rectangle() );\r\n\t\tconst currentLocalId = this.transform.getLocalIdCurrent();\r\n\t\tif( currentLocalId !== this._boundsInternalTransformId ) {\r\n\t\t\tthis._boundsInternalTransformId = currentLocalId;\r\n\t\t\tthis.getBounds_( this.transform.internalTransform, work, boundsInternal );\r\n\t\t}\r\n\t\tresult.copyFrom( boundsInternal );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetBoundsLocal( work: Point, skipUpdate: boolean, result: Rectangle ): Rectangle {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tconst boundsLocal = this._boundsLocal = ( this._boundsLocal || new Rectangle() );\r\n\t\tconst currentLocalId = this.transform.getLocalIdCurrent();\r\n\t\tif( currentLocalId !== this._boundsLocalTransformId ) {\r\n\t\t\tthis._boundsLocalTransformId = currentLocalId;\r\n\t\t\tthis.getBounds_( this.transform.localTransform, work, boundsLocal );\r\n\t\t}\r\n\t\tresult.copyFrom( boundsLocal );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getBoundsSize(): IPoint {\r\n\t\treturn this.size;\r\n\t}\r\n\r\n\tprotected getBounds_( transform: Matrix, work: Point, result: Rectangle ): Rectangle {\r\n\t\tconst pivot = this.transform.pivot;\r\n\t\tconst px = pivot.x;\r\n\t\tconst py = pivot.y;\r\n\t\tconst size = this.getBoundsSize();\r\n\t\tconst sx = 0.5 * size.x;\r\n\t\tconst sy = 0.5 * size.y;\r\n\r\n\t\tconst a = transform.a;\r\n\t\tconst b = transform.b;\r\n\t\tconst c = transform.c;\r\n\t\tconst d = transform.d;\r\n\r\n\t\tlet x = -sx + px;\r\n\t\tlet y = -sy + py;\r\n\t\tconst x0 = a * x + c * y;\r\n\t\tconst y0 = b * x + d * y;\r\n\r\n\t\tx = +sx + px;\r\n\t\ty = -sy + py;\r\n\t\tconst x1 = a * x + c * y;\r\n\t\tconst y1 = b * x + d * y;\r\n\r\n\t\tx = -sx + px;\r\n\t\ty = +sy + py;\r\n\t\tconst x2 = a * x + c * y;\r\n\t\tconst y2 = b * x + d * y;\r\n\r\n\t\tx = +sx + px;\r\n\t\ty = +sy + py;\r\n\t\tconst x3 = a * x + c * y;\r\n\t\tconst y3 = b * x + d * y;\r\n\r\n\t\tconst xmin = Math.min( x0, x1, x2, x3 );\r\n\t\tconst ymin = Math.min( y0, y1, y2, y3 );\r\n\t\tconst xmax = Math.max( x0, x1, x2, x3 );\r\n\t\tconst ymax = Math.max( y0, y1, y2, y3 );\r\n\t\tresult.x = xmin + transform.tx;\r\n\t\tresult.y = ymin + transform.ty;\r\n\t\tresult.width = xmax - xmin;\r\n\t\tresult.height = ymax - ymin;\r\n\t\treturn result;\r\n\t}\r\n\r\n\t//\r\n\tdestroy(): void {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tchildren[ i ].destroy();\r\n\t\t}\r\n\t\tchildren.length = 0;\r\n\t}\r\n\r\n\t//\r\n\tprotected updateState(): void {\r\n\t\tconst parent = this.parent;\r\n\t\tconst stateLocal = this._stateLocal;\r\n\t\tconst newState = ( parent instanceof EShapeBase ?\r\n\t\t\tthis.mergeState( stateLocal, parent.getState() ) :\r\n\t\t\tstateLocal\r\n\t\t);\r\n\t\tconst oldState = this._state;\r\n\t\tif( oldState !== newState ) {\r\n\t\t\tthis._state = newState;\r\n\t\t\tthis.onStateChange( newState, oldState );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn stateLocal | (stateParent & DBaseState.DISABLED) |\r\n\t\t\t(stateParent & (DBaseState.FOCUSED | DBaseState.FOCUSED_IN) ? DBaseState.FOCUSED_IN : DBaseState.NONE);\r\n\t}\r\n\r\n\tprotected onStateChange( newState: number, oldState: number ) {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\truntime.onStateChange( this, newState, oldState );\r\n\t\t}\r\n\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof EShapeBase ) {\r\n\t\t\t\tchild.onParentStateChange( newState, oldState );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onParentStateChange( newStateParent: number, oldStateParent: number ) {\r\n\t\tconst newState = this.mergeState( this._stateLocal, newStateParent );\r\n\t\tconst oldState = this._state;\r\n\t\tif( oldState !== newState ) {\r\n\t\t\tthis._state = newState;\r\n\t\t\tthis.onStateChange( newState, oldState );\r\n\t\t}\r\n\t}\r\n\r\n\tgetState(): DBaseState {\r\n\t\treturn this._state;\r\n\t}\r\n\r\n\tsetState( state: DBaseState, isOn: boolean ): this {\r\n\t\tif( (!! ( this._stateLocal & state )) !== isOn ) {\r\n\t\t\tif( isOn ) {\r\n\t\t\t\tthis._stateLocal |= state;\r\n\t\t\t} else {\r\n\t\t\t\tthis._stateLocal &= ~state;\r\n\t\t\t}\r\n\t\t\tthis.updateState();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\thasState( state: DBaseState ): boolean {\r\n\t\treturn !! ( this._state & state );\r\n\t}\r\n\r\n\tfocus(): this {\r\n\t\tthis.focused = true;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tblur(): this {\r\n\t\tthis.focused = false;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tget hovered(): boolean {\r\n\t\treturn this.hasState( DBaseState.HOVERED );\r\n\t}\r\n\r\n\tset hovered( isHovered: boolean ) {\r\n\t\tthis.setState( DBaseState.HOVERED, isHovered );\r\n\t}\r\n\r\n\tget active(): boolean {\r\n\t\treturn this.hasState( DBaseState.ACTIVE );\r\n\t}\r\n\r\n\tset active( isActive: boolean ) {\r\n\t\tthis.setState( DBaseState.ACTIVE, isActive );\r\n\t}\r\n\r\n\tget readonly(): boolean {\r\n\t\treturn this.hasState( DBaseState.READ_ONLY );\r\n\t}\r\n\r\n\tset readonly( isReadOnly: boolean ) {\r\n\t\tthis.setState( DBaseState.READ_ONLY, isReadOnly );\r\n\t}\r\n\r\n\tget enabled(): boolean {\r\n\t\treturn ! this.hasState( DBaseState.DISABLED );\r\n\t}\r\n\r\n\tget disabled(): boolean {\r\n\t\treturn this.hasState( DBaseState.DISABLED );\r\n\t}\r\n\r\n\tset disabled( isDisabled: boolean ) {\r\n\t\tthis.setState( DBaseState.DISABLED, isDisabled );\r\n\t}\r\n\r\n\tget dragging(): boolean {\r\n\t\treturn this.hasState( DBaseState.DRAGGING );\r\n\t}\r\n\r\n\tset dragging( isDragging: boolean ) {\r\n\t\tthis.setState( DBaseState.DRAGGING, isDragging );\r\n\t}\r\n\r\n\tget focused(): boolean {\r\n\t\treturn this.hasState( DBaseState.FOCUSED );\r\n\t}\r\n\r\n\tset focused( focused: boolean ) {\r\n\t\tif( this.focused !== focused ) {\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.getFocusController().setFocused( this, focused, false );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget focusedin(): boolean {\r\n\t\treturn this.hasState( DBaseState.FOCUSED | DBaseState.FOCUSED_IN );\r\n\t}\r\n\r\n\tget unfocusable(): boolean {\r\n\t\treturn this.hasState( DBaseState.UNFOCUSABLE );\r\n\t}\r\n\r\n\tset unfocusable( unforcusable: boolean ) {\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, unforcusable );\r\n\t}\r\n\r\n\tget clicked(): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\treturn !! ( runtime && (runtime.state & EShapeRuntimeState.CLICKED) );\r\n\t}\r\n\r\n\tget pressed(): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\treturn !! ( runtime && (runtime.state & EShapeRuntimeState.PRESSED) );\r\n\t}\r\n\r\n\tget down(): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\treturn !! ( runtime && (runtime.state & EShapeRuntimeState.DOWN) );\r\n\t}\r\n\r\n\tget up(): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\treturn !! ( runtime && (runtime.state & EShapeRuntimeState.UP) );\r\n\t}\r\n\r\n\tget shadowed(): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonDblClick( e: MouseEvent ): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\treturn runtime.onPointerDblClick( this );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonShortcut( e: KeyboardEvent ): void {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\treturn runtime.onPointerClick( this );\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\treturn runtime.onKeyDown( this, e );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonKeyUp( e: KeyboardEvent ): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\treturn runtime.onKeyUp( this, e );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t//\r\n\tupdate( time: number ): void {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\truntime.update( this, time );\r\n\t\t}\r\n\t}\r\n\r\n\tupdateRecursively( time: number ): void {\r\n\t\tthis.update( time );\r\n\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].update( time );\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( source: EShape, part: EShapeCopyPart = EShapeCopyPart.ALL ): this {\r\n\t\tthis.id = source.id;\r\n\t\tif( (part & EShapeCopyPart.TRANSFORM) !== 0 ) {\r\n\t\t\tconst transform = this.transform;\r\n\t\t\tconst sourceTransform = source.transform;\r\n\t\t\ttransform.position.copyFrom( sourceTransform.position );\r\n\t\t\ttransform.rotation = sourceTransform.rotation;\r\n\t\t\ttransform.skew.copyFrom( sourceTransform.skew );\r\n\t\t\ttransform.pivot.copyFrom( sourceTransform.pivot );\r\n\t\t\ttransform.scale.copyFrom( sourceTransform.scale );\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.SIZE) !== 0 ) {\r\n\t\t\tthis.size.copyFrom( source.size );\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.STYLE) !== 0 ) {\r\n\t\t\tthis.fill.copy( source.fill );\r\n\t\t\tthis.stroke.copy( source.stroke );\r\n\t\t\tthis.tag.copy( source.tag );\r\n\t\t\tthis.text.copy( source.text );\r\n\t\t\tthis.radius = source.radius;\r\n\t\t\tthis.corner = source.corner;\r\n\t\t\tif (this.image == null) {\r\n\t\t\t\tthis.image = source.image;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.ACTION) !== 0 ) {\r\n\t\t\tthis.action.addAll( source.action.values );\r\n\t\t\tthis.interactive = source.interactive;\r\n\t\t\tthis.cursor = source.cursor;\r\n\t\t\tthis.shortcut = source.shortcut;\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.POINTS) !== 0 ) {\r\n\t\t\tconst sourcePoints = source.points;\r\n\t\t\tif( sourcePoints != null ) {\r\n\t\t\t\tconst points = this.points;\r\n\t\t\t\tif( points != null ) {\r\n\t\t\t\t\tpoints.copy( sourcePoints );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.points = sourcePoints.clone( this );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.STATE) !== 0 ) {\r\n\t\t\tthis.setState( source.getState(), true );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n}\r\n"]}