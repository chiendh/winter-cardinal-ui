{"version":3,"file":"d-animation-base.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-animation-base.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DAnimation, DAnimationOnEnd, DAnimationOnTime, DAnimationOptions, DAnimationTiming } from \"./d-animation\";\r\nimport { DAnimationTimings } from \"./d-animation-timings\";\r\n\r\nexport class DAnimationBase<TARGET = unknown> extends utils.EventEmitter implements DAnimation<TARGET> {\r\n\tprotected _id: number | null;\r\n\tprotected _startTime: number;\r\n\tprotected _duration: number;\r\n\tprotected _durationInverse: number;\r\n\tprotected _reverse: boolean;\r\n\tprotected _onTime: DAnimationOnTime<TARGET> | undefined;\r\n\tprotected _onTimeBaseBound: () => void;\r\n\tprotected _onStart: DAnimationOnEnd<TARGET> | undefined;\r\n\tprotected _onEnd: DAnimationOnEnd<TARGET> | undefined;\r\n\tprotected _timing: DAnimationTiming<TARGET>;\r\n\tprotected _target: TARGET | null;\r\n\r\n\tconstructor( options?: DAnimationOptions<TARGET> ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._id = null;\r\n\t\tthis._target = (options && options.target != null ? options.target : null);\r\n\t\tthis._startTime = 0;\r\n\t\tthis._duration = ( options != null && options.duration != null ? options.duration : 200 );\r\n\t\tthis._durationInverse = 1 / Math.max( 1, this._duration );\r\n\t\tthis._reverse = false;\r\n\t\tthis._onTime = ( options != null ? options.onTime : undefined );\r\n\t\tthis._onTimeBaseBound = () => {\r\n\t\t\tthis.onTimeBase();\r\n\t\t};\r\n\t\tthis._onStart = ( options != null ? options.onStart : undefined );\r\n\t\tthis._onEnd = ( options != null ? options.onEnd : undefined );\r\n\t\tthis._timing = ( options != null && options.timing != null ? options.timing : DAnimationTimings.ELASTIC );\r\n\r\n\t\t// Events\r\n\t\tconst on = options && options.on;\r\n\t\tif( on ) {\r\n\t\t\tfor( const name in on ) {\r\n\t\t\t\tconst handler = on[ name ];\r\n\t\t\t\tif( handler ) {\r\n\t\t\t\t\tthis.on( name, handler );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget target(): TARGET | null {\r\n\t\treturn this._target;\r\n\t}\r\n\r\n\tset target( target: TARGET | null ) {\r\n\t\tthis._target = target;\r\n\t}\r\n\r\n\tget duration(): number {\r\n\t\treturn this._duration;\r\n\t}\r\n\r\n\tset duration( duration: number ) {\r\n\t\tthis._duration = duration;\r\n\t\tthis._durationInverse = 1 / Math.max( 1, duration );\r\n\t}\r\n\r\n\tstart( reverse: boolean = false ): void {\r\n\t\tthis.stop();\r\n\t\tthis._startTime = Date.now();\r\n\t\tthis._reverse = reverse;\r\n\t\tthis._id = window.setTimeout( this._onTimeBaseBound, 0 );\r\n\r\n\t\t// onStart\r\n\t\tthis.onStart( reverse );\r\n\r\n\t\t// onTime\r\n\t\tconst duration = this._duration;\r\n\t\tconst time = this.toTime( reverse ? duration : 0 );\r\n\t\tthis.onTime( time, reverse, 0 );\r\n\t}\r\n\r\n\tprotected onStart( isReverse: boolean ): void {\r\n\t\tconst onStart = this._onStart;\r\n\t\tif( onStart != null ) {\r\n\t\t\tonStart( isReverse, this );\r\n\t\t}\r\n\t\tthis.emit( \"start\", isReverse, this );\r\n\t}\r\n\r\n\tprotected onTime( time: number, isReverse: boolean, elapsedTime: number ): void {\r\n\t\tconst onTime = this._onTime;\r\n\t\tif( onTime != null ) {\r\n\t\t\tonTime( time, isReverse, elapsedTime, this );\r\n\t\t}\r\n\t\tthis.emit( \"time\", time, isReverse, elapsedTime, this );\r\n\t}\r\n\r\n\tprotected onEnd( isReverse: boolean ): void {\r\n\t\tconst onEnd = this._onEnd;\r\n\t\tif( onEnd != null ) {\r\n\t\t\tonEnd( isReverse, this );\r\n\t\t}\r\n\t\tthis.emit( \"end\", isReverse, this );\r\n\t}\r\n\r\n\tisStarted(): boolean {\r\n\t\treturn (this._id != null);\r\n\t}\r\n\r\n\tisReverse(): boolean {\r\n\t\treturn this._reverse;\r\n\t}\r\n\r\n\tprotected onTimeBase(): void {\r\n\t\tconst id = this._id;\r\n\t\tif( id != null ) {\r\n\t\t\tthis._id = null;\r\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\r\n\t\t\tconst duration = this._duration;\r\n\t\t\tconst reverse = this._reverse;\r\n\t\t\tif( elapsedTime < duration ) {\r\n\t\t\t\tthis._id = window.setTimeout( this._onTimeBaseBound, 0 );\r\n\r\n\t\t\t\t// OnTime\r\n\t\t\t\tconst time = this.toTime( reverse ? duration - elapsedTime : elapsedTime );\r\n\t\t\t\tthis.onTime( time, reverse, elapsedTime );\r\n\t\t\t} else {\r\n\t\t\t\t// OnTime\r\n\t\t\t\tconst time = this.toTime( reverse ? 0 : duration );\r\n\t\t\t\tthis.onTime( time, reverse, elapsedTime );\r\n\r\n\t\t\t\t// OnEnd\r\n\t\t\t\tthis.onEnd( reverse );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toTime( elapsedTime: number ): number {\r\n\t\treturn this._timing( elapsedTime * this._durationInverse, this );\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tconst id = this._id;\r\n\t\tif( id != null ) {\r\n\t\t\tthis._id = null;\r\n\t\t\twindow.clearTimeout( id );\r\n\t\t}\r\n\t}\r\n\r\n\tend(): void {\r\n\t\tconst id = this._id;\r\n\t\tif( id != null ) {\r\n\t\t\tthis._id = null;\r\n\t\t\twindow.clearTimeout( id );\r\n\r\n\t\t\t// OnTime\r\n\t\t\tconst reverse = this._reverse;\r\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\r\n\t\t\tconst duration = this._duration;\r\n\t\t\tconst time = this.toTime( reverse ? 0 : duration );\r\n\t\t\tthis.onTime( time, reverse, elapsedTime );\r\n\r\n\t\t\t// OnEnd\r\n\t\t\tthis.onEnd( reverse );\r\n\t\t}\r\n\t}\r\n}\r\n"]}