{"version":3,"file":"d-controller-keyboard.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-controller-keyboard.ts"],"names":[],"mappings":"AAAA;;;GAGG;;AAEH,OAAO,EAAa,KAAK,EAAE,MAAM,SAAS,CAAC;AAC3C,OAAO,EAAE,UAAU,EAAE,MAAM,gBAAgB,CAAC;AAE5C,OAAO,EAAE,iBAAiB,EAAE,MAAM,4BAA4B,CAAC;AAE/D;IAAyC,uCAAkB;IAA3D;;IA2DA,CAAC;IA1DA,kCAAI,GAAJ,UAAM,OAAoB,EAAE,KAAgB,EAAE,eAAiC;QAA/E,iBAiDC;QAhDA,OAAO,CAAC,gBAAgB,CAAE,SAAS,EAAE,UAAE,CAAgB;YACtD,KAAI,CAAC,IAAI,CAAE,SAAS,EAAE,CAAC,CAAE,CAAC;YAE1B,IAAM,OAAO,GAAG,eAAe,CAAC,UAAU,EAAE,CAAC;YAC7C,IAAI,OAAO,IAAI,IAAI,EAAG;gBACrB,IAAI,OAAO,GAA4C,OAAO,CAAC;gBAC/D,OAAO,OAAO,IAAI,IAAI,EAAG;oBACxB,IAAI,KAAI,CAAC,YAAY,CAAE,OAAO,CAAE,EAAG;wBAClC,IAAI,OAAO,CAAC,SAAS,CAAE,CAAC,CAAE,EAAG;4BAC5B,OAAO;yBACP;qBACD;oBACD,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC;iBACzB;aACD;YAED,IAAI,iBAAiB,CAAC,UAAU,CAAE,CAAC,CAAE,EAAG;gBACvC,IAAM,SAAS,GAAG,iBAAiB,CAAC,iBAAiB,CAAE,CAAC,CAAE,CAAC;gBAC3D,IAAM,IAAI,GAAG,CAAE,OAAO,IAAI,IAAI,CAAC,CAAC;oBAC/B,eAAe,CAAC,aAAa,CAC5B,OAAO,EAAE,KAAK,EAAE,OAAO,CAAC,QAAQ,CAAE,UAAU,CAAC,UAAU,CAAE,IAAI,SAAS,EAAE,SAAS,CACjF,CAAC,CAAC;oBACH,eAAe,CAAC,aAAa,CAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,SAAS,CAAE,CAC9D,CAAC;gBACF,IAAI,IAAI,IAAI,IAAI,EAAG;oBAClB,eAAe,CAAC,UAAU,CAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAE,CAAC;oBAC/C,CAAC,CAAC,cAAc,EAAE,CAAC;oBACnB,CAAC,CAAC,wBAAwB,EAAE,CAAC;iBAC7B;aACD;QACF,CAAC,CAAC,CAAC;QAEH,OAAO,CAAC,gBAAgB,CAAE,OAAO,EAAE,UAAE,CAAgB;YACpD,KAAI,CAAC,IAAI,CAAE,OAAO,EAAE,CAAC,CAAE,CAAC;YAExB,IAAM,OAAO,GAAG,eAAe,CAAC,UAAU,EAAE,CAAC;YAC7C,IAAI,OAAO,IAAI,IAAI,EAAG;gBACrB,IAAI,OAAO,GAA4C,OAAO,CAAC;gBAC/D,OAAO,OAAO,IAAI,IAAI,EAAG;oBACxB,IAAI,KAAI,CAAC,UAAU,CAAE,OAAO,CAAE,EAAG;wBAChC,IAAI,OAAO,CAAC,OAAO,CAAE,CAAC,CAAE,EAAG;4BAC1B,OAAO;yBACP;qBACD;oBACD,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC;iBACzB;aACD;QACF,CAAC,CAAC,CAAC;IACJ,CAAC;IAES,0CAAY,GAAtB,UAAwB,MAAW;QAClC,OAAO,WAAW,IAAI,MAAM,CAAC;IAC9B,CAAC;IAES,wCAAU,GAApB,UAAsB,MAAW;QAChC,OAAO,SAAS,IAAI,MAAM,CAAC;IAC5B,CAAC;IACF,0BAAC;AAAD,CAAC,AA3DD,CAAyC,KAAK,CAAC,YAAY,GA2D1D","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, utils } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DControllerFocus, DFocusable, DFocusableContainer } from \"./d-controller-focus\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\n\r\nexport class DControllerKeyboard extends utils.EventEmitter {\r\n\tinit( element: HTMLElement, stage: Container, focusController: DControllerFocus ) {\r\n\t\telement.addEventListener( \"keydown\", ( e: KeyboardEvent ): void => {\r\n\t\t\tthis.emit( \"keydown\", e );\r\n\r\n\t\t\tconst focused = focusController.getFocused();\r\n\t\t\tif( focused != null ) {\r\n\t\t\t\tlet current: DFocusable | DFocusableContainer | null = focused;\r\n\t\t\t\twhile( current != null ) {\r\n\t\t\t\t\tif( this.hasOnKeyDown( current ) ) {\r\n\t\t\t\t\t\tif( current.onKeyDown( e ) ) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrent = current.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif( UtilKeyboardEvent.isFocusKey( e ) ) {\r\n\t\t\t\tconst direction = UtilKeyboardEvent.getFocusDirection( e );\r\n\t\t\t\tconst next = ( focused != null ?\r\n\t\t\t\t\tfocusController.findFocusable(\r\n\t\t\t\t\t\tfocused, false, focused.hasState( DBaseState.FOCUS_ROOT ) || direction, direction\r\n\t\t\t\t\t) :\r\n\t\t\t\t\tfocusController.findFocusable( stage, false, true, direction )\r\n\t\t\t\t);\r\n\t\t\t\tif( next != null ) {\r\n\t\t\t\t\tfocusController.setFocused( next, true, true );\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\telement.addEventListener( \"keyup\", ( e: KeyboardEvent ): void => {\r\n\t\t\tthis.emit( \"keyup\", e );\r\n\r\n\t\t\tconst focused = focusController.getFocused();\r\n\t\t\tif( focused != null ) {\r\n\t\t\t\tlet current: DFocusable | DFocusableContainer | null = focused;\r\n\t\t\t\twhile( current != null ) {\r\n\t\t\t\t\tif( this.hasOnKeyUp( current ) ) {\r\n\t\t\t\t\t\tif( current.onKeyUp( e ) ) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrent = current.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected hasOnKeyDown( target: any ): target is { onKeyDown( e: KeyboardEvent ): boolean; } {\r\n\t\treturn \"onKeyDown\" in target;\r\n\t}\r\n\r\n\tprotected hasOnKeyUp( target: any ): target is { onKeyUp( e: KeyboardEvent ): boolean; } {\r\n\t\treturn \"onKeyUp\" in target;\r\n\t}\r\n}\r\n"]}