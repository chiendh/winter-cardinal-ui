{"version":3,"file":"d-diagram-canvas-editor.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-diagram-canvas-editor.ts"],"names":[],"mappings":"AAAA;;;GAGG;;AAEH,OAAO,EAAE,QAAQ,EAAE,MAAM,SAAS,CAAC;AACnC,OAAO,EAAE,aAAa,EAAE,MAAM,kBAAkB,CAAC;AAEjD,OAAO,EAAE,kBAAkB,EAAsD,MAAM,yBAAyB,CAAC;AACjH,OAAO,EAAE,8BAA8B,EAAE,MAAM,sCAAsC,CAAC;AACtF,OAAO,EAA8C,yBAAyB,EAAE,MAAM,wBAAwB,CAAC;AAC/G,OAAO,EAAE,kCAAkC,EAAE,MAAM,gDAAgD,CAAC;AAEpG,OAAO,EAAE,uBAAuB,EAAE,MAAM,kCAAkC,CAAC;AAC3E,OAAO,EAAE,QAAQ,EAAE,MAAM,kBAAkB,CAAC;AAiB5C;IAGU,wCAAkC;IAI3C,8BAAa,OAAgB;QAA7B,YACC,kBAAO,OAAO,CAAE,SAoBhB;QAlBA,KAAI,CAAC,WAAW,GAAG,IAAI,8BAA8B,CACpD,KAAI,CAAC,WAAW,EAChB,KAAI,CAAC,qBAAqB,CAAE,KAAI,CAAC,KAAK,EAAE,OAAO,CAAE,CACjD,CAAC;QAEF,KAAI,CAAC,MAAM,GAAG,KAAI,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC;QAEzC,IAAM,eAAe,GAAG,IAAI,QAAQ,EAAE,CAAC;QACvC,eAAe,CAAC,OAAO,GAAG,KAAK,CAAC;QAChC,KAAI,CAAC,UAAU,CAAE,eAAe,EAAE,KAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAE,CAAC;QAC7D,KAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;QAExC,IAAM,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;QAChC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAE,QAAQ,EAAE;YAC5B,KAAI,CAAC,OAAO,EAAE,CAAC;YACf,aAAa,CAAC,MAAM,CAAE,KAAI,CAAE,CAAC;QAC9B,CAAC,CAAC,CAAC;QACH,KAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;;IACzB,CAAC;IAES,oDAAqB,GAA/B,UAAiC,KAAY,EAAE,OAAgB;QAC9D,IAAM,UAAU,GAAG,OAAO,CAAC,UAAU,CAAC;QACtC,IAAM,cAAc,GAAG,UAAU,IAAI,UAAU,CAAC,IAAI,CAAC;QACrD,OAAO,CAAE,cAAc,IAAI,IAAI,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,KAAK,CAAC,iBAAiB,EAAE,CAAE,CAAC;IAChF,CAAC;IAED,wCAAS,GAAT,UAAW,EAAsB;QAChC,IAAM,OAAO,GAAG,IAAI,kCAAkC,EAAE,CAAC;QACzD,IAAM,KAAK,GAA6B,EAAE,CAAC;QAC3C,IAAM,UAAU,GAAG,IAAI,CAAC,WAAW,CAAC;QACpC,IAAM,eAAe,GAAG,UAAU,CAAC,KAAK,CAAC;QACzC,IAAM,eAAe,GAAG,UAAU,CAAC,KAAK,CAAC;QACzC,OAAO;YACN,OAAO,EAAE,yBAAyB;YAClC,EAAE,IAAA;YACF,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,MAAM,EAAE,IAAI,CAAC,MAAM;YACnB,UAAU,EAAE;gBACX,KAAK,EAAE,QAAQ,CAAE,eAAe,CAAE,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,QAAQ;gBAC/D,KAAK,EAAE,QAAQ,CAAE,eAAe,CAAE,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;aACxD;YACD,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE;YAC5B,SAAS,EAAE,OAAO,CAAC,SAAS,EAAE;YAC9B,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,SAAS,CAAE,OAAO,EAAE,KAAK,CAAE;YAC/C,KAAK,OAAA;YACL,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE;SAC/B,CAAC;IACH,CAAC;IAED,uCAAQ,GAAR;QACC,iBAAM,QAAQ,WAAE,CAAC;QAEjB,IAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC;QAC9C,IAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;QACpC,IAAI,MAAM,CAAC,OAAO,EAAG;YACpB,IAAM,WAAW,GAAG,QAAQ,CAAC;YAC7B,IAAM,WAAW,GAAG,CAAC,CAAC;YACtB,IAAM,WAAW,GAAG,GAAG,CAAC;YACxB,IAAM,KAAK,GAAG,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;YAC/B,IAAM,MAAM,GAAG,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC;YACjC,IAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;YAC7B,eAAe,CAAC,KAAK,EAAE,CAAC;YACxB,eAAe,CAAC,SAAS,CAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;YACxC,eAAe,CAAC,SAAS,CAAE,WAAW,EAAE,WAAW,CAAE,CAAC;YACtD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,IAAI,EAAE,EAAE,CAAC,EAAG;gBACrD,IAAM,KAAK,GAAG,MAAM,CAAE,CAAC,CAAE,CAAC;gBAC1B,IAAI,KAAK,CAAC,IAAI,KAAK,uBAAuB,CAAC,QAAQ,EAAG;oBACrD,eAAe,CAAC,QAAQ,CAAE,KAAK,CAAC,QAAQ,EAAE,CAAC,EAAE,WAAW,EAAE,MAAM,CAAE,CAAC;iBACnE;qBAAM;oBACN,eAAe,CAAC,QAAQ,CAAE,CAAC,EAAE,KAAK,CAAC,QAAQ,EAAE,KAAK,EAAE,WAAW,CAAE,CAAC;iBAClE;aACD;YACD,eAAe,CAAC,OAAO,EAAE,CAAC;YAC1B,eAAe,CAAC,OAAO,GAAG,IAAI,CAAC;SAC/B;aAAM;YACN,eAAe,CAAC,OAAO,GAAG,KAAK,CAAC;SAChC;IACF,CAAC;IAES,sCAAO,GAAjB;QACC,OAAO,sBAAsB,CAAC;IAC/B,CAAC;IACF,2BAAC;AAAD,CAAC,AA7FD,CAGU,kBAAkB,GA0F3B","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Graphics } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBaseBackgroundOptions } from \"./d-base\";\r\nimport { DDiagramCanvasBase, DDiagramCanvasBaseOptions, DThemeDiagramCanvasBase } from \"./d-diagram-canvas-base\";\r\nimport { DDiagramCanvasEditorBackground } from \"./d-diagram-canvas-editor-background\";\r\nimport { DDiagramSerialized, DDiagramSerializedItem, DDiagramSerializedVersion } from \"./d-diagram-serialized\";\r\nimport { EShapeResourceManagerSerialization } from \"./shape/e-shape-resource-manager-serialization\";\r\nimport { ESnapper } from \"./snapper/e-snapper\";\r\nimport { ESnapperTargetValueType } from \"./snapper/e-snapper-target-value\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\nexport interface DDiagramCanvasEditorBackgroundOptions extends DBaseBackgroundOptions {\r\n\tbase?: number | null;\r\n}\r\n\r\nexport interface DDiagramCanvasEditorOptions<\r\n\tTHEME extends DThemeDiagramCanvasEditor = DThemeDiagramCanvasEditor\r\n> extends DDiagramCanvasBaseOptions<THEME> {\r\n\tsnapper: ESnapper;\r\n\tbackground?: DDiagramCanvasEditorBackgroundOptions;\r\n}\r\n\r\nexport interface DThemeDiagramCanvasEditor extends DThemeDiagramCanvasBase {\r\n\tgetBackgroundBase(): number | null;\r\n}\r\n\r\nexport class DDiagramCanvasEditor<\r\n\tTHEME extends DThemeDiagramCanvasEditor = DThemeDiagramCanvasEditor,\r\n\tOPTIONS extends DDiagramCanvasEditorOptions<THEME> = DDiagramCanvasEditorOptions<THEME>\r\n> extends DDiagramCanvasBase<THEME, OPTIONS> {\r\n\tprotected _snapper: ESnapper;\r\n\tprotected _snapperGraphics: Graphics;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\r\n\t\tthis._background = new DDiagramCanvasEditorBackground(\r\n\t\t\tthis._background,\r\n\t\t\tthis.toBackgroundColorBase( this.theme, options )\r\n\t\t);\r\n\r\n\t\tthis.shadow = this.theme.newShadowWeak();\r\n\r\n\t\tconst snapperGraphics = new Graphics();\r\n\t\tsnapperGraphics.visible = false;\r\n\t\tthis.addChildAt( snapperGraphics, this.children.length - 1 );\r\n\t\tthis._snapperGraphics = snapperGraphics;\r\n\r\n\t\tconst snapper = options.snapper;\r\n\t\tsnapper.target.on( \"change\", (): void => {\r\n\t\t\tthis.toDirty();\r\n\t\t\tDApplications.update( this );\r\n\t\t});\r\n\t\tthis._snapper = snapper;\r\n\t}\r\n\r\n\tprotected toBackgroundColorBase( theme: THEME, options: OPTIONS ): number | null {\r\n\t\tconst background = options.background;\r\n\t\tconst backgroundBase = background && background.base;\r\n\t\treturn ( backgroundBase != null ? backgroundBase : theme.getBackgroundBase() );\r\n\t}\r\n\r\n\tserialize( id: number | undefined ): DDiagramSerialized {\r\n\t\tconst manager = new EShapeResourceManagerSerialization();\r\n\t\tconst items: DDiagramSerializedItem[] = [];\r\n\t\tconst background = this._background;\r\n\t\tconst backgroundColor = background.color;\r\n\t\tconst backgroundAlpha = background.alpha;\r\n\t\treturn {\r\n\t\t\tversion: DDiagramSerializedVersion,\r\n\t\t\tid,\r\n\t\t\tname: this.name,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\tbackground: {\r\n\t\t\t\tcolor: isNumber( backgroundColor ) ? backgroundColor : 0xffffff,\r\n\t\t\t\talpha: isNumber( backgroundAlpha ) ? backgroundAlpha : 0\r\n\t\t\t},\r\n\t\t\ttile: this._tile.serialize(),\r\n\t\t\tresources: manager.serialize(),\r\n\t\t\tlayers: this._layer.serialize( manager, items ),\r\n\t\t\titems,\r\n\t\t\tsnap: this._snapper.serialize()\r\n\t\t};\r\n\t}\r\n\r\n\tonReflow(): void {\r\n\t\tsuper.onReflow();\r\n\r\n\t\tconst snapperGraphics = this._snapperGraphics;\r\n\t\tconst target = this._snapper.target;\r\n\t\tif( target.visible ) {\r\n\t\t\tconst borderColor = 0x1e87f0;\r\n\t\t\tconst borderWidth = 1;\r\n\t\t\tconst borderAlpha = 0.5;\r\n\t\t\tconst width = this.width + 0.5;\r\n\t\t\tconst height = this.height + 0.5;\r\n\t\t\tconst values = target.values;\r\n\t\t\tsnapperGraphics.clear();\r\n\t\t\tsnapperGraphics.lineStyle( 0, 0, 0, 0 );\r\n\t\t\tsnapperGraphics.beginFill( borderColor, borderAlpha );\r\n\t\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\t\tconst value = values[ i ];\r\n\t\t\t\tif( value.type === ESnapperTargetValueType.VERTICAL ) {\r\n\t\t\t\t\tsnapperGraphics.drawRect( value.position, 0, borderWidth, height );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsnapperGraphics.drawRect( 0, value.position, width, borderWidth );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsnapperGraphics.endFill();\r\n\t\t\tsnapperGraphics.visible = true;\r\n\t\t} else {\r\n\t\t\tsnapperGraphics.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDiagramCanvasEditor\";\r\n\t}\r\n}\r\n"]}