{"version":3,"file":"d-picker-color-gradient-data.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-picker-color-gradient-data.ts"],"names":[],"mappings":"AAAA;;;GAGG;;AAEH,OAAO,EAAE,KAAK,EAAE,MAAM,SAAS,CAAC;AAChC,OAAO,EAAE,yBAAyB,EAAiC,MAAM,iCAAiC,CAAC;AAE3G,IAAM,YAAY,GAAG,UAAE,CAA4B,EAAE,CAA4B;IAChF,OAAO,CAAC,CAAC,QAAQ,GAAG,CAAC,CAAC,QAAQ,CAAC;AAChC,CAAC,CAAC;AAOF;IAA8C,4CAAkB;IAQ/D;QAAA,YACC,iBAAO,SAYP;QAVA,KAAI,CAAC,cAAc,GAAG,UAAE,MAAiC;YACxD,KAAI,CAAC,QAAQ,CAAE,MAAM,CAAE,CAAC;QACzB,CAAC,CAAC;QAEF,IAAM,KAAK,GAAG,IAAI,yBAAyB,CAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,KAAI,CAAC,cAAc,CAAE,CAAC;QAC1F,IAAM,MAAM,GAAG,IAAI,yBAAyB,CAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,KAAI,CAAC,cAAc,CAAE,CAAC;QAC1F,KAAI,CAAC,OAAO,GAAG,CAAE,KAAK,EAAE,MAAM,CAAE,CAAC;QACjC,KAAI,CAAC,UAAU,GAAG,CAAC,EAAE,CAAC;QACtB,KAAI,CAAC,SAAS,GAAG,MAAM,CAAC;QACxB,KAAI,CAAC,UAAU,GAAG,CAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAE,CAAC;;IAC/B,CAAC;IAES,2CAAQ,GAAlB,UAAoB,MAAiC;QACpD,IAAM,kBAAkB,GAAG,CAAE,MAAM,CAAC,QAAQ,IAAI,IAAI,CAAC,SAAS,KAAK,MAAM,CAAE,CAAC;QAC5E,IAAI,kBAAkB,EAAG;YACxB,IAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;YAChC,IAAI,QAAQ,IAAI,IAAI,EAAG;gBACrB,QAAgB,CAAC,SAAS,GAAG,KAAK,CAAC;aACpC;YACD,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC;SACxB;QACD,IAAI,CAAC,OAAO,CAAC,IAAI,CAAE,YAAY,CAAE,CAAC;QAClC,IAAI,kBAAkB,EAAG;YACxB,IAAI,CAAC,IAAI,CAAE,iBAAiB,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAE,CAAC;SACrD;QACD,IAAI,CAAC,IAAI,CAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;IAC7B,CAAC;IAED,sBAAI,4CAAM;aAAV;YACC,OAAO,IAAI,CAAC,OAAO,CAAC;QACrB,CAAC;;;OAAA;IAED,sBAAI,+CAAS;aAAb;YACC,OAAO,IAAI,CAAC,UAAU,CAAC;QACxB,CAAC;aAED,UAAe,SAAiB;YAC/B,IAAI,IAAI,CAAC,UAAU,KAAK,SAAS,EAAG;gBACnC,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;gBAC5B,IAAI,CAAC,IAAI,CAAE,iBAAiB,EAAE,SAAS,EAAE,IAAI,CAAE,CAAC;gBAChD,IAAI,CAAC,IAAI,CAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;aAC5B;QACF,CAAC;;;OARA;IAUD,sBAAI,8CAAQ;aAAZ;YACC,OAAO,IAAI,CAAC,SAAS,CAAC;QACvB,CAAC;;;OAAA;IAED,uCAAI,GAAJ;QACC,OAAO,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;IAC5B,CAAC;IAED,sCAAG,GAAH,UAAK,KAAa;QACjB,IAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,IAAI,CAAC,IAAI,KAAK,IAAI,KAAK,GAAG,MAAM,CAAC,MAAM,EAAG;YACzC,OAAO,MAAM,CAAE,KAAK,CAAE,CAAC;SACvB;QACD,OAAO,IAAI,CAAC;IACb,CAAC;IAED,wCAAK,GAAL,UAAO,QAAgB;QACtB,IAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,IAAI,QAAQ,GAAqC,IAAI,CAAC;QACtD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,IAAI,EAAE,EAAE,CAAC,EAAG;YACrD,IAAM,KAAK,GAAG,MAAM,CAAE,CAAC,CAAE,CAAC;YAC1B,IAAI,QAAQ,IAAI,KAAK,CAAC,QAAQ,EAAG;gBAChC,IAAI,QAAQ,IAAI,IAAI,EAAG;oBACtB,IAAM,IAAI,GAAG,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;oBAChD,IAAI,KAAK,GAAG,IAAI,EAAG;wBAClB,IAAM,IAAI,GAAG,KAAK,CAAC,OAAO,CAAE,KAAK,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAE,CAAC;wBAC3D,IAAM,EAAE,GAAG,IAAI,CAAE,CAAC,CAAE,CAAC;wBACrB,IAAM,EAAE,GAAG,IAAI,CAAE,CAAC,CAAE,CAAC;wBACrB,IAAM,EAAE,GAAG,IAAI,CAAE,CAAC,CAAE,CAAC;wBAErB,IAAM,IAAI,GAAG,KAAK,CAAC,OAAO,CAAE,QAAQ,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAE,CAAC;wBAC9D,IAAM,EAAE,GAAG,IAAI,CAAE,CAAC,CAAE,CAAC;wBACrB,IAAM,EAAE,GAAG,IAAI,CAAE,CAAC,CAAE,CAAC;wBACrB,IAAM,EAAE,GAAG,IAAI,CAAE,CAAC,CAAE,CAAC;wBAErB,IAAM,KAAK,GAAG,CAAC,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC;wBACpD,IAAM,CAAC,GAAG,EAAE,GAAG,KAAK,GAAG,EAAE,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;wBACxC,IAAM,CAAC,GAAG,EAAE,GAAG,KAAK,GAAG,EAAE,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;wBACxC,IAAM,CAAC,GAAG,EAAE,GAAG,KAAK,GAAG,EAAE,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;wBAExC,IAAM,GAAG,GAAG,IAAI,CAAC,UAAU,CAAC;wBAC5B,GAAG,CAAE,CAAC,CAAE,GAAG,CAAC,CAAC;wBACb,GAAG,CAAE,CAAC,CAAE,GAAG,CAAC,CAAC;wBACb,GAAG,CAAE,CAAC,CAAE,GAAG,CAAC,CAAC;wBAEb,IAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAE,GAAG,CAAE,CAAC;wBACnC,IAAM,KAAK,GAAG,KAAK,CAAC,KAAK,GAAG,KAAK,GAAG,QAAQ,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;wBACjE,OAAO,IAAI,CAAC,GAAG,CAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;qBAChD;iBACD;qBAAM;oBACN,OAAO,IAAI,CAAC,GAAG,CAAE,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;iBAC5D;aACD;YACD,QAAQ,GAAG,KAAK,CAAC;SACjB;QACD,IAAI,QAAQ,IAAI,IAAI,EAAG;YACtB,OAAO,IAAI,CAAC,GAAG,CAAE,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;SAClE;aAAM;YACN,OAAO,IAAI,CAAC,GAAG,CAAE,QAAQ,EAAE,GAAG,EAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;SACjD;IACF,CAAC;IAED,sCAAG,GAAH,UAAK,KAAa,EAAE,KAAa,EAAE,QAAgB,EAAE,QAAiB;QACrE,IAAM,MAAM,GAAG,IAAI,yBAAyB,CAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,IAAI,CAAC,cAAc,CAAE,CAAC;QACtG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAE,MAAM,CAAE,CAAC;QAC5B,IAAI,CAAC,cAAc,CAAE,MAAM,CAAE,CAAC;QAC9B,OAAO,MAAM,CAAC;IACf,CAAC;IAED,yCAAM,GAAN,UAAQ,KAAgC;QACvC,IAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,EAAG;YACvB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,IAAI,EAAE,EAAE,CAAC,EAAG;gBACrD,IAAI,MAAM,CAAE,CAAC,CAAE,KAAK,KAAK,EAAG;oBAC3B,MAAM,CAAC,MAAM,CAAE,CAAC,EAAE,CAAC,CAAE,CAAC;oBACtB,IAAM,kBAAkB,GAAG,CAAE,IAAI,CAAC,SAAS,KAAK,KAAK,CAAE,CAAC;oBACxD,IAAI,kBAAkB,EAAG;wBACxB,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,EAAG;4BAClB,IAAI,CAAC,SAAS,GAAG,MAAM,CAAE,CAAC,CAAE,CAAC;yBAC7B;6BAAM;4BACN,IAAI,CAAC,SAAS,GAAG,MAAM,CAAE,CAAC,GAAG,CAAC,CAAE,CAAC;yBACjC;qBACD;oBACD,IAAI,kBAAkB,EAAG;wBACxB,IAAI,CAAC,IAAI,CAAE,iBAAiB,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAE,CAAC;qBACrD;oBACD,IAAI,CAAC,IAAI,CAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;oBAC5B,OAAO,IAAI,CAAC;iBACZ;aACD;SACD;QACD,OAAO,KAAK,CAAC;IACd,CAAC;IAED,wCAAK,GAAL;QACC,IAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC;QACrC,IAAI,CAAC,UAAU,GAAG,CAAC,EAAE,CAAC;QAEtB,IAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,IAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC;QACnC,IAAM,KAAK,GAAG,CAAE,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAE,WAAW,CAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAE,CAAC;QACnE,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;QAClB,MAAM,CAAC,IAAI,CAAE,IAAI,yBAAyB,CAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,cAAc,CAAE,CAAE,CAAC;QAC3F,MAAM,CAAC,IAAI,CAAE,IAAI,yBAAyB,CAAE,QAAQ,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,cAAc,CAAE,CAAE,CAAC;QAE3F,IAAI,CAAC,IAAI,KAAK,IAAI,KAAK,GAAG,MAAM,CAAC,MAAM,EAAG;YACzC,IAAM,KAAK,GAAG,MAAM,CAAE,KAAK,CAAE,CAAC;YAC7B,KAAa,CAAC,SAAS,GAAG,IAAI,CAAC;YAChC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;SACvB;aAAM,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,EAAG;YAC9B,IAAM,KAAK,GAAG,MAAM,CAAE,MAAM,CAAC,MAAM,GAAG,CAAC,CAAE,CAAC;YACzC,KAAa,CAAC,SAAS,GAAG,IAAI,CAAC;YAChC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;SACvB;aAAM;YACN,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;SACtB;QACD,IAAI,WAAW,KAAK,IAAI,CAAC,SAAS,EAAG;YACpC,IAAI,CAAC,IAAI,CAAE,iBAAiB,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAE,CAAC;SACrD;QAED,IAAI,YAAY,KAAK,IAAI,CAAC,UAAU,EAAG;YACtC,IAAI,CAAC,IAAI,CAAE,iBAAiB,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAE,CAAC;SACtD;QAED,IAAI,CAAC,IAAI,CAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;IAC7B,CAAC;IAED,2CAAQ,GAAR;QACC,IAAM,UAAU,GAAG,EAAE,CAAC;QACtB,IAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,IAAI,EAAE,EAAE,CAAC,EAAG;YACrD,UAAU,CAAC,IAAI,CAAE,MAAM,CAAE,CAAC,CAAE,CAAC,QAAQ,EAAE,CAAE,CAAC;SAC1C;QACD,OAAO;YACN,MAAM,EAAE,UAAU;YAClB,SAAS,EAAE,IAAI,CAAC,UAAU;SAC1B,CAAC;IACH,CAAC;IAED,6CAAU,GAAV,UAAY,IAAkC;QAC7C,IAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC;QACrC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC;QAEjC,IAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC;QAC5B,IAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC;QACnC,IAAM,KAAK,GAAG,CAAE,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAE,WAAW,CAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAE,CAAC;QACnE,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;QAClB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC,GAAG,IAAI,EAAE,EAAE,CAAC,EAAG;YAC1D,IAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAE,CAAC,CAAE,CAAC;YACnC,IAAM,KAAK,GAAG,IAAI,yBAAyB,CAC1C,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,QAAQ,EACpD,KAAK,EAAE,IAAI,CAAC,cAAc,CAC1B,CAAC;YACF,MAAM,CAAC,IAAI,CAAE,KAAK,CAAE,CAAC;SACrB;QACD,MAAM,CAAC,IAAI,CAAE,YAAY,CAAE,CAAC;QAE5B,IAAI,CAAC,IAAI,KAAK,IAAI,KAAK,GAAG,MAAM,CAAC,MAAM,EAAG;YACzC,IAAM,KAAK,GAAG,MAAM,CAAE,KAAK,CAAE,CAAC;YAC7B,KAAa,CAAC,SAAS,GAAG,IAAI,CAAC;YAChC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;SACvB;aAAM,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,EAAG;YAC9B,IAAM,KAAK,GAAG,MAAM,CAAE,MAAM,CAAC,MAAM,GAAG,CAAC,CAAE,CAAC;YACzC,KAAa,CAAC,SAAS,GAAG,IAAI,CAAC;YAChC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;SACvB;aAAM;YACN,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;SACtB;QACD,IAAI,WAAW,KAAK,IAAI,CAAC,SAAS,EAAG;YACpC,IAAI,CAAC,IAAI,CAAE,iBAAiB,EAAE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAE,CAAC;SACrD;QAED,IAAI,YAAY,KAAK,IAAI,CAAC,UAAU,EAAG;YACtC,IAAI,CAAC,IAAI,CAAE,iBAAiB,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAE,CAAC;SACtD;QAED,IAAI,CAAC,IAAI,CAAE,QAAQ,EAAE,IAAI,CAAE,CAAC;IAC7B,CAAC;IACF,+BAAC;AAAD,CAAC,AAzOD,CAA8C,KAAK,CAAC,YAAY,GAyO/D","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DPickerColorGradientPoint, DPickerColorGradientPointLike } from \"./d-picker-color-gradient-point\";\r\n\r\nconst POINT_SORTER = ( a: DPickerColorGradientPoint, b: DPickerColorGradientPoint ): number => {\r\n\treturn a.position - b.position;\r\n};\r\n\r\nexport interface DPickerColorGradientDataLike {\r\n\tpoints: DPickerColorGradientPointLike[];\r\n\tdirection: number;\r\n}\r\n\r\nexport class DPickerColorGradientData extends utils.EventEmitter {\r\n\tprotected _points: DPickerColorGradientPoint[];\r\n\tprotected _direction: number;\r\n\tprotected _selected: DPickerColorGradientPoint | null;\r\n\r\n\tprotected _onChangeBound: ( target: DPickerColorGradientPoint ) => void;\r\n\tprotected _workColor: number[];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis._onChangeBound = ( target: DPickerColorGradientPoint ): void => {\r\n\t\t\tthis.onChange( target );\r\n\t\t};\r\n\r\n\t\tconst first = new DPickerColorGradientPoint( 0xffffff, 1, 0, false, this._onChangeBound );\r\n\t\tconst second = new DPickerColorGradientPoint( 0x808080, 1, 1, true, this._onChangeBound );\r\n\t\tthis._points = [ first, second ];\r\n\t\tthis._direction = -90;\r\n\t\tthis._selected = second;\r\n\t\tthis._workColor = [ 0, 0, 0 ];\r\n\t}\r\n\r\n\tprotected onChange( target: DPickerColorGradientPoint ): void {\r\n\t\tconst isSelectionChanged = ( target.selected && this._selected !== target );\r\n\t\tif( isSelectionChanged ) {\r\n\t\t\tconst selected = this._selected;\r\n\t\t\tif( selected != null ) {\r\n\t\t\t\t(selected as any)._selected = false;\r\n\t\t\t}\r\n\t\t\tthis._selected = target;\r\n\t\t}\r\n\t\tthis._points.sort( POINT_SORTER );\r\n\t\tif( isSelectionChanged ) {\r\n\t\t\tthis.emit( \"selectionchange\", this._selected, this );\r\n\t\t}\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\tget points(): DPickerColorGradientPoint[] {\r\n\t\treturn this._points;\r\n\t}\r\n\r\n\tget direction(): number {\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n\tset direction( direction: number ) {\r\n\t\tif( this._direction !== direction ) {\r\n\t\t\tthis._direction = direction;\r\n\t\t\tthis.emit( \"directionchange\", direction, this );\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tget selected(): DPickerColorGradientPoint | null {\r\n\t\treturn this._selected;\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._points.length;\r\n\t}\r\n\r\n\tget( index: number ): DPickerColorGradientPoint | null {\r\n\t\tconst points = this._points;\r\n\t\tif( 0 <= index && index < points.length ) {\r\n\t\t\treturn points[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\taddAt( position: number ): DPickerColorGradientPoint {\r\n\t\tconst points = this._points;\r\n\t\tlet previous: DPickerColorGradientPoint | null = null;\r\n\t\tfor( let i = 0, imax = points.length; i < imax; ++i ) {\r\n\t\t\tconst point = points[ i ];\r\n\t\t\tif( position <= point.position ) {\r\n\t\t\t\tif( previous != null ) {\r\n\t\t\t\t\tconst span = point.position - previous.position;\r\n\t\t\t\t\tif( 0.001 < span ) {\r\n\t\t\t\t\t\tconst rgb0 = utils.hex2rgb( point.color, this._workColor );\r\n\t\t\t\t\t\tconst r0 = rgb0[ 0 ];\r\n\t\t\t\t\t\tconst g0 = rgb0[ 1 ];\r\n\t\t\t\t\t\tconst b0 = rgb0[ 2 ];\r\n\r\n\t\t\t\t\t\tconst rgb1 = utils.hex2rgb( previous.color, this._workColor );\r\n\t\t\t\t\t\tconst r1 = rgb1[ 0 ];\r\n\t\t\t\t\t\tconst g1 = rgb1[ 1 ];\r\n\t\t\t\t\t\tconst b1 = rgb1[ 2 ];\r\n\r\n\t\t\t\t\t\tconst ratio = (position - previous.position) / span;\r\n\t\t\t\t\t\tconst r = r0 * ratio + r1 * (1 - ratio);\r\n\t\t\t\t\t\tconst g = g0 * ratio + g1 * (1 - ratio);\r\n\t\t\t\t\t\tconst b = b0 * ratio + b1 * (1 - ratio);\r\n\r\n\t\t\t\t\t\tconst rgb = this._workColor;\r\n\t\t\t\t\t\trgb[ 0 ] = r;\r\n\t\t\t\t\t\trgb[ 1 ] = g;\r\n\t\t\t\t\t\trgb[ 2 ] = b;\r\n\r\n\t\t\t\t\t\tconst color = utils.rgb2hex( rgb );\r\n\t\t\t\t\t\tconst alpha = point.alpha * ratio + previous.alpha * (1 - ratio);\r\n\t\t\t\t\t\treturn this.add( color, alpha, position, true );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn this.add( point.color, point.alpha, position, true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprevious = point;\r\n\t\t}\r\n\t\tif( previous != null ) {\r\n\t\t\treturn this.add( previous.color, previous.alpha, position, true );\r\n\t\t} else {\r\n\t\t\treturn this.add( 0xffffff, 1.0, position, true );\r\n\t\t}\r\n\t}\r\n\r\n\tadd( color: number, alpha: number, position: number, selected: boolean ): DPickerColorGradientPoint {\r\n\t\tconst result = new DPickerColorGradientPoint( color, alpha, position, selected, this._onChangeBound );\r\n\t\tthis._points.push( result );\r\n\t\tthis._onChangeBound( result );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tremove( point: DPickerColorGradientPoint ): boolean {\r\n\t\tconst points = this._points;\r\n\t\tif( 2 < points.length ) {\r\n\t\t\tfor( let i = 0, imax = points.length; i < imax; ++i ) {\r\n\t\t\t\tif( points[ i ] === point ) {\r\n\t\t\t\t\tpoints.splice( i, 1 );\r\n\t\t\t\t\tconst isSelectionChanged = ( this._selected === point );\r\n\t\t\t\t\tif( isSelectionChanged ) {\r\n\t\t\t\t\t\tif( i + 1 < imax ) {\r\n\t\t\t\t\t\t\tthis._selected = points[ i ];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._selected = points[ i - 1 ];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( isSelectionChanged ) {\r\n\t\t\t\t\t\tthis.emit( \"selectionchange\", this._selected, this );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tconst oldDirection = this._direction;\r\n\t\tthis._direction = -90;\r\n\r\n\t\tconst points = this._points;\r\n\t\tconst oldSelected = this._selected;\r\n\t\tconst index = ( oldSelected ? points.indexOf( oldSelected ) : -1 );\r\n\t\tpoints.length = 0;\r\n\t\tpoints.push( new DPickerColorGradientPoint( 0xffffff, 0, 0, false, this._onChangeBound ) );\r\n\t\tpoints.push( new DPickerColorGradientPoint( 0xffffff, 0, 1, false, this._onChangeBound ) );\r\n\r\n\t\tif( 0 <= index && index < points.length ) {\r\n\t\t\tconst point = points[ index ];\r\n\t\t\t(point as any)._selected = true;\r\n\t\t\tthis._selected = point;\r\n\t\t} else if( 0 < points.length ) {\r\n\t\t\tconst point = points[ points.length - 1 ];\r\n\t\t\t(point as any)._selected = true;\r\n\t\t\tthis._selected = point;\r\n\t\t} else {\r\n\t\t\tthis._selected = null;\r\n\t\t}\r\n\t\tif( oldSelected !== this._selected ) {\r\n\t\t\tthis.emit( \"selectionchange\", this._selected, this );\r\n\t\t}\r\n\r\n\t\tif( oldDirection !== this._direction ) {\r\n\t\t\tthis.emit( \"directionchange\", this._direction, this );\r\n\t\t}\r\n\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\ttoObject(): DPickerColorGradientDataLike {\r\n\t\tconst pointsCopy = [];\r\n\t\tconst points = this._points;\r\n\t\tfor( let i = 0, imax = points.length; i < imax; ++i ) {\r\n\t\t\tpointsCopy.push( points[ i ].toObject() );\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tpoints: pointsCopy,\r\n\t\t\tdirection: this._direction\r\n\t\t};\r\n\t}\r\n\r\n\tfromObject( data: DPickerColorGradientDataLike ): void {\r\n\t\tconst oldDirection = this._direction;\r\n\t\tthis._direction = data.direction;\r\n\r\n\t\tconst points = this._points;\r\n\t\tconst oldSelected = this._selected;\r\n\t\tconst index = ( oldSelected ? points.indexOf( oldSelected ) : -1 );\r\n\t\tpoints.length = 0;\r\n\t\tfor( let i = 0, imax = data.points.length; i < imax; ++i ) {\r\n\t\t\tconst pointLike = data.points[ i ];\r\n\t\t\tconst point = new DPickerColorGradientPoint(\r\n\t\t\t\tpointLike.color, pointLike.alpha, pointLike.position,\r\n\t\t\t\tfalse, this._onChangeBound\r\n\t\t\t);\r\n\t\t\tpoints.push( point );\r\n\t\t}\r\n\t\tpoints.sort( POINT_SORTER );\r\n\r\n\t\tif( 0 <= index && index < points.length ) {\r\n\t\t\tconst point = points[ index ];\r\n\t\t\t(point as any)._selected = true;\r\n\t\t\tthis._selected = point;\r\n\t\t} else if( 0 < points.length ) {\r\n\t\t\tconst point = points[ points.length - 1 ];\r\n\t\t\t(point as any)._selected = true;\r\n\t\t\tthis._selected = point;\r\n\t\t} else {\r\n\t\t\tthis._selected = null;\r\n\t\t}\r\n\t\tif( oldSelected !== this._selected ) {\r\n\t\t\tthis.emit( \"selectionchange\", this._selected, this );\r\n\t\t}\r\n\r\n\t\tif( oldDirection !== this._direction ) {\r\n\t\t\tthis.emit( \"directionchange\", this._direction, this );\r\n\t\t}\r\n\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n}\r\n"]}