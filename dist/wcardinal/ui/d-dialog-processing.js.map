{"version":3,"file":"d-dialog-processing.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-dialog-processing.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DDialogConfirm, DDialogConfirmOptions, DThemeDialogConfirm } from \"./d-dialog-confirm\";\r\nimport { DDialogConfirmMessage, DDialogConfirmMessageOptions } from \"./d-dialog-confirm-message\";\r\nimport { DDialogProcessingMessage } from \"./d-dialog-processing-message\";\r\n\r\nexport interface DDialogProcessingOptions<THEME extends DThemeDialogProcessing> extends DDialogConfirmOptions<THEME> {\r\n\tinterval?: number;\r\n}\r\n\r\nexport interface DThemeDialogProcessing extends DThemeDialogConfirm {\r\n\tgetInterval(): number;\r\n}\r\n\r\nexport class DDialogProcessing<\r\n\tTHEME extends DThemeDialogProcessing = DThemeDialogProcessing,\r\n\tOPTIONS extends DDialogProcessingOptions<THEME> = DDialogProcessingOptions<THEME>\r\n> extends DDialogConfirm<THEME, OPTIONS> {\r\n\tprotected _isDone: boolean;\r\n\tprotected _startTime: number;\r\n\tprotected _interval: number;\r\n\tprotected _timeoutId?: number;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis._isDone = true;\r\n\t\tthis._startTime =  0;\r\n\t\tthis._interval = ( options && options.interval != null ? options.interval : this.theme.getInterval() );\r\n\t}\r\n\r\n\tprotected newMessage( options: DDialogConfirmMessageOptions ): DDialogConfirmMessage {\r\n\t\treturn new DDialogProcessingMessage( options );\r\n\t}\r\n\r\n\tprotected onOpen() {\r\n\t\tthis._isDone = false;\r\n\t\tthis._startTime = Date.now();\r\n\t\tconst timeoutId = this._timeoutId;\r\n\t\tif( timeoutId != null ) {\r\n\t\t\tclearTimeout( timeoutId );\r\n\t\t}\r\n\t\tthis._message.setStates( DBaseState.NONE, DBaseState.SUCCEEDED | DBaseState.FAILED );\r\n\t\tconst buttonLayout = this._buttonLayout;\r\n\t\tif( buttonLayout != null ) {\r\n\t\t\tbuttonLayout.setDisabled( true );\r\n\t\t}\r\n\t\tsuper.onOpen();\r\n\t}\r\n\r\n\tprotected onDone(): void {\r\n\t\tconst buttonLayout = this._buttonLayout;\r\n\t\tif( buttonLayout != null ) {\r\n\t\t\tbuttonLayout.setDisabled( false );\r\n\t\t} else {\r\n\t\t\tthis.close();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onResolved( message?: string ): void {\r\n\t\tif( message != null ) {\r\n\t\t\tthis._message.text = message;\r\n\t\t}\r\n\t\tthis._message.setStates( DBaseState.SUCCEEDED, DBaseState.FAILED );\r\n\t\tthis.onDone();\r\n\t}\r\n\r\n\tprotected onRejected( message?: string ): void {\r\n\t\tif( message != null ) {\r\n\t\t\tthis._message.text = message;\r\n\t\t}\r\n\t\tthis._message.setStates( DBaseState.FAILED, DBaseState.SUCCEEDED );\r\n\t\tthis.onDone();\r\n\t}\r\n\r\n\tresolve( message?: string ): void {\r\n\t\tif( ! this._isDone ) {\r\n\t\t\tthis._isDone = true;\r\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\r\n\t\t\tconst delay = this._interval - elapsedTime;\r\n\t\t\tif( 0 < delay ) {\r\n\t\t\t\tthis._timeoutId = window.setTimeout((): void => {\r\n\t\t\t\t\tthis._timeoutId = undefined;\r\n\t\t\t\t\tthis.onResolved( message );\r\n\t\t\t\t}, delay );\r\n\t\t\t} else {\r\n\t\t\t\tthis.onResolved( message );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treject( message?: string ): void {\r\n\t\tif( ! this._isDone ) {\r\n\t\t\tthis._isDone = true;\r\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\r\n\t\t\tconst delay = this._interval - elapsedTime;\r\n\t\t\tif( 0 < delay ) {\r\n\t\t\t\tthis._timeoutId = window.setTimeout((): void => {\r\n\t\t\t\t\tthis._timeoutId = undefined;\r\n\t\t\t\t\tthis.onRejected( message );\r\n\t\t\t\t}, delay );\r\n\t\t\t} else {\r\n\t\t\t\tthis.onRejected( message );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onCloseOn(): void {\r\n\t\tif( this._isDone ) {\r\n\t\t\tsuper.onCloseOn();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogProcessing\";\r\n\t}\r\n}\r\n"]}