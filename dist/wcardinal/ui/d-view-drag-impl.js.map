{"version":3,"file":"d-view-drag-impl.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-view-drag-impl.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DDragMode } from \"./d-drag-mode\";\r\nimport { DMouseModifier } from \"./d-mouse-modifier\";\r\nimport { DThemeViewDrag, DViewDrag, DViewDragOptions } from \"./d-view-drag\";\r\nimport { DViewStopper } from \"./d-view-stopper\";\r\nimport { DViewToTarget } from \"./d-view-to-target\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilDrag } from \"./util/util-drag\";\r\n\r\nexport class DViewDragImpl implements DViewDrag {\r\n\tprotected _parent: DBase;\r\n\tprotected _toTarget: DViewToTarget;\r\n\tprotected _stopper: DViewStopper;\r\n\tprotected _dragUtil?: UtilDrag;\r\n\tprotected _bind: boolean;\r\n\r\n\tconstructor(\r\n\t\tparent: DBase,\r\n\t\ttoTarget: DViewToTarget,\r\n\t\tstopper: DViewStopper,\r\n\t\ttheme: DThemeViewDrag,\r\n\t\toptions: DViewDragOptions | undefined\r\n\t) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._toTarget = toTarget;\r\n\t\tthis._stopper = stopper;\r\n\r\n\t\tconst mode = ( options && options.mode != null ?\r\n\t\t\t( isString( options.mode ) ? DDragMode[ options.mode ] : options.mode ) :\r\n\t\t\ttheme.getDragMode()\r\n\t\t);\r\n\t\tconst modifier = ( options && options.modifier != null ?\r\n\t\t\t( isString( options.modifier ) ? DMouseModifier[ options.modifier ] : options.modifier ) :\r\n\t\t\ttheme.getDragModifier()\r\n\t\t);\r\n\t\tconst duration = ( options && options.duration != null ?\r\n\t\t\toptions.duration : {\r\n\t\t\t\tposition: theme.getDragDurationPosition(),\r\n\t\t\t\tscale: theme.getDragDurationScale()\r\n\t\t\t}\r\n\t\t);\r\n\t\tconst bind = (mode === DDragMode.TOUCH);\r\n\t\tthis._bind = bind;\r\n\t\tif( mode === DDragMode.ON || mode === DDragMode.TOUCH ) {\r\n\t\t\tthis._dragUtil = new UtilDrag({\r\n\t\t\t\ttarget: parent,\r\n\t\t\t\ttouch: bind,\r\n\t\t\t\tmodifier,\r\n\t\t\t\tchecker: options && options.checker,\r\n\t\t\t\teasing: {\r\n\t\t\t\t\tduration\r\n\t\t\t\t},\r\n\t\t\t\tbind,\r\n\t\t\t\ton: {\r\n\t\t\t\t\tstart: (): void => {\r\n\t\t\t\t\t\tthis._stopper.stop();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmove: ( dx: number, dy: number, x: number, y: number, ds: number ): void => {\r\n\t\t\t\t\t\tconst target = toTarget( parent );\r\n\t\t\t\t\t\tif( target != null ) {\r\n\t\t\t\t\t\t\t// Scale\r\n\t\t\t\t\t\t\tconst oldScale = target.scale.y;\r\n\t\t\t\t\t\t\tconst newScale = stopper.toNormalizedScale( oldScale * ds );\r\n\t\t\t\t\t\t\tconst scaleRatio = newScale / oldScale;\r\n\r\n\t\t\t\t\t\t\t// Position\r\n\t\t\t\t\t\t\tconst cx = x - dx;\r\n\t\t\t\t\t\t\tconst cy = y - dy;\r\n\t\t\t\t\t\t\tconst position = target.position;\r\n\t\t\t\t\t\t\tconst newX = (position.x - cx) * scaleRatio + x;\r\n\t\t\t\t\t\t\tconst newY = (position.y - cy) * scaleRatio + y;\r\n\r\n\t\t\t\t\t\t\t// Update\r\n\t\t\t\t\t\t\ttarget.scale.set( newScale, newScale );\r\n\t\t\t\t\t\t\ttarget.position.set( newX, newY );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tconst dragUtil = this._dragUtil;\r\n\t\tif( dragUtil != null ) {\r\n\t\t\tdragUtil.stop();\r\n\t\t}\r\n\t}\r\n\r\n\tonDown( e: interaction.InteractionEvent ): void {\r\n\t\tif( ! this._bind ) {\r\n\t\t\tconst dragUtil = this._dragUtil;\r\n\t\t\tif( dragUtil ) {\r\n\t\t\t\tdragUtil.onDown( e );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n"]}