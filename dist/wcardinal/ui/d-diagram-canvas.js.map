{"version":3,"file":"d-diagram-canvas.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-diagram-canvas.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DDiagramCanvasBase, DDiagramCanvasBaseOptions, DThemeDiagramCanvasBase } from \"./d-diagram-canvas-base\";\r\nimport { DDiagramCanvasIdMap } from \"./d-diagram-canvas-id-map\";\r\nimport { DDiagramCanvasTagMap } from \"./d-diagram-canvas-tag-map\";\r\nimport { EShape } from \"./shape/e-shape\";\r\nimport { EShapeBase } from \"./shape/variant/e-shape-base\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\n/**\r\n * A tag mapper.\r\n *\r\n * @param tag a tag\r\n * @returns a mapped tag\r\n */\r\nexport type DDiagramCanvasTagMapper = ( tag: string ) => string | null;\r\n\r\nexport interface DDiagramCanvasTagOptions {\r\n\t/**\r\n\t * A tag mapper.\r\n\t */\r\n\tmapper?: DDiagramCanvasTagMapper;\r\n}\r\n\r\nexport interface DDiagramCanvasOptions<\r\n\tTHEME extends DThemeDiagramCanvas = DThemeDiagramCanvas\r\n> extends DDiagramCanvasBaseOptions<THEME> {\r\n\t/**\r\n\t * A tag options.\r\n\t */\r\n\ttag?: DDiagramCanvasTagOptions;\r\n}\r\n\r\nexport interface DThemeDiagramCanvas extends DThemeDiagramCanvasBase {\r\n\r\n}\r\n\r\nconst defaultTagMapper = ( tag: string ) => tag;\r\n\r\nexport class DDiagramCanvas<\r\n\tTHEME extends DThemeDiagramCanvas = DThemeDiagramCanvas,\r\n\tOPTIONS extends DDiagramCanvasOptions<THEME> = DDiagramCanvasOptions<THEME>\r\n> extends DDiagramCanvasBase<THEME, OPTIONS> {\r\n\ttags: DDiagramCanvasTagMap;\r\n\ttagMapper: DDiagramCanvasTagMapper;\r\n\tinteractives: EShape[];\r\n\tactionables: EShape[];\r\n\tids: DDiagramCanvasIdMap;\r\n\r\n\tprotected _workLocal: Point;\r\n\tprotected _workGlobal: Point;\r\n\tprotected _lastOverShape: EShape | null;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis.tags = {};\r\n\t\tthis.tagMapper = (options.tag && options.tag.mapper) || defaultTagMapper;\r\n\t\tthis.interactives = [];\r\n\t\tthis.actionables = [];\r\n\t\tthis.ids = {};\r\n\t\tthis._workLocal = new Point();\r\n\t\tthis._workGlobal = new Point();\r\n\t\tthis._lastOverShape = null;\r\n\t}\r\n\r\n\tinitialize(): void {\r\n\t\tconst time = Date.now();\r\n\t\tconst tags = this.tags;\r\n\t\tconst tagMapper = this.tagMapper;\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst actionables = this.actionables;\r\n\t\tconst ids = this.ids;\r\n\t\tconst layers = this._layer.children;\r\n\r\n\t\tfor( let i = 0, imax = layers.length; i < imax; ++i ) {\r\n\t\t\tthis.initializeShapes( layers[ i ].children, tags, tagMapper, interactives, actionables, ids );\r\n\t\t}\r\n\r\n\t\tfor( let i = 0, imax = layers.length; i < imax; ++i ) {\r\n\t\t\tthis.updateShapes( layers[ i ].children, time );\r\n\t\t}\r\n\r\n\t\tthis.initializeFocus();\r\n\t}\r\n\r\n\tprotected initializeFocus(): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\tconst focusable = focusController.findFocusable( this, false, true, true );\r\n\t\t\tif( focusable ) {\r\n\t\t\t\tfocusController.setFocused( focusable, true, true );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected initializeShapes(\r\n\t\tshapes: EShape[], tags: DDiagramCanvasTagMap, tagMapper: DDiagramCanvasTagMapper,\r\n\t\tinteractives: EShape[], actionables: EShape[],\r\n\t\tids: DDiagramCanvasIdMap\r\n\t): void {\r\n\t\tfor( let i = 0, imax = shapes.length; i < imax; ++i ) {\r\n\t\t\tconst shape = shapes[ i ];\r\n\r\n\t\t\t// Tag mappings\r\n\t\t\tconst tag = shape.tag;\r\n\t\t\tfor( let j = 0, jmax = tag.size(); j < jmax; ++j ) {\r\n\t\t\t\tconst value = tag.get( j );\r\n\t\t\t\tif( value ) {\r\n\t\t\t\t\tconst valueId = value.id;\r\n\t\t\t\t\tif( 0 < valueId.length ) {\r\n\t\t\t\t\t\tconst mappedValueId = tagMapper( valueId );\r\n\t\t\t\t\t\tif( mappedValueId != null ) {\r\n\t\t\t\t\t\t\tlet values = tags[ mappedValueId ];\r\n\t\t\t\t\t\t\tif( values == null ) {\r\n\t\t\t\t\t\t\t\tvalues = [];\r\n\t\t\t\t\t\t\t\ttags[ mappedValueId ] = values;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvalues.push( value );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Id mappings\r\n\t\t\tconst shapeId = shape.id;\r\n\t\t\tif( 0 < shapeId.length ) {\r\n\t\t\t\tconst mapping: EShape[] | undefined = ids[ shapeId ];\r\n\t\t\t\tif( mapping == null ) {\r\n\t\t\t\t\tids[ shapeId ] = [ shape ];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmapping.push( shape );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Interactives\r\n\t\t\tconst runtime = shape.runtime;\r\n\t\t\tif( shape.interactive || (0 < shape.cursor.length) || (runtime && runtime.interactive) ) {\r\n\t\t\t\tinteractives.push( shape );\r\n\t\t\t}\r\n\r\n\t\t\t// Actionables\r\n\t\t\tif( runtime && 0 < runtime.actions.length ) {\r\n\t\t\t\tactionables.push( shape );\r\n\t\t\t}\r\n\r\n\t\t\t// Shortcuts\r\n\t\t\tconst shortcut = shape.shortcut;\r\n\t\t\tif( shortcut != null ) {\r\n\t\t\t\tUtilKeyboardEvent.on( this, shortcut, ( e: KeyboardEvent ): void => {\r\n\t\t\t\t\tshape.onShortcut( e );\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Children\r\n\t\t\tconst children = shape.children;\r\n\t\t\tif( 0 < children.length ) {\r\n\t\t\t\tthis.initializeShapes( children, tags, tagMapper, interactives, actionables, ids );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateShapes( shapes: EShape[], time: number ): void {\r\n\t\tfor( let i = 0, imax = shapes.length; i < imax; ++i ) {\r\n\t\t\tshapes[ i ].update( time );\r\n\t\t}\r\n\t}\r\n\r\n\tonShapeMove( e: interaction.InteractionEvent ): boolean {\r\n\t\tconst global = e.data.global;\r\n\t\tconst local = this._workLocal;\r\n\t\tconst interactives = this.interactives;\r\n\t\tlet found: EShape | null = null;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tfound = interactive;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( found ) {\r\n\t\t\tif( 0 < found.cursor.length ) {\r\n\t\t\t\tif( layer && layer.view.style.cursor !== found.cursor ) {\r\n\t\t\t\t\tlayer.view.style.cursor = found.cursor;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst lastOverShape = this._lastOverShape;\r\n\t\t\tif( found === lastOverShape ) {\r\n\t\t\t\tconst runtime = lastOverShape.runtime;\r\n\t\t\t\tif( runtime ) {\r\n\t\t\t\t\truntime.onPointerMove( lastOverShape, e );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._lastOverShape = found;\r\n\r\n\t\t\t\t// Previous\r\n\t\t\t\tif( lastOverShape ) {\r\n\t\t\t\t\tconst previousRuntime = lastOverShape.runtime;\r\n\t\t\t\t\tif( previousRuntime ) {\r\n\t\t\t\t\t\tpreviousRuntime.onPointerOut( lastOverShape, e );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Parents\r\n\t\t\t\t\tlet lastOverParent = lastOverShape.parent;\r\n\t\t\t\t\twhile( (lastOverParent instanceof EShapeBase) && lastOverParent !== found ) {\r\n\t\t\t\t\t\tconst parentRuntime = lastOverShape.runtime;\r\n\t\t\t\t\t\tif( parentRuntime ) {\r\n\t\t\t\t\t\t\tparentRuntime.onPointerOut( lastOverParent, e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlastOverParent = lastOverParent.parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Next\r\n\t\t\t\tconst runtime = found.runtime;\r\n\t\t\t\tif( runtime ) {\r\n\t\t\t\t\truntime.onPointerOver( found, e );\r\n\t\t\t\t}\r\n\t\t\t\tif( layer ) {\r\n\t\t\t\t\tlayer.view.title = ( found.title || \"\" );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Parents\r\n\t\t\t\tlet parent = found.parent;\r\n\t\t\t\twhile( parent instanceof EShapeBase ) {\r\n\t\t\t\t\tconst parentRuntime = parent.runtime;\r\n\t\t\t\t\tif( parentRuntime ) {\r\n\t\t\t\t\t\tparentRuntime.onPointerOver( parent, e );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparent = parent.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\tif( layer && layer.view.style.cursor !== \"auto\" ) {\r\n\t\t\t\tlayer.view.style.cursor = \"auto\";\r\n\t\t\t}\r\n\r\n\t\t\t// Previous\r\n\t\t\tconst lastOverShape = this._lastOverShape;\r\n\t\t\tthis._lastOverShape = null;\r\n\t\t\tif( lastOverShape ) {\r\n\t\t\t\tconst runtime = lastOverShape.runtime;\r\n\t\t\t\tif( runtime ) {\r\n\t\t\t\t\truntime.onPointerOut( lastOverShape, e );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Parents\r\n\t\t\t\tlet lastOverParent = lastOverShape.parent;\r\n\t\t\t\twhile( lastOverParent instanceof EShapeBase ) {\r\n\t\t\t\t\tconst parentRuntime = lastOverParent.runtime;\r\n\t\t\t\t\tif( parentRuntime ) {\r\n\t\t\t\t\t\tparentRuntime.onPointerOut( lastOverParent, e );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlastOverParent = lastOverParent.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.view.title = \"\";\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tonShapeDown( e: interaction.InteractionEvent ): boolean {\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst global = e.data.global;\r\n\t\tconst local = this._workLocal;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tconst runtime = interactive.runtime;\r\n\t\t\t\t\tif( runtime ) {\r\n\t\t\t\t\t\truntime.onPointerDown( interactive, e );\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonShapeUp( e: interaction.InteractionEvent ): boolean {\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst global = e.data.global;\r\n\t\tconst local = this._workLocal;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tconst runtime = interactive.runtime;\r\n\t\t\t\t\tif( runtime ) {\r\n\t\t\t\t\t\truntime.onPointerUp( interactive, e );\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonShapeClick( e: interaction.InteractionEvent ): boolean {\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst global = e.data.global;\r\n\t\tconst local = this._workLocal;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tlet target: EShape = interactive;\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\tconst runtime = target.runtime;\r\n\t\t\t\t\t\tif( runtime ) {\r\n\t\t\t\t\t\t\truntime.onPointerClick( target, e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst parent = target.parent;\r\n\t\t\t\t\t\tif( parent instanceof EShapeBase ) {\r\n\t\t\t\t\t\t\ttarget = parent;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonShapeDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean {\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst global = UtilPointerEvent.toGlobal( e, interactionManager, this._workGlobal );\r\n\t\tconst local = this._workLocal;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tlet target: EShape = interactive;\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\tconst runtime = target.runtime;\r\n\t\t\t\t\t\tif( runtime ) {\r\n\t\t\t\t\t\t\truntime.onPointerDblClick( target, e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst parent = target.parent;\r\n\t\t\t\t\t\tif( parent instanceof EShapeBase ) {\r\n\t\t\t\t\t\t\ttarget = parent;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDiagramCanvas\";\r\n\t}\r\n}\r\n"]}