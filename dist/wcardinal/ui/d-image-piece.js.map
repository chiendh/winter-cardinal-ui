{"version":3,"file":"d-image-piece.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-image-piece.ts"],"names":[],"mappings":"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","sourcesContent":["import { DisplayObject, Point, Rectangle, Sprite, Texture } from \"pixi.js\";\r\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\r\nimport { DAlignVertical } from \"./d-align-vertical\";\r\nimport { DAlignWith } from \"./d-align-with\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { isFunction } from \"./util/is-function\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\ntype DImagePieceOnChange = () => void;\r\n\r\ntype DImagePieceApplyMask = ( target: DisplayObject ) => void;\r\n\r\nexport interface DImagePieceTintOptions {\r\n\tcolor?: DStateAwareOrValueMightBe<number | null>;\r\n\talpha?: DStateAwareOrValueMightBe<number>;\r\n}\r\n\r\nexport interface DImagePieceAlignOptions {\r\n\twith?: (keyof typeof DAlignWith) | DAlignWith;\r\n\tvertical?: (keyof typeof DAlignVertical) | DAlignVertical;\r\n\thorizontal?: (keyof typeof DAlignHorizontal) | DAlignHorizontal;\r\n}\r\n\r\nexport interface DImagePieceMarginOptions {\r\n\tvertical?: number;\r\n\thorizontal?: number;\r\n}\r\n\r\nexport interface DImagePieceOptions {\r\n\tsource?: DStateAwareOrValueMightBe<Texture | DisplayObject | null>;\r\n\ttint?: DImagePieceTintOptions;\r\n\talign?: DImagePieceAlignOptions;\r\n\tmargin?: DImagePieceMarginOptions;\r\n}\r\n\r\nexport interface DImagePieceAlign {\r\n\twith: DAlignWith;\r\n\tvertical: DAlignVertical;\r\n\thorizontal: DAlignHorizontal;\r\n}\r\n\r\nexport interface DImagePieceMargin {\r\n\tvertical: number;\r\n\thorizontal: number;\r\n}\r\n\r\nexport interface DImagePieceTextAlign {\r\n\tvertical: DAlignVertical;\r\n\thorizontal: DAlignHorizontal;\r\n}\r\n\r\nexport interface DImagePieceParent {\r\n\treadonly state: DBaseState;\r\n\taddChild( displayObject: DisplayObject ): void;\r\n\tremoveChild( displayObject: DisplayObject ): void;\r\n}\r\n\r\nexport interface DThemeImagePiece {\r\n\tgetImageAlignHorizontal(): DAlignHorizontal;\r\n\tgetImageAlignVertical(): DAlignVertical;\r\n\tgetImageAlignWith(): DAlignWith;\r\n\tgetImageMarginHorizontal(): number;\r\n\tgetImageMarginVertial(): number;\r\n\tgetImageTintColor( state: DBaseState ): number | null;\r\n\tgetImageTintAlpha( state: DBaseState ): number;\r\n\tgetImageSource( state: DBaseState ): Texture | DisplayObject | null;\r\n}\r\n\r\nconst toImageAlign = ( theme: DThemeImagePiece, options?: DImagePieceOptions ): DImagePieceAlign => {\r\n\tconst align = options && options.align;\r\n\tif( align ) {\r\n\t\tconst alignWith: DAlignWith = ( align.with != null ?\r\n\t\t\t( isString( align.with ) ? DAlignWith[ align.with ] : align.with ) :\r\n\t\t\ttheme.getImageAlignWith()\r\n\t\t);\r\n\t\tconst alignVertical: DAlignVertical = ( align.vertical != null ?\r\n\t\t\t( isString( align.vertical ) ? DAlignVertical[ align.vertical ] : align.vertical ) :\r\n\t\t\ttheme.getImageAlignVertical()\r\n\t\t);\r\n\t\tconst alignHorizontal: DAlignHorizontal = ( align.horizontal != null ?\r\n\t\t\t( isString( align.horizontal ) ? DAlignHorizontal[ align.horizontal ] : align.horizontal ) :\r\n\t\t\ttheme.getImageAlignHorizontal()\r\n\t\t);\r\n\t\treturn {\r\n\t\t\twith: alignWith,\r\n\t\t\tvertical: alignVertical,\r\n\t\t\thorizontal: alignHorizontal\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\twith: theme.getImageAlignWith(),\r\n\t\tvertical: theme.getImageAlignVertical(),\r\n\t\thorizontal: theme.getImageAlignHorizontal()\r\n\t};\r\n};\r\n\r\nconst toImageMargin = ( theme: DThemeImagePiece, options?: DImagePieceOptions ): DImagePieceMargin => {\r\n\tconst margin = options && options.margin;\r\n\tif( margin ) {\r\n\t\tconst vertical = ( margin.vertical != null ?\r\n\t\t\tmargin.vertical : theme.getImageMarginVertial()\r\n\t\t);\r\n\t\tconst horizontal = ( margin.horizontal != null ?\r\n\t\t\tmargin.horizontal : theme.getImageMarginHorizontal()\r\n\t\t);\r\n\t\treturn {\r\n\t\t\tvertical,\r\n\t\t\thorizontal\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tvertical: theme.getImageMarginVertial(),\r\n\t\thorizontal: theme.getImageMarginHorizontal()\r\n\t};\r\n};\r\n\r\nconst toImageTint = ( theme: DThemeImagePiece, options?: DImagePieceOptions ): DImagePieceTintOptions | undefined => {\r\n\tif( options && options.tint != null ) {\r\n\t\treturn options.tint;\r\n\t}\r\n\treturn undefined;\r\n};\r\n\r\nexport class DImagePiece {\r\n\tprotected _image: DisplayObject | null;\r\n\tprotected _computed: Texture | DisplayObject | null;\r\n\tprotected _source: DStateAwareOrValueMightBe<Texture | DisplayObject | null>;\r\n\tprotected _align: DImagePieceAlign;\r\n\tprotected _margin: DImagePieceMargin;\r\n\tprotected _tint: DImagePieceTintOptions | undefined;\r\n\tprotected _bound: Rectangle;\r\n\tprotected _point: Point;\r\n\tprotected _onChange: DImagePieceOnChange;\r\n\tprotected _applyMask: DImagePieceApplyMask;\r\n\tprotected _parent: DImagePieceParent;\r\n\tprotected _textAlign: DImagePieceTextAlign;\r\n\tprotected _theme: DThemeImagePiece;\r\n\r\n\tconstructor(\r\n\t\tparent: DImagePieceParent,\r\n\t\ttheme: DThemeImagePiece,\r\n\t\toptions: DImagePieceOptions | undefined,\r\n\t\ttextAlign: DImagePieceTextAlign,\r\n\t\tonChange: DImagePieceOnChange,\r\n\t\tapplyMask: DImagePieceApplyMask\r\n\t) {\r\n\t\tthis._image = null;\r\n\t\tthis._align = toImageAlign( theme, options );\r\n\t\tthis._margin = toImageMargin( theme, options );\r\n\t\tthis._tint = toImageTint( theme, options );\r\n\t\tthis._bound = new Rectangle();\r\n\t\tthis._point = new Point();\r\n\t\tthis._source = ( options && options.source );\r\n\t\tthis._computed = null;\r\n\r\n\t\tthis._parent = parent;\r\n\t\tthis._theme = theme;\r\n\t\tthis._textAlign = textAlign;\r\n\t\tthis._onChange = onChange;\r\n\t\tthis._applyMask = applyMask;\r\n\t}\r\n\r\n\tget image(): DisplayObject | null {\r\n\t\treturn this._image;\r\n\t}\r\n\r\n\tget align(): DImagePieceAlign {\r\n\t\treturn this._align;\r\n\t}\r\n\r\n\tget margin(): DImagePieceMargin {\r\n\t\treturn this._margin;\r\n\t}\r\n\r\n\tget bound(): Rectangle {\r\n\t\treturn this._bound;\r\n\t}\r\n\r\n\tget source(): DStateAwareOrValueMightBe<Texture | DisplayObject | null> {\r\n\t\treturn this._source;\r\n\t}\r\n\r\n\tset source( source: DStateAwareOrValueMightBe<Texture | DisplayObject | null> ) {\r\n\t\tif( this._source !== source ) {\r\n\t\t\tthis._source = source;\r\n\t\t\tthis._onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected computeSource(): Texture | DisplayObject | null {\r\n\t\tconst source = this._source;\r\n\t\tif( source !== undefined ) {\r\n\t\t\tif( isFunction( source ) ) {\r\n\t\t\t\tconst result = source( this._parent.state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn source;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getImageSource( this._parent.state );\r\n\t}\r\n\r\n\tonStateChange( newState: DBaseState, oldState: DBaseState ): void {\r\n\t\tthis.updateTint();\r\n\t}\r\n\r\n\tupdateBound(): void {\r\n\t\tconst bound = this._bound;\r\n\t\tconst image = this._image;\r\n\t\tif( image != null ) {\r\n\t\t\timage.updateTransform();\r\n\t\t\timage.getLocalBounds( bound );\r\n\t\t\tconst bl = bound.left;\r\n\t\t\tconst bt = bound.top;\r\n\t\t\tconst br = bound.right;\r\n\t\t\tconst bb = bound.bottom;\r\n\r\n\t\t\tconst localTransform = image.localTransform;\r\n\t\t\tconst a = localTransform.a;\r\n\t\t\tconst b = localTransform.b;\r\n\t\t\tconst c = localTransform.c;\r\n\t\t\tconst d = localTransform.d;\r\n\r\n\t\t\tconst x0 = a * bl + c * bt;\r\n\t\t\tconst y0 = b * bl + d * bt;\r\n\t\t\tconst x1 = a * br + c * bt;\r\n\t\t\tconst y1 = b * br + d * bt;\r\n\t\t\tconst x2 = a * br + c * bb;\r\n\t\t\tconst y2 = b * br + d * bb;\r\n\t\t\tconst x3 = a * bl + c * bb;\r\n\t\t\tconst y3 = b * bl + d * bb;\r\n\r\n\t\t\tconst xmin = Math.min( x0, x1, x2, x3 );\r\n\t\t\tconst xmax = Math.max( x0, x1, x2, x3 );\r\n\t\t\tconst ymin = Math.min( y0, y1, y2, y3 );\r\n\t\t\tconst ymax = Math.max( y0, y1, y2, y3 );\r\n\r\n\t\t\tbound.x = xmin + localTransform.tx;\r\n\t\t\tbound.y = ymin + localTransform.ty;\r\n\t\t\tbound.width = xmax - xmin;\r\n\t\t\tbound.height = ymax - ymin;\r\n\t\t} else {\r\n\t\t\tbound.x = 0;\r\n\t\t\tbound.y = 0;\r\n\t\t\tbound.width = 0;\r\n\t\t\tbound.height = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected isTintAware( target: DisplayObject | null ): target is DisplayObject & { tint: number } {\r\n\t\treturn ( target != null && \"tint\" in target );\r\n\t}\r\n\r\n\tprotected toTintColor( theme: DThemeImagePiece, state: DBaseState ): number | null {\r\n\t\tconst tint = this._tint;\r\n\t\tif( tint ) {\r\n\t\t\tconst color = tint.color;\r\n\t\t\tif( color !== undefined ) {\r\n\t\t\t\tif( isFunction( color ) ) {\r\n\t\t\t\t\tconst result = color( state );\r\n\t\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn color;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn theme.getImageTintColor( state );\r\n\t}\r\n\r\n\tprotected toTintAlpha( theme: DThemeImagePiece, state: DBaseState ): number {\r\n\t\tconst tint = this._tint;\r\n\t\tif( tint ) {\r\n\t\t\tconst alpha = tint.alpha;\r\n\t\t\tif( alpha !== undefined ) {\r\n\t\t\t\tif( isFunction( alpha ) ) {\r\n\t\t\t\t\tconst result = alpha( state );\r\n\t\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn alpha;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn theme.getImageTintAlpha( state );\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the tint.\r\n\t *\r\n\t * @returns True if the tint is changed.\r\n\t */\r\n\tupdateTint(): boolean {\r\n\t\tconst image = this._image;\r\n\t\tif( image ) {\r\n\t\t\tif( this.isTintAware( image ) ) {\r\n\t\t\t\tconst theme = this._theme;\r\n\t\t\t\tconst state = this._parent.state;\r\n\t\t\t\tconst color = this.toTintColor( theme, state );\r\n\t\t\t\tif( color != null ) {\r\n\t\t\t\t\tlet result = false;\r\n\t\t\t\t\tif( image.tint !== color ) {\r\n\t\t\t\t\t\timage.tint = color;\r\n\t\t\t\t\t\tresult = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst alpha = this.toTintAlpha( theme, state );\r\n\t\t\t\t\tif( image.alpha !== alpha ) {\r\n\t\t\t\t\t\timage.alpha = alpha;\r\n\t\t\t\t\t\tresult = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the computed source.\r\n\t *\r\n\t * @returns True if the computed source is changed\r\n\t */\r\n\tupdateSource(): boolean {\r\n\t\tconst newComputed = this.computeSource();\r\n\t\tconst oldComputed = this._computed;\r\n\t\tif( newComputed !== oldComputed ) {\r\n\t\t\tthis._computed = newComputed;\r\n\r\n\t\t\tconst parent = this._parent;\r\n\t\t\tconst oldImage = this._image;\r\n\t\t\tif( newComputed instanceof Texture ) {\r\n\t\t\t\tif( oldComputed instanceof Texture ) {\r\n\t\t\t\t\toldComputed.off( \"update\", this._onChange );\r\n\t\t\t\t\tif( oldImage instanceof Sprite ) {\r\n\t\t\t\t\t\toldImage.texture = newComputed;\r\n\t\t\t\t\t\tnewComputed.on( \"update\", this._onChange );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif( oldImage != null ) {\r\n\t\t\t\t\t\tparent.removeChild( oldImage );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst newImage = new Sprite( newComputed );\r\n\t\t\t\t\tthis._applyMask( newImage );\r\n\t\t\t\t\tnewComputed.on( \"update\", this._onChange );\r\n\t\t\t\t\tparent.addChild( newImage );\r\n\t\t\t\t\tthis._image = newImage;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( oldComputed instanceof Texture ) {\r\n\t\t\t\t\toldComputed.off( \"update\", this._onChange );\r\n\t\t\t\t\tif( oldImage != null ) {\r\n\t\t\t\t\t\tparent.removeChild( oldImage );\r\n\t\t\t\t\t\toldImage.destroy();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if( oldImage != null ) {\r\n\t\t\t\t\tparent.removeChild( oldImage );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( newComputed != null ) {\r\n\t\t\t\t\tthis._applyMask( newComputed );\r\n\t\t\t\t\tparent.addChild( newComputed );\r\n\t\t\t\t}\r\n\t\t\t\tthis._image = newComputed;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tisRefitable( target: any ): boolean {\r\n\t\treturn ( target != null && target === this._image );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst image = this._image;\r\n\t\tif( image ) {\r\n\t\t\tthis._image = null;\r\n\t\t\tconst computed = this._computed;\r\n\t\t\tif( computed instanceof Texture ) {\r\n\t\t\t\tcomputed.off( \"update\", this._onChange, this );\r\n\t\t\t\timage.destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n"]}