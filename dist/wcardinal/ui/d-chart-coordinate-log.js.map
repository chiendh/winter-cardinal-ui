{"version":3,"file":"d-chart-coordinate-log.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-chart-coordinate-log.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinate, DChartCoordinateDirection } from \"./d-chart-coordinate\";\r\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\r\nimport { DChartCoordinateLogTick, DThemeChartCoordinateLogTick } from \"./d-chart-coordinate-log-tick\";\r\nimport { DChartCoordinateTransform, DThemeChartCoordinateTransform } from \"./d-chart-coordinate-transform\";\r\nimport { DChartCoordinateTransformImpl } from \"./d-chart-coordinate-transform-impl\";\r\nimport { DChartCoordinateTransformMark, DChartCoordinateTransformMarkImpl } from \"./d-chart-coordinate-transform-mark\";\r\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\r\nimport { DChartRegion } from \"./d-chart-region\";\r\nimport { DChartRegionImpl } from \"./d-chart-region-impl\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\nimport { isNaN } from \"./util/is-nan\";\r\n\r\nexport interface DThemeChartCoordinateLog extends DThemeChartCoordinateTransform, DThemeChartCoordinateLogTick {\r\n\r\n}\r\n\r\nexport interface DChartCoordinateLogOptions {\r\n\ttheme?: DThemeChartCoordinateLog;\r\n}\r\n\r\nexport class DChartCoordinateLog implements DChartCoordinate {\r\n\tprotected _id: number;\r\n\tprotected _transform: DChartCoordinateTransform;\r\n\tprotected _container?: DChartCoordinateContainerSub;\r\n\tprotected _direction: DChartCoordinateDirection;\r\n\tprotected _theme: DThemeChartCoordinateLog;\r\n\tprotected _work: DChartRegionImpl;\r\n\tprotected _tick: DChartCoordinateLogTick;\r\n\tprotected _mark: DChartCoordinateTransformMarkImpl;\r\n\r\n\tconstructor( options?: DChartCoordinateLogOptions ) {\r\n\t\tthis._id = 0;\r\n\t\tthis._direction = DChartCoordinateDirection.X;\r\n\t\tconst theme = this.toTheme( options );\r\n\t\tthis._theme = theme;\r\n\t\tthis._transform = new DChartCoordinateTransformImpl( theme );\r\n\t\tthis._tick = new DChartCoordinateLogTick( theme );\r\n\t\tthis._work = new DChartRegionImpl( NaN, NaN );\r\n\t\tthis._mark = new DChartCoordinateTransformMarkImpl();\r\n\t}\r\n\r\n\tbind( container: DChartCoordinateContainerSub, direction: DChartCoordinateDirection ): void {\r\n\t\tthis._container = container;\r\n\t\tthis._direction = direction;\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tthis._container = undefined;\r\n\t}\r\n\r\n\tfit( from?: number, to?: number ): void {\r\n\t\tthis.doFit( from, to, this._transform );\r\n\t}\r\n\r\n\tmark( from?: number, to?: number ): void {\r\n\t\tconst mark = this._mark;\r\n\t\tconst transform = this._transform;\r\n\t\tmark.oldTranslate = transform.translate;\r\n\t\tmark.oldScale = transform.scale;\r\n\t\tthis.doFit( from, to, mark );\r\n\t}\r\n\r\n\tblend( ratio: number ): void {\r\n\t\tthis._transform.blend( ratio, this._mark );\r\n\t}\r\n\r\n\tprotected doFit(\r\n\t\tfrom: number | undefined,\r\n\t\tto: number | undefined,\r\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform\r\n\t): void {\r\n\t\tconst container = this._container;\r\n\t\tif( container ) {\r\n\t\t\tconst plotArea = container.container.plotArea;\r\n\t\t\tconst padding = plotArea.padding;\r\n\t\t\tconst work = this._work;\r\n\t\t\tswitch( this._direction ) {\r\n\t\t\tcase DChartCoordinateDirection.X:\r\n\t\t\t\tthis.doFit_(\r\n\t\t\t\t\tpadding.getLeft(), plotArea.width - padding.getRight(),\r\n\t\t\t\t\tthis.toFitDomain( from, to, plotArea, work ),\r\n\t\t\t\t\tresult\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase DChartCoordinateDirection.Y:\r\n\t\t\t\tthis.doFit_(\r\n\t\t\t\t\tplotArea.height - padding.getBottom(), padding.getTop(),\r\n\t\t\t\t\tthis.toFitRange( from, to, plotArea, work ),\r\n\t\t\t\t\tresult\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toFitDomain(\r\n\t\tfrom: number | undefined, to: number | undefined,\r\n\t\tplotArea: DChartPlotArea,\r\n\t\tresult: DChartRegion\r\n\t): DChartRegion {\r\n\t\tif( from != null && to != null ) {\r\n\t\t\tresult.set( from, to );\r\n\t\t} else {\r\n\t\t\tplotArea.series.getDomain( this, result );\r\n\t\t\tresult.set( from, to );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected toFitRange(\r\n\t\tfrom: number | undefined, to: number | undefined,\r\n\t\tplotArea: DChartPlotArea,\r\n\t\tresult: DChartRegion\r\n\t): DChartRegion {\r\n\t\tif( from != null && to != null ) {\r\n\t\t\tresult.set( from, to );\r\n\t\t} else {\r\n\t\t\tplotArea.series.getRange( this, result );\r\n\t\t\tresult.set( from, to );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected doFit_(\r\n\t\tpixelFrom: number, pixelTo: number, region: DChartRegion,\r\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform\r\n\t): void {\r\n\t\tconst regionFrom = region.from;\r\n\t\tconst regionTo = region.to;\r\n\t\tif( ! (isNaN( regionFrom ) || isNaN( regionTo )) ) {\r\n\t\t\t// Scale\r\n\t\t\tlet newScale = 1;\r\n\t\t\tconst regionFromMapped = this.map( regionFrom );\r\n\t\t\tconst regionToMapped = this.map( regionTo );\r\n\t\t\tconst regionSizeMapped = ( regionToMapped - regionFromMapped );\r\n\t\t\tif( ! this._theme.isZero( regionSizeMapped ) ) {\r\n\t\t\t\tconst pixelSize = ( pixelTo - pixelFrom );\r\n\t\t\t\tnewScale = pixelSize / regionSizeMapped;\r\n\t\t\t} else {\r\n\t\t\t\tnewScale = ( pixelTo < pixelFrom ? -1 : 1 );\r\n\t\t\t}\r\n\r\n\t\t\t// Translation\r\n\t\t\tconst newTranslation = pixelFrom - regionFromMapped * newScale;\r\n\r\n\t\t\t// Done\r\n\t\t\tresult.set( newTranslation, newScale );\r\n\t\t}\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget transform(): DChartCoordinateTransform {\r\n\t\treturn this._transform;\r\n\t}\r\n\r\n\tmap( value: number ): number {\r\n\t\treturn Math.log( Math.max( 0, value ) ) / Math.LN10;\r\n\t}\r\n\r\n\tmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void {\r\n\t\tconst factor = 1 / Math.LN10;\r\n\t\tfor( let i = ifrom + offset; i < iend; i += stride ) {\r\n\t\t\tconst value = values[ i ];\r\n\t\t\tvalues[ i ] = Math.log( Math.max( 0, value ) ) * factor;\r\n\t\t}\r\n\t}\r\n\r\n\tunmap( value: number ): number {\r\n\t\treturn Math.pow( 10, value );\r\n\t}\r\n\r\n\tunmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void {\r\n\t\tfor( let i = ifrom + offset; i < iend; i += stride ) {\r\n\t\t\tvalues[ i ] = Math.pow( 10, values[ i ] );\r\n\t\t}\r\n\t}\r\n\r\n\tticks(\r\n\t\tdomainFrom: number, domainTo: number,\r\n\t\tmajorCount: number,\r\n\t\tminorCountPerMajor: number,\r\n\t\tminorCount: number,\r\n\t\tmajorResult: Float64Array,\r\n\t\tminorResult: Float64Array\r\n\t): void {\r\n\t\tthis._tick.calculate(\r\n\t\t\tdomainFrom, domainTo,\r\n\t\t\tmajorCount,\r\n\t\t\tminorCountPerMajor,\r\n\t\t\tminorCount,\r\n\t\t\tmajorResult,\r\n\t\t\tminorResult,\r\n\t\t\tthis\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toTheme( options?: DChartCoordinateLogOptions ): DThemeChartCoordinateLog {\r\n\t\treturn ( options && options.theme ) || this.getThemeDefault();\r\n\t}\r\n\r\n\tprotected getThemeDefault(): DThemeChartCoordinateLog {\r\n\t\treturn DThemes.getInstance().get( this.getType() );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartCoordinateLog\";\r\n\t}\r\n}\r\n"]}