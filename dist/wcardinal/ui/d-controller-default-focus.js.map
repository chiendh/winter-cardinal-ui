{"version":3,"file":"d-controller-default-focus.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-controller-default-focus.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport {\r\n\tDControllerFocus, DFocusable, DFocusableContainer, DFocusableMightBe\r\n} from \"./d-controller-focus\";\r\n\r\nconst isFocusable = ( target: any ): target is DFocusable => {\r\n\treturn ( target != null && (\"setState\" in target) );\r\n};\r\n\r\nconst isFocusableContainer = ( target: any ): target is DFocusableContainer => {\r\n\treturn ( target != null && \"children\" in target );\r\n};\r\n\r\nexport class DControllerDefaultFocus implements DControllerFocus {\r\n\tprivate _focused: DFocusable | null = null;\r\n\r\n\tsetFocused( focusable: DFocusable | null, isFocused: boolean, select: boolean ): DFocusable | null {\r\n\t\tif( isFocused ) {\r\n\t\t\tconst previous = this._focused;\r\n\t\t\tif( previous !== focusable ) {\r\n\t\t\t\tif( previous != null ) {\r\n\t\t\t\t\tprevious.setState( DBaseState.FOCUSED, false );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._focused = focusable;\r\n\t\t\t\tif( focusable != null && this.isFocusable( focusable ) ) {\r\n\t\t\t\t\tfocusable.setState( DBaseState.FOCUSED, true );\r\n\t\t\t\t}\r\n\t\t\t\treturn previous;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( focusable != null && this._focused === focusable ) {\r\n\t\t\t\tthis._focused = null;\r\n\t\t\t\tfocusable.setState( DBaseState.FOCUSED, false );\r\n\t\t\t\treturn focusable;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetFocused(): DFocusable | null {\r\n\t\treturn this._focused;\r\n\t}\r\n\r\n\tfindFocusableParent( mightBeFocusable: DFocusableMightBe | null ): DFocusable | null {\r\n\t\tlet current: DFocusableMightBe | DFocusableContainer | null = mightBeFocusable;\r\n\t\twhile( current != null ) {\r\n\t\t\tif( this.isFocusable( current ) ) {\r\n\t\t\t\treturn current;\r\n\t\t\t} else {\r\n\t\t\t\tcurrent = current.parent;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected isFocusable( target: unknown ): target is DFocusable {\r\n\t\treturn (\r\n\t\t\tisFocusable( target ) &&\r\n\t\t\t! target.hasState( DBaseState.DISABLED | DBaseState.UNFOCUSABLE ) &&\r\n\t\t\ttarget.visible\r\n\t\t);\r\n\t}\r\n\r\n\tprotected isFocusRoot( target: unknown ): target is DFocusable {\r\n\t\treturn (\r\n\t\t\tisFocusable( target ) &&\r\n\t\t\ttarget.hasState( DBaseState.FOCUS_ROOT ) &&\r\n\t\t\ttarget.visible\r\n\t\t);\r\n\t}\r\n\r\n\tfindFocusable(\r\n\t\ttarget: DFocusableMightBe, includesTarget: boolean, includesTargetChildren: boolean, direction: boolean\r\n\t): DFocusable | null {\r\n\t\tif( direction ) {\r\n\t\t\tconst result = this.findFocusableNext( target, includesTarget, includesTargetChildren );\r\n\t\t\tif( result != null ) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tconst parent = target.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tconst children = parent.children;\r\n\t\t\t\tconst index = children.indexOf( target );\r\n\t\t\t\tif( 0 <= index ) {\r\n\t\t\t\t\t// Siblings\r\n\t\t\t\t\tfor( let i = index + 1, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst found = this.findFocusableNext( children[ i ], true, true );\r\n\t\t\t\t\t\tif( found != null ) {\r\n\t\t\t\t\t\t\treturn found;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( this.isFocusRoot( parent ) ) {\r\n\t\t\t\t\t\tfor( let i = 0, imax = index + 1; i < imax; ++i ) {\r\n\t\t\t\t\t\t\tconst found = this.findFocusableNext( children[ i ], true, true );\r\n\t\t\t\t\t\t\tif( found != null ) {\r\n\t\t\t\t\t\t\t\treturn found;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Parent\r\n\t\t\t\t\treturn this.findFocusable( parent, false, false, true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst result = this.findFocusablePrevious( target, includesTarget, includesTargetChildren );\r\n\t\t\tif( result != null ) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tconst parent = target.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tconst children = parent.children;\r\n\t\t\t\tconst index = children.indexOf( target );\r\n\t\t\t\tif( 0 <= index ) {\r\n\t\t\t\t\t// Siblings\r\n\t\t\t\t\tfor( let i = index - 1; 0 <= i; --i ) {\r\n\t\t\t\t\t\tconst found = this.findFocusablePrevious( children[ i ], true, true );\r\n\t\t\t\t\t\tif( found != null ) {\r\n\t\t\t\t\t\t\treturn found;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( this.isFocusRoot( parent ) ) {\r\n\t\t\t\t\t\tfor( let i = children.length - 1; index <= i; --i ) {\r\n\t\t\t\t\t\t\tconst found = this.findFocusablePrevious( children[ i ], true, true );\r\n\t\t\t\t\t\t\tif( found != null ) {\r\n\t\t\t\t\t\t\t\treturn found;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn parent;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Parent\r\n\t\t\t\t\treturn this.findFocusable( parent, true, false, false );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected findFocusableNext(\r\n\t\ttarget: DFocusableMightBe, includesTarget: boolean, includesTargetChildren: boolean\r\n\t): DFocusable | null {\r\n\t\t// Target itself\r\n\t\tif( includesTarget ) {\r\n\t\t\tif( this.isFocusable( target ) ) {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Target children\r\n\t\tif( includesTargetChildren && isFocusableContainer( target ) && target.visible ) {\r\n\t\t\tconst children = target.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst found = this.findFocusableNext( children[ i ], true, true );\r\n\t\t\t\tif( found != null ) {\r\n\t\t\t\t\treturn found;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Siblings\r\n\t\tif( this.isFocusRoot( target ) ) {\r\n\t\t\treturn target;\r\n\t\t}\r\n\r\n\t\t// Found nothing\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected findFocusablePrevious(\r\n\t\ttarget: DFocusableMightBe, includesTarget: boolean, includesTargetChildren: boolean\r\n\t): DFocusable | null {\r\n\t\t// Target children\r\n\t\tif( includesTargetChildren && isFocusableContainer( target ) && target.visible ) {\r\n\t\t\tconst children = target.children;\r\n\t\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\t\tconst found = this.findFocusablePrevious( children[ i ], true, true );\r\n\t\t\t\tif( found != null ) {\r\n\t\t\t\t\treturn found;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Target itself\r\n\t\tif( includesTarget ) {\r\n\t\t\tif( this.isFocusable( target ) ) {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Siblings\r\n\t\tif( this.isFocusRoot( target ) ) {\r\n\t\t\treturn target;\r\n\t\t}\r\n\r\n\t\t// Found nothing\r\n\t\treturn null;\r\n\t}\r\n}\r\n"]}