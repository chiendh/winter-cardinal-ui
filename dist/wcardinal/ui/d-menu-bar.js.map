{"version":3,"file":"d-menu-bar.js","sourceRoot":"","sources":["../../../src/main/typescript/wcardinal/ui/d-menu-bar.ts"],"names":[],"mappings":"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","sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DBaseStates } from \"./d-base-states\";\r\nimport { DLayoutHorizontal, DLayoutHorizontalOptions, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DLayoutSpace, DLayoutSpaceOptions, DThemeLayoutSpace } from \"./d-layout-space\";\r\nimport { DMenuBarBlocker } from \"./d-menu-bar-blocker\";\r\nimport { DMenuBarItem, DMenuBarItemOptions, DThemeMenuBarItem } from \"./d-menu-bar-item\";\r\nimport { Closeable, DMenuContext } from \"./d-menu-context\";\r\nimport { UtilClickOutside } from \"./util/util-click-outside\";\r\nimport { UtilOverlay } from \"./util/util-overlay\";\r\n\r\nexport interface DMenuBarItemSpaceOptions<\r\n\tTHEME extends DThemeMenuBarItemSpace = DThemeMenuBarItemSpace\r\n> extends DLayoutSpaceOptions<THEME> {\r\n\tspace: true;\r\n}\r\n\r\nexport interface DThemeMenuBarItemSpace extends DThemeLayoutSpace {\r\n\r\n}\r\n\r\nexport interface DMenuBarOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuBar = DThemeMenuBar\r\n> extends DLayoutHorizontalOptions<THEME> {\r\n\titems?: Array<DMenuBarItemOptions<VALUE, DThemeMenuBarItem> | DMenuBarItemSpaceOptions | DisplayObject>;\r\n}\r\n\r\nexport interface DThemeMenuBar extends DThemeLayoutHorizontal {\r\n\r\n}\r\n\r\nexport class DMenuBar<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuBar = DThemeMenuBar,\r\n\tOPTIONS extends DMenuBarOptions<VALUE, THEME> = DMenuBarOptions<VALUE, THEME>\r\n>ã€€extends DLayoutHorizontal<THEME, OPTIONS> {\r\n\tprotected _context!: DMenuContext | null;\r\n\tprotected _blocker!: DMenuBarBlocker;\r\n\tprotected _overlay!: UtilOverlay;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.setState( DBaseState.FOCUS_ROOT, true );\r\n\r\n\t\tif( options != null && options.items != null ) {\r\n\t\t\tconst items = options.items;\r\n\t\t\tUtilClickOutside.apply( this, (): void => {\r\n\t\t\t\tthis.close();\r\n\t\t\t});\r\n\t\t\tconst onItemStateChangeBound = ( newState: DBaseState, oldState: DBaseState, item: DMenuBarItem<VALUE> ): void => {\r\n\t\t\t\tthis.onItemStateChange( newState, oldState, item );\r\n\t\t\t};\r\n\t\t\tfor( let i = 0, imax = items.length; i < imax; ++i ) {\r\n\t\t\t\tconst itemOrItemOptions = items[ i ];\r\n\t\t\t\tconst item = ( itemOrItemOptions instanceof DisplayObject ? itemOrItemOptions :\r\n\t\t\t\t\t( \"space\" in itemOrItemOptions ? new DLayoutSpace( itemOrItemOptions ) :\r\n\t\t\t\t\t\tnew DMenuBarItem<VALUE>( itemOrItemOptions )\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t\tif( item instanceof DMenuBarItem ) {\r\n\t\t\t\t\titem.on( \"statechange\", onItemStateChangeBound );\r\n\t\t\t\t}\r\n\t\t\t\tthis.addChild( item );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.on( \"select\", (): void => {\r\n\t\t\tthis.close();\r\n\t\t});\r\n\r\n\t\tthis._context = null;\r\n\t\tthis._blocker = new DMenuBarBlocker( this );\r\n\t\tthis._overlay = new UtilOverlay( options );\r\n\t}\r\n\r\n\tprotected onItemStateChange( newState: DBaseState, oldState: DBaseState, item: DMenuBarItem<VALUE> ): void {\r\n\t\tconst context = this._context;\r\n\t\tif( context == null ) {\r\n\t\t\tif( ! DBaseStates.isDisabled( newState ) ) {\r\n\t\t\t\tif( DBaseStates.isPressed( newState ) ) {\r\n\t\t\t\t\tif( item.menu.isHidden() ) {\r\n\t\t\t\t\t\titem.setPressed( false );\r\n\t\t\t\t\t\tthis.open( item );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( ! DBaseStates.isDisabled( newState ) ) {\r\n\t\t\t\tif( DBaseStates.isHovered( newState ) && ! DBaseStates.isHovered( oldState ) ) {\r\n\t\t\t\t\tconst menu = item.menu;\r\n\t\t\t\t\tif( menu.isHidden() ) {\r\n\t\t\t\t\t\tmenu.open( item, this, context );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetContext(): DMenuContext | null {\r\n\t\treturn this._context;\r\n\t}\r\n\r\n\tgetCloseable(): Closeable | null {\r\n\t\treturn this;\r\n\t}\r\n\r\n\topen( item: DMenuBarItem<VALUE> ): void {\r\n\t\tlet context = this._context;\r\n\t\tif( context == null ) {\r\n\t\t\tconst layer = this._overlay.pick( this );\r\n\t\t\tlayer.stage.addChild( this._blocker );\r\n\t\t\tcontext = this._context = new DMenuContext( this );\r\n\t\t\tcontext.trim( item );\r\n\t\t\tcontext.add( this );\r\n\t\t\titem.menu.open( item, this, context );\r\n\t\t}\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tconst context = this._context;\r\n\t\tif( context != null ) {\r\n\t\t\tthis._context = null;\r\n\t\t\tcontext.remove( this );\r\n\t\t\tconst blocker = this._blocker;\r\n\t\t\tconst parent = blocker.parent;\r\n\t\t\tif( parent ) {\r\n\t\t\t\tparent.removeChild( blocker );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuBar\";\r\n\t}\r\n}\r\n"]}