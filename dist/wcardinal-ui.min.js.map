{"version":3,"file":"wcardinal-ui.min.js","sources":["wcardinal/ui/shape/e-shape-deserializers.ts","wcardinal/ui/shape/e-shape-type.ts","wcardinal/ui/shape/e-shape-uploadeds.ts","wcardinal/ui/shape/e-shape-points-style.ts","wcardinal/ui/shape/variant/to-dash.ts","wcardinal/ui/shape/e-shape-text.ts","wcardinal/ui/shape/e-shape-text-align-horizontal.ts","wcardinal/ui/shape/e-shape-text-align-vertical.ts","wcardinal/ui/shape/e-shape-text-direction.ts","wcardinal/ui/shape/variant/to-scale-invariant.ts","wcardinal/ui/shape/variant/build-bar.ts","wcardinal/ui/util/util-character-iterator.ts","wcardinal/ui/shape/variant/to-length.ts","wcardinal/ui/shape/variant/e-shape-bar-position.ts","wcardinal/ui/shape/variant/build-text.ts","../../../node_modules/tslib/tslib.es6.js","wcardinal/ui/shape/variant/e-shape-bar-points.ts","wcardinal/ui/d-base-state.ts","wcardinal/ui/d-applications.ts","wcardinal/ui/shape/action/e-shape-action.ts","wcardinal/ui/shape/e-shape.ts","wcardinal/ui/util/is-string.ts","wcardinal/ui/shape/e-shape-runtime.ts","wcardinal/ui/util/util-keyboard-event.ts","wcardinal/ui/shape/e-shape-corner.ts","wcardinal/ui/shape/e-shape-stroke-side.ts","wcardinal/ui/shape/e-shape-transform.ts","wcardinal/ui/util/to-padded.ts","wcardinal/ui/util/util-rgb.ts","wcardinal/ui/shape/variant/e-shape-gradients.ts","wcardinal/ui/shape/variant/e-shape-base.ts","wcardinal/ui/shape/e-shape-defaults.ts","wcardinal/ui/shape/e-shape-tag-value.ts","wcardinal/ui/shape/e-shape-tag-value-range.ts","wcardinal/ui/shape/variant/e-shape-fill-impl.ts","wcardinal/ui/shape/variant/e-shape-stroke-impl.ts","wcardinal/ui/shape/variant/e-shape-tag-value-range-impl.ts","wcardinal/ui/d-border-mask.ts","wcardinal/ui/shape/variant/e-shape-tag-value-impl.ts","wcardinal/ui/shape/variant/e-shape-tag-impl.ts","wcardinal/ui/shape/variant/e-shape-text-align-impl.ts","wcardinal/ui/shape/variant/e-shape-text-offset-impl.ts","wcardinal/ui/shape/variant/e-shape-text-outline-impl.ts","wcardinal/ui/shape/variant/e-shape-text-impl.ts","wcardinal/ui/shape/variant/e-shape-primitive.ts","wcardinal/ui/shape/variant/e-shape-line-base.ts","wcardinal/ui/shape/variant/e-shape-bar.ts","wcardinal/ui/shape/variant/build-color.ts","wcardinal/ui/shape/e-shape-uploaded.ts","wcardinal/ui/shape/variant/e-shape-text-uploaded.ts","wcardinal/ui/shape/variant/e-shape-bar-uploaded.ts","wcardinal/ui/shape/variant/create-bar-uploaded.ts","wcardinal/ui/util/is-array.ts","wcardinal/ui/util/is-number.ts","wcardinal/ui/shape/action/e-shape-action-bases.ts","wcardinal/ui/util/is-function.ts","wcardinal/ui/d-base-background.ts","wcardinal/ui/d-base-border.ts","wcardinal/ui/d-corner-mask.ts","wcardinal/ui/d-base-corner.ts","wcardinal/ui/d-base-interactive.ts","wcardinal/ui/d-base-outline.ts","wcardinal/ui/d-layout-clear-type.ts","wcardinal/ui/d-scalar-expression.ts","wcardinal/ui/d-base-padding.ts","wcardinal/ui/d-base-point.ts","wcardinal/ui/d-base-background-mesh-geometry.ts","wcardinal/ui/d-base-background-mesh.ts","wcardinal/ui/d-base-border-mesh-geometry.ts","wcardinal/ui/d-base-border-mesh.ts","wcardinal/ui/d-base-outline-mesh.ts","wcardinal/ui/d-base-reflowable.ts","wcardinal/ui/d-base-states.ts","wcardinal/ui/d-base.ts","wcardinal/ui/d-scalar-functions.ts","wcardinal/ui/theme/d-themes.ts","wcardinal/ui/util/util-pointer-event.ts","wcardinal/ui/d-mouse-modifier.ts","wcardinal/ui/d-base-overflow-mask.ts","wcardinal/ui/d-mouse-modifiers.ts","wcardinal/ui/d-drag-mode.ts","wcardinal/ui/d-animation-timings.ts","wcardinal/ui/shape/action/e-shape-action-value-blink-type.ts","wcardinal/ui/d-animation-base.ts","wcardinal/ui/util/util-drag-easing-history.ts","wcardinal/ui/util/util-drag-easing.ts","wcardinal/ui/util/util-drag.ts","wcardinal/ui/d-view-drag-impl.ts","wcardinal/ui/d-view-transform-impl.ts","wcardinal/ui/d-view-impl.ts","wcardinal/ui/d-canvas-container.ts","wcardinal/ui/shape/action/e-shape-action-runtime.ts","wcardinal/ui/shape/action/e-shape-action-runtime-conditional.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-brighten.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-color-fill.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-color-stroke.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-darken.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-opacity.ts","wcardinal/ui/shape/action/e-shape-action-runtime-blink-visibility.ts","wcardinal/ui/shape/action/e-shape-action-value-base.ts","wcardinal/ui/shape/action/e-shape-action-value-type.ts","wcardinal/ui/shape/action/e-shape-action-value-subtyped.ts","wcardinal/ui/shape/action/e-shape-action-values.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-target.ts","wcardinal/ui/shape/action/e-shape-action-value-blink.ts","wcardinal/ui/util/util-alpha.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-all.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-fill.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-fill-and-stroke.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-stroke.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-text.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-text-outline.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color.ts","wcardinal/ui/shape/action/e-shape-action-value-change-text-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-brightness.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-brightness-all.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-brightness-fill.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-brightness-fill-and-stroke.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-brightness-stroke.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-brightness-text.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-brightness-text-outline.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-brightness.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-code.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-code-all.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-code-fill.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-code-fill-and-stroke.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-code-stroke.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-code-text.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-color-code-text-outline.ts","wcardinal/ui/shape/action/e-shape-action-value-change-color-code.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-cursor.ts","wcardinal/ui/shape/action/e-shape-action-value-change-cursor.ts","wcardinal/ui/util/format-node/format-node-a-large.ts","wcardinal/ui/util/format-node/format-node-a-small.ts","wcardinal/ui/util/format-node/format-node-d-large.ts","wcardinal/ui/util/format-node/format-node-d-small.ts","wcardinal/ui/util/format-node/format-node-precision.ts","wcardinal/ui/util/format-node/format-node-e.ts","wcardinal/ui/util/format-node/format-node-f.ts","wcardinal/ui/util/format-node/format-node-fsi.ts","wcardinal/ui/util/format-node/format-node-g.ts","wcardinal/ui/util/format-node/format-node-h-large.ts","wcardinal/ui/util/format-node/format-node-h-small.ts","wcardinal/ui/util/format-node/format-node-m-large.ts","wcardinal/ui/util/format-node/format-node-m-small.ts","wcardinal/ui/util/format-node/format-node-mi.ts","wcardinal/ui/util/format-node/format-node-p-large.ts","wcardinal/ui/util/format-node/format-node-p-small.ts","wcardinal/ui/util/format-node/format-node-padding.ts","wcardinal/ui/util/format-node/format-node-parenthesis.ts","wcardinal/ui/util/format-node/format-node-plus.ts","wcardinal/ui/util/format-node/format-node-rp-large.ts","wcardinal/ui/util/format-node/format-node-rp-small.ts","wcardinal/ui/util/format-node/format-node-sdt.ts","wcardinal/ui/util/format-node/format-node-space.ts","wcardinal/ui/util/format-node/format-node-ssi.ts","wcardinal/ui/util/format-node/format-node-string.ts","wcardinal/ui/util/format-node/format-node-y-large.ts","wcardinal/ui/util/format-node/format-node-y-small.ts","wcardinal/ui/util/format-node/format-node-z.ts","wcardinal/ui/util/format-node/format-noder-d.ts","wcardinal/ui/util/format-node/format-nodes.ts","wcardinal/ui/util/number-formatter-impl.ts","wcardinal/ui/util/number-formatters.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-text-number.ts","wcardinal/ui/shape/action/e-shape-action-runtime-change-text-text.ts","wcardinal/ui/shape/action/e-shape-action-value-change-text.ts","wcardinal/ui/shape/action/e-shape-action-value-misc-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-emit-event.ts","wcardinal/ui/shape/action/e-shape-action-value-emit-event.ts","wcardinal/ui/util/ascii.ts","wcardinal/ui/util/dynamic-font-atlas-chaaracter-origin.ts","wcardinal/ui/util/dynamic-font-atlas-character.ts","wcardinal/ui/util/dynamic-sdf-font-generator.ts","wcardinal/ui/util/dynamic-sdf-font-atlas.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-input-data.ts","wcardinal/ui/shape/action/e-shape-action-runtime-misc-input.ts","wcardinal/ui/shape/action/e-shape-action-value-misc.ts","wcardinal/ui/shape/action/e-shape-action-value-open-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-flow.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-page.ts","wcardinal/ui/shape/action/e-shape-action-runtime-open-page-inplace.ts","wcardinal/ui/shape/action/e-shape-action-value-open.ts","wcardinal/ui/shape/action/e-shape-action-value-show-hide-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-show-hide.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-move-type.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-type.ts","wcardinal/ui/shape/action/e-shape-action-value-show-hide.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-absolute-x.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-absolute-y.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-forward-or-backward.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-left-or-right.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-relative-x.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-move-relative-y.ts","wcardinal/ui/shape/action/e-shape-action-value-opetyped.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-move.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-resize-type.ts","wcardinal/ui/shape/e-shape-sizes.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-rotate-type.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-height-absolute.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-height-relative.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-size-absolute.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-size-relative.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-width-absolute.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-resize-width-relative.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-resize.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-rotate.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-rotate-absolute.ts","wcardinal/ui/shape/action/e-shape-action-runtime-transform-rotate-relative.ts","wcardinal/ui/shape/action/e-shape-action-value-transform-rotate.ts","wcardinal/ui/shape/action/e-shape-action-value-deserializer.ts","wcardinal/ui/shape/e-shape-image-elements.ts","wcardinal/ui/shape/e-shape-resource-manager-deserialization.ts","wcardinal/ui/shape/e-shape-deserializer.ts","wcardinal/ui/shape/variant/deserialize-bar.ts","wcardinal/ui/shape/load/load-shape-bar.ts","wcardinal/ui/shape/variant/build-step.ts","wcardinal/ui/shape/variant/to-step.ts","wcardinal/ui/shape/variant/build-circle.ts","wcardinal/ui/shape/variant/e-shape-circle-uploaded.ts","wcardinal/ui/shape/variant/create-circle-uploaded.ts","wcardinal/ui/shape/variant/e-shape-circle.ts","wcardinal/ui/shape/variant/deserialize-circle.ts","wcardinal/ui/shape/load/load-shape-circle.ts","wcardinal/ui/shape/variant/e-shape-group-uploaded.ts","wcardinal/ui/shape/variant/create-group-uploaded.ts","wcardinal/ui/shape/variant/e-shape-group-fill-editor.ts","wcardinal/ui/shape/variant/e-shape-group-points.ts","wcardinal/ui/shape/e-shape-editor.ts","wcardinal/ui/shape/e-shape-transforms.ts","wcardinal/ui/shape/variant/e-shape-group-size-layout.ts","wcardinal/ui/shape/variant/e-shape-group-size-editor.ts","wcardinal/ui/shape/variant/e-shape-group-size-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-stroke-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-align-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-offset-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-outline-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-padding-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-spacing-editor.ts","wcardinal/ui/shape/variant/e-shape-group-text-editor.ts","wcardinal/ui/shape/variant/e-shape-group.ts","wcardinal/ui/shape/variant/deserialize-group.ts","wcardinal/ui/shape/load/load-shape-group.ts","wcardinal/ui/shape/variant/e-shape-group-size-shadowed.ts","wcardinal/ui/shape/variant/e-shape-group-shadowed.ts","wcardinal/ui/shape/variant/deserialize-group-shadowed.ts","wcardinal/ui/shape/load/load-shape-group-shadowed.ts","wcardinal/ui/shape/variant/build-rectangle.ts","wcardinal/ui/shape/variant/e-shape-rectangle-uploaded.ts","wcardinal/ui/shape/variant/create-rectangle-uploaded.ts","wcardinal/ui/shape/variant/e-shape-rectangle.ts","wcardinal/ui/shape/variant/e-shape-image.ts","wcardinal/ui/shape/variant/deserialize-image.ts","wcardinal/ui/shape/load/load-shape-image.ts","wcardinal/ui/shape/variant/build-image-sdf.ts","wcardinal/ui/shape/variant/e-shape-image-sdf-uploaded.ts","wcardinal/ui/shape/variant/create-image-sdf-uploaded.ts","wcardinal/ui/shape/variant/e-shape-image-sdf.ts","wcardinal/ui/shape/variant/deserialize-image-sdf.ts","wcardinal/ui/shape/variant/e-shape-label-uploaded.ts","wcardinal/ui/shape/variant/create-label-uploaded.ts","wcardinal/ui/shape/variant/e-shape-label.ts","wcardinal/ui/shape/variant/deserialize-label.ts","wcardinal/ui/shape/load/load-shape-label.ts","wcardinal/ui/util/to-index-of.ts","wcardinal/ui/shape/variant/build-line.ts","wcardinal/ui/shape/variant/e-shape-line-uploaded.ts","wcardinal/ui/shape/variant/create-line-uploaded.ts","wcardinal/ui/shape/variant/e-shape-line-points.ts","wcardinal/ui/shape/variant/e-shape-line.ts","wcardinal/ui/shape/variant/deserialize-line.ts","wcardinal/ui/shape/load/load-shape-line.ts","wcardinal/ui/shape/variant/build-line-of-any.ts","wcardinal/ui/shape/variant/create-line-of-any-uploaded.ts","wcardinal/ui/shape/variant/build-null.ts","wcardinal/ui/shape/variant/copy-clipping.ts","wcardinal/ui/shape/variant/copy-index.ts","wcardinal/ui/shape/variant/copy-step.ts","wcardinal/ui/shape/variant/copy-uv.ts","wcardinal/ui/shape/variant/copy-vertex.ts","wcardinal/ui/shape/variant/is-static.ts","wcardinal/ui/shape/variant/to-computed.ts","wcardinal/ui/shape/variant/e-shape-line-of-any-points-fill-impl.ts","wcardinal/ui/util/dynamic-atlas-item.ts","wcardinal/ui/util/dynamic-atlas-item-empty.ts","wcardinal/ui/util/dynamic-atlas-item-font-atlas.ts","wcardinal/ui/util/dynamic-atlas-item-image.ts","wcardinal/ui/util/dynamic-atlas-item-text.ts","wcardinal/ui/util/dynamic-atlas-item-white.ts","wcardinal/ui/util/dynamic-atlas.ts","wcardinal/ui/util/dynamic-font-atlas-font.ts","wcardinal/ui/util/dynamic-font-atlas.ts","wcardinal/ui/util/dynamic-font-atlases.ts","wcardinal/ui/util/dynamic-sdf-font-atlases.ts","wcardinal/ui/util/is-nan.ts","wcardinal/ui/util/lazy.ts","wcardinal/ui/util/to-ceiling-index.ts","wcardinal/ui/util/to-string.ts","wcardinal/ui/util/to-svg-url.ts","wcardinal/ui/resource/svg-resource.ts","wcardinal/ui/util/util-svg-atlas-builder.ts","wcardinal/ui/util/util-attach.ts","wcardinal/ui/util/util-file-opener.ts","wcardinal/ui/util/util-click-outside.ts","wcardinal/ui/util/util-clipboard.ts","wcardinal/ui/util/util-extractor.ts","wcardinal/ui/util/util-file-downloader.ts","wcardinal/ui/util/util-extract.ts","wcardinal/ui/shape/e-shape-capability.ts","wcardinal/ui/util/util-hsv.ts","wcardinal/ui/util/util-name.ts","wcardinal/ui/util/util-overlay.ts","wcardinal/ui/util/util-promise.ts","wcardinal/ui/util/util-rgba.ts","wcardinal/ui/util/util-texture-plane.ts","wcardinal/ui/util/util-texture.ts","wcardinal/ui/util/util-transition.ts","wcardinal/ui/util/util-wheel-event.ts","wcardinal/ui/shape/variant/e-shape-line-of-any-points-point-impl.ts","wcardinal/ui/shape/variant/e-shape-line-of-any-points-stroke-impl.ts","wcardinal/ui/shape/variant/e-shape-line-of-any-points-impl.ts","wcardinal/ui/shape/variant/e-shape-line-of-any-uploaded.ts","wcardinal/ui/shape/variant/e-shape-line-of-circles-uploaded.ts","wcardinal/ui/shape/variant/create-line-of-circles-uploaded.ts","wcardinal/ui/shape/variant/to-hit-threshold.ts","wcardinal/ui/shape/variant/e-shape-line-of-circles.ts","wcardinal/ui/shape/variant/deserialize-line-of-circles.ts","wcardinal/ui/shape/load/load-shape-line-of-circles.ts","wcardinal/ui/shape/e-shape-capabilities.ts","wcardinal/ui/d-align-horizontal.ts","wcardinal/ui/d-align-vertical.ts","wcardinal/ui/d-align-with.ts","wcardinal/ui/shape/variant/build-rectangle-rounded.ts","wcardinal/ui/shape/variant/e-shape-line-of-rectangle-roundeds-uploaded.ts","wcardinal/ui/shape/variant/create-line-of-rectangle-roundeds-uploaded.ts","wcardinal/ui/shape/variant/e-shape-rectangle-rounded.ts","wcardinal/ui/shape/variant/e-shape-line-of-rectangle-roundeds.ts","wcardinal/ui/shape/variant/deserialize-line-of-rectangle-roundeds.ts","wcardinal/ui/shape/load/load-shape-line-of-rectangle-roundeds.ts","wcardinal/ui/shape/variant/e-shape-line-of-rectangles-uploaded.ts","wcardinal/ui/shape/variant/create-line-of-rectangles-uploaded.ts","wcardinal/ui/shape/variant/e-shape-line-of-rectangles.ts","wcardinal/ui/shape/variant/deserialize-line-of-rectangles.ts","wcardinal/ui/shape/load/load-shape-line-of-rectangles.ts","wcardinal/ui/shape/variant/build-triangle-rounded.ts","wcardinal/ui/shape/variant/e-shape-line-of-triangle-roundeds-uploaded.ts","wcardinal/ui/shape/variant/create-line-of-triangle-roundeds-uploaded.ts","wcardinal/ui/shape/variant/e-shape-triangle.ts","wcardinal/ui/shape/variant/e-shape-triangle-rounded.ts","wcardinal/ui/shape/variant/e-shape-line-of-triangle-roundeds.ts","wcardinal/ui/shape/variant/deserialize-line-of-triangle-roundeds.ts","wcardinal/ui/shape/load/load-shape-line-of-triangle-roundeds.ts","wcardinal/ui/shape/variant/build-triangle.ts","wcardinal/ui/shape/variant/e-shape-line-of-triangles-uploaded.ts","wcardinal/ui/shape/variant/create-line-of-triangles-uploaded.ts","wcardinal/ui/shape/variant/e-shape-line-of-triangles.ts","wcardinal/ui/shape/variant/deserialize-line-of-triangles.ts","wcardinal/ui/shape/load/load-shape-line-of-triangles.ts","wcardinal/ui/shape/variant/e-shape-null-uploaded.ts","wcardinal/ui/shape/variant/create-null-uploaded.ts","wcardinal/ui/shape/variant/e-shape-null.ts","wcardinal/ui/shape/variant/deserialize-null.ts","wcardinal/ui/shape/load/load-shape-null.ts","wcardinal/ui/shape/variant/deserialize-rectangle.ts","wcardinal/ui/shape/load/load-shape-rectangle.ts","wcardinal/ui/shape/variant/e-shape-rectangle-rounded-uploaded.ts","wcardinal/ui/shape/variant/create-rectangle-rounded-uploaded.ts","wcardinal/ui/shape/variant/deserialize-rectangle-rounded.ts","wcardinal/ui/shape/load/load-shape-rectangle-rounded.ts","wcardinal/ui/shape/variant/e-shape-triangle-uploaded.ts","wcardinal/ui/shape/variant/create-triangle-uploaded.ts","wcardinal/ui/shape/variant/deserialize-triangle.ts","wcardinal/ui/shape/load/load-shape-triangle.ts","wcardinal/ui/shape/variant/e-shape-triangle-rounded-uploaded.ts","wcardinal/ui/shape/variant/create-triangle-rounded-uploaded.ts","wcardinal/ui/shape/variant/deserialize-triangle-rounded.ts","wcardinal/ui/shape/load/load-shape-triangle-rounded.ts","wcardinal/ui/shape/load/load-shape-all.ts","wcardinal/ui/shape/load/load-shape-image-sdf.ts","wcardinal/ui/d-dynamic-text-measure-result-character.ts","wcardinal/ui/d-dynamic-text-measure-result.ts","wcardinal/ui/d-dynamic-text-measure.ts","wcardinal/ui/d-dynamic-text-geometry.ts","wcardinal/ui/d-dynamic-text-style.ts","wcardinal/ui/d-dynamic-text.ts","wcardinal/ui/d-image-base-theme-wrapper-secondary.ts","wcardinal/ui/d-link-menu-item-id.ts","wcardinal/ui/d-link-target.ts","wcardinal/ui/d-image-base-theme-wrapper-tertiary.ts","wcardinal/ui/d-image-piece.ts","wcardinal/ui/d-base-overflow-mask-simple.ts","wcardinal/ui/d-text-base.ts","wcardinal/ui/d-image-base.ts","wcardinal/ui/d-image.ts","wcardinal/ui/d-list-item.ts","wcardinal/ui/d-menu-item.ts","wcardinal/ui/d-menu-item-text.ts","wcardinal/ui/d-menu-item-check.ts","wcardinal/ui/d-menus.ts","wcardinal/ui/d-layout-direction.ts","wcardinal/ui/d-link.ts","wcardinal/ui/d-menu-item-link-state.ts","wcardinal/ui/d-menu-item-link.ts","wcardinal/ui/d-menu-align.ts","wcardinal/ui/d-menu-item-menu.ts","wcardinal/ui/d-list-item-separator-reflowable.ts","wcardinal/ui/d-list-item-separator.ts","wcardinal/ui/d-menu-item-separator.ts","wcardinal/ui/d-layout-space.ts","wcardinal/ui/d-menu-item-space.ts","wcardinal/ui/load/load-menu-item.ts","wcardinal/ui/d-layout.ts","wcardinal/ui/snapper/e-snapper-target-value.ts","wcardinal/ui/d-layout-vertical.ts","wcardinal/ui/d-menu-item-expandable-body.ts","wcardinal/ui/d-menu-item-expandable-header.ts","wcardinal/ui/d-menu-item-expandables.ts","wcardinal/ui/d-menu-item-expandable.ts","wcardinal/ui/d-menu-item-expandable-item-check.ts","wcardinal/ui/d-menu-item-expandable-item-link.ts","wcardinal/ui/d-menu-item-expandable-item-separator.ts","wcardinal/ui/d-menu-item-expandable-item-space.ts","wcardinal/ui/d-menu-item-expandable-item-text.ts","wcardinal/ui/load/load-menu-item-expandable.ts","wcardinal/ui/d-menu-sided-item-check.ts","wcardinal/ui/d-menu-sided-item-link.ts","wcardinal/ui/d-menu-sided-item-menu.ts","wcardinal/ui/d-menu-sided-item-separator.ts","wcardinal/ui/d-menu-sided-item-space.ts","wcardinal/ui/d-menu-sided-item-text.ts","wcardinal/ui/d-menu-sideds.ts","wcardinal/ui/load/load-menu-sided-item.ts","wcardinal/ui/d-menu-sided-item-expandables.ts","wcardinal/ui/d-menu-sided-item-expandable.ts","wcardinal/ui/d-menu-sided-item-expandable-item-check.ts","wcardinal/ui/d-menu-sided-item-expandable-item-link.ts","wcardinal/ui/d-menu-item-expandable-item-menu.ts","wcardinal/ui/d-menu-sided-item-expandable-item-menu.ts","wcardinal/ui/d-menu-sided-item-expandable-item-separator.ts","wcardinal/ui/d-menu-sided-item-expandable-item-space.ts","wcardinal/ui/d-menu-sided-item-expandable-item-text.ts","wcardinal/ui/load/load-menu-sided-item-expandable.ts","wcardinal/ui/load/load-menu-item-all.ts","wcardinal/ui/load/load-all.ts","wcardinal/ui/shape/variant/create-image-sdf.ts","wcardinal/ui/shape/variant/e-shape-group-fill-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-stroke-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-align-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-offset-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-outline-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-padding-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-spacing-viewer.ts","wcardinal/ui/shape/variant/e-shape-group-text-viewer.ts","wcardinal/ui/shape/e-shape-buffer-unit.ts","wcardinal/ui/shape/e-shape-buffer-unit-builder.ts","wcardinal/ui/shape/e-shape-buffer.ts","wcardinal/ui/shape/e-shape-renderer-iterator-datum.ts","wcardinal/ui/shape/e-shape-renderer-iterator.ts","wcardinal/ui/shape/e-shape-renderer.ts","wcardinal/ui/shape/e-shape-container.ts","wcardinal/ui/shape/e-shape-search.ts","wcardinal/ui/shape/e-shape-deleter.ts","wcardinal/ui/shape/e-shape-resource-manager-serialization.ts","wcardinal/ui/shape/e-shape-runtimes.ts","wcardinal/ui/snapper/e-snapper-grid.ts","wcardinal/ui/snapper/e-snapper-result.ts","wcardinal/ui/snapper/e-snapper.ts","wcardinal/ui/snapper/e-snapper-target.ts","wcardinal/ui/d-command-flag.ts","wcardinal/ui/d-animation-empty.ts","wcardinal/ui/d-animation-fade-in.ts","wcardinal/ui/d-application-padding.ts","wcardinal/ui/d-application-layer-options.ts","wcardinal/ui/d-controller-default-focus.ts","wcardinal/ui/d-command-clear.ts","wcardinal/ui/d-dialog-close-on.ts","wcardinal/ui/d-command-redo.ts","wcardinal/ui/d-command-undo.ts","wcardinal/ui/d-controller-default-command.ts","wcardinal/ui/d-controller-keyboard.ts","wcardinal/ui/d-controllers.ts","wcardinal/ui/d-application-layer.ts","wcardinal/ui/d-application.ts","wcardinal/ui/d-board.ts","wcardinal/ui/d-button-base.ts","wcardinal/ui/d-button.ts","wcardinal/ui/d-button-ambient.ts","wcardinal/ui/d-button-check.ts","wcardinal/ui/d-button-check-right.ts","wcardinal/ui/d-button-primary.ts","wcardinal/ui/d-dialog.ts","wcardinal/ui/d-html-element-when.ts","wcardinal/ui/d-layout-horizontal.ts","wcardinal/ui/d-dialog-command.ts","wcardinal/ui/d-html-element.ts","wcardinal/ui/d-picker-datetime-mask.ts","wcardinal/ui/d-input.ts","wcardinal/ui/d-input-number.ts","wcardinal/ui/d-input-real.ts","wcardinal/ui/d-text.ts","wcardinal/ui/d-input-label.ts","wcardinal/ui/d-input-and-label.ts","wcardinal/ui/d-input-real-and-label.ts","wcardinal/ui/d-input-text.ts","wcardinal/ui/d-input-text-and-label.ts","wcardinal/ui/d-picker-color-and-alpha.ts","wcardinal/ui/d-picker-color-recent.ts","wcardinal/ui/d-picker-color.ts","wcardinal/ui/d-picker-color-gradient-point.ts","wcardinal/ui/d-picker-color-gradient-data.ts","wcardinal/ui/d-picker-color-gradient-data-view.ts","wcardinal/ui/d-picker-color-gradient-recent.ts","wcardinal/ui/d-picker-color-gradient.ts","wcardinal/ui/d-dialog-color-gradient.ts","wcardinal/ui/d-button-color-gradient.ts","wcardinal/ui/d-dialog-color.ts","wcardinal/ui/d-button-color.ts","wcardinal/ui/d-button-danger.ts","wcardinal/ui/d-picker-datetime-button-back.ts","wcardinal/ui/d-picker-datetime-button-date.ts","wcardinal/ui/d-picker-datetime-button-next.ts","wcardinal/ui/d-picker-datetime-label.ts","wcardinal/ui/d-picker-datetime-label-date.ts","wcardinal/ui/d-picker-datetime-space.ts","wcardinal/ui/d-input-integer.ts","wcardinal/ui/d-picker-time-bound.ts","wcardinal/ui/d-list-selection.ts","wcardinal/ui/d-picker-time-bound-hours.ts","wcardinal/ui/d-picker-time-bound-minutes.ts","wcardinal/ui/d-picker-time-bound-seconds.ts","wcardinal/ui/d-picker-time-bounds.ts","wcardinal/ui/d-picker-time.ts","wcardinal/ui/d-picker-datetime.ts","wcardinal/ui/d-picker-date.ts","wcardinal/ui/d-dialog-date.ts","wcardinal/ui/d-dialog-dates.ts","wcardinal/ui/d-button-date.ts","wcardinal/ui/d-dialog-datetime.ts","wcardinal/ui/d-dialog-datetimes.ts","wcardinal/ui/d-picker-dates.ts","wcardinal/ui/d-picker-times.ts","wcardinal/ui/d-picker-datetimes.ts","wcardinal/ui/d-button-datetime.ts","wcardinal/ui/d-button-file.ts","wcardinal/ui/d-button-group.ts","wcardinal/ui/d-button-link.ts","wcardinal/ui/d-button-radio.ts","wcardinal/ui/d-button-radio-right.ts","wcardinal/ui/d-button-redo.ts","wcardinal/ui/d-button-secondary.ts","wcardinal/ui/d-chart-axis-position.ts","wcardinal/ui/d-chart-axis-tick-position.ts","wcardinal/ui/d-content.ts","wcardinal/ui/d-scroll-bar.ts","wcardinal/ui/d-scroll-bar-thumb.ts","wcardinal/ui/d-scroll-bar-thumb-reflowable-horizontal.ts","wcardinal/ui/d-scroll-bar-thumb-horizontal.ts","wcardinal/ui/d-scroll-bar-horizontal.ts","wcardinal/ui/d-scroll-bar-thumb-reflowable-vertical.ts","wcardinal/ui/d-scroll-bar-thumb-vertical.ts","wcardinal/ui/d-scroll-bar-vertical.ts","wcardinal/ui/d-pane.ts","wcardinal/ui/d-list.ts","wcardinal/ui/d-dialog-select-list.ts","wcardinal/ui/d-dialog-select-list-item.ts","wcardinal/ui/d-dialog-select-search.ts","wcardinal/ui/d-note.ts","wcardinal/ui/d-dialog-select.ts","wcardinal/ui/d-button-select.ts","wcardinal/ui/d-dialog-time.ts","wcardinal/ui/d-dialog-times.ts","wcardinal/ui/d-button-time.ts","wcardinal/ui/d-button-undo.ts","wcardinal/ui/d-canvas.ts","wcardinal/ui/shape/e-shape-points-styles.ts","wcardinal/ui/d-chart-coordinate.ts","wcardinal/ui/d-chart-axis-base-options-parser.ts","wcardinal/ui/d-chart-axis-base.ts","wcardinal/ui/d-chart-axis-container-impl.ts","wcardinal/ui/d-chart-axis-x.ts","wcardinal/ui/d-chart-axis-x-datetime.ts","wcardinal/ui/d-chart-axis-y.ts","wcardinal/ui/d-chart-color-set.ts","wcardinal/ui/d-chart-coordinate-container-sub-impl.ts","wcardinal/ui/d-chart-selection.ts","wcardinal/ui/d-chart-coordinate-container-impl.ts","wcardinal/ui/d-chart-coordinate-linear-tick.ts","wcardinal/ui/d-chart-coordinate-transform-impl.ts","wcardinal/ui/d-chart-coordinate-transform-mark.ts","wcardinal/ui/d-chart-region-impl.ts","wcardinal/ui/d-chart-coordinate-linear.ts","wcardinal/ui/d-chart-coordinate-log-tick.ts","wcardinal/ui/d-chart-coordinate-log.ts","wcardinal/ui/d-chart-legend-item.ts","wcardinal/ui/d-chart-legend.ts","wcardinal/ui/d-chart-overview.ts","wcardinal/ui/d-chart-plot-area-container.ts","wcardinal/ui/d-chart-series.ts","wcardinal/ui/d-chart-series-fill-computed-impl.ts","wcardinal/ui/d-chart-series-scalar.ts","wcardinal/ui/d-chart-series-fill-impl.ts","wcardinal/ui/d-chart-series-padding-computed-impl.ts","wcardinal/ui/d-chart-series-padding-impl.ts","wcardinal/ui/d-chart-series-point-computed-impl.ts","wcardinal/ui/d-chart-series-point-impl.ts","wcardinal/ui/d-chart-series-stroke-computed-impl.ts","wcardinal/ui/d-chart-series-stroke-impl.ts","wcardinal/ui/d-chart-series-container-impl.ts","wcardinal/ui/d-chart-plot-area.ts","wcardinal/ui/d-chart-region-impl-observable.ts","wcardinal/ui/d-chart-series-base-coordinate-container.ts","wcardinal/ui/d-chart-series-base.ts","wcardinal/ui/d-chart-series-line-of-any.ts","wcardinal/ui/d-chart-series-bar.ts","wcardinal/ui/d-chart-series-line-of-circles.ts","wcardinal/ui/d-chart-series-line-of-rectangle-roundeds.ts","wcardinal/ui/d-chart-series-line-of-rectangles.ts","wcardinal/ui/d-chart-series-line-of-triangles.ts","wcardinal/ui/d-chart-series-line-of-triangle-roundeds.ts","wcardinal/ui/d-chart-series-line.ts","wcardinal/ui/d-chart-series-linear-parameters-impl.ts","wcardinal/ui/d-chart-series-linear.ts","wcardinal/ui/d-chart-selection-shape-base.ts","wcardinal/ui/d-chart-selection-gridline-x.ts","wcardinal/ui/d-chart-selection-gridline-y.ts","wcardinal/ui/d-chart-selection-gridline-container-impl.ts","wcardinal/ui/d-chart-selection-marker.ts","wcardinal/ui/d-chart-selection-sub-impl.ts","wcardinal/ui/d-chart-selection-simple.ts","wcardinal/ui/d-chart.ts","wcardinal/ui/d-command-create.ts","wcardinal/ui/d-command-delete.ts","wcardinal/ui/d-command-save-as.ts","wcardinal/ui/d-command-save.ts","wcardinal/ui/d-diagram-canvas-mapping-point-impl.ts","wcardinal/ui/d-diagram-canvas-mapping-impl.ts","wcardinal/ui/d-diagram-canvas-tile.ts","wcardinal/ui/d-diagram-layer.ts","wcardinal/ui/d-diagram-layer-container.ts","wcardinal/ui/d-diagram-canvas-base.ts","wcardinal/ui/d-diagram-canvas-editor-background.ts","wcardinal/ui/d-diagram-canvas-editor.ts","wcardinal/ui/d-diagram-serialized.ts","wcardinal/ui/d-diagram-canvas.ts","wcardinal/ui/d-diagrams.ts","wcardinal/ui/d-diagram-base.ts","wcardinal/ui/d-diagram-editor.ts","wcardinal/ui/d-diagram-shape.ts","wcardinal/ui/d-diagram-tag.ts","wcardinal/ui/d-diagram.ts","wcardinal/ui/d-dialog-confirm-message.ts","wcardinal/ui/d-dialog-confirm.ts","wcardinal/ui/d-dialog-confirm-delete.ts","wcardinal/ui/d-dialog-confirm-discard.ts","wcardinal/ui/d-dialog-input-text.ts","wcardinal/ui/d-dialog-message.ts","wcardinal/ui/d-dialog-processing-message.ts","wcardinal/ui/d-dialog-processing.ts","wcardinal/ui/d-dialog-save-as.ts","wcardinal/ui/d-menu-context.ts","wcardinal/ui/d-menu.ts","wcardinal/ui/d-dropdown-base.ts","wcardinal/ui/d-menu-sided-selection.ts","wcardinal/ui/d-dropdown.ts","wcardinal/ui/d-expandable-header.ts","wcardinal/ui/d-expandable.ts","wcardinal/ui/d-input-integer-and-label.ts","wcardinal/ui/d-map-coordinate-epsg3857.ts","wcardinal/ui/d-map-coordinates.ts","wcardinal/ui/d-map-tile.ts","wcardinal/ui/d-map-tile-plane.ts","wcardinal/ui/d-map-tile-pyramid-impl.ts","wcardinal/ui/d-map-tile-pyramids.ts","wcardinal/ui/d-menu-bar-item.ts","wcardinal/ui/d-menu-bar-blocker.ts","wcardinal/ui/d-menu-bar.ts","wcardinal/ui/d-menu-sided-content.ts","wcardinal/ui/d-table-column.ts","wcardinal/ui/d-menu-sided.ts","wcardinal/ui/d-notification.ts","wcardinal/ui/d-pagination-dots-button.ts","wcardinal/ui/d-pagination-dynamic-buttons.ts","wcardinal/ui/d-pagination-navigation-button.ts","wcardinal/ui/d-pagination.ts","wcardinal/ui/d-picker-datetime-range.ts","wcardinal/ui/d-picker-time-range.ts","wcardinal/ui/d-select-multiple.ts","wcardinal/ui/d-select.ts","wcardinal/ui/d-shadow-impl.ts","wcardinal/ui/d-slider-label.ts","wcardinal/ui/d-slider-thumb.ts","wcardinal/ui/d-slider-value.ts","wcardinal/ui/d-slider.ts","wcardinal/ui/d-slider-track.ts","wcardinal/ui/d-slider-track-horizontal.ts","wcardinal/ui/d-slider-horizontal.ts","wcardinal/ui/d-slider-track-vertical.ts","wcardinal/ui/d-slider-vertical.ts","wcardinal/ui/d-table-body-cells.ts","wcardinal/ui/d-table-body-cell-select-dialog.ts","wcardinal/ui/d-table-body-cell-action-dialog.ts","wcardinal/ui/d-table-body-cell-action-menu.ts","wcardinal/ui/d-table-body-cell-select-promise.ts","wcardinal/ui/d-table-body-cell-action-promise.ts","wcardinal/ui/d-table-body-cell-text.ts","wcardinal/ui/d-table-body-cell-button.ts","wcardinal/ui/d-table-body-cell-check.ts","wcardinal/ui/d-table-data-selection.ts","wcardinal/ui/d-table-body-cell-color.ts","wcardinal/ui/d-table-body-cell-date.ts","wcardinal/ui/d-table-body-cell-datetime.ts","wcardinal/ui/d-table-body-cell-index.ts","wcardinal/ui/d-table-body-cell-input-integer.ts","wcardinal/ui/d-table-body-cell-input-real.ts","wcardinal/ui/d-table-body-cell-input-text.ts","wcardinal/ui/d-table-body-cell-input-tree-input.ts","wcardinal/ui/d-table-body-cell-input-tree-marker.ts","wcardinal/ui/d-table-cell-state.ts","wcardinal/ui/d-table-body-cell-input-tree.ts","wcardinal/ui/d-table-body-cell-link.ts","wcardinal/ui/d-table-body-cell-select-menu.ts","wcardinal/ui/d-table-body-cell-select-multiple.ts","wcardinal/ui/d-base-padding-adjustable.ts","wcardinal/ui/d-table-body-cell-tree.ts","wcardinal/ui/d-table-body-cell-time.ts","wcardinal/ui/d-table-row-state.ts","wcardinal/ui/d-table-row.ts","wcardinal/ui/d-table-body-row.ts","wcardinal/ui/d-table-data-filter-impl.ts","wcardinal/ui/d-table-data-list-mapped.ts","wcardinal/ui/d-table-data-selection-impl.ts","wcardinal/ui/d-table-data-sorter.ts","wcardinal/ui/d-table-data-sorter-impl.ts","wcardinal/ui/d-tree.ts","wcardinal/ui/d-table-data-list.ts","wcardinal/ui/d-table-body.ts","wcardinal/ui/d-table-category-cell.ts","wcardinal/ui/d-table-category.ts","wcardinal/ui/d-table-data-filter-tree.ts","wcardinal/ui/d-table-data-sorter-tree.ts","wcardinal/ui/d-table-data-tree.ts","wcardinal/ui/d-table-header-cell.ts","wcardinal/ui/d-table-header.ts","wcardinal/ui/d-table.ts","wcardinal/ui/d-tree-item-state.ts","wcardinal/ui/d-tree-item-text-and-image.ts","wcardinal/ui/d-tree-item-toggle-icon.ts","wcardinal/ui/d-tree-item.ts","wcardinal/ui/d-tree-selection.ts","wcardinal/ui/snapper/e-snapper-result-scale.ts","wcardinal/ui/util/to-label.ts","wcardinal/ui/util/to-svg-texture.ts","wcardinal/ui/shape/variant/create-image.ts","wcardinal/ui/shape/variant/create-line.ts","wcardinal-ui.browser.ts"],"sourcesContent":["/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../d-diagram-serialized\";\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\r\n\r\ntype Deserializer = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n) => Promise<EShape> | EShape | null;\r\n\r\nexport const EShapeDeserializers: { [ type: number ]: Deserializer | undefined } = {};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeType {\r\n\tCIRCLE,\r\n\tRECTANGLE,\r\n\tRECTANGLE_ROUNDED,\r\n\tTRIANGLE,\r\n\tTRIANGLE_ROUNDED,\r\n\tLINE,\r\n\tIMAGE,\r\n\tIMAGE_SDF,\r\n\tGROUP,\r\n\tBAR,\r\n\tLABEL,\r\n\tNULL,\r\n\tGROUP_SHADOWED,\r\n\tLINE_OF_CIRCLES,\r\n\tLINE_OF_RECTANGLES,\r\n\tLINE_OF_RECTANGLE_ROUNDEDS,\r\n\tLINE_OF_TRIANGLES,\r\n\tLINE_OF_TRIANGLE_ROUNDEDS,\r\n\tEXTENSION = 1000\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeBuffer } from \"./e-shape-buffer\";\r\nimport { EShapeUploaded } from \"./e-shape-uploaded\";\r\n\r\nexport type EShapeUploadedCreator = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n) => EShapeUploaded | null;\r\n\r\nexport const EShapeUploadeds: {\r\n\t[ type: number ]: EShapeUploadedCreator | undefined\r\n} = {};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapePointsStyle {\r\n\tNONE = 0,\r\n\tCLOSED = 1,\r\n\tNON_EXPANDING_WIDTH = 2,\r\n\tNON_SHRINKING_WIDTH = 4,\r\n\tNON_SCALING_DOT_AND_DASH = 8,\r\n\tDOTTED = 16,\r\n\tDOTTED_DENSELY = 32,\r\n\tDOTTED_LOOSELY = 64,\r\n\tDASHED = 128,\r\n\tDASHED_DENSELY = 256,\r\n\tDASHED_LOOSELY = 512,\r\n\tDOTTED_MASK = DOTTED | DOTTED_DENSELY | DOTTED_LOOSELY,\r\n\tDASHED_MASK = DASHED | DASHED_DENSELY | DASHED_LOOSELY,\r\n\tNON_SOLID_MASK = DOTTED_MASK | DASHED_MASK\r\n}\r\n","import { IPoint } from \"pixi.js\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\n\r\nexport const toDash = (\r\n\tlength: number, strokeWidth: number,\r\n\tstyle: EShapePointsStyle, result: IPoint\r\n): IPoint => {\r\n\tresult.set( 2 * length, 0 );\r\n\tif( style & EShapePointsStyle.NON_SOLID_MASK ) {\r\n\t\tif( style & EShapePointsStyle.DOTTED ) {\r\n\t\t\tresult.set( strokeWidth, strokeWidth );\r\n\t\t} else if( style & EShapePointsStyle.DOTTED_DENSELY ) {\r\n\t\t\tresult.set( strokeWidth, strokeWidth * 0.5 );\r\n\t\t} else if( style & EShapePointsStyle.DOTTED_LOOSELY ) {\r\n\t\t\tresult.set( strokeWidth, strokeWidth * 2 );\r\n\t\t} else if( style & EShapePointsStyle.DASHED ) {\r\n\t\t\tresult.set( strokeWidth * 2, strokeWidth );\r\n\t\t} else if( style & EShapePointsStyle.DASHED_DENSELY ) {\r\n\t\t\tresult.set( strokeWidth * 2, strokeWidth * 0.5 );\r\n\t\t} else if( style & EShapePointsStyle.DASHED_LOOSELY ) {\r\n\t\t\tresult.set( strokeWidth * 2, strokeWidth * 2 );\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\nimport { DeepPartial } from \"../util/deep-partial\";\r\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\r\nimport { EShapeTextAlign, EShapeTextAlignLike } from \"./e-shape-text-align\";\r\nimport { EShapeTextDirection } from \"./e-shape-text-direction\";\r\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"./e-shape-text-offset\";\r\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"./e-shape-text-outline\";\r\n\r\nexport enum EShapeTextWeight {\r\n\tNORMAL,\r\n\tBOLD\r\n}\r\n\r\nexport enum EShapeTextStyle {\r\n\tNORMAL,\r\n\tITALIC\r\n}\r\n\r\nexport interface EShapeTextLike {\r\n\tvalue: string;\r\n\tcolor: number;\r\n\talpha: number;\r\n\tfamily: string;\r\n\tsize: number;\r\n\tweight: EShapeTextWeight;\r\n\talign: EShapeTextAlignLike;\r\n\toffset: EShapeTextOffsetLike;\r\n\tstyle: EShapeTextStyle;\r\n\toutline: EShapeTextOutlineLike;\r\n\tspacing: EShapeTextOffsetLike;\r\n\tdirection: EShapeTextDirection;\r\n\tpadding: EShapeTextOffsetLike;\r\n\tclipping: boolean;\r\n}\r\n\r\nexport interface EShapeTextAtlasCharacter {\r\n\tx: number;\r\n\ty: number;\r\n\twidth: number;\r\n\theight: number;\r\n\tadvance: number;\r\n\torigin: {\r\n\t\tx: number,\r\n\t\ty: number\r\n\t};\r\n}\r\n\r\nexport interface EShapeTextAtlasCharacters {\r\n\t[ character: string ]: EShapeTextAtlasCharacter;\r\n}\r\n\r\nexport interface EShapeTextAtlas {\r\n\twidth: number;\r\n\theight: number;\r\n\tfont: {\r\n\t\tsize: number;\r\n\t};\r\n\tcharacters: EShapeTextAtlasCharacters;\r\n}\r\n\r\nexport interface EShapeText extends EShapeTextLike {\r\n\tenable: boolean;\r\n\r\n\talign: EShapeTextAlign;\r\n\toffset: EShapeTextOffset;\r\n\toutline: EShapeTextOutline;\r\n\tspacing: EShapeTextOffset;\r\n\tpadding: EShapeTextOffset;\r\n\r\n\ttexture?: Texture;\t\t// Used for rendering and updated when rendered\r\n\tatlas?: EShapeTextAtlas;\t// Used for rendering and updated when rendered\r\n\tworld?: Float32Array;\t\t// Updated when rendered\r\n\r\n\tcopy( target?: DeepPartial<EShapeTextLike> ): this;\r\n\tset(\r\n\t\tvalue?: string, color?: number, alpha?: number,\r\n\t\tfamily?: string, size?: number, weight?: EShapeTextWeight,\r\n\t\tstyle?: EShapeTextStyle, direction?: EShapeTextDirection,\r\n\t\tclipping?: boolean\r\n\t): this;\r\n\ttoObject(): EShapeTextLike;\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number;\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeTextAlignHorizontal {\r\n\tLEFT,\r\n\tCENTER,\r\n\tRIGHT,\r\n\tOUTSIDE_LEFT,\r\n\tOUTSIDE_RIGHT\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeTextAlignVertical {\r\n\tTOP,\r\n\tMIDDLE,\r\n\tBOTTOM,\r\n\tOUTSIDE_TOP,\r\n\tOUTSIDE_BOTTOM\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeTextDirection {\r\n\tLEFT_TO_RIGHT,\r\n\tTOP_TO_BOTTOM,\r\n\tBOTTOM_TO_TOP\r\n}\r\n","import { EShapePointsStyle } from \"../e-shape-points-style\";\r\n\r\nexport const toScaleInvariant = ( style: EShapePointsStyle ): number => {\r\n\tconst nonExpandingWidth = ( style & EShapePointsStyle.NON_EXPANDING_WIDTH ? 1 : 0 );\r\n\tconst nonShrinkingWidth = ( style & EShapePointsStyle.NON_SHRINKING_WIDTH ? 2 : 0 );\r\n\tconst nonScalingDotAndDash = ( style & EShapePointsStyle.NON_SCALING_DOT_AND_DASH ? 4 : 0 );\r\n\tif( style & EShapePointsStyle.NON_SOLID_MASK ) {\r\n\t\treturn nonExpandingWidth | nonShrinkingWidth | nonScalingDotAndDash;\r\n\t} else {\r\n\t\treturn nonExpandingWidth | nonShrinkingWidth;\r\n\t}\r\n};\r\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { toDash } from \"./to-dash\";\r\nimport { toScaleInvariant } from \"./to-scale-invariant\";\r\n\r\nexport const BAR_VERTEX_COUNT = 4;\r\nexport const BAR_INDEX_COUNT = 2;\r\nconst BAR_FMIN: number = 0.00001;\r\nconst BAR_WORK_POINT: Point = new Point();\r\n\r\nexport const buildBarClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number\r\n): void => {\r\n\tconst ic = voffset * 3;\r\n\tclippings[ ic +  0 ] = 1;\r\n\tclippings[ ic +  1 ] = 0;\r\n\tclippings[ ic +  2 ] = 3;\r\n\r\n\tclippings[ ic +  3 ] = 0;\r\n\tclippings[ ic +  4 ] = 1;\r\n\tclippings[ ic +  5 ] = 5;\r\n\r\n\tclippings[ ic +  6 ] = 1;\r\n\tclippings[ ic +  7 ] = 0;\r\n\tclippings[ ic +  8 ] = 3;\r\n\r\n\tclippings[ ic +  9 ] = 0;\r\n\tclippings[ ic + 10 ] = 1;\r\n\tclippings[ ic + 11 ] = 5;\r\n};\r\n\r\nexport const buildBarIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number\r\n): void => {\r\n\tconst ii = ioffset * 3;\r\n\tindices[ ii + 0 ] = voffset + 0;\r\n\tindices[ ii + 1 ] = voffset + 2;\r\n\tindices[ ii + 2 ] = voffset + 1;\r\n\r\n\tindices[ ii + 3 ] = voffset + 1;\r\n\tindices[ ii + 4 ] = voffset + 2;\r\n\tindices[ ii + 5 ] = voffset + 3;\r\n};\r\n\r\nexport const buildBarVertexStepAndColorFill = (\r\n\tvertices: Float32Array,\r\n\tsteps: Float32Array,\r\n\tcolorFills: Float32Array,\r\n\tvoffset: number,\r\n\tpointValues: number[],\r\n\tpointsStyle: EShapePointsStyle,\r\n\tpointsSize: number,\r\n\tstrokeWidth: number,\r\n\tinternalTransform: Matrix\r\n): void => {\r\n\t// First point\r\n\tconst a  = internalTransform.a;\r\n\tconst b  = internalTransform.b;\r\n\tconst c  = internalTransform.c;\r\n\tconst d  = internalTransform.d;\r\n\tconst tx = internalTransform.tx;\r\n\tconst ty = internalTransform.ty;\r\n\tconst pv0 = pointValues[ 0 ];\r\n\tconst pv1 = pointValues[ 1 ];\r\n\tconst p1x = a * pv0 + c * pv1 + tx;\r\n\tconst p1y = b * pv0 + d * pv1 + ty;\r\n\r\n\t// Last point\r\n\tconst pv2 = pointValues[ 2 ];\r\n\tconst pv3 = pointValues[ 3 ];\r\n\tlet p2x = a * pv2 + c * pv3 + tx;\r\n\tlet p2y = b * pv2 + d * pv3 + ty;\r\n\r\n\t// Normal\r\n\tlet dx = p2x - p1x;\r\n\tlet dy = p2y - p1y;\r\n\tconst distance = Math.sqrt( dx * dx + dy * dy );\r\n\tlet l = distance;\r\n\tif( 0 <= pointsSize && BAR_FMIN < distance ) {\r\n\t\tconst ratio = pointsSize / distance;\r\n\t\tdx *= ratio;\r\n\t\tdy *= ratio;\r\n\t\tp2x = p1x + dx;\r\n\t\tp2y = p1y + dy;\r\n\t\tl = pointsSize;\r\n\t}\r\n\r\n\t// Other points\r\n\tconst p0x = p1x - dx;\r\n\tconst p0y = p1y - dy;\r\n\tconst p3x = p2x + dx;\r\n\tconst p3y = p2y + dy;\r\n\r\n\t//\r\n\tconst scaleInvariant = toScaleInvariant( pointsStyle );\r\n\tconst iv = voffset << 1;\r\n\tconst icf = voffset << 2;\r\n\tconst is = voffset * 6;\r\n\tvertices[ iv + 0 ] = p1x;\r\n\tvertices[ iv + 1 ] = p1y;\r\n\tvertices[ iv + 2 ] = p1x;\r\n\tvertices[ iv + 3 ] = p1y;\r\n\tsteps[ is +  0 ] = strokeWidth;\r\n\tsteps[ is +  1 ] = scaleInvariant;\r\n\tsteps[ is +  2 ] = p0x;\r\n\tsteps[ is +  3 ] = p0y;\r\n\tsteps[ is +  4 ] = p2x;\r\n\tsteps[ is +  5 ] = p2y;\r\n\tsteps[ is +  6 ] = strokeWidth;\r\n\tsteps[ is +  7 ] = scaleInvariant;\r\n\tsteps[ is +  8 ] = p0x;\r\n\tsteps[ is +  9 ] = p0y;\r\n\tsteps[ is + 10 ] = p2x;\r\n\tsteps[ is + 11 ] = p2y;\r\n\tcolorFills[ icf + 0 ] = 0.0;\r\n\tcolorFills[ icf + 4 ] = 0.0;\r\n\r\n\tvertices[ iv + 4 ] = p2x;\r\n\tvertices[ iv + 5 ] = p2y;\r\n\tvertices[ iv + 6 ] = p2x;\r\n\tvertices[ iv + 7 ] = p2y;\r\n\tsteps[ is + 12 ] = strokeWidth;\r\n\tsteps[ is + 13 ] = scaleInvariant;\r\n\tsteps[ is + 14 ] = p1x;\r\n\tsteps[ is + 15 ] = p1y;\r\n\tsteps[ is + 16 ] = p3x;\r\n\tsteps[ is + 17 ] = p3y;\r\n\tsteps[ is + 18 ] = strokeWidth;\r\n\tsteps[ is + 19 ] = scaleInvariant;\r\n\tsteps[ is + 20 ] = p1x;\r\n\tsteps[ is + 21 ] = p1y;\r\n\tsteps[ is + 22 ] = p3x;\r\n\tsteps[ is + 23 ] = p3y;\r\n\tcolorFills[ icf +  8 ] = l;\r\n\tcolorFills[ icf + 12 ] = l;\r\n\r\n\t// Total length\r\n\tconst dash = toDash( l, strokeWidth, pointsStyle, BAR_WORK_POINT );\r\n\tconst dash0 = dash.x;\r\n\tconst dash1 = dash.y;\r\n\tcolorFills[ icf +  1 ] = dash0;\r\n\tcolorFills[ icf +  2 ] = dash1;\r\n\tcolorFills[ icf +  3 ] = l;\r\n\r\n\tcolorFills[ icf +  5 ] = dash0;\r\n\tcolorFills[ icf +  6 ] = dash1;\r\n\tcolorFills[ icf +  7 ] = l;\r\n\r\n\tcolorFills[ icf +  9 ] = dash0;\r\n\tcolorFills[ icf + 10 ] = dash1;\r\n\tcolorFills[ icf + 11 ] = l;\r\n\r\n\tcolorFills[ icf + 13 ] = dash0;\r\n\tcolorFills[ icf + 14 ] = dash1;\r\n\tcolorFills[ icf + 15 ] = l;\r\n};\r\n\r\nexport const buildBarUv = (\r\n\tuvs: Float32Array,\r\n\tvoffset: number,\r\n\ttextureUvs: TextureUvs\r\n): void => {\r\n\tconst iuv = voffset << 1;\r\n\tuvs[ iuv + 0 ] = textureUvs.x0;\r\n\tuvs[ iuv + 1 ] = textureUvs.y0;\r\n\tuvs[ iuv + 2 ] = textureUvs.x3;\r\n\tuvs[ iuv + 3 ] = textureUvs.y3;\r\n\r\n\tuvs[ iuv + 4 ] = textureUvs.x1;\r\n\tuvs[ iuv + 5 ] = textureUvs.y1;\r\n\tuvs[ iuv + 6 ] = textureUvs.x2;\r\n\tuvs[ iuv + 7 ] = textureUvs.y2;\r\n};\r\n","\r\nexport class UtilCharacterIterator {\r\n\tprotected static _instance: UtilCharacterIterator | null = null;\r\n\tprotected _target: string;\r\n\tprotected _position: number;\r\n\r\n\tconstructor() {\r\n\t\tthis._target = \"\";\r\n\t\tthis._position = 0;\r\n\t}\r\n\r\n\tget position(): number {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tset position( position: number ) {\r\n\t\tthis._position = position;\r\n\t}\r\n\r\n\tinit( target: string ): void {\r\n\t\tthis._target = target;\r\n\t\tthis._position = 0;\r\n\t}\r\n\r\n\thasNext(): boolean {\r\n\t\treturn this._position < this._target.length;\r\n\t}\r\n\r\n\tprotected findNextBreak( target: string, istart: number ): number {\r\n\t\tconst iend = target.length;\r\n\t\tfor( let i = istart; i < iend; ++i ) {\r\n\t\t\tconst code = target.charCodeAt( i );\r\n\t\t\tif( ! this.isLowSurrogate( code ) && ! this.isVariationSelector( code ) ) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn iend;\r\n\t}\r\n\r\n\tprotected isHighSurrogate( code: number ): boolean {\r\n\t\treturn ( 0xd800 <= code && code <= 0xdbff );\r\n\t}\r\n\r\n\tprotected isLowSurrogate( code: number ): boolean {\r\n\t\treturn ( 0xdc00 <= code && code <= 0xdfff );\r\n\t}\r\n\r\n\tprotected isVariationSelector( code: number ): boolean {\r\n\t\treturn ( 0xfe00 <= code && code <= 0xfe0f );\r\n\t}\r\n\r\n\tnext(): string {\r\n\t\tconst target = this._target;\r\n\t\tconst position = this._position;\r\n\t\tconst nextBreak = this.findNextBreak( target, position + 1 );\r\n\t\tconst result = target.substring( position, nextBreak );\r\n\t\tthis._position = nextBreak;\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Advances the position if the next character is not equal to\r\n\t * the given `except`.\r\n\t *\r\n\t * @param except\r\n\t * @return true if the position is advanced\r\n\t */\r\n\tadvance( except?: string ): boolean {\r\n\t\tconst target = this._target;\r\n\t\tconst position = this._position;\r\n\t\tconst nextBreak = this.findNextBreak( target, position + 1 );\r\n\t\tif( target.substring( position, nextBreak ) !== except ) {\r\n\t\t\tthis._position = nextBreak;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tstatic from( target: string ): UtilCharacterIterator {\r\n\t\tif( UtilCharacterIterator._instance == null ) {\r\n\t\t\tUtilCharacterIterator._instance = new UtilCharacterIterator();\r\n\t\t}\r\n\t\tconst instance = UtilCharacterIterator._instance;\r\n\t\tinstance.init( target );\r\n\t\treturn instance;\r\n\t}\r\n}\r\n","export const toLength = ( p0x: number, p0y: number, p1x: number, p1y: number ) => {\r\n\tconst dx01 = p1x - p0x;\r\n\tconst dy01 = p1y - p0y;\r\n\treturn Math.sqrt( dx01 * dx01 + dy01 * dy01 );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeBarPosition {\r\n\tTOP,\r\n\tLEFT,\r\n\tRIGHT,\r\n\tBOTTOM\r\n}\r\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\r\nimport { UtilCharacterIterator } from \"../../util/util-character-iterator\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeTextAtlas, EShapeTextAtlasCharacter, EShapeTextStyle, EShapeTextWeight } from \"../e-shape-text\";\r\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\r\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\r\nimport { EShapeTextDirection } from \"../e-shape-text-direction\";\r\nimport { toLength } from \"./to-length\";\r\n\r\nexport const TEXT_VERTEX_COUNT = 4;\r\nexport const TEXT_INDEX_COUNT = 2;\r\nconst TEXT_SDF_WINDOW = 12;\r\nconst TEXT_FMIN: number = 0.00001;\r\nconst TEXT_WORK_POINT: Point = new Point();\r\n\r\nexport const toTextBufferCount = ( shape: EShape ): number => {\r\n\treturn Math.ceil( shape.text.value.length / 12 ) * 12;\r\n};\r\n\r\nexport const buildTextClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number\r\n): void => {\r\n\tfor( let i = voffset * 3, imax = i + vcount * 3; i < imax; i += 3 ) {\r\n\t\tclippings[ i + 0 ] = 0;\r\n\t\tclippings[ i + 1 ] = 0;\r\n\t\tclippings[ i + 2 ] = 2;\r\n\t}\r\n};\r\n\r\nexport const buildTextIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number,\r\n\ticount: number\r\n): void => {\r\n\tfor( let i = 0, ii = ioffset * 3, imax = (icount >> 1); i < imax; i += 1, ii += 6 ) {\r\n\t\tconst j = voffset + ( i << 2 );\r\n\t\tindices[ ii + 0 ] = j + 0;\r\n\t\tindices[ ii + 1 ] = j + 1;\r\n\t\tindices[ ii + 2 ] = j + 3;\r\n\r\n\t\tindices[ ii + 3 ] = j + 1;\r\n\t\tindices[ ii + 4 ] = j + 2;\r\n\t\tindices[ ii + 5 ] = j + 3;\r\n\t}\r\n};\r\n\r\nexport const buildTextStep = (\r\n\tsteps: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number,\r\n\ttextAtlas: EShapeTextAtlas | undefined,\r\n\ttextSize: number,\r\n\ttextOutlineWidth: number,\r\n\ttextWeight: EShapeTextWeight,\r\n\tantialiasWeight: number\r\n): void => {\r\n\tif( textAtlas != null ) {\r\n\t\tconst scaleBase = (0.4 / TEXT_SDF_WINDOW) * antialiasWeight;\r\n\t\tconst scale = scaleBase * (textAtlas.font.size / textSize);\r\n\t\tconst outlineWidth = textOutlineWidth * 0.4;\r\n\t\tconst weight = ( textWeight === EShapeTextWeight.NORMAL ? 0.0 : 0.05 );\r\n\t\tfor( let i = voffset * 6, imax = i + vcount * 6; i < imax; i += 6 ) {\r\n\t\t\tsteps[ i + 0 ] = scale;\r\n\t\t\tsteps[ i + 1 ] = outlineWidth;\r\n\t\t\tsteps[ i + 2 ] = weight;\r\n\t\t\tsteps[ i + 3 ] = TEXT_FMIN;\r\n\t\t\tsteps[ i + 4 ] = TEXT_FMIN;\r\n\t\t\tsteps[ i + 5 ] = TEXT_FMIN;\r\n\t\t}\r\n\t} else {\r\n\t\tfor( let i = voffset * 6, imax = i + vcount * 6; i < imax; i += 6 ) {\r\n\t\t\tsteps[ i + 0 ] = 0;\r\n\t\t\tsteps[ i + 1 ] = 0;\r\n\t\t\tsteps[ i + 2 ] = TEXT_FMIN;\r\n\t\t\tsteps[ i + 3 ] = TEXT_FMIN;\r\n\t\t\tsteps[ i + 4 ] = TEXT_FMIN;\r\n\t\t\tsteps[ i + 5 ] = TEXT_FMIN;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst getTextBBox = (\r\n\thalign: EShapeTextAlignHorizontal,\r\n\tvalign: EShapeTextAlignVertical,\r\n\thoffset: number,\r\n\tvoffset: number,\r\n\thpadding: number,\r\n\tvpadding: number,\r\n\twidth: number, height: number,\r\n\tx0: number, y0: number,\r\n\tx1: number, y1: number,\r\n\tx2: number, y2: number,\r\n\tx3: number, y3: number,\r\n\thnx: number, hny: number,\r\n\tvnx: number, vny: number,\r\n\tresult: Point\r\n): void => {\r\n\tswitch( halign ) {\r\n\tcase EShapeTextAlignHorizontal.LEFT:\r\n\t\tswitch( valign ) {\r\n\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\tresult.x = x0\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = y0\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\tresult.x = 0.5 * ( x0 + x3 )\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset - 0.5 * height );\r\n\t\t\tresult.y = 0.5 * ( y0 + y3 )\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset - 0.5 * height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\tresult.x = x3\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = y3\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\r\n\t\t\tresult.x = x0\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = y0\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\r\n\t\t\tresult.x = x3\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = y3\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tbreak;\r\n\tcase EShapeTextAlignHorizontal.CENTER:\r\n\t\tswitch( valign ) {\r\n\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\tresult.x = 0.5 * ( x0 + x1 )\r\n\t\t\t\t+ hnx * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = 0.5 * ( y0 + y1 )\r\n\t\t\t\t+ hny * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\tresult.x = 0.5 * ( x0 + x2 )\r\n\t\t\t\t+ hnx * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vnx * ( voffset - 0.5 * height );\r\n\t\t\tresult.y = 0.5 * ( y0 + y2 )\r\n\t\t\t\t+ hny * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vny * ( voffset - 0.5 * height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\tresult.x = 0.5 * ( x3 + x2 )\r\n\t\t\t\t+ hnx * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = 0.5 * ( y3 + y2 )\r\n\t\t\t\t+ hny * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\r\n\t\t\tresult.x = 0.5 * ( x0 + x1 )\r\n\t\t\t\t+ hnx * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = 0.5 * ( y0 + y1 )\r\n\t\t\t\t+ hny * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\r\n\t\t\tresult.x = 0.5 * ( x3 + x2 )\r\n\t\t\t\t+ hnx * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = 0.5 * ( y3 + y2 )\r\n\t\t\t\t+ hny * ( hoffset - 0.5 * width )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tbreak;\r\n\tcase EShapeTextAlignHorizontal.RIGHT:\r\n\t\tswitch( valign ) {\r\n\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\tresult.x = x1\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = y1\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\tresult.x = 0.5 * ( x1 + x2 )\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset - 0.5 * height );\r\n\t\t\tresult.y = 0.5 * ( y1 + y2 )\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset - 0.5 * height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\tresult.x = x2\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = y2\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\r\n\t\t\tresult.x = x1\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = y1\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\r\n\t\t\tresult.x = x2\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = y2\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tbreak;\r\n\tcase EShapeTextAlignHorizontal.OUTSIDE_LEFT:\r\n\t\tswitch( valign ) {\r\n\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\tresult.x = x0\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = y0\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\tresult.x = 0.5 * ( x0 + x3 )\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset - 0.5 * height );\r\n\t\t\tresult.y = 0.5 * ( y0 + y3 )\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset - 0.5 * height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\tresult.x = x3\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = y3\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\r\n\t\t\tresult.x = x0\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = y0\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\r\n\t\t\tresult.x = x3\r\n\t\t\t\t+ hnx * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = y3\r\n\t\t\t\t+ hny * ( hoffset - hpadding - width )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tbreak;\r\n\tcase EShapeTextAlignHorizontal.OUTSIDE_RIGHT:\r\n\t\tswitch( valign ) {\r\n\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\tresult.x = x1\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = y1\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\tresult.x = 0.5 * ( x1 + x2 )\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset - 0.5 * height );\r\n\t\t\tresult.y = 0.5 * ( y1 + y2 )\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset - 0.5 * height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\tresult.x = x2\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = y2\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\r\n\t\t\tresult.x = x1\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset - vpadding - height );\r\n\t\t\tresult.y = y1\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset - vpadding - height );\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\r\n\t\t\tresult.x = x2\r\n\t\t\t\t+ hnx * ( hoffset + hpadding )\r\n\t\t\t\t+ vnx * ( voffset + vpadding );\r\n\t\t\tresult.y = y2\r\n\t\t\t\t+ hny * ( hoffset + hpadding )\r\n\t\t\t\t+ vny * ( voffset + vpadding );\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tbreak;\r\n\t}\r\n};\r\n\r\nconst toNormalized = ( dx: number, dy: number, defx: number, defy: number, result: Point ): number => {\r\n\tconst d = dx * dx + dy * dy;\r\n\tif( TEXT_FMIN < d ) {\r\n\t\tconst l = Math.sqrt( d );\r\n\t\tconst li = 1 / l;\r\n\t\tresult.set( dx * li, dy * li );\r\n\t\treturn l;\r\n\t} else {\r\n\t\tresult.set( defx, defy );\r\n\t\treturn 0;\r\n\t}\r\n};\r\n\r\nconst rotateAlignHorizontalRight = ( align: EShapeTextAlignHorizontal ): EShapeTextAlignVertical => {\r\n\tswitch( align ) {\r\n\tcase EShapeTextAlignHorizontal.LEFT:\r\n\t\treturn EShapeTextAlignVertical.BOTTOM;\r\n\tcase EShapeTextAlignHorizontal.CENTER:\r\n\t\treturn EShapeTextAlignVertical.MIDDLE;\r\n\tcase EShapeTextAlignHorizontal.RIGHT:\r\n\t\treturn EShapeTextAlignVertical.TOP;\r\n\tcase EShapeTextAlignHorizontal.OUTSIDE_LEFT:\r\n\t\treturn EShapeTextAlignVertical.OUTSIDE_BOTTOM;\r\n\tcase EShapeTextAlignHorizontal.OUTSIDE_RIGHT:\r\n\t\treturn EShapeTextAlignVertical.OUTSIDE_TOP;\r\n\t}\r\n};\r\n\r\nconst rotateAlignVerticalRight = ( align: EShapeTextAlignVertical ): EShapeTextAlignHorizontal => {\r\n\tswitch( align ) {\r\n\tcase EShapeTextAlignVertical.TOP:\r\n\t\treturn EShapeTextAlignHorizontal.LEFT;\r\n\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\treturn EShapeTextAlignHorizontal.CENTER;\r\n\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\treturn EShapeTextAlignHorizontal.RIGHT;\r\n\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\r\n\t\treturn EShapeTextAlignHorizontal.OUTSIDE_LEFT;\r\n\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\r\n\t\treturn EShapeTextAlignHorizontal.OUTSIDE_RIGHT;\r\n\t}\r\n};\r\n\r\nconst rotateAlignHorizontalLeft = ( align: EShapeTextAlignHorizontal ): EShapeTextAlignVertical => {\r\n\tswitch( align ) {\r\n\tcase EShapeTextAlignHorizontal.LEFT:\r\n\t\treturn EShapeTextAlignVertical.TOP;\r\n\tcase EShapeTextAlignHorizontal.CENTER:\r\n\t\treturn EShapeTextAlignVertical.MIDDLE;\r\n\tcase EShapeTextAlignHorizontal.RIGHT:\r\n\t\treturn EShapeTextAlignVertical.BOTTOM;\r\n\tcase EShapeTextAlignHorizontal.OUTSIDE_LEFT:\r\n\t\treturn EShapeTextAlignVertical.OUTSIDE_TOP;\r\n\tcase EShapeTextAlignHorizontal.OUTSIDE_RIGHT:\r\n\t\treturn EShapeTextAlignVertical.OUTSIDE_BOTTOM;\r\n\t}\r\n};\r\n\r\nconst rotateAlignVerticalLeft = ( align: EShapeTextAlignVertical ): EShapeTextAlignHorizontal => {\r\n\tswitch( align ) {\r\n\tcase EShapeTextAlignVertical.TOP:\r\n\t\treturn EShapeTextAlignHorizontal.RIGHT;\r\n\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\treturn EShapeTextAlignHorizontal.CENTER;\r\n\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\treturn EShapeTextAlignHorizontal.LEFT;\r\n\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\r\n\t\treturn EShapeTextAlignHorizontal.OUTSIDE_RIGHT;\r\n\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\r\n\t\treturn EShapeTextAlignHorizontal.OUTSIDE_LEFT;\r\n\t}\r\n};\r\n\r\nexport const buildTextVertex = (\r\n\tvertices: Float32Array,\r\n\tuvs: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number,\r\n\toriginX: number,\r\n\toriginY: number,\r\n\tsizeX: number,\r\n\tsizeY: number,\r\n\ttextAtlas: EShapeTextAtlas,\r\n\ttextSize: number,\r\n\ttextValue: string,\r\n\ttextStyle: EShapeTextStyle,\r\n\ttextAlignHorizontal: EShapeTextAlignHorizontal,\r\n\ttextAlignVertical: EShapeTextAlignVertical,\r\n\ttextOffsetHorizontal: number,\r\n\ttextOffsetVertical: number,\r\n\ttextSpacingHorizontal: number,\r\n\ttextSpacingVertical: number,\r\n\ttextDirection: EShapeTextDirection,\r\n\ttextPaddingHorizontal: number,\r\n\ttextPaddingVertical: number,\r\n\ttextClipping: boolean,\r\n\ttextWorld: Float32Array,\r\n\ttextureUvs: TextureUvs,\r\n\tinternalTransform: Matrix\r\n): void => {\r\n\t// Calculate the transformed positions\r\n\t//\r\n\t//  0               1\r\n\t// |---------------|\r\n\t// |               |\r\n\t// |3              |2\r\n\t// |---------------|\r\n\t//\r\n\tconst sx = sizeX * 0.5;\r\n\tconst sy = sizeY * 0.5;\r\n\tconst work = TEXT_WORK_POINT;\r\n\twork.set( originX - sx, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x0 = work.x;\r\n\tconst y0 = work.y;\r\n\twork.set( originX + sx, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x1 = work.x;\r\n\tconst y1 = work.y;\r\n\twork.set( originX + sx, originY + sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x2 = work.x;\r\n\tconst y2 = work.y;\r\n\tconst x3 = x0 + (x2 - x1);\r\n\tconst y3 = y0 + (y2 - y1);\r\n\r\n\t// Horizontal normal\r\n\tconst hl = toLength( x0, y0, x1, y1 );\r\n\ttoNormalized( internalTransform.a, internalTransform.b, 1, 0, work );\r\n\tlet hnx = work.x;\r\n\tlet hny = work.y;\r\n\r\n\t// Vertical normal\r\n\tconst vl = toLength( x0, y0, x3, y3 );\r\n\ttoNormalized( internalTransform.c, internalTransform.d, 0, 1, work );\r\n\tlet vnx = work.x;\r\n\tlet vny = work.y;\r\n\r\n\t// Calculate the width / height\r\n\tlet width = 0;\r\n\tlet height = 0;\r\n\tlet heightChar = 0;\r\n\tconst lineHeight = Math.max( 0, textSize + textSpacingVertical );\r\n\tlet lineWidth = 0;\r\n\tconst textAtlasCharacters = textAtlas.characters;\r\n\tconst iterator = UtilCharacterIterator.from( textValue );\r\n\tlet advancePrevious = 0;\r\n\twhile( iterator.hasNext() ) {\r\n\t\tconst character = iterator.next();\r\n\t\tif( character !== \"\\n\" ) {\r\n\t\t\tif( 0 < advancePrevious ) {\r\n\t\t\t\tlineWidth += Math.max( 0, advancePrevious + textSpacingHorizontal );\r\n\t\t\t}\r\n\t\t\tconst data = textAtlasCharacters[ character ];\r\n\t\t\tif( data ) {\r\n\t\t\t\tadvancePrevious = data.advance;\r\n\t\t\t\theightChar = data.height;\r\n\t\t\t} else {\r\n\t\t\t\tadvancePrevious = 0;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlineWidth += advancePrevious;\r\n\t\t\tadvancePrevious = 0;\r\n\t\t\twidth = Math.max( width, lineWidth );\r\n\t\t\tlineWidth = 0;\r\n\t\t\theight += lineHeight;\r\n\t\t}\r\n\t}\r\n\r\n\tconst scale = textSize / textAtlas.font.size;\r\n\tlineWidth += advancePrevious;\r\n\twidth = Math.max( width, lineWidth ) * scale;\r\n\tlineWidth = 0;\r\n\theightChar *= scale;\r\n\theight += textSize;\r\n\r\n\t//\r\n\tlet tx0 = 0;\r\n\tlet ty0 = 0;\r\n\tlet lineWidthMaximum = NaN;\r\n\tswitch( textDirection ) {\r\n\tcase EShapeTextDirection.LEFT_TO_RIGHT:\r\n\t\tgetTextBBox(\r\n\t\t\ttextAlignHorizontal,\r\n\t\t\ttextAlignVertical,\r\n\t\t\ttextOffsetHorizontal,\r\n\t\t\ttextOffsetVertical,\r\n\t\t\ttextPaddingHorizontal,\r\n\t\t\ttextPaddingVertical,\r\n\t\t\twidth, height,\r\n\t\t\tx0, y0,\r\n\t\t\tx1, y1,\r\n\t\t\tx2, y2,\r\n\t\t\tx3, y3,\r\n\t\t\thnx, hny,\r\n\t\t\tvnx, vny,\r\n\t\t\twork\r\n\t\t);\r\n\t\ttx0 = work.x;\r\n\t\tty0 = work.y;\r\n\t\tif( textClipping ) {\r\n\t\t\tswitch( textAlignHorizontal ) {\r\n\t\t\tcase EShapeTextAlignHorizontal.LEFT:\r\n\t\t\tcase EShapeTextAlignHorizontal.CENTER:\r\n\t\t\tcase EShapeTextAlignHorizontal.RIGHT:\r\n\t\t\t\tswitch( textAlignVertical ) {\r\n\t\t\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\t\t\tlineWidthMaximum = hl - textPaddingHorizontal * 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbreak;\r\n\tcase EShapeTextDirection.TOP_TO_BOTTOM:\r\n\t\t// Swap normals\r\n\t\twork.set( vnx, vny );\r\n\t\tvnx = -hnx;\r\n\t\tvny = -hny;\r\n\t\thnx = work.x;\r\n\t\thny = work.y;\r\n\r\n\t\t// Get text bbox\r\n\t\tgetTextBBox(\r\n\t\t\trotateAlignVerticalRight( textAlignVertical ),\r\n\t\t\trotateAlignHorizontalRight( textAlignHorizontal ),\r\n\t\t\ttextOffsetVertical,\r\n\t\t\ttextOffsetHorizontal,\r\n\t\t\ttextPaddingVertical,\r\n\t\t\ttextPaddingHorizontal,\r\n\t\t\twidth, height,\r\n\t\t\tx1, y1,\r\n\t\t\tx2, y2,\r\n\t\t\tx3, y3,\r\n\t\t\tx0, y0,\r\n\t\t\thnx, hny,\r\n\t\t\tvnx, vny,\r\n\t\t\twork\r\n\t\t);\r\n\t\ttx0 = work.x;\r\n\t\tty0 = work.y;\r\n\t\tif( textClipping ) {\r\n\t\t\tswitch( textAlignVertical ) {\r\n\t\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\t\tswitch( textAlignHorizontal ) {\r\n\t\t\t\tcase EShapeTextAlignHorizontal.LEFT:\r\n\t\t\t\tcase EShapeTextAlignHorizontal.CENTER:\r\n\t\t\t\tcase EShapeTextAlignHorizontal.RIGHT:\r\n\t\t\t\t\tlineWidthMaximum = vl - textPaddingVertical * 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbreak;\r\n\tcase EShapeTextDirection.BOTTOM_TO_TOP:\r\n\t\t// Swap normals\r\n\t\twork.set( vnx, vny );\r\n\t\tvnx = hnx;\r\n\t\tvny = hny;\r\n\t\thnx = -work.x;\r\n\t\thny = -work.y;\r\n\r\n\t\t// Get text bbox\r\n\t\tgetTextBBox(\r\n\t\t\trotateAlignVerticalLeft( textAlignVertical ),\r\n\t\t\trotateAlignHorizontalLeft( textAlignHorizontal ),\r\n\t\t\ttextOffsetVertical,\r\n\t\t\ttextOffsetHorizontal,\r\n\t\t\ttextPaddingVertical,\r\n\t\t\ttextPaddingHorizontal,\r\n\t\t\twidth, height,\r\n\t\t\tx3, y3,\r\n\t\t\tx0, y0,\r\n\t\t\tx1, y1,\r\n\t\t\tx2, y2,\r\n\t\t\thnx, hny,\r\n\t\t\tvnx, vny,\r\n\t\t\twork\r\n\t\t);\r\n\t\ttx0 = work.x;\r\n\t\tty0 = work.y;\r\n\t\tif( textClipping ) {\r\n\t\t\tswitch( textAlignVertical ) {\r\n\t\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\t\tswitch( textAlignHorizontal ) {\r\n\t\t\t\tcase EShapeTextAlignHorizontal.LEFT:\r\n\t\t\t\tcase EShapeTextAlignHorizontal.CENTER:\r\n\t\t\t\tcase EShapeTextAlignHorizontal.RIGHT:\r\n\t\t\t\t\tlineWidthMaximum = vl - textPaddingVertical * 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbreak;\r\n\t}\r\n\r\n\t//\r\n\tif( lineWidthMaximum < width ) {\r\n\t\tconst dwidth = ( width - lineWidthMaximum ) * 0.5;\r\n\t\ttextWorld[ 0 ] = tx0 + hnx * dwidth;\r\n\t\ttextWorld[ 1 ] = ty0 + hny * dwidth;\r\n\t\ttextWorld[ 2 ] = hnx;\r\n\t\ttextWorld[ 3 ] = hny;\r\n\t\ttextWorld[ 4 ] = vnx;\r\n\t\ttextWorld[ 5 ] = vny;\r\n\t\ttextWorld[ 6 ] = lineWidthMaximum;\r\n\t\ttextWorld[ 7 ] = height;\r\n\t} else {\r\n\t\ttextWorld[ 0 ] = tx0;\r\n\t\ttextWorld[ 1 ] = ty0;\r\n\t\ttextWorld[ 2 ] = hnx;\r\n\t\ttextWorld[ 3 ] = hny;\r\n\t\ttextWorld[ 4 ] = vnx;\r\n\t\ttextWorld[ 5 ] = vny;\r\n\t\ttextWorld[ 6 ] = width;\r\n\t\ttextWorld[ 7 ] = height;\r\n\t}\r\n\r\n\t// Texture\r\n\tconst uvx0 = textureUvs.x0;\r\n\tconst uvx1 = textureUvs.x1;\r\n\tconst uvx3 = textureUvs.x3;\r\n\tconst uvy0 = textureUvs.y0;\r\n\tconst uvy1 = textureUvs.y1;\r\n\tconst uvy3 = textureUvs.y3;\r\n\r\n\tconst duvx01 = ( uvx1 - uvx0 );\r\n\tconst duvy01 = ( uvy1 - uvy0 );\r\n\tconst duvx03 = ( uvx3 - uvx0 );\r\n\tconst duvy03 = ( uvy3 - uvy0 );\r\n\r\n\t// Vertices & UVs\r\n\tconst lhx = lineHeight * vnx;\r\n\tconst lhy = lineHeight * vny;\r\n\r\n\tconst snx = scale * hnx;\r\n\tconst sny = scale * hny;\r\n\r\n\tconst offsetY = (heightChar - textSize) * 0.5;\r\n\tconst oyx = offsetY * vnx;\r\n\tconst oyy = offsetY * vny;\r\n\r\n\tconst offsetItalic = ( textStyle === EShapeTextStyle.NORMAL ? 0 : textSize * 0.25 );\r\n\tlet bx0 = tx0 - oyx + offsetItalic * snx;\r\n\tlet by0 = ty0 - oyy + offsetItalic * sny;\r\n\tlet bx3 = tx0 + oyx + textSize * vnx;\r\n\tlet by3 = ty0 + oyy + textSize * vny;\r\n\tlet cx0 = bx0;\r\n\tlet cy0 = by0;\r\n\tlet cx3 = bx3;\r\n\tlet cy3 = by3;\r\n\r\n\tlineWidth = 0;\r\n\tadvancePrevious = 0;\r\n\titerator.position = 0;\r\n\tlet lineCount = 0;\r\n\tlet iv = voffset * 2;\r\n\tfor( ; iterator.hasNext(); iv += 8 ) {\r\n\t\tconst character = iterator.next();\r\n\t\tif( character !== \"\\n\" ) {\r\n\t\t\tconst lineWidthPrevious = lineWidth;\r\n\t\t\tif( 0 < advancePrevious ) {\r\n\t\t\t\tlineWidth += Math.max( 0, advancePrevious + textSpacingHorizontal );\r\n\t\t\t}\r\n\r\n\t\t\tconst ax = lineWidth * snx;\r\n\t\t\tconst ay = lineWidth * sny;\r\n\t\t\tcx0 = bx0 + ax;\r\n\t\t\tcy0 = by0 + ay;\r\n\t\t\tcx3 = bx3 + ax;\r\n\t\t\tcy3 = by3 + ay;\r\n\r\n\t\t\tconst data = textAtlasCharacters[ character ];\r\n\t\t\tlineCount += 1;\r\n\t\t\tif( data ) {\r\n\t\t\t\tconst advance = data.advance;\r\n\t\t\t\tif( lineWidthMaximum < (lineWidth + advance) * scale ) {\r\n\t\t\t\t\tconst dots = textAtlasCharacters[ \"...\" ];\r\n\t\t\t\t\tif( dots ) {\r\n\t\t\t\t\t\tif( 1 < lineCount && lineWidthMaximum < (lineWidth + dots.advance) * scale ) {\r\n\t\t\t\t\t\t\tlineWidth = lineWidthPrevious;\r\n\t\t\t\t\t\t\tiv -= 8;\r\n\t\t\t\t\t\t\tlineCount -= 1;\r\n\t\t\t\t\t\t\tconst bx = lineWidth * snx;\r\n\t\t\t\t\t\t\tconst by = lineWidth * sny;\r\n\t\t\t\t\t\t\tcx0 = bx0 + bx;\r\n\t\t\t\t\t\t\tcy0 = by0 + by;\r\n\t\t\t\t\t\t\tcx3 = bx3 + bx;\r\n\t\t\t\t\t\t\tcy3 = by3 + by;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tadvancePrevious = dots.advance;\r\n\r\n\t\t\t\t\t\twriteCharacter(\r\n\t\t\t\t\t\t\tvertices, uvs, iv, dots, textAtlas,\r\n\t\t\t\t\t\t\tsnx, sny,\r\n\t\t\t\t\t\t\tcx0, cy0, cx3, cy3,\r\n\t\t\t\t\t\t\tduvx01, duvy01, duvx03, duvy03,\r\n\t\t\t\t\t\t\tuvx0, uvy0\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tfor( iv += 8; true; iv += 8 ) {\r\n\t\t\t\t\t\t\tif( iterator.hasNext() && iterator.advance( \"\\n\" ) ) {\r\n\t\t\t\t\t\t\t\twriteCharacterEmpty(\r\n\t\t\t\t\t\t\t\t\tvertices, uvs, iv,\r\n\t\t\t\t\t\t\t\t\tcx0, cy0, cx3, cy3,\r\n\t\t\t\t\t\t\t\t\tuvx0, uvy0, uvx3, uvy3\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tlineCount += 1;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tiv -= 8;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tadvancePrevious = advance;\r\n\r\n\t\t\t\t\t\twriteCharacterEmpty(\r\n\t\t\t\t\t\t\tvertices, uvs, iv,\r\n\t\t\t\t\t\t\tcx0, cy0, cx3, cy3,\r\n\t\t\t\t\t\t\tuvx0, uvy0, uvx3, uvy3\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tadvancePrevious = advance;\r\n\r\n\t\t\t\t\twriteCharacter(\r\n\t\t\t\t\t\tvertices, uvs, iv, data, textAtlas,\r\n\t\t\t\t\t\tsnx, sny,\r\n\t\t\t\t\t\tcx0, cy0, cx3, cy3,\r\n\t\t\t\t\t\tduvx01, duvy01, duvx03, duvy03,\r\n\t\t\t\t\t\tuvx0, uvy0\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tadvancePrevious = 0;\r\n\r\n\t\t\t\twriteCharacterEmpty(\r\n\t\t\t\t\tvertices, uvs, iv,\r\n\t\t\t\t\tcx0, cy0, cx3, cy3,\r\n\t\t\t\t\tuvx0, uvy0, uvx3, uvy3\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlineWidth += advancePrevious;\r\n\t\t\tadvancePrevious = 0;\r\n\r\n\t\t\tbx0 += lhx;\r\n\t\t\tby0 += lhy;\r\n\t\t\tbx3 += lhx;\r\n\t\t\tby3 += lhy;\r\n\t\t\tcx0 = bx0;\r\n\t\t\tcy0 = by0;\r\n\t\t\tcx3 = bx3;\r\n\t\t\tcy3 = by3;\r\n\r\n\t\t\twriteCharacterEmpty(\r\n\t\t\t\tvertices, uvs, iv,\r\n\t\t\t\tcx0, cy0, cx3, cy3,\r\n\t\t\t\tuvx0, uvy0, uvx3, uvy3\r\n\t\t\t);\r\n\r\n\t\t\tadjustTextAlignment(\r\n\t\t\t\tvertices,\r\n\t\t\t\thnx, hny,\r\n\t\t\t\tlineCount,\r\n\t\t\t\tiv,\r\n\t\t\t\twidth - lineWidth * scale,\r\n\t\t\t\ttextDirection,\r\n\t\t\t\ttextAlignHorizontal,\r\n\t\t\t\ttextAlignVertical\r\n\t\t\t);\r\n\t\t\tlineWidth = 0;\r\n\t\t\tlineCount = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tlineWidth += advancePrevious;\r\n\tadjustTextAlignment(\r\n\t\tvertices,\r\n\t\thnx, hny,\r\n\t\tlineCount,\r\n\t\tiv,\r\n\t\twidth - lineWidth * scale,\r\n\t\ttextDirection,\r\n\t\ttextAlignHorizontal,\r\n\t\ttextAlignVertical\r\n\t);\r\n\r\n\tfor( const ivmax = (voffset + vcount) * 2; iv < ivmax; iv += 2 ) {\r\n\t\tvertices[ iv + 0 ] = tx0;\r\n\t\tvertices[ iv + 1 ] = ty0;\r\n\t\tuvs[ iv + 0 ] = uvx0;\r\n\t\tuvs[ iv + 1 ] = uvy0;\r\n\t}\r\n};\r\n\r\nconst writeCharacterEmpty = (\r\n\tvertices: Float32Array, uvs: Float32Array, iv: number,\r\n\tcx0: number, cy0: number,\r\n\tcx3: number, cy3: number,\r\n\tuvx0: number, uvy0: number,\r\n\tuvx3: number, uvy3: number\r\n): void => {\r\n\tvertices[ iv + 0 ] = cx0;\r\n\tvertices[ iv + 1 ] = cy0;\r\n\tvertices[ iv + 2 ] = cx0;\r\n\tvertices[ iv + 3 ] = cy0;\r\n\tvertices[ iv + 4 ] = cx3;\r\n\tvertices[ iv + 5 ] = cy3;\r\n\tvertices[ iv + 6 ] = cx3;\r\n\tvertices[ iv + 7 ] = cy3;\r\n\r\n\tuvs[ iv + 0 ] = uvx0;\r\n\tuvs[ iv + 1 ] = uvy0;\r\n\tuvs[ iv + 2 ] = uvx0;\r\n\tuvs[ iv + 3 ] = uvy0;\r\n\tuvs[ iv + 4 ] = uvx3;\r\n\tuvs[ iv + 5 ] = uvy3;\r\n\tuvs[ iv + 6 ] = uvx3;\r\n\tuvs[ iv + 7 ] = uvy3;\r\n};\r\n\r\nconst writeCharacter = (\r\n\tvertices: Float32Array, uvs: Float32Array, iv: number,\r\n\tdata: EShapeTextAtlasCharacter, atlas: EShapeTextAtlas,\r\n\tsnx: number, sny: number,\r\n\tcx0: number, cy0: number,\r\n\tcx3: number, cy3: number,\r\n\tduvx01: number, duvy01: number,\r\n\tduvx03: number, duvy03: number,\r\n\tuvx0: number, uvy0: number\r\n): void => {\r\n\t// Vertices\r\n\tconst dataOffsetX = data.x - data.origin.x;\r\n\tconst dataWidth = data.width;\r\n\tconst dx0 = dataOffsetX * snx;\r\n\tconst dy0 = dataOffsetX * sny;\r\n\tconst dx1 = (dataOffsetX + dataWidth) * snx;\r\n\tconst dy1 = (dataOffsetX + dataWidth) * sny;\r\n\tvertices[ iv + 0 ] = cx0 + dx0;\r\n\tvertices[ iv + 1 ] = cy0 + dy0;\r\n\tvertices[ iv + 2 ] = cx0 + dx1;\r\n\tvertices[ iv + 3 ] = cy0 + dy1;\r\n\tvertices[ iv + 4 ] = cx3 + dx1;\r\n\tvertices[ iv + 5 ] = cy3 + dy1;\r\n\tvertices[ iv + 6 ] = cx3 + dx0;\r\n\tvertices[ iv + 7 ] = cy3 + dy0;\r\n\r\n\t// UVs\r\n\tconst px0 = data.x / atlas.width;\r\n\tconst py0 = data.y / atlas.height;\r\n\tconst px1 = (data.x + data.width) / atlas.width;\r\n\tconst py1 = (data.y + data.height) / atlas.height;\r\n\r\n\tconst dux0 = duvx01 * px0;\r\n\tconst duy0 = duvy01 * px0;\r\n\tconst dux1 = duvx01 * px1;\r\n\tconst duy1 = duvy01 * px1;\r\n\r\n\tconst dvx0 = duvx03 * py0;\r\n\tconst dvy0 = duvy03 * py0;\r\n\tconst dvx1 = duvx03 * py1;\r\n\tconst dvy1 = duvy03 * py1;\r\n\tuvs[ iv + 0 ] = uvx0 + dux0 + dvx0;\r\n\tuvs[ iv + 1 ] = uvy0 + duy0 + dvy0;\r\n\tuvs[ iv + 2 ] = uvx0 + dux1 + dvx0;\r\n\tuvs[ iv + 3 ] = uvy0 + duy1 + dvy0;\r\n\tuvs[ iv + 4 ] = uvx0 + dux1 + dvx1;\r\n\tuvs[ iv + 5 ] = uvy0 + duy1 + dvy1;\r\n\tuvs[ iv + 6 ] = uvx0 + dux0 + dvx1;\r\n\tuvs[ iv + 7 ] = uvy0 + duy0 + dvy1;\r\n};\r\n\r\nconst moveText = ( vertices: Float32Array, vertexIndex: number, textCount: number, dx: number, dy: number ): void => {\r\n\tfor( let i = 0, iv = vertexIndex - 8 * textCount; i < textCount; i += 1, iv += 8 ) {\r\n\t\tvertices[ iv + 0 ] += dx;\r\n\t\tvertices[ iv + 1 ] += dy;\r\n\t\tvertices[ iv + 2 ] += dx;\r\n\t\tvertices[ iv + 3 ] += dy;\r\n\t\tvertices[ iv + 4 ] += dx;\r\n\t\tvertices[ iv + 5 ] += dy;\r\n\t\tvertices[ iv + 6 ] += dx;\r\n\t\tvertices[ iv + 7 ] += dy;\r\n\t}\r\n};\r\n\r\nconst moveTextHalf = (\r\n\tvertices: Float32Array, vertexIndex: number, textCount: number,\r\n\toffset: number, nx: number, ny: number\r\n): void => {\r\n\toffset *= 0.5;\r\n\tmoveText( vertices, vertexIndex, textCount, offset * nx, offset * ny );\r\n};\r\n\r\nconst moveTextFull = (\r\n\tvertices: Float32Array, vertexIndex: number, textCount: number,\r\n\toffset: number, nx: number, ny: number\r\n): void => {\r\n\tmoveText( vertices, vertexIndex, textCount, offset * nx, offset * ny );\r\n};\r\n\r\nconst adjustTextAlignment = (\r\n\tvertices: Float32Array,\r\n\tnx: number, ny: number,\r\n\tlineCount: number, vertexIndex: number,\r\n\toffset: number,\r\n\ttextDirection: EShapeTextDirection,\r\n\ttextAlignHorizontal: EShapeTextAlignHorizontal,\r\n\ttextAlignVertical: EShapeTextAlignVertical\r\n): void => {\r\n\tif( TEXT_FMIN < offset ) {\r\n\t\tswitch( textDirection ) {\r\n\t\tcase EShapeTextDirection.LEFT_TO_RIGHT:\r\n\t\t\tswitch( textAlignHorizontal ) {\r\n\t\t\tcase EShapeTextAlignHorizontal.OUTSIDE_RIGHT:\r\n\t\t\tcase EShapeTextAlignHorizontal.LEFT:\r\n\t\t\t\t// DO NOTHING\r\n\t\t\t\tbreak;\r\n\t\t\tcase EShapeTextAlignHorizontal.CENTER:\r\n\t\t\t\tmoveTextHalf( vertices, vertexIndex, lineCount, offset, nx, ny );\r\n\t\t\t\tbreak;\r\n\t\t\tcase EShapeTextAlignHorizontal.OUTSIDE_LEFT:\r\n\t\t\tcase EShapeTextAlignHorizontal.RIGHT:\r\n\t\t\t\tmoveTextFull( vertices, vertexIndex, lineCount, offset, nx, ny );\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextDirection.TOP_TO_BOTTOM:\r\n\t\t\tswitch( textAlignVertical ) {\r\n\t\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\r\n\t\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\t\t// DO NOTHING\r\n\t\t\t\tbreak;\r\n\t\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\t\tmoveTextHalf( vertices, vertexIndex, lineCount, offset, nx, ny );\r\n\t\t\t\tbreak;\r\n\t\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\r\n\t\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\t\tmoveTextFull( vertices, vertexIndex, lineCount, offset, nx, ny );\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase EShapeTextDirection.BOTTOM_TO_TOP:\r\n\t\t\tswitch( textAlignVertical ) {\r\n\t\t\tcase EShapeTextAlignVertical.OUTSIDE_BOTTOM:\r\n\t\t\tcase EShapeTextAlignVertical.TOP:\r\n\t\t\t\tmoveTextFull( vertices, vertexIndex, lineCount, offset, nx, ny );\r\n\t\t\t\tbreak;\r\n\t\t\tcase EShapeTextAlignVertical.MIDDLE:\r\n\t\t\t\tmoveTextHalf( vertices, vertexIndex, lineCount, offset, nx, ny );\r\n\t\t\t\tbreak;\r\n\t\t\tcase EShapeTextAlignVertical.OUTSIDE_TOP:\r\n\t\t\tcase EShapeTextAlignVertical.BOTTOM:\r\n\t\t\t\t// DO NOTHING\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n};\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix, Point } from \"pixi.js\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapePoints } from \"../e-shape-points\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeBarPosition } from \"./e-shape-bar-position\";\r\nimport {\r\n\tEShapeLineBasePoints, EShapeLineBasePointsHitTester, EShapeLineBasePointsTestRange\r\n} from \"./e-shape-line-base-points\";\r\n\r\nexport class EShapeBarPoints implements EShapeLineBasePoints {\r\n\tprotected _parent: EShape;\r\n\tprotected _id: number;\r\n\tprotected _style: EShapePointsStyle;\r\n\tprotected _values: [ number, number, number, number ];\r\n\tprotected _segments: number[];\r\n\tprotected _size: number;\r\n\tprotected _position: EShapeBarPosition;\r\n\r\n\tprotected _updatedSize: number;\r\n\tprotected _updatedParentSizeX: number;\r\n\tprotected _updatedParentSizeY: number;\r\n\tprotected _updatedPosition: EShapeBarPosition;\r\n\r\n\tconstructor( parent: EShape, position: EShapeBarPosition, size: number, style: EShapePointsStyle ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._id = 0;\r\n\t\tthis._values = [ 0, 0, 0, 0 ];\r\n\t\tthis._segments = [];\r\n\t\tthis._style = style;\r\n\t\tthis._size = size;\r\n\t\tthis._position = position;\r\n\r\n\t\tthis._updatedSize = NaN;\r\n\t\tthis._updatedParentSizeX = NaN;\r\n\t\tthis._updatedParentSizeY = NaN;\r\n\t\tthis._updatedPosition = NaN;\r\n\t}\r\n\r\n\tprotected getComputedSize( size: number, position: EShapeBarPosition, sizeX: number, sizeY: number ): number {\r\n\t\tif( 0 <= size ) {\r\n\t\t\treturn size;\r\n\t\t} else {\r\n\t\t\tswitch( position ) {\r\n\t\t\tcase EShapeBarPosition.TOP:\r\n\t\t\tcase EShapeBarPosition.BOTTOM:\r\n\t\t\t\treturn Math.abs( sizeY );\r\n\t\t\tcase EShapeBarPosition.RIGHT:\r\n\t\t\tcase EShapeBarPosition.LEFT:\r\n\t\t\t\treturn Math.abs( sizeX );\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected update(): void {\r\n\t\tconst parentSize = this._parent.size;\r\n\t\tconst parentSizeX = parentSize.x;\r\n\t\tconst parentSizeY = parentSize.y;\r\n\t\tconst position = this._position;\r\n\t\tconst size = this._size;\r\n\t\tif( this._updatedSize !== size || this._updatedParentSizeX !== parentSizeX ||\r\n\t\t\tthis._updatedParentSizeY !== parentSizeY || this._updatedPosition !== position ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._updatedSize = size;\r\n\t\t\tthis._updatedParentSizeX = parentSizeX;\r\n\t\t\tthis._updatedParentSizeY = parentSizeY;\r\n\t\t\tthis._updatedPosition = position;\r\n\t\t\tconst psxh = parentSizeX * 0.5;\r\n\t\t\tconst psyh = parentSizeY * 0.5;\r\n\t\t\tconst computedSize = this.getComputedSize( size, position, parentSizeX, parentSizeY );\r\n\t\t\tconst values = this._values;\r\n\t\t\tswitch( position ) {\r\n\t\t\tcase EShapeBarPosition.TOP:\r\n\t\t\t\tvalues[ 0 ] = 0;\r\n\t\t\t\tvalues[ 1 ] = -psyh;\r\n\t\t\t\tvalues[ 2 ] = 0;\r\n\t\t\t\tvalues[ 3 ] = -psyh + computedSize;\r\n\t\t\t\tbreak;\r\n\t\t\tcase EShapeBarPosition.RIGHT:\r\n\t\t\t\tvalues[ 0 ] = psxh;\r\n\t\t\t\tvalues[ 1 ] = 0;\r\n\t\t\t\tvalues[ 2 ] = psxh - computedSize;\r\n\t\t\t\tvalues[ 3 ] = 0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase EShapeBarPosition.BOTTOM:\r\n\t\t\t\tvalues[ 0 ] = 0;\r\n\t\t\t\tvalues[ 1 ] = psyh;\r\n\t\t\t\tvalues[ 2 ] = 0;\r\n\t\t\t\tvalues[ 3 ] = psyh - computedSize;\r\n\t\t\t\tbreak;\r\n\t\t\tcase EShapeBarPosition.LEFT:\r\n\t\t\t\tvalues[ 0 ] = -psxh;\r\n\t\t\t\tvalues[ 1 ] = 0;\r\n\t\t\t\tvalues[ 2 ] = -psxh + computedSize;\r\n\t\t\t\tvalues[ 3 ] = 0;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget length(): number {\r\n\t\treturn 2;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\tthis.update();\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget values(): number[] {\r\n\t\tthis.update();\r\n\t\treturn this._values;\r\n\t}\r\n\r\n\tset values( values: number[] ) {\r\n\t\t// SUPPOSED NOT TO BE CALLED\r\n\t}\r\n\r\n\tget segments(): number[] {\r\n\t\treturn this._segments;\r\n\t}\r\n\r\n\tset segments( segments: number[] ) {\r\n\t\t// SUPPOSED NOT TO BE CALLED\r\n\t}\r\n\r\n\tget size(): number {\r\n\t\treturn this._size;\r\n\t}\r\n\r\n\tset size( size: number ) {\r\n\t\tthis.moveTo( undefined, size, undefined );\r\n\t}\r\n\r\n\tget position(): EShapeBarPosition {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tset position( position: EShapeBarPosition ) {\r\n\t\tthis.moveTo( position, undefined, undefined );\r\n\t}\r\n\r\n\tget style(): EShapePointsStyle {\r\n\t\treturn this._style;\r\n\t}\r\n\r\n\tset style( style: EShapePointsStyle ) {\r\n\t\tthis.moveTo( undefined, undefined, style );\r\n\t}\r\n\r\n\tcopy( source: EShapePoints ): this {\r\n\t\tif( source instanceof EShapeBarPoints ) {\r\n\t\t\treturn this.moveTo( source.position, source.size, source.style );\r\n\t\t} else {\r\n\t\t\treturn this.moveTo( undefined, undefined, source.style );\r\n\t\t}\r\n\t}\r\n\r\n\tset( newValues?: number[], newSegments?: number[], newStyle?: EShapePointsStyle ): this {\r\n\t\tlet newPosition: EShapeBarPosition | undefined;\r\n\t\tlet newSize: number | undefined;\r\n\t\tif( newValues != null ) {\r\n\t\t\tconst x0 = newValues[ 0 ];\r\n\t\t\tif( x0 === 0 ) {\r\n\t\t\t\tconst y0 = newValues[ 1 ];\r\n\t\t\t\tnewPosition = ( y0 <= 0 ? EShapeBarPosition.TOP : EShapeBarPosition.BOTTOM );\r\n\t\t\t\tnewSize = Math.abs( newValues[ 3 ] - y0 );\r\n\t\t\t} else {\r\n\t\t\t\tnewPosition = ( x0 <= 0 ? EShapeBarPosition.LEFT : EShapeBarPosition.RIGHT );\r\n\t\t\t\tnewSize = Math.abs( newValues[ 2 ] - x0 );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.moveTo( newPosition, newSize, newStyle );\r\n\t}\r\n\r\n\tprotected moveTo( position?: EShapeBarPosition, size?: number, style?: EShapePointsStyle ): this {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( style != null && this._style !== style ) {\r\n\t\t\tthis._style = style;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( position != null && this._position !== position ) {\r\n\t\t\tthis._position = position;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( size != null && this._size !== size ) {\r\n\t\t\tthis._size = size;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone( parent: EShape ): EShapeBarPoints {\r\n\t\treturn new EShapeBarPoints( parent, this._position, this._size, this._style );\r\n\t}\r\n\r\n\ttoPoints( transform: Matrix ): Point[] {\r\n\t\tconst result: Point[] = [];\r\n\t\tconst values = this.values;\r\n\t\tfor( let i = 0, imax = values.length; i < imax; i += 2 ) {\r\n\t\t\tconst point = new Point( values[ i + 0 ], values[ i + 1 ] );\r\n\t\t\tresult.push( transform.apply( point, point ) );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn manager.add( `[${this._position},${this._size},${this._style}]` );\r\n\t}\r\n\r\n\tdeserialize( resourceId: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\tif( 0 <= resourceId && resourceId < manager.resources.length ) {\r\n\t\t\tconst resource = manager.resources[ resourceId ];\r\n\t\t\tconst parsed = JSON.parse( resource ) as [ number, number, number ];\r\n\t\t\tthis.moveTo( parsed[ 0 ], parsed[ 1 ], parsed[ 2 ] );\r\n\t\t}\r\n\t}\r\n\r\n\tcalcHitPointAbs<RESULT>(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tthreshold: number,\r\n\t\trange: EShapeLineBasePointsTestRange | null,\r\n\t\ttester: EShapeLineBasePointsHitTester<RESULT>,\r\n\t\tresult: RESULT\r\n\t): boolean {\r\n\t\tconst length = this.length;\r\n\t\tif( 2 <= length ) {\r\n\t\t\tconst values = this._values;\r\n\t\t\tconst v0x = values[ 0 ];\r\n\t\t\tconst v0y = values[ 1 ];\r\n\t\t\tconst v1x = values[ 2 ];\r\n\t\t\tconst v1y = values[ 3 ];\r\n\t\t\tif( tester( x, y, v0x, v0y, v1x, v1y, 0, threshold, result ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DBaseState {\r\n\tNONE\t\t= 0,\r\n\tHOVERED\t\t= 1 << 0,\r\n\tACTIVE\t\t= 1 << 1,\r\n\tACTIVE_IN\t= 1 << 2,\r\n\tFOCUSED\t\t= 1 << 3,\r\n\tFOCUSED_IN\t= 1 << 4,\r\n\tUNFOCUSABLE\t= 1 << 5,\r\n\tFOCUS_ROOT\t= 1 << 6,\r\n\tREAD_ONLY\t= 1 << 7,\r\n\tDISABLED\t= 1 << 8,\r\n\tDRAGGING\t= 1 << 9,\r\n\tPRESSED\t\t= 1 << 10,\r\n\tINVALID\t\t= 1 << 11,\r\n\tSUCCEEDED\t= 1 << 12,\r\n\tFAILED\t\t= 1 << 13,\r\n\r\n\tCUSTOM\t\t= 1 << 20\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DApplicationLayerLike } from \"./d-application-layer-like\";\r\nimport { DApplicationLayerStageLike } from \"./d-application-layer-stage-like\";\r\nimport { DApplicationLike, DApplicationTarget } from \"./d-application-like\";\r\n\r\nexport class DApplications {\r\n\tprotected static INSTANCES: DApplicationLike[] = [];\r\n\r\n\tstatic add( instance: DApplicationLike ): void {\r\n\t\tconst instances = DApplications.INSTANCES;\r\n\t\tinstances.push( instance );\r\n\t}\r\n\r\n\tstatic first(): DApplicationLike {\r\n\t\tconst instances = DApplications.INSTANCES;\r\n\t\tif( 0 < instances.length ) {\r\n\t\t\treturn instances[ 0 ];\r\n\t\t}\r\n\t\tthrow new Error( \"No application found.\" );\r\n\t}\r\n\r\n\tstatic last(): DApplicationLike {\r\n\t\tconst instances = DApplications.INSTANCES;\r\n\t\tif( 0 < instances.length ) {\r\n\t\t\treturn instances[ instances.length - 1 ];\r\n\t\t}\r\n\t\tthrow new Error( \"No application found.\" );\r\n\t}\r\n\r\n\tstatic get( index: number ): DApplicationLike | null {\r\n\t\tconst instances = DApplications.INSTANCES;\r\n\t\tif( 0 <= index && index < instances.length ) {\r\n\t\t\treturn instances[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic indexOf( instance: DApplicationLike ): number {\r\n\t\treturn DApplications.INSTANCES.indexOf( instance );\r\n\t}\r\n\r\n\tstatic size(): number {\r\n\t\treturn DApplications.INSTANCES.length;\r\n\t}\r\n\r\n\tprotected static toStage( target: DApplicationTarget ): DApplicationLayerStageLike | null {\r\n\t\tlet stage: any = target;\r\n\t\twhile( stage.parent ) {\r\n\t\t\tstage = stage.parent;\r\n\t\t}\r\n\t\tif( (\"application\" in stage) && (\"layer\" in stage) ) {\r\n\t\t\treturn stage as DApplicationLayerStageLike;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic find( target: DApplicationTarget ): DApplicationLike | null {\r\n\t\tconst stage = this.toStage( target );\r\n\t\tif( stage ) {\r\n\t\t\treturn stage.layer.application;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic getLayerBase( target: DApplicationTarget ): DApplicationLayerLike | null {\r\n\t\tconst stage = this.toStage( target );\r\n\t\tif( stage ) {\r\n\t\t\treturn stage.layer.application.getLayerBase();\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic getLayerOverlay( target: DApplicationTarget ): DApplicationLayerLike | null {\r\n\t\tconst stage = this.toStage( target );\r\n\t\tif( stage ) {\r\n\t\t\treturn stage.layer.application.getLayerOverlay();\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic getLayer( target: DApplicationTarget ): DApplicationLayerLike | null {\r\n\t\tconst stage = this.toStage( target );\r\n\t\tif( stage ) {\r\n\t\t\treturn stage.layer;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic update( target?: DApplicationTarget ): void {\r\n\t\tif( target ) {\r\n\t\t\tconst stage = this.toStage( target );\r\n\t\t\tif( stage ) {\r\n\t\t\t\tstage.layer.update();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst instances = DApplications.INSTANCES;\r\n\t\t\tfor( let i = 0, imax = instances.length; i < imax; ++i ) {\r\n\t\t\t\tinstances[ i ].update();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstatic render( target?: DApplicationTarget ): void {\r\n\t\tif( target ) {\r\n\t\t\tconst stage = this.toStage( target );\r\n\t\t\tif( stage ) {\r\n\t\t\t\tstage.layer.render();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst instances = DApplications.INSTANCES;\r\n\t\t\tfor( let i = 0, imax = instances.length; i < imax; ++i ) {\r\n\t\t\t\tinstances[ i ].render();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\n\r\nexport class EShapeAction {\r\n\tvalues: EShapeActionValue[];\r\n\r\n\tconstructor() {\r\n\t\tthis.values = [];\r\n\t}\r\n\r\n\tadd( value: EShapeActionValue, index?: number ): void {\r\n\t\tconst values = this.values;\r\n\t\tif( index != null ) {\r\n\t\t\tvalues.splice( index, 0, value );\r\n\t\t} else {\r\n\t\t\tvalues.push( value );\r\n\t\t}\r\n\t}\r\n\r\n\taddAll( values: EShapeActionValue[] ): void {\r\n\t\tconst sources = values;\r\n\t\tconst destinations = this.values;\r\n\t\tfor( let i = 0, imax = sources.length; i < imax; ++i) {\r\n\t\t\tdestinations.push( sources[i] );\r\n\t\t}\r\n\t}\r\n\r\n\tindexOf( target: EShapeActionValue ): number {\r\n\t\tconst values = this.values;\r\n\r\n\t\t// Instance-based matching\r\n\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\tconst value = values[ i ];\r\n\t\t\tif( value === target ) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Data-based matching\r\n\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\tconst value = values[ i ];\r\n\t\t\tif( value.isEquals( target ) ) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tget( index: number ): EShapeActionValue | null {\r\n\t\tconst result = this.values[ index ];\r\n\t\tif( result != null ) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tset( index: number, value: EShapeActionValue ): void {\r\n\t\tthis.values[ index ] = value;\r\n\t}\r\n\r\n\tremove( index: number ): void {\r\n\t\tthis.values.splice( index, 1 );\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tthis.values.length = 0;\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this.values.length;\r\n\t}\r\n\r\n\tswap( indexA: number, indexB: number ): void {\r\n\t\tconst values = this.values;\r\n\t\tconst tmp = values[ indexB ];\r\n\t\tvalues[ indexB ] = values[ indexA ];\r\n\t\tvalues[ indexA ] = tmp;\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number[] {\r\n\t\tconst result: number[] = [];\r\n\t\tconst values = this.values;\r\n\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\tresult.push( values[ i ].serialize( manager ) );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, IPoint, Point, Rectangle, Texture, utils } from \"pixi.js\";\r\nimport { DBaseState } from \"../d-base-state\";\r\nimport { DDiagramSerializedItem } from \"../d-diagram-serialized\";\r\nimport { EShapeAction } from \"./action/e-shape-action\";\r\nimport { EShapeContainer } from \"./e-shape-container\";\r\nimport { EShapeCorner } from \"./e-shape-corner\";\r\nimport { EShapeEditor } from \"./e-shape-editor\";\r\nimport { EShapeFill } from \"./e-shape-fill\";\r\nimport { EShapeGradientLike } from \"./e-shape-gradient\";\r\nimport { EShapeLayout } from \"./e-shape-layout\";\r\nimport { EShapePoints } from \"./e-shape-points\";\r\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\r\nimport { EShapeRuntime } from \"./e-shape-runtime\";\r\nimport { EShapeStroke } from \"./e-shape-stroke\";\r\nimport { EShapeTag } from \"./e-shape-tag\";\r\nimport { EShapeText } from \"./e-shape-text\";\r\nimport { EShapeTransform } from \"./e-shape-transform\";\r\nimport { EShapeType } from \"./e-shape-type\";\r\nimport { EShapeUploaded } from \"./e-shape-uploaded\";\r\n\r\nexport enum EShapeCopyPart {\r\n\tNONE = 0,\r\n\tTRANSFORM = 1,\r\n\tSIZE = 2,\r\n\tSTYLE = 4,\r\n\tACTION = 8,\r\n\tPOINTS = 16,\r\n\tSTATE = 32,\r\n\tALL = TRANSFORM | SIZE | STYLE | ACTION | POINTS | STATE\r\n}\r\n\r\nexport interface EShape extends utils.EventEmitter {\r\n\tid: string;\r\n\treadonly type: EShapeType;\r\n\treadonly size: IPoint;\r\n\treadonly fill: EShapeFill;\r\n\treadonly stroke: EShapeStroke;\r\n\treadonly transform: EShapeTransform;\r\n\tradius: number;\r\n\tcorner: EShapeCorner;\r\n\treadonly points?: EShapePoints;\r\n\timage?: HTMLImageElement;\r\n\timageSrc?: string;\r\n\ttexture?: Texture;\r\n\tgradient?: EShapeGradientLike;\r\n\treadonly text: EShapeText;\r\n\treadonly tag: EShapeTag;\r\n\treadonly action: EShapeAction;\r\n\tcursor: string;\r\n\tvisible: boolean;\r\n\tinteractive: boolean;\r\n\tshortcut?: string;\r\n\ttitle?: string;\r\n\r\n\t// Hierarchy\r\n\tparent: EShapeContainer | EShape | null;\r\n\troot: EShape;\r\n\tchildren: EShape[];\r\n\tlayout?: EShapeLayout;\r\n\r\n\t// Working space\r\n\tindex: number;\t\t// A work space for sorting.\r\n\tselected: boolean;\r\n\treference: number;\t// Count of references from commands\r\n\r\n\t// Working space for the viewer\r\n\truntime?: EShapeRuntime;\r\n\r\n\t// Working space for the editor\r\n\teditor?: EShapeEditor;\r\n\r\n\t// Working space for the renderer\r\n\tuploaded?: EShapeUploaded;\r\n\r\n\t//\r\n\thovered: boolean;\r\n\tactive: boolean;\r\n\treadonly: boolean;\r\n\treadonly enabled: boolean;\r\n\tdisabled: boolean;\r\n\tdragging: boolean;\r\n\tfocused: boolean;\r\n\treadonly focusedin: boolean;\r\n\tunfocusable: boolean;\r\n\treadonly clicked: boolean;\r\n\treadonly pressed: boolean;\r\n\treadonly down: boolean;\r\n\treadonly up: boolean;\r\n\treadonly shadowed: boolean;\r\n\r\n\t//\r\n\ttoDirty(): void;\r\n\tattach( parent: EShapeContainer | EShape, at?: number ): this;\r\n\tdetach(): this;\r\n\tcopy( source: EShape ): this;\r\n\tcopy( source: EShape, part: EShapeCopyPart ): this;\r\n\tclone(): EShape;\r\n\tdestroy(): void;\r\n\r\n\t//\r\n\tgetState(): DBaseState;\r\n\tsetState( state: DBaseState, isOn: boolean ): this;\r\n\thasState( state: DBaseState ): boolean;\r\n\tfocus(): this;\r\n\tblur(): this;\r\n\r\n\t//\r\n\tonDblClick( e: MouseEvent ): void;\r\n\tonShortcut( e: KeyboardEvent ): void;\r\n\tonSizeChange(): void;\r\n\r\n\t// Action\r\n\tupdate( time: number ): void;\r\n\r\n\t// Transform\r\n\tupdateTransform(): void;\r\n\tdisallowOnTransformChange(): void;\r\n\tallowOnTransformChange( invokeOnTransformChange: boolean ): void;\r\n\tonTransformChange(): void;\r\n\tonChildTransformChange(): void;\r\n\r\n\t// Uploaded\r\n\tdisallowUploadedUpdate(): void;\r\n\tallowUploadedUpdate(): void;\r\n\tupdateUploaded(): void;\r\n\tupdateUploadedRecursively(): void;\r\n\r\n\t// Serialization\r\n\tserialize( manager: EShapeResourceManagerSerialization ): DDiagramSerializedItem;\r\n\r\n\t// Hit test\r\n\tcontains( point: Point ): EShape | null;\r\n\tcontainsBBox( point: Point ): boolean;\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean;\r\n\tcontainsAbsBBox( x: number, y: number, ax: number, ay: number ): boolean;\r\n\r\n\t// Coordinate\r\n\ttoGlobal( position: IPoint, result: Point, skipUpdate?: boolean ): Point;\r\n\ttoLocal( position: IPoint, from?: DisplayObject, result?: Point, skipUpdate?: boolean ): Point;\r\n\tgetBounds( work: Point, skipUpdate: boolean, result: Rectangle ): Rectangle;\r\n\tgetBoundsInternal( work: Point, skipUpdate: boolean, result: Rectangle ): Rectangle;\r\n\tgetBoundsLocal( work: Point, skipUpdate: boolean, result: Rectangle ): Rectangle;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const isString = ( target: unknown ): target is string => {\r\n\treturn ( typeof target === \"string\" ) ||\r\n\t\t( Object.prototype.toString.call( target ) === \"[object String]\" );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point } from \"pixi.js\";\r\nimport { DApplications } from \"../d-applications\";\r\nimport { DBaseState } from \"../d-base-state\";\r\nimport { DControllers } from \"../d-controllers\";\r\nimport { UtilKeyboardEvent } from \"../util/util-keyboard-event\";\r\nimport { EShapeActionRuntime } from \"./action/e-shape-action-runtime\";\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeFillLike } from \"./e-shape-fill\";\r\nimport { EShapeStrokeLike } from \"./e-shape-stroke\";\r\nimport { EShapeTextLike } from \"./e-shape-text\";\r\n\r\nexport enum EShapeRuntimeReset {\r\n\tNONE = 0,\r\n\tPOSITION_X = 1,\r\n\tPOSITION_Y = 2,\r\n\tPOSITION = POSITION_X | POSITION_Y,\r\n\tROTATION = 4,\r\n\tCOLOR_FILL = 8,\r\n\tCOLOR_STROKE = 16,\r\n\tCOLOR_FILL_AND_STROKE = COLOR_FILL | COLOR_STROKE,\r\n\tCOLOR_TEXT = 32,\r\n\tCOLOR_TEXT_OUTLINE = 64,\r\n\tCOLOR = COLOR_FILL | COLOR_STROKE | COLOR_TEXT | COLOR_TEXT_OUTLINE,\r\n\tVISIBILITY = 128,\r\n\tHEIGHT = 256,\r\n\tWIDTH = 512,\r\n\tSIZE = HEIGHT | WIDTH,\r\n\tTEXT = 1024,\r\n\tCURSOR = 2048\r\n}\r\n\r\nexport enum EShapeRuntimeState {\r\n\tNONE = 0,\r\n\tCHANGED = 1,\r\n\tCLICKED = 2,\r\n\tDOWN = 4,\r\n\tUP = 8,\r\n\tPRESSED = 16,\r\n\tPERSISTENT = PRESSED\r\n}\r\n\r\nexport class EShapeRuntime {\r\n\tx: number;\r\n\ty: number;\r\n\tsize: Point;\r\n\trotation: number;\r\n\tactions: EShapeActionRuntime[];\r\n\tfill: EShapeFillLike;\r\n\tstroke: EShapeStrokeLike;\r\n\ttext: EShapeTextLike;\r\n\tcursor: string;\r\n\r\n\treset: EShapeRuntimeReset;\r\n\twritten: EShapeRuntimeReset;\r\n\r\n\teffect: number;\r\n\r\n\tstate: EShapeRuntimeState;\r\n\r\n\tinteractive: boolean;\r\n\r\n\tconstructor( shape: EShape ) {\r\n\t\tconst transform = shape.transform;\r\n\t\tconst position = transform.position;\r\n\t\tthis.x = position.x;\r\n\t\tthis.y = position.y;\r\n\t\tthis.size = new Point( shape.size.x, shape.size.y );\r\n\t\tthis.rotation = transform.rotation;\r\n\t\tthis.actions = [];\r\n\t\tthis.fill = shape.fill.toObject();\r\n\t\tthis.stroke = shape.stroke.toObject();\r\n\t\tthis.text = shape.text.toObject();\r\n\t\tthis.cursor = shape.cursor;\r\n\t\tthis.reset = EShapeRuntimeReset.NONE;\r\n\t\tthis.written = EShapeRuntimeReset.NONE;\r\n\t\tthis.effect = NaN;\r\n\t\tthis.state = EShapeRuntimeState.NONE;\r\n\t\tthis.interactive = false;\r\n\t}\r\n\r\n\tonPointerClick( shape: EShape, e?: interaction.InteractionEvent ): void {\r\n\t\tif( ! shape.disabled ) {\r\n\t\t\tif( ! (this.state & EShapeRuntimeState.CLICKED) ) {\r\n\t\t\t\tthis.state |= EShapeRuntimeState.CHANGED | EShapeRuntimeState.CLICKED;\r\n\t\t\t\tDApplications.update( shape );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonPointerDblClick( shape: EShape, e?: MouseEvent | TouchEvent ): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonPointerOver( shape: EShape, e?: interaction.InteractionEvent ): void {\r\n\t\tshape.hovered = true;\r\n\t}\r\n\r\n\tonPointerOut( shape: EShape, e?: interaction.InteractionEvent ): void {\r\n\t\tshape.hovered = false;\r\n\t}\r\n\r\n\tonPointerDown( shape: EShape, e?: interaction.InteractionEvent ): void {\r\n\t\tconst layer = DApplications.getLayer( shape );\r\n\t\tif( ! (this.state & EShapeRuntimeState.DOWN) ) {\r\n\t\t\tthis.state |= EShapeRuntimeState.CHANGED | EShapeRuntimeState.DOWN | EShapeRuntimeState.PRESSED;\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.update();\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( layer ) {\r\n\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\tfocusController.setFocused( focusController.findFocusableParent( shape ), true, true );\r\n\t\t}\r\n\t}\r\n\r\n\tonPointerUp( shape: EShape, e?: interaction.InteractionEvent ): void {\r\n\t\tif( ! (this.state & EShapeRuntimeState.UP) ) {\r\n\t\t\tthis.state |= EShapeRuntimeState.CHANGED | EShapeRuntimeState.UP;\r\n\t\t\tthis.state &= ~EShapeRuntimeState.PRESSED;\r\n\t\t\tDApplications.update( shape );\r\n\t\t}\r\n\t}\r\n\r\n\tonPointerMove( shape: EShape, e?: interaction.InteractionEvent ): void {\r\n\t\t//\r\n\t}\r\n\r\n\tonKeyDown( shape: EShape, e: KeyboardEvent ): boolean {\r\n\t\tif( UtilKeyboardEvent.isActivateKey( e ) ) {\r\n\t\t\tthis.onPointerDown( shape );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonKeyUp( shape: EShape, e: KeyboardEvent ): boolean {\r\n\t\tif( UtilKeyboardEvent.isActivateKey( e ) ) {\r\n\t\t\tthis.onPointerUp( shape );\r\n\t\t\tthis.onPointerClick( shape );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonStateChange( shape: EShape, newState: DBaseState, oldState: DBaseState ): void {\r\n\t\tthis.state |= EShapeRuntimeState.CHANGED;\r\n\t\tDApplications.update( shape );\r\n\t}\r\n\r\n\tupdate( shape: EShape, time: number ): void {\r\n\t\tconst tag = shape.tag;\r\n\t\tconst isEffectTimeUp = ( this.effect <= time );\r\n\t\tif( tag.isChanged || (this.state & EShapeRuntimeState.CHANGED) || isEffectTimeUp ) {\r\n\t\t\tif( isEffectTimeUp ) {\r\n\t\t\t\tthis.effect = NaN;\r\n\t\t\t}\r\n\t\t\tshape.disallowUploadedUpdate();\r\n\t\t\tthis.onUpdate( shape, time );\r\n\t\t\tshape.allowUploadedUpdate();\r\n\t\t\tthis.state &= EShapeRuntimeState.PERSISTENT;\r\n\t\t\ttag.isChanged = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onUpdate( shape: EShape, time: number ): void {\r\n\t\tif( 0 < this.actions.length ) {\r\n\t\t\tthis.executeActions( shape, time );\r\n\t\t\tthis.resetUnwrittenProperties( shape );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected executeActions( shape: EShape, time: number ): void {\r\n\t\tthis.written = EShapeRuntimeReset.NONE;\r\n\t\tconst actions = this.actions;\r\n\t\tfor( let i = 0, imax = actions.length; i < imax; ++i ) {\r\n\t\t\tactions[ i ].execute( shape, this, time );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected resetUnwrittenProperties( shape: EShape ): void {\r\n\t\tconst target = (~this.written) & this.reset;\r\n\t\tif( target !== EShapeRuntimeReset.NONE ) {\r\n\t\t\tif( target & EShapeRuntimeReset.POSITION_X ) {\r\n\t\t\t\tshape.transform.position.x = this.x;\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.POSITION_Y ) {\r\n\t\t\t\tshape.transform.position.y = this.y;\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.VISIBILITY ) {\r\n\t\t\t\tshape.visible = true;\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.COLOR_FILL ) {\r\n\t\t\t\tconst fill = this.fill;\r\n\t\t\t\tshape.fill.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tfill.color,\r\n\t\t\t\t\tfill.alpha\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.COLOR_STROKE ) {\r\n\t\t\t\tconst stroke = this.stroke;\r\n\t\t\t\tshape.stroke.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tstroke.color,\r\n\t\t\t\t\tstroke.alpha\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.COLOR_TEXT ) {\r\n\t\t\t\tconst text = this.text;\r\n\t\t\t\tshape.text.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\ttext.color,\r\n\t\t\t\t\ttext.alpha\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.COLOR_TEXT_OUTLINE ) {\r\n\t\t\t\tconst outline = this.text.outline;\r\n\t\t\t\tshape.text.outline.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\toutline.color,\r\n\t\t\t\t\toutline.alpha\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.HEIGHT ) {\r\n\t\t\t\tshape.size.y = this.size.y;\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.WIDTH ) {\r\n\t\t\t\tshape.size.x = this.size.x;\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.ROTATION ) {\r\n\t\t\t\tshape.transform.rotation = this.rotation;\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.TEXT ) {\r\n\t\t\t\tshape.text.value = this.text.value;\r\n\t\t\t}\r\n\t\t\tif( target & EShapeRuntimeReset.CURSOR ) {\r\n\t\t\t\tshape.cursor = this.cursor;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"../d-base\";\r\nimport { isString } from \"./is-string\";\r\n\r\nexport interface UtilKeyboardEventShortcut {\r\n\talt: boolean;\r\n\tctrl: boolean;\r\n\tshift: boolean;\r\n\tkey: string;\r\n\twhich: number;\r\n\tevent?: string;\r\n}\r\n\r\nconst setShortcutKeyAndWhich = ( shortcut: UtilKeyboardEventShortcut ): UtilKeyboardEventShortcut => {\r\n\tconst key = shortcut.key;\r\n\tif( key.length <= 1 ) {\r\n\t\tif( shortcut.shift ) {\r\n\t\t\tshortcut.key = key.toUpperCase();\r\n\t\t}\r\n\t\tconst code = key.charCodeAt( 0 );\r\n\t\tif( 97 <= code && code <= 122 ) {\r\n\t\t\t// a ... z\r\n\t\t\tshortcut.which = code - 32;\r\n\t\t} else {\r\n\t\t\tshortcut.which = code;\r\n\t\t}\r\n\t} else {\r\n\t\tswitch( key ) {\r\n\t\tcase \"Enter\":\r\n\t\t\tshortcut.which = 13;\r\n\t\t\tbreak;\r\n\t\tcase \"Space\":\r\n\t\t\tshortcut.key = \" \";\r\n\t\t\tshortcut.which = 32;\r\n\t\t\tbreak;\r\n\t\tcase \"Escape\":\r\n\t\t\tshortcut.which = 27;\r\n\t\t\tbreak;\r\n\t\tcase \"F1\":\r\n\t\t\tshortcut.which = 112;\r\n\t\t\tbreak;\r\n\t\tcase \"F2\":\r\n\t\t\tshortcut.which = 113;\r\n\t\t\tbreak;\r\n\t\tcase \"F3\":\r\n\t\t\tshortcut.which = 114;\r\n\t\t\tbreak;\r\n\t\tcase \"F4\":\r\n\t\t\tshortcut.which = 115;\r\n\t\t\tbreak;\r\n\t\tcase \"F5\":\r\n\t\t\tshortcut.which = 116;\r\n\t\t\tbreak;\r\n\t\tcase \"F6\":\r\n\t\t\tshortcut.which = 117;\r\n\t\t\tbreak;\r\n\t\tcase \"F7\":\r\n\t\t\tshortcut.which = 118;\r\n\t\t\tbreak;\r\n\t\tcase \"F8\":\r\n\t\t\tshortcut.which = 119;\r\n\t\t\tbreak;\r\n\t\tcase \"F9\":\r\n\t\t\tshortcut.which = 120;\r\n\t\t\tbreak;\r\n\t\tcase \"F10\":\r\n\t\t\tshortcut.which = 121;\r\n\t\t\tbreak;\r\n\t\tcase \"F11\":\r\n\t\t\tshortcut.which = 122;\r\n\t\t\tbreak;\r\n\t\tcase \"F12\":\r\n\t\t\tshortcut.which = 123;\r\n\t\t\tbreak;\r\n\t\tcase \"CapsLock\":\r\n\t\t\tif( shortcut.shift ) {\r\n\t\t\t\tshortcut.which = 20;\r\n\t\t\t} else {\r\n\t\t\t\tshortcut.which = 240;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"ArrowUp\":\r\n\t\t\tshortcut.which = 38;\r\n\t\t\tbreak;\r\n\t\tcase \"ArrowDown\":\r\n\t\t\tshortcut.which = 40;\r\n\t\t\tbreak;\r\n\t\tcase \"ArrowLeft\":\r\n\t\t\tshortcut.which = 37;\r\n\t\t\tbreak;\r\n\t\tcase \"ArrowRight\":\r\n\t\t\tshortcut.which = 39;\r\n\t\t\tbreak;\r\n\t\tcase \"Insert\":\r\n\t\t\tshortcut.which = 45;\r\n\t\t\tbreak;\r\n\t\tcase \"Delete\":\r\n\t\t\tshortcut.which = 46;\r\n\t\t\tbreak;\r\n\t\tcase \"PageUp\":\r\n\t\t\tshortcut.which = 33;\r\n\t\t\tbreak;\r\n\t\tcase \"PageDown\":\r\n\t\t\tshortcut.which = 34;\r\n\t\t\tbreak;\r\n\t\tcase \"Backspace\":\r\n\t\t\tshortcut.which = 8;\r\n\t\t\tbreak;\r\n\t\tcase \";\":\r\n\t\t\tshortcut.which = 187;\r\n\t\t\tbreak;\r\n\t\tcase \"Pause\":\r\n\t\t\tshortcut.which = 19;\r\n\t\t\tbreak;\r\n\t\tcase \"ScrollLock\":\r\n\t\t\tshortcut.which = 145;\r\n\t\t\tbreak;\r\n\t\tcase \"Tab\":\r\n\t\t\tshortcut.which = 9;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn shortcut;\r\n};\r\n\r\nexport class UtilKeyboardEvent {\r\n\tstatic isActivateKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.key === \"Space\" || e.key === \"Enter\" || e.which === 32 || e.which === 13 );\r\n\t}\r\n\r\n\tstatic isArrowUpKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.key === \"ArrowUp\" || e.which === 38 );\r\n\t}\r\n\r\n\tstatic isArrowDownKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.key === \"ArrowDown\" || e.which === 40 );\r\n\t}\r\n\r\n\tstatic isArrowLeftKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.key === \"ArrowLeft\" || e.which === 37 );\r\n\t}\r\n\r\n\tstatic isArrowRightKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.key === \"ArrowRight\" || e.which === 39 );\r\n\t}\r\n\r\n\tstatic isCancelKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.key === \"Esc\" || e.which === 27 );\r\n\t}\r\n\r\n\tstatic isFocusKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.key === \"Tab\" || e.which === 9 );\r\n\t}\r\n\r\n\tstatic isUndoKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.ctrlKey && ( e.key === \"z\" || e.which === 90 ) );\r\n\t}\r\n\r\n\tstatic isRedoKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.ctrlKey && ( e.key === \"y\" || e.which === 89 ) );\r\n\t}\r\n\r\n\tstatic isSaveKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.ctrlKey && ! e.shiftKey && ( e.key === \"s\" || e.which === 83 ) );\r\n\t}\r\n\r\n\tstatic isSaveAsKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.ctrlKey && e.shiftKey && ( e.key === \"S\" || e.which === 83 ) );\r\n\t}\r\n\r\n\tstatic isDeleteKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.key === \"Delete\" || e.which === 46 );\r\n\t}\r\n\r\n\tstatic isSelectAllKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.ctrlKey && ! e.shiftKey && ( e.key === \"a\" || e.which === 65 ) );\r\n\t}\r\n\r\n\tstatic isOkKey( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.key === \"Enter\" || e.which === 13 );\r\n\t}\r\n\r\n\tstatic getFocusDirection( e: KeyboardEvent ): boolean {\r\n\t\treturn ( e.shiftKey !== true );\r\n\t}\r\n\r\n\tstatic toShortcut( expressionOrShortcut: string | UtilKeyboardEventShortcut ): UtilKeyboardEventShortcut {\r\n\t\tif( ! isString( expressionOrShortcut ) ) {\r\n\t\t\treturn expressionOrShortcut;\r\n\t\t} else {\r\n\t\t\tconst expression = expressionOrShortcut;\r\n\t\t\tconst arrowIndex = expression.indexOf(\"->\");\r\n\t\t\tlet keyExpression: string;\r\n\t\t\tlet event: string | undefined;\r\n\t\t\tif( 0 <= arrowIndex ) {\r\n\t\t\t\tkeyExpression = expression.substring( 0, arrowIndex ).trim();\r\n\t\t\t\tevent = expression.substring( arrowIndex + 2 ).trim();\r\n\t\t\t} else {\r\n\t\t\t\tkeyExpression = expression.trim();\r\n\t\t\t}\r\n\t\t\tconst keys = keyExpression.toLowerCase().split( \"+\" );\r\n\t\t\tconst alt: boolean = 0 <= keys.indexOf( \"alt\" );\r\n\t\t\tconst ctrl: boolean = 0 <= keys.indexOf( \"ctrl\" );\r\n\t\t\tconst shift: boolean = 0 <= keys.indexOf( \"shift\" );\r\n\t\t\tconst key: string = keys[ keys.length - 1 ];\r\n\t\t\treturn setShortcutKeyAndWhich({\r\n\t\t\t\talt,\r\n\t\t\t\tctrl,\r\n\t\t\t\tshift,\r\n\t\t\t\tkey,\r\n\t\t\t\twhich: 0,\r\n\t\t\t\tevent\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toString( shortcut: UtilKeyboardEventShortcut ): string {\r\n\t\tconst parts = [];\r\n\t\tif( shortcut.ctrl ) {\r\n\t\t\tparts.push( \"Ctrl\" );\r\n\t\t}\r\n\t\tif( shortcut.shift ) {\r\n\t\t\tparts.push( \"Shift\" );\r\n\t\t}\r\n\t\tif( shortcut.alt ) {\r\n\t\t\tparts.push( \"Alt\" );\r\n\t\t}\r\n\t\tparts.push( shortcut.key.toUpperCase() );\r\n\t\treturn parts.join( \"+\" );\r\n\t}\r\n\r\n\tstatic on(\r\n\t\ttarget: DBase<any, any>,\r\n\t\texpressionOrShortcut: string | UtilKeyboardEventShortcut,\r\n\t\thandler?: ( e: KeyboardEvent ) => void\r\n\t): void {\r\n\t\tconst shortcut = this.toShortcut( expressionOrShortcut );\r\n\t\tdocument.body.addEventListener( \"keydown\", ( e: KeyboardEvent ): void => {\r\n\t\t\tif(\r\n\t\t\t\te.altKey === shortcut.alt && e.ctrlKey === shortcut.ctrl &&\r\n\t\t\t\te.shiftKey === shortcut.shift &&\r\n\t\t\t\t( e.key === shortcut.key || e.which === shortcut.which )\r\n\t\t\t) {\r\n\t\t\t\tif( target.isActionable() ) {\r\n\t\t\t\t\tif( shortcut.event != null ) {\r\n\t\t\t\t\t\ttarget.emit( shortcut.event );\r\n\t\t\t\t\t} else if( handler != null ) {\r\n\t\t\t\t\t\thandler( e );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeCorner {\r\n\tNONE = 0,\r\n\tTOP_LEFT = 1,\r\n\tTOP_RIGHT = 2,\r\n\tBOTTOM_LEFT = 4,\r\n\tBOTTOM_RIGHT = 8,\r\n\tTOP = TOP_LEFT | TOP_RIGHT,\r\n\tBOTTOM = BOTTOM_LEFT | BOTTOM_RIGHT,\r\n\tLEFT = TOP_LEFT | BOTTOM_LEFT,\r\n\tRIGHT = TOP_RIGHT | BOTTOM_RIGHT,\r\n\tALL = TOP | BOTTOM\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeStrokeSide {\r\n\tNONE = 0,\r\n\tTOP = 1,\r\n\tRIGHT = 2,\r\n\tBOTTOM = 4,\r\n\tLEFT = 8,\r\n\tTOP_OR_LEFT = TOP | LEFT,\r\n\tTOP_OR_RIGHT = TOP | RIGHT,\r\n\tBOTTOM_OR_LEFT = BOTTOM | LEFT,\r\n\tBOTTOM_OR_RIGHT = BOTTOM | RIGHT,\r\n\tALL = TOP | RIGHT | BOTTOM | LEFT\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix, ObservablePoint, Transform } from \"pixi.js\";\r\nimport { EShapeTransformParent } from \"./e-shape-transform-parent\";\r\n\r\nexport interface EShapeTransform extends Transform {\r\n\tinternalTransform: Matrix;\r\n\r\n\tposition: ObservablePoint;\r\n\tpivot: ObservablePoint;\r\n\trotation: number;\r\n\tskew: ObservablePoint;\r\n\tscale: ObservablePoint;\r\n\r\n\tgetLocalIdCurrent(): number;\r\n\tgetLocalId(): number;\r\n\tgetParentId(): number;\r\n\tgetWorldId(): number;\r\n}\r\n\r\nexport class EShapeTransformImpl extends Transform implements EShapeTransform {\r\n\tprotected _parent: EShapeTransformParent;\r\n\tinternalTransform: Matrix;\r\n\r\n\tconstructor( parent: EShapeTransformParent ) {\r\n\t\tsuper();\r\n\t\tthis.internalTransform = new Matrix();\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tprotected onChange(): void {\r\n\t\tsuper.onChange();\r\n\t\tthis._parent.onTransformChange();\r\n\t}\r\n\r\n\tprotected updateSkew(): void {\r\n\t\tsuper.updateSkew();\r\n\t\tthis._parent.onTransformChange();\r\n\t}\r\n\r\n\tgetLocalIdCurrent(): number {\r\n\t\treturn this._currentLocalID;\r\n\t}\r\n\r\n\tgetLocalId(): number {\r\n\t\treturn this._localID;\r\n\t}\r\n\r\n\tgetParentId(): number {\r\n\t\treturn this._parentID;\r\n\t}\r\n\r\n\tgetWorldId(): number {\r\n\t\treturn this._worldID;\r\n\t}\r\n\r\n\tupdateTransform( parentTransform: Transform ): void {\r\n\t\tconst oldLocalId = this._currentLocalID;\r\n\t\tconst oldWorldId = this._worldID;\r\n\t\tsuper.updateTransform( parentTransform );\r\n\t\tconst newLocalId = this._currentLocalID;\r\n\t\tconst newWorldId = this._worldID;\r\n\t\tif( oldLocalId !== newLocalId ) {\r\n\t\t\tconst localTransform = this.localTransform;\r\n\t\t\tconst internalTransform = this.internalTransform;\r\n\t\t\tlocalTransform.copyTo( internalTransform );\r\n\t\t\tif( parentTransform instanceof EShapeTransformImpl ) {\r\n\t\t\t\tinternalTransform.prepend( parentTransform.internalTransform );\r\n\t\t\t}\r\n\t\t} else if( oldWorldId !== newWorldId ) {\r\n\t\t\tconst localTransform = this.localTransform;\r\n\t\t\tconst internalTransform = this.internalTransform;\r\n\t\t\tif( parentTransform instanceof EShapeTransformImpl ) {\r\n\t\t\t\tlocalTransform.copyTo( internalTransform ).prepend( parentTransform.internalTransform );\r\n\t\t\t\tthis._currentLocalID += 1;\r\n\t\t\t\tthis._localID = this._currentLocalID;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const toPadded = ( str: string, length: number, c: string ): string => {\r\n\tconst strLength = str.length;\r\n\tif( length < strLength ) {\r\n\t\treturn str;\r\n\t}\r\n\tlet padding = \"\";\r\n\tfor( let i = 0, imax = length - strLength; i < imax; ++i ) {\r\n\t\tpadding += c;\r\n\t}\r\n\treturn padding + str;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { toPadded } from \"./to-padded\";\r\n\r\nexport class UtilRgb {\r\n\tstatic toCode( color: number ): string {\r\n\t\treturn toPadded( color.toString( 16 ).toUpperCase(), 6, \"0\" );\r\n\t}\r\n\r\n\tstatic fromCode( code: string ): number | null {\r\n\t\tconst trimmed = code.trim().toLowerCase();\r\n\t\tif( trimmed.length === 6 ) {\r\n\t\t\tconst color = Number( `0x${trimmed}` );\r\n\t\t\tif( color === color ) {\r\n\t\t\t\treturn color;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic fromRgb( r: number, g: number, b: number ): number {\r\n\t\treturn ((r * 0xff) << 16) + ((g * 0xff) << 8) + ((b * 0xff) | 0);\r\n\t}\r\n\r\n\tstatic blend( colorA: number, colorB: number, t: number ): number {\r\n\t\tconst ar = ((colorA >> 16) & 0xff);\r\n\t\tconst ag = ((colorA >> 8) & 0xff);\r\n\t\tconst ab = ((colorA | 0) & 0xff);\r\n\r\n\t\tconst br = ((colorB >> 16) & 0xff);\r\n\t\tconst bg = ((colorB >> 8) & 0xff);\r\n\t\tconst bb = ((colorB | 0) & 0xff);\r\n\r\n\t\tconst w1 = Math.max( 0, Math.min( 1, t ) );\r\n\t\tconst w0 = 1 - w1;\r\n\t\tconst cr = Math.max( 0, Math.min( 0xff, ar * w0 + br * w1 ) );\r\n\t\tconst cg = Math.max( 0, Math.min( 0xff, ag * w0 + bg * w1 ) );\r\n\t\tconst cb = Math.max( 0, Math.min( 0xff, ab * w0 + bb * w1 ) );\r\n\r\n\t\treturn (cr << 16) + (cg << 8) + (cb | 0);\r\n\t}\r\n\r\n\tstatic brighten( color: number, amount: number ): number {\r\n\t\treturn this.blend( color, 0xffffff, amount );\r\n\t}\r\n\r\n\tstatic darken( color: number, amount: number ): number {\r\n\t\treturn this.blend( color, 0x000000, amount );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { UtilRgb } from \"../../util/util-rgb\";\r\nimport { EShapeGradientLike, EShapeGradientPointLike } from \"../e-shape-gradient\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\n\r\nexport class EShapeGradients {\r\n\tstatic serializeGradient( gradient: EShapeGradientLike ): string {\r\n\t\tconst points = gradient.points;\r\n\t\tlet result = `[${gradient.direction}`;\r\n\t\tfor( let i = 0, imax = points.length, j = 1; i < imax; i += 1, j += 3 ) {\r\n\t\t\tconst point = points[ i ];\r\n\t\t\tresult += `,${point.color},${point.alpha},${point.position}`;\r\n\t\t}\r\n\t\tresult += \"]\";\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic parseGradient( target: string ): number[] | null {\r\n\t\ttry {\r\n\t\t\treturn JSON.parse( target ) as number[];\r\n\t\t} catch( e ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic deserializeGradient( target: string ): EShapeGradientLike | undefined {\r\n\t\tconst parsed = this.parseGradient( target );\r\n\t\tif( parsed == null || parsed.length < 7 ) {\r\n\t\t\treturn undefined;\r\n\t\t} else {\r\n\t\t\tconst direction = parsed[ 0 ];\r\n\t\t\tconst points: EShapeGradientPointLike[] = [];\r\n\t\t\tfor( let i = 1, imax = parsed.length; i < imax; i += 3 ) {\r\n\t\t\t\tpoints.push({\r\n\t\t\t\t\tcolor: parsed[ i + 0 ],\r\n\t\t\t\t\talpha: parsed[ i + 1 ],\r\n\t\t\t\t\tposition: parsed[ i + 2 ]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tpoints,\r\n\t\t\t\tdirection\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toGradientId( gradient: EShapeGradientLike | undefined, manager: EShapeResourceManagerSerialization ): number {\r\n\t\tif( gradient != null ) {\r\n\t\t\tif( gradient.serialized == null ) {\r\n\t\t\t\tgradient.serialized = this.serializeGradient( gradient );\r\n\t\t\t}\r\n\t\t\treturn manager.add( gradient.serialized );\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tstatic toGradientImageUrl( gradient: EShapeGradientLike ): string {\r\n\t\tconst direction = gradient.direction;\r\n\t\tconst points = gradient.points;\r\n\r\n\t\tlet stops = \"\";\r\n\t\tfor( let i = 0, imax = points.length; i < imax; ++i ) {\r\n\t\t\tconst point = points[ i ];\r\n\t\t\tconst color = UtilRgb.toCode( point.color );\r\n\t\t\tconst alpha = point.alpha;\r\n\t\t\tconst offset = point.position * 100;\r\n\t\t\tstops += `<stop offset=\"${offset}%\" stop-color=\"#${color}\" stop-opacity=\"${alpha}\" />`;\r\n\t\t}\r\n\r\n\t\tconst radian = direction * Math.PI / 180;\r\n\t\tconst dx = 0.5 * Math.cos( radian );\r\n\t\tconst dy = -0.5 * Math.sin( radian );\r\n\r\n\t\tconst url = \"data:image/svg+xml;base64,\" + btoa(\r\n\t\t\t`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">` +\r\n\t\t\t\t`<defs>` +\r\n\t\t\t\t\t`<linearGradient id=\"o2glkm3aeu2oio\" x1=\"${0.5 - dx}\" x2=\"${0.5 + dx}\" y1=\"${0.5 - dy}\" y2=\"${0.5 + dy}\">` +\r\n\t\t\t\t\t\tstops +\r\n\t\t\t\t\t`</linearGradient>` +\r\n\t\t\t\t`</defs>` +\r\n\t\t\t\t`<rect x=\"0\" y=\"0\" width=\"32\" height=\"32\" stroke=\"none\" fill=\"url(#o2glkm3aeu2oio)\" />` +\r\n\t\t\t`</svg>`\r\n\t\t);\r\n\r\n\t\treturn url;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, IPoint, Matrix, Point, Rectangle, Texture, Transform, utils } from \"pixi.js\";\r\nimport { DApplications } from \"../../d-applications\";\r\nimport { DBaseState } from \"../../d-base-state\";\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeAction } from \"../action/e-shape-action\";\r\nimport { EShape, EShapeCopyPart } from \"../e-shape\";\r\nimport { EShapeContainer } from \"../e-shape-container\";\r\nimport { EShapeCorner } from \"../e-shape-corner\";\r\nimport { EShapeEditor } from \"../e-shape-editor\";\r\nimport { EShapeFill } from \"../e-shape-fill\";\r\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\r\nimport { EShapeLayout } from \"../e-shape-layout\";\r\nimport { EShapePoints } from \"../e-shape-points\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeRuntime, EShapeRuntimeState } from \"../e-shape-runtime\";\r\nimport { EShapeStroke } from \"../e-shape-stroke\";\r\nimport { EShapeTag } from \"../e-shape-tag\";\r\nimport { EShapeText } from \"../e-shape-text\";\r\nimport { EShapeTransform, EShapeTransformImpl } from \"../e-shape-transform\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploaded } from \"../e-shape-uploaded\";\r\nimport { EShapeGradients } from \"./e-shape-gradients\";\r\n\r\nexport abstract class EShapeBase extends utils.EventEmitter implements EShape {\r\n\tprotected static WORK_RECT = new Rectangle();\r\n\tid: string;\r\n\treadonly type: EShapeType;\r\n\tabstract readonly size: IPoint;\r\n\tabstract readonly fill: EShapeFill;\r\n\tabstract readonly stroke: EShapeStroke;\r\n\treadonly transform: EShapeTransform;\r\n\tabstract radius: number;\r\n\tabstract corner: EShapeCorner;\r\n\tpoints?: EShapePoints;\r\n\timage?: HTMLImageElement;\r\n\timageSrc?: string;\r\n\ttexture?: Texture;\r\n\tabstract gradient?: EShapeGradientLike;\r\n\tabstract readonly text: EShapeText;\r\n\tabstract readonly tag: EShapeTag;\r\n\treadonly action: EShapeAction;\r\n\tabstract cursor: string;\r\n\tinteractive: boolean;\r\n\tshortcut?: string;\r\n\ttitle?: string;\r\n\tprotected _visible: boolean;\r\n\tprotected _onTransformChangeLock: number;\r\n\tprotected _isOnTransformChanged: boolean;\r\n\tprotected _uploadedUpdateLock: number;\r\n\tprotected _isUploadedUpdated: boolean;\r\n\tprotected _isUploadedUpdatedRecursively: boolean;\r\n\r\n\tprotected _bounds?: Rectangle;\r\n\tprotected _boundsTransformId: number;\r\n\tprotected _boundsInternal?: Rectangle;\r\n\tprotected _boundsInternalTransformId: number;\r\n\tprotected _boundsLocal?: Rectangle;\r\n\tprotected _boundsLocalTransformId: number;\r\n\r\n\tprotected _state: DBaseState;\r\n\tprotected _stateLocal: DBaseState;\r\n\r\n\t// Hierarchy\r\n\tparent: EShapeContainer | EShape | null;\r\n\tchildren: EShape[];\r\n\tlayout?: EShapeLayout;\r\n\r\n\t// Working space\r\n\tindex: number; // A work space for sorting.\r\n\tselected: boolean;\r\n\treference: number; // Count of references from commands\r\n\r\n\t// Working space for the viewer\r\n\truntime?: EShapeRuntime;\r\n\r\n\t// Working space for the editor\r\n\teditor?: EShapeEditor;\r\n\r\n\t// Working space for the renderer\r\n\tuploaded?: EShapeUploaded;\r\n\r\n\tconstructor( type: EShapeType ) {\r\n\t\tsuper();\r\n\t\tthis.id = \"\";\r\n\t\tthis.type = type;\r\n\t\tthis.transform = this.newTransform();\r\n\t\tthis._onTransformChangeLock = 0;\r\n\t\tthis._isOnTransformChanged = false;\r\n\t\tthis.action = new EShapeAction();\r\n\t\tthis._visible = true;\r\n\t\tthis._uploadedUpdateLock = 0;\r\n\t\tthis._isUploadedUpdated = false;\r\n\t\tthis._isUploadedUpdatedRecursively = false;\r\n\r\n\t\tthis._boundsTransformId = NaN;\r\n\t\tthis._boundsInternalTransformId = NaN;\r\n\t\tthis._boundsLocalTransformId = NaN;\r\n\r\n\t\tthis._state = this._stateLocal = DBaseState.UNFOCUSABLE;\r\n\t\tthis.interactive = false;\r\n\r\n\t\t//\r\n\t\tthis.parent = null;\r\n\t\tthis.children = [];\r\n\r\n\t\t//\r\n\t\tthis.selected = false;\r\n\t\tthis.index = 0;\r\n\t\tthis.reference = 0;\r\n\t}\r\n\r\n\tprotected newTransform(): EShapeTransform {\r\n\t\treturn new EShapeTransformImpl( this );\r\n\t}\r\n\r\n\tonSizeChange(): void {\r\n\t\tthis._boundsTransformId = NaN;\r\n\t\tthis._boundsInternalTransformId = NaN;\r\n\t\tthis._boundsLocalTransformId = NaN;\r\n\r\n\t\tthis.onTransformChange_();\r\n\t\tthis.updateUploaded();\r\n\t}\r\n\r\n\tonTransformChange(): void {\r\n\t\tthis.onTransformChange_();\r\n\t\tthis.updateUploadedRecursively();\r\n\t}\r\n\r\n\tprotected onTransformChange_(): void {\r\n\t\tif( this._onTransformChangeLock === 0 ) {\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.onChildTransformChange();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._isOnTransformChanged = true;\r\n\t\t}\r\n\t}\r\n\r\n\tdisallowOnTransformChange(): void {\r\n\t\tthis._onTransformChangeLock += 1;\r\n\t\tif( this._onTransformChangeLock === 1 ) {\r\n\t\t\tthis._isOnTransformChanged = false;\r\n\t\t}\r\n\t}\r\n\r\n\tallowOnTransformChange( invokeOnTransformChange: boolean ): void {\r\n\t\tthis._onTransformChangeLock -= 1;\r\n\t\tif( this._onTransformChangeLock === 0 ) {\r\n\t\t\tif( this._isOnTransformChanged ) {\r\n\t\t\t\tthis._isOnTransformChanged = false;\r\n\t\t\t\tif( invokeOnTransformChange ) {\r\n\t\t\t\t\tthis.onTransformChange();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonChildTransformChange(): void {\r\n\t\t//\r\n\t}\r\n\r\n\tdisallowUploadedUpdate(): void {\r\n\t\tthis._uploadedUpdateLock += 1;\r\n\t\tif( this._uploadedUpdateLock === 1 ) {\r\n\t\t\tthis._isUploadedUpdated = false;\r\n\t\t\tthis._isUploadedUpdatedRecursively = false;\r\n\t\t}\r\n\t}\r\n\r\n\tallowUploadedUpdate(): void {\r\n\t\tthis._uploadedUpdateLock -= 1;\r\n\t\tif( this._uploadedUpdateLock === 0 ) {\r\n\t\t\tif( this._isUploadedUpdatedRecursively ) {\r\n\t\t\t\tthis._isUploadedUpdatedRecursively = false;\r\n\t\t\t\tthis._isUploadedUpdated = false;\r\n\t\t\t\tthis.updateUploadedRecursively();\r\n\t\t\t} else if( this._isUploadedUpdated ) {\r\n\t\t\t\tthis._isUploadedUpdated = false;\r\n\t\t\t\tthis.updateUploaded();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateUploadedRecursively(): void {\r\n\t\tif( this._uploadedUpdateLock === 0 ) {\r\n\t\t\tthis.updateUploaded();\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tchildren[ i ].updateUploadedRecursively();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._isUploadedUpdatedRecursively = true;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateUploaded(): void {\r\n\t\tif( this._uploadedUpdateLock === 0 ) {\r\n\t\t\tconst uploaded = this.uploaded;\r\n\t\t\tif( uploaded != null ) {\r\n\t\t\t\tuploaded.update( this );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._isUploadedUpdated = true;\r\n\t\t}\r\n\t}\r\n\r\n\t//\r\n\tget root(): EShape {\r\n\t\tlet root: EShape = this;\r\n\t\twhile( root.parent instanceof EShapeBase ) {\r\n\t\t\troot = root.parent;\r\n\t\t}\r\n\t\treturn root;\r\n\t}\r\n\r\n\t//\r\n\tget visible(): boolean {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent instanceof EShapeBase ) {\r\n\t\t\treturn parent.visible && this._visible;\r\n\t\t} else {\r\n\t\t\treturn this._visible;\r\n\t\t}\r\n\t}\r\n\r\n\tset visible( visible: boolean ) {\r\n\t\tif( this._visible !== visible ) {\r\n\t\t\tthis._visible = visible;\r\n\t\t\tthis.updateUploadedRecursively();\r\n\t\t}\r\n\t}\r\n\r\n\t//\r\n\tabstract clone(): EShape;\r\n\r\n\t//\r\n\ttoDirty() {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent != null ) {\r\n\t\t\tparent.toDirty();\r\n\t\t}\r\n\t}\r\n\r\n\t// Hierarchy\r\n\tattach( parent: EShapeContainer | EShape, at?: number ): this {\r\n\t\tthis.detach();\r\n\t\tthis.parent = parent;\r\n\t\tconst children = parent.children;\r\n\t\tif( at != null && 0 <= at && at < children.length ) {\r\n\t\t\tchildren.splice( at, 0, this );\r\n\t\t} else {\r\n\t\t\tchildren.push( this );\r\n\t\t}\r\n\t\tthis.uploaded = undefined;\r\n\t\tparent.onChildTransformChange();\r\n\t\tparent.toDirty();\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdetach(): this {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent != null ) {\r\n\t\t\tthis.parent = null;\r\n\t\t\tthis.uploaded = undefined;\r\n\t\t\tconst children = parent.children;\r\n\t\t\tconst index = children.indexOf( this );\r\n\t\t\tif( 0 <= index ) {\r\n\t\t\t\tchildren.splice( index, 1 );\r\n\t\t\t\tparent.onChildTransformChange();\r\n\t\t\t\tparent.toDirty();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// Transform\r\n\tupdateTransform() {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent ) {\r\n\t\t\tif( parent.parent ) {\r\n\t\t\t\tparent.updateTransform();\r\n\t\t\t}\r\n\t\t\tthis.transform.updateTransform(parent.transform);\r\n\t\t} else {\r\n\t\t\tthis.transform.updateTransform((Transform as any).IDENTITY);\r\n\t\t}\r\n\t}\r\n\r\n\t// Serialization\r\n\tserializeChildren( manager: EShapeResourceManagerSerialization ): DDiagramSerializedItem[] {\r\n\t\tconst children = this.children;\r\n\t\tconst childrenSerialized = [];\r\n\t\tfor (let i = 0, imax = children.length; i < imax; ++i) {\r\n\t\t\tconst child = children[i];\r\n\t\t\tchildrenSerialized.push(child.serialize(manager));\r\n\t\t}\r\n\t\treturn childrenSerialized;\r\n\t}\r\n\r\n\tserializeImage( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst image = this.image;\r\n\t\treturn (image != null ? manager.add( image.src ) : -1);\r\n\t}\r\n\r\n\tserializeGradient( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn EShapeGradients.toGradientId( this.gradient, manager );\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): DDiagramSerializedItem {\r\n\t\tconst transform = this.transform;\r\n\t\tconst position = transform.position;\r\n\t\tconst pivot = transform.pivot;\r\n\t\tconst size = this.size;\r\n\t\tconst shortcut = this.shortcut;\r\n\t\tconst shortcutId = ( shortcut != null ? manager.add( shortcut ) : -1 );\r\n\t\tconst title = this.title;\r\n\t\tconst titleId = ( title != null ? manager.add( title ) : -1 );\r\n\t\treturn [\r\n\t\t\tthis.type,\r\n\t\t\tmanager.add(this.id),\r\n\t\t\tposition.x,\r\n\t\t\tposition.y,\r\n\t\t\tsize.x,\r\n\t\t\tsize.y,\r\n\t\t\ttransform.rotation,\r\n\t\t\ttransform.skew.x,\r\n\t\t\tthis.fill.serialize( manager ),\r\n\t\t\tthis.stroke.serialize( manager ),\r\n\t\t\tmanager.add( this.cursor.trim() ),\r\n\t\t\tthis.text.serialize( manager ),\r\n\t\t\tthis.tag.serialize( manager ),\r\n\t\t\tthis.radius,\r\n\t\t\tthis.corner,\r\n\t\t\t-1,\r\n\t\t\t-1,\r\n\t\t\tthis.action.serialize( manager ),\r\n\t\t\tthis.serializeImage( manager ),\r\n\t\t\tthis.serializeGradient( manager ),\r\n\t\t\tthis.serializeChildren( manager ),\r\n\t\t\tpivot.x,\r\n\t\t\tpivot.y,\r\n\t\t\t( this.interactive ? 1 : 0 ) | ( this.unfocusable ? 2 : 0 ),\r\n\t\t\tshortcutId,\r\n\t\t\ttitleId\r\n\t\t];\r\n\t}\r\n\r\n\t// Hit test\r\n\ttoLocalRect( point: IPoint, result: Rectangle ): Rectangle {\r\n\t\tconst x = point.x;\r\n\t\tconst y = point.y;\r\n\t\tconst size = this.size;\r\n\t\tconst sx = 0.5 * size.x;\r\n\t\tconst sy = 0.5 * size.y;\r\n\t\tconst pivot = this.transform.pivot;\r\n\t\tconst dx = x - pivot.x;\r\n\t\tconst dy = y - pivot.y;\r\n\t\tconst stroke = this.stroke;\r\n\t\tconst s = stroke.width * stroke.align;\r\n\t\tif( 0 <= sx ) {\r\n\t\t\tif( 0 <= sy ) {\r\n\t\t\t\tresult.x = +dx;\r\n\t\t\t\tresult.y = +dy;\r\n\t\t\t\tresult.width = +sx + s;\r\n\t\t\t\tresult.height = +sy + s;\r\n\t\t\t} else {\r\n\t\t\t\tresult.x = +dx;\r\n\t\t\t\tresult.y = -dy;\r\n\t\t\t\tresult.width = +sx + s;\r\n\t\t\t\tresult.height = -sy + s;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( 0 <= sy ) {\r\n\t\t\t\tresult.x = -dx;\r\n\t\t\t\tresult.y = +dy;\r\n\t\t\t\tresult.width = -sx + s;\r\n\t\t\t\tresult.height = +sy + s;\r\n\t\t\t} else {\r\n\t\t\t\tresult.x = -dx;\r\n\t\t\t\tresult.y = -dy;\r\n\t\t\t\tresult.width = -sx + s;\r\n\t\t\t\tresult.height = -sy + s;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcontains( point: Point ): EShape | null {\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\tif( this.containsAbs( rect.x, rect.y, rect.width, rect.height ) ) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\tconst x = point.x;\r\n\t\tconst y = point.y;\r\n\t\treturn this.containsText( x, y, point ) || this.containsChildren( x, y, point );\r\n\t}\r\n\r\n\tprotected containsText( x: number, y: number, work: Point ): EShape | null {\r\n\t\tconst text = this.text;\r\n\t\tconst textAtlas = text.atlas;\r\n\t\tif( textAtlas != null ) {\r\n\t\t\tconst textWorld = text.world;\r\n\t\t\tif( textWorld != null ) {\r\n\t\t\t\twork.set( x, y );\r\n\t\t\t\tthis.transform.internalTransform.apply( work, work );\r\n\t\t\t\tconst tx = work.x - textWorld[ 0 ];\r\n\t\t\t\tconst ty = work.y - textWorld[ 1 ];\r\n\t\t\t\tconst th = textWorld[ 2 ] * tx + textWorld[ 3 ] * ty;\r\n\t\t\t\tconst tv = textWorld[ 4 ] * tx + textWorld[ 5 ] * ty;\r\n\t\t\t\tif( 0 <= th && th <= textWorld[ 6 ] && 0 <= tv && tv <= textWorld[ 7 ] ) {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected containsChildren( x: number, y: number, work: Point ): EShape | null {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\twork.set( x, y );\r\n\t\t\tchild.updateTransform();\r\n\t\t\tchild.transform.localTransform.applyInverse( work, work );\r\n\t\t\tconst childResult = child.contains( work );\r\n\t\t\tif( childResult != null ) {\r\n\t\t\t\tif( this.shadowed ) {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn childResult;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcontainsBBox( point: IPoint ): boolean {\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\treturn this.containsAbsBBox( rect.x, rect.y, rect.width, rect.height );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\treturn this.containsAbsBBox( x, y, ax, ay );\r\n\t}\r\n\r\n\tcontainsAbsBBox( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\treturn (-ax <= x && x <= +ax && -ay <= y && y <= +ay);\r\n\t}\r\n\r\n\tselect( point: Point ): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t//\r\n\ttoGlobal( position: IPoint, result: Point, skipUpdate?: boolean ): Point {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tresult.copyFrom( position );\r\n\t\tthis.transform.worldTransform.apply( result, result );\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttoLocal( position: IPoint, from?: DisplayObject, result?: Point, skipUpdate?: boolean ): Point {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tif( result === undefined ) {\r\n\t\t\tresult = new Point();\r\n\t\t}\r\n\t\tresult.copyFrom( position );\r\n\t\tthis.transform.worldTransform.applyInverse( result, result );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetBounds( work: Point, skipUpdate: boolean, result: Rectangle ): Rectangle {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tconst bounds = this._bounds = ( this._bounds || new Rectangle() );\r\n\t\tconst worldId = this.transform.getWorldId();\r\n\t\tif( worldId !== this._boundsTransformId ) {\r\n\t\t\tthis._boundsTransformId = worldId;\r\n\t\t\tthis.getBounds_( this.transform.worldTransform, work, bounds );\r\n\t\t}\r\n\t\tresult.copyFrom( bounds );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetBoundsInternal( work: Point, skipUpdate: boolean, result: Rectangle ): Rectangle {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tconst boundsInternal = this._boundsInternal = ( this._boundsInternal || new Rectangle() );\r\n\t\tconst currentLocalId = this.transform.getLocalIdCurrent();\r\n\t\tif( currentLocalId !== this._boundsInternalTransformId ) {\r\n\t\t\tthis._boundsInternalTransformId = currentLocalId;\r\n\t\t\tthis.getBounds_( this.transform.internalTransform, work, boundsInternal );\r\n\t\t}\r\n\t\tresult.copyFrom( boundsInternal );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetBoundsLocal( work: Point, skipUpdate: boolean, result: Rectangle ): Rectangle {\r\n\t\tif( skipUpdate !== true ) {\r\n\t\t\tthis.updateTransform();\r\n\t\t}\r\n\t\tconst boundsLocal = this._boundsLocal = ( this._boundsLocal || new Rectangle() );\r\n\t\tconst currentLocalId = this.transform.getLocalIdCurrent();\r\n\t\tif( currentLocalId !== this._boundsLocalTransformId ) {\r\n\t\t\tthis._boundsLocalTransformId = currentLocalId;\r\n\t\t\tthis.getBounds_( this.transform.localTransform, work, boundsLocal );\r\n\t\t}\r\n\t\tresult.copyFrom( boundsLocal );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getBoundsSize(): IPoint {\r\n\t\treturn this.size;\r\n\t}\r\n\r\n\tprotected getBounds_( transform: Matrix, work: Point, result: Rectangle ): Rectangle {\r\n\t\tconst pivot = this.transform.pivot;\r\n\t\tconst px = pivot.x;\r\n\t\tconst py = pivot.y;\r\n\t\tconst size = this.getBoundsSize();\r\n\t\tconst sx = 0.5 * size.x;\r\n\t\tconst sy = 0.5 * size.y;\r\n\r\n\t\tconst a = transform.a;\r\n\t\tconst b = transform.b;\r\n\t\tconst c = transform.c;\r\n\t\tconst d = transform.d;\r\n\r\n\t\tlet x = -sx + px;\r\n\t\tlet y = -sy + py;\r\n\t\tconst x0 = a * x + c * y;\r\n\t\tconst y0 = b * x + d * y;\r\n\r\n\t\tx = +sx + px;\r\n\t\ty = -sy + py;\r\n\t\tconst x1 = a * x + c * y;\r\n\t\tconst y1 = b * x + d * y;\r\n\r\n\t\tx = -sx + px;\r\n\t\ty = +sy + py;\r\n\t\tconst x2 = a * x + c * y;\r\n\t\tconst y2 = b * x + d * y;\r\n\r\n\t\tx = +sx + px;\r\n\t\ty = +sy + py;\r\n\t\tconst x3 = a * x + c * y;\r\n\t\tconst y3 = b * x + d * y;\r\n\r\n\t\tconst xmin = Math.min( x0, x1, x2, x3 );\r\n\t\tconst ymin = Math.min( y0, y1, y2, y3 );\r\n\t\tconst xmax = Math.max( x0, x1, x2, x3 );\r\n\t\tconst ymax = Math.max( y0, y1, y2, y3 );\r\n\t\tresult.x = xmin + transform.tx;\r\n\t\tresult.y = ymin + transform.ty;\r\n\t\tresult.width = xmax - xmin;\r\n\t\tresult.height = ymax - ymin;\r\n\t\treturn result;\r\n\t}\r\n\r\n\t//\r\n\tdestroy(): void {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tchildren[ i ].destroy();\r\n\t\t}\r\n\t\tchildren.length = 0;\r\n\t}\r\n\r\n\t//\r\n\tprotected updateState(): void {\r\n\t\tconst parent = this.parent;\r\n\t\tconst stateLocal = this._stateLocal;\r\n\t\tconst newState = ( parent instanceof EShapeBase ?\r\n\t\t\tthis.mergeState( stateLocal, parent.getState() ) :\r\n\t\t\tstateLocal\r\n\t\t);\r\n\t\tconst oldState = this._state;\r\n\t\tif( oldState !== newState ) {\r\n\t\t\tthis._state = newState;\r\n\t\t\tthis.onStateChange( newState, oldState );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn stateLocal | (stateParent & DBaseState.DISABLED) |\r\n\t\t\t(stateParent & (DBaseState.FOCUSED | DBaseState.FOCUSED_IN) ? DBaseState.FOCUSED_IN : DBaseState.NONE);\r\n\t}\r\n\r\n\tprotected onStateChange( newState: number, oldState: number ) {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\truntime.onStateChange( this, newState, oldState );\r\n\t\t}\r\n\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof EShapeBase ) {\r\n\t\t\t\tchild.onParentStateChange( newState, oldState );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onParentStateChange( newStateParent: number, oldStateParent: number ) {\r\n\t\tconst newState = this.mergeState( this._stateLocal, newStateParent );\r\n\t\tconst oldState = this._state;\r\n\t\tif( oldState !== newState ) {\r\n\t\t\tthis._state = newState;\r\n\t\t\tthis.onStateChange( newState, oldState );\r\n\t\t}\r\n\t}\r\n\r\n\tgetState(): DBaseState {\r\n\t\treturn this._state;\r\n\t}\r\n\r\n\tsetState( state: DBaseState, isOn: boolean ): this {\r\n\t\tif( (!! ( this._stateLocal & state )) !== isOn ) {\r\n\t\t\tif( isOn ) {\r\n\t\t\t\tthis._stateLocal |= state;\r\n\t\t\t} else {\r\n\t\t\t\tthis._stateLocal &= ~state;\r\n\t\t\t}\r\n\t\t\tthis.updateState();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\thasState( state: DBaseState ): boolean {\r\n\t\treturn !! ( this._state & state );\r\n\t}\r\n\r\n\tfocus(): this {\r\n\t\tthis.focused = true;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tblur(): this {\r\n\t\tthis.focused = false;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tget hovered(): boolean {\r\n\t\treturn this.hasState( DBaseState.HOVERED );\r\n\t}\r\n\r\n\tset hovered( isHovered: boolean ) {\r\n\t\tthis.setState( DBaseState.HOVERED, isHovered );\r\n\t}\r\n\r\n\tget active(): boolean {\r\n\t\treturn this.hasState( DBaseState.ACTIVE );\r\n\t}\r\n\r\n\tset active( isActive: boolean ) {\r\n\t\tthis.setState( DBaseState.ACTIVE, isActive );\r\n\t}\r\n\r\n\tget readonly(): boolean {\r\n\t\treturn this.hasState( DBaseState.READ_ONLY );\r\n\t}\r\n\r\n\tset readonly( isReadOnly: boolean ) {\r\n\t\tthis.setState( DBaseState.READ_ONLY, isReadOnly );\r\n\t}\r\n\r\n\tget enabled(): boolean {\r\n\t\treturn ! this.hasState( DBaseState.DISABLED );\r\n\t}\r\n\r\n\tget disabled(): boolean {\r\n\t\treturn this.hasState( DBaseState.DISABLED );\r\n\t}\r\n\r\n\tset disabled( isDisabled: boolean ) {\r\n\t\tthis.setState( DBaseState.DISABLED, isDisabled );\r\n\t}\r\n\r\n\tget dragging(): boolean {\r\n\t\treturn this.hasState( DBaseState.DRAGGING );\r\n\t}\r\n\r\n\tset dragging( isDragging: boolean ) {\r\n\t\tthis.setState( DBaseState.DRAGGING, isDragging );\r\n\t}\r\n\r\n\tget focused(): boolean {\r\n\t\treturn this.hasState( DBaseState.FOCUSED );\r\n\t}\r\n\r\n\tset focused( focused: boolean ) {\r\n\t\tif( this.focused !== focused ) {\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.getFocusController().setFocused( this, focused, false );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget focusedin(): boolean {\r\n\t\treturn this.hasState( DBaseState.FOCUSED | DBaseState.FOCUSED_IN );\r\n\t}\r\n\r\n\tget unfocusable(): boolean {\r\n\t\treturn this.hasState( DBaseState.UNFOCUSABLE );\r\n\t}\r\n\r\n\tset unfocusable( unforcusable: boolean ) {\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, unforcusable );\r\n\t}\r\n\r\n\tget clicked(): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\treturn !! ( runtime && (runtime.state & EShapeRuntimeState.CLICKED) );\r\n\t}\r\n\r\n\tget pressed(): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\treturn !! ( runtime && (runtime.state & EShapeRuntimeState.PRESSED) );\r\n\t}\r\n\r\n\tget down(): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\treturn !! ( runtime && (runtime.state & EShapeRuntimeState.DOWN) );\r\n\t}\r\n\r\n\tget up(): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\treturn !! ( runtime && (runtime.state & EShapeRuntimeState.UP) );\r\n\t}\r\n\r\n\tget shadowed(): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonDblClick( e: MouseEvent ): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\treturn runtime.onPointerDblClick( this );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonShortcut( e: KeyboardEvent ): void {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\treturn runtime.onPointerClick( this );\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\treturn runtime.onKeyDown( this, e );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonKeyUp( e: KeyboardEvent ): boolean {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\treturn runtime.onKeyUp( this, e );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t//\r\n\tupdate( time: number ): void {\r\n\t\tconst runtime = this.runtime;\r\n\t\tif( runtime != null ) {\r\n\t\t\truntime.update( this, time );\r\n\t\t}\r\n\t}\r\n\r\n\tupdateRecursively( time: number ): void {\r\n\t\tthis.update( time );\r\n\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].update( time );\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( source: EShape, part: EShapeCopyPart = EShapeCopyPart.ALL ): this {\r\n\t\tthis.id = source.id;\r\n\t\tif( (part & EShapeCopyPart.TRANSFORM) !== 0 ) {\r\n\t\t\tconst transform = this.transform;\r\n\t\t\tconst sourceTransform = source.transform;\r\n\t\t\ttransform.position.copyFrom( sourceTransform.position );\r\n\t\t\ttransform.rotation = sourceTransform.rotation;\r\n\t\t\ttransform.skew.copyFrom( sourceTransform.skew );\r\n\t\t\ttransform.pivot.copyFrom( sourceTransform.pivot );\r\n\t\t\ttransform.scale.copyFrom( sourceTransform.scale );\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.SIZE) !== 0 ) {\r\n\t\t\tthis.size.copyFrom( source.size );\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.STYLE) !== 0 ) {\r\n\t\t\tthis.fill.copy( source.fill );\r\n\t\t\tthis.stroke.copy( source.stroke );\r\n\t\t\tthis.tag.copy( source.tag );\r\n\t\t\tthis.text.copy( source.text );\r\n\t\t\tthis.radius = source.radius;\r\n\t\t\tthis.corner = source.corner;\r\n\t\t\tif (this.image == null) {\r\n\t\t\t\tthis.image = source.image;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.ACTION) !== 0 ) {\r\n\t\t\tthis.action.addAll( source.action.values );\r\n\t\t\tthis.interactive = source.interactive;\r\n\t\t\tthis.cursor = source.cursor;\r\n\t\t\tthis.shortcut = source.shortcut;\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.POINTS) !== 0 ) {\r\n\t\t\tconst sourcePoints = source.points;\r\n\t\t\tif( sourcePoints != null ) {\r\n\t\t\t\tconst points = this.points;\r\n\t\t\t\tif( points != null ) {\r\n\t\t\t\t\tpoints.copy( sourcePoints );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.points = sourcePoints.clone( this );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( (part & EShapeCopyPart.STATE) !== 0 ) {\r\n\t\t\tthis.setState( source.getState(), true );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeStrokeSide } from \"./e-shape-stroke-side\";\r\n\r\nexport class EShapeDefaults {\r\n\tstatic IS_EDIT_MODE: boolean = false;\r\n\r\n\tstatic FILL_COLOR: number = 0xffffff;\r\n\tstatic FILL_ALPHA: number = 0.5;\r\n\tstatic STROKE_COLOR: number = 0x4f4f4f;\r\n\tstatic STROKE_COLOR_DARK: number = 0x4f4f4f;\r\n\tstatic STROKE_COLOR_LIGHT: number = 0xd0d0d0;\r\n\tstatic STROKE_ALPHA: number = 1;\r\n\tstatic STROKE_WIDTH: number = 2;\r\n\tstatic STROKE_ALIGN: number = 0;\r\n\tstatic STROKE_SIDE: number = EShapeStrokeSide.ALL;\r\n\tstatic TEXT_VALUE: string = \"\";\r\n\tstatic TEXT_FAMILY: string = \"auto\";\r\n\tstatic TEXT_SIZE: number = 14;\r\n\tstatic CURSOR: string = \"\";\r\n\tstatic RADIUS: number = 0.25;\r\n\tstatic SIZE_X: number = 100;\r\n\tstatic SIZE_Y: number = 100;\r\n\tstatic HIGHLIGHT_COLOR: number = 0x1e87f0;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\r\nimport { EShapeTagValueRange, EShapeTagValueRangeLike } from \"./e-shape-tag-value-range\";\r\n\r\nexport enum EShapeTagValueOrder {\r\n\tASCENDING,\r\n\tDESCENDING\r\n}\r\n\r\nexport interface EShapeTagValueLike {\r\n\tid: string;\r\n\tinitial: string;\r\n\tformat: string;\r\n\trange: EShapeTagValueRangeLike;\r\n\tcapacity: number;\r\n\torder: EShapeTagValueOrder;\r\n}\r\n\r\nexport interface EShapeTagValueParent {\r\n\tisChanged: boolean;\r\n}\r\n\r\nexport interface EShapeTagValue extends EShapeTagValueLike {\r\n\tvalue: unknown;\r\n\treadonly nvalue: number;\r\n\ttime: number;\r\n\r\n\tvalues: unknown[];\r\n\ttimes: number[];\r\n\r\n\trange: EShapeTagValueRange;\r\n\tparent?: EShapeTagValueParent;\r\n\r\n\tformatter?: ( value: unknown ) => unknown;\r\n\r\n\tclear(): void;\r\n\tremove( index: number ): void;\r\n\tremoveAll( indices: number[] ): void;\r\n\tcopy( target: EShapeTagValue ): void;\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number;\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"./e-shape-resource-manager-serialization\";\r\n\r\nexport enum EShapeTagValueRangeType {\r\n\tNONE = 0,\r\n\tFROM = 1,\r\n\tTO = 2,\r\n\tFROM_TO = 3\r\n}\r\n\r\nexport interface EShapeTagValueRangeLike {\r\n\ttype: EShapeTagValueRangeType;\r\n\tfrom: number;\r\n\tto: number;\r\n}\r\n\r\nexport interface EShapeTagValueRangeParent {\r\n\tisChanged: boolean;\r\n}\r\n\r\nexport interface EShapeTagValueRange extends EShapeTagValueRangeLike {\r\n\tparent?: EShapeTagValueRangeParent;\r\n\r\n\tset( from?: number | null, to?: number | null ): boolean;\r\n\tnormalize( value: number ): number;\r\n\tisEquals( target: EShapeTagValueRangeLike ): boolean;\r\n\tcopy( target: EShapeTagValueRangeLike ): void;\r\n\ttoObject(): EShapeTagValueRangeLike;\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number;\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeFill, EShapeFillLike } from \"../e-shape-fill\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeFillImplParent } from \"./e-shape-fill-impl-parent\";\r\n\r\nexport class EShapeFillImpl implements EShapeFill {\r\n\tprotected _parent: EShapeFillImplParent;\r\n\tprotected _enable: boolean;\r\n\tprotected _color: number;\r\n\tprotected _alpha: number;\r\n\r\n\tconstructor( parent: EShapeFillImplParent, enable: boolean, color: number, alpha: number ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._enable = enable;\r\n\t\tthis._color = color;\r\n\t\tthis._alpha = alpha;\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\treturn this._enable;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\tif( this._enable !== enable ) {\r\n\t\t\tthis._enable = enable;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tif( this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tif( this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeFillLike> ): void {\r\n\t\tif( target ) {\r\n\t\t\tthis.set( target.enable, target.color, target.alpha );\r\n\t\t}\r\n\t}\r\n\r\n\tset( enable?: boolean, color?: number, alpha?: number ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( enable !== undefined && this._enable !== enable ) {\r\n\t\t\tthis._enable = enable;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( color !== undefined && this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( alpha !== undefined && this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tclone(): EShapeFill {\r\n\t\treturn new EShapeFillImpl( this._parent, this._enable, this._color, this._alpha );\r\n\t}\r\n\r\n\ttoObject(): EShapeFillLike {\r\n\t\treturn {\r\n\t\t\tenable: this._enable,\r\n\t\t\tcolor: this._color,\r\n\t\t\talpha: this._alpha\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst stringified = `[${this._enable ? 1 : 0},${this._color},${this._alpha}]`;\r\n\t\treturn manager.add( stringified );\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\tconst resources = manager.resources;\r\n\t\tif( 0 <= target && target < resources.length ) {\r\n\t\t\tconst parsed = manager.fills.get( target );\r\n\t\t\tif( parsed != null ) {\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tparsed[ 0 ] !== 0,\r\n\t\t\t\t\tparsed[ 1 ],\r\n\t\t\t\t\tparsed[ 2 ]\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tconst deserialized = JSON.parse( resources[ target ] );\r\n\t\t\t\tmanager.fills.set( target, deserialized );\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tdeserialized[ 0 ] !== 0,\r\n\t\t\t\t\tdeserialized[ 1 ],\r\n\t\t\t\t\tdeserialized[ 2 ]\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeStroke, EShapeStrokeLike } from \"../e-shape-stroke\";\r\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\r\nimport { EShapeStrokeImplParent } from \"./e-shape-stroke-impl-parent\";\r\n\r\nexport class EShapeStrokeImpl implements EShapeStroke {\r\n\tprotected _parent: EShapeStrokeImplParent;\r\n\tprotected _enable: boolean;\r\n\tprotected _color: number;\r\n\tprotected _alpha: number;\r\n\tprotected _width: number;\r\n\tprotected _align: number;\r\n\tprotected _side: EShapeStrokeSide;\r\n\r\n\tconstructor(\r\n\t\tparent: EShapeStrokeImplParent,\r\n\t\tenable: boolean, color: number, alpha: number,\r\n\t\twidth: number, align: number, side: EShapeStrokeSide\r\n\t) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._enable = enable;\r\n\t\tthis._color = color;\r\n\t\tthis._alpha = alpha;\r\n\t\tthis._width = width;\r\n\t\tthis._align = align;\r\n\t\tthis._side = side;\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\treturn this._enable;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\tif( this._enable !== enable ) {\r\n\t\t\tthis._enable = enable;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tif( this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tif( this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tif( this._width !== width ) {\r\n\t\t\tthis._width = width;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget align(): number {\r\n\t\treturn this._align;\r\n\t}\r\n\r\n\tset align( align: number ) {\r\n\t\tif( this._align !== align ) {\r\n\t\t\tthis._align = align;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget side(): EShapeStrokeSide {\r\n\t\treturn this._side;\r\n\t}\r\n\r\n\tset side( side: EShapeStrokeSide ) {\r\n\t\tif( this._side !== side ) {\r\n\t\t\tthis._side = side;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeStrokeLike> ): void {\r\n\t\tif( target ) {\r\n\t\t\tthis.set( target.enable, target.color, target.alpha, target.width, target.align, target.side );\r\n\t\t}\r\n\t}\r\n\r\n\tset( enable?: boolean, color?: number, alpha?: number, width?: number, align?: number, side?: EShapeStrokeSide ) {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( enable !== undefined && this._enable !== enable ) {\r\n\t\t\tthis._enable = enable;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( color !== undefined && this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( alpha !== undefined && this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( width !== undefined && this._width !== width ) {\r\n\t\t\tthis._width = width;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( align !== undefined && this._align !== align ) {\r\n\t\t\tthis._align = align;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( side !== undefined && this._side !== side ) {\r\n\t\t\tthis._side = side;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tclone(): EShapeStroke {\r\n\t\treturn new EShapeStrokeImpl(\r\n\t\t\tthis._parent,\r\n\t\t\tthis._enable, this._color, this._alpha,\r\n\t\t\tthis._width, this._align, this._side\r\n\t\t);\r\n\t}\r\n\r\n\ttoObject(): EShapeStrokeLike {\r\n\t\treturn {\r\n\t\t\tenable: this._enable,\r\n\t\t\tcolor: this._color,\r\n\t\t\talpha: this._alpha,\r\n\t\t\twidth: this._width,\r\n\t\t\talign: this._align,\r\n\t\t\tside: this._side\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst enable = this._enable ? 1 : 0;\r\n\t\tconst serialized = `[${enable},${this._color},${this._alpha},${this._width},${this._align},${this._side}]`;\r\n\t\treturn manager.add( serialized );\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ) {\r\n\t\tconst resources = manager.resources;\r\n\t\tif( 0 <= target && target < resources.length ) {\r\n\t\t\tconst parsed = manager.strokes.get( target );\r\n\t\t\tif( parsed != null ) {\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tparsed[ 0 ] !== 0,\r\n\t\t\t\t\tparsed[ 1 ],\r\n\t\t\t\t\tparsed[ 2 ],\r\n\t\t\t\t\tparsed[ 3 ],\r\n\t\t\t\t\tparsed[ 4 ],\r\n\t\t\t\t\tparsed[ 5 ]\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tconst deserialized = JSON.parse( resources[ target ] );\r\n\t\t\t\tmanager.strokes.set( target, deserialized );\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tdeserialized[ 0 ] !== 0,\r\n\t\t\t\t\tdeserialized[ 1 ],\r\n\t\t\t\t\tdeserialized[ 2 ],\r\n\t\t\t\t\tdeserialized[ 3 ],\r\n\t\t\t\t\tdeserialized[ 4 ],\r\n\t\t\t\t\tdeserialized[ 5 ]\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport {\r\n\tEShapeTagValueRange, EShapeTagValueRangeLike, EShapeTagValueRangeParent, EShapeTagValueRangeType\r\n} from \"../e-shape-tag-value-range\";\r\n\r\nexport class EShapeTagValueRangeImpl implements EShapeTagValueRange {\r\n\tprotected _type: EShapeTagValueRangeType;\r\n\tprotected _from: number;\r\n\tprotected _to: number;\r\n\tparent?: EShapeTagValueRangeParent;\r\n\r\n\tconstructor() {\r\n\t\tthis._type = EShapeTagValueRangeType.NONE;\r\n\t\tthis._from = 0;\r\n\t\tthis._to = 1;\r\n\t}\r\n\r\n\tget type(): EShapeTagValueRangeType {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\tset type( type: EShapeTagValueRangeType ) {\r\n\t\tif( this._type !== type ) {\r\n\t\t\tthis._type = type;\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget from(): number {\r\n\t\treturn this._from;\r\n\t}\r\n\r\n\tset from( from: number ) {\r\n\t\tif( this._from !== from ) {\r\n\t\t\tthis._from = from;\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget to(): number {\r\n\t\treturn this._to;\r\n\t}\r\n\r\n\tset to( to: number ) {\r\n\t\tif( this._to !== to ) {\r\n\t\t\tthis._to = to;\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tset( from?: number | null, to?: number | null ): boolean {\r\n\t\tlet result = false;\r\n\t\tif( from !== undefined && to !== undefined ) {\r\n\t\t\tif( from !== null && to !== null ) {\r\n\t\t\t\tconst type = (this._type | EShapeTagValueRangeType.FROM) | EShapeTagValueRangeType.TO;\r\n\t\t\t\tif( this._type !== type || this._from !== from || this._to !== to ) {\r\n\t\t\t\t\tthis._type = type;\r\n\t\t\t\t\tthis._from = from;\r\n\t\t\t\t\tthis._to = to;\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t} else if( from !== null ) {\r\n\t\t\t\tconst type = (this._type | EShapeTagValueRangeType.FROM) & (~EShapeTagValueRangeType.TO);\r\n\t\t\t\tif( this._type !== type || this._from !== from ) {\r\n\t\t\t\t\tthis._type = type;\r\n\t\t\t\t\tthis._from = from;\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t} else if( to !== null ) {\r\n\t\t\t\tconst type = (this._type | EShapeTagValueRangeType.TO) & (~EShapeTagValueRangeType.FROM);\r\n\t\t\t\tif( this._type !== type || this._from !== from ) {\r\n\t\t\t\t\tthis._type = type;\r\n\t\t\t\t\tthis._to = to;\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst type = this._type & (~(EShapeTagValueRangeType.TO | EShapeTagValueRangeType.FROM));\r\n\t\t\t\tif( this._type !== type ) {\r\n\t\t\t\t\tthis._type = type;\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if( from !== undefined ) {\r\n\t\t\tif( from !== null ) {\r\n\t\t\t\tconst type = this._type | EShapeTagValueRangeType.FROM;\r\n\t\t\t\tif( this._type !== type || this._from !== from ) {\r\n\t\t\t\t\tthis._type = type;\r\n\t\t\t\t\tthis._from = from;\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst type = this._type & (~EShapeTagValueRangeType.FROM);\r\n\t\t\t\tif( this._type !== type ) {\r\n\t\t\t\t\tthis._type = type;\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if( to !== undefined ) {\r\n\t\t\tif( to !== null ) {\r\n\t\t\t\tconst type = this._type | EShapeTagValueRangeType.TO;\r\n\t\t\t\tif( this._type !== type || this._to !== to ) {\r\n\t\t\t\t\tthis._type = type;\r\n\t\t\t\t\tthis._to = to;\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst type = this._type & (~EShapeTagValueRangeType.TO);\r\n\t\t\t\tif( this._type !== type ) {\r\n\t\t\t\t\tthis._type = type;\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( result ) {\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tnormalize( value: number ): number {\r\n\t\tconst type = this._type;\r\n\t\tconst from = this._from;\r\n\t\tconst to = this._to;\r\n\t\tswitch( type ) {\r\n\t\tcase EShapeTagValueRangeType.FROM_TO:\r\n\t\t\treturn (value - from) / (to - from);\r\n\t\tcase EShapeTagValueRangeType.FROM:\r\n\t\t\treturn value - from;\r\n\t\tcase EShapeTagValueRangeType.TO:\r\n\t\t\treturn to - value;\r\n\t\tcase EShapeTagValueRangeType.NONE:\r\n\t\tdefault:\r\n\t\t\treturn value;\r\n\t\t}\r\n\t}\r\n\r\n\tisEquals( target: EShapeTagValueRangeLike ): boolean {\r\n\t\treturn (\r\n\t\t\tthis._type === target.type &&\r\n\t\t\tthis._from === target.from &&\r\n\t\t\tthis._to === target.to\r\n\t\t);\r\n\t}\r\n\r\n\tcopy( target: EShapeTagValueRangeLike ): this {\r\n\t\treturn this.copy_( target.type, target.from, target.to );\r\n\t}\r\n\r\n\tprotected copy_( type: EShapeTagValueRangeType, from: number, to: number ): this {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( this._type !== type ) {\r\n\t\t\tthis._type = type;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( this._from !== from ) {\r\n\t\t\tthis._from = from;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( this._to !== to ) {\r\n\t\t\tthis._to = to;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\ttoObject(): EShapeTagValueRangeLike {\r\n\t\treturn {\r\n\t\t\ttype: this.type,\r\n\t\t\tfrom: this.from,\r\n\t\t\tto: this.to\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst serialized = `[${this._type},${this._from},${this._to}]`;\r\n\t\treturn manager.add( serialized );\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\tconst resources = manager.resources;\r\n\t\tif( 0 <= target && target < resources.length ) {\r\n\t\t\tconst parsed = manager.ranges.get( target );\r\n\t\t\tif( parsed != null ) {\r\n\t\t\t\tthis.copy_(\r\n\t\t\t\t\tparsed[ 0 ],\r\n\t\t\t\t\tparsed[ 1 ],\r\n\t\t\t\t\tparsed[ 2 ]\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tconst deserialized = JSON.parse( resources[ target ] );\r\n\t\t\t\tmanager.ranges.set( target, deserialized );\r\n\t\t\t\tthis.copy_(\r\n\t\t\t\t\tdeserialized[ 0 ],\r\n\t\t\t\t\tdeserialized[ 1 ],\r\n\t\t\t\t\tdeserialized[ 2 ]\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * A border mask.\r\n * Borders on masked parts are not rendered.\r\n */\r\nexport enum DBorderMask {\r\n\tNONE = 0,\r\n\r\n\tTOP = 1,\r\n\tRIGHT = 2,\r\n\tBOTTOM = 4,\r\n\tLEFT = 8,\r\n\r\n\tTOP_RIGHT = TOP | RIGHT,\r\n\tTOP_BOTTOM = TOP | BOTTOM,\r\n\tTOP_LEFT = TOP | LEFT,\r\n\r\n\tRIGHT_BOTTOM = RIGHT | BOTTOM,\r\n\tRIGHT_LEFT = RIGHT | LEFT,\r\n\r\n\tBOTTOM_LEFT = BOTTOM | LEFT,\r\n\r\n\tNOT_TOP = RIGHT | BOTTOM | LEFT,\r\n\tNOT_RIGHT = TOP | BOTTOM | LEFT,\r\n\tNOT_BOTTOM = TOP | RIGHT | LEFT,\r\n\tNOT_LEFT = TOP | RIGHT | BOTTOM,\r\n\r\n\tALL = TOP | RIGHT | BOTTOM | LEFT\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedTagValue } from \"../../d-diagram-serialized\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTagValue, EShapeTagValueOrder, EShapeTagValueParent } from \"../e-shape-tag-value\";\r\nimport { EShapeTagValueRange } from \"../e-shape-tag-value-range\";\r\nimport { EShapeTagValueRangeImpl } from \"./e-shape-tag-value-range-impl\";\r\n\r\nconst INDEX_COMPARATOR = ( a: number, b: number ): number => {\r\n\treturn a - b;\r\n};\r\n\r\nexport class EShapeTagValueImpl implements EShapeTagValue {\r\n\tid: string;\r\n\tinitial: string;\r\n\tformat: string;\r\n\trange: EShapeTagValueRange;\r\n\tprotected _value: unknown;\r\n\tprotected _time: number;\r\n\r\n\tprotected _values: unknown[] | undefined;\r\n\tprotected _times: number[] | undefined;\r\n\tprotected _capacity: number;\r\n\tprotected _order: EShapeTagValueOrder;\r\n\r\n\tprotected _parent?: EShapeTagValueParent;\r\n\r\n\tformatter?: ( value: unknown ) => unknown;\r\n\r\n\tconstructor() {\r\n\t\tthis.id = \"\";\r\n\t\tthis.initial = \"\";\r\n\t\tthis.format = \"\";\r\n\t\tthis.range = new EShapeTagValueRangeImpl();\r\n\t\tthis._value = 0;\r\n\t\tthis._time = 0;\r\n\t\tthis._capacity = 0;\r\n\t\tthis._order = EShapeTagValueOrder.ASCENDING;\r\n\t}\r\n\r\n\tget parent(): EShapeTagValueParent | undefined {\r\n\t\treturn this._parent;\r\n\t}\r\n\r\n\tset parent( parent: EShapeTagValueParent | undefined ) {\r\n\t\tif( this._parent !== parent ) {\r\n\t\t\tthis._parent = parent;\r\n\t\t\tthis.range.parent = parent;\r\n\t\t}\r\n\t}\r\n\r\n\tget value(): unknown {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\tset value( newValue: unknown ) {\r\n\t\tconst formatter = this.formatter;\r\n\t\tif( formatter != null ) {\r\n\t\t\tnewValue = formatter( newValue );\r\n\t\t}\r\n\r\n\t\tconst capacity = this._capacity;\r\n\t\tif( capacity <= 0 ) {\r\n\t\t\tif( this._value !== newValue ) {\r\n\t\t\t\tthis._value = newValue;\r\n\t\t\t\tconst parent = this.parent;\r\n\t\t\t\tif( parent != null ) {\r\n\t\t\t\t\tparent.isChanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet values = this._values;\r\n\t\t\tif( values == null ) {\r\n\t\t\t\tvalues = [];\r\n\t\t\t\tthis._values = values;\r\n\t\t\t}\r\n\r\n\t\t\t// Update the value\r\n\t\t\tthis._value = newValue;\r\n\r\n\t\t\t// Update the values\r\n\t\t\tconst order = this._order;\r\n\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\tvalues.push( newValue );\r\n\t\t\t} else {\r\n\t\t\t\tvalues.unshift( newValue );\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the unnecessary values\r\n\t\t\tconst count = values.length - capacity;\r\n\t\t\tif( 0 < count ) {\r\n\t\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\t\tfor( let i = 0; i < count; ++i ) {\r\n\t\t\t\t\t\tvalues.shift();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalues.length = capacity;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Tell the parent it's changed\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget nvalue(): number {\r\n\t\treturn this.range.normalize( this._value as number );\r\n\t}\r\n\r\n\tget values(): unknown[] {\r\n\t\tlet result = this._values;\r\n\t\tif( result == null ) {\r\n\t\t\tresult = [];\r\n\t\t\tthis._values = result;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tset values( newValues: unknown[] ) {\r\n\t\tif( 0 < newValues.length ) {\r\n\t\t\tconst capacity = this._capacity;\r\n\t\t\tif( capacity <= 0 ) {\r\n\t\t\t\tlet newValue = newValues[ newValues.length - 1 ];\r\n\t\t\t\tconst formatter = this.formatter;\r\n\t\t\t\tif( formatter != null ) {\r\n\t\t\t\t\tnewValue = formatter( newValue );\r\n\t\t\t\t}\r\n\t\t\t\tif( this._value !== newValue ) {\r\n\t\t\t\t\tthis._value = newValue;\r\n\t\t\t\t\tconst parent = this.parent;\r\n\t\t\t\t\tif( parent != null ) {\r\n\t\t\t\t\t\tparent.isChanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet values = this._values;\r\n\t\t\t\tif( values == null ) {\r\n\t\t\t\t\tvalues = [];\r\n\t\t\t\t\tthis._values = values;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst order = this._order;\r\n\t\t\t\tconst formatter = this.formatter;\r\n\t\t\t\tif( formatter != null ) {\r\n\t\t\t\t\t// Update the value\r\n\t\t\t\t\tthis._value = formatter( newValues[ newValues.length - 1 ] );\r\n\r\n\t\t\t\t\t// Update the values\r\n\t\t\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\t\t\tfor( let i = 0, imax = newValues.length; i < imax; ++i ) {\r\n\t\t\t\t\t\t\tvalues.push( formatter( newValues[ i ] ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor( let i = 0, imax = newValues.length; i < imax; ++i ) {\r\n\t\t\t\t\t\t\tvalues.unshift( formatter( newValues[ i ] ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Update the value\r\n\t\t\t\t\tthis._value = newValues[ newValues.length - 1 ];\r\n\r\n\t\t\t\t\t// Update the values\r\n\t\t\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\t\t\tfor( let i = 0, imax = newValues.length; i < imax; ++i ) {\r\n\t\t\t\t\t\t\tvalues.push( newValues[ i ] );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor( let i = 0, imax = newValues.length; i < imax; ++i ) {\r\n\t\t\t\t\t\t\tvalues.unshift( newValues[ i ] );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove the unnecessary values\r\n\t\t\t\tconst count = values.length - capacity;\r\n\t\t\t\tif( 0 < count ) {\r\n\t\t\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\t\t\tfor( let i = 0; i < count; ++i ) {\r\n\t\t\t\t\t\t\tvalues.shift();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalues.length = capacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Tell the parent it's changed\r\n\t\t\t\tconst parent = this.parent;\r\n\t\t\t\tif( parent != null ) {\r\n\t\t\t\t\tparent.isChanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget time(): number {\r\n\t\treturn this._time;\r\n\t}\r\n\r\n\tset time( newTime: number ) {\r\n\t\tconst capacity = this._capacity;\r\n\t\tif( capacity <= 0 ) {\r\n\t\t\tif( this._time !== newTime ) {\r\n\t\t\t\tthis._time = newTime;\r\n\t\t\t\tconst parent = this.parent;\r\n\t\t\t\tif( parent != null ) {\r\n\t\t\t\t\tparent.isChanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Update the times\r\n\t\t\tlet times = this._times;\r\n\t\t\tif( times == null ) {\r\n\t\t\t\ttimes = [];\r\n\t\t\t\tthis._times = times;\r\n\t\t\t}\r\n\r\n\t\t\t// Update the time\r\n\t\t\tthis._time = newTime;\r\n\r\n\t\t\t// Update the times\r\n\t\t\tconst order = this._order;\r\n\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\ttimes.push( newTime );\r\n\t\t\t} else {\r\n\t\t\t\ttimes.unshift( newTime );\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the unnecessary times\r\n\t\t\tconst count = times.length - capacity;\r\n\t\t\tif( 0 < count ) {\r\n\t\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\t\tfor( let i = 0; i < count; ++i ) {\r\n\t\t\t\t\t\ttimes.shift();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttimes.length = capacity;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Tell the parent it's changed\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget times(): number[] {\r\n\t\tlet result = this._times;\r\n\t\tif( result == null ) {\r\n\t\t\tresult = [];\r\n\t\t\tthis._times = result;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tset times( newTimes: number[] ) {\r\n\t\tif( 0 < newTimes.length ) {\r\n\t\t\tconst capacity = this._capacity;\r\n\t\t\tif( capacity <= 0 ) {\r\n\t\t\t\tconst newTime = newTimes[ newTimes.length - 1 ];\r\n\t\t\t\tif( this._time !== newTime ) {\r\n\t\t\t\t\tthis._time = newTime;\r\n\t\t\t\t\tconst parent = this.parent;\r\n\t\t\t\t\tif( parent != null ) {\r\n\t\t\t\t\t\tparent.isChanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Update the times\r\n\t\t\t\tlet times = this._times;\r\n\t\t\t\tif( times == null ) {\r\n\t\t\t\t\ttimes = [];\r\n\t\t\t\t\tthis._times = times;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Update the value\r\n\t\t\t\tthis._time = newTimes[ newTimes.length - 1 ];\r\n\r\n\t\t\t\t//\r\n\t\t\t\tconst order = this._order;\r\n\t\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\t\tfor( let i = 0, imax = newTimes.length; i < imax; ++i ) {\r\n\t\t\t\t\t\ttimes.push( newTimes[ i ] );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor( let i = 0, imax = newTimes.length; i < imax; ++i ) {\r\n\t\t\t\t\t\ttimes.unshift( newTimes[ i ] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//\r\n\t\t\t\tconst count = times.length - capacity;\r\n\t\t\t\tif( 0 < count ) {\r\n\t\t\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\t\t\tfor( let i = 0; i < count; ++i ) {\r\n\t\t\t\t\t\t\ttimes.shift();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttimes.length = capacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Tell the parent it's changed\r\n\t\t\t\tconst parent = this.parent;\r\n\t\t\t\tif( parent != null ) {\r\n\t\t\t\t\tparent.isChanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget capacity(): number {\r\n\t\treturn this._capacity;\r\n\t}\r\n\r\n\tset capacity( capacity: number ) {\r\n\t\tif( this._capacity < capacity ) {\r\n\t\t\tthis._capacity = capacity;\r\n\t\t} else if( capacity < this._capacity ) {\r\n\t\t\tthis._capacity = capacity;\r\n\r\n\t\t\tlet isChanged = false;\r\n\r\n\t\t\t// Values\r\n\t\t\tconst order = this._order;\r\n\t\t\tconst values = this._values;\r\n\t\t\tif( values != null ) {\r\n\t\t\t\tconst count = values.length - capacity;\r\n\t\t\t\tif( 0 < count ) {\r\n\t\t\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\t\t\tfor( let i = 0; i < count; ++i ) {\r\n\t\t\t\t\t\t\tvalues.shift();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalues.length = capacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tisChanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Times\r\n\t\t\tconst times = this._times;\r\n\t\t\tif( times != null ) {\r\n\t\t\t\tconst count = times.length - capacity;\r\n\t\t\t\tif( 0 < count ) {\r\n\t\t\t\t\tif( order === EShapeTagValueOrder.ASCENDING ) {\r\n\t\t\t\t\t\tfor( let i = 0; i < count; ++i ) {\r\n\t\t\t\t\t\t\ttimes.shift();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttimes.length = capacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tisChanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif( isChanged ) {\r\n\t\t\t\tconst parent = this.parent;\r\n\t\t\t\tif( parent != null ) {\r\n\t\t\t\t\tparent.isChanged = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget order(): EShapeTagValueOrder {\r\n\t\treturn this._order;\r\n\t}\r\n\r\n\tset order( order: EShapeTagValueOrder ) {\r\n\t\tthis._order = order;\r\n\t}\r\n\r\n\tremove( index: number ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\t// Values\r\n\t\tconst values = this._values;\r\n\t\tif( values != null ) {\r\n\t\t\tif( 0 <= index && index < values.length ) {\r\n\t\t\t\tvalues.splice( index, 1 );\r\n\t\t\t\tisChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Times\r\n\t\tconst times = this._times;\r\n\t\tif( times != null ) {\r\n\t\t\tif( 0 <= index && index < times.length ) {\r\n\t\t\t\ttimes.splice( index, 1 );\r\n\t\t\t\tisChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tremoveAll( indices: number[] ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tconst values = this._values;\r\n\t\tconst times = this._times;\r\n\t\tconst sorted = indices.slice(0).sort( INDEX_COMPARATOR );\r\n\t\tif( values != null ) {\r\n\t\t\tif( times != null ) {\r\n\t\t\t\tfor( let i = sorted.length - 1; 0 <= i; --i ) {\r\n\t\t\t\t\tconst index = sorted[ i ];\r\n\t\t\t\t\tif( 0 <= index ) {\r\n\t\t\t\t\t\tif( index < values.length ) {\r\n\t\t\t\t\t\t\tvalues.splice( index, 1 );\r\n\t\t\t\t\t\t\tisChanged = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif( index < times.length ) {\r\n\t\t\t\t\t\t\ttimes.splice( index, 1 );\r\n\t\t\t\t\t\t\tisChanged = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = sorted.length - 1; 0 <= i; --i ) {\r\n\t\t\t\t\tconst index = sorted[ i ];\r\n\t\t\t\t\tif( 0 <= index && index < values.length ) {\r\n\t\t\t\t\t\tvalues.splice( index, 1 );\r\n\t\t\t\t\t\tisChanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( times != null ) {\r\n\t\t\t\tfor( let i = sorted.length - 1; 0 <= i; --i ) {\r\n\t\t\t\t\tconst index = sorted[ i ];\r\n\t\t\t\t\tif( 0 <= index && index < times.length ) {\r\n\t\t\t\t\t\ttimes.splice( index, 1 );\r\n\t\t\t\t\t\tisChanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\t// Values\r\n\t\tconst values = this._values;\r\n\t\tif( values != null ) {\r\n\t\t\tvalues.length = 0;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\t// Times\r\n\t\tconst times = this._times;\r\n\t\tif( times != null ) {\r\n\t\t\ttimes.length = 0;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\t// Change flag\r\n\t\tif( isChanged ) {\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.isChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * This method does not copy the `#values` and `#times` for the performance.\r\n\t *\r\n\t * @param target a copy target\r\n\t */\r\n\tcopy( target: EShapeTagValue ): this {\r\n\t\tthis.id = target.id;\r\n\t\tthis.initial = target.initial;\r\n\t\tthis.format = target.format;\r\n\t\tthis.formatter = target.formatter;\r\n\t\tthis.range.copy( target.range );\r\n\t\tthis._value = target.value;\r\n\t\tthis._time = target.time;\r\n\t\tthis._capacity = target.capacity;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst idSerialized = manager.add( this.id );\r\n\t\tconst initialSerialized = manager.add( this.initial );\r\n\t\tconst formatSerialized = manager.add( this.format.trim() );\r\n\t\tconst rangeSerialized = this.range.serialize( manager );\r\n\t\treturn manager.add(\r\n\t\t\t`[${idSerialized},${initialSerialized},${formatSerialized},${rangeSerialized},${this._capacity},${this._order}]`\r\n\t\t);\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): this {\r\n\t\tconst resources = manager.resources;\r\n\t\tif( 0 <= target && target < resources.length ) {\r\n\t\t\tlet parsed = manager.tagValues.get( target );\r\n\t\t\tif( parsed == null ) {\r\n\t\t\t\tparsed = JSON.parse( resources[ target ] ) as DDiagramSerializedTagValue;\r\n\t\t\t\tmanager.tagValues.set( target, parsed );\r\n\t\t\t}\r\n\t\t\tthis.id = resources[ parsed[ 0 ] ] || \"\";\r\n\t\t\tthis.initial = resources[ parsed[ 1 ] ] || \"\";\r\n\t\t\tthis.format = resources[ parsed[ 2 ] ] || \"\";\r\n\t\t\tthis.range.deserialize( parsed[ 3 ], manager );\r\n\t\t\tthis._capacity = parsed[ 4 ];\r\n\t\t\tthis._order = parsed[ 5 ];\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTag } from \"../e-shape-tag\";\r\nimport { EShapeTagValue } from \"../e-shape-tag-value\";\r\nimport { EShapeTagValueRange } from \"../e-shape-tag-value-range\";\r\nimport { EShapeTagValueImpl } from \"./e-shape-tag-value-impl\";\r\nimport { EShapeTagValueRangeImpl } from \"./e-shape-tag-value-range-impl\";\r\n\r\nexport class EShapeTagImpl implements EShapeTag {\r\n\tstatic RANGE_DUMMY = new EShapeTagValueRangeImpl();\r\n\tstatic EMPTY_ARRAY = [];\r\n\r\n\tprotected _values: EShapeTagValue[];\r\n\tisChanged: boolean;\r\n\tinherited?: EShapeTagValue;\r\n\r\n\tconstructor() {\r\n\t\tthis._values = [];\r\n\t\tthis.isChanged = true;\r\n\t}\r\n\r\n\tget id(): string {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].id;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.id;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tget initial(): string {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].initial;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.initial;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tget format(): string {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].format;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.format;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tget range(): EShapeTagValueRange {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].range;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.range;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn EShapeTagImpl.RANGE_DUMMY;\r\n\t}\r\n\r\n\tget value(): unknown {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].value;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.value;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset value( value: unknown ) {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\tvalues[ 0 ].value = value;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\tinherited.value = value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget nvalue(): number {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].nvalue;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.nvalue;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tget time(): number {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].time;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.time;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset time( time: number ) {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\tvalues[ 0 ].time = time;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\tinherited.time = time;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget values(): unknown[] {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].values;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.values;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn EShapeTagImpl.EMPTY_ARRAY;\r\n\t}\r\n\r\n\tset values( newValues: unknown[] ) {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\tvalues[ 0 ].values = newValues;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\tinherited.values = newValues;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget times(): number[] {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].times;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.times;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn EShapeTagImpl.EMPTY_ARRAY;\r\n\t}\r\n\r\n\tset times( newTimes: number[] ) {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\tvalues[ 0 ].times = newTimes;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\tinherited.times = newTimes;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget capacity(): number {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\treturn values[ 0 ].capacity;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\treturn inherited.capacity;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset capacity( capacity: number ) {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 < values.length ) {\r\n\t\t\tvalues[ 0 ].capacity = capacity;\r\n\t\t} else {\r\n\t\t\tconst inherited = this.inherited;\r\n\t\t\tif( inherited != null ) {\r\n\t\t\t\tinherited.capacity = capacity;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tadd( value: EShapeTagValue, index?: number ): void {\r\n\t\tconst values = this._values;\r\n\t\tvalue.parent = this;\r\n\t\tif( index === undefined ) {\r\n\t\t\tvalues.push( value );\r\n\t\t} else {\r\n\t\t\tvalues.splice( index, 0, value );\r\n\t\t}\r\n\t}\r\n\r\n\tset( index: number, value: EShapeTagValue ): EShapeTagValue | null {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 <= index && index < values.length ) {\r\n\t\t\tconst result = values[ index ];\r\n\t\t\tvalue.parent = this;\r\n\t\t\tvalues[ index ] = value;\r\n\t\t\tresult.parent = undefined;\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tremove( index: number ): void {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 <= index && index < values.length ) {\r\n\t\t\tvalues.splice( index, 1 )[ 0 ].parent = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tindexOf( target: EShapeTagValue ): number {\r\n\t\tconst values = this._values;\r\n\r\n\t\t// Instance-based matching\r\n\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\tconst value = values[ i ];\r\n\t\t\tif( value === target ) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Data-based matching\r\n\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\tconst value = values[ i ];\r\n\t\t\tif(\r\n\t\t\t\tvalue.id === target.id &&\r\n\t\t\t\tvalue.initial === target.initial &&\r\n\t\t\t\tvalue.formatter === target.formatter &&\r\n\t\t\t\tvalue.range.isEquals( target.range )\r\n\t\t\t) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// ID-based matching\r\n\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\tconst value = values[ i ];\r\n\t\t\tif( value.id === target.id ) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tget( index: number ): EShapeTagValue | null {\r\n\t\tconst values = this._values;\r\n\t\tif( 0 <= index && index < values.length ) {\r\n\t\t\treturn values[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._values.length;\r\n\t}\r\n\r\n\tswap( indexA: number, indexB: number ): void {\r\n\t\tconst values = this._values;\r\n\t\tconst tmp = values[ indexB ];\r\n\t\tvalues[ indexB ] = values[ indexA ];\r\n\t\tvalues[ indexA ] = tmp;\r\n\t}\r\n\r\n\tcopy( target: EShapeTag ): this {\r\n\t\tconst values = this._values;\r\n\t\tvalues.length = 0;\r\n\r\n\t\tfor( let i = 0, imax = target.size(); i < imax; ++i ) {\r\n\t\t\tconst value = target.get( i );\r\n\t\t\tif( value != null ) {\r\n\t\t\t\tconst newValue = new EShapeTagValueImpl().copy( value );\r\n\t\t\t\tnewValue.parent = this;\r\n\t\t\t\tvalues.push( newValue );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst values = this._values;\r\n\t\tif( values.length <= 0 ) {\r\n\t\t\treturn manager.add( \"[]\" );\r\n\t\t} else {\r\n\t\t\tlet serialized = `[${values[ 0 ].serialize( manager )}`;\r\n\t\t\tfor( let i = 1, imax = values.length; i < imax; ++i ) {\r\n\t\t\t\tserialized += `,${values[ i ].serialize( manager )}`;\r\n\t\t\t}\r\n\t\t\tserialized += \"]\";\r\n\t\t\treturn manager.add( serialized );\r\n\t\t}\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\tif( 0 <= target && target < manager.resources.length ) {\r\n\t\t\tlet deserialized: number[] | undefined = manager.tags.get( target );\r\n\t\t\tif( deserialized == null ) {\r\n\t\t\t\tdeserialized = JSON.parse( manager.resources[ target ] ) as number[];\r\n\t\t\t\tmanager.tags.set( target, deserialized );\r\n\t\t\t}\r\n\r\n\t\t\tconst values = this._values;\r\n\t\t\tvalues.length = 0;\r\n\t\t\tfor( let i = 0, imax = deserialized.length; i < imax; ++i ) {\r\n\t\t\t\tconst index = deserialized[ i ];\r\n\t\t\t\tconst value = new EShapeTagValueImpl();\r\n\t\t\t\tvalue.parent = this;\r\n\t\t\t\tvalue.deserialize( index, manager );\r\n\t\t\t\tvalues.push( value );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextAlign, EShapeTextAlignLike } from \"../e-shape-text-align\";\r\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\r\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\r\nimport { EShapeTextAlignImplParent } from \"./e-shape-text-align-impl-parent\";\r\n\r\nexport class EShapeTextAlignImpl implements EShapeTextAlign {\r\n\tprotected _parent: EShapeTextAlignImplParent;\r\n\tprotected _horizontal: EShapeTextAlignHorizontal;\r\n\tprotected _vertical: EShapeTextAlignVertical;\r\n\r\n\tconstructor(\r\n\t\tparent: EShapeTextAlignImplParent,\r\n\t\thorizontal: EShapeTextAlignHorizontal, vertical: EShapeTextAlignVertical\r\n\t) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._horizontal = horizontal;\r\n\t\tthis._vertical = vertical;\r\n\t}\r\n\r\n\tget horizontal(): EShapeTextAlignHorizontal {\r\n\t\treturn this._horizontal;\r\n\t}\r\n\r\n\tset horizontal( horizontal: EShapeTextAlignHorizontal ) {\r\n\t\tif( this._horizontal !== horizontal ) {\r\n\t\t\tthis._horizontal = horizontal;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget vertical(): EShapeTextAlignVertical {\r\n\t\treturn this._vertical;\r\n\t}\r\n\r\n\tset vertical( vertical: EShapeTextAlignVertical ) {\r\n\t\tif( this._vertical !== vertical ) {\r\n\t\t\tthis._vertical = vertical;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextAlignLike> ): void {\r\n\t\tif( target ) {\r\n\t\t\tthis.set( target.horizontal, target.vertical );\r\n\t\t}\r\n\t}\r\n\r\n\tset( horizontal?: EShapeTextAlignHorizontal, vertical?: EShapeTextAlignVertical ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( horizontal != null && this._horizontal !== horizontal ) {\r\n\t\t\tthis._horizontal = horizontal;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( vertical != null && this._vertical !== vertical ) {\r\n\t\t\tthis._vertical = vertical;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\ttoObject(): EShapeTextAlignLike {\r\n\t\treturn {\r\n\t\t\thorizontal: this._horizontal,\r\n\t\t\tvertical: this._vertical\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn manager.add( `[${this._horizontal},${this._vertical}]` );\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\tconst resources = manager.resources;\r\n\t\tif( 0 <= target && target < resources.length ) {\r\n\t\t\tconst parsed = manager.aligns.get( target );\r\n\t\t\tif( parsed != null ) {\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tparsed[ 0 ],\r\n\t\t\t\t\tparsed[ 1 ]\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tconst deserialized = JSON.parse( resources[ target ] );\r\n\t\t\t\tmanager.aligns.set( target, deserialized );\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tdeserialized[ 0 ],\r\n\t\t\t\t\tdeserialized[ 1 ]\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"../e-shape-text-offset\";\r\nimport { EShapeTextOffsetImplParent } from \"./e-shape-text-offset-impl-parent\";\r\n\r\nexport class EShapeTextOffsetImpl implements EShapeTextOffset {\r\n\tprotected _parent: EShapeTextOffsetImplParent;\r\n\tprotected _horizontal: number;\r\n\tprotected _vertical: number;\r\n\r\n\tconstructor( parent: EShapeTextOffsetImplParent, horizontal: number, vertical: number ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._horizontal = horizontal;\r\n\t\tthis._vertical = vertical;\r\n\t}\r\n\r\n\tget horizontal(): number {\r\n\t\treturn this._horizontal;\r\n\t}\r\n\r\n\tset horizontal( horizontal: number ) {\r\n\t\tif( this._horizontal !== horizontal ) {\r\n\t\t\tthis._horizontal = horizontal;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget vertical(): number {\r\n\t\treturn this._vertical;\r\n\t}\r\n\r\n\tset vertical( vertical: number ) {\r\n\t\tif( this._vertical !== vertical ) {\r\n\t\t\tthis._vertical = vertical;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextOffsetLike> ): void {\r\n\t\tif( target ) {\r\n\t\t\tthis.set( target.horizontal, target.vertical );\r\n\t\t}\r\n\t}\r\n\r\n\tset( horizontal?: number, vertical?: number ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( horizontal != null && this._horizontal !== horizontal ) {\r\n\t\t\tthis._horizontal = horizontal;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( vertical != null && this._vertical !== vertical ) {\r\n\t\t\tthis._vertical = vertical;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOffsetLike {\r\n\t\treturn {\r\n\t\t\thorizontal: this._horizontal,\r\n\t\t\tvertical: this._vertical\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn manager.add( `[${this._horizontal},${this._vertical}]` );\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\tconst resources = manager.resources;\r\n\t\tif( 0 <= target && target < resources.length ) {\r\n\t\t\tconst parsed = manager.margins.get( target );\r\n\t\t\tif( parsed != null ) {\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tparsed[ 0 ],\r\n\t\t\t\t\tparsed[ 1 ]\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tconst deserialized = JSON.parse( resources[ target ] );\r\n\t\t\t\tmanager.margins.set( target, deserialized );\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tdeserialized[ 0 ],\r\n\t\t\t\t\tdeserialized[ 1 ]\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"../e-shape-text-outline\";\r\nimport { EShapeTextOutlineImplParent } from \"./e-shape-text-outline-impl-parent\";\r\n\r\nexport class EShapeTextOutlineImpl implements EShapeTextOutline {\r\n\tprotected _parent: EShapeTextOutlineImplParent;\r\n\tprotected _enable: boolean;\r\n\tprotected _color: number;\r\n\tprotected _alpha: number;\r\n\tprotected _width: number;\r\n\r\n\tconstructor( parent: EShapeTextOutlineImplParent, enable: boolean, color: number, alpha: number, width: number ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._enable = enable;\r\n\t\tthis._color = color;\r\n\t\tthis._alpha = alpha;\r\n\t\tthis._width = width;\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\treturn this._enable;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\tif( this._enable !== enable ) {\r\n\t\t\tthis._enable = enable;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tif( this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tif( this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tif( this._width !== width ) {\r\n\t\t\tthis._width = width;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextOutlineLike> ): void {\r\n\t\tif( target ) {\r\n\t\t\tthis.set( target.enable, target.color, target.alpha, target.width );\r\n\t\t}\r\n\t}\r\n\r\n\tset( enable?: boolean, color?: number, alpha?: number, width?: number ) {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( enable !== undefined && this._enable !== enable ) {\r\n\t\t\tthis._enable = enable;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( color !== undefined && this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( alpha !== undefined && this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( width !== undefined && this._width !== width ) {\r\n\t\t\tthis._width = width;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tclone(): EShapeTextOutline {\r\n\t\treturn new EShapeTextOutlineImpl( this._parent, this._enable, this._color, this._alpha, this._width );\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOutlineLike {\r\n\t\treturn {\r\n\t\t\tenable: this._enable,\r\n\t\t\tcolor: this._color,\r\n\t\t\talpha: this._alpha,\r\n\t\t\twidth: this._width\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst serialized = `[${this._enable ? 1 : 0},${this._color},${this._alpha},${this._width}]`;\r\n\t\treturn manager.add( serialized );\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ) {\r\n\t\tconst resources = manager.resources;\r\n\t\tif( 0 <= target && target < resources.length ) {\r\n\t\t\tconst parsed = manager.textOutlines.get( target );\r\n\t\t\tif( parsed != null ) {\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tparsed[ 0 ] !== 0,\r\n\t\t\t\t\tparsed[ 1 ],\r\n\t\t\t\t\tparsed[ 2 ],\r\n\t\t\t\t\tparsed[ 3 ]\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tconst deserialized = JSON.parse( resources[ target ] );\r\n\t\t\t\tmanager.textOutlines.set( target, deserialized );\r\n\t\t\t\tthis.set(\r\n\t\t\t\t\tdeserialized[ 0 ] !== 0,\r\n\t\t\t\t\tdeserialized[ 1 ],\r\n\t\t\t\t\tdeserialized[ 2 ],\r\n\t\t\t\t\tdeserialized[ 3 ]\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\nimport { DDiagramSerializedText } from \"../../d-diagram-serialized\";\r\nimport { DeepPartial } from \"../../util/deep-partial\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeText, EShapeTextAtlas, EShapeTextLike, EShapeTextStyle, EShapeTextWeight } from \"../e-shape-text\";\r\nimport { EShapeTextAlign } from \"../e-shape-text-align\";\r\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\r\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\r\nimport { EShapeTextDirection } from \"../e-shape-text-direction\";\r\nimport { EShapeTextOffset } from \"../e-shape-text-offset\";\r\nimport { EShapeTextOutline } from \"../e-shape-text-outline\";\r\nimport { EShapeTextAlignImpl } from \"./e-shape-text-align-impl\";\r\nimport { EShapeTextImplParent } from \"./e-shape-text-impl-parent\";\r\nimport { EShapeTextOffsetImpl } from \"./e-shape-text-offset-impl\";\r\nimport { EShapeTextOutlineImpl } from \"./e-shape-text-outline-impl\";\r\n\r\nexport class EShapeTextImpl implements EShapeText {\r\n\tprotected _parent: EShapeTextImplParent;\r\n\tprotected _enable: boolean;\r\n\tprotected _value: string;\r\n\tprotected _family: string;\r\n\tprotected _color: number;\r\n\tprotected _alpha: number;\r\n\tprotected _size: number;\r\n\tprotected _weight: EShapeTextWeight;\r\n\treadonly align: EShapeTextAlign;\r\n\treadonly offset: EShapeTextOffset;\r\n\tprotected _style: EShapeTextStyle;\r\n\treadonly outline: EShapeTextOutline;\r\n\treadonly spacing: EShapeTextOffset;\r\n\tprotected _direction: EShapeTextDirection;\r\n\treadonly padding: EShapeTextOffset;\r\n\tprotected _clipping: boolean;\r\n\r\n\ttexture?: Texture;\t\t// Used for rendering and updated when rendered\r\n\tatlas?: EShapeTextAtlas;\t// Used for rendering and updated when rendered\r\n\tworld?: Float32Array;\t\t// Updated when rendered\r\n\r\n\tconstructor(\r\n\t\tparent: EShapeTextImplParent,\r\n\t\tvalue: string, color: number, alpha: number, family: string, size: number\r\n\t) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._enable = true;\r\n\t\tthis._value = value;\r\n\t\tthis._color = color!;\r\n\t\tthis._alpha = alpha!;\r\n\t\tthis._family = family!;\r\n\t\tthis._size = size!;\r\n\t\tthis._weight = EShapeTextWeight.NORMAL;\r\n\t\tthis.align = new EShapeTextAlignImpl( parent, EShapeTextAlignHorizontal.CENTER, EShapeTextAlignVertical.MIDDLE );\r\n\t\tthis.offset = new EShapeTextOffsetImpl( parent, 0, 0 );\r\n\t\tthis._style = EShapeTextStyle.NORMAL;\r\n\t\tthis.spacing = new EShapeTextOffsetImpl( parent, 0, 0 );\r\n\t\tthis.outline = new EShapeTextOutlineImpl( parent, false, 0xffffff, 1.0, 0.5 );\r\n\t\tthis._direction = EShapeTextDirection.LEFT_TO_RIGHT;\r\n\t\tthis.padding = new EShapeTextOffsetImpl( parent, 10, 10 );\r\n\t\tthis._clipping = false;\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\treturn this._enable;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\tif( this._enable !== enable ) {\r\n\t\t\tthis._enable = enable;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget value(): string {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\tset value( value: string ) {\r\n\t\tif( this._value !== value ) {\r\n\t\t\tthis._value = value;\r\n\r\n\t\t\t// Compatibility check\r\n\t\t\tconst parent = this._parent;\r\n\t\t\tconst uploaded = parent.uploaded;\r\n\t\t\tif( uploaded == null || ! uploaded.isCompatible( parent ) ) {\r\n\t\t\t\tthis.atlas = undefined;\r\n\t\t\t\tparent.toDirty();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Character code check\r\n\t\t\tconst atlas = this.atlas;\r\n\t\t\tconst characters = atlas && atlas.characters;\r\n\t\t\tif( characters != null ) {\r\n\t\t\t\tfor( let i = 0, imax = value.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst char = value[ i ];\r\n\t\t\t\t\tif( ! (char in characters) ) {\r\n\t\t\t\t\t\tthis.atlas = undefined;\r\n\t\t\t\t\t\tparent.toDirty();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.atlas = undefined;\r\n\t\t\t\tparent.toDirty();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Update uploaded\r\n\t\t\tparent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget family(): string {\r\n\t\treturn this._family;\r\n\t}\r\n\r\n\tset family( family: string ) {\r\n\t\tif( this._family !== family ) {\r\n\t\t\tthis._family = family;\r\n\t\t\tthis._parent.toDirty();\r\n\t\t}\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tif( this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tif( this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget size(): number {\r\n\t\treturn this._size;\r\n\t}\r\n\r\n\tset size( size: number ) {\r\n\t\tif( this._size !== size ) {\r\n\t\t\tthis._size = size;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget weight(): EShapeTextWeight {\r\n\t\treturn this._weight;\r\n\t}\r\n\r\n\tset weight( weight: EShapeTextWeight ) {\r\n\t\tif( this._weight !== weight ) {\r\n\t\t\tthis._weight = weight;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget style(): EShapeTextStyle {\r\n\t\treturn this._style;\r\n\t}\r\n\r\n\tset style( style: EShapeTextStyle ) {\r\n\t\tif( this._style !== style ) {\r\n\t\t\tthis._style = style;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget direction(): EShapeTextDirection {\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n\tset direction( direction: EShapeTextDirection ) {\r\n\t\tif( this._direction !== direction ) {\r\n\t\t\tthis._direction = direction;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget clipping(): boolean {\r\n\t\treturn this._clipping;\r\n\t}\r\n\r\n\tset clipping( clipping: boolean ) {\r\n\t\tif( this._clipping !== clipping ) {\r\n\t\t\tthis._clipping = clipping;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: DeepPartial<EShapeTextLike> ): this {\r\n\t\tif( target ) {\r\n\t\t\tthis.set(\r\n\t\t\t\ttarget.value,\r\n\t\t\t\ttarget.color,\r\n\t\t\t\ttarget.alpha,\r\n\t\t\t\ttarget.family,\r\n\t\t\t\ttarget.size,\r\n\t\t\t\ttarget.weight,\r\n\t\t\t\ttarget.style,\r\n\t\t\t\ttarget.direction,\r\n\t\t\t\ttarget.clipping\r\n\t\t\t);\r\n\t\t\tthis.align.copy( target.align );\r\n\t\t\tthis.offset.copy( target.offset );\r\n\t\t\tthis.outline.copy( target.outline );\r\n\t\t\tthis.spacing.copy( target.spacing );\r\n\t\t\tthis.padding.copy( target.padding );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue?: string, color?: number, alpha?: number,\r\n\t\tfamily?: string, size?: number, weight?: EShapeTextWeight,\r\n\t\tstyle?: EShapeTextStyle, direction?: EShapeTextDirection,\r\n\t\tclipping?: boolean\r\n\t): this {\r\n\t\tlet isChangedDirty = false;\r\n\t\tlet isChangedUploaded = false;\r\n\r\n\t\tif( value != null && this._value !== value ) {\r\n\t\t\tthis._value = value;\r\n\t\t\tisChangedDirty = true;\r\n\t\t}\r\n\r\n\t\tif( color != null && this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tisChangedUploaded = true;\r\n\t\t}\r\n\r\n\t\tif( alpha != null && this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tisChangedUploaded = true;\r\n\t\t}\r\n\r\n\t\tif( family != null && this._family !== family ) {\r\n\t\t\tthis._family = family;\r\n\t\t\tisChangedDirty = true;\r\n\t\t}\r\n\r\n\t\tif( size != null && this._size !== size ) {\r\n\t\t\tthis._size = size;\r\n\t\t\tisChangedUploaded = true;\r\n\t\t}\r\n\r\n\t\tif( weight != null && this._weight !== weight ) {\r\n\t\t\tthis._weight = weight;\r\n\t\t\tisChangedUploaded = true;\r\n\t\t}\r\n\r\n\t\tif( style != null && this._style !== style ) {\r\n\t\t\tthis._style = style;\r\n\t\t\tisChangedUploaded = true;\r\n\t\t}\r\n\r\n\t\tif( direction != null && this._direction !== direction ) {\r\n\t\t\tthis._direction = direction;\r\n\t\t\tisChangedUploaded = true;\r\n\t\t}\r\n\r\n\t\tif( clipping != null && this._clipping !== clipping ) {\r\n\t\t\tthis._clipping = clipping;\r\n\t\t\tisChangedUploaded = true;\r\n\t\t}\r\n\r\n\t\tif( isChangedDirty ) {\r\n\t\t\tthis._parent.toDirty();\r\n\t\t} else if( isChangedUploaded ) {\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\ttoObject(): EShapeTextLike {\r\n\t\treturn {\r\n\t\t\tvalue: this._value,\r\n\t\t\tcolor: this._color,\r\n\t\t\talpha: this._alpha,\r\n\t\t\tfamily: this._family,\r\n\t\t\tsize: this._size,\r\n\t\t\tweight: this._weight,\r\n\t\t\talign: this.align.toObject(),\r\n\t\t\toffset: this.offset.toObject(),\r\n\t\t\tstyle: this._style,\r\n\t\t\toutline: this.outline.toObject(),\r\n\t\t\tdirection: this._direction,\r\n\t\t\tspacing: this.spacing.toObject(),\r\n\t\t\tpadding: this.padding.toObject(),\r\n\t\t\tclipping: this._clipping\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst alignSerialized = this.align.serialize( manager );\r\n\t\tconst offsetSerialized = this.offset.serialize( manager );\r\n\t\tconst outlineSerialized = this.outline.serialize( manager );\r\n\t\tconst spacingSerialized = this.spacing.serialize( manager );\r\n\t\tconst paddingSerialized = this.padding.serialize( manager );\r\n\t\tconst serialized = `[${manager.add( this._value )},${this._color},${this._alpha},` +\r\n\t\t\t`${manager.add( this._family )},${this._size},${this._weight},${alignSerialized},` +\r\n\t\t\t`${offsetSerialized},${this._style},${outlineSerialized},${spacingSerialized},` +\r\n\t\t\t`${this._direction},${paddingSerialized},${this._clipping ? 1 : 0 }]`;\r\n\t\treturn manager.add( serialized );\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ) {\r\n\t\tconst resources = manager.resources;\r\n\t\tif( 0 <= target && target < resources.length ) {\r\n\t\t\tlet parsed = manager.texts.get( target );\r\n\t\t\tif( parsed == null ) {\r\n\t\t\t\tparsed = JSON.parse( resources[ target ] ) as DDiagramSerializedText;\r\n\t\t\t\tmanager.texts.set( target, parsed );\r\n\t\t\t}\r\n\t\t\tthis.set(\r\n\t\t\t\tresources[ parsed[ 0 ] ] || \"\",\r\n\t\t\t\tparsed[ 1 ],\r\n\t\t\t\tparsed[ 2 ],\r\n\t\t\t\tresources[ parsed[ 3 ] ] || \"auto\",\r\n\t\t\t\tparsed[ 4 ],\r\n\t\t\t\tparsed[ 5 ],\r\n\t\t\t\tparsed[ 8 ],\r\n\t\t\t\tparsed[ 11 ],\r\n\t\t\t\t( parsed[ 13 ] !== 0 )\r\n\t\t\t);\r\n\t\t\tthis.align.deserialize( parsed[ 6 ], manager );\r\n\t\t\tthis.offset.deserialize( parsed[ 7 ], manager );\r\n\t\t\tthis.outline.deserialize( parsed[ 9 ], manager );\r\n\t\t\tthis.spacing.deserialize( parsed[ 10 ], manager );\r\n\t\t\tthis.padding.deserialize( parsed[ 12 ], manager );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint, ObservablePoint } from \"pixi.js\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeCorner } from \"../e-shape-corner\";\r\nimport { EShapeDefaults } from \"../e-shape-defaults\";\r\nimport { EShapeFill } from \"../e-shape-fill\";\r\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\r\nimport { EShapePoints } from \"../e-shape-points\";\r\nimport { EShapeStroke } from \"../e-shape-stroke\";\r\nimport { EShapeTag } from \"../e-shape-tag\";\r\nimport { EShapeText } from \"../e-shape-text\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeBase } from \"./e-shape-base\";\r\nimport { EShapeFillImpl } from \"./e-shape-fill-impl\";\r\nimport { EShapeStrokeImpl } from \"./e-shape-stroke-impl\";\r\nimport { EShapeTagImpl } from \"./e-shape-tag-impl\";\r\nimport { EShapeTextImpl } from \"./e-shape-text-impl\";\r\n\r\nexport abstract class EShapePrimitive extends EShapeBase {\r\n\treadonly size: IPoint;\r\n\treadonly fill: EShapeFill;\r\n\treadonly stroke: EShapeStroke;\r\n\tprotected _radius: number;\r\n\tprotected _corner: EShapeCorner;\r\n\tpoints?: EShapePoints;\r\n\tprotected _image?: HTMLImageElement;\r\n\tgradient?: EShapeGradientLike;\r\n\treadonly text: EShapeText;\r\n\treadonly tag: EShapeTag;\r\n\tcursor: string;\r\n\r\n\tconstructor( type: EShapeType ) {\r\n\t\tsuper( type );\r\n\t\tthis.size = this.newSize();\r\n\t\tthis.fill = this.newFill();\r\n\t\tthis.stroke = this.newStroke();\r\n\t\tthis._radius = EShapeDefaults.RADIUS;\r\n\t\tthis._corner = EShapeCorner.ALL;\r\n\t\tthis.tag = new EShapeTagImpl();\r\n\t\tthis.text = this.newText();\r\n\t\tthis.cursor = EShapeDefaults.CURSOR;\r\n\t}\r\n\r\n\tprotected newSize(): IPoint {\r\n\t\treturn new ObservablePoint(\r\n\t\t\t() => { this.onSizeChange(); },\r\n\t\t\tundefined,\r\n\t\t\tEShapeDefaults.SIZE_X,\r\n\t\t\tEShapeDefaults.SIZE_Y\r\n\t\t);\r\n\t}\r\n\r\n\tprotected newFill(): EShapeFill {\r\n\t\treturn new EShapeFillImpl(\r\n\t\t\tthis, true,\r\n\t\t\tEShapeDefaults.FILL_COLOR,\r\n\t\t\tEShapeDefaults.FILL_ALPHA\r\n\t\t);\r\n\t}\r\n\r\n\tprotected newStroke(): EShapeStroke {\r\n\t\treturn new EShapeStrokeImpl(\r\n\t\t\tthis, true,\r\n\t\t\tEShapeDefaults.STROKE_COLOR,\r\n\t\t\tEShapeDefaults.STROKE_ALPHA,\r\n\t\t\tEShapeDefaults.STROKE_WIDTH,\r\n\t\t\tEShapeDefaults.STROKE_ALIGN,\r\n\t\t\tEShapeDefaults.STROKE_SIDE\r\n\t\t);\r\n\t}\r\n\r\n\tprotected newText(): EShapeText {\r\n\t\treturn new EShapeTextImpl(\r\n\t\t\tthis,\r\n\t\t\tEShapeDefaults.TEXT_VALUE,\r\n\t\t\tEShapeDefaults.STROKE_COLOR,\r\n\t\t\tEShapeDefaults.STROKE_ALPHA,\r\n\t\t\tEShapeDefaults.TEXT_FAMILY,\r\n\t\t\tEShapeDefaults.TEXT_SIZE\r\n\t\t);\r\n\t}\r\n\r\n\tabstract clone(): EShape;\r\n\r\n\tget corner(): number {\r\n\t\treturn this._corner;\r\n\t}\r\n\r\n\tset corner( corner: number ) {\r\n\t\tif( this._corner !== corner ) {\r\n\t\t\tthis._corner = corner;\r\n\t\t\tthis.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget radius(): number {\r\n\t\treturn this._radius;\r\n\t}\r\n\r\n\tset radius( radius: number ) {\r\n\t\tif( this._radius !== radius ) {\r\n\t\t\tthis._radius = radius;\r\n\t\t\tthis.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tget image(): HTMLImageElement | undefined {\r\n\t\treturn this._image;\r\n\t}\r\n\r\n\tset image( image: HTMLImageElement | undefined ) {\r\n\t\tif( this._image !== image ) {\r\n\t\t\tif( image != null ) {\r\n\t\t\t\tthis._image = image;\r\n\t\t\t\tthis.imageSrc = image.src;\r\n\t\t\t} else {\r\n\t\t\t\tthis._image = undefined;\r\n\t\t\t\tthis.imageSrc = undefined;\r\n\t\t\t}\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tparent.toDirty();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapePoints } from \"../e-shape-points\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeBase } from \"./e-shape-base\";\r\nimport {\r\n\tEShapeLineBasePoints, EShapeLineBasePointsHitTester, EShapeLineBasePointsTestRange,\r\n\tEShapeLineBasePointsToHitThreshold\r\n} from \"./e-shape-line-base-points\";\r\nimport { EShapePrimitive } from \"./e-shape-primitive\";\r\n\r\nexport abstract class EShapeLineBase extends EShapePrimitive {\r\n\tprotected static WORK_RANGE: [ number, number ] = [ 0, 0 ];\r\n\tabstract points: EShapeLineBasePoints;\r\n\tabstract clone(): EShapeLineBase;\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): DDiagramSerializedItem {\r\n\t\tconst result = super.serialize( manager );\r\n\t\tresult[ 15 ] = this.points.serialize( manager );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getPixelScale(): number {\r\n\t\tconst container = this.root.parent as any;\r\n\t\tif( container != null && container.getPixelScale != null ) {\r\n\t\t\treturn container.getPixelScale();\r\n\t\t}\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tprotected getStrokeWidthScale( points: EShapePoints ): number {\r\n\t\tconst style = points.style;\r\n\t\tif( style & EShapePointsStyle.NON_EXPANDING_WIDTH ) {\r\n\t\t\tif( style & EShapePointsStyle.NON_SHRINKING_WIDTH ) {\r\n\t\t\t\treturn this.getPixelScale();\r\n\t\t\t} else {\r\n\t\t\t\treturn Math.min( 1.0, this.getPixelScale() );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( style & EShapePointsStyle.NON_SHRINKING_WIDTH ) {\r\n\t\t\t\treturn Math.max( 1.0, this.getPixelScale() );\r\n\t\t\t} else {\r\n\t\t\t\treturn 1.0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toHitThreshold(\r\n\t\ttoThreshold: EShapeLineBasePointsToHitThreshold | null\r\n\t): number {\r\n\t\tconst stroke = this.stroke;\r\n\t\tconst strokeWidth = ( stroke.enable ? stroke.width : 0 );\r\n\t\tconst strokeScale = this.getStrokeWidthScale( this.points );\r\n\t\treturn ( toThreshold ?\r\n\t\t\ttoThreshold( strokeWidth, strokeScale ) :\r\n\t\t\tstrokeWidth * strokeScale * 0.5\r\n\t\t);\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tconst points = this.points;\r\n\t\tconst threshold = this.toHitThreshold( null );\r\n\t\tif( this.containsAbsBBox( x, y, ax + threshold, ay + threshold ) ) {\r\n\t\t\treturn points.calcHitPointAbs(\r\n\t\t\t\tx, y,\r\n\t\t\t\tax, ay,\r\n\t\t\t\tthreshold,\r\n\t\t\t\tnull,\r\n\t\t\t\tthis.calcHitPointAbsHitTester,\r\n\t\t\t\tnull\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcalcHitPoint<RESULT>(\r\n\t\tpoint: IPoint,\r\n\t\ttoHitThreshold: EShapeLineBasePointsToHitThreshold | null,\r\n\t\trange: EShapeLineBasePointsTestRange | null,\r\n\t\ttester: EShapeLineBasePointsHitTester<RESULT>,\r\n\t\tresult: RESULT\r\n\t): boolean {\r\n\t\tconst points = this.points;\r\n\t\tconst threshold = this.toHitThreshold( toHitThreshold );\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\tif( this.containsAbsBBox( rect.x, rect.y, rect.width + threshold, rect.height + threshold ) ) {\r\n\t\t\treturn points.calcHitPointAbs(\r\n\t\t\t\trect.x, rect.y,\r\n\t\t\t\trect.width, rect.height,\r\n\t\t\t\tthreshold,\r\n\t\t\t\trange,\r\n\t\t\t\ttester,\r\n\t\t\t\tresult\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected calcHitPointAbsHitTester(\r\n\t\tthis: unknown,\r\n\t\tx: number, y: number,\r\n\t\tp0x: number, p0y: number,\r\n\t\tp1x: number, p1y: number,\r\n\t\tindex: number,\r\n\t\tthreshold: number,\r\n\t\tresult: unknown\r\n\t): boolean {\r\n\t\t// (x, y) = p0 + (p1 - p0) * t where 0 <= t <= 1\r\n\t\t// d0 := p1 - p0\r\n\t\t// d1 := v - p0\r\n\t\t// (p0.x + d0.x * t - x)^2 + (p0.y + d0.y * t - y)^2\r\n\t\t// (d0.x t - d1.x)^2 + (d0.y t - d1.y)^2\r\n\t\t// (d0.x^2 + d0.y^2) t^2 - 2 (d0.x * d1.x + d0.y * d1.y) t + (d1.x^2 + d1.y^2)\r\n\t\t// a := dot( d0, d0 )\r\n\t\t// b := dot( d0, d1 )\r\n\t\t// c := dot( d1, d1 )\r\n\t\t// a t^2 - 2 b t + c = a (t - b / a)^2 + c - b * b / a\r\n\t\t// t0 = b / a  min = c - b * b / a\r\n\t\tconst d0x = p1x - p0x;\r\n\t\tconst d0y = p1y - p0y;\r\n\t\tconst d1x = x - p0x;\r\n\t\tconst d1y = y - p0y;\r\n\t\tconst a = d0x * d0x + d0y * d0y;\r\n\t\tconst b = d0x * d1x + d0y * d1y;\r\n\t\tconst c = d1x * d1x + d1y * d1y;\r\n\t\tif( 0.0001 < a ) {\r\n\t\t\tconst t = Math.max( 0, Math.min( 1, b / a ) );\r\n\t\t\tconst d = a * t * t - 2 * b * t + c;\r\n\t\t\tif( d < threshold * threshold ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeBarPoints } from \"./e-shape-bar-points\";\r\nimport { EShapeBarPosition } from \"./e-shape-bar-position\";\r\nimport { EShapeLineBase } from \"./e-shape-line-base\";\r\n\r\nexport class EShapeBar extends EShapeLineBase {\r\n\tpoints: EShapeBarPoints;\r\n\r\n\tconstructor( position: EShapeBarPosition, size: number, width: number, style: EShapePointsStyle ) {\r\n\t\tsuper( EShapeType.BAR );\r\n\t\tthis.fill.enable = false;\r\n\t\tthis.stroke.set( true, undefined, undefined, width );\r\n\t\tthis.points = new EShapeBarPoints( this, position, size, style );\r\n\t}\r\n\r\n\tclone(): EShapeBar {\r\n\t\tconst points = this.points;\r\n\t\treturn new EShapeBar( points.position, points.size, this.stroke.width, points.style ).copy( this );\r\n\t}\r\n\r\n\tcontainsAbsBBox( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tconst size = Math.max( 0, this.points.size );\r\n\t\treturn super.containsAbsBBox( x, y, ax + size, ay + size );\r\n\t}\r\n}\r\n","export const buildColor = (\r\n\tcolor: number,\r\n\talpha: number,\r\n\tvoffset: number,\r\n\tvcount: number,\r\n\tcolors: Float32Array\r\n): void => {\r\n\tconst r = ((color >> 16) & 0xFF) / 255.0 * alpha;\r\n\tconst g = ((color >>  8) & 0xFF) / 255.0 * alpha;\r\n\tconst b = ((color >>  0) & 0xFF) / 255.0 * alpha;\r\n\tconst a = alpha;\r\n\r\n\tlet ic = voffset << 2;\r\n\tfor( let i = 0; i < vcount; ++i ) {\r\n\t\tcolors[ ic + 0 ] = r;\r\n\t\tcolors[ ic + 1 ] = g;\r\n\t\tcolors[ ic + 2 ] = b;\r\n\t\tcolors[ ic + 3 ] = a;\r\n\t\tic += 4;\r\n\t}\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture, TextureUvs } from \"pixi.js\";\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeBuffer } from \"./e-shape-buffer\";\r\nimport { EShapeBufferUnitBuilder } from \"./e-shape-buffer-unit-builder\";\r\nimport { EShapeCorner } from \"./e-shape-corner\";\r\nimport { buildColor } from \"./variant/build-color\";\r\n\r\nexport interface EShapeUploaded {\r\n\tupdate( shape: EShape ): void;\r\n\tisCompatible( shape: EShape ): boolean;\r\n\tgetBuffer(): EShapeBuffer;\r\n\tgetVertexOffset(): number;\r\n\tgetVertexCount(): number;\r\n\tgetIndexOffset(): number;\r\n\tgetIndexCount(): number;\r\n\tbuildUnit( builder: EShapeBufferUnitBuilder ): void;\r\n}\r\n\r\nexport abstract class EShapeUploadedBase implements EShapeUploaded {\r\n\tprotected buffer: EShapeBuffer;\r\n\r\n\tprotected transformLocalId: number;\r\n\r\n\tprotected vertexOffset: number;\r\n\tprotected vertexCount: number;\r\n\tprotected indexOffset: number;\r\n\tprotected indexCount: number;\r\n\r\n\tprotected colorFill: number;\r\n\tprotected alphaFill: number;\r\n\tprotected colorStroke: number;\r\n\tprotected alphaStroke: number;\r\n\r\n\tprotected sizeX: number;\r\n\tprotected sizeY: number;\r\n\tprotected strokeWidth: number;\r\n\tprotected strokeAlign: number;\r\n\tprotected strokeSide: number;\r\n\tprotected radius: number;\r\n\tprotected corner: EShapeCorner;\r\n\r\n\tprotected texture: Texture | null;\r\n\tprotected textureTransformId: number;\r\n\r\n\tprotected antialiasWeight: number;\r\n\r\n\tconstructor(\r\n\t\tbuffer: EShapeBuffer,\r\n\t\tvoffset: number, ioffset: number,\r\n\t\tvcount: number, icount: number,\r\n\t\tantialiasWeight: number\r\n\t) {\r\n\t\tthis.buffer = buffer;\r\n\r\n\t\tthis.transformLocalId = -1;\r\n\r\n\t\tthis.vertexOffset = voffset;\r\n\t\tthis.vertexCount = vcount;\r\n\t\tthis.indexOffset = ioffset;\r\n\t\tthis.indexCount = icount;\r\n\r\n\t\tthis.colorFill = NaN;\r\n\t\tthis.alphaFill = -1;\r\n\t\tthis.colorStroke = NaN;\r\n\t\tthis.alphaStroke = -1;\r\n\r\n\t\tthis.sizeX = NaN;\r\n\t\tthis.sizeY = NaN;\r\n\t\tthis.strokeWidth = NaN;\r\n\t\tthis.strokeAlign = NaN;\r\n\t\tthis.strokeSide = NaN;\r\n\t\tthis.radius = NaN;\r\n\t\tthis.corner = NaN;\r\n\r\n\t\tthis.texture = null;\r\n\t\tthis.textureTransformId = NaN;\r\n\r\n\t\tthis.antialiasWeight = antialiasWeight;\r\n\t}\r\n\r\n\tinit( shape: EShape ): this {\r\n\t\tshape.uploaded = this;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tabstract update( shape: EShape ): void;\r\n\r\n\tisCompatible( shape: EShape ): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tgetBuffer(): EShapeBuffer {\r\n\t\treturn this.buffer;\r\n\t}\r\n\r\n\tgetVertexOffset(): number {\r\n\t\treturn this.vertexOffset;\r\n\t}\r\n\r\n\tgetVertexCount(): number {\r\n\t\treturn this.vertexCount;\r\n\t}\r\n\r\n\tgetIndexOffset(): number {\r\n\t\treturn this.indexOffset;\r\n\t}\r\n\r\n\tgetIndexCount(): number {\r\n\t\treturn this.indexCount;\r\n\t}\r\n\r\n\tprotected toTransformLocalId( shape: EShape ) {\r\n\t\tshape.updateTransform();\r\n\t\treturn shape.transform.getLocalId();\r\n\t}\r\n\r\n\tprotected toTexture( shape: EShape ) {\r\n\t\treturn shape.texture || Texture.WHITE;\r\n\t}\r\n\r\n\tprotected toTextureTransformId( texture: Texture ): number {\r\n\t\tconst textureAny = texture as any;\r\n\t\tif( textureAny._uvs == null ) {\r\n\t\t\ttexture.updateUvs();\r\n\t\t}\r\n\t\treturn textureAny._updateID;\r\n\t}\r\n\r\n\tprotected toTextureUvs( texture: Texture ): TextureUvs {\r\n\t\treturn (texture as any)._uvs;\r\n\t}\r\n\r\n\tprotected updateColorFill( buffer: EShapeBuffer, shape: EShape, vertexCount: number ) {\r\n\t\tconst fill = shape.fill;\r\n\t\tconst isEnabled = shape.visible && fill.enable;\r\n\t\tconst color = fill.color;\r\n\t\tconst alpha = (isEnabled ? fill.alpha : 0);\r\n\t\tif( color !== this.colorFill || alpha !== this.alphaFill ) {\r\n\t\t\tthis.colorFill = color;\r\n\t\t\tthis.alphaFill = alpha;\r\n\t\t\tbuffer.updateColorFills();\r\n\r\n\t\t\tbuildColor(\r\n\t\t\t\tcolor, alpha,\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\tvertexCount,\r\n\t\t\t\tbuffer.colorFills\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateColorStroke( buffer: EShapeBuffer, shape: EShape, vertexCount: number ) {\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst isEnabled = shape.visible && stroke.enable && 0 < stroke.width;\r\n\t\tconst color = stroke.color;\r\n\t\tconst alpha = (isEnabled ? stroke.alpha : 0);\r\n\t\tif( color !== this.colorStroke || alpha !== this.alphaStroke ) {\r\n\t\t\tthis.colorStroke = color;\r\n\t\t\tthis.alphaStroke = alpha;\r\n\t\t\tbuffer.updateColorStrokes();\r\n\r\n\t\t\tbuildColor(\r\n\t\t\t\tcolor, alpha,\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\tvertexCount,\r\n\t\t\t\tbuffer.colorStrokes\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateColorFillAndStroke( buffer: EShapeBuffer, shape: EShape, vertexCount: number ) {\r\n\t\tthis.updateColorFill( buffer, shape, vertexCount );\r\n\t\tthis.updateColorStroke( buffer, shape, vertexCount );\r\n\t}\r\n\r\n\tbuildUnit( builder: EShapeBufferUnitBuilder ) {\r\n\t\tconst texture = this.texture || Texture.WHITE;\r\n\t\tconst baseTexture = texture.baseTexture;\r\n\t\tif( baseTexture !== builder.baseTexture ) {\r\n\t\t\tbuilder.baseTexture = baseTexture;\r\n\t\t\tconst indexOffset = this.indexOffset;\r\n\t\t\tbuilder.push( texture, indexOffset );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { EShapeBufferUnitBuilder } from \"../e-shape-buffer-unit-builder\";\r\nimport { EShapeTextAtlas } from \"../e-shape-text\";\r\nimport { EShapeUploadedBase } from \"../e-shape-uploaded\";\r\nimport { buildColor } from \"./build-color\";\r\nimport {\r\n\tbuildTextClipping, buildTextIndex, buildTextStep, buildTextVertex,\r\n\tTEXT_VERTEX_COUNT, toTextBufferCount\r\n} from \"./build-text\";\r\n\r\nexport abstract class EShapeTextUploaded extends EShapeUploadedBase {\r\n\tprotected textTexture: Texture | null;\r\n\tprotected textTextureTransformId: number;\r\n\tprotected textValue: string;\r\n\tprotected textFamily: string;\r\n\tprotected textSize: number;\r\n\tprotected textColor: number;\r\n\tprotected textAlpha: number;\r\n\tprotected textWeight: number;\r\n\tprotected textStyle: number;\r\n\tprotected textAlignHorizontal: number;\r\n\tprotected textAlignVertical: number;\r\n\tprotected textOffsetHorizontal: number;\r\n\tprotected textOffsetVertical: number;\r\n\tprotected textOutlineWidth: number;\r\n\tprotected textOutlineColor: number;\r\n\tprotected textOutlineAlpha: number;\r\n\tprotected textSpacingHorizontal: number;\r\n\tprotected textSpacingVertical: number;\r\n\tprotected textDirection: number;\r\n\tprotected textPaddingHorizontal: number;\r\n\tprotected textPaddingVertical: number;\r\n\tprotected textClipping: boolean;\r\n\tprotected textVertexOffset: number;\r\n\tprotected textIndexOffset: number;\r\n\tprotected textVertexCount: number;\r\n\tprotected textIndexCount: number;\r\n\r\n\tconstructor(\r\n\t\tbuffer: EShapeBuffer,\r\n\t\tvoffset: number, ioffset: number,\r\n\t\ttvcount: number, ticount: number,\r\n\t\tvcount: number, icount: number,\r\n\t\tantialiasWeight: number\r\n\t) {\r\n\t\tsuper( buffer, voffset, ioffset, vcount, icount, antialiasWeight );\r\n\r\n\t\tthis.textSize = NaN;\r\n\t\tthis.textFamily = \"auto\";\r\n\t\tthis.textValue = \"\";\r\n\t\tthis.textTexture = null;\r\n\t\tthis.textTextureTransformId = NaN;\r\n\t\tthis.textColor = NaN;\r\n\t\tthis.textAlpha = NaN;\r\n\t\tthis.textWeight = NaN;\r\n\t\tthis.textStyle = NaN;\r\n\t\tthis.textAlignHorizontal = NaN;\r\n\t\tthis.textAlignVertical = NaN;\r\n\t\tthis.textOffsetHorizontal = NaN;\r\n\t\tthis.textOffsetVertical = NaN;\r\n\t\tthis.textOutlineWidth = NaN;\r\n\t\tthis.textOutlineColor = NaN;\r\n\t\tthis.textOutlineAlpha = NaN;\r\n\t\tthis.textSpacingHorizontal = NaN;\r\n\t\tthis.textSpacingVertical = NaN;\r\n\t\tthis.textDirection = NaN;\r\n\t\tthis.textPaddingHorizontal = NaN;\r\n\t\tthis.textPaddingVertical = NaN;\r\n\t\tthis.textClipping = false;\r\n\t\tthis.textVertexOffset = this.vertexOffset + this.vertexCount - tvcount;\r\n\t\tthis.textIndexOffset = this.indexOffset + this.indexCount - ticount;\r\n\t\tthis.textVertexCount = tvcount;\r\n\t\tthis.textIndexCount = ticount;\r\n\t}\r\n\r\n\tinitText(): void {\r\n\t\tconst vcount = this.textVertexCount;\r\n\t\tif( 0 < vcount ) {\r\n\t\t\t// Clippings\r\n\t\t\tconst buffer = this.buffer;\r\n\t\t\tconst voffset = this.textVertexOffset;\r\n\t\t\tbuffer.updateClippings();\r\n\t\t\tbuildTextClipping(\r\n\t\t\t\tbuffer.clippings,\r\n\t\t\t\tvoffset,\r\n\t\t\t\tvcount\r\n\t\t\t);\r\n\r\n\t\t\t// Indices\r\n\t\t\tbuffer.updateIndices();\r\n\t\t\tbuildTextIndex(\r\n\t\t\t\tbuffer.indices,\r\n\t\t\t\tvoffset,\r\n\t\t\t\tthis.textIndexOffset,\r\n\t\t\t\tthis.textIndexCount\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tisCompatible( shape: EShape ): boolean {\r\n\t\tif( super.isCompatible( shape ) ) {\r\n\t\t\treturn ( toTextBufferCount( shape ) * TEXT_VERTEX_COUNT === this.textVertexCount );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected updateText( buffer: EShapeBuffer, shape: EShape ) {\r\n\t\tconst vcount = this.textVertexCount;\r\n\t\tif( 0 < vcount ) {\r\n\t\t\tconst textAtlas = shape.text.atlas;\r\n\t\t\tif( textAtlas != null ) {\r\n\t\t\t\tthis.updateTextVertex( buffer, shape, textAtlas );\r\n\t\t\t\tthis.updateTextColorFill( buffer, shape );\r\n\t\t\t\tthis.updateTextColorStroke( buffer, shape );\r\n\t\t\t\tthis.updateTextStep( buffer, shape );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateColor( buffer: EShapeBuffer, shape: EShape ) {\r\n\t\tconst vertexCount = this.vertexCount - this.textVertexCount;\r\n\t\tthis.updateColorFillAndStroke( buffer, shape, vertexCount );\r\n\t}\r\n\r\n\tprotected updateTextVertex( buffer: EShapeBuffer, shape: EShape, textAtlas: EShapeTextAtlas ) {\r\n\t\tconst text = shape.text;\r\n\t\tconst textSize = text.size;\r\n\t\tconst textFamily = text.family;\r\n\t\tconst textValue = text.value;\r\n\t\tconst textStyle = text.style;\r\n\t\tconst textAlignHorizontal = text.align.horizontal;\r\n\t\tconst textAlignVertical = text.align.vertical;\r\n\t\tconst textOffsetHorizontal = text.offset.horizontal;\r\n\t\tconst textOffsetVertical = text.offset.vertical;\r\n\t\tconst textSpacingHorizontal = text.spacing.horizontal;\r\n\t\tconst textSpacingVertical = text.spacing.vertical;\r\n\t\tconst textDirection = text.direction;\r\n\t\tconst textPaddingHorizontal = text.padding.horizontal;\r\n\t\tconst textPaddingVertical = text.padding.vertical;\r\n\t\tconst textClipping = text.clipping;\r\n\t\tconst textTexture = text.texture || Texture.WHITE;\r\n\t\tconst textTextureTransformId = this.toTextureTransformId( textTexture );\r\n\r\n\t\tconst isCharChanged = (textValue !== this.textValue || textFamily !== this.textFamily);\r\n\t\tconst isCharSizeChanged = (textSize !== this.textSize);\r\n\t\tconst isCharStyleChanged = (textStyle !== this.textStyle);\r\n\t\tconst isCharAlignChanged = (textAlignHorizontal !== this.textAlignHorizontal ||\r\n\t\t\ttextAlignVertical !== this.textAlignVertical);\r\n\t\tconst isCharOffsetChanged = (textOffsetHorizontal !== this.textOffsetHorizontal ||\r\n\t\t\ttextOffsetVertical !== this.textOffsetVertical);\r\n\t\tconst isCharSpacingChanged = (textSpacingHorizontal !== this.textSpacingHorizontal ||\r\n\t\t\ttextSpacingVertical !== this.textSpacingVertical ||\r\n\t\t\ttextPaddingHorizontal !== this.textPaddingHorizontal ||\r\n\t\t\ttextPaddingVertical !== this.textPaddingVertical);\r\n\t\tconst isCharDirectionChanged = (textDirection !== this.textDirection);\r\n\t\tconst isClippingChanged = ( this.textClipping !== textClipping );\r\n\t\tconst isTextureChanged = ( textTexture !== this.textTexture ||\r\n\t\t\ttextTextureTransformId !== this.textTextureTransformId );\r\n\r\n\t\tif( isCharChanged || isCharSizeChanged || isCharStyleChanged ||\r\n\t\t\tisCharAlignChanged || isCharOffsetChanged || isCharSpacingChanged ||\r\n\t\t\tisCharDirectionChanged || isClippingChanged || isTextureChanged ) {\r\n\t\t\tthis.textSize = textSize;\r\n\t\t\tthis.textFamily = textFamily;\r\n\t\t\tthis.textValue = textValue;\r\n\t\t\tthis.textStyle = textStyle;\r\n\t\t\tthis.textAlignHorizontal = textAlignHorizontal;\r\n\t\t\tthis.textAlignVertical = textAlignVertical;\r\n\t\t\tthis.textOffsetHorizontal = textOffsetHorizontal;\r\n\t\t\tthis.textOffsetVertical = textOffsetVertical;\r\n\t\t\tthis.textSpacingHorizontal = textSpacingHorizontal;\r\n\t\t\tthis.textSpacingVertical = textSpacingVertical;\r\n\t\t\tthis.textDirection = textDirection;\r\n\t\t\tthis.textPaddingHorizontal = textPaddingHorizontal;\r\n\t\t\tthis.textPaddingVertical = textPaddingVertical;\r\n\t\t\tthis.textClipping = textClipping;\r\n\t\t\tthis.textTexture = textTexture;\r\n\t\t\tthis.textTextureTransformId = textTextureTransformId;\r\n\r\n\t\t\tif( isCharSizeChanged ) {\r\n\t\t\t\t// Invalidate the text weight to update the text steps.\r\n\t\t\t\tthis.textWeight = NaN;\r\n\t\t\t}\r\n\r\n\t\t\t// Vertices & UVs\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tbuffer.updateUvs();\r\n\t\t\tconst shapeSize = shape.size;\r\n\t\t\tconst textWorld = text.world = text.world || new Float32Array( 8 );\r\n\t\t\tbuildTextVertex(\r\n\t\t\t\tbuffer.vertices,\r\n\t\t\t\tbuffer.uvs,\r\n\t\t\t\tthis.textVertexOffset,\r\n\t\t\t\tthis.textVertexCount,\r\n\t\t\t\t0,\r\n\t\t\t\t0,\r\n\t\t\t\tshapeSize.x,\r\n\t\t\t\tshapeSize.y,\r\n\t\t\t\ttextAtlas,\r\n\t\t\t\ttextSize,\r\n\t\t\t\ttextValue,\r\n\t\t\t\ttextStyle,\r\n\t\t\t\ttextAlignHorizontal,\r\n\t\t\t\ttextAlignVertical,\r\n\t\t\t\ttextOffsetHorizontal,\r\n\t\t\t\ttextOffsetVertical,\r\n\t\t\t\ttextSpacingHorizontal,\r\n\t\t\t\ttextSpacingVertical,\r\n\t\t\t\ttextDirection,\r\n\t\t\t\ttextPaddingHorizontal,\r\n\t\t\t\ttextPaddingVertical,\r\n\t\t\t\ttextClipping,\r\n\t\t\t\ttextWorld,\r\n\t\t\t\tthis.toTextureUvs( textTexture ),\r\n\t\t\t\tshape.transform.internalTransform\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateTextColorFill( buffer: EShapeBuffer, shape: EShape ) {\r\n\t\tconst text = shape.text;\r\n\t\tconst color = text.color;\r\n\t\tconst alpha = ( shape.visible && text.enable ? text.alpha : 0 );\r\n\t\tif( color !== this.textColor || alpha !== this.textAlpha ) {\r\n\t\t\tthis.textColor = color;\r\n\t\t\tthis.textAlpha = alpha;\r\n\t\t\tbuffer.updateColorFills();\r\n\r\n\t\t\tbuildColor(\r\n\t\t\t\tcolor, alpha,\r\n\t\t\t\tthis.textVertexOffset,\r\n\t\t\t\tthis.textVertexCount,\r\n\t\t\t\tbuffer.colorFills\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateTextColorStroke( buffer: EShapeBuffer, shape: EShape ) {\r\n\t\tconst text = shape.text;\r\n\t\tconst outline = text.outline;\r\n\t\tconst color = outline.color;\r\n\t\tconst alpha = ( shape.visible && text.enable ? outline.alpha : 0 );\r\n\t\tif( color !== this.textOutlineColor || alpha !== this.textOutlineAlpha ) {\r\n\t\t\tthis.textOutlineColor = color;\r\n\t\t\tthis.textOutlineAlpha = alpha;\r\n\t\t\tbuffer.updateColorStrokes();\r\n\r\n\t\t\tbuildColor(\r\n\t\t\t\tcolor, alpha,\r\n\t\t\t\tthis.textVertexOffset,\r\n\t\t\t\tthis.textVertexCount,\r\n\t\t\t\tbuffer.colorStrokes\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateTextStep( buffer: EShapeBuffer, shape: EShape ) {\r\n\t\tconst text = shape.text;\r\n\t\tconst textOutline = text.outline;\r\n\t\tconst textOutlineWidth = (textOutline.enable ? textOutline.width : 0);\r\n\t\tconst textWeight = text.weight;\r\n\t\tif( textWeight !== this.textWeight || textOutlineWidth !== this.textOutlineWidth ) {\r\n\t\t\tthis.textWeight = textWeight;\r\n\t\t\tthis.textOutlineWidth = textOutlineWidth;\r\n\r\n\t\t\tbuffer.updateSteps();\r\n\t\t\tbuildTextStep(\r\n\t\t\t\tbuffer.steps,\r\n\t\t\t\tthis.textVertexOffset,\r\n\t\t\t\tthis.textVertexCount,\r\n\t\t\t\ttext.atlas,\r\n\t\t\t\ttext.size,\r\n\t\t\t\ttextOutlineWidth,\r\n\t\t\t\ttextWeight,\r\n\t\t\t\tthis.antialiasWeight\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tbuildUnit( builder: EShapeBufferUnitBuilder ) {\r\n\t\tsuper.buildUnit( builder );\r\n\r\n\t\tif( 0 < this.textVertexCount ) {\r\n\t\t\tconst textTexture = this.textTexture || Texture.WHITE;\r\n\t\t\tconst textBaseTexture = textTexture.baseTexture;\r\n\t\t\tif( textBaseTexture !== builder.baseTexture ) {\r\n\t\t\t\tbuilder.baseTexture = textBaseTexture;\r\n\t\t\t\tbuilder.push( textTexture, this.textIndexOffset );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { buildBarClipping, buildBarIndex, buildBarUv, buildBarVertexStepAndColorFill } from \"./build-bar\";\r\nimport { EShapeBar } from \"./e-shape-bar\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport class EShapeBarUploaded extends EShapeTextUploaded {\r\n\tprotected pointsId: number;\r\n\tprotected pointsStyle: EShapePointsStyle;\r\n\r\n\tconstructor(\r\n\t\tbuffer: EShapeBuffer,\r\n\t\tvoffset: number, ioffset: number,\r\n\t\ttvcount: number, ticount: number,\r\n\t\tvcount: number, icount: number,\r\n\t\tantialiasWeight: number\r\n\t) {\r\n\t\tsuper( buffer, voffset, ioffset, tvcount, ticount, vcount, icount, antialiasWeight );\r\n\t\tthis.pointsId = NaN;\r\n\t\tthis.pointsStyle = EShapePointsStyle.NONE;\r\n\t}\r\n\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Clipping & indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tconst voffset = this.vertexOffset;\r\n\t\tconst ioffset = this.indexOffset;\r\n\t\tbuffer.updateClippings();\r\n\t\tbuffer.updateIndices();\r\n\t\tbuildBarClipping(\r\n\t\t\tbuffer.clippings,\r\n\t\t\tvoffset\r\n\t\t);\r\n\t\tbuildBarIndex(\r\n\t\t\tbuffer.indices,\r\n\t\t\tvoffset,\r\n\t\t\tioffset\r\n\t\t);\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\t//\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tthis.updateVertexStepAndColorFill( buffer, shape );\r\n\t\tthis.updateColor( buffer, shape );\r\n\t\tthis.updateUv( buffer, shape );\r\n\t\tthis.updateText( buffer, shape );\r\n\t}\r\n\r\n\tprotected updateVertexStepAndColorFill( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tif( shape instanceof EShapeBar ) {\r\n\t\t\tconst size = shape.size;\r\n\t\t\tconst sizeX = size.x;\r\n\t\t\tconst sizeY = size.y;\r\n\t\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\t\tconst stroke = shape.stroke;\r\n\t\t\tconst strokeWidth = ( stroke.enable ? stroke.width : 0 );\r\n\t\t\tconst isStrokeWidthChanged = ( strokeWidth !== this.strokeWidth );\r\n\r\n\t\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\t\tconst points = shape.points;\r\n\t\t\tconst pointsId = points.id;\r\n\t\t\tconst isPointsIdChanged = ( pointsId !== this.pointsId );\r\n\r\n\t\t\tconst pointsStyle = points.style;\r\n\t\t\tconst isPointsStyleChanged = ( pointsStyle !== this.pointsStyle );\r\n\r\n\t\t\tif( isSizeChanged || isTransformChanged || isStrokeWidthChanged || isPointsIdChanged || isPointsStyleChanged ) {\r\n\t\t\t\tthis.sizeX = sizeX;\r\n\t\t\t\tthis.sizeY = sizeY;\r\n\t\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\t\tthis.pointsId = pointsId;\r\n\t\t\t\tthis.pointsStyle = pointsStyle;\r\n\r\n\t\t\t\tif( isSizeChanged || isTransformChanged ) {\r\n\t\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t\t}\r\n\t\t\t\tif( isPointsIdChanged ) {\r\n\t\t\t\t\t// Invalidate the texture transform ID to update the UVs\r\n\t\t\t\t\tthis.textureTransformId = NaN;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbuffer.updateVertices();\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t\tbuffer.updateColorFills();\r\n\t\t\t\tbuildBarVertexStepAndColorFill(\r\n\t\t\t\t\tbuffer.vertices,\r\n\t\t\t\t\tbuffer.steps,\r\n\t\t\t\t\tbuffer.colorFills,\r\n\t\t\t\t\tthis.vertexOffset,\r\n\t\t\t\t\tpoints.values,\r\n\t\t\t\t\tpointsStyle,\r\n\t\t\t\t\tpoints.size,\r\n\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\tshape.transform.internalTransform\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateColorFillAndStroke( buffer: EShapeBuffer, shape: EShape, vertexCount: number ): void {\r\n\t\tthis.updateColorStroke( buffer, shape, vertexCount );\r\n\t}\r\n\r\n\tprotected updateUv( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tif( texture !== this.texture || textureTransformId !== this.textureTransformId ) {\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tbuildBarUv(\r\n\t\t\t\tbuffer.uvs,\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\tthis.toTextureUvs( texture )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","import { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { BAR_INDEX_COUNT, BAR_VERTEX_COUNT } from \"./build-bar\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\nimport { EShapeBarUploaded } from \"./e-shape-bar-uploaded\";\r\n\r\nexport const createBarUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeBarUploaded | null => {\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst vcount = BAR_VERTEX_COUNT + tvcount;\r\n\tconst icount = BAR_INDEX_COUNT + ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new EShapeBarUploaded(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const isArray = Array.isArray || (( target: any ): target is unknown[] => {\r\n\treturn Object.prototype.toString.call( target ) === \"[object Array]\";\r\n});\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const isNumber = ( target: unknown ): target is number => {\r\n\treturn ( typeof target === \"number\" ) ||\r\n\t\t( Object.prototype.toString.call( target ) === \"[object Number]\" );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeFillLike } from \"../e-shape-fill\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeStrokeLike } from \"../e-shape-stroke\";\r\nimport { EShapeTextLike } from \"../e-shape-text\";\r\nimport { EShapeTextOutlineLike } from \"../e-shape-text-outline\";\r\n\r\nexport class EShapeActionBases {\r\n\tstatic toBaseFill( shape: EShape, runtime: EShapeRuntime ): EShapeFillLike {\r\n\t\treturn ( runtime.written & EShapeRuntimeReset.COLOR_FILL ? shape : runtime ).fill;\r\n\t}\r\n\r\n\tstatic toBaseStroke( shape: EShape, runtime: EShapeRuntime ): EShapeStrokeLike {\r\n\t\treturn ( runtime.written & EShapeRuntimeReset.COLOR_STROKE ? shape : runtime ).stroke;\r\n\t}\r\n\r\n\tstatic toBaseText( shape: EShape, runtime: EShapeRuntime ): EShapeTextLike {\r\n\t\treturn ( runtime.written & EShapeRuntimeReset.COLOR_TEXT ? shape : runtime ).text;\r\n\t}\r\n\r\n\tstatic toBaseTextOutline( shape: EShape, runtime: EShapeRuntime ): EShapeTextOutlineLike {\r\n\t\treturn ( runtime.written & EShapeRuntimeReset.COLOR_TEXT_OUTLINE ? shape : runtime ).text.outline;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const isFunction = ( target: unknown ): target is Function => {\r\n\treturn (typeof target) === \"function\";\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBackgroundStateAware } from \"./d-background\";\r\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { isFunction } from \"./util/is-function\";\r\n\r\ntype Callback = () => void;\r\n\r\nexport class DBaseBackground implements DBackgroundStateAware {\r\n\tprotected _theme: DThemeBase;\r\n\tprotected _color?: DStateAwareOrValueMightBe<number | null>;\r\n\tprotected _alpha?: DStateAwareOrValueMightBe<number>;\r\n\tprotected _callback: Callback | undefined;\r\n\r\n\tconstructor( theme: DThemeBase, options?: DBaseOptions<any>, callback?: Callback ) {\r\n\t\tthis._theme = theme;\r\n\t\tthis._callback = callback;\r\n\t\tif( options != null && options.background != null ) {\r\n\t\t\tconst background = options.background;\r\n\t\t\tthis._color = background.color;\r\n\t\t\tthis._alpha = background.alpha;\r\n\t\t}\r\n\t}\r\n\r\n\tgetTheme(): DThemeBase {\r\n\t\treturn this._theme;\r\n\t}\r\n\r\n\tsetTheme( theme: DThemeBase ): void {\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tgetColor( state: DBaseState ): number | null {\r\n\t\tconst color = this._color;\r\n\t\tif( color !== undefined ) {\r\n\t\t\tif( isFunction( color ) ) {\r\n\t\t\t\tconst result = color( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn color;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getBackgroundColor( state );\r\n\t}\r\n\r\n\tget color(): DStateAwareOrValueMightBe<number | null> {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: DStateAwareOrValueMightBe<number | null> ) {\r\n\t\tif( this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tgetAlpha( state: DBaseState ): number {\r\n\t\tconst alpha = this._alpha;\r\n\t\tif( alpha !== undefined ) {\r\n\t\t\tif( isFunction( alpha ) ) {\r\n\t\t\t\tconst result = alpha( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getBackgroundAlpha( state );\r\n\t}\r\n\r\n\tget alpha(): DStateAwareOrValueMightBe<number> {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: DStateAwareOrValueMightBe<number> ) {\r\n\t\tif( this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onChange(): void {\r\n\t\tconst callback = this._callback;\r\n\t\tif( callback != null ) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DBorderStateAware } from \"./d-border\";\r\nimport { DBorderMask } from \"./d-border-mask\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { isFunction } from \"./util/is-function\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\ntype Callback = () => void;\r\n\r\nexport class DBaseBorder implements DBorderStateAware {\r\n\tprotected _theme: DThemeBase;\r\n\tprotected _color?: DStateAwareOrValueMightBe<number | null>;\r\n\tprotected _alpha?: DStateAwareOrValueMightBe<number>;\r\n\tprotected _width?: DStateAwareOrValueMightBe<number>;\r\n\tprotected _align?: DStateAwareOrValueMightBe<number>;\r\n\tprotected _mask?: DStateAwareOrValueMightBe<DBorderMask>;\r\n\tprotected _callback: Callback | undefined;\r\n\r\n\tconstructor( theme: DThemeBase, options?: DBaseOptions<any>, callback?: Callback ) {\r\n\t\tthis._theme = theme;\r\n\t\tthis._callback = callback;\r\n\t\tif( options != null && options.border != null ) {\r\n\t\t\tconst border = options.border;\r\n\t\t\tthis._color = border.color;\r\n\t\t\tthis._alpha = border.alpha;\r\n\t\t\tthis._width = border.width;\r\n\t\t\tthis._align = border.align;\r\n\t\t\tthis._mask = ( isString( border.mask ) ? DBorderMask[ border.mask ] : border.mask );\r\n\t\t}\r\n\t}\r\n\r\n\tgetTheme(): DThemeBase {\r\n\t\treturn this._theme;\r\n\t}\r\n\r\n\tsetTheme( theme: DThemeBase ): void {\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tgetColor( state: DBaseState ): number | null {\r\n\t\tconst color = this._color;\r\n\t\tif( color !== undefined ) {\r\n\t\t\tif( isFunction( color ) ) {\r\n\t\t\t\tconst result = color( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn color;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getBorderColor( state );\r\n\t}\r\n\r\n\tget color(): DStateAwareOrValueMightBe<number | null> {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: DStateAwareOrValueMightBe<number | null> ) {\r\n\t\tif( this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tgetAlpha( state: DBaseState ): number {\r\n\t\tconst alpha = this._alpha;\r\n\t\tif( alpha !== undefined ) {\r\n\t\t\tif( isFunction( alpha ) ) {\r\n\t\t\t\tconst result = alpha( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getBorderAlpha( state );\r\n\t}\r\n\r\n\tget alpha(): DStateAwareOrValueMightBe<number> {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: DStateAwareOrValueMightBe<number> ) {\r\n\t\tif( this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tgetWidth( state: DBaseState ): number {\r\n\t\tconst width = this._width;\r\n\t\tif( width !== undefined ) {\r\n\t\t\tif( isFunction( width ) ) {\r\n\t\t\t\tconst result = width( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn width;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getBorderWidth( state );\r\n\t}\r\n\r\n\tget width(): DStateAwareOrValueMightBe<number> {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width( width: DStateAwareOrValueMightBe<number> ) {\r\n\t\tif( this._width !== width ) {\r\n\t\t\tthis._width = width;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tgetAlign( state: DBaseState ): number {\r\n\t\tconst align = this._align;\r\n\t\tif( align !== undefined ) {\r\n\t\t\tif( isFunction( align ) ) {\r\n\t\t\t\tconst result = align( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn align;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getBorderAlign( state );\r\n\t}\r\n\r\n\tget align(): DStateAwareOrValueMightBe<number> {\r\n\t\treturn this._align;\r\n\t}\r\n\r\n\tset align( align: DStateAwareOrValueMightBe<number> ) {\r\n\t\tif( this._align !== align ) {\r\n\t\t\tthis._align = align;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tgetMask( state: DBaseState ): number {\r\n\t\tconst mask = this._mask;\r\n\t\tif( mask !== undefined ) {\r\n\t\t\tif( isFunction( mask ) ) {\r\n\t\t\t\tconst result = mask( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn mask;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getBorderMask( state );\r\n\t}\r\n\r\n\tget mask(): DStateAwareOrValueMightBe<DBorderMask> {\r\n\t\treturn this._mask;\r\n\t}\r\n\r\n\tset mask( mask: DStateAwareOrValueMightBe<DBorderMask> ) {\r\n\t\tif( this._mask !== mask ) {\r\n\t\t\tthis._mask = mask;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onChange(): void {\r\n\t\tconst callback = this._callback;\r\n\t\tif( callback != null ) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DCornerMask {\r\n\tNONE = 0,\r\n\tTOP_LEFT = 1,\r\n\tTOP_RIGHT = 2,\r\n\tBOTTOM_LEFT = 4,\r\n\tBOTTOM_RIGHT = 8,\r\n\tTOP = TOP_LEFT | TOP_RIGHT,\r\n\tBOTTOM = BOTTOM_LEFT | BOTTOM_RIGHT,\r\n\tLEFT = TOP_LEFT | BOTTOM_LEFT,\r\n\tRIGHT = TOP_RIGHT | BOTTOM_RIGHT,\r\n\tALL = TOP_LEFT | TOP_RIGHT | BOTTOM_LEFT | BOTTOM_RIGHT\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DCorner } from \"./d-corner\";\r\nimport { DCornerMask } from \"./d-corner-mask\";\r\nimport { isNumber } from \"./util/is-number\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\ntype Callback = () => void;\r\n\r\nexport class DBaseCorner implements DCorner {\r\n\tprotected _theme: DThemeBase;\r\n\tprotected _radius?: number;\r\n\tprotected _mask?: DCornerMask;\r\n\tprotected _callback: Callback | undefined;\r\n\r\n\tconstructor( theme: DThemeBase, options?: DBaseOptions<any>, callback?: () => void ) {\r\n\t\tthis._theme = theme;\r\n\t\tthis._callback = callback;\r\n\t\tif( options != null && options.corner != null ) {\r\n\t\t\tconst corner = options.corner;\r\n\t\t\tif( isNumber( corner ) ) {\r\n\t\t\t\tthis._radius = corner;\r\n\t\t\t\tthis._mask = undefined;\r\n\t\t\t} else {\r\n\t\t\t\tthis._radius = corner.radius;\r\n\t\t\t\tthis._mask = ( isString( corner.mask ) ? DCornerMask[ corner.mask ] : corner.mask );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetTheme(): DThemeBase {\r\n\t\treturn this._theme;\r\n\t}\r\n\r\n\tsetTheme( theme: DThemeBase ): void {\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tgetRadius(): number {\r\n\t\tconst radius = this._radius;\r\n\t\treturn ( radius !== undefined ? radius : this._theme.getCornerRadius() );\r\n\t}\r\n\r\n\tget radius(): number | undefined {\r\n\t\treturn this._radius;\r\n\t}\r\n\r\n\tset radius( radius: number | undefined ) {\r\n\t\tif( this._radius !== radius ) {\r\n\t\t\tthis._radius = radius;\r\n\t\t\tconst callback = this._callback;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetMask(): DCornerMask {\r\n\t\tconst mask = this._mask;\r\n\t\treturn ( mask !== undefined ? mask : this._theme.getCornerMask() );\r\n\t}\r\n\r\n\tget mask(): DCornerMask | undefined {\r\n\t\treturn this._mask;\r\n\t}\r\n\r\n\tset mask( mask: DCornerMask | undefined ) {\r\n\t\tif( this._mask !== mask ) {\r\n\t\t\tthis._mask = mask;\r\n\t\t\tconst callback = this._callback;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tset( radius?: number, mask?: DCornerMask ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( this._radius !== radius ) {\r\n\t\t\tthis._radius = radius;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tif( this._mask !== mask ) {\r\n\t\t\tthis._mask = mask;\r\n\t\t\tisChanged = true;\r\n\t\t}\r\n\r\n\t\tconst callback = this._callback;\r\n\t\tif( isChanged && callback != null ) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * DBase interactivity.\r\n * Mouse / touch events are triggered only on interactive objects.\r\n */\r\nexport enum DBaseInteractive {\r\n\t/**\r\n\t * Not interactive.\r\n\t */\r\n\tNONE = 0,\r\n\r\n\t/**\r\n\t * Interactive.\r\n\t * However children are not interactive.\r\n\t */\r\n\tSELF = 1,\r\n\r\n\t/**\r\n\t * Not interactive.\r\n\t * However children are interactive.\r\n\t */\r\n\tCHILDREN = 2,\r\n\r\n\t/**\r\n\t * Interactive.\r\n\t * Children are also interactive.\r\n\t */\r\n\tBOTH = SELF | CHILDREN\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DBorderMask } from \"./d-border-mask\";\r\nimport { DOutline } from \"./d-outline\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { isFunction } from \"./util/is-function\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\ntype Callback = () => void;\r\n\r\nexport class DBaseOutline implements DOutline {\r\n\tprotected _theme: DThemeBase;\r\n\tprotected _color?: DStateAwareOrValueMightBe<number | null>;\r\n\tprotected _alpha?: DStateAwareOrValueMightBe<number>;\r\n\tprotected _width?: DStateAwareOrValueMightBe<number>;\r\n\tprotected _offset?: DStateAwareOrValueMightBe<number>;\r\n\tprotected _align?: DStateAwareOrValueMightBe<number>;\r\n\tprotected _mask?: DStateAwareOrValueMightBe<DBorderMask>;\r\n\tprotected _callback: Callback | undefined;\r\n\r\n\tconstructor( theme: DThemeBase, options?: DBaseOptions<any>, callback?: Callback ) {\r\n\t\tthis._theme = theme;\r\n\t\tthis._callback = callback;\r\n\t\tif( options != null && options.outline != null ) {\r\n\t\t\tconst outline = options.outline;\r\n\t\t\tthis._color = outline.color;\r\n\t\t\tthis._alpha = outline.alpha;\r\n\t\t\tthis._width = outline.width;\r\n\t\t\tthis._offset = outline.offset;\r\n\t\t\tthis._align = outline.align;\r\n\t\t\tthis._mask = ( isString( outline.mask ) ? DBorderMask[ outline.mask ] : outline.mask );\r\n\t\t}\r\n\t}\r\n\r\n\tgetTheme(): DThemeBase {\r\n\t\treturn this._theme;\r\n\t}\r\n\r\n\tsetTheme( theme: DThemeBase ): void {\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tgetColor( state: DBaseState ): number | null {\r\n\t\tconst color = this._color;\r\n\t\tif( color !== undefined ) {\r\n\t\t\tif( isFunction( color ) ) {\r\n\t\t\t\tconst result = color( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn color;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getOutlineColor( state );\r\n\t}\r\n\r\n\tget color(): DStateAwareOrValueMightBe<number | null> {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: DStateAwareOrValueMightBe<number | null> ) {\r\n\t\tif( this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tconst callback = this._callback;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetAlpha( state: DBaseState ): number {\r\n\t\tconst alpha = this._alpha;\r\n\t\tif( alpha !== undefined ) {\r\n\t\t\tif( isFunction( alpha ) ) {\r\n\t\t\t\tconst result = alpha( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getOutlineAlpha( state );\r\n\t}\r\n\r\n\tget alpha(): DStateAwareOrValueMightBe<number> {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: DStateAwareOrValueMightBe<number> ) {\r\n\t\tif( this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tconst callback = this._callback;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetWidth( state: DBaseState ): number {\r\n\t\tconst width = this._width;\r\n\t\tif( width !== undefined ) {\r\n\t\t\tif( isFunction( width ) ) {\r\n\t\t\t\tconst result = width( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn width;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getOutlineWidth( state );\r\n\t}\r\n\r\n\tget width(): DStateAwareOrValueMightBe<number> {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width( width: DStateAwareOrValueMightBe<number> ) {\r\n\t\tif( this._width !== width ) {\r\n\t\t\tthis._width = width;\r\n\t\t\tconst callback = this._callback;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetOffset( state: DBaseState ): number {\r\n\t\tconst offset = this._offset;\r\n\t\tif( offset !== undefined ) {\r\n\t\t\tif( isFunction( offset ) ) {\r\n\t\t\t\tconst result = offset( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn offset;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getOutlineOffset( state );\r\n\t}\r\n\r\n\tget offset(): DStateAwareOrValueMightBe<number> {\r\n\t\treturn this._offset;\r\n\t}\r\n\r\n\tset offset( offset: DStateAwareOrValueMightBe<number> ) {\r\n\t\tif( this._offset !== offset ) {\r\n\t\t\tthis._offset = offset;\r\n\t\t\tconst callback = this._callback;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetAlign( state: DBaseState ): number {\r\n\t\tconst align = this._align;\r\n\t\tif( align !== undefined ) {\r\n\t\t\tif( isFunction( align ) ) {\r\n\t\t\t\tconst result = align( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn align;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getOutlineAlign( state );\r\n\t}\r\n\r\n\tget align(): DStateAwareOrValueMightBe<number> {\r\n\t\treturn this._align;\r\n\t}\r\n\r\n\tset align( align: DStateAwareOrValueMightBe<number> ) {\r\n\t\tif( this._align !== align ) {\r\n\t\t\tthis._align = align;\r\n\t\t\tconst callback = this._callback;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetMask( state: DBaseState ): number {\r\n\t\tconst mask = this._mask;\r\n\t\tif( mask !== undefined ) {\r\n\t\t\tif( isFunction( mask ) ) {\r\n\t\t\t\tconst result = mask( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn mask;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getOutlineMask( state );\r\n\t}\r\n\r\n\tget mask(): DStateAwareOrValueMightBe<DBorderMask> {\r\n\t\treturn this._mask;\r\n\t}\r\n\r\n\tset mask( mask: DStateAwareOrValueMightBe<DBorderMask> ) {\r\n\t\tif( this._mask !== mask ) {\r\n\t\t\tthis._mask = mask;\r\n\t\t\tconst callback = this._callback;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DLayoutClearType {\r\n\tNONE = 0,\r\n\tBEFORE = 1,\r\n\tAFTER = 2,\r\n\tBOTH = BEFORE | AFTER\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DScalar } from \"./d-scalar\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\nconst enum NodeType {\r\n\t// Parensesis\r\n\tOPEN,\r\n\tCLOSE,\r\n\tPARENSESIS,\r\n\r\n\t// Operations\r\n\tADD_OR_PLUS,\r\n\tSUB_OR_MINUS,\r\n\r\n\tPLUS,\r\n\tMINUS,\r\n\r\n\tADD,\r\n\tSUB,\r\n\tMUL,\r\n\tDIV,\r\n\r\n\t// Functions\r\n\tMIN,\r\n\tMAX,\r\n\tCOMMA,\r\n\r\n\t// Literals\r\n\tPARENT,\r\n\tSELF,\r\n\tPADDING,\r\n\tCURRENT,\r\n\tNUMBER\r\n}\r\n\r\ntype NodeTypeOperator = NodeType.SUB_OR_MINUS | NodeType.ADD_OR_PLUS |\r\n\tNodeType.SUB | NodeType.ADD | NodeType.MUL | NodeType.DIV |\r\n\tNodeType.OPEN | NodeType.CLOSE |\r\n\tNodeType.MIN | NodeType.MAX | NodeType.COMMA;\r\ntype NodeTypeLiteral = NodeType.NUMBER | NodeType.PARENT | NodeType.SELF | NodeType.PADDING | NodeType.CURRENT;\r\ntype Token = NodeTypeOperator | [ NodeTypeLiteral, number ];\r\n\r\ninterface NodeOrTokenParensesis {\r\n\t[ 0 ]: NodeType.PARENSESIS;\r\n\t[ 1 ]: NodeOrToken[];\r\n}\r\n\r\ninterface NodeOrTokenUnary {\r\n\t[ 0 ]: NodeType.PLUS | NodeType.MINUS;\r\n\t[ 1 ]: NodeOrToken;\r\n}\r\n\r\ntype NodeArithmeticOperator = NodeType.SUB | NodeType.ADD | NodeType.MUL | NodeType.DIV;\r\n\r\ninterface NodeOrTokenArithmetic {\r\n\t[ 0 ]: NodeArithmeticOperator;\r\n\t[ 1 ]: NodeOrToken;\r\n\t[ 2 ]: NodeOrToken;\r\n}\r\n\r\ninterface NodeOrTokenFunction {\r\n\t[ 0 ]: NodeType.MIN | NodeType.MAX;\r\n\t[ 1 ]: NodeOrToken[];\r\n}\r\n\r\ntype NodeOrToken = Token | NodeOrTokenParensesis | NodeOrTokenUnary | NodeOrTokenArithmetic | NodeOrTokenFunction;\r\n\r\ninterface NodeLiteral {\r\n\t[ 0 ]: NodeTypeLiteral;\r\n\t[ 1 ]: number;\r\n}\r\n\r\ninterface NodeParensesis {\r\n\t[ 0 ]: NodeType.PARENSESIS;\r\n\t[ 1 ]: Node[];\r\n}\r\n\r\ninterface NodeUnary {\r\n\t[ 0 ]: NodeType.PLUS | NodeType.MINUS;\r\n\t[ 1 ]: Node;\r\n}\r\n\r\ninterface NodeArithmetic {\r\n\t[ 0 ]: NodeArithmeticOperator;\r\n\t[ 1 ]: Node;\r\n\t[ 2 ]: Node;\r\n}\r\n\r\ninterface NodeFunction {\r\n\t[ 0 ]: NodeType.MIN | NodeType.MAX;\r\n\t[ 1 ]: Node[];\r\n}\r\n\r\ntype Node = NodeParensesis | NodeUnary | NodeArithmetic | NodeFunction | NodeLiteral;\r\n\r\nconst TOKEN_MAPPING_OPERATOR: { [ token: string ]: NodeTypeOperator | undefined } = {\r\n\t\"+\": NodeType.ADD_OR_PLUS,\r\n\t\"-\": NodeType.SUB_OR_MINUS,\r\n\t\"*\": NodeType.MUL,\r\n\t\"/\": NodeType.DIV,\r\n\t\"(\": NodeType.OPEN,\r\n\t\")\": NodeType.CLOSE,\r\n\t\",\": NodeType.COMMA,\r\n\t\"min\": NodeType.MIN,\r\n\t\"max\": NodeType.MAX\r\n};\r\n\r\nconst TOKEN_MAPPING_LITERAL: { [ token: string ]: NodeTypeLiteral | undefined } = {\r\n\t\"%\": NodeType.PARENT,\r\n\t\"s\": NodeType.SELF,\r\n\t\"p\": NodeType.PADDING,\r\n\t\"c\": NodeType.CURRENT\r\n};\r\n\r\n/**\r\n * Parser and evaluator of the scalar expressions like `100% - 50s`.\r\n *\r\n * Literals\r\n *\r\n * * x%: 0.01 * x * parent value\r\n * * xs: 0.01 * x * self value\r\n * * xp: 0.01 * x * padding value\r\n * * xc: 0.01 * x * current value\r\n *\r\n * Operators\r\n *\r\n * * `+`\r\n * * `-`\r\n * * `*`\r\n * * `/`\r\n * * `(` and `)`\r\n *\r\n * Functions\r\n *\r\n * * min( a, b, ... )\r\n * * max( a, b, ... )\r\n *\r\n * Examples\r\n *\r\n * * `90%`: 0.9 * parent value\r\n * * `50s`: 0.5 * self value\r\n * * `90% - 50s`: 0.9 * parent value - 0.5 * self value\r\n * * `90% - (50s + 100) * 2`: 0.9 * parent value - ( 0.5 * self value + 100 ) * 2\r\n */\r\nexport class DScalarExpression implements DScalar {\r\n\tprotected static TOKEN_REGEX = /(?:\\+|-|\\*|\\/|\\(|\\)|min|max|,|(?:\\d+(?:\\.\\d*)?[%psc]?))/g;\r\n\tprotected _node: Node;\r\n\r\n\tconstructor( expression: string ) {\r\n\t\tconst nodes: NodeOrToken[] = this.toToken( expression );\r\n\t\tlet i = 0;\r\n\t\tdo {\r\n\t\t\ti = this.toParensesis( nodes, i );\r\n\t\t} while( i < nodes.length );\r\n\t\tthis.toUnary( nodes );\r\n\t\tthis.toArithmetic( nodes, NodeType.MUL, NodeType.DIV );\r\n\t\tthis.toArithmetic( nodes, NodeType.ADD, NodeType.SUB );\r\n\t\tif( nodes.length === 1 ) {\r\n\t\t\tconst node = nodes[ 0 ];\r\n\t\t\tif( ! isNumber( node ) ) {\r\n\t\t\t\tthis._node = node as any;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow new Error( `Failed to parse '${expression}'` );\r\n\t}\r\n\r\n\ttoParensesis( nodes: NodeOrToken[], ifrom: number ): number {\r\n\t\tlet ito = nodes.length;\r\n\t\tfor( let i = ifrom; i < ito; ++i ) {\r\n\t\t\tconst inode = nodes[ i ];\r\n\t\t\tif( inode === NodeType.OPEN ) {\r\n\t\t\t\tlet istart = i;\r\n\t\t\t\tlet nodeType = NodeType.PARENSESIS;\r\n\t\t\t\tif( 0 < i ) {\r\n\t\t\t\t\tconst nodeTypePrev = nodes[ i - 1 ];\r\n\t\t\t\t\tif( nodeTypePrev === NodeType.MIN || nodeTypePrev === NodeType.MAX ) {\r\n\t\t\t\t\t\tistart -= 1;\r\n\t\t\t\t\t\tnodeType = nodeTypePrev;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor( let j = i + 1; j < ito; ++j ) {\r\n\t\t\t\t\tconst jnode = nodes[ j ];\r\n\t\t\t\t\tif( jnode === NodeType.CLOSE ) {\r\n\t\t\t\t\t\tnodes[ istart ] = [ nodeType, this.toComma( nodes, i + 1, j ) ];\r\n\t\t\t\t\t\tnodes.splice( istart + 1, j - istart );\r\n\t\t\t\t\t\treturn istart + 1;\r\n\t\t\t\t\t} else if( jnode === NodeType.OPEN ) {\r\n\t\t\t\t\t\tj = this.toParensesis( nodes, j ) - 1;\r\n\t\t\t\t\t\tito = nodes.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthrow new Error( `Malformed parensesis` );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ito;\r\n\t}\r\n\r\n\ttoCommaOf( nodes: NodeOrToken[], ifrom: number, ito: number ): NodeOrToken {\r\n\t\tconst l = ito - ifrom;\r\n\t\tif( l <= 0 ) {\r\n\t\t\treturn [ NodeType.NUMBER, 0 ];\r\n\t\t} else if( l <= 1 ) {\r\n\t\t\treturn nodes[ ifrom ];\r\n\t\t} else {\r\n\t\t\tconst operand: NodeOrToken[] = [];\r\n\t\t\tfor( let j = ifrom; j < ito; ++j ) {\r\n\t\t\t\toperand.push( nodes[ j ] );\r\n\t\t\t}\r\n\t\t\treturn [ NodeType.PARENSESIS, operand ];\r\n\t\t}\r\n\t}\r\n\r\n\ttoComma( nodes: NodeOrToken[], ifrom: number, ito: number ): NodeOrToken[] {\r\n\t\tlet result: NodeOrToken[] | null = null;\r\n\t\tlet iprev = ifrom;\r\n\t\tfor( let i = ifrom; i < ito; ++i ) {\r\n\t\t\tconst node = nodes[ i ];\r\n\t\t\tif( node === NodeType.COMMA ) {\r\n\t\t\t\tresult = result || [];\r\n\t\t\t\tresult.push( this.toCommaOf( nodes, iprev, i ) );\r\n\t\t\t\tiprev = i + 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( iprev < ito ) {\r\n\t\t\tif( result == null ) {\r\n\t\t\t\tconst operand: NodeOrToken[] = [];\r\n\t\t\t\tfor( let i = iprev; i < ito; ++i ) {\r\n\t\t\t\t\toperand.push( nodes[ i ] );\r\n\t\t\t\t}\r\n\t\t\t\treturn operand;\r\n\t\t\t} else {\r\n\t\t\t\tresult.push( this.toCommaOf( nodes, iprev, ito ) );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result || [];\r\n\t}\r\n\r\n\ttoUnaryNode( node: NodeOrToken ): void {\r\n\t\tif( ! isNumber( node ) ) {\r\n\t\t\tif( node[ 0 ] === NodeType.PARENSESIS ||\r\n\t\t\t\tnode[ 0 ] === NodeType.MIN ||\r\n\t\t\t\tnode[ 0 ] === NodeType.MAX ) {\r\n\t\t\t\tthis.toUnary( node[ 1 ] );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoUnary( nodes: NodeOrToken[] ): void {\r\n\t\tfor( let i = 0, imax = nodes.length; i < imax; ++i ) {\r\n\t\t\tconst node = nodes[ i ];\r\n\t\t\tif( node === NodeType.ADD_OR_PLUS || node === NodeType.SUB_OR_MINUS ) {\r\n\t\t\t\tif( i <= 0 || isNumber( nodes[ i - 1 ] ) ) {\r\n\t\t\t\t\tif( i + 1 < imax && ! isNumber( nodes[ i + 1 ] ) ) {\r\n\t\t\t\t\t\tconst operand = nodes.splice( i + 1, 1 )[ 0 ];\r\n\t\t\t\t\t\tconst type = ( node === NodeType.ADD_OR_PLUS ? NodeType.PLUS : NodeType.MINUS );\r\n\t\t\t\t\t\tnodes[ i ] = [ type, operand ];\r\n\t\t\t\t\t\timax = nodes.length;\r\n\t\t\t\t\t\tthis.toUnaryNode( operand );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error( \"Malformed unary operator\" );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst type = ( node === NodeType.ADD_OR_PLUS ? NodeType.ADD : NodeType.SUB );\r\n\t\t\t\t\tnodes[ i ] = type;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.toUnaryNode( node );\r\n\t\t\t\timax = nodes.length;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoArithmeticNode( node: NodeOrToken, operatorA: NodeArithmeticOperator, operatorB: NodeArithmeticOperator ): void {\r\n\t\tif( ! isNumber( node ) ) {\r\n\t\t\tif( node[ 0 ] === NodeType.PARENSESIS || node[ 0 ] === NodeType.MIN || node[ 0 ] === NodeType.MAX ) {\r\n\t\t\t\tthis.toArithmetic( node[ 1 ], operatorA, operatorB );\r\n\t\t\t} else if( node[ 0 ] === NodeType.PLUS || node[ 0 ] === NodeType.MINUS ) {\r\n\t\t\t\tthis.toArithmeticNode( node[ 1 ], operatorA, operatorB );\r\n\t\t\t} else if( node[ 0 ] === NodeType.ADD || node[ 0 ] === NodeType.SUB ||\r\n\t\t\t\tnode[ 0 ] === NodeType.MUL || node[ 0 ] === NodeType.DIV ) {\r\n\t\t\t\tthis.toArithmeticNode( node[ 1 ], operatorA, operatorB );\r\n\t\t\t\tthis.toArithmeticNode( node[ 2 ], operatorA, operatorB );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoArithmetic( nodes: NodeOrToken[], operatorA: NodeArithmeticOperator, operatorB: NodeArithmeticOperator ): void {\r\n\t\tfor( let i = 0, imax = nodes.length; i < imax; ++i ) {\r\n\t\t\tconst node = nodes[ i ];\r\n\t\t\tif( node === operatorA || node === operatorB ) {\r\n\t\t\t\tif( 0 < i && i + 1 < imax ) {\r\n\t\t\t\t\tconst left = nodes[ i - 1 ];\r\n\t\t\t\t\tconst right = nodes[ i + 1 ];\r\n\t\t\t\t\tif( ! isNumber( left ) && ! isNumber( right ) ) {\r\n\t\t\t\t\t\tnodes.splice( i, 2 );\r\n\t\t\t\t\t\tnodes[ i - 1 ] = [ node, left, right ];\r\n\t\t\t\t\t\ti -= 1;\r\n\t\t\t\t\t\timax = nodes.length;\r\n\t\t\t\t\t\tthis.toArithmeticNode( left, operatorA, operatorB );\r\n\t\t\t\t\t\tthis.toArithmeticNode( right, operatorA, operatorB );\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthrow new Error( `Malformed operands for the operator ${node}` );\r\n\t\t\t} else {\r\n\t\t\t\tthis.toArithmeticNode( node, operatorA, operatorB );\r\n\t\t\t\timax = nodes.length;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoToken( expression: string ): Token[] {\r\n\t\tconst tokens: Token[] = [];\r\n\t\twhile( true ) {\r\n\t\t\tconst matched = DScalarExpression.TOKEN_REGEX.exec( expression );\r\n\t\t\tif( matched != null ) {\r\n\t\t\t\tconst token = matched[ 0 ];\r\n\t\t\t\tconst tokenTypeOperator = TOKEN_MAPPING_OPERATOR[ token ];\r\n\t\t\t\tif( tokenTypeOperator != null ) {\r\n\t\t\t\t\ttokens.push( tokenTypeOperator );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst parsedToken = parseFloat( token );\r\n\t\t\t\t\tif( parsedToken !== parsedToken ) {\r\n\t\t\t\t\t\tthrow new Error( `Unexpected token '${token}' at ${matched.index} in '${expression}'` );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst tokenTypeLiteral = TOKEN_MAPPING_LITERAL[ token[ token.length - 1 ] ];\r\n\t\t\t\t\tif( tokenTypeLiteral != null ) {\r\n\t\t\t\t\t\ttokens.push([ tokenTypeLiteral, parsedToken * 0.01 ]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttokens.push([ NodeType.NUMBER, parsedToken ]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn tokens;\r\n\t}\r\n\r\n\tprotected evaluate( node: Node, parent: number, self: number, padding: number, current: number ): number {\r\n\t\tswitch( node[ 0 ] ) {\r\n\t\tcase NodeType.PARENSESIS:\r\n\t\t\tconst nodes = node[ 1 ];\r\n\t\t\treturn this.evaluate( nodes[ nodes.length - 1 ], parent, self, padding, current );\r\n\r\n\t\t// Unary operators\r\n\t\tcase NodeType.PLUS:\r\n\t\t\treturn + this.evaluate( node[ 1 ], parent, self, padding, current );\r\n\r\n\t\tcase NodeType.MINUS:\r\n\t\t\treturn - this.evaluate( node[ 1 ], parent, self, padding, current );\r\n\r\n\t\t// Four arithmetic operators\r\n\t\tcase NodeType.ADD:\r\n\t\t\treturn this.evaluate( node[ 1 ], parent, self, padding, current ) +\r\n\t\t\t\tthis.evaluate( node[ 2 ], parent, self, padding, current );\r\n\t\tcase NodeType.SUB:\r\n\t\t\treturn this.evaluate( node[ 1 ], parent, self, padding, current ) -\r\n\t\t\t\tthis.evaluate( node[ 2 ], parent, self, padding, current );\r\n\t\tcase NodeType.MUL:\r\n\t\t\treturn this.evaluate( node[ 1 ], parent, self, padding, current ) *\r\n\t\t\t\tthis.evaluate( node[ 2 ], parent, self, padding, current );\r\n\t\tcase NodeType.DIV:\r\n\t\t\treturn this.evaluate( node[ 1 ], parent, self, padding, current ) /\r\n\t\t\t\tthis.evaluate( node[ 2 ], parent, self, padding, current );\r\n\r\n\t\t// Functions\r\n\t\tcase NodeType.MIN:\r\n\t\t\tif( 0 < node[ 1 ].length ) {\r\n\t\t\t\tconst args = node[ 1 ];\r\n\t\t\t\tlet result = this.evaluate( args[ 0 ], parent, self, padding, current );\r\n\t\t\t\tfor( let i = 1, imax = args.length; i < imax; ++i ) {\r\n\t\t\t\t\tresult = Math.min( result, this.evaluate( args[ i ], parent, self, padding, current ) );\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\tcase NodeType.MAX:\r\n\t\t\tif( 0 < node[ 1 ].length ) {\r\n\t\t\t\tconst args = node[ 1 ];\r\n\t\t\t\tlet result = this.evaluate( args[ 0 ], parent, self, padding, current );\r\n\t\t\t\tfor( let i = 1, imax = args.length; i < imax; ++i ) {\r\n\t\t\t\t\tresult = Math.max( result, this.evaluate( args[ i ], parent, self, padding, current ) );\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\r\n\t\t// Literals\r\n\t\tcase NodeType.PARENT:\r\n\t\t\treturn node[ 1 ] * parent;\r\n\t\tcase NodeType.SELF:\r\n\t\t\treturn node[ 1 ] * self;\r\n\t\tcase NodeType.PADDING:\r\n\t\t\treturn node[ 1 ] * padding;\r\n\t\tcase NodeType.CURRENT:\r\n\t\t\treturn node[ 1 ] * current;\r\n\t\tcase NodeType.NUMBER:\r\n\t\t\treturn node[ 1 ];\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tcalculate( parent: number, self: number, padding: number, current: number ): number {\r\n\t\treturn this.evaluate( this._node, parent, self, padding, current );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DPadding } from \"./d-padding\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\ntype Callback = () => void;\r\n\r\nexport class DBasePadding implements DPadding {\r\n\tprotected _theme: DThemeBase;\r\n\tprotected _left?: number;\r\n\tprotected _top?: number;\r\n\tprotected _right?: number;\r\n\tprotected _bottom?: number;\r\n\tprotected _callback: Callback | undefined;\r\n\r\n\tconstructor( theme: DThemeBase, options?: DBaseOptions<any>, callback?: () => void ) {\r\n\t\tthis._theme = theme;\r\n\t\tthis._callback = callback;\r\n\r\n\t\tif( options != null && options.padding != null ) {\r\n\t\t\tconst padding = options.padding;\r\n\t\t\tif( isNumber( padding ) ) {\r\n\t\t\t\tthis._left = padding;\r\n\t\t\t\tthis._top = padding;\r\n\t\t\t\tthis._right = padding;\r\n\t\t\t\tthis._bottom = padding;\r\n\t\t\t} else {\r\n\t\t\t\tthis._left = padding.left;\r\n\t\t\t\tthis._top = padding.top;\r\n\t\t\t\tthis._right = padding.right;\r\n\t\t\t\tthis._bottom = padding.bottom;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetTheme(): DThemeBase {\r\n\t\treturn this._theme;\r\n\t}\r\n\r\n\tsetTheme( theme: DThemeBase ): void {\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tgetLeft(): number {\r\n\t\tconst left = this._left;\r\n\t\treturn left !== undefined ? left : this._theme.getPaddingLeft();\r\n\t}\r\n\r\n\tget left(): number | undefined {\r\n\t\treturn this._left;\r\n\t}\r\n\r\n\tset left( left: number | undefined ) {\r\n\t\tif( this._left !== left ) {\r\n\t\t\tthis._left = left;\r\n\t\t\tif( this._callback != null ) {\r\n\t\t\t\tthis._callback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetTop(): number {\r\n\t\tconst top = this._top;\r\n\t\treturn top !== undefined ? top : this._theme.getPaddingTop();\r\n\t}\r\n\r\n\tget top(): number | undefined {\r\n\t\treturn this._top;\r\n\t}\r\n\r\n\tset top( top: number | undefined ) {\r\n\t\tif( this._top !== top ) {\r\n\t\t\tthis._top = top;\r\n\t\t\tif( this._callback != null ) {\r\n\t\t\t\tthis._callback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetRight(): number {\r\n\t\tconst right = this._right;\r\n\t\treturn right !== undefined ? right : this._theme.getPaddingRight();\r\n\t}\r\n\r\n\tget right(): number | undefined {\r\n\t\treturn this._right;\r\n\t}\r\n\r\n\tset right( right: number | undefined ) {\r\n\t\tif( this._right !== right ) {\r\n\t\t\tthis._right = right;\r\n\t\t\tif( this._callback != null ) {\r\n\t\t\t\tthis._callback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetBottom(): number {\r\n\t\tconst bottom = this._bottom;\r\n\t\treturn bottom !== undefined ? bottom : this._theme.getPaddingBottom();\r\n\t}\r\n\r\n\tget bottom(): number | undefined {\r\n\t\treturn this._bottom;\r\n\t}\r\n\r\n\tset bottom( bottom: number | undefined ) {\r\n\t\tif( this._bottom !== bottom ) {\r\n\t\t\tthis._bottom = bottom;\r\n\t\t\tif( this._callback != null ) {\r\n\t\t\t\tthis._callback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tset( padding: number ): void;\r\n\tset( topAndBottom: number, leftAndRight: number ): void;\r\n\tset( top: number, leftAndRight: number, bottom: number ): void;\r\n\tset( top: number, right: number, bottom: number, left: number ): void;\r\n\tset( top: number, right?: number, bottom?: number, left?: number ) {\r\n\t\tif( right == null ) {\r\n\t\t\tthis.top = top;\r\n\t\t\tthis.right = top;\r\n\t\t\tthis.bottom = top;\r\n\t\t\tthis.left = top;\r\n\t\t} else if( bottom == null ) {\r\n\t\t\tthis.top = top;\r\n\t\t\tthis.right = right;\r\n\t\t\tthis.bottom = top;\r\n\t\t\tthis.left = right;\r\n\t\t} else if( left == null ) {\r\n\t\t\tthis.top = top;\r\n\t\t\tthis.right = right;\r\n\t\t\tthis.bottom = bottom;\r\n\t\t\tthis.left = right;\r\n\t\t} else {\r\n\t\t\tthis.top = top;\r\n\t\t\tthis.right = right;\r\n\t\t\tthis.bottom = bottom;\r\n\t\t\tthis.left = left;\r\n\t\t}\r\n\t\tif( this._callback != null ) {\r\n\t\t\tthis._callback();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\n\r\ntype Callback = () => any;\r\n\r\nexport class DBasePoint {\r\n\tprotected _point: IPoint;\r\n\tcb: Callback;\r\n\tscope: any;\r\n\r\n\tconstructor( point: IPoint, cb: Callback, scope?: any ) {\r\n\t\tthis._point = point;\r\n\t\tthis.cb = cb;\r\n\t}\r\n\r\n\tget x() {\r\n\t\treturn this._point.x;\r\n\t}\r\n\r\n\tset x( x: number ) {\r\n\t\tconst point = this._point;\r\n\t\tif( point.x !== x ) {\r\n\t\t\tpoint.x = x;\r\n\t\t\tthis.cb.call( this.scope );\r\n\t\t}\r\n\t}\r\n\r\n\tget y() {\r\n\t\treturn this._point.y;\r\n\t}\r\n\r\n\tset y( y: number ) {\r\n\t\tconst point = this._point;\r\n\t\tif( point.y !== y ) {\r\n\t\t\tpoint.y = y;\r\n\t\t\tthis.cb.call( this.scope );\r\n\t\t}\r\n\t}\r\n\r\n\tset( x: number, y: number ): this {\r\n\t\tconst point = this._point;\r\n\t\tif( point.x !== x || point.y !== y ) {\r\n\t\t\tpoint.set( x, y );\r\n\t\t\tthis.cb.call( this.scope );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcopyFrom( target: IPoint ): this {\r\n\t\tconst point = this._point;\r\n\t\tif( point.x !== target.x || point.y !== target.y ) {\r\n\t\t\tpoint.copyFrom( target );\r\n\t\t\tthis.cb.call( this.scope );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcopyTo( target: IPoint ): IPoint {\r\n\t\treturn target.copyFrom( this._point );\r\n\t}\r\n\r\n\tcopy(): this {\r\n\t\treturn this.copyFrom( arguments[ 0 ] );\r\n\t}\r\n\r\n\tclone( cb?: Function, scope?: any ): DBasePoint {\r\n\t\tcb = cb || this.cb;\r\n\t\tscope = scope || this.scope;\r\n\t\treturn new DBasePoint( this._point, cb as Callback, scope );\r\n\t}\r\n\r\n\tequals( p: IPoint ): boolean {\r\n\t\treturn this._point.equals( p );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Buffer, MeshGeometry, Texture, TextureUvs } from \"pixi.js\";\r\nimport { DCornerMask } from \"./d-corner-mask\";\r\n\r\nexport class DBaseBackgroundMeshGeometry extends MeshGeometry {\r\n\tprotected _texture: Texture;\r\n\tprotected _width: number;\r\n\tprotected _height: number;\r\n\tprotected _borderSize: number;\r\n\tprotected _cornerMask: DCornerMask;\r\n\tprotected _isDirty: boolean;\r\n\tprotected _textureId: number;\r\n\tprotected _vertices: Float32Array;\r\n\tprotected _uvs: Float32Array;\r\n\tprotected _indices: Uint16Array;\r\n\tprotected _vertexBuffer: Buffer;\r\n\tprotected _uvBuffer: Buffer;\r\n\tprotected _indexBuffer: Buffer;\r\n\r\n\tconstructor( texture: Texture, width: number, height: number, borderSize: number, cornerMask: DCornerMask ) {\r\n\t\tsuper( new Float32Array( 56 ), new Float32Array( 56 ), new Uint16Array( 42 ) );\r\n\r\n\t\tthis._width = width;\r\n\t\tthis._height = height;\r\n\t\tthis._texture = texture;\r\n\t\tthis._borderSize = borderSize;\r\n\t\tthis._cornerMask = cornerMask;\r\n\t\tthis._isDirty = true;\r\n\t\tthis._textureId = NaN;\r\n\r\n\t\tthis._vertexBuffer = this.getBuffer( \"aVertexPosition\" );\r\n\t\tthis._vertices = this._vertexBuffer.data as Float32Array;\r\n\t\tthis._uvBuffer = this.getBuffer( \"aTextureCoord\" );\r\n\t\tthis._uvs = this._uvBuffer.data as Float32Array;\r\n\t\tthis._indexBuffer = this.getIndex();\r\n\t\tthis._indices = this._indexBuffer.data as Uint16Array;\r\n\t}\r\n\r\n\tget borderSize(): number {\r\n\t\treturn this._borderSize;\r\n\t}\r\n\r\n\tset borderSize( borderSize: number ) {\r\n\t\tif( this._borderSize !== borderSize ) {\r\n\t\t\tthis._borderSize = borderSize;\r\n\t\t\tthis._isDirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget cornerMask(): DCornerMask {\r\n\t\treturn this._cornerMask;\r\n\t}\r\n\r\n\tset cornerMask( cornerMask: DCornerMask ) {\r\n\t\tif( this._cornerMask !== cornerMask ) {\r\n\t\t\tthis._cornerMask = cornerMask;\r\n\t\t\tthis._isDirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tif( this._width !== width ) {\r\n\t\t\tthis._width = width;\r\n\t\t\tthis._isDirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tset height( height: number ) {\r\n\t\tif( this._height !== height ) {\r\n\t\t\tthis._height = height;\r\n\t\t\tthis._isDirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget texture(): Texture {\r\n\t\treturn this._texture;\r\n\t}\r\n\r\n\tset texture( texture: Texture ) {\r\n\t\tif( this._texture !== texture ) {\r\n\t\t\tthis._texture = texture;\r\n\t\t\tthis._isDirty = true;\r\n\t\t\tthis._textureId = NaN;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getTextureId(): number {\r\n\t\treturn (this._texture as any)._updateID;\r\n\t}\r\n\r\n\tprotected fillVertices( iv: number, array: Float32Array, x0: number, x1: number, y0: number, y1: number ): void {\r\n\t\tarray[ iv + 0 ] = x0;\r\n\t\tarray[ iv + 1 ] = y0;\r\n\t\tarray[ iv + 2 ] = x1;\r\n\t\tarray[ iv + 3 ] = y0;\r\n\t\tarray[ iv + 4 ] = x0;\r\n\t\tarray[ iv + 5 ] = y1;\r\n\t\tarray[ iv + 6 ] = x1;\r\n\t\tarray[ iv + 7 ] = y1;\r\n\t}\r\n\r\n\tprotected fillIndices( ii: number, indices: Uint16Array, iv: number ): void {\r\n\t\tindices[ ii + 0 ] = iv + 0;\r\n\t\tindices[ ii + 1 ] = iv + 1;\r\n\t\tindices[ ii + 2 ] = iv + 2;\r\n\t\tindices[ ii + 3 ] = iv + 1;\r\n\t\tindices[ ii + 4 ] = iv + 3;\r\n\t\tindices[ ii + 5 ] = iv + 2;\r\n\t}\r\n\r\n\tprotected fillUvsCorner(\r\n\t\tiv: number, uvs: Float32Array, c: boolean,\r\n\t\tu0: number, u1: number, u2: number, u3: number,\r\n\t\tv0: number, v1: number, v2: number, v3: number\r\n\t): void {\r\n\t\tif( c ) {\r\n\t\t\tthis.fillVertices( iv, uvs, u0, u1, v0, v1 );\r\n\t\t} else {\r\n\t\t\tthis.fillVertices( iv, uvs, u3, u2, v0, v1 );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected fillUvs( iv: number, uvs: Float32Array, u0: number, u1: number, v0: number, v1: number ): void {\r\n\t\tthis.fillVertices( iv, uvs, u0, u1, v0, v1 );\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst texture = this.texture;\r\n\t\tif( ! texture.valid ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst textureId = this.getTextureId();\r\n\t\tif( this._isDirty || this._textureId !== textureId ) {\r\n\t\t\tthis._isDirty = false;\r\n\t\t\tthis._textureId = textureId;\r\n\t\t\tconst vertices = this._vertices;\r\n\t\t\tconst uvs = this._uvs;\r\n\t\t\tconst indices = this._indices;\r\n\r\n\t\t\tconst width = this._width;\r\n\t\t\tconst height = this._height;\r\n\t\t\tconst borderSize = this._borderSize;\r\n\r\n\t\t\tconst x0 = 0;\r\n\t\t\tconst x1 = Math.min( width * 0.5, borderSize );\r\n\t\t\tconst x2 = Math.max( width * 0.5, width - borderSize );\r\n\t\t\tconst x3 = width;\r\n\r\n\t\t\tconst y0 = 0;\r\n\t\t\tconst y1 = Math.min( height * 0.5, borderSize );\r\n\t\t\tconst y2 = Math.max( height * 0.5, height - borderSize );\r\n\t\t\tconst y3 = height;\r\n\r\n\t\t\tconst textureUvs: TextureUvs = (texture as any)._uvs;\r\n\r\n\t\t\tconst l = textureUvs.x0;\r\n\t\t\tconst r = textureUvs.x1;\r\n\t\t\tconst t = textureUvs.y0;\r\n\t\t\tconst b = textureUvs.y3;\r\n\t\t\tconst w = (r - l) * (borderSize / texture.width);\r\n\t\t\tconst h = (b - t) * (borderSize / texture.height);\r\n\r\n\t\t\tconst u0 = l;\r\n\t\t\tconst u1 = l + w;\r\n\t\t\tconst u2 = r - w;\r\n\t\t\tconst u3 = r;\r\n\r\n\t\t\tconst v0 = t;\r\n\t\t\tconst v1 = t + h;\r\n\t\t\tconst v2 = b - h;\r\n\t\t\tconst v3 = b;\r\n\r\n\t\t\tconst cornerMask = this._cornerMask;\r\n\t\t\tconst ctl = ! (cornerMask & DCornerMask.TOP_LEFT);\r\n\t\t\tconst ctr = ! (cornerMask & DCornerMask.TOP_RIGHT);\r\n\t\t\tconst cbl = ! (cornerMask & DCornerMask.BOTTOM_LEFT);\r\n\t\t\tconst cbr = ! (cornerMask & DCornerMask.BOTTOM_RIGHT);\r\n\r\n\t\t\t// Vertices & UVs\r\n\t\t\tlet iv = 0;\r\n\t\t\tlet ia = 0;\r\n\t\t\tlet ii = 0;\r\n\r\n\t\t\t// Top left\r\n\t\t\tthis.fillVertices( iv, vertices, x0, x1, y0, y1 );\r\n\t\t\tthis.fillUvsCorner( iv, uvs, ctl, u0, u1, u2, u3, v0, v1, v2, v3 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Top middle\r\n\t\t\tthis.fillVertices( iv, vertices, x1, x2, y0, y1 );\r\n\t\t\tthis.fillUvs( iv, uvs, u1, u2, v0, v1 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Top right\r\n\t\t\tthis.fillVertices( iv, vertices, x3, x2, y0, y1 );\r\n\t\t\tthis.fillUvsCorner( iv, uvs, ctr, u0, u1, u2, u3, v0, v1, v2, v3 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Middle\r\n\t\t\tthis.fillVertices( iv, vertices, x0, x3, y1, y2 );\r\n\t\t\tthis.fillUvs( iv, uvs, u0, u3, v1, v2 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Bottom left\r\n\t\t\tthis.fillVertices( iv, vertices, x0, x1, y3, y2 );\r\n\t\t\tthis.fillUvsCorner( iv, uvs, cbl, u0, u1, u2, u3, v0, v1, v2, v3 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Bottom middle\r\n\t\t\tthis.fillVertices( iv, vertices, x1, x2, y2, y3 );\r\n\t\t\tthis.fillUvs( iv, uvs, u1, u2, v2, v3 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Bottom right\r\n\t\t\tthis.fillVertices( iv, vertices, x3, x2, y3, y2 );\r\n\t\t\tthis.fillUvsCorner( iv, uvs, cbr, u3, u2, u1, u0, v3, v2, v1, v0 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\r\n\t\t\tthis._vertexBuffer.update();\r\n\t\t\tthis._uvBuffer.update();\r\n\t\t\tthis._indexBuffer.update();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Mesh, MeshMaterial, Renderer, Texture } from \"pixi.js\";\r\nimport { DBaseBackgroundMeshGeometry } from \"./d-base-background-mesh-geometry\";\r\nimport { DCornerMask } from \"./d-corner-mask\";\r\n\r\nexport class DBaseBackgroundMesh extends Mesh {\r\n\tgeometry!: DBaseBackgroundMeshGeometry;\r\n\tshader!: MeshMaterial;\r\n\r\n\tconstructor( texture: Texture, borderSize: number, cornerMask: DCornerMask ) {\r\n\t\tsuper(\r\n\t\t\tnew DBaseBackgroundMeshGeometry( texture, 100, 100, borderSize, cornerMask ),\r\n\t\t\tnew MeshMaterial( texture )\r\n\t\t);\r\n\t}\r\n\r\n\tget texture() {\r\n\t\treturn this.shader.texture;\r\n\t}\r\n\r\n\tset texture( texture: Texture ) {\r\n\t\tif( this.shader.texture !== texture ) {\r\n\t\t\tthis.shader.texture = texture;\r\n\t\t\tthis.geometry.texture = texture;\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this.geometry.width;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tthis.geometry.width = width;\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this.geometry.height;\r\n\t}\r\n\r\n\tset height( height: number ) {\r\n\t\tthis.geometry.height = height;\r\n\t}\r\n\r\n\tget borderSize(): number {\r\n\t\treturn this.geometry.cornerMask;\r\n\t}\r\n\r\n\tset borderSize( borderSize: number ) {\r\n\t\tthis.geometry.borderSize = borderSize;\r\n\t}\r\n\r\n\tget cornerMask(): DCornerMask {\r\n\t\treturn this.geometry.cornerMask;\r\n\t}\r\n\r\n\tset cornerMask( cornerMask: DCornerMask ) {\r\n\t\tthis.geometry.cornerMask = cornerMask;\r\n\t}\r\n\r\n\tprotected _render( renderer: Renderer ): void {\r\n\t\tthis.geometry.update();\r\n\t\tsuper._render( renderer );\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tthis.geometry.update();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Buffer, MeshGeometry, Texture, TextureUvs } from \"pixi.js\";\r\nimport { DBorderMask } from \"./d-border-mask\";\r\nimport { DCornerMask } from \"./d-corner-mask\";\r\n\r\nexport class DBaseBorderMeshGeometry extends MeshGeometry {\r\n\tprotected _texture: Texture;\r\n\tprotected _width: number;\r\n\tprotected _height: number;\r\n\tprotected _borderSize: number;\r\n\tprotected _borderMask: DBorderMask;\r\n\tprotected _cornerMask: DCornerMask;\r\n\tprotected _isDirty: boolean;\r\n\tprotected _textureId: number;\r\n\tprotected _vertices: Float32Array;\r\n\tprotected _uvs: Float32Array;\r\n\tprotected _indices: Uint16Array;\r\n\tprotected _vertexBuffer: Buffer;\r\n\tprotected _uvBuffer: Buffer;\r\n\tprotected _indexBuffer: Buffer;\r\n\r\n\tconstructor(\r\n\t\ttexture: Texture, width: number, height: number,\r\n\t\tborderSize: number, borderMask: DBorderMask, cornerMask: DCornerMask\r\n\t) {\r\n\t\tsuper( new Float32Array( 64 ), new Float32Array( 64 ), new Uint16Array( 48 ) );\r\n\r\n\t\tthis._width = width;\r\n\t\tthis._height = height;\r\n\t\tthis._texture = texture;\r\n\t\tthis._borderSize = borderSize;\r\n\t\tthis._borderMask = borderMask;\r\n\t\tthis._cornerMask = cornerMask;\r\n\t\tthis._isDirty = true;\r\n\t\tthis._textureId = NaN;\r\n\r\n\t\tthis._vertexBuffer = this.getBuffer( \"aVertexPosition\" );\r\n\t\tthis._vertices = this._vertexBuffer.data as Float32Array;\r\n\t\tthis._uvBuffer = this.getBuffer( \"aTextureCoord\" );\r\n\t\tthis._uvs = this._uvBuffer.data as Float32Array;\r\n\t\tthis._indexBuffer = this.getIndex();\r\n\t\tthis._indices = this._indexBuffer.data as Uint16Array;\r\n\t}\r\n\r\n\tget borderMask(): DBorderMask {\r\n\t\treturn this._borderMask;\r\n\t}\r\n\r\n\tset borderMask( borderMask: DBorderMask ) {\r\n\t\tif( this._borderMask !== borderMask ) {\r\n\t\t\tthis._borderMask = borderMask;\r\n\t\t\tthis._isDirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget cornerMask(): DCornerMask {\r\n\t\treturn this._cornerMask;\r\n\t}\r\n\r\n\tset cornerMask( cornerMask: DCornerMask ) {\r\n\t\tif( this._cornerMask !== cornerMask ) {\r\n\t\t\tthis._cornerMask = cornerMask;\r\n\t\t\tthis._isDirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget borderSize(): number {\r\n\t\treturn this._borderSize;\r\n\t}\r\n\r\n\tset borderSize( borderSize: number ) {\r\n\t\tif( this._borderSize !== borderSize ) {\r\n\t\t\tthis._borderSize = borderSize;\r\n\t\t\tthis._isDirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tif( this._width !== width ) {\r\n\t\t\tthis._width = width;\r\n\t\t\tthis._isDirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tset height( height: number ) {\r\n\t\tif( this._height !== height ) {\r\n\t\t\tthis._height = height;\r\n\t\t\tthis._isDirty = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget texture(): Texture {\r\n\t\treturn this._texture;\r\n\t}\r\n\r\n\tset texture( texture: Texture ) {\r\n\t\tif( this._texture !== texture ) {\r\n\t\t\tthis._texture = texture;\r\n\t\t\tthis._isDirty = true;\r\n\t\t\tthis._textureId = NaN;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected fillVertices( iv: number, array: Float32Array, x0: number, x1: number, y0: number, y1: number ): void {\r\n\t\tarray[ iv + 0 ] = x0;\r\n\t\tarray[ iv + 1 ] = y0;\r\n\t\tarray[ iv + 2 ] = x1;\r\n\t\tarray[ iv + 3 ] = y0;\r\n\t\tarray[ iv + 4 ] = x0;\r\n\t\tarray[ iv + 5 ] = y1;\r\n\t\tarray[ iv + 6 ] = x1;\r\n\t\tarray[ iv + 7 ] = y1;\r\n\t}\r\n\r\n\tprotected fillIndices( ii: number, indices: Uint16Array, iv: number ): void {\r\n\t\tindices[ ii + 0 ] = iv + 0;\r\n\t\tindices[ ii + 1 ] = iv + 1;\r\n\t\tindices[ ii + 2 ] = iv + 2;\r\n\t\tindices[ ii + 3 ] = iv + 1;\r\n\t\tindices[ ii + 4 ] = iv + 3;\r\n\t\tindices[ ii + 5 ] = iv + 2;\r\n\t}\r\n\r\n\tprotected fillUvsCorner(\r\n\t\tiv: number, uvs: Float32Array, b1: boolean, b2: boolean, c: boolean,\r\n\t\tu0: number, u1: number, u2: number, u3: number,\r\n\t\tv0: number, v1: number, v2: number, v3: number\r\n\t): void {\r\n\t\tif( b1 || b2 ) {\r\n\t\t\tif( c ) {\r\n\t\t\t\tthis.fillVertices( iv, uvs, u0, u1, v0, v1 );\r\n\t\t\t} else if( b1 && b2 ) {\r\n\t\t\t\tthis.fillVertices( iv, uvs, u3, u2, v0, v1 );\r\n\t\t\t} else if( b1 ) {\r\n\t\t\t\tthis.fillVertices( iv, uvs, u1, u2, v0, v1 );\r\n\t\t\t} else {\r\n\t\t\t\tthis.fillVertices( iv, uvs, u0, u1, v1, v2 );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.fillVertices( iv, uvs, u1, u1, v1, v1 );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected fillUvs(\r\n\t\tiv: number, uvs: Float32Array, b: boolean,\r\n\t\tu0: number, u1: number, v0: number, v1: number,\r\n\t\tuz: number, vz: number\r\n\t): void {\r\n\t\tif( b ) {\r\n\t\t\tthis.fillVertices( iv, uvs, u0, u1, v0, v1 );\r\n\t\t} else {\r\n\t\t\tthis.fillVertices( iv, uvs, uz, uz, vz, vz );\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst texture = this._texture;\r\n\t\tif( ! texture.valid ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst textureId: number = (texture as any)._updateID;\r\n\t\tif( this._isDirty || this._textureId !== textureId ) {\r\n\t\t\tthis._isDirty = false;\r\n\t\t\tthis._textureId = textureId;\r\n\t\t\tconst vertices = this._vertices;\r\n\t\t\tconst uvs = this._uvs;\r\n\t\t\tconst indices = this._indices;\r\n\r\n\t\t\tconst width = this._width;\r\n\t\t\tconst height = this._height;\r\n\t\t\tconst borderSize = this._borderSize;\r\n\r\n\t\t\tconst x0 = 0;\r\n\t\t\tconst x1 = Math.min( width * 0.5, borderSize );\r\n\t\t\tconst x2 = Math.max( width * 0.5, width - borderSize );\r\n\t\t\tconst x3 = width;\r\n\r\n\t\t\tconst y0 = 0;\r\n\t\t\tconst y1 = Math.min( height * 0.5, borderSize );\r\n\t\t\tconst y2 = Math.max( height * 0.5, height - borderSize );\r\n\t\t\tconst y3 = height;\r\n\r\n\t\t\tconst textureUvs: TextureUvs = (texture as any)._uvs;\r\n\r\n\t\t\tconst l = textureUvs.x0;\r\n\t\t\tconst r = textureUvs.x1;\r\n\t\t\tconst t = textureUvs.y0;\r\n\t\t\tconst b = textureUvs.y3;\r\n\t\t\tconst w = (r - l) * (borderSize / texture.width);\r\n\t\t\tconst h = (b - t) * (borderSize / texture.height);\r\n\r\n\t\t\tconst u0 = l;\r\n\t\t\tconst u1 = l + w;\r\n\t\t\tconst u2 = r - w;\r\n\t\t\tconst u3 = r;\r\n\r\n\t\t\tconst v0 = t;\r\n\t\t\tconst v1 = t + h;\r\n\t\t\tconst v2 = b - h;\r\n\t\t\tconst v3 = b;\r\n\r\n\t\t\tconst borderMask = this._borderMask;\r\n\t\t\tconst bt = ! (borderMask & DBorderMask.TOP);\r\n\t\t\tconst bb = ! (borderMask & DBorderMask.BOTTOM);\r\n\t\t\tconst bl = ! (borderMask & DBorderMask.LEFT);\r\n\t\t\tconst br = ! (borderMask & DBorderMask.RIGHT);\r\n\r\n\t\t\tconst cornerMask = this._cornerMask;\r\n\t\t\tconst ctl = ! (cornerMask & DCornerMask.TOP_LEFT);\r\n\t\t\tconst ctr = ! (cornerMask & DCornerMask.TOP_RIGHT);\r\n\t\t\tconst cbl = ! (cornerMask & DCornerMask.BOTTOM_LEFT);\r\n\t\t\tconst cbr = ! (cornerMask & DCornerMask.BOTTOM_RIGHT);\r\n\r\n\t\t\t// Vertices & UVs\r\n\t\t\tlet iv = 0;\r\n\t\t\tlet ia = 0;\r\n\t\t\tlet ii = 0;\r\n\r\n\t\t\t// Top left\r\n\t\t\tthis.fillVertices( iv, vertices, x0, x1, y0, y1 );\r\n\t\t\tthis.fillUvsCorner( iv, uvs, bt, bl, ctl, u0, u1, u2, u3, v0, v1, v2, v3 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Top middle\r\n\t\t\tthis.fillVertices( iv, vertices, x1, x2, y0, y1 );\r\n\t\t\tthis.fillUvs( iv, uvs, bt, u1, u2, v0, v1, u1, v1 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Top right\r\n\t\t\tthis.fillVertices( iv, vertices, x3, x2, y0, y1 );\r\n\t\t\tthis.fillUvsCorner( iv, uvs, bt, br, ctr, u0, u1, u2, u3, v0, v1, v2, v3 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Middle left\r\n\t\t\tthis.fillVertices( iv, vertices, x0, x1, y1, y2 );\r\n\t\t\tthis.fillUvs( iv, uvs, bl, u0, u1, v1, v2, u1, v1 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Middle right\r\n\t\t\tthis.fillVertices( iv, vertices, x2, x3, y1, y2 );\r\n\t\t\tthis.fillUvs( iv, uvs, br, u2, u3, v1, v2, u2, v2 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Bottom left\r\n\t\t\tthis.fillVertices( iv, vertices, x0, x1, y3, y2 );\r\n\t\t\tthis.fillUvsCorner( iv, uvs, bb, bl, cbl, u0, u1, u2, u3, v0, v1, v2, v3 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Bottom middle\r\n\t\t\tthis.fillVertices( iv, vertices, x1, x2, y2, y3 );\r\n\t\t\tthis.fillUvs( iv, uvs, bb, u1, u2, v2, v3, u2, v2 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\t\t\tiv += 8;\r\n\t\t\tia += 4;\r\n\t\t\tii += 6;\r\n\r\n\t\t\t// Bottom right\r\n\t\t\tthis.fillVertices( iv, vertices, x3, x2, y3, y2 );\r\n\t\t\tthis.fillUvsCorner( iv, uvs, bb, br, cbr, u3, u2, u1, u0, v3, v2, v1, v0 );\r\n\t\t\tthis.fillIndices( ii, indices, ia );\r\n\r\n\t\t\tthis._vertexBuffer.update();\r\n\t\t\tthis._uvBuffer.update();\r\n\t\t\tthis._indexBuffer.update();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Mesh, MeshMaterial, Renderer, Texture } from \"pixi.js\";\r\nimport { DBaseBorderMeshGeometry } from \"./d-base-border-mesh-geometry\";\r\nimport { DBorderMask } from \"./d-border-mask\";\r\nimport { DCornerMask } from \"./d-corner-mask\";\r\n\r\nexport class DBaseBorderMesh extends Mesh {\r\n\tgeometry!: DBaseBorderMeshGeometry;\r\n\tshader!: MeshMaterial;\r\n\r\n\tconstructor( texture: Texture, borderSize: number, borderMask: DBorderMask, cornerMask: DCornerMask ) {\r\n\t\tsuper(\r\n\t\t\tnew DBaseBorderMeshGeometry( texture, 100, 100, borderSize, borderMask, cornerMask ),\r\n\t\t\tnew MeshMaterial( texture )\r\n\t\t);\r\n\t}\r\n\r\n\tget texture() {\r\n\t\treturn this.shader.texture;\r\n\t}\r\n\r\n\tset texture( texture: Texture ) {\r\n\t\tif( this.shader.texture !== texture ) {\r\n\t\t\tthis.shader.texture = texture;\r\n\t\t\tthis.geometry.texture = texture;\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this.geometry.width;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tthis.geometry.width = width;\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this.geometry.height;\r\n\t}\r\n\r\n\tset height( height: number ) {\r\n\t\tthis.geometry.height = height;\r\n\t}\r\n\r\n\tget borderSize(): number {\r\n\t\treturn this.geometry.borderSize;\r\n\t}\r\n\r\n\tset borderSize( borderSize: number ) {\r\n\t\tthis.geometry.borderSize = borderSize;\r\n\t}\r\n\r\n\tget borderMask(): DBorderMask {\r\n\t\treturn this.geometry.borderMask;\r\n\t}\r\n\r\n\tset borderMask( borderMask: DBorderMask ) {\r\n\t\tthis.geometry.borderMask = borderMask;\r\n\t}\r\n\r\n\tget cornerMask(): DCornerMask {\r\n\t\treturn this.geometry.cornerMask;\r\n\t}\r\n\r\n\tset cornerMask( cornerMask: DCornerMask ) {\r\n\t\tthis.geometry.cornerMask = cornerMask;\r\n\t}\r\n\r\n\tprotected _render( renderer: Renderer ): void {\r\n\t\tthis.geometry.update();\r\n\t\tsuper._render( renderer );\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tthis.geometry.update();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseBorderMesh } from \"./d-base-border-mesh\";\r\n\r\nexport class DBaseOutlineMesh extends DBaseBorderMesh {\r\n\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DReflowable } from \"./d-base\";\r\nimport { DBaseBackgroundMesh } from \"./d-base-background-mesh\";\r\nimport { DBaseBorderMesh } from \"./d-base-border-mesh\";\r\nimport { DBaseOutlineMesh } from \"./d-base-outline-mesh\";\r\n\r\nexport class DBaseReflowable implements DReflowable {\r\n\tprotected _lastBackgroundCornerRadius: number;\r\n\tprotected _lastBorderCornerRadius: number;\r\n\tprotected _lastBorderWidth: number;\r\n\tprotected _lastOutlineCornerRadius: number;\r\n\tprotected _lastOutlineWidth: number;\r\n\tprotected _backgroundPlane: DBaseBackgroundMesh;\r\n\tprotected _borderPlane: DBaseBorderMesh;\r\n\tprotected _outlinePlane: DBaseOutlineMesh;\r\n\r\n\tconstructor( base: DBase ) {\r\n\t\tconst theme = base.theme;\r\n\t\tconst corner = base.corner;\r\n\t\tconst cornerRadius = corner.getRadius();\r\n\t\tconst cornerHeight = cornerRadius + 1;\r\n\t\tconst cornerMask = corner.getMask();\r\n\t\tconst backgroundPlane = this._backgroundPlane = new DBaseBackgroundMesh(\r\n\t\t\ttheme.getBackgroundTexture( cornerRadius ),\r\n\t\t\tcornerHeight, cornerMask\r\n\t\t);\r\n\t\tbase.appendRenderable( backgroundPlane, true );\r\n\r\n\t\tconst state = base.state;\r\n\r\n\t\tconst border = base.border;\r\n\t\tconst borderWidth = border.getWidth( state );\r\n\t\tconst borderMask = border.getMask( state );\r\n\t\tconst borderPlane = this._borderPlane = new DBaseBorderMesh(\r\n\t\t\ttheme.getBorderTexture( cornerRadius, borderWidth ),\r\n\t\t\tcornerHeight,\r\n\t\t\tborderMask,\r\n\t\t\tcornerMask\r\n\t\t);\r\n\t\tbase.appendRenderable( borderPlane, false );\r\n\r\n\t\tconst outline = base.outline;\r\n\t\tconst outlineWidth = outline.getWidth( state );\r\n\t\tconst outlineMask = outline.getMask( state );\r\n\t\tconst outlinePlane = this._outlinePlane = new DBaseOutlineMesh(\r\n\t\t\ttheme.getBorderTexture( cornerRadius, outlineWidth ),\r\n\t\t\tcornerHeight,\r\n\t\t\toutlineMask,\r\n\t\t\tcornerMask\r\n\t\t);\r\n\t\tbase.appendRenderable( outlinePlane, false );\r\n\r\n\t\tthis._lastBackgroundCornerRadius = cornerRadius;\r\n\t\tthis._lastBorderCornerRadius = cornerRadius;\r\n\t\tthis._lastBorderWidth = borderWidth;\r\n\t\tthis._lastOutlineCornerRadius = cornerRadius;\r\n\t\tthis._lastOutlineWidth = outlineWidth;\r\n\r\n\t\tbase.addReflowable( this );\r\n\t}\r\n\r\n\tonReflow( base: DBase, width: number, height: number ): void {\r\n\t\tconst theme = base.theme;\r\n\t\tconst state = base.state;\r\n\t\tconst corner = base.corner;\r\n\t\tconst cornerRadius = corner.getRadius();\r\n\t\tconst cornerHeight = cornerRadius + 1;\r\n\t\tconst cornerMask = corner.getMask();\r\n\r\n\t\t// Background\r\n\t\tconst background = base.background;\r\n\t\tconst backgroundPlane = this._backgroundPlane;\r\n\t\tconst backgroundColor = background.getColor( state );\r\n\t\tif( backgroundColor != null ) {\r\n\t\t\tconst backgroundAlpha = background.getAlpha( state );\r\n\t\t\tif( 0 < backgroundAlpha ) {\r\n\t\t\t\tif( this._lastBackgroundCornerRadius !== cornerRadius ) {\r\n\t\t\t\t\tthis._lastBackgroundCornerRadius = cornerRadius;\r\n\t\t\t\t\tbackgroundPlane.texture = theme.getBackgroundTexture( cornerRadius );\r\n\t\t\t\t\tbackgroundPlane.borderSize = cornerHeight;\r\n\t\t\t\t}\r\n\t\t\t\tbackgroundPlane.tint = backgroundColor;\r\n\t\t\t\tbackgroundPlane.alpha = backgroundAlpha;\r\n\t\t\t\tbackgroundPlane.width = width;\r\n\t\t\t\tbackgroundPlane.height = height;\r\n\t\t\t\tbackgroundPlane.cornerMask = cornerMask;\r\n\t\t\t\tbackgroundPlane.visible = true;\r\n\t\t\t} else {\r\n\t\t\t\tbackgroundPlane.visible = false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tbackgroundPlane.visible = false;\r\n\t\t}\r\n\r\n\t\t// Border\r\n\t\tconst border = base.border;\r\n\t\tconst borderPlane = this._borderPlane;\r\n\t\tconst borderColor = border.getColor( state );\r\n\t\tif( borderColor != null ) {\r\n\t\t\tconst borderAlpha = border.getAlpha( state );\r\n\t\t\tif( 0 < borderAlpha ) {\r\n\t\t\t\tconst borderWidth = border.getWidth( state );\r\n\t\t\t\tif( this._lastBorderCornerRadius !== cornerRadius || this._lastBorderWidth !== borderWidth ) {\r\n\t\t\t\t\tthis._lastBorderCornerRadius = cornerRadius;\r\n\t\t\t\t\tthis._lastBorderWidth = borderWidth;\r\n\t\t\t\t\tborderPlane.texture = theme.getBorderTexture( cornerRadius, borderWidth );\r\n\t\t\t\t\tborderPlane.borderSize = cornerHeight;\r\n\t\t\t\t}\r\n\t\t\t\tconst borderAlign = border.getAlign( state );\r\n\t\t\t\tconst borderMask = border.getMask( state );\r\n\t\t\t\tborderPlane.tint = borderColor;\r\n\t\t\t\tborderPlane.alpha = borderAlpha;\r\n\t\t\t\tconst borderOffset = borderAlign * borderWidth;\r\n\t\t\t\tborderPlane.x = -borderOffset;\r\n\t\t\t\tborderPlane.y = -borderOffset;\r\n\t\t\t\tborderPlane.width = width + borderOffset * 2;\r\n\t\t\t\tborderPlane.height = height + borderOffset * 2;\r\n\t\t\t\tborderPlane.borderMask = borderMask;\r\n\t\t\t\tborderPlane.cornerMask = cornerMask;\r\n\t\t\t\tborderPlane.visible = true;\r\n\t\t\t} else {\r\n\t\t\t\tborderPlane.visible = false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tborderPlane.visible = false;\r\n\t\t}\r\n\r\n\t\t// Outline\r\n\t\tconst outline = base.outline;\r\n\t\tconst outlinePlane = this._outlinePlane;\r\n\t\tconst outlineColor = outline.getColor( state );\r\n\t\tif( outlineColor != null ) {\r\n\t\t\tconst outlineAlpha = outline.getAlpha( state );\r\n\t\t\tif( 0 < outlineAlpha ) {\r\n\t\t\t\tconst outlineWidth = outline.getWidth( state );\r\n\t\t\t\tif( this._lastOutlineCornerRadius !== cornerRadius || this._lastOutlineWidth !== outlineWidth ) {\r\n\t\t\t\t\tthis._lastOutlineCornerRadius = cornerRadius;\r\n\t\t\t\t\tthis._lastOutlineWidth = outlineWidth;\r\n\t\t\t\t\toutlinePlane.texture = theme.getBorderTexture( cornerRadius, outlineWidth );\r\n\t\t\t\t\toutlinePlane.borderSize = cornerHeight;\r\n\t\t\t\t}\r\n\t\t\t\tconst outlineMask = outline.getMask( state );\r\n\t\t\t\tconst outlineOffset = outline.getOffset( state );\r\n\t\t\t\tconst outlineAlign = outline.getAlign( state );\r\n\t\t\t\toutlinePlane.tint = outlineColor;\r\n\t\t\t\toutlinePlane.alpha = outlineAlpha;\r\n\t\t\t\tconst outlineOffsetAccumulative = outlineOffset + outlineAlign * outlineWidth;\r\n\t\t\t\toutlinePlane.x = -outlineOffsetAccumulative;\r\n\t\t\t\toutlinePlane.y = -outlineOffsetAccumulative;\r\n\t\t\t\toutlinePlane.width = width + outlineOffsetAccumulative * 2;\r\n\t\t\t\toutlinePlane.height = height + outlineOffsetAccumulative * 2;\r\n\t\t\t\toutlinePlane.borderMask = outlineMask;\r\n\t\t\t\toutlinePlane.cornerMask = cornerMask;\r\n\t\t\t\toutlinePlane.visible = true;\r\n\t\t\t} else {\r\n\t\t\t\toutlinePlane.visible = false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\toutlinePlane.visible = false;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\n\r\nexport class DBaseStates {\r\n\tstatic is( target: DBaseState, state: DBaseState ): boolean {\r\n\t\treturn !! ( target & state );\r\n\t}\r\n\r\n\tstatic isHovered( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.HOVERED );\r\n\t}\r\n\r\n\tstatic isDragging( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.DRAGGING );\r\n\t}\r\n\r\n\tstatic isFocused( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.FOCUSED );\r\n\t}\r\n\r\n\tstatic isFocusedIn( target: DBaseState ) {\r\n\t\treturn !! ( target & (DBaseState.FOCUSED | DBaseState.FOCUSED_IN) );\r\n\t}\r\n\r\n\tstatic isActive( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.ACTIVE );\r\n\t}\r\n\r\n\tstatic isActiveIn( target: DBaseState ) {\r\n\t\treturn !! ( target & (DBaseState.ACTIVE | DBaseState.ACTIVE_IN) );\r\n\t}\r\n\r\n\tstatic isNotActive( state: DBaseState ): boolean {\r\n\t\treturn (!! ( state & DBaseState.DISABLED )) || (! ( state & DBaseState.ACTIVE ));\r\n\t}\r\n\r\n\tstatic isPressed( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.PRESSED );\r\n\t}\r\n\r\n\tstatic isDisabled( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.DISABLED );\r\n\t}\r\n\r\n\tstatic isReadOnly( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.READ_ONLY );\r\n\t}\r\n\r\n\tstatic isActionable( target: DBaseState ) {\r\n\t\treturn ! ( target & (DBaseState.DISABLED | DBaseState.READ_ONLY) );\r\n\t}\r\n\r\n\tstatic isInvalid( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.INVALID );\r\n\t}\r\n\r\n\tstatic isSucceeded( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.SUCCEEDED );\r\n\t}\r\n\r\n\tstatic isFailed( target: DBaseState ) {\r\n\t\treturn !! ( target & DBaseState.FAILED );\r\n\t}\r\n\r\n\tstatic bind(\r\n\t\tdestination: DBase<any, any>, destinationState: DBaseState,\r\n\t\tsource: DBase<any, any>, when: ( sourceState: DBaseState ) => boolean\r\n\t) {\r\n\t\tdestination.setState( destinationState, when( source.state ) );\r\n\t\tsource.on( \"statechange\", ( newSourceState: DBaseState ) => {\r\n\t\t\tdestination.setState( destinationState, when( newSourceState ) );\r\n\t\t});\r\n\t}\r\n\r\n\tstatic disable(\r\n\t\tdestination: DBase<any, any>, source: DBase<any, any>,\r\n\t\twhen: ( sourceState: DBaseState ) => boolean = DBaseStates.isNotActive\r\n\t) {\r\n\t\tDBaseStates.bind( destination, DBaseState.DISABLED, source, when );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, DisplayObject, interaction, Point, Rectangle, Renderer, Texture, Transform } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBackgroundStateAware } from \"./d-background\";\r\nimport { DBaseBackground } from \"./d-base-background\";\r\nimport { DBaseBorder } from \"./d-base-border\";\r\nimport { DBaseCorner } from \"./d-base-corner\";\r\nimport { DBaseInteractive } from \"./d-base-interactive\";\r\nimport { DBaseOutline } from \"./d-base-outline\";\r\nimport { DBasePadding } from \"./d-base-padding\";\r\nimport { DBasePoint } from \"./d-base-point\";\r\nimport { DBaseReflowable } from \"./d-base-reflowable\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DBaseStates } from \"./d-base-states\";\r\nimport { DBorderStateAware } from \"./d-border\";\r\nimport { DBorderMask } from \"./d-border-mask\";\r\nimport { DCoordinatePosition, DCoordinateSize } from \"./d-coordinate\";\r\nimport { DCorner } from \"./d-corner\";\r\nimport { DCornerMask } from \"./d-corner-mask\";\r\nimport { DThemeFont } from \"./d-font\";\r\nimport { DLayoutClearType } from \"./d-layout-clear-type\";\r\nimport { DOutline } from \"./d-outline\";\r\nimport { DPadding } from \"./d-padding\";\r\nimport { DScalarFunctions } from \"./d-scalar-functions\";\r\nimport { DScalarSet } from \"./d-scalar-set\";\r\nimport { DShadow } from \"./d-shadow\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\nimport { isFunction } from \"./util/is-function\";\r\nimport { isNumber } from \"./util/is-number\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilKeyboardEvent, UtilKeyboardEventShortcut } from \"./util/util-keyboard-event\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\r\n\r\n/**\r\n * {@link DBase} padding options.\r\n */\r\nexport interface DBasePaddingOptions {\r\n\t/** A top padding */\r\n\ttop?: number;\r\n\r\n\t/** A right padding */\r\n\tright?: number;\r\n\r\n\t/** A bottom padding */\r\n\tbottom?: number;\r\n\r\n\t/** A left padding */\r\n\tleft?: number;\r\n}\r\n\r\n/**\r\n * {@link DBase} corner options.\r\n */\r\nexport interface DBaseCornerOptions {\r\n\t/** A radius */\r\n\tradius?: number;\r\n\r\n\t/** Masked corners get unrounded. */\r\n\tmask?: (keyof typeof DCornerMask) | DCornerMask;\r\n}\r\n\r\n/**\r\n * Mappings of event names and event handlers.\r\n */\r\nexport interface DBaseOnOptions {\r\n\t[name: string]: Function | undefined;\r\n\r\n\t/**\r\n\t * Triggered when an initialization is finished.\r\n\t *\r\n\t * @param self an initialized instance\r\n\t */\r\n\tinit?: ( self: any ) => void;\r\n}\r\n\r\n/**\r\n * {@link DBase} background options.\r\n */\r\nexport interface DBaseBackgroundOptions {\r\n\t/**\r\n\t * A color code or a function returning a color code.\r\n\t * If a computed value is undefined, falls back to the theme color.\r\n\t * If a computed value is null, a background is not rendered.\r\n\t */\r\n\tcolor?: DStateAwareOrValueMightBe<number | null>;\r\n\r\n\t/**\r\n\t * An alpha or a function returning an alpha.\r\n\t * If a computed value is undefined, falls back to an background alpha of a theme.\r\n\t */\r\n\talpha?: DStateAwareOrValueMightBe<number>;\r\n}\r\n\r\n/**\r\n * {@link DBase} border options.\r\n */\r\nexport interface DBaseBorderOptions {\r\n\t/**\r\n\t * A color code or a function returning a color code.\r\n\t * If a computed value is undefined, falls back to the theme color.\r\n\t * If a computed value is null, a background is not rendered.\r\n\t */\r\n\tcolor?: DStateAwareOrValueMightBe<number | null>;\r\n\r\n\t/**\r\n\t * An alpha or a function returning an alpha.\r\n\t * If a computed value is undefined, falls back to a border alpha of a theme.\r\n\t */\r\n\talpha?: DStateAwareOrValueMightBe<number>;\r\n\r\n\t/**\r\n\t * A width or a function returning a width.\r\n\t * If a computed value is undefined, falls back to a border width of a theme.\r\n\t */\r\n\twidth?: DStateAwareOrValueMightBe<number>;\r\n\r\n\t/**\r\n\t * An align or a function returning an align.\r\n\t * If a computed value is undefined, falls back to a border align of a theme.\r\n\t * If an align is 0, a border is rendered completely inside of a {@link DBase}.\r\n\t * If an align is 1, a border is rendered completely outside of a {@link DBase}.\r\n\t */\r\n\talign?: DStateAwareOrValueMightBe<number>;\r\n\r\n\t/** Masked borders get removed. */\r\n\tmask?: DStateAwareOrValueMightBe<DBorderMask> | (keyof typeof DBorderMask);\r\n}\r\n\r\n/**\r\n * {@link DBase} outline optons.\r\n */\r\nexport interface DBaseOutlineOptions {\r\n\t/**\r\n\t * A color code or a function returning a color code.\r\n\t * If a computed value is undefined, falls back to the theme color.\r\n\t * If a computed value is null, a background is not rendered.\r\n\t */\r\n\tcolor?: DStateAwareOrValueMightBe<number | null>;\r\n\r\n\t/**\r\n\t * An alpha or a function returning an alpha.\r\n\t * If a computed value is undefined, falls back to an outline alpha of a theme.\r\n\t */\r\n\talpha?: DStateAwareOrValueMightBe<number>;\r\n\r\n\t/**\r\n\t * A width or a function returning a width.\r\n\t * If a computed value is undefined, falls back to an outline width of a theme.\r\n\t */\r\n\twidth?: DStateAwareOrValueMightBe<number>;\r\n\r\n\t/**\r\n\t * An offset or a function returning an offset.\r\n\t * If a computed value is undefined, falls back to an outline align of a theme.\r\n\t * A outline moves to outside when an offset gets larger.\r\n\t */\r\n\toffset?: DStateAwareOrValueMightBe<number>;\r\n\r\n\t/**\r\n\t * An align or a function returning an align.\r\n\t * If a computed value is undefined, falls back to an outline align of a theme.\r\n\t * If an align is 0, an outline is rendered completely inside.\r\n\t * If an align is 1, an outline is rendered completely outside.\r\n\t */\r\n\talign?: DStateAwareOrValueMightBe<number>;\r\n\r\n\t/** Masked outlines get removed. */\r\n\tmask?: DStateAwareOrValueMightBe<DBorderMask> | (keyof typeof DBorderMask);\r\n}\r\n\r\n/**\r\n * {@link DBase} options.\r\n */\r\nexport interface DBaseOptions<THEME extends DThemeBase = DThemeBase> {\r\n\t/**\r\n\t * A parent.\r\n\t *\r\n\t * In the case of UI classes which pop up (e.g., {@link DDialog} and {@link DMenu}),\r\n\t * if multiple application instances are there, better to set\r\n\t * this to an `application.stage` so that they pick a right application.\r\n\t * By default, they assume the last created application is\r\n\t * the one they belong to at the time when they are created.\r\n\t */\r\n\tparent?: Container;\r\n\r\n\t/** Children. */\r\n\tchildren?: Array<DisplayObject | null>;\r\n\r\n\t/** A name. */\r\n\tname?: string;\r\n\r\n\t/**\r\n\t * One of the followings:\r\n\t * * A X position\r\n\t * * A position keyword\r\n\t * * A position expression (Parsed by {@link DScalarExpression})\r\n\t * * A function returning a X position ({@link DScalarFunction})\r\n\t * * An object returning a X position ({@link DScalar})\r\n\t */\r\n\tx?: DCoordinatePosition;\r\n\r\n\t/**\r\n\t * One of the followings:\r\n\t * * A Y position\r\n\t * * A position keyword\r\n\t * * A position expresion (Parsed by {@link DScalarExpression})\r\n\t * * A function returning a Y position ({@link DScalarFunction})\r\n\t * * An object returning a Y position ({@link DScalar})\r\n\t */\r\n\ty?: DCoordinatePosition;\r\n\r\n\t/**\r\n\t * One of the followings:\r\n\t * * A width\r\n\t * * A size keyword\r\n\t * * A size expression (Parsed by {@link DScalarExpression})\r\n\t * * A function returning a width ({@link DScalarFunction})\r\n\t * * An object returning a width ({@link DScalar})\r\n\t */\r\n\twidth?: DCoordinateSize;\r\n\r\n\t/**\r\n\t * One of the followings:\r\n\t * * A height\r\n\t * * A size keyword\r\n\t * * A size expression (Parsed by {@link DScalarExpression})\r\n\t * * A function returning a hight ({@link DScalarFunction})\r\n\t * * An object returning a hight ({@link DScalar})\r\n\t */\r\n\theight?: DCoordinateSize;\r\n\r\n\t/**\r\n\t * A visibility.\r\n\t * Set to true to make {@link DBase} visible.\r\n\t * Set to false to make {@link DBase} invisible.\r\n\t * The default values is true.\r\n\t */\r\n\tvisible?: boolean;\r\n\r\n\t/** A default state. */\r\n\tstate?: (keyof typeof DBaseState) | Array<keyof typeof DBaseState> | DBaseState;\r\n\r\n\t/** An interactivity option. */\r\n\tinteractive?: (keyof typeof DBaseInteractive) | DBaseInteractive;\r\n\r\n\t/** A padding options. */\r\n\tpadding?: number | DBasePaddingOptions;\r\n\r\n\t/** A corner options. */\r\n\tcorner?: number | DBaseCornerOptions;\r\n\r\n\t/** A theme or a theme name. */\r\n\ttheme?: THEME | string;\r\n\r\n\t/**\r\n\t * Mappings of event names and event handlers.\r\n\t */\r\n\ton?: DBaseOnOptions;\r\n\r\n\t/**\r\n\t * A weight used by {@link DLayoutVertical} and {@link DLayoutHorizontal}.\r\n\t */\r\n\tweight?: number;\r\n\r\n\t/** A tooltip text. */\r\n\ttitle?: string;\r\n\r\n\t/** A shortcut option. */\r\n\tshortcut?: string | UtilKeyboardEventShortcut;\r\n\r\n\t/** A shortcut options. */\r\n\tshortcuts?: Array<string | UtilKeyboardEventShortcut>;\r\n\r\n\t/** A background options. */\r\n\tbackground?: DBaseBackgroundOptions;\r\n\r\n\t/** A border options. */\r\n\tborder?: DBaseBorderOptions;\r\n\r\n\t/** An outline options. */\r\n\toutline?: DBaseOutlineOptions;\r\n\r\n\t/** A shadow. */\r\n\tshadow?: \"NONE\" | \"WEAK\" | \"DEFAULT\" | DShadow | null;\r\n\r\n\t/** A clear type used by {@link DLayoutVertical} and {@link DLayoutHorizontal}. */\r\n\tclear?: (keyof typeof DLayoutClearType) | DLayoutClearType;\r\n\r\n\t/** A cursor shape. */\r\n\tcursor?: string;\r\n}\r\n\r\n/**\r\n * DBase theme\r\n */\r\nexport interface DThemeBase extends DThemeFont {\r\n\t/**\r\n\t * Returns a X coordinate.\r\n\t */\r\n\tgetX(): DCoordinatePosition;\r\n\r\n\t/**\r\n\t * Returns a Y coordinate.\r\n\t */\r\n\tgetY(): DCoordinatePosition;\r\n\r\n\t/**\r\n\t * Returns a height.\r\n\t */\r\n\tgetHeight(): DCoordinateSize;\r\n\r\n\t/**\r\n\t * Returns a width.\r\n\t */\r\n\tgetWidth(): DCoordinateSize;\r\n\r\n\t/**\r\n\t * Returns a background color.\r\n\t * If the color is null, backgrounds are not be rendered.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetBackgroundColor( state: DBaseState ): number | null;\r\n\r\n\t/**\r\n\t * Returns a background alpha.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetBackgroundAlpha( state: DBaseState ): number;\r\n\r\n\t/**\r\n\t * Returns a background texture of the given radius.\r\n\t *\r\n\t * @param radius a corner radius\r\n\t */\r\n\tgetBackgroundTexture( radius: number ): Texture;\r\n\r\n\t/**\r\n\t * Returns a border color.\r\n\t * If the color is null, borders are not be rendered.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetBorderColor( state: DBaseState ): number | null;\r\n\r\n\t/**\r\n\t * Returns a border alpha.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetBorderAlpha( state: DBaseState ): number;\r\n\r\n\t/**\r\n\t * Returns a border width.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetBorderWidth( state: DBaseState ): number;\r\n\r\n\t/**\r\n\t * Returns a border align.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetBorderAlign( state: DBaseState ): number;\r\n\r\n\t/**\r\n\t * Returns a border mask.\r\n\t *\r\n\t * @param state a mask\r\n\t */\r\n\tgetBorderMask( state: DBaseState ): DBorderMask;\r\n\r\n\t/**\r\n\t * Returns a border texture of the given radius and width.\r\n\t *\r\n\t * @param radius a corner radius\r\n\t * @param width a border width\r\n\t */\r\n\tgetBorderTexture( radius: number, width: number ): Texture;\r\n\r\n\t/**\r\n\t * Returns a left padding.\r\n\t */\r\n\tgetPaddingLeft(): number;\r\n\r\n\t/**\r\n\t * Returns a right padding.\r\n\t */\r\n\tgetPaddingRight(): number;\r\n\r\n\t/**\r\n\t * Returns a top padding.\r\n\t */\r\n\tgetPaddingTop(): number;\r\n\r\n\t/**\r\n\t * Returns a bottom padding.\r\n\t */\r\n\tgetPaddingBottom(): number;\r\n\r\n\t/**\r\n\t * Returns a corner radius.\r\n\t */\r\n\tgetCornerRadius(): number;\r\n\r\n\t/**\r\n\t * Returns a corner mask.\r\n\t */\r\n\tgetCornerMask(): DCornerMask;\r\n\r\n\t/**\r\n\t * Returns an outline color.\r\n\t * If the color is null, outlines are not be rendered.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetOutlineColor( state: DBaseState ): number | null;\r\n\r\n\t/**\r\n\t * Returns an outline alpha.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetOutlineAlpha( state: DBaseState ): number;\r\n\r\n\t/**\r\n\t * Returns an outline width.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetOutlineWidth( state: DBaseState ): number;\r\n\r\n\t/**\r\n\t * Returns an outline offset.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetOutlineOffset( state: DBaseState ): number;\r\n\r\n\t/**\r\n\t * Returns an outline align.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetOutlineAlign( state: DBaseState ): number;\r\n\r\n\t/**\r\n\t * Returns an outline mask.\r\n\t *\r\n\t * @param state a state\r\n\t */\r\n\tgetOutlineMask( state: DBaseState ): DBorderMask;\r\n\r\n\t/**\r\n\t * Returns a shadow.\r\n\t * If a shadow is null, no shadow is rendered.\r\n\t */\r\n\tgetShadow(): DShadow | null;\r\n\r\n\t/**\r\n\t * Returns an interactivity.\r\n\t */\r\n\tgetInteractive(): DBaseInteractive;\r\n\r\n\t/**\r\n\t * Returns a tooltip text.\r\n\t */\r\n\tgetTitle(): string;\r\n\r\n\t/**\r\n\t * Returns a clear type.\r\n\t * A clear type is for layout classes including {@link DLayoutVertical}.\r\n\t */\r\n\tgetClearType(): DLayoutClearType;\r\n\r\n\t/**\r\n\t * Returns a weight.\r\n\t * Weights are for layout classes including {@link DLayoutVertical}.\r\n\t * If a weight is less than or equals to zero, layout classes are supposed not to change a width / height.\r\n\t */\r\n\tgetWeight(): number;\r\n\r\n\t/**\r\n\t * Creates a new shadow.\r\n\t */\r\n\tnewShadow(): DShadow | null;\r\n\r\n\t/**\r\n\t * Creates a new weak shadow.\r\n\t */\r\n\tnewShadowWeak(): DShadow | null;\r\n\r\n\t/**\r\n\t * Returns a cursor.\r\n\t */\r\n\tgetCursor(): string | null;\r\n}\r\n\r\nconst toTheme = <THEME extends DThemeBase>( options?: DBaseOptions<THEME> ): THEME | null => {\r\n\tif( options != null && options.theme != null ) {\r\n\t\tconst theme = options.theme;\r\n\t\tif( isString( theme ) ) {\r\n\t\t\treturn DThemes.getInstance().get( theme );\r\n\t\t} else {\r\n\t\t\treturn theme;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nexport interface DRefitable {\r\n\treadonly width: number;\r\n\treadonly height: number;\r\n}\r\n\r\nconst toShortcuts = <THEME extends DThemeBase>(\r\n\toptions?: DBaseOptions<THEME>\r\n): UtilKeyboardEventShortcut[] | undefined => {\r\n\tif( options != null && ( options.shortcuts != null || options.shortcut != null ) ) {\r\n\t\tconst result: UtilKeyboardEventShortcut[] = [];\r\n\t\tif( options.shortcut != null ) {\r\n\t\t\tresult.push( UtilKeyboardEvent.toShortcut( options.shortcut ) );\r\n\t\t}\r\n\r\n\t\tif( options.shortcuts != null ) {\r\n\t\t\tconst shortcuts = options.shortcuts;\r\n\t\t\tfor( let i = 0, imax = shortcuts.length; i < imax; ++i ) {\r\n\t\t\t\tUtilKeyboardEvent.toShortcut( shortcuts[ i ] );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\treturn undefined;\r\n};\r\n\r\nexport interface DRenderable {\r\n\trender( renderer: Renderer ): void;\r\n\tupdateTransform(): void;\r\n}\r\n\r\nexport interface DReflowable {\r\n\tonReflow( base: DBase, width: number, height: number ): void;\r\n}\r\n\r\nconst enum AutoFlag {\r\n\tNONE = 0,\r\n\tWIDTH = 1,\r\n\tHEIGHT = 2\r\n}\r\n\r\nexport class DBase<\r\n\tTHEME extends DThemeBase = DThemeBase,\r\n\tOPTIONS extends DBaseOptions<THEME> = DBaseOptions<THEME>\r\n> extends Container {\r\n\tprotected static WORK_CONTAINS_POINT: Point = new Point();\r\n\r\n\tprivate _name: string;\r\n\tprivate _state: DBaseState;\r\n\tprivate _stateLocal: DBaseState;\r\n\tprivate _theme: THEME;\r\n\tprotected _options: OPTIONS | undefined;\r\n\tprivate _width: number;\r\n\tprivate _height: number;\r\n\tprotected _padding: DPadding;\r\n\tprotected _corner: DCorner;\r\n\tprivate _scalarSet: DScalarSet;\r\n\tprotected _autoFlags: AutoFlag;\r\n\tprivate _isDirty: boolean;\r\n\tprivate _hasDirty: boolean;\r\n\tprotected _isChildrenDirty: boolean;\r\n\tprivate _shadow: DShadow | null;\r\n\tprivate _onShadowUpdateBound: () => void;\r\n\tprivate _weight: number;\r\n\tprivate _position: DBasePoint;\r\n\tprivate _scale: DBasePoint;\r\n\tprivate _skew: DBasePoint;\r\n\tprotected _title: string;\r\n\tprotected _background: DBackgroundStateAware;\r\n\tprotected _border: DBorderStateAware;\r\n\tprotected _outline: DOutline;\r\n\tprotected _clearType: DLayoutClearType;\r\n\tprotected _shortcuts?: UtilKeyboardEventShortcut[];\r\n\tprotected _befores: DRenderable[];\r\n\tprotected _afters: DRenderable[];\r\n\tprotected _reflowables: DReflowable[];\r\n\tprotected _lastDownPoint?: Point;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper();\r\n\r\n\t\t// Transform\r\n\t\tconst transform: Transform = this.transform;\r\n\t\tthis._position = new DBasePoint( transform.position, (): void => {\r\n\t\t\tthis.onPositionChanged();\r\n\t\t});\r\n\t\tthis._scale = new DBasePoint( transform.scale, (): void => {\r\n\t\t\tthis.onScaleChanged();\r\n\t\t});\r\n\t\tthis._skew = new DBasePoint( transform.skew, (): void => {\r\n\t\t\tthis.onSkewChanged();\r\n\t\t});\r\n\r\n\t\t//\r\n\t\tthis._options = options;\r\n\t\tconst scalarSet: DScalarSet = this._scalarSet = {};\r\n\t\tthis._autoFlags = AutoFlag.NONE;\r\n\t\tthis._isDirty = true;\r\n\t\tthis._hasDirty = false;\r\n\t\tthis._isChildrenDirty = false;\r\n\t\tthis._shadow = null;\r\n\t\tthis._name = ( options && options.name ) || \"\";\r\n\t\tconst theme = this._theme = toTheme( options ) || this.getThemeDefault();\r\n\t\tthis._befores = [];\r\n\t\tthis._afters = [];\r\n\t\tthis._reflowables = [];\r\n\t\tthis._clearType = ( options && options.clear != null ?\r\n\t\t\t( isString( options.clear ) ? DLayoutClearType[ options.clear ] : options.clear ) :\r\n\t\t\ttheme.getClearType()\r\n\t\t);\r\n\t\tthis._padding = new DBasePadding( theme, options, (): void => {\r\n\t\t\tthis.layout();\r\n\t\t\tthis.toChildrenDirty();\r\n\t\t\tDApplications.update( this );\r\n\t\t});\r\n\t\tconst toDirtyAndUpdate = (): void => {\r\n\t\t\tthis.toDirty();\r\n\t\t\tDApplications.update( this );\r\n\t\t};\r\n\t\tthis._background = new DBaseBackground( theme, options, toDirtyAndUpdate );\r\n\t\tthis._border = new DBaseBorder( theme, options, toDirtyAndUpdate );\r\n\t\tthis._outline = new DBaseOutline( theme, options, toDirtyAndUpdate );\r\n\t\tthis._corner = new DBaseCorner( theme, options, toDirtyAndUpdate );\r\n\t\tthis.initReflowable();\r\n\r\n\t\t// X\r\n\t\tconst position = transform.position;\r\n\t\tconst x = ( options && options.x != null ? options.x : theme.getX() );\r\n\t\tif( isNumber( x ) ) {\r\n\t\t\tposition.x = x;\r\n\t\t} else {\r\n\t\t\tposition.x = 0;\r\n\t\t\tscalarSet.x = DScalarFunctions.position( x );\r\n\t\t}\r\n\r\n\t\t// Y\r\n\t\tconst y = ( options && options.y != null ? options.y : theme.getY() );\r\n\t\tif( isNumber( y ) ) {\r\n\t\t\tposition.y = y;\r\n\t\t} else {\r\n\t\t\tposition.y = 0;\r\n\t\t\tscalarSet.y = DScalarFunctions.position( y );\r\n\t\t}\r\n\r\n\t\t// Width\r\n\t\tconst width = ( options && options.width != null ? options.width : theme.getWidth() );\r\n\t\tif( isNumber( width ) ) {\r\n\t\t\tthis._width = width;\r\n\t\t} else if( width === \"auto\" || width === \"AUTO\" ) {\r\n\t\t\tthis._width = 100;\r\n\t\t\tthis.toWidthAuto();\r\n\t\t} else {\r\n\t\t\tthis._width = 100;\r\n\t\t\tscalarSet.width = DScalarFunctions.size( width );\r\n\t\t}\r\n\r\n\t\t// Height\r\n\t\tconst height = ( options && options.height != null ? options.height : theme.getHeight() );\r\n\t\tif( isNumber( height ) ) {\r\n\t\t\tthis._height = height;\r\n\t\t} else if( height === \"auto\" || height === \"AUTO\" ) {\r\n\t\t\tthis._height = 100;\r\n\t\t\tthis.toHeightAuto();\r\n\t\t} else {\r\n\t\t\tthis._height = 100;\r\n\t\t\tscalarSet.height = DScalarFunctions.size( height );\r\n\t\t}\r\n\r\n\t\t// Visibility\r\n\t\tif( options && options.visible != null ) {\r\n\t\t\tthis.visible = options.visible;\r\n\t\t}\r\n\r\n\t\t// State\r\n\t\tthis._state = DBaseState.NONE;\r\n\t\tthis._stateLocal = DBaseState.NONE;\r\n\r\n\t\t// Interactive\r\n\t\tconst interactive = ( options && options.interactive != null ?\r\n\t\t\t( isString( options.interactive ) ? DBaseInteractive[ options.interactive ] : options.interactive ) :\r\n\t\t\ttheme.getInteractive()\r\n\t\t);\r\n\t\tthis.interactive = ( ( interactive & DBaseInteractive.SELF ) !== 0 );\r\n\t\tthis.interactiveChildren = ( ( interactive & DBaseInteractive.CHILDREN ) !== 0 );\r\n\r\n\t\t// Events\r\n\t\tconst on = options && options.on;\r\n\t\tif( on ) {\r\n\t\t\tfor( const name in on ) {\r\n\t\t\t\tconst handler = on[ name ];\r\n\t\t\t\tif( handler ) {\r\n\t\t\t\t\tthis.on( name, handler );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Title\r\n\t\tthis._title = ( options && options.title != null ? options.title : theme.getTitle() );\r\n\r\n\t\t// Weight\r\n\t\tthis._weight = ( options && options.weight != null ? options.weight : theme.getWeight() );\r\n\r\n\t\t// Shadow\r\n\t\tthis._onShadowUpdateBound = (): void => {\r\n\t\t\tDApplications.update( this );\r\n\t\t};\r\n\t\tconst shadow = (options && options.shadow) || theme.getShadow();\r\n\t\tif( shadow ) {\r\n\t\t\tif( isString( shadow )  ) {\r\n\t\t\t\tswitch( shadow ) {\r\n\t\t\t\tcase \"WEAK\":\r\n\t\t\t\t\tthis.shadow = theme.newShadowWeak();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"DEFAULT\":\r\n\t\t\t\t\tthis.shadow = theme.newShadow();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.shadow = shadow;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Event handlers\r\n\t\tthis.on( UtilPointerEvent.over, ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onOver( e );\r\n\t\t});\r\n\r\n\t\tthis.on( UtilPointerEvent.out, ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onOut( e );\r\n\t\t});\r\n\r\n\t\tthis.on( UtilPointerEvent.down, ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onDown( e );\r\n\t\t});\r\n\r\n\t\tthis.on( UtilPointerEvent.up, ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onUp( e );\r\n\t\t});\r\n\r\n\t\t// Children change detection\r\n\t\tthis.on( \"added\", (): void => {\r\n\t\t\tthis.layout();\r\n\t\t\tif( this.isDirty() || this.hasDirty() ) {\r\n\t\t\t\tthis.toParentHasDirty();\r\n\t\t\t}\r\n\t\t\tif( this._isChildrenDirty ) {\r\n\t\t\t\tthis.toParentChildrenDirty();\r\n\t\t\t}\r\n\t\t\tthis.updateState();\r\n\t\t\tDApplications.update( this );\r\n\t\t});\r\n\r\n\t\tthis.on( \"removed\", (): void => {\r\n\t\t\tthis.blur( true );\r\n\t\t\tthis.updateState();\r\n\t\t\tDApplications.update( this );\r\n\t\t});\r\n\r\n\t\t// Shortcut\r\n\t\tconst shortcuts = this._shortcuts = toShortcuts( options );\r\n\t\tif( shortcuts != null ) {\r\n\t\t\tconst onShortcutBound = ( e: KeyboardEvent ): void => {\r\n\t\t\t\tthis.onShortcut( e );\r\n\t\t\t};\r\n\t\t\tfor( let i = 0, imax = shortcuts.length; i < imax; ++i ) {\r\n\t\t\t\tUtilKeyboardEvent.on( this, shortcuts[ i ], onShortcutBound );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Cursor\r\n\t\tlet cursor: string | null | undefined = options && options.cursor;\r\n\t\tif( cursor == null ) {\r\n\t\t\tcursor = theme.getCursor();\r\n\t\t}\r\n\t\tif( cursor != null ) {\r\n\t\t\tthis.cursor = cursor;\r\n\t\t}\r\n\r\n\t\t// Other initialization\r\n\t\tthis.init( options );\r\n\r\n\t\t// State Override\r\n\t\tif( options && options.state != null ) {\r\n\t\t\tif( isString( options.state ) ) {\r\n\t\t\t\tthis.setState( DBaseState[ options.state ], true );\r\n\t\t\t} else if( isNumber( options.state ) ) {\r\n\t\t\t\tthis.setState( options.state, true );\r\n\t\t\t} else {\r\n\t\t\t\tconst states = options.state;\r\n\t\t\t\tfor( let i = 0, imax = states.length; i < imax; ++i ) {\r\n\t\t\t\t\tthis.setState( DBaseState[ states[ i ] ], true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Parent\r\n\t\tif( options && options.parent != null ) {\r\n\t\t\toptions.parent.addChild( this );\r\n\t\t}\r\n\r\n\t\t// Children\r\n\t\tif( options && options.children != null ) {\r\n\t\t\tconst children = options.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child != null ) {\r\n\t\t\t\t\tthis.addChild( child );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Done\r\n\t\tthis.emit( \"init\", this );\r\n\t}\r\n\r\n\tprependRenderable( renderable: DRenderable, phase: boolean ): void {\r\n\t\t(renderable as any).parent = this;\r\n\t\tconst list = ( phase ? this._befores : this._afters );\r\n\t\tlist.unshift( renderable );\r\n\t}\r\n\r\n\tappendRenderable( renderable: DRenderable, phase: boolean ): void {\r\n\t\t(renderable as any).parent = this;\r\n\t\tconst list = ( phase ? this._befores : this._afters );\r\n\t\tlist.push( renderable );\r\n\t}\r\n\r\n\tremoveRenderable( renderable: DRenderable, phase: boolean ): void {\r\n\t\t(renderable as any).parent = null;\r\n\t\tconst list = ( phase ? this._befores : this._afters );\r\n\t\tconst index = list.indexOf( renderable );\r\n\t\tif( 0 <= index ) {\r\n\t\t\tlist.splice( index, 1 );\r\n\t\t}\r\n\t}\r\n\r\n\taddReflowable( reflowable: DReflowable ): void {\r\n\t\tthis._reflowables.push( reflowable );\r\n\t}\r\n\r\n\tremoveReflowable( reflowable: DReflowable ): void {\r\n\t\tconst reflowables = this._reflowables;\r\n\t\tconst index = reflowables.indexOf( reflowable );\r\n\t\tif( 0 <= index ) {\r\n\t\t\treflowables.splice( index, 1 );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected initReflowable(): void {\r\n\t\tnew DBaseReflowable( this );\r\n\t}\r\n\r\n\tprotected onChildrenChange(): void {\r\n\t\tthis.toChildrenDirty();\r\n\t\tsuper.onChildrenChange();\r\n\t}\r\n\r\n\tprotected onShortcut( e: KeyboardEvent ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\t// OTHER INITIALIZATIONS BEFORE `parent.addChild( this )`\r\n\t}\r\n\r\n\tget weight(): number {\r\n\t\treturn this._weight;\r\n\t}\r\n\r\n\tprotected onPositionChanged(): void {\r\n\t\tthis.moveChildren();\r\n\t\tDApplications.update( this );\r\n\t\tthis.emit( \"move\", this );\r\n\t}\r\n\r\n\tresize( width: number, height: number ): boolean {\r\n\t\tconst oldWidth = this._width;\r\n\t\tconst oldHeight = this._height;\r\n\t\tconst widthResized = oldWidth !== width;\r\n\t\tconst heightResized = oldHeight !== height;\r\n\r\n\t\tif( widthResized ) {\r\n\t\t\tthis._width = width;\r\n\t\t}\r\n\r\n\t\tif( heightResized ) {\r\n\t\t\tthis._height = height;\r\n\t\t}\r\n\r\n\t\tconst resized = widthResized || heightResized;\r\n\t\tif( resized ) {\r\n\t\t\tthis.onResize( width, height, oldWidth, oldHeight );\r\n\t\t}\r\n\r\n\t\tif( widthResized ) {\r\n\t\t\tconst scalarSet = this._scalarSet;\r\n\t\t\tif( scalarSet.x != null ) {\r\n\t\t\t\tconst position = this.transform.position;\r\n\t\t\t\tconst parent = this.getParentOfSize();\r\n\t\t\t\tif( parent ) {\r\n\t\t\t\t\tthis.x = scalarSet.x( parent.width, width, parent.padding.getLeft(), position.x );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( heightResized ) {\r\n\t\t\tconst scalarSet = this._scalarSet;\r\n\t\t\tif( scalarSet.y != null ) {\r\n\t\t\t\tconst position = this.transform.position;\r\n\t\t\t\tconst parent = this.getParentOfSize();\r\n\t\t\t\tif( parent ) {\r\n\t\t\t\t\tthis.y = scalarSet.y( parent.height, height, parent.padding.getTop(), position.y );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn resized;\r\n\t}\r\n\r\n\tgetClearType(): DLayoutClearType {\r\n\t\treturn this._clearType;\r\n\t}\r\n\r\n\tonResize( newWidth: number, newHeight: number, oldWidth: number, oldHeight: number ): void {\r\n\t\tthis.toDirty();\r\n\t\tthis.toChildrenDirty();\r\n\t\tthis.resizeChildren();\r\n\t\tDApplications.update( this );\r\n\t\tthis.emit( \"resize\", newWidth, newHeight, oldWidth, oldHeight, this );\r\n\t}\r\n\r\n\tprotected onScaleChanged(): void {\r\n\t\tDApplications.update( this );\r\n\t\tthis.emit( \"scale\", this );\r\n\t}\r\n\r\n\tprotected onSkewChanged(): void {\r\n\t\tDApplications.update( this );\r\n\t\tthis.emit( \"skew\", this );\r\n\t}\r\n\r\n\tget type(): string {\r\n\t\treturn this.getType();\r\n\t}\r\n\r\n\tget name(): string {\r\n\t\treturn this._name;\r\n\t}\r\n\r\n\tset name( name: string ) {\r\n\t\tthis._name = name;\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._position.x;\r\n\t}\r\n\r\n\tset x( x: number ) {\r\n\t\tthis._position.x = x;\r\n\t}\r\n\r\n\tgetX(): DCoordinatePosition {\r\n\t\tconst scalarSet = this._scalarSet;\r\n\t\tif( scalarSet.x != null ) {\r\n\t\t\treturn scalarSet.x;\r\n\t\t} else {\r\n\t\t\treturn this.x;\r\n\t\t}\r\n\t}\r\n\r\n\tsetX( x: DCoordinatePosition ) {\r\n\t\tif( isNumber( x ) ) {\r\n\t\t\tthis.x = x;\r\n\t\t} else {\r\n\t\t\tconst scalarSet = this._scalarSet;\r\n\t\t\tconst scalar = DScalarFunctions.position( x );\r\n\t\t\tif( scalarSet.x !== scalar ) {\r\n\t\t\t\tscalarSet.x = scalar;\r\n\t\t\t\tthis.layout();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._position.y;\r\n\t}\r\n\r\n\tset y( y: number ) {\r\n\t\tthis._position.y = y;\r\n\t}\r\n\r\n\tgetY(): DCoordinatePosition {\r\n\t\tconst scalarSet = this._scalarSet;\r\n\t\tif( scalarSet.y != null ) {\r\n\t\t\treturn scalarSet.y;\r\n\t\t} else {\r\n\t\t\treturn this.y;\r\n\t\t}\r\n\t}\r\n\r\n\tsetY( y: DCoordinatePosition ) {\r\n\t\tif( isNumber( y ) ) {\r\n\t\t\tthis.y = y;\r\n\t\t} else {\r\n\t\t\tconst scalarSet = this._scalarSet;\r\n\t\t\tconst scalar = DScalarFunctions.position( y );\r\n\t\t\tif( scalarSet.y !== scalar ) {\r\n\t\t\t\tscalarSet.y = scalar;\r\n\t\t\t\tthis.layout();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tconst oldWidth = this._width;\r\n\t\tif( oldWidth !== width ) {\r\n\t\t\tthis._width = width;\r\n\t\t\tconst height = this._height;\r\n\t\t\tthis.onResize( width, height, oldWidth, height );\r\n\r\n\t\t\t// Layout\r\n\t\t\tconst scalarSet = this._scalarSet;\r\n\t\t\tif( scalarSet.x != null ) {\r\n\t\t\t\tconst position = this.transform.position;\r\n\t\t\t\tconst parent = this.getParentOfSize();\r\n\t\t\t\tif( parent ) {\r\n\t\t\t\t\tthis.x = scalarSet.x( parent.width, width, parent.padding.getLeft(), position.x );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toWidthAuto() {\r\n\t\tthis._autoFlags |= AutoFlag.WIDTH;\r\n\t}\r\n\r\n\tprotected isWidthAuto(): boolean {\r\n\t\treturn ( this._autoFlags & AutoFlag.WIDTH ) !== 0;\r\n\t}\r\n\r\n\tgetWidth(): DCoordinateSize {\r\n\t\tconst scalarSet = this._scalarSet;\r\n\t\tif( this.isWidthAuto() ) {\r\n\t\t\treturn \"auto\";\r\n\t\t} else if( scalarSet.width != null ) {\r\n\t\t\treturn scalarSet.width;\r\n\t\t} else {\r\n\t\t\treturn this.width;\r\n\t\t}\r\n\t}\r\n\r\n\tsetWidth( width: DCoordinateSize ) {\r\n\t\tif( isNumber( width ) ) {\r\n\t\t\tthis.width = width;\r\n\t\t} else if( width === \"auto\" || width === \"AUTO\" ) {\r\n\t\t\tif( ! this.isWidthAuto() ) {\r\n\t\t\t\tthis.toWidthAuto();\r\n\t\t\t\tthis.toChildrenDirty();\r\n\t\t\t\tDApplications.update( this );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst scalarSet = this._scalarSet;\r\n\t\t\tconst scalar = DScalarFunctions.size( width );\r\n\t\t\tif( scalarSet.width !== scalar ) {\r\n\t\t\t\tscalarSet.width = scalar;\r\n\t\t\t\tthis.layout();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tset height( height: number ) {\r\n\t\tconst oldHeight = this._height;\r\n\t\tif( oldHeight !== height ) {\r\n\t\t\tthis._height = height;\r\n\t\t\tconst width = this._width;\r\n\t\t\tthis.onResize( width, height, width, oldHeight );\r\n\r\n\t\t\t// Layout\r\n\t\t\tconst scalarSet = this._scalarSet;\r\n\t\t\tif( scalarSet.y != null ) {\r\n\t\t\t\tconst position = this.transform.position;\r\n\t\t\t\tconst parent = this.getParentOfSize();\r\n\t\t\t\tif( parent ) {\r\n\t\t\t\t\tthis.y = scalarSet.y( parent.height, height, parent.padding.getTop(), position.y );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toHeightAuto() {\r\n\t\tthis._autoFlags |= AutoFlag.HEIGHT;\r\n\t}\r\n\r\n\tprotected isHeightAuto(): boolean {\r\n\t\treturn ( this._autoFlags & AutoFlag.HEIGHT ) !== 0;\r\n\t}\r\n\r\n\tgetHeight(): DCoordinateSize {\r\n\t\tconst scalarSet = this._scalarSet;\r\n\t\tif( this.isHeightAuto() ) {\r\n\t\t\treturn \"auto\";\r\n\t\t} else if( scalarSet.height != null ) {\r\n\t\t\treturn scalarSet.height;\r\n\t\t} else {\r\n\t\t\treturn this.height;\r\n\t\t}\r\n\t}\r\n\r\n\tsetHeight( height: DCoordinateSize ) {\r\n\t\tif( isNumber( height ) ) {\r\n\t\t\tthis.height = height;\r\n\t\t} else if( height === \"auto\" || height === \"AUTO\" ) {\r\n\t\t\tif( ! this.isHeightAuto() ) {\r\n\t\t\t\tthis.toHeightAuto();\r\n\t\t\t\tthis.toChildrenDirty();\r\n\t\t\t\tDApplications.update( this );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst scalarSet = this._scalarSet;\r\n\t\t\tconst scalar = DScalarFunctions.size( height );\r\n\t\t\tif( scalarSet.height !== scalar ) {\r\n\t\t\t\tscalarSet.height = scalar;\r\n\t\t\t\tthis.layout();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget position(): DBasePoint {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tget scale(): DBasePoint {\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\tget skew(): DBasePoint {\r\n\t\treturn this._skew;\r\n\t}\r\n\r\n\tget padding(): DPadding {\r\n\t\treturn this._padding;\r\n\t}\r\n\r\n\tget corner(): DCorner {\r\n\t\treturn this._corner;\r\n\t}\r\n\r\n\tget background(): DBackgroundStateAware {\r\n\t\treturn this._background;\r\n\t}\r\n\r\n\tget border(): DBorderStateAware {\r\n\t\treturn this._border;\r\n\t}\r\n\r\n\tget outline(): DOutline {\r\n\t\treturn this._outline;\r\n\t}\r\n\r\n\tget unsafe(): Transform {\r\n\t\treturn this.transform;\r\n\t}\r\n\r\n\tget title(): string {\r\n\t\treturn this._title;\r\n\t}\r\n\r\n\tset title( title: string ) {\r\n\t\tif( this._title !== title ) {\r\n\t\t\tthis._title = title;\r\n\t\t\tif( this.isHovered() ) {\r\n\t\t\t\tthis.applyTitle();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected applyTitle(): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tlayer.view.title = this._title;\r\n\t\t}\r\n\t}\r\n\r\n\tshow(): this {\r\n\t\tif( ! this.visible ) {\r\n\t\t\tthis.visible = true;\r\n\t\t\tthis.toParentChildrenDirty();\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tisShown(): boolean {\r\n\t\treturn this.visible;\r\n\t}\r\n\r\n\thide(): this {\r\n\t\tif( this.visible ) {\r\n\t\t\tthis.visible = false;\r\n\t\t\tthis.toParentChildrenDirty();\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tisHidden(): boolean {\r\n\t\treturn ! this.visible;\r\n\t}\r\n\r\n\ttoDirty(): boolean {\r\n\t\tif( ! this._isDirty ) {\r\n\t\t\tthis._isDirty = true;\r\n\t\t\tthis.toParentHasDirty();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\ttoHasDirty(): boolean {\r\n\t\tif( ! this._hasDirty ) {\r\n\t\t\tthis._hasDirty = true;\r\n\t\t\tthis.toParentHasDirty();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\ttoParentHasDirty(): void {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent instanceof DBase ) {\r\n\t\t\tparent.toHasDirty();\r\n\t\t}\r\n\t}\r\n\r\n\ttoChildrenDirty(): boolean {\r\n\t\tif( ! this._isChildrenDirty ) {\r\n\t\t\tthis._isChildrenDirty = true;\r\n\t\t\tthis.onChildrenDirty();\r\n\t\t\tthis.toParentChildrenDirty();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\ttoParentChildrenDirty(): void {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent instanceof DBase ) {\r\n\t\t\tparent.toChildrenDirty();\r\n\t\t}\r\n\t}\r\n\r\n\tisChildrenDirty(): boolean {\r\n\t\treturn this._isChildrenDirty;\r\n\t}\r\n\r\n\tprotected onChildrenDirty() {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tisDirty() {\r\n\t\treturn this._isDirty;\r\n\t}\r\n\r\n\thasDirty() {\r\n\t\treturn this._hasDirty;\r\n\t}\r\n\r\n\tsetHovered( isHovered: boolean ) {\r\n\t\treturn this.setState( DBaseState.HOVERED, isHovered );\r\n\t}\r\n\r\n\tsetActive( isActive: boolean ) {\r\n\t\treturn this.setState( DBaseState.ACTIVE, isActive );\r\n\t}\r\n\r\n\tsetPressed( isPressed: boolean ) {\r\n\t\treturn this.setState( DBaseState.PRESSED, isPressed );\r\n\t}\r\n\r\n\tsetReadOnly( isReadOnly: boolean ) {\r\n\t\treturn this.setState( DBaseState.READ_ONLY, isReadOnly );\r\n\t}\r\n\r\n\tsetDisabled( isDisabled: boolean ) {\r\n\t\treturn this.setState( DBaseState.DISABLED, isDisabled );\r\n\t}\r\n\r\n\tsetDragging( isDragging: boolean ) {\r\n\t\treturn this.setState( DBaseState.DRAGGING, isDragging );\r\n\t}\r\n\r\n\tsetInvalid( isInvalid: boolean ) {\r\n\t\treturn this.setState( DBaseState.INVALID, isInvalid );\r\n\t}\r\n\r\n\tsetSucceeded( isSucceeded: boolean ) {\r\n\t\treturn this.setState( DBaseState.SUCCEEDED, isSucceeded );\r\n\t}\r\n\r\n\tsetFailed( isFailed: boolean ) {\r\n\t\treturn this.setState( DBaseState.FAILED, isFailed );\r\n\t}\r\n\r\n\tsetFocused( isFocused: boolean ) {\r\n\t\tif( this.isFocused() !== isFocused ) {\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.getFocusController().setFocused( this, isFocused, false );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tfocus(): this {\r\n\t\treturn this.setFocused( true );\r\n\t}\r\n\r\n\tblur( recursively?: boolean ): this {\r\n\t\tif( recursively ) {\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\t\tconst focused = focusController.getFocused();\r\n\t\t\t\tif( focused instanceof DBase ) {\r\n\t\t\t\t\tlet current: Container = focused;\r\n\t\t\t\t\twhile( current ) {\r\n\t\t\t\t\t\tif( current === this ) {\r\n\t\t\t\t\t\t\tfocused.setFocused( false );\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcurrent = current.parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.setFocused( false );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tisHovered(): boolean {\r\n\t\treturn this.hasState( DBaseState.HOVERED );\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.hasState( DBaseState.ACTIVE );\r\n\t}\r\n\r\n\tisActiveIn(): boolean {\r\n\t\treturn this.hasState( DBaseState.ACTIVE | DBaseState.ACTIVE_IN );\r\n\t}\r\n\r\n\tisPressed(): boolean {\r\n\t\treturn this.hasState( DBaseState.PRESSED );\r\n\t}\r\n\r\n\tisReadOnly(): boolean {\r\n\t\treturn this.hasState( DBaseState.READ_ONLY );\r\n\t}\r\n\r\n\tisDisabled(): boolean {\r\n\t\treturn this.hasState( DBaseState.DISABLED );\r\n\t}\r\n\r\n\tisActionable(): boolean {\r\n\t\treturn ! this.hasState( DBaseState.DISABLED | DBaseState.READ_ONLY );\r\n\t}\r\n\r\n\tisDragging(): boolean {\r\n\t\treturn this.hasState( DBaseState.DRAGGING );\r\n\t}\r\n\r\n\tisFocused(): boolean {\r\n\t\treturn this.hasState( DBaseState.FOCUSED );\r\n\t}\r\n\r\n\tisFocusedIn(): boolean {\r\n\t\treturn this.hasState( DBaseState.FOCUSED | DBaseState.FOCUSED_IN );\r\n\t}\r\n\r\n\tisUnfocusable(): boolean {\r\n\t\treturn this.hasState( DBaseState.UNFOCUSABLE );\r\n\t}\r\n\r\n\tisInvalid(): boolean {\r\n\t\treturn this.hasState( DBaseState.INVALID );\r\n\t}\r\n\r\n\tisSucceeded(): boolean {\r\n\t\treturn this.hasState( DBaseState.SUCCEEDED );\r\n\t}\r\n\r\n\tisFailed(): boolean {\r\n\t\treturn this.hasState( DBaseState.FAILED );\r\n\t}\r\n\r\n\tsetState( state: DBaseState, isOn: boolean ) {\r\n\t\tconst oldStateLocal = this._stateLocal;\r\n\t\tconst newStateLocal = ( isOn ? (oldStateLocal | state) : (oldStateLocal & ~state) );\r\n\t\tif( oldStateLocal !== newStateLocal ) {\r\n\t\t\tthis._stateLocal = newStateLocal;\r\n\t\t\tthis.updateState();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetStates( statesOn: DBaseState, statesOff: DBaseState ) {\r\n\t\tconst oldStateLocal = this._stateLocal;\r\n\t\tconst newStateLocal = ( (oldStateLocal | statesOn) & ~statesOff );\r\n\t\tif( oldStateLocal !== newStateLocal ) {\r\n\t\t\tthis._stateLocal = newStateLocal;\r\n\t\t\tthis.updateState();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprotected updateState(): void {\r\n\t\tconst parent = this.parent;\r\n\t\tconst stateLocal = this._stateLocal;\r\n\t\tconst newState = ( parent instanceof DBase ?\r\n\t\t\tthis.mergeState( stateLocal, parent.state ) :\r\n\t\t\tstateLocal\r\n\t\t);\r\n\t\tconst oldState = this._state;\r\n\t\tif( oldState !== newState ) {\r\n\t\t\tthis._state = newState;\r\n\t\t\tthis.onStateChange( newState, oldState );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn stateLocal |\r\n\t\t\t( stateParent & DBaseState.DISABLED ) |\r\n\t\t\t( stateParent & DBaseState.READ_ONLY ) |\r\n\t\t\t( stateParent & (DBaseState.FOCUSED | DBaseState.FOCUSED_IN) ? DBaseState.FOCUSED_IN : DBaseState.NONE ) |\r\n\t\t\t( stateParent & (DBaseState.ACTIVE | DBaseState.ACTIVE_IN) ? DBaseState.ACTIVE_IN : DBaseState.NONE );\r\n\t}\r\n\r\n\tprotected onStateChange( newState: number, oldState: number ) {\r\n\t\tthis.toDirty();\r\n\t\tDApplications.update( this );\r\n\t\tthis.emit( \"statechange\", newState, oldState, this );\r\n\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\tchild.onParentStateChange( newState, oldState );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( DBaseStates.isFocused( newState ) ) {\r\n\t\t\tif( ! DBaseStates.isFocused( oldState ) ) {\r\n\t\t\t\tthis.onFocused();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( DBaseStates.isFocused( oldState ) ) {\r\n\t\t\t\tthis.onBlured();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onChildFocused( focused: DBase ): void {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent instanceof DBase ) {\r\n\t\t\tparent.onChildFocused( focused );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onFocused(): void {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent instanceof DBase ) {\r\n\t\t\tparent.onChildFocused( this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onBlured(): void {\r\n\t\t//\r\n\t}\r\n\r\n\tprotected onParentStateChange( newStateParent: number, oldStateParent: number ) {\r\n\t\tconst newState = this.mergeState( this._stateLocal, newStateParent );\r\n\t\tconst oldState = this._state;\r\n\t\tif( oldState !== newState ) {\r\n\t\t\tthis._state = newState;\r\n\t\t\tthis.onStateChange( newState, oldState );\r\n\t\t}\r\n\t}\r\n\r\n\tget state(): DBaseState {\r\n\t\treturn this._state;\r\n\t}\r\n\r\n\tgetState(): DBaseState {\r\n\t\treturn this._state;\r\n\t}\r\n\r\n\thasState( state: DBaseState ): boolean {\r\n\t\treturn !! ( this._state & state );\r\n\t}\r\n\r\n\tget theme(): THEME {\r\n\t\treturn this._theme;\r\n\t}\r\n\r\n\tset theme( theme: THEME ) {\r\n\t\tconst result = this._theme;\r\n\t\tif( result !== theme ) {\r\n\t\t\tthis._theme = theme;\r\n\t\t\tthis._padding.setTheme( theme );\r\n\t\t\tthis._background.setTheme( theme );\r\n\t\t\tthis._border.setTheme( theme );\r\n\t\t\tthis._outline.setTheme( theme );\r\n\t\t\tthis._corner.setTheme( theme );\r\n\t\t\tthis.toDirty();\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t}\r\n\r\n\trefit(): void {\r\n\t\tif( this._isChildrenDirty ) {\r\n\t\t\tthis._isChildrenDirty = false;\r\n\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\t\tchild.refit();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.onRefit();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onRefit(): void {\r\n\t\tconst isWidthAuto = this.isWidthAuto();\r\n\t\tconst isHeightAuto = this.isHeightAuto();\r\n\t\tif( isWidthAuto && isHeightAuto ) {\r\n\t\t\tlet width = 0;\r\n\t\t\tlet height = 0;\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child.visible ) {\r\n\t\t\t\t\tif( this.hasRefitableWidth( child ) ) {\r\n\t\t\t\t\t\twidth = Math.max( width, child.x + child.width );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( this.hasRefitableHeight( child ) ) {\r\n\t\t\t\t\t\theight = Math.max( height, child.y + child.height );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst padding = this.padding;\r\n\t\t\tthis.resize( width + padding.getRight(), height + padding.getBottom() );\r\n\t\t} else if( isWidthAuto ) {\r\n\t\t\tlet width = 0;\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child.visible && this.hasRefitableWidth( child ) ) {\r\n\t\t\t\t\twidth = Math.max( width, child.x + child.width );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst padding = this.padding;\r\n\t\t\tthis.width = width + padding.getRight();\r\n\t\t} else if( isHeightAuto ) {\r\n\t\t\tlet height = 0;\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child.visible && this.hasRefitableHeight( child ) ) {\r\n\t\t\t\t\theight = Math.max( height, child.y + child.height );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst padding = this.padding;\r\n\t\t\tthis.height = height + padding.getBottom();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected isRefitable( target: any ): target is DRefitable {\r\n\t\treturn target instanceof DBase;\r\n\t}\r\n\r\n\tprotected hasRefitableHeight( target: any ): target is DRefitable {\r\n\t\treturn this.isRefitable( target ) &&\r\n\t\t\t! ( target instanceof DBase && isFunction( target.getHeight() ) );\r\n\t}\r\n\r\n\tprotected hasRefitableWidth( target: any ): target is DBase<any, any> {\r\n\t\treturn this.isRefitable( target ) &&\r\n\t\t\t! ( target instanceof DBase && isFunction( target.getWidth() ) );\r\n\t}\r\n\r\n\treflow(): void {\r\n\t\tif( this._isDirty ) {\r\n\t\t\tthis.onReflow();\r\n\t\t\tthis._isDirty = false;\r\n\t\t}\r\n\r\n\t\tif( this._hasDirty ) {\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\t\tchild.reflow();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._hasDirty = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onReflow(): void {\r\n\t\tconst width = this._width;\r\n\t\tconst height = this._height;\r\n\t\tconst reflowables = this._reflowables;\r\n\t\tfor( let i = 0, imax = reflowables.length; i < imax; ++i ) {\r\n\t\t\treflowables[ i ].onReflow( this, width, height );\r\n\t\t}\r\n\t}\r\n\r\n\tget shadow(): DShadow | null {\r\n\t\treturn this._shadow;\r\n\t}\r\n\r\n\tset shadow( shadow: DShadow | null ) {\r\n\t\tconst previous = this._shadow;\r\n\t\tif( previous !== shadow ) {\r\n\t\t\tif( previous != null ) {\r\n\t\t\t\tprevious.off( \"update\", this._onShadowUpdateBound );\r\n\t\t\t\tthis.removeReflowable( previous );\r\n\t\t\t\tthis.removeRenderable( previous, true );\r\n\t\t\t}\r\n\r\n\t\t\tthis._shadow = shadow;\r\n\t\t\tif( shadow != null ) {\r\n\t\t\t\tshadow.on( \"update\", this._onShadowUpdateBound );\r\n\t\t\t\tthis.addReflowable( shadow );\r\n\t\t\t\tthis.prependRenderable( shadow, true );\r\n\t\t\t}\r\n\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t}\r\n\r\n\tlayout(): void {\r\n\t\tconst parent = this.getParentOfSize();\r\n\t\tif( parent ) {\r\n\t\t\tthis.onParentResize( parent.width, parent.height, parent.padding );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getParentOfSize(): { width: number, height: number, padding: DPadding } | null {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent instanceof DBase ) {\r\n\t\t\treturn parent;\r\n\t\t} else {\r\n\t\t\treturn DApplications.getLayer( this );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Called when a parent resized.\r\n\t *\r\n\t * @param parentWidth a parent's local width\r\n\t * @param parentHeight a parent's local height\r\n\t */\r\n\tonParentResize( parentWidth: number, parentHeight: number, parentPadding: DPadding ): void {\r\n\t\tconst scalarSet = this._scalarSet;\r\n\t\tconst position = this.transform.position;\r\n\t\tconst x = position.x;\r\n\t\tconst y = position.y;\r\n\t\tconst width = this._width;\r\n\t\tconst height = this._height;\r\n\r\n\t\t// Width & height\r\n\t\tconst paddingWidth = parentPadding.getLeft() + parentPadding.getRight();\r\n\t\tconst paddingHeight = parentPadding.getTop() + parentPadding.getBottom();\r\n\t\tconst newWidth = ( scalarSet.width != null ?\r\n\t\t\tscalarSet.width( parentWidth, width, paddingWidth, width ) : width );\r\n\t\tconst newHeight = ( scalarSet.height != null ?\r\n\t\t\tscalarSet.height( parentHeight, height, paddingHeight, height ) : height );\r\n\t\tthis.resize( newWidth, newHeight );\r\n\r\n\t\t// X & Y\r\n\t\tconst newX = ( scalarSet.x != null ? scalarSet.x( parentWidth, this._width, parentPadding.getLeft(), x ) : x );\r\n\t\tconst newY = ( scalarSet.y != null ? scalarSet.y( parentHeight, this._height, parentPadding.getTop(), y ) : y );\r\n\t\tthis.position.set( newX, newY );\r\n\t}\r\n\r\n\tresizeChildren(): void {\r\n\t\tconst width = this._width;\r\n\t\tconst height = this._height;\r\n\t\tconst padding = this._padding;\r\n\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\tchild.onParentResize( width, height, padding );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Called when a parent moved.\r\n\t *\r\n\t * @param x a parent's local x position\r\n\t * @param y a parent's local y position\r\n\t */\r\n\tonParentMove( x: number, y: number ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected moveChildren() {\r\n\t\tconst x = this.x;\r\n\t\tconst y = this.y;\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\tchild.onParentMove( x, y );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Wheel\r\n\tonWheel( e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point ): boolean {\r\n\t\tthis.emit( \"wheel\", e, deltas, global, this );\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Keydown\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tthis.emit( \"keydown\", e, this );\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonKeyUp( e: KeyboardEvent ): boolean {\r\n\t\tthis.emit( \"keyup\", e, this );\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Down\r\n\tprotected isEventTarget( e: InteractionEvent ): boolean {\r\n\t\tconst target = e.target;\r\n\t\tif( target === this ) {\r\n\t\t\treturn true;\r\n\t\t} else if( !( target instanceof DBase ) ) {\r\n\t\t\tlet parent = target.parent;\r\n\t\t\twhile( parent != null && ! ( parent instanceof DBase ) ) {\r\n\t\t\t\tparent = parent.parent;\r\n\t\t\t}\r\n\t\t\treturn ( parent === this );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected onDown( e: InteractionEvent ): void {\r\n\t\tif( this.isEventTarget( e ) ) {\r\n\t\t\tthis.onDownThis( e );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onDownThis( e: InteractionEvent ): void {\r\n\t\tconst oe = e.data.originalEvent;\r\n\t\tif( \"touches\" in oe ) {\r\n\t\t\tconst lastDownPoint = this._lastDownPoint || new Point();\r\n\t\t\tthis._lastDownPoint = lastDownPoint;\r\n\t\t\tlastDownPoint.copyFrom( e.data.global );\r\n\t\t} else {\r\n\t\t\tthis.focusOnClosest();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onUp( e: InteractionEvent ): void {\r\n\t\tif( this.isEventTarget( e ) ) {\r\n\t\t\tthis.onUpThis( e );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onUpThis( e: InteractionEvent ): void {\r\n\t\tconst oe = e.data.originalEvent;\r\n\t\tif( \"touches\" in oe ) {\r\n\t\t\tconst lastDownPoint = this._lastDownPoint;\r\n\t\t\tif( lastDownPoint ) {\r\n\t\t\t\tconst global = e.data.global;\r\n\t\t\t\tconst dx = Math.abs( global.x - lastDownPoint.x );\r\n\t\t\t\tconst dy = Math.abs( global.y - lastDownPoint.y );\r\n\t\t\t\tconst threshold = UtilPointerEvent.CLICK_DISTANCE_THRESHOLD;\r\n\t\t\t\tif( dx < threshold && dy < threshold ) {\r\n\t\t\t\t\tthis.focusOnClosest();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected focusOnClosest(): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\tfocusController.setFocused( focusController.findFocusableParent( this ), true, true );\r\n\t\t}\r\n\t}\r\n\r\n\t// Over\r\n\tprotected onOver( e: InteractionEvent ): void {\r\n\t\t// Hover\r\n\t\tthis.setHovered( true );\r\n\r\n\t\t// Title\r\n\t\tif( e.target === this ) {\r\n\t\t\tthis.applyTitle();\r\n\t\t}\r\n\t}\r\n\r\n\t// Out\r\n\tprotected onOut( e: InteractionEvent ): void {\r\n\t\tthis.setHovered( false );\r\n\t}\r\n\r\n\t// Double click\r\n\tonDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean {\r\n\t\tthis.emit( \"dblclick\", e, interactionManager, this );\r\n\t\treturn false;\r\n\t}\r\n\r\n\t//\r\n\trender( renderer: Renderer ): void {\r\n\t\tif( this.visible && 0 < this.worldAlpha && this.renderable ) {\r\n\t\t\tthis.renderBefore( renderer );\r\n\t\t\tsuper.render( renderer );\r\n\t\t\tthis.renderAfter( renderer );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected renderBefore( renderer: Renderer ): void {\r\n\t\tconst befores = this._befores;\r\n\t\tfor( let i = 0, imax = befores.length; i < imax; ++i ) {\r\n\t\t\tconst before = befores[ i ];\r\n\t\t\tbefore.updateTransform();\r\n\t\t\tbefore.render( renderer );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected renderAfter( renderer: Renderer ): void {\r\n\t\tconst afters = this._afters;\r\n\t\tfor( let i = 0, imax = afters.length; i < imax; ++i ) {\r\n\t\t\tconst after = afters[ i ];\r\n\t\t\tafter.updateTransform();\r\n\t\t\tafter.render( renderer );\r\n\t\t}\r\n\t}\r\n\r\n\t//\r\n\tprotected getThemeDefault(): THEME {\r\n\t\treturn DThemes.getInstance().get( this.getType() );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DBase\";\r\n\t}\r\n\r\n\t//\r\n\tprotected _calculateBounds(): void {\r\n\t\tconst worldTransform = this.transform.worldTransform;\r\n\t\tconst bounds = this._bounds;\r\n\r\n\t\tconst work = DBase.WORK_CONTAINS_POINT;\r\n\t\twork.set( 0, 0 );\r\n\t\tworldTransform.apply( work, work );\r\n\t\tbounds.addPoint( work );\r\n\r\n\t\twork.set( this._width, this._height );\r\n\t\tworldTransform.apply( work, work );\r\n\t\tbounds.addPoint( work );\r\n\r\n\t\tsuper._calculateBounds();\r\n\t}\r\n\r\n\tcontainsPoint( point: Point ): boolean {\r\n\t\treturn this.containsGlobalPoint( point ) || this.containsLocalPoint(\r\n\t\t\tthis.worldTransform.applyInverse( point, DBase.WORK_CONTAINS_POINT )\r\n\t\t);\r\n\t}\r\n\r\n\tprotected containsGlobalPoint( point: Point ): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected containsLocalPoint( point: Point ): boolean {\r\n\t\treturn (\r\n\t\t\t0 <= point.x && point.x <= this._width &&\r\n\t\t\t0 <= point.y && point.y <= this._height\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a clipping rect.\r\n\t *\r\n\t * @param result a clipping rect\r\n\t */\r\n\tgetClippingRect( target: DBase, result: Rectangle ): void {\r\n\t\tresult.x = 0;\r\n\t\tresult.y = 0;\r\n\t\tresult.width = this._width;\r\n\t\tresult.height = this._height;\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// Layout\r\n\t\tconst scalarSet = this._scalarSet;\r\n\t\tscalarSet.x = null;\r\n\t\tscalarSet.y = null;\r\n\t\tscalarSet.width = null;\r\n\t\tscalarSet.height = null;\r\n\r\n\t\t// Shadow\r\n\t\tconst shadow = this._shadow;\r\n\t\tif( shadow ) {\r\n\t\t\tthis._shadow = null;\r\n\t\t\tshadow.destroy();\r\n\t\t}\r\n\r\n\t\t// Children\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tchildren[ i ].destroy();\r\n\t\t}\r\n\t\tchildren.length = 0;\r\n\r\n\t\t//\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCoordinatePosition, DCoordinateSizeNoAuto } from \"./d-coordinate\";\r\nimport { DScalarExpression } from \"./d-scalar-expression\";\r\nimport { DScalarFunction } from \"./d-scalar-function\";\r\nimport { isFunction } from \"./util/is-function\";\r\nimport { isNumber } from \"./util/is-number\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nconst POSITION_CENTER = ( p: number, s: number ) => ( p - s ) * 0.5;\r\nconst POSITION_PADDING = ( p: number, s: number, d: number ) => d;\r\nconst SIZE_MAXIMIZED = ( p: number ) => p;\r\nconst SIZE_PADDING = ( p: number, s: number, d: number ) => p - d;\r\n\r\nexport class DScalarFunctions {\r\n\tstatic position( coordinate: DCoordinatePosition | undefined ): DScalarFunction | null {\r\n\t\tif( coordinate == null || isNumber( coordinate ) ) {\r\n\t\t\treturn null;\r\n\t\t} else if( isString( coordinate ) ) {\r\n\t\t\tswitch( coordinate ) {\r\n\t\t\tcase \"center\":\r\n\t\t\tcase \"CENTER\":\r\n\t\t\t\treturn POSITION_CENTER;\r\n\t\t\tcase \"padding\":\r\n\t\t\tcase \"PADDING\":\r\n\t\t\t\treturn POSITION_PADDING;\r\n\t\t\t}\r\n\r\n\t\t\tconst scalarExpression = new DScalarExpression( coordinate );\r\n\t\t\treturn ( parent: number, self: number, padding: number, current: number ): number => {\r\n\t\t\t\treturn scalarExpression.calculate( parent, self, padding, current );\r\n\t\t\t};\r\n\t\t} else if( isFunction( coordinate ) ) {\r\n\t\t\treturn coordinate;\r\n\t\t} else {\r\n\t\t\tconst scalar = coordinate;\r\n\t\t\treturn ( parent: number, self: number, padding: number, current: number ): number => {\r\n\t\t\t\treturn scalar.calculate( parent, self, padding, current );\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tstatic size( coordinate: DCoordinateSizeNoAuto | undefined ): DScalarFunction | null {\r\n\t\tif( coordinate == null || isNumber( coordinate ) ) {\r\n\t\t\treturn null;\r\n\t\t} else if( isString( coordinate ) ) {\r\n\t\t\tswitch( coordinate ) {\r\n\t\t\tcase \"100%\":\r\n\t\t\tcase \"maximized\":\r\n\t\t\tcase \"MAXIMIZED\":\r\n\t\t\t\treturn SIZE_MAXIMIZED;\r\n\t\t\tcase \"padding\":\r\n\t\t\tcase \"PADDING\":\r\n\t\t\t\treturn SIZE_PADDING;\r\n\t\t\t}\r\n\r\n\t\t\tconst scalarExpression = new DScalarExpression( coordinate );\r\n\t\t\treturn ( parent: number, self: number, padding: number, current: number ): number => {\r\n\t\t\t\treturn scalarExpression.calculate( parent, self, padding, current );\r\n\t\t\t};\r\n\t\t} else if( isFunction( coordinate ) ) {\r\n\t\t\treturn coordinate;\r\n\t\t} else {\r\n\t\t\tconst scalar = coordinate;\r\n\t\t\treturn ( parent: number, self: number, padding: number, current: number ): number => {\r\n\t\t\t\treturn scalar.calculate( parent, self, padding, current );\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DTheme } from \"./d-theme\";\r\n\r\nexport class DThemes {\r\n\tprivate static DEFAULT_THEME_CLASS: (new () => DTheme) | null = null;\r\n\tprivate static INSTANCE: DTheme | null = null;\r\n\r\n\tpublic static setDefaultThemeClass( theme: new () => DTheme ): void {\r\n\t\tthis.DEFAULT_THEME_CLASS = theme;\r\n\t}\r\n\r\n\tpublic static getDefaultThemeClass(): (new () => DTheme) | null {\r\n\t\treturn this.DEFAULT_THEME_CLASS;\r\n\t}\r\n\r\n\tpublic static getInstance(): DTheme {\r\n\t\tif( this.INSTANCE == null ) {\r\n\t\t\tconst defaultThemeClass = this.getDefaultThemeClass();\r\n\t\t\tif( defaultThemeClass == null ) {\r\n\t\t\t\tthrow new Error( \"No default theme class found\" );\r\n\t\t\t}\r\n\t\t\tthis.INSTANCE = new defaultThemeClass();\r\n\t\t}\r\n\t\treturn this.INSTANCE;\r\n\t}\r\n\r\n\tpublic static setInstance( instance: DTheme ): DTheme | null {\r\n\t\tconst result = this.INSTANCE;\r\n\t\tthis.INSTANCE = instance;\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, interaction, Point } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DApplicationTarget } from \"../d-application-like\";\r\nimport { DApplications } from \"../d-applications\";\r\n\r\nexport type UtilPointerEventClickHandler = ( e: InteractionEvent ) => void;\r\n\r\nexport interface UtilPointerEventClickTarget extends DApplicationTarget {\r\n\ton( name: string, handler: UtilPointerEventClickHandler ): void;\r\n}\r\n\r\nexport class UtilPointerEvent {\r\n\tstatic CLICK_DISTANCE_THRESHOLD: number = 10;\r\n\tstatic DBLCLICK_INTERVAL_THRESHOLD: number = 333;\r\n\tstatic LONG_CLICK_THRESHOLD: number = 750;\r\n\r\n\tstatic get touchable(): boolean {\r\n\t\treturn ( \"ontouchstart\" in document );\r\n\t}\r\n\r\n\tstatic get tap(): string {\r\n\t\treturn \"pointertap\";\r\n\t}\r\n\r\n\tstatic get down(): string {\r\n\t\treturn \"pointerdown\";\r\n\t}\r\n\r\n\tstatic get enter(): string {\r\n\t\treturn \"pointerenter\";\r\n\t}\r\n\r\n\tstatic get leave(): string {\r\n\t\treturn \"pointerleave\";\r\n\t}\r\n\r\n\tstatic get move(): string {\r\n\t\treturn \"pointermove\";\r\n\t}\r\n\r\n\tstatic get out(): string {\r\n\t\treturn \"pointerout\";\r\n\t}\r\n\r\n\tstatic get over(): string {\r\n\t\treturn \"pointerover\";\r\n\t}\r\n\r\n\tstatic get up(): string {\r\n\t\treturn \"pointerup\";\r\n\t}\r\n\r\n\tstatic get cancel(): string {\r\n\t\treturn \"pointercancel\";\r\n\t}\r\n\r\n\tstatic toGlobal(\r\n\t\te: MouseEvent | TouchEvent,\r\n\t\tinteractionManager: interaction.InteractionManager,\r\n\t\tresult: Point\r\n\t): Point {\r\n\t\tif( \"touches\" in e ) {\r\n\t\t\tconst touches = e.changedTouches;\r\n\t\t\tconst touch = touches[ touches.length - 1 ];\r\n\t\t\tif( touch != null ) {\r\n\t\t\t\tinteractionManager.mapPositionToPoint( result, touch.clientX, touch.clientY );\r\n\t\t\t} else {\r\n\t\t\t\tinteractionManager.mapPositionToPoint( result, 0, 0 );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tinteractionManager.mapPositionToPoint( result, e.clientX, e.clientY );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic onClick( target: UtilPointerEventClickTarget, handler: UtilPointerEventClickHandler ): void {\r\n\t\tif( ! this.touchable ) {\r\n\t\t\ttarget.on( \"click\", handler );\r\n\t\t} else {\r\n\t\t\tlet isDowned = false;\r\n\t\t\tlet downX = 0;\r\n\t\t\tlet downY = 0;\r\n\t\t\tlet interactionManagerBound: interaction.InteractionManager | null = null;\r\n\t\t\tconst cleanup = (): void => {\r\n\t\t\t\tisDowned = false;\r\n\t\t\t\tif( interactionManagerBound ) {\r\n\t\t\t\t\tinteractionManagerBound.off( up, onUp );\r\n\t\t\t\t\tinteractionManagerBound = null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconst isValidDistance = ( e: InteractionEvent ): boolean => {\r\n\t\t\t\tconst global = e.data.global;\r\n\t\t\t\tconst dx = Math.abs( downX - global.x );\r\n\t\t\t\tconst dy = Math.abs( downY - global.y );\r\n\t\t\t\tconst threshold = this.CLICK_DISTANCE_THRESHOLD;\r\n\t\t\t\treturn ( dx <= threshold && dy <= threshold );\r\n\t\t\t};\r\n\t\t\ttarget.on( \"click\", ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tcleanup();\r\n\t\t\t\t}\r\n\t\t\t\thandler( e );\r\n\t\t\t});\r\n\t\t\tconst up = this.up;\r\n\t\t\tconst onUp = ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tcleanup();\r\n\t\t\t\t\tif( this.contains( target, e.target ) ) {\r\n\t\t\t\t\t\tif( isValidDistance( e ) ) {\r\n\t\t\t\t\t\t\thandler( e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\ttarget.on( this.down, ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tconst global = e.data.global;\r\n\t\t\t\t\tdownX = global.x;\r\n\t\t\t\t\tdownY = global.y;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tisDowned = true;\r\n\t\t\t\t\tconst global = e.data.global;\r\n\t\t\t\t\tdownX = global.x;\r\n\t\t\t\t\tdownY = global.y;\r\n\t\t\t\t\tif( interactionManagerBound ) {\r\n\t\t\t\t\t\tinteractionManagerBound.off( up, onUp );\r\n\t\t\t\t\t\tinteractionManagerBound = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst layer = DApplications.getLayer( target );\r\n\t\t\t\t\tif( layer ) {\r\n\t\t\t\t\t\tinteractionManagerBound = layer.renderer.plugins.interaction;\r\n\t\t\t\t\t\tinteractionManagerBound.once( up, onUp );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onLongClick(\r\n\t\ttarget: UtilPointerEventClickTarget,\r\n\t\tonClick: UtilPointerEventClickHandler,\r\n\t\tonLongClick: UtilPointerEventClickHandler\r\n\t): void {\r\n\t\tif( ! this.touchable ) {\r\n\t\t\ttarget.on( \"click\", onClick );\r\n\t\t} else {\r\n\t\t\tlet isDowned = false;\r\n\t\t\tlet downX = 0;\r\n\t\t\tlet downY = 0;\r\n\t\t\tlet timeoutId: number | null = null;\r\n\t\t\tlet interactionManagerBound: interaction.InteractionManager | null = null;\r\n\t\t\tconst cleanupTimeout = (): void => {\r\n\t\t\t\tif( timeoutId != null ) {\r\n\t\t\t\t\tclearTimeout( timeoutId );\r\n\t\t\t\t\ttimeoutId = null;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconst cleanup = (): void => {\r\n\t\t\t\tisDowned = false;\r\n\t\t\t\tif( interactionManagerBound ) {\r\n\t\t\t\t\tinteractionManagerBound.off( up, onUp );\r\n\t\t\t\t\tinteractionManagerBound.off( move, onMove );\r\n\t\t\t\t\tinteractionManagerBound = null;\r\n\t\t\t\t}\r\n\t\t\t\tcleanupTimeout();\r\n\t\t\t};\r\n\t\t\tconst isValidDistance = ( e: InteractionEvent ): boolean => {\r\n\t\t\t\tconst global = e.data.global;\r\n\t\t\t\tconst dx = Math.abs( downX - global.x );\r\n\t\t\t\tconst dy = Math.abs( downY - global.y );\r\n\t\t\t\tconst threshold = this.CLICK_DISTANCE_THRESHOLD;\r\n\t\t\t\treturn ( dx < threshold && dy < threshold );\r\n\t\t\t};\r\n\t\t\ttarget.on( \"click\", ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tcleanup();\r\n\t\t\t\t}\r\n\t\t\t\tonClick( e );\r\n\t\t\t});\r\n\t\t\tconst up = this.up;\r\n\t\t\tconst move = this.move;\r\n\t\t\tconst onUp = ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tcleanup();\r\n\t\t\t\t\tif( this.contains( target, e.target ) ) {\r\n\t\t\t\t\t\tif( isValidDistance( e ) ) {\r\n\t\t\t\t\t\t\tonClick( e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tconst onMove = ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\tif( this.contains( target, e.target ) ) {\r\n\t\t\t\t\t\tif( ! isValidDistance( e ) ) {\r\n\t\t\t\t\t\t\tcleanup();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\ttarget.on( this.down, ( e: InteractionEvent ): void => {\r\n\t\t\t\tif( ! isDowned ) {\r\n\t\t\t\t\tisDowned = true;\r\n\t\t\t\t\tconst global = e.data.global;\r\n\t\t\t\t\tdownX = global.x;\r\n\t\t\t\t\tdownY = global.y;\r\n\t\t\t\t\tcleanupTimeout();\r\n\t\t\t\t\tconst oe = e.data.originalEvent;\r\n\t\t\t\t\tif( \"touches\" in oe ) {\r\n\t\t\t\t\t\ttimeoutId = window.setTimeout((): void => {\r\n\t\t\t\t\t\t\tif( isDowned ) {\r\n\t\t\t\t\t\t\t\tcleanup();\r\n\t\t\t\t\t\t\t\tonLongClick( e );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, this.LONG_CLICK_THRESHOLD );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( interactionManagerBound ) {\r\n\t\t\t\t\t\tinteractionManagerBound.off( up, onUp );\r\n\t\t\t\t\t\tinteractionManagerBound.off( move, onMove );\r\n\t\t\t\t\t\tinteractionManagerBound = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst layer = DApplications.getLayer( target );\r\n\t\t\t\t\tif( layer ) {\r\n\t\t\t\t\t\tinteractionManagerBound = layer.renderer.plugins.interaction;\r\n\t\t\t\t\t\tinteractionManagerBound.once( up, onUp );\r\n\t\t\t\t\t\tinteractionManagerBound.on( move, onMove );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstatic onDblClick( target: HTMLElement, handler: ( e: MouseEvent | TouchEvent ) => void ): void {\r\n\t\tif( ! this.touchable ) {\r\n\t\t\ttarget.addEventListener( \"dblclick\", handler );\r\n\t\t} else {\r\n\t\t\tlet isDowned = 0;\r\n\t\t\tlet downX = 0;\r\n\t\t\tlet downY = 0;\r\n\t\t\tlet clickTime = 0;\r\n\r\n\t\t\ttarget.addEventListener( \"dblclick\", handler );\r\n\r\n\t\t\ttarget.addEventListener( \"touchend\", ( e: TouchEvent ): void => {\r\n\t\t\t\tif( isDowned === 1 || isDowned === 3 ) {\r\n\t\t\t\t\tconst touches = e.changedTouches;\r\n\t\t\t\t\tconst touch: Touch | null = touches[ touches.length - 1 ];\r\n\t\t\t\t\tif( touch != null ) {\r\n\t\t\t\t\t\tconst dx = downX - touch.clientX;\r\n\t\t\t\t\t\tconst dy = downY - touch.clientY;\r\n\t\t\t\t\t\tif( Math.abs( dx ) + Math.abs( dy ) < this.CLICK_DISTANCE_THRESHOLD ) {\r\n\t\t\t\t\t\t\tisDowned += 1;\r\n\t\t\t\t\t\t\tif( isDowned === 4 ) {\r\n\t\t\t\t\t\t\t\tisDowned = 0;\r\n\t\t\t\t\t\t\t\tconst elapsedTime = e.timeStamp - clickTime;\r\n\t\t\t\t\t\t\t\tif( elapsedTime < this.DBLCLICK_INTERVAL_THRESHOLD ) {\r\n\t\t\t\t\t\t\t\t\thandler( e );\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tclickTime = e.timeStamp;\r\n\t\t\t\t\t\t\t\t\tisDowned = 2;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tclickTime = e.timeStamp;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tisDowned = 0;\r\n\t\t\t});\r\n\r\n\t\t\ttarget.addEventListener( \"touchstart\", ( e: TouchEvent ): void => {\r\n\t\t\t\tif( isDowned === 0 ) {\r\n\t\t\t\t\tconst touch: Touch | null = e.touches.item( e.touches.length - 1 );\r\n\t\t\t\t\tif( touch != null ) {\r\n\t\t\t\t\t\tisDowned = 1;\r\n\t\t\t\t\t\tdownX = touch.clientX;\r\n\t\t\t\t\t\tdownY = touch.clientY;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if( isDowned === 2 ) {\r\n\t\t\t\t\tconst touch: Touch | null = e.touches.item( e.touches.length - 1 );\r\n\t\t\t\t\tif( touch != null ) {\r\n\t\t\t\t\t\tisDowned = 3;\r\n\t\t\t\t\t\tdownX = touch.clientX;\r\n\t\t\t\t\t\tdownY = touch.clientY;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tisDowned = 0;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstatic contains( target: unknown, targetOrChild: DisplayObject | null ): boolean {\r\n\t\tlet current = targetOrChild;\r\n\t\twhile( current != null && current !== target ) {\r\n\t\t\tcurrent = current.parent;\r\n\t\t}\r\n\t\treturn current === target;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DMouseModifier {\r\n\tNONE\t\t= 0,\r\n\tCTRL\t\t= 1,\r\n\tSHIFT\t\t= 2,\r\n\tALT\t\t\t= 4,\r\n\r\n\tAND\t\t\t= 8,\r\n\tOR\t\t\t= 16,\r\n\r\n\tNOT_NONE\t= CTRL | SHIFT | ALT | OR\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Graphics, Renderer } from \"pixi.js\";\r\nimport { DBase, DReflowable } from \"./d-base\";\r\nimport { DCornerMask } from \"./d-corner-mask\";\r\n\r\nexport class DBaseOverflowMask extends Graphics implements DReflowable {\r\n\tconstructor( parent: DBase ) {\r\n\t\tsuper();\r\n\t\t(this as any).parent = parent;\r\n\t}\r\n\r\n\trender( renderer: Renderer ): void {\r\n\t\tthis.updateTransform();\r\n\t\tsuper.render( renderer );\r\n\t}\r\n\r\n\tonReflow( base: DBase, width: number, height: number): void {\r\n\t\tconst x = 0;\r\n\t\tconst y = 0;\r\n\t\tconst corner = base.corner;\r\n\t\tconst cornerRadius = Math.max( 0, corner.getRadius() - 0.5 );\r\n\t\tconst cornerMask = corner.getMask();\r\n\t\tconst tl = ( cornerMask & DCornerMask.TOP_LEFT ? 0 : cornerRadius );\r\n\t\tconst tr = ( cornerMask & DCornerMask.TOP_RIGHT ? 0 : cornerRadius );\r\n\t\tconst bl = ( cornerMask & DCornerMask.BOTTOM_LEFT ? 0 : cornerRadius );\r\n\t\tconst br = ( cornerMask & DCornerMask.BOTTOM_RIGHT ? 0 : cornerRadius );\r\n\t\tthis.clear();\r\n\t\tthis.beginFill( 0xFFFFFF, 1 );\r\n\t\tthis.lineStyle( 0, 0, 0, 0, false );\r\n\t\tif( tl <= 0 && tr <= 0 && bl <= 0 && br <= 0 ) {\r\n\t\t\tthis.moveTo( x, y );\r\n\t\t\tthis.lineTo( x + width, y );\r\n\t\t\tthis.lineTo( x + width, y + height );\r\n\t\t\tthis.lineTo( x, y + height );\r\n\t\t\tthis.lineTo( x, y );\r\n\t\t} else {\r\n\t\t\tthis.moveTo( x + tl, y );\r\n\t\t\tif( 0 < tr ) {\r\n\t\t\t\tthis.arcTo( x + width, y, x + width, y + height, tr );\r\n\t\t\t} else {\r\n\t\t\t\tthis.lineTo( x + width, y );\r\n\t\t\t}\r\n\t\t\tif( 0 < br ) {\r\n\t\t\t\tthis.arcTo( x + width, y + height, x, y + height, br );\r\n\t\t\t} else {\r\n\t\t\t\tthis.lineTo( x + width, y + height );\r\n\t\t\t}\r\n\t\t\tif( 0 < bl ) {\r\n\t\t\t\tthis.arcTo( x, y + height, x, y, bl );\r\n\t\t\t} else {\r\n\t\t\t\tthis.lineTo( x, y + height );\r\n\t\t\t}\r\n\t\t\tif( 0 < tl ) {\r\n\t\t\t\tthis.arcTo( x, y, x + width, y, tl );\r\n\t\t\t} else {\r\n\t\t\t\tthis.lineTo( x, y );\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.endFill();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DMouseModifier } from \"./d-mouse-modifier\";\r\n\r\nexport type DMouseModifierEvent = WheelEvent | MouseEvent | TouchEvent | interaction.InteractionEvent;\r\n\r\nexport class DMouseModifiers {\r\n\tstatic from( e: DMouseModifierEvent ): DMouseModifier {\r\n\t\tconst oe = ( \"data\" in e ? e.data.originalEvent : e );\r\n\t\treturn ( oe.ctrlKey ? DMouseModifier.CTRL : DMouseModifier.NONE ) |\r\n\t\t\t( oe.altKey ? DMouseModifier.ALT : DMouseModifier.NONE ) |\r\n\t\t\t( oe.shiftKey ? DMouseModifier.SHIFT : DMouseModifier.NONE );\r\n\t}\r\n\r\n\tstatic match( e: DMouseModifierEvent, modifier: DMouseModifier ): boolean {\r\n\t\tif( modifier & DMouseModifier.OR ) {\r\n\t\t\treturn !! (DMouseModifiers.from( e ) & modifier);\r\n\t\t} else {\r\n\t\t\treturn DMouseModifiers.from( e ) === modifier;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DDragMode {\r\n\tOFF,\r\n\tON,\r\n\tTOUCH\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class DAnimationTimings {\r\n\tstatic LINEAR( t: number ): number {\r\n\t\treturn t;\r\n\t}\r\n\r\n\tstatic ELASTIC( t: number ): number {\r\n\t\treturn t * ( 3 * (1 - t) * (1 - t) + t * ( 3 * (1 - t) + t ) );\r\n\t}\r\n\r\n\tstatic QUAD_IN_OUT( t: number ): number {\r\n\t\treturn t < 0.5 ? 2 * t * t : -1 + ( 4 - 2 * t ) * t;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueBlinkType {\r\n\tVISIBILITY,\r\n\tBRIGHTEN,\r\n\tDARKEN,\r\n\tOPACITY,\r\n\tCOLOR_FILL,\r\n\tCOLOR_STROKE\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DAnimation, DAnimationOnEnd, DAnimationOnTime, DAnimationOptions, DAnimationTiming } from \"./d-animation\";\r\nimport { DAnimationTimings } from \"./d-animation-timings\";\r\n\r\nexport class DAnimationBase<TARGET = unknown> extends utils.EventEmitter implements DAnimation<TARGET> {\r\n\tprotected _id: number | null;\r\n\tprotected _startTime: number;\r\n\tprotected _duration: number;\r\n\tprotected _durationInverse: number;\r\n\tprotected _reverse: boolean;\r\n\tprotected _onTime: DAnimationOnTime<TARGET> | undefined;\r\n\tprotected _onTimeBaseBound: () => void;\r\n\tprotected _onStart: DAnimationOnEnd<TARGET> | undefined;\r\n\tprotected _onEnd: DAnimationOnEnd<TARGET> | undefined;\r\n\tprotected _timing: DAnimationTiming<TARGET>;\r\n\tprotected _target: TARGET | null;\r\n\r\n\tconstructor( options?: DAnimationOptions<TARGET> ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._id = null;\r\n\t\tthis._target = (options && options.target != null ? options.target : null);\r\n\t\tthis._startTime = 0;\r\n\t\tthis._duration = ( options != null && options.duration != null ? options.duration : 200 );\r\n\t\tthis._durationInverse = 1 / Math.max( 1, this._duration );\r\n\t\tthis._reverse = false;\r\n\t\tthis._onTime = ( options != null ? options.onTime : undefined );\r\n\t\tthis._onTimeBaseBound = () => {\r\n\t\t\tthis.onTimeBase();\r\n\t\t};\r\n\t\tthis._onStart = ( options != null ? options.onStart : undefined );\r\n\t\tthis._onEnd = ( options != null ? options.onEnd : undefined );\r\n\t\tthis._timing = ( options != null && options.timing != null ? options.timing : DAnimationTimings.ELASTIC );\r\n\r\n\t\t// Events\r\n\t\tconst on = options && options.on;\r\n\t\tif( on ) {\r\n\t\t\tfor( const name in on ) {\r\n\t\t\t\tconst handler = on[ name ];\r\n\t\t\t\tif( handler ) {\r\n\t\t\t\t\tthis.on( name, handler );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget target(): TARGET | null {\r\n\t\treturn this._target;\r\n\t}\r\n\r\n\tset target( target: TARGET | null ) {\r\n\t\tthis._target = target;\r\n\t}\r\n\r\n\tget duration(): number {\r\n\t\treturn this._duration;\r\n\t}\r\n\r\n\tset duration( duration: number ) {\r\n\t\tthis._duration = duration;\r\n\t\tthis._durationInverse = 1 / Math.max( 1, duration );\r\n\t}\r\n\r\n\tstart( reverse: boolean = false ): void {\r\n\t\tthis.stop();\r\n\t\tthis._startTime = Date.now();\r\n\t\tthis._reverse = reverse;\r\n\t\tthis._id = window.setTimeout( this._onTimeBaseBound, 0 );\r\n\r\n\t\t// onStart\r\n\t\tthis.onStart( reverse );\r\n\r\n\t\t// onTime\r\n\t\tconst duration = this._duration;\r\n\t\tconst time = this.toTime( reverse ? duration : 0 );\r\n\t\tthis.onTime( time, reverse, 0 );\r\n\t}\r\n\r\n\tprotected onStart( isReverse: boolean ): void {\r\n\t\tconst onStart = this._onStart;\r\n\t\tif( onStart != null ) {\r\n\t\t\tonStart( isReverse, this );\r\n\t\t}\r\n\t\tthis.emit( \"start\", isReverse, this );\r\n\t}\r\n\r\n\tprotected onTime( time: number, isReverse: boolean, elapsedTime: number ): void {\r\n\t\tconst onTime = this._onTime;\r\n\t\tif( onTime != null ) {\r\n\t\t\tonTime( time, isReverse, elapsedTime, this );\r\n\t\t}\r\n\t\tthis.emit( \"time\", time, isReverse, elapsedTime, this );\r\n\t}\r\n\r\n\tprotected onEnd( isReverse: boolean ): void {\r\n\t\tconst onEnd = this._onEnd;\r\n\t\tif( onEnd != null ) {\r\n\t\t\tonEnd( isReverse, this );\r\n\t\t}\r\n\t\tthis.emit( \"end\", isReverse, this );\r\n\t}\r\n\r\n\tisStarted(): boolean {\r\n\t\treturn (this._id != null);\r\n\t}\r\n\r\n\tisReverse(): boolean {\r\n\t\treturn this._reverse;\r\n\t}\r\n\r\n\tprotected onTimeBase(): void {\r\n\t\tconst id = this._id;\r\n\t\tif( id != null ) {\r\n\t\t\tthis._id = null;\r\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\r\n\t\t\tconst duration = this._duration;\r\n\t\t\tconst reverse = this._reverse;\r\n\t\t\tif( elapsedTime < duration ) {\r\n\t\t\t\tthis._id = window.setTimeout( this._onTimeBaseBound, 0 );\r\n\r\n\t\t\t\t// OnTime\r\n\t\t\t\tconst time = this.toTime( reverse ? duration - elapsedTime : elapsedTime );\r\n\t\t\t\tthis.onTime( time, reverse, elapsedTime );\r\n\t\t\t} else {\r\n\t\t\t\t// OnTime\r\n\t\t\t\tconst time = this.toTime( reverse ? 0 : duration );\r\n\t\t\t\tthis.onTime( time, reverse, elapsedTime );\r\n\r\n\t\t\t\t// OnEnd\r\n\t\t\t\tthis.onEnd( reverse );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toTime( elapsedTime: number ): number {\r\n\t\treturn this._timing( elapsedTime * this._durationInverse, this );\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tconst id = this._id;\r\n\t\tif( id != null ) {\r\n\t\t\tthis._id = null;\r\n\t\t\twindow.clearTimeout( id );\r\n\t\t}\r\n\t}\r\n\r\n\tend(): void {\r\n\t\tconst id = this._id;\r\n\t\tif( id != null ) {\r\n\t\t\tthis._id = null;\r\n\t\t\twindow.clearTimeout( id );\r\n\r\n\t\t\t// OnTime\r\n\t\t\tconst reverse = this._reverse;\r\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\r\n\t\t\tconst duration = this._duration;\r\n\t\t\tconst time = this.toTime( reverse ? 0 : duration );\r\n\t\t\tthis.onTime( time, reverse, elapsedTime );\r\n\r\n\t\t\t// OnEnd\r\n\t\t\tthis.onEnd( reverse );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class UtilDragEasingHistory {\r\n\tdx: number;\r\n\tdy: number;\r\n\tds: number;\r\n\tdt: number;\r\n\r\n\tconstructor( dx: number, dy: number, ds: number, dt: number ) {\r\n\t\tthis.dx = dx;\r\n\t\tthis.dy = dy;\r\n\t\tthis.ds = ds;\r\n\t\tthis.dt = dt;\r\n\t}\r\n\r\n\tset( dx: number, dy: number, ds: number, dt: number ) {\r\n\t\tthis.dx = dx;\r\n\t\tthis.dy = dy;\r\n\t\tthis.ds = ds;\r\n\t\tthis.dt = dt;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DAnimation } from \"../d-animation\";\r\nimport { DAnimationBase } from \"../d-animation-base\";\r\nimport { DAnimationTimings } from \"../d-animation-timings\";\r\nimport { isNumber } from \"./is-number\";\r\nimport { UtilDragEasingHistory } from \"./util-drag-easing-history\";\r\n\r\nexport type UtilDragEasingOnMove = ( dx: number, dy: number, ds: number, time: number ) => void;\r\n\r\nexport interface UtilDragEasingDurationOptions {\r\n\tposition?: number;\r\n\tscale?: number;\r\n}\r\n\r\nexport interface UtilDragEasingOptions {\r\n\tduration?: number | UtilDragEasingDurationOptions;\r\n}\r\n\r\nexport class UtilDragEasing {\r\n\tprotected static HISTORY_CAPACITY = 5;\r\n\tprotected _histories: UtilDragEasingHistory[];\r\n\tprotected _historiesSorted: UtilDragEasingHistory[];\r\n\tprotected _historyBegin: number;\r\n\tprotected _historyEnd: number;\r\n\tprotected _animation: DAnimation;\r\n\tprotected _dx: number;\r\n\tprotected _dy: number;\r\n\tprotected _dt: number;\r\n\tprotected _ds: number;\r\n\tprotected _durationPosition: number;\r\n\tprotected _durationScale: number;\r\n\tprotected _onMove: UtilDragEasingOnMove;\r\n\r\n\tconstructor( onMove: UtilDragEasingOnMove, options?: UtilDragEasingOptions ) {\r\n\t\tthis._histories = [];\r\n\t\tthis._historiesSorted = [];\r\n\t\tthis._historyBegin = 0;\r\n\t\tthis._historyEnd = -1;\r\n\t\tthis._dx = 0;\r\n\t\tthis._dy = 0;\r\n\t\tthis._ds = 0;\r\n\t\tthis._dt = 0;\r\n\t\tthis._animation = new DAnimationBase({\r\n\t\t\tonTime: ( t: number ): void => {\r\n\t\t\t\tthis.onEase( t );\r\n\t\t\t},\r\n\t\t\ttiming: DAnimationTimings.LINEAR,\r\n\t\t\tduration: 1000\r\n\t\t});\r\n\t\tconst duration = options && options.duration;\r\n\t\tif( duration ) {\r\n\t\t\tif( isNumber( duration ) ) {\r\n\t\t\t\tthis._durationPosition = duration;\r\n\t\t\t\tthis._durationScale = duration;\r\n\t\t\t} else {\r\n\t\t\t\tthis._durationPosition = ( duration.position != null ? duration.position : 1 );\r\n\t\t\t\tthis._durationScale = ( duration.scale != null ? duration.scale : 1 );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._durationPosition = 1;\r\n\t\t\tthis._durationScale = 1;\r\n\t\t}\r\n\t\tthis._onMove = onMove;\r\n\t}\r\n\r\n\tonStart(): void {\r\n\t\t// History\r\n\t\tconst histories = this._histories;\r\n\t\tfor( let i = histories.length, imax = UtilDragEasing.HISTORY_CAPACITY; i < imax; ++i ) {\r\n\t\t\thistories.push( new UtilDragEasingHistory( 0, 0, 1, 0 ) );\r\n\t\t}\r\n\t\tthis._historyBegin = 0;\r\n\t\tthis._historyEnd = -1;\r\n\r\n\t\t// Stop animation\r\n\t\tthis._animation.stop();\r\n\t}\r\n\r\n\tonMove( dx: number, dy: number, ds: number, dt: number ): void {\r\n\t\tconst capacity = UtilDragEasing.HISTORY_CAPACITY;\r\n\r\n\t\tconst oldHistoryEnd = this._historyEnd;\r\n\t\tconst newHistoryEnd = (oldHistoryEnd + 1) % capacity;\r\n\t\tthis._historyEnd = newHistoryEnd;\r\n\r\n\t\tconst oldHistoryBegin = this._historyBegin;\r\n\t\tif( newHistoryEnd < oldHistoryEnd || (0 <= oldHistoryEnd && oldHistoryEnd < oldHistoryBegin) ) {\r\n\t\t\tthis._historyBegin = (oldHistoryBegin + 1) % capacity;\r\n\t\t}\r\n\r\n\t\tthis._histories[ newHistoryEnd ].set( dx, dy, ds, dt );\r\n\t}\r\n\r\n\tprotected updateHistoriesSorted( dt: number ): number {\r\n\t\tconst unsorted = this._histories;\r\n\t\tconst sorted = this._historiesSorted;\r\n\t\tconst begin = this._historyBegin;\r\n\t\tconst end = this._historyEnd;\r\n\t\tconst length = unsorted.length;\r\n\t\tconst threshold = 160;\r\n\t\tif( end < 0 ) {\r\n\t\t\tsorted.length = 0;\r\n\t\t\treturn dt;\r\n\t\t} else if( end < begin ) {\r\n\t\t\tlet total = dt;\r\n\t\t\tsorted.length = 0;\r\n\t\t\tfor( let i = end; 0 <= i; --i ) {\r\n\t\t\t\tconst history = unsorted[ i ];\r\n\t\t\t\tif( total + history.dt < threshold ) {\r\n\t\t\t\t\ttotal += history.dt;\r\n\t\t\t\t\tsorted.push( history );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn total;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor( let i = length - 1; begin <= i; --i ) {\r\n\t\t\t\tconst history = unsorted[ i ];\r\n\t\t\t\tif( total + history.dt < threshold ) {\r\n\t\t\t\t\ttotal += history.dt;\r\n\t\t\t\t\tsorted.push( history );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn total;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn total;\r\n\t\t} else {\r\n\t\t\tlet total = dt;\r\n\t\t\tsorted.length = 0;\r\n\t\t\tfor( let i = end; begin <= i; --i ) {\r\n\t\t\t\tconst history = unsorted[ i ];\r\n\t\t\t\tif( total + history.dt < threshold ) {\r\n\t\t\t\t\ttotal += history.dt;\r\n\t\t\t\t\tsorted.push( history );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn total;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn total;\r\n\t\t}\r\n\t}\r\n\r\n\tonEnd( ldt: number ): void {\r\n\t\tconst adt = this.updateHistoriesSorted( ldt );\r\n\t\tconst sorted = this._historiesSorted;\r\n\t\tconst sortedLength = sorted.length;\r\n\t\tif( 0 < sortedLength ) {\r\n\t\t\tlet dx = 0;\r\n\t\t\tlet dy = 0;\r\n\t\t\tlet ds = 0;\r\n\t\t\tlet dt = 0;\r\n\t\t\tfor( let i = 0; i < sortedLength; ++i ) {\r\n\t\t\t\tconst history = sorted[ i ];\r\n\t\t\t\tdx += history.dx;\r\n\t\t\t\tdy += history.dy;\r\n\t\t\t\tds += history.ds;\r\n\t\t\t\tdt += history.dt;\r\n\t\t\t}\r\n\t\t\tconst w = (1 - ldt / adt) / sortedLength;\r\n\t\t\tdx *= w;\r\n\t\t\tdy *= w;\r\n\t\t\tds = 1 + (ds - sortedLength) * w;\r\n\t\t\tdt *= w;\r\n\t\t\tthis._dx = dx;\r\n\t\t\tthis._dy = dy;\r\n\t\t\tthis._ds = ds;\r\n\t\t\tthis._dt = dt;\r\n\r\n\t\t\t// Start animation\r\n\t\t\tconst d0 = this._durationPosition * 40 * Math.sqrt( dx * dx + dy * dy );\r\n\t\t\tconst d1 = this._durationScale * 10000 * Math.abs( ds - 1 );\r\n\t\t\tconst animation = this._animation;\r\n\t\t\tanimation.duration = Math.max( d0, d1 );\r\n\t\t\tanimation.start();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onEase( time: number ): void {\r\n\t\tconst w = 1 - time;\r\n\t\tthis._onMove(\r\n\t\t\tthis._dx * w,\r\n\t\t\tthis._dy * w,\r\n\t\t\t1 + ( this._ds - 1 ) * w,\r\n\t\t\ttime\r\n\t\t);\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tthis._animation.stop();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point } from \"pixi.js\";\r\nimport { DApplications } from \"../d-applications\";\r\nimport { DBase } from \"../d-base\";\r\nimport { DMouseModifier } from \"../d-mouse-modifier\";\r\nimport { DMouseModifiers } from \"../d-mouse-modifiers\";\r\nimport { UtilDragEasing, UtilDragEasingOptions } from \"./util-drag-easing\";\r\nimport { UtilPointerEvent } from \"./util-pointer-event\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport InteractionManager = interaction.InteractionManager;\r\n\r\nexport type UtilDragOnMove = ( dx: number, dy: number, x: number, y: number, ds: number ) => void;\r\nexport type UtilDragOnStart = () => void;\r\nexport type UtilDragOnEnd = () => void;\r\nexport type UtilDragChecker = ( e: InteractionEvent, modifier: DMouseModifier, target: DBase ) => boolean;\r\n\r\nexport interface UtilDragCheckerOptions {\r\n\tstart?: UtilDragChecker;\r\n\tmove?: UtilDragChecker;\r\n}\r\n\r\nexport interface UtilDragOnOptions {\r\n\tstart?: UtilDragOnStart;\r\n\tmove?: UtilDragOnMove;\r\n\tend?: UtilDragOnEnd;\r\n}\r\n\r\nexport interface UtilDragOptions {\r\n\ttarget: DBase;\r\n\ttouch?: boolean;\r\n\tmodifier?: DMouseModifier;\r\n\tchecker?: UtilDragCheckerOptions;\r\n\teasing?: boolean | UtilDragEasingOptions;\r\n\tbind?: boolean;\r\n\ton?: UtilDragOnOptions;\r\n}\r\n\r\nconst toEasingOptions = ( options: true | UtilDragEasingOptions | undefined ): UtilDragEasingOptions | undefined => {\r\n\treturn ( options == null || options === true ?\r\n\t\tundefined : options\r\n\t);\r\n};\r\n\r\nconst toChecker = ( options?: UtilDragOptions ): { start: UtilDragChecker, move: UtilDragChecker } => {\r\n\tconst checker = options && options.checker;\r\n\tconst defaultChecker = DMouseModifiers.match;\r\n\tif( checker ) {\r\n\t\treturn {\r\n\t\t\tstart: checker.start || defaultChecker,\r\n\t\t\tmove: checker.move || defaultChecker\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tstart: defaultChecker,\r\n\t\tmove: defaultChecker\r\n\t};\r\n};\r\n\r\nexport class UtilDrag {\r\n\tprotected static EPSILON = 0.00001;\r\n\tprotected _target: DBase<any, any>;\r\n\tprotected _onDownBound: ( e: InteractionEvent ) => void;\r\n\tprotected _onMoveBound: ( e: InteractionEvent ) => void;\r\n\tprotected _onEndBound: ( e: InteractionEvent ) => void;\r\n\tprotected _onStart?: UtilDragOnStart;\r\n\tprotected _onMove?: UtilDragOnMove;\r\n\tprotected _onEnd?: UtilDragOnEnd;\r\n\tprotected _down: string;\r\n\tprotected _move: string;\r\n\tprotected _up: string;\r\n\tprotected _easing?: UtilDragEasing;\r\n\tprotected _modifier: DMouseModifier;\r\n\tprotected _checker: { start: UtilDragChecker, move: UtilDragChecker };\r\n\tprotected _interactionManager: InteractionManager | null;\r\n\tprotected _center: Point;\r\n\tprotected _scale: number;\r\n\tprotected _scalingCenter: Point;\r\n\tprotected _time: number;\r\n\r\n\tconstructor( options: UtilDragOptions ) {\r\n\t\tconst target = this._target = options.target;\r\n\t\tconst on = options.on;\r\n\t\tif( on ) {\r\n\t\t\tthis._onStart = on.start;\r\n\t\t\tthis._onMove = on.move;\r\n\t\t\tthis._onEnd = on.end;\r\n\t\t}\r\n\t\tthis._modifier = (options && options.modifier) || DMouseModifier.NONE;\r\n\t\tthis._checker = toChecker( options );\r\n\t\tthis._interactionManager = null;\r\n\t\tthis._center = new Point();\r\n\t\tthis._scale = 1;\r\n\t\tthis._scalingCenter = new Point();\r\n\t\tthis._time = 0;\r\n\r\n\t\tconst easing = options.easing;\r\n\t\tif( easing == null || easing !== false ) {\r\n\t\t\tconst onEasingMoveBound = ( dx: number, dy: number, ds: number, time: number ): void => {\r\n\t\t\t\tthis.onEasingMove( dx, dy, ds, time );\r\n\t\t\t};\r\n\t\t\tthis._easing = new UtilDragEasing( onEasingMoveBound, toEasingOptions( easing ) );\r\n\t\t}\r\n\r\n\t\tthis._onDownBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onDown( e );\r\n\t\t};\r\n\r\n\t\tthis._onMoveBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onMove( e );\r\n\t\t};\r\n\r\n\t\tthis._onEndBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onEnd( e );\r\n\t\t};\r\n\r\n\t\tif( options.touch ) {\r\n\t\t\tthis._down = \"touchstart\";\r\n\t\t\tthis._move = \"touchmove\";\r\n\t\t\tthis._up = \"touchend\";\r\n\t\t} else {\r\n\t\t\tthis._down = UtilPointerEvent.down;\r\n\t\t\tthis._move = UtilPointerEvent.move;\r\n\t\t\tthis._up = UtilPointerEvent.up;\r\n\t\t}\r\n\r\n\t\tif( options.bind !== false ) {\r\n\t\t\ttarget.on( this._down, this._onDownBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected calcCenterAndScale(\r\n\t\te: InteractionEvent, center: Point,\r\n\t\tinteractionManager: InteractionManager\r\n\t): number {\r\n\t\tconst oe = e.data.originalEvent;\r\n\t\tconst global = e.data.global;\r\n\t\tif( \"touches\" in oe ) {\r\n\t\t\tconst touches = oe.touches;\r\n\t\t\tconst touchesLength = touches.length;\r\n\t\t\tif( 0 < touchesLength ) {\r\n\t\t\t\t// Update the center\r\n\t\t\t\tconst first = touches[ 0 ];\r\n\t\t\t\tlet centerX = first.clientX;\r\n\t\t\t\tlet centerY = first.clientY;\r\n\t\t\t\tfor( let i = 1, imax = touches.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst touch = touches[ i ];\r\n\t\t\t\t\tcenterX += touch.clientX;\r\n\t\t\t\t\tcenterY += touch.clientY;\r\n\t\t\t\t}\r\n\t\t\t\tcenterX /= touchesLength;\r\n\t\t\t\tcenterY /= touchesLength;\r\n\t\t\t\tinteractionManager.mapPositionToPoint( center, centerX, centerY );\r\n\r\n\t\t\t\tif( 1 < touchesLength ) {\r\n\t\t\t\t\t// Calculate the maximum distance from the center\r\n\t\t\t\t\tlet squareDistance = 0;\r\n\t\t\t\t\tfor( let i = 1, imax = touches.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst touch = touches[ i ];\r\n\t\t\t\t\t\tconst dx = touch.clientX - centerX;\r\n\t\t\t\t\t\tconst dy = touch.clientY - centerY;\r\n\t\t\t\t\t\tsquareDistance = Math.max( squareDistance, dx * dx + dy * dy );\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn Math.sqrt( squareDistance );\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcenter.copyFrom( global );\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tonDown( e: InteractionEvent ): void {\r\n\t\tconst target = this._target;\r\n\t\tif( this._checker.start( e, this._modifier, target ) ) {\r\n\t\t\tconst layer = DApplications.getLayer( target );\r\n\t\t\tif( layer ) {\r\n\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\tif( target.isDragging() ) {\r\n\t\t\t\t\tconst interactionManager = this._interactionManager;\r\n\t\t\t\t\tif( interactionManager ) {\r\n\t\t\t\t\t\tconst center = this._center;\r\n\t\t\t\t\t\tthis._scale = this.calcCenterAndScale( e, center, interactionManager );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget.setDragging( true );\r\n\r\n\t\t\t\t\t// Interaction manager\r\n\t\t\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\r\n\t\t\t\t\tthis._interactionManager = interactionManager;\r\n\r\n\t\t\t\t\t// Update the center\r\n\t\t\t\t\tconst center = this._center;\r\n\t\t\t\t\tthis._scale = this.calcCenterAndScale( e, center, interactionManager );\r\n\r\n\t\t\t\t\t//\r\n\t\t\t\t\tthis._time = e.data.originalEvent.timeStamp;\r\n\r\n\t\t\t\t\t// Easing util\r\n\t\t\t\t\tconst easing = this._easing;\r\n\t\t\t\t\tif( easing ) {\r\n\t\t\t\t\t\teasing.onStart();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// User-defined handler\r\n\t\t\t\t\tconst onStart = this._onStart;\r\n\t\t\t\t\tif( onStart != null ) {\r\n\t\t\t\t\t\tonStart();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Event handler\r\n\t\t\t\t\tinteractionManager.on( this._move, this._onMoveBound );\r\n\t\t\t\t\tinteractionManager.on( this._up, this._onEndBound );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onMove( e: InteractionEvent ): void {\r\n\t\tconst target = this._target;\r\n\t\tif( target.isDragging() && this._checker.move( e, this._modifier, target ) ) {\r\n\t\t\tconst interactionManager = this._interactionManager;\r\n\t\t\tif( interactionManager ) {\r\n\t\t\t\t// Update the center\r\n\t\t\t\tconst center = this._center;\r\n\t\t\t\tconst centerX = center.x;\r\n\t\t\t\tconst centerY = center.y;\r\n\t\t\t\tconst newScale = this.calcCenterAndScale( e, center, interactionManager );\r\n\t\t\t\tconst oldScale = this._scale;\r\n\t\t\t\tthis._scale = newScale;\r\n\t\t\t\tconst oldTime = this._time;\r\n\t\t\t\tconst newTime = e.data.originalEvent.timeStamp;\r\n\t\t\t\tthis._time = newTime;\r\n\r\n\t\t\t\t// Calculate the position\r\n\t\t\t\tconst dx = center.x - centerX;\r\n\t\t\t\tconst dy = center.y - centerY;\r\n\t\t\t\tconst dt = newTime - oldTime;\r\n\t\t\t\tconst ds = ( UtilDrag.EPSILON < oldScale ? newScale / oldScale : 1 );\r\n\r\n\t\t\t\t// Easing util\r\n\t\t\t\tconst easing = this._easing;\r\n\t\t\t\tif( easing ) {\r\n\t\t\t\t\teasing.onMove( dx, dy, ds, dt );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// User-defined handler\r\n\t\t\t\tconst onMove = this._onMove;\r\n\t\t\t\tif( onMove != null ) {\r\n\t\t\t\t\tif( dx !== 0 || dy !== 0 || ds !== 1 ) {\r\n\t\t\t\t\t\tonMove( dx, dy, center.x, center.y, ds );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onEnd( e: InteractionEvent ): void {\r\n\t\tconst target = this._target;\r\n\t\tif( target.isDragging() ) {\r\n\t\t\tconst interactionManager = this._interactionManager;\r\n\t\t\tif( interactionManager ) {\r\n\t\t\t\t// Update the center\r\n\t\t\t\tconst center = this._center;\r\n\t\t\t\tthis._scalingCenter.copyFrom( center );\r\n\t\t\t\tthis._scale = this.calcCenterAndScale( e, center, interactionManager );\r\n\r\n\t\t\t\t// Finalize\r\n\t\t\t\tconst oe = e.data.originalEvent;\r\n\t\t\t\tif( \"touches\" in oe ? oe.touches.length <= 0 : true ) {\r\n\t\t\t\t\ttarget.setDragging( false );\r\n\r\n\t\t\t\t\t// Event handler\r\n\t\t\t\t\tthis._interactionManager = null;\r\n\t\t\t\t\tinteractionManager.off( this._move, this._onMoveBound );\r\n\t\t\t\t\tinteractionManager.off( this._up, this._onEndBound );\r\n\r\n\t\t\t\t\t// User-defined handler\r\n\t\t\t\t\tconst onEnd = this._onEnd;\r\n\t\t\t\t\tif( onEnd != null ) {\r\n\t\t\t\t\t\tonEnd();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Easing util\r\n\t\t\t\t\tconst easing = this._easing;\r\n\t\t\t\t\tif( easing ) {\r\n\t\t\t\t\t\teasing.onEnd( e.data.originalEvent.timeStamp - this._time );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onEasingMove( dx: number, dy: number, ds: number, time: number ): void {\r\n\t\tconst onMove = this._onMove;\r\n\t\tif( onMove != null ) {\r\n\t\t\tif( dx !== 0 || dy !== 0 || ds !== 1 ) {\r\n\t\t\t\tconst scalingCenter = this._scalingCenter;\r\n\t\t\t\tscalingCenter.set(\r\n\t\t\t\t\tscalingCenter.x + dx,\r\n\t\t\t\t\tscalingCenter.y + dy\r\n\t\t\t\t);\r\n\t\t\t\tonMove( dx, dy, scalingCenter.x, scalingCenter.y, ds );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tconst easing = this._easing;\r\n\t\tif( easing ) {\r\n\t\t\teasing.stop();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DDragMode } from \"./d-drag-mode\";\r\nimport { DMouseModifier } from \"./d-mouse-modifier\";\r\nimport { DThemeViewDrag, DViewDrag, DViewDragOptions } from \"./d-view-drag\";\r\nimport { DViewStopper } from \"./d-view-stopper\";\r\nimport { DViewToTarget } from \"./d-view-to-target\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilDrag } from \"./util/util-drag\";\r\n\r\nexport class DViewDragImpl implements DViewDrag {\r\n\tprotected _parent: DBase;\r\n\tprotected _toTarget: DViewToTarget;\r\n\tprotected _stopper: DViewStopper;\r\n\tprotected _dragUtil?: UtilDrag;\r\n\tprotected _bind: boolean;\r\n\r\n\tconstructor(\r\n\t\tparent: DBase,\r\n\t\ttoTarget: DViewToTarget,\r\n\t\tstopper: DViewStopper,\r\n\t\ttheme: DThemeViewDrag,\r\n\t\toptions: DViewDragOptions | undefined\r\n\t) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._toTarget = toTarget;\r\n\t\tthis._stopper = stopper;\r\n\r\n\t\tconst mode = ( options && options.mode != null ?\r\n\t\t\t( isString( options.mode ) ? DDragMode[ options.mode ] : options.mode ) :\r\n\t\t\ttheme.getDragMode()\r\n\t\t);\r\n\t\tconst modifier = ( options && options.modifier != null ?\r\n\t\t\t( isString( options.modifier ) ? DMouseModifier[ options.modifier ] : options.modifier ) :\r\n\t\t\ttheme.getDragModifier()\r\n\t\t);\r\n\t\tconst duration = ( options && options.duration != null ?\r\n\t\t\toptions.duration : {\r\n\t\t\t\tposition: theme.getDragDurationPosition(),\r\n\t\t\t\tscale: theme.getDragDurationScale()\r\n\t\t\t}\r\n\t\t);\r\n\t\tconst bind = (mode === DDragMode.TOUCH);\r\n\t\tthis._bind = bind;\r\n\t\tif( mode === DDragMode.ON || mode === DDragMode.TOUCH ) {\r\n\t\t\tthis._dragUtil = new UtilDrag({\r\n\t\t\t\ttarget: parent,\r\n\t\t\t\ttouch: bind,\r\n\t\t\t\tmodifier,\r\n\t\t\t\tchecker: options && options.checker,\r\n\t\t\t\teasing: {\r\n\t\t\t\t\tduration\r\n\t\t\t\t},\r\n\t\t\t\tbind,\r\n\t\t\t\ton: {\r\n\t\t\t\t\tstart: (): void => {\r\n\t\t\t\t\t\tthis._stopper.stop();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmove: ( dx: number, dy: number, x: number, y: number, ds: number ): void => {\r\n\t\t\t\t\t\tconst target = toTarget( parent );\r\n\t\t\t\t\t\tif( target != null ) {\r\n\t\t\t\t\t\t\t// Scale\r\n\t\t\t\t\t\t\tconst oldScale = target.scale.y;\r\n\t\t\t\t\t\t\tconst newScale = stopper.toNormalizedScale( oldScale * ds );\r\n\t\t\t\t\t\t\tconst scaleRatio = newScale / oldScale;\r\n\r\n\t\t\t\t\t\t\t// Position\r\n\t\t\t\t\t\t\tconst cx = x - dx;\r\n\t\t\t\t\t\t\tconst cy = y - dy;\r\n\t\t\t\t\t\t\tconst position = target.position;\r\n\t\t\t\t\t\t\tconst newX = (position.x - cx) * scaleRatio + x;\r\n\t\t\t\t\t\t\tconst newY = (position.y - cy) * scaleRatio + y;\r\n\r\n\t\t\t\t\t\t\t// Update\r\n\t\t\t\t\t\t\ttarget.scale.set( newScale, newScale );\r\n\t\t\t\t\t\t\ttarget.position.set( newX, newY );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tconst dragUtil = this._dragUtil;\r\n\t\tif( dragUtil != null ) {\r\n\t\t\tdragUtil.stop();\r\n\t\t}\r\n\t}\r\n\r\n\tonDown( e: interaction.InteractionEvent ): void {\r\n\t\tif( ! this._bind ) {\r\n\t\t\tconst dragUtil = this._dragUtil;\r\n\t\t\tif( dragUtil ) {\r\n\t\t\t\tdragUtil.onDown( e );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DAnimation } from \"./d-animation\";\r\nimport { DAnimationBase } from \"./d-animation-base\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DViewStopper } from \"./d-view-stopper\";\r\nimport { DViewTarget, DViewToTarget } from \"./d-view-to-target\";\r\nimport { DViewTransform } from \"./d-view-transform\";\r\n\r\nexport class DViewTransformImpl implements DViewTransform {\r\n\tprotected _parent: DBase;\r\n\tprotected _toTarget: DViewToTarget;\r\n\tprotected _newX: number;\r\n\tprotected _newY: number;\r\n\tprotected _newScaleX: number;\r\n\tprotected _newScaleY: number;\r\n\tprotected _oldX: number;\r\n\tprotected _oldY: number;\r\n\tprotected _oldScaleX: number;\r\n\tprotected _oldScaleY: number;\r\n\tprotected _animation: DAnimation;\r\n\tprotected _stopper: DViewStopper;\r\n\tprotected _duration: number;\r\n\r\n\tconstructor( parent: DBase, toTarget: DViewToTarget, stopper: DViewStopper, duration: number ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._toTarget = toTarget;\r\n\t\tthis._newScaleX = 1;\r\n\t\tthis._newScaleY = 1;\r\n\t\tthis._newX =  0;\r\n\t\tthis._newY = 0;\r\n\t\tthis._oldScaleX = 1;\r\n\t\tthis._oldScaleY = 1;\r\n\t\tthis._oldX = 0;\r\n\t\tthis._oldY = 0;\r\n\t\tthis._animation = new DAnimationBase({\r\n\t\t\tonTime: ( time: number ): void => {\r\n\t\t\t\tthis.onTime( time );\r\n\t\t\t},\r\n\t\t\tduration\r\n\t\t});\r\n\t\tthis._stopper = stopper;\r\n\t\tthis._duration = duration;\r\n\t}\r\n\r\n\tprotected onTime( time: number ): void {\r\n\t\tconst w0 = 1 - time;\r\n\t\tconst w1 = time;\r\n\r\n\t\tconst scaleX = this._oldScaleX * w0 + this._newScaleX * w1;\r\n\t\tconst scaleY = this._oldScaleY * w0 + this._newScaleY * w1;\r\n\t\tconst x = this._oldX * w0 + this._newX * w1;\r\n\t\tconst y = this._oldY * w0 + this._newY * w1;\r\n\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target != null ) {\r\n\t\t\ttarget.scale.set( scaleX, scaleY );\r\n\t\t\ttarget.position.set( x, y );\r\n\t\t}\r\n\t}\r\n\r\n\tstart(\r\n\t\ttarget: DViewTarget,\r\n\t\tx: number, Y: number,\r\n\t\tscaleX: number, scaleY: number,\r\n\t\tduration?: number, stop?: boolean\r\n\t): void {\r\n\t\tif( stop !== false ) {\r\n\t\t\tthis._stopper.stop();\r\n\t\t}\r\n\t\tif( duration == null ) {\r\n\t\t\tduration = this._duration;\r\n\t\t}\r\n\t\tif( duration <= 0 ) {\r\n\t\t\ttarget.scale.set( scaleX, scaleY );\r\n\t\t\ttarget.position.set( x, Y );\r\n\t\t} else {\r\n\t\t\tconst position = target.position;\r\n\t\t\tconst scale = target.scale;\r\n\t\t\tthis._oldX = position.x;\r\n\t\t\tthis._oldY = position.y;\r\n\t\t\tthis._oldScaleX = scale.x;\r\n\t\t\tthis._oldScaleY = scale.y;\r\n\r\n\t\t\tthis._newX = x;\r\n\t\t\tthis._newY = Y;\r\n\t\t\tthis._newScaleX = scaleX;\r\n\t\t\tthis._newScaleY = scaleY;\r\n\r\n\t\t\tthis._animation.duration = duration;\r\n\t\t\tthis._animation.start();\r\n\t\t}\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tthis._animation.stop();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, IPoint, Point, Rectangle } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DMouseModifier } from \"./d-mouse-modifier\";\r\nimport { DMouseModifiers } from \"./d-mouse-modifiers\";\r\nimport { DThemeView, DView, DViewChecker, DViewOptions } from \"./d-view\";\r\nimport { DViewDrag } from \"./d-view-drag\";\r\nimport { DViewDragImpl } from \"./d-view-drag-impl\";\r\nimport { DViewTargetPoint, DViewToTarget } from \"./d-view-to-target\";\r\nimport { DViewTransformImpl } from \"./d-view-transform-impl\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\r\n\r\nexport class DViewImpl implements DView {\r\n\tprotected _parent: DBase;\r\n\tprotected _toTarget: DViewToTarget;\r\n\r\n\tprotected _zoomPoint: Point;\r\n\tprotected _zoomMin: number;\r\n\tprotected _zoomMax: number;\r\n\tprotected _zoomKeepRatio: boolean;\r\n\r\n\tprotected _isWheelZoomEnabled: boolean;\r\n\tprotected _wheelZoomSpeed: number;\r\n\tprotected _wheelZoomModifier: DMouseModifier;\r\n\tprotected _wheelZoomChecker: DViewChecker;\r\n\r\n\tprotected _isDblClickZoomEnabled: boolean;\r\n\tprotected _dblClickZoomSpeed: number;\r\n\tprotected _dblClickZoomModifier: DMouseModifier;\r\n\tprotected _dblClickZoomChecker: DViewChecker;\r\n\tprotected _dblclickZoomDuration: number;\r\n\r\n\tprotected _isWheelTranslationEnabled: boolean;\r\n\tprotected _wheelTranslationSpeed: number;\r\n\tprotected _wheelTranslationModifier: DMouseModifier;\r\n\tprotected _wheelTranslationChecker: DViewChecker;\r\n\r\n\tprotected _transform: DViewTransformImpl;\r\n\tprotected _drag: DViewDragImpl;\r\n\r\n\tprotected _workRect: Rectangle;\r\n\r\n\tconstructor( parent: DBase, toTarget: DViewToTarget, options: DViewOptions | undefined ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._toTarget = toTarget;\r\n\r\n\t\tthis._workRect = new Rectangle();\r\n\r\n\t\t// Theme\r\n\t\tconst theme = this.toTheme( options ) || this.getThemeDefault();\r\n\r\n\t\t// Zoom\r\n\t\tconst zoom = options && options.zoom;\r\n\t\tthis._zoomPoint = new Point();\r\n\t\tthis._zoomMin = zoom && zoom.min != null ? zoom.min : theme.getZoomMin();\r\n\t\tthis._zoomMax = zoom && zoom.max != null ? zoom.max : theme.getZoomMax();\r\n\t\tthis._zoomKeepRatio = zoom && zoom.keepRatio != null ? zoom.keepRatio : theme.getZoomKeepRatio();\r\n\r\n\t\t// Zoom: Wheel\r\n\t\tconst wheelZoom = zoom && zoom.wheel;\r\n\t\tthis._isWheelZoomEnabled = ( wheelZoom && wheelZoom.enable != null ?\r\n\t\t\twheelZoom.enable : theme.isWheelZoomEnabled()\r\n\t\t);\r\n\t\tthis._wheelZoomSpeed = ( wheelZoom && wheelZoom.speed != null ?\r\n\t\t\twheelZoom.speed : theme.getWheelZoomSpeed()\r\n\t\t);\r\n\t\tthis._wheelZoomModifier = ( wheelZoom && wheelZoom.modifier != null ?\r\n\t\t\t( isString( wheelZoom.modifier ) ?\r\n\t\t\t\tDMouseModifier[ wheelZoom.modifier ] : wheelZoom.modifier\r\n\t\t\t) :\r\n\t\t\ttheme.getWheelZoomModifier()\r\n\t\t);\r\n\t\tthis._wheelZoomChecker = (wheelZoom && wheelZoom.checker) || DMouseModifiers.match;\r\n\r\n\t\t// Zoom: Dbl click\r\n\t\tconst dblClickZoom = zoom && zoom.dblclick;\r\n\t\tthis._isDblClickZoomEnabled = ( dblClickZoom && dblClickZoom.enable != null ?\r\n\t\t\tdblClickZoom.enable : theme.isDblClickZoomEnabled()\r\n\t\t);\r\n\t\tthis._dblClickZoomSpeed = ( dblClickZoom && dblClickZoom.amount != null ?\r\n\t\t\tdblClickZoom.amount : theme.getDblClickZoomSpeed()\r\n\t\t);\r\n\t\tthis._dblClickZoomModifier = ( dblClickZoom && dblClickZoom.modifier != null ?\r\n\t\t\t( isString( dblClickZoom.modifier ) ?\r\n\t\t\t\tDMouseModifier[ dblClickZoom.modifier ] : dblClickZoom.modifier\r\n\t\t\t) :\r\n\t\t\ttheme.getDblClickZoomModifier()\r\n\t\t);\r\n\t\tthis._dblClickZoomChecker = ( dblClickZoom && dblClickZoom.checker ) || DMouseModifiers.match;\r\n\t\tthis._dblclickZoomDuration = ( dblClickZoom && dblClickZoom.duration != null ?\r\n\t\t\tdblClickZoom.duration : theme.getDblClickZoomDuration()\r\n\t\t);\r\n\r\n\t\t// Translation: Wheel\r\n\t\tconst wheelTranslation = options && options.translation && options.translation.wheel;\r\n\t\tthis._isWheelTranslationEnabled = ( wheelTranslation && wheelTranslation.enable != null ?\r\n\t\t\twheelTranslation.enable : theme.isWheelTranslationEnabled()\r\n\t\t);\r\n\t\tthis._wheelTranslationSpeed = ( wheelTranslation && wheelTranslation.speed != null ?\r\n\t\t\twheelTranslation.speed : theme.getWheelTranslationSpeed()\r\n\t\t);\r\n\t\tthis._wheelTranslationModifier = ( wheelTranslation && wheelTranslation.modifier != null ?\r\n\t\t\t( isString( wheelTranslation.modifier ) ?\r\n\t\t\t\tDMouseModifier[ wheelTranslation.modifier ] : wheelTranslation.modifier\r\n\t\t\t) :\r\n\t\t\ttheme.getWheelTranslationModifier()\r\n\t\t);\r\n\t\tthis._wheelTranslationChecker = ( wheelTranslation && wheelTranslation.checker ) || DMouseModifiers.match;\r\n\r\n\t\t// Drag\r\n\t\tthis._drag = new DViewDragImpl( parent, toTarget, this, theme, options && options.drag );\r\n\r\n\t\t// Transform\r\n\t\tthis._transform = new DViewTransformImpl( parent, toTarget, this, this._dblclickZoomDuration );\r\n\t}\r\n\r\n\tget drag(): DViewDrag {\r\n\t\treturn this._drag;\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tthis._drag.stop();\r\n\t\tthis._transform.stop();\r\n\t}\r\n\r\n\treset( duration?: number, stop?: boolean ): void {\r\n\t\tconst parent = this._parent;\r\n\t\tconst target = this._toTarget( parent );\r\n\t\tif( target ) {\r\n\t\t\tconst targetRect = target.getLocalBounds( this._workRect );\r\n\t\t\tconst newTargetX = (parent.width - targetRect.width) * 0.5 - targetRect.x;\r\n\t\t\tconst newTargetY = (parent.height - targetRect.height) * 0.5 - targetRect.y;\r\n\t\t\tthis._transform.start( target, newTargetX, newTargetY, 1, 1, duration, stop );\r\n\t\t}\r\n\t}\r\n\r\n\tfit( duration?: number, stop?: boolean ): void {\r\n\t\tconst parent = this._parent;\r\n\t\tconst target = this._toTarget( parent ) as any;\r\n\t\tif( target ) {\r\n\t\t\tconst padding = parent.padding;\r\n\t\t\tconst width = parent.width;\r\n\t\t\tconst height = parent.height;\r\n\t\t\tconst targetRect = target.getLocalBounds( this._workRect );\r\n\t\t\tconst targetX = targetRect.x;\r\n\t\t\tconst targetY = targetRect.y;\r\n\t\t\tconst targetWidth = targetRect.width;\r\n\t\t\tconst targetHeight = targetRect.height;\r\n\t\t\tlet newTargetScaleX = (width - padding.getLeft() - padding.getRight()) / targetWidth;\r\n\t\t\tlet newTargetScaleY = (height - padding.getTop() - padding.getBottom()) / targetHeight;\r\n\t\t\tif( this._zoomKeepRatio ) {\r\n\t\t\t\tconst newTargetScale = this.toNormalizedScale( Math.min( newTargetScaleX, newTargetScaleY ) );\r\n\t\t\t\tnewTargetScaleX = newTargetScale;\r\n\t\t\t\tnewTargetScaleY = newTargetScale;\r\n\t\t\t} else {\r\n\t\t\t\tnewTargetScaleX = this.toNormalizedScale( newTargetScaleX );\r\n\t\t\t\tnewTargetScaleY = this.toNormalizedScale( newTargetScaleY );\r\n\t\t\t}\r\n\t\t\tconst newTargetWidth = targetWidth * newTargetScaleX;\r\n\t\t\tconst newTargetHeight = targetHeight * newTargetScaleY;\r\n\t\t\tconst newTargetX = (width - newTargetWidth) * 0.5 - targetX * newTargetScaleX;\r\n\t\t\tconst newTargetY = (height - newTargetHeight) * 0.5 - targetY * newTargetScaleY;\r\n\t\t\tthis._transform.start( target, newTargetX, newTargetY, newTargetScaleX, newTargetScaleY, duration, stop );\r\n\t\t}\r\n\t}\r\n\r\n\tzoomIn( duration?: number, stop?: boolean ): void {\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target ) {\r\n\t\t\tconst factor = this._dblClickZoomSpeed;\r\n\t\t\tconst targetScale = target.scale;\r\n\t\t\tthis.zoom( targetScale.x * factor, targetScale.y * factor, duration, stop );\r\n\t\t}\r\n\t}\r\n\r\n\tzoomOut( duration?: number, stop?: boolean ): void {\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target ) {\r\n\t\t\tconst factor = 1 / this._dblClickZoomSpeed;\r\n\t\t\tconst targetScale = target.scale;\r\n\t\t\tthis.zoom( targetScale.x * factor, targetScale.y * factor, duration, stop );\r\n\t\t}\r\n\t}\r\n\r\n\tzoomAt( x: number, y: number, scaleX: number, scaleY: number, duration?: number, stop?: boolean ): void {\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target ) {\r\n\t\t\t// Scale\r\n\t\t\tconst oldScaleX = target.scale.x;\r\n\t\t\tconst oldScaleY = target.scale.y;\r\n\t\t\tconst newScaleX = this.toNormalizedScale( scaleX );\r\n\t\t\tconst newScaleY = this.toNormalizedScale( scaleY );\r\n\t\t\tconst scaleRatioX = newScaleX / oldScaleX;\r\n\t\t\tconst scaleRatioY = newScaleY / oldScaleY;\r\n\r\n\t\t\t// Position\r\n\t\t\tconst newX = (target.position.x - x) * scaleRatioX + x;\r\n\t\t\tconst newY = (target.position.y - y) * scaleRatioY + y;\r\n\r\n\t\t\t// Start\r\n\t\t\tthis._transform.start( target, newX, newY, newScaleX, newScaleY, duration, stop );\r\n\t\t}\r\n\t}\r\n\r\n\tzoomAtGlobal( x: number, y: number, scaleX: number, scaleY: number, duration?: number, stop?: boolean ): void {\r\n\t\tconst local = this._zoomPoint;\r\n\t\tlocal.set( x, y );\r\n\t\tthis.toLocal( local, local );\r\n\t\tthis.zoomAt( local.x, local.y, scaleX, scaleY, duration, stop );\r\n\t}\r\n\r\n\tzoom( scaleX: number, scaleY: number, duration?: number, stop?: boolean ): void {\r\n\t\tconst parent = this._parent;\r\n\t\tthis.zoomAt( parent.width * 0.5, parent.height * 0.5, scaleX, scaleY, duration, stop );\r\n\t}\r\n\r\n\tget scale(): DViewTargetPoint {\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target ) {\r\n\t\t\treturn target.scale;\r\n\t\t}\r\n\t\treturn new Point( 1, 1 );\r\n\t}\r\n\r\n\tset scale( scale: DViewTargetPoint ) {\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target ) {\r\n\t\t\tconst newScaleX = this.toNormalizedScale( scale.x );\r\n\t\t\tconst newScaleY = this.toNormalizedScale( scale.y );\r\n\t\t\ttarget.scale.set( newScaleX, newScaleY );\r\n\t\t}\r\n\t}\r\n\r\n\tmoveTo( x: number, y: number, duration?: number, stop?: boolean ): void {\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target ) {\r\n\t\t\tconst targetScale = target.scale;\r\n\t\t\tthis._transform.start( target, x, y, targetScale.x, targetScale.y, duration, stop );\r\n\t\t}\r\n\t}\r\n\r\n\tget position(): DViewTargetPoint {\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target ) {\r\n\t\t\treturn target.position;\r\n\t\t}\r\n\t\treturn new Point( 0, 0 );\r\n\t}\r\n\r\n\tset position( position: DViewTargetPoint ) {\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target ) {\r\n\t\t\ttarget.position.set( position.x, position.y );\r\n\t\t}\r\n\t}\r\n\r\n\ttransform(\r\n\t\tx: number, y: number,\r\n\t\tscaleX: number, scaleY: number,\r\n\t\tduration?: number, stop?: boolean\r\n\t): void {\r\n\t\tconst target = this._toTarget( this._parent );\r\n\t\tif( target ) {\r\n\t\t\tthis._transform.start( target, x, y, scaleX, scaleY, duration, stop );\r\n\t\t}\r\n\t}\r\n\r\n\ttoLocal( global: IPoint, local: IPoint, skipUpdate?: boolean ): IPoint {\r\n\t\treturn this._parent.toLocal( global, undefined, local, skipUpdate );\r\n\t}\r\n\r\n\ttoGlobal( local: IPoint, global: IPoint, skipUpdate?: boolean ): IPoint {\r\n\t\treturn this._parent.toGlobal( local, global, skipUpdate );\r\n\t}\r\n\r\n\ttoNormalizedScale( scale: number ): number {\r\n\t\treturn Math.min( this._zoomMax, Math.max( this._zoomMin, scale ) );\r\n\t}\r\n\r\n\tonWheel( e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point ): boolean {\r\n\t\tif( this._isWheelZoomEnabled &&\r\n\t\t\tthis._wheelZoomChecker( e, this._wheelZoomModifier, this._parent ) ) {\r\n\t\t\tif( deltas.deltaY !== 0 ) {\r\n\t\t\t\tconst target = this._toTarget( this._parent );\r\n\t\t\t\tif( target ) {\r\n\t\t\t\t\tconst speed = deltas.lowest * this._wheelZoomSpeed;\r\n\t\t\t\t\tconst factor = 1 + deltas.deltaY * speed;\r\n\t\t\t\t\tconst targetScale = target.scale;\r\n\t\t\t\t\tthis.zoomAtGlobal( global.x, global.y, targetScale.x * factor, targetScale.y * factor, 0 );\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( this._isWheelTranslationEnabled &&\r\n\t\t\tthis._wheelTranslationChecker( e, this._wheelTranslationModifier, this._parent ) ) {\r\n\t\t\tconst target = this._toTarget( this._parent );\r\n\t\t\tif( target ) {\r\n\t\t\t\tthis.stop();\r\n\t\t\t\tconst speed = deltas.lowest * this._wheelTranslationSpeed;\r\n\t\t\t\ttarget.position.set(\r\n\t\t\t\t\ttarget.position.x - deltas.deltaX * speed,\r\n\t\t\t\t\ttarget.position.y + deltas.deltaY * speed\r\n\t\t\t\t);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonDown( e: interaction.InteractionEvent ): void {\r\n\t\tthis._drag.onDown( e );\r\n\t}\r\n\r\n\tonDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean {\r\n\t\tif( this._isDblClickZoomEnabled &&\r\n\t\t\tthis._dblClickZoomChecker( e, this._dblClickZoomModifier, this._parent ) ) {\r\n\t\t\tconst target = this._toTarget( this._parent );\r\n\t\t\tif( target ) {\r\n\t\t\t\tconst global = this._zoomPoint;\r\n\t\t\t\tUtilPointerEvent.toGlobal( e, interactionManager, global );\r\n\t\t\t\tconst factor = this._dblClickZoomSpeed;\r\n\t\t\t\tconst targetScale = target.scale;\r\n\t\t\t\tthis.zoomAtGlobal( global.x, global.y, targetScale.x * factor, targetScale.y * factor, this._dblclickZoomDuration );\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected toTheme( options?: DViewOptions ): DThemeView | null {\r\n\t\tif( options && options.theme ) {\r\n\t\t\tconst theme = options.theme;\r\n\t\t\tif( isString( theme ) ) {\r\n\t\t\t\treturn DThemes.getInstance().get( theme );\r\n\t\t\t} else {\r\n\t\t\t\treturn theme;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected getThemeDefault(): DThemeView {\r\n\t\treturn DThemes.getInstance().get( this.getType() );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DView\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase, DBaseOnOptions, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseOverflowMask } from \"./d-base-overflow-mask\";\r\nimport { DCanvas } from \"./d-canvas\";\r\nimport { DView, DViewOptions } from \"./d-view\";\r\nimport { DViewImpl } from \"./d-view-impl\";\r\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\r\n\r\nexport interface DCanvasContainerOnOptions<CANVAS> extends DBaseOnOptions {\r\n\t/**\r\n\t * Triggered when a canvas is removed.\r\n\t *\r\n\t * @param canvas a removed canvas\r\n\t * @param self a canvas container\r\n\t */\r\n\tunset?: ( canvas: CANVAS, self: any ) => void;\r\n\r\n\t/**\r\n\t * Triggered when a canvas is set.\r\n\t *\r\n\t * @param canvas a new canvas\r\n\t * @param self a canvas container\r\n\t */\r\n\tset?: ( canvas: CANVAS, self: any ) => void;\r\n}\r\n\r\nexport interface DCanvasContainerOptions<\r\n\tCANVAS extends DBase = DCanvas,\r\n\tTHEME extends DThemeCanvasContainer = DThemeCanvasContainer\r\n> extends DBaseOptions<THEME> {\r\n\tmask?: boolean;\r\n\tview?: DViewOptions;\r\n\tcanvas?: CANVAS;\r\n\ton?: DCanvasContainerOnOptions<CANVAS>;\r\n}\r\n\r\nexport interface DThemeCanvasContainer extends DThemeBase {\r\n\tisOverflowMaskEnabled(): boolean;\r\n}\r\n\r\nconst isOverflowMaskEnabled = <\r\n\tCANVAS extends DBase,\r\n\tTHEME extends DThemeCanvasContainer\r\n>( theme: THEME, options?: DCanvasContainerOptions<CANVAS, THEME> ): boolean => {\r\n\tif( options && options.mask != null ) {\r\n\t\treturn options.mask;\r\n\t}\r\n\treturn theme.isOverflowMaskEnabled();\r\n};\r\n\r\nexport class DCanvasContainer<\r\n\tCANVAS extends DBase = DCanvas,\r\n\tTHEME extends DThemeCanvasContainer = DThemeCanvasContainer,\r\n\tOPTIONS extends DCanvasContainerOptions<CANVAS, THEME> = DCanvasContainerOptions<CANVAS, THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected _canvas!: CANVAS | null;\r\n\tprotected _overflowMask!: DBaseOverflowMask | null;\r\n\tprotected _view!: DViewImpl;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._canvas = null;\r\n\t\tconst theme = this.theme;\r\n\t\tthis._view = new DViewImpl( this, () => this._canvas, options && options.view );\r\n\r\n\t\t// Canvas\r\n\t\tthis.canvas = ( options && options.canvas ? options.canvas : null );\r\n\r\n\t\t// Overflow mask\r\n\t\tthis._overflowMask = null;\r\n\t\tif( isOverflowMaskEnabled( theme, options ) ) {\r\n\t\t\tthis.mask = this.getOrCreateOverflowMask();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DCanvasContainer\";\r\n\t}\r\n\r\n\tonResize( newWidth: number, newHeight: number, oldWidth: number, oldHeight: number ): void {\r\n\t\tsuper.onResize( newWidth, newHeight, oldWidth, oldHeight );\r\n\t\tthis.updateContentSize( newWidth, newHeight, oldWidth, oldHeight );\r\n\t}\r\n\r\n\tget canvas(): CANVAS | null {\r\n\t\treturn this._canvas;\r\n\t}\r\n\r\n\tset canvas( canvas: CANVAS | null ) {\r\n\t\tconst previous = this._canvas;\r\n\t\tif( previous != null ) {\r\n\t\t\tthis._canvas = null;\r\n\t\t\tthis.removeChild( previous );\r\n\t\t\tthis.emit( \"unset\", previous, this );\r\n\t\t\tprevious.destroy();\r\n\t\t}\r\n\r\n\t\tthis._canvas = canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tthis.addChild( canvas );\r\n\t\t\tthis._view.reset( 0 );\r\n\t\t\tthis.emit( \"set\", canvas, this );\r\n\t\t} else {\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getOrCreateOverflowMask(): DBaseOverflowMask {\r\n\t\tif( this._overflowMask == null ) {\r\n\t\t\tthis._overflowMask = new DBaseOverflowMask( this );\r\n\t\t\tthis.addReflowable( this._overflowMask );\r\n\t\t\tthis.toDirty();\r\n\t\t}\r\n\t\treturn this._overflowMask;\r\n\t}\r\n\r\n\tprotected updateContentSize( newWidth: number, newHeight: number, oldWidth: number, oldHeight: number ): void {\r\n\t\tconst canvas = this._canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst canvasX = canvas.x + (newWidth - oldWidth) * 0.5;\r\n\t\t\tconst canvasY = canvas.y + (newHeight - oldHeight) * 0.5;\r\n\t\t\tcanvas.position.set( canvasX, canvasY );\r\n\t\t}\r\n\t}\r\n\r\n\tget view(): DView {\r\n\t\treturn this._view;\r\n\t}\r\n\r\n\tonWheel( e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point ): boolean {\r\n\t\tconst vresult = this._view.onWheel( e, deltas, global );\r\n\t\tconst sresult = super.onWheel( e, deltas, global );\r\n\t\treturn vresult || sresult;\r\n\t}\r\n\r\n\tonDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean {\r\n\t\tconst vresult = this._view.onDblClick( e, interactionManager );\r\n\t\tconst sresult = super.onDblClick( e, interactionManager );\r\n\t\treturn vresult || sresult;\r\n\t}\r\n\r\n\tprotected onDown( e: interaction.InteractionEvent ): void {\r\n\t\tthis._view.onDown( e );\r\n\t\tsuper.onDown( e );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// Overflow mask\r\n\t\tconst overflowMask = this._overflowMask;\r\n\t\tif( overflowMask != null ) {\r\n\t\t\tthis._overflowMask = null;\r\n\t\t\toverflowMask.destroy();\r\n\t\t}\r\n\t\t(this as any).mask = null;\r\n\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCanvasContainer } from \"../../d-canvas-container\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\n\r\nexport type EShapeActionExpression<T> = ( shape: EShape, time: number ) => T;\r\n\r\nexport class EShapeActionRuntime {\r\n\treset: EShapeRuntimeReset;\r\n\r\n\tconstructor( reset?: EShapeRuntimeReset ) {\r\n\t\tthis.reset = reset || EShapeRuntimeReset.NONE;\r\n\t}\r\n\r\n\ttoExpression<T>(\r\n\t\texpression: string, def: EShapeActionExpression<T>, defLiteral: string\r\n\t): EShapeActionExpression<T> {\r\n\t\tif( expression.trim().length <= 0 ) {\r\n\t\t\treturn def;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\treturn Function(\r\n\t\t\t\t\"shape\", \"time\",\r\n\t\t\t\t`try{ with( shape ) { return (${expression}); } } catch( e ) { return ${defLiteral}; }`\r\n\t\t\t) as EShapeActionExpression<T>;\r\n\t\t} catch( e ) {\r\n\t\t\treturn def;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toContainer( shape: EShape ): any | null {\r\n\t\tlet current: { parent: any; } = shape;\r\n\t\twhile( current != null ) {\r\n\t\t\tif( current instanceof DCanvasContainer ) {\r\n\t\t\t\treturn current;\r\n\t\t\t}\r\n\t\t\tcurrent = current.parent;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\t// OVERRIDE THIS\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression, EShapeActionRuntime } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\n\r\nconst conditionDefault = (): boolean => true;\r\n\r\nexport class EShapeActionRuntimeConditional extends EShapeActionRuntime {\r\n\tprotected readonly condition: EShapeActionExpression<boolean>;\r\n\r\n\tconstructor( value: EShapeActionValue, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( reset );\r\n\t\tthis.condition = this.toExpression( value.condition, conditionDefault, \"true\" );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\r\n\r\nexport class EShapeActionRuntimeBlink extends EShapeActionRuntimeConditional {\r\n\tprotected interval: number;\r\n\r\n\tconstructor( value: EShapeActionValueBlink, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( value, reset );\r\n\t\tthis.interval = value.interval;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst interval = this.interval;\r\n\t\t\tconst dinterval = ( interval << 1 );\r\n\t\t\tconst elapsed = ( time % dinterval );\r\n\t\t\tif( elapsed < interval ) {\r\n\t\t\t\tthis.toOff( shape, runtime );\r\n\t\t\t\truntime.effect = time + ( interval - elapsed );\r\n\t\t\t} else {\r\n\t\t\t\tthis.toOn( shape, runtime );\r\n\t\t\t\truntime.effect = time + ( dinterval - elapsed );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toOn( shape: EShape, runtime: EShapeRuntime ): void {\r\n\t\t//\r\n\t}\r\n\r\n\tprotected toOff( shape: EShape, runtime: EShapeRuntime ): void {\r\n\t\t//\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { UtilRgb } from \"../../util/util-rgb\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\r\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\r\n\r\nexport class EShapeActionRuntimeBlinkBrighten extends EShapeActionRuntimeBlink {\r\n\tconstructor( value: EShapeActionValueBlink ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR );\r\n\t}\r\n\r\n\tprotected toOn( shape: EShape, runtime: EShapeRuntime ): void {\r\n\t\tconst fill = EShapeActionBases.toBaseFill( shape, runtime );\r\n\t\tshape.fill.set(\r\n\t\t\tundefined,\r\n\t\t\tUtilRgb.brighten( fill.color, 0.5 ),\r\n\t\t\tfill.alpha\r\n\t\t);\r\n\r\n\t\tconst stroke = EShapeActionBases.toBaseStroke( shape, runtime );\r\n\t\tshape.stroke.set(\r\n\t\t\tundefined,\r\n\t\t\tUtilRgb.brighten( stroke.color, 0.5 ),\r\n\t\t\tstroke.alpha\r\n\t\t);\r\n\r\n\t\tconst text = EShapeActionBases.toBaseText( shape, runtime );\r\n\t\tshape.text.set(\r\n\t\t\tundefined,\r\n\t\t\tUtilRgb.brighten( text.color, 0.5 ),\r\n\t\t\ttext.alpha\r\n\t\t);\r\n\r\n\t\tconst outline = EShapeActionBases.toBaseTextOutline( shape, runtime );\r\n\t\tshape.text.outline.set(\r\n\t\t\tundefined,\r\n\t\t\tUtilRgb.brighten( outline.color, 0.5 ),\r\n\t\t\toutline.alpha\r\n\t\t);\r\n\r\n\t\truntime.written |= this.reset;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\r\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\r\n\r\nexport class EShapeActionRuntimeBlinkColorFill extends EShapeActionRuntimeBlink {\r\n\tprotected color: number;\r\n\tprotected alpha: number;\r\n\r\n\tconstructor( value: EShapeActionValueBlink ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_FILL );\r\n\t\tthis.color = value.color;\r\n\t\tthis.alpha = value.alpha;\r\n\t}\r\n\r\n\tprotected toOn( shape: EShape, runtime: EShapeRuntime ): void {\r\n\t\tshape.fill.set( undefined, this.color, this.alpha );\r\n\t\truntime.written |= this.reset;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\r\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\r\n\r\nexport class EShapeActionRuntimeBlinkColorStroke extends EShapeActionRuntimeBlink {\r\n\tprotected color: number;\r\n\tprotected alpha: number;\r\n\r\n\tconstructor( value: EShapeActionValueBlink ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_STROKE );\r\n\t\tthis.color = value.color;\r\n\t\tthis.alpha = value.alpha;\r\n\t}\r\n\r\n\tprotected toOn( shape: EShape, runtime: EShapeRuntime ): void {\r\n\t\tshape.stroke.set( undefined, this.color, this.alpha );\r\n\t\truntime.written |= this.reset;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { UtilRgb } from \"../../util/util-rgb\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\r\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\r\n\r\nexport class EShapeActionRuntimeBlinkDarken extends EShapeActionRuntimeBlink {\r\n\tconstructor( value: EShapeActionValueBlink ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR );\r\n\t}\r\n\r\n\tprotected toOn( shape: EShape, runtime: EShapeRuntime ): void {\r\n\t\tconst fill = EShapeActionBases.toBaseFill( shape, runtime );\r\n\t\tshape.fill.set(\r\n\t\t\tundefined,\r\n\t\t\tUtilRgb.darken( fill.color, 0.5 ),\r\n\t\t\tfill.alpha\r\n\t\t);\r\n\r\n\t\tconst stroke = EShapeActionBases.toBaseStroke( shape, runtime );\r\n\t\tshape.stroke.set(\r\n\t\t\tundefined,\r\n\t\t\tUtilRgb.darken( stroke.color, 0.5 ),\r\n\t\t\tstroke.alpha\r\n\t\t);\r\n\r\n\t\tconst text = EShapeActionBases.toBaseText( shape, runtime );\r\n\t\tshape.text.set(\r\n\t\t\tundefined,\r\n\t\t\tUtilRgb.darken( text.color, 0.5 ),\r\n\t\t\ttext.alpha\r\n\t\t);\r\n\r\n\t\tconst outline = EShapeActionBases.toBaseTextOutline( shape, runtime );\r\n\t\tshape.text.outline.set(\r\n\t\t\tundefined,\r\n\t\t\tUtilRgb.darken( outline.color, 0.5 ),\r\n\t\t\toutline.alpha\r\n\t\t);\r\n\r\n\t\truntime.written |= this.reset;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\r\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\r\n\r\nexport class EShapeActionRuntimeBlinkOpacity extends EShapeActionRuntimeBlink {\r\n\tconstructor( value: EShapeActionValueBlink ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_FILL_AND_STROKE );\r\n\t}\r\n\r\n\tprotected toOn( shape: EShape, runtime: EShapeRuntime ): void {\r\n\t\tconst fill = EShapeActionBases.toBaseFill( shape, runtime );\r\n\t\tshape.fill.set(\r\n\t\t\tundefined,\r\n\t\t\tfill.color,\r\n\t\t\tfill.alpha * 0.5\r\n\t\t);\r\n\r\n\t\tconst stroke = EShapeActionBases.toBaseStroke( shape, runtime );\r\n\t\tshape.stroke.set(\r\n\t\t\tundefined,\r\n\t\t\tstroke.color,\r\n\t\t\tstroke.alpha * 0.5\r\n\t\t);\r\n\r\n\t\truntime.written |= this.reset;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\r\nimport { EShapeActionValueBlink } from \"./e-shape-action-value-blink\";\r\n\r\nexport class EShapeActionRuntimeBlinkVisibility extends EShapeActionRuntimeBlink {\r\n\tconstructor( value: EShapeActionValueBlink ) {\r\n\t\tsuper( value, EShapeRuntimeReset.VISIBILITY );\r\n\t}\r\n\r\n\tprotected toOn( shape: EShape, runtime: EShapeRuntime ): void {\r\n\t\tshape.visible = true;\r\n\t\truntime.written |= this.reset;\r\n\t}\r\n\r\n\tprotected toOff( shape: EShape, runtime: EShapeRuntime ): void {\r\n\t\tshape.visible = false;\r\n\t\truntime.written |= this.reset;\r\n\t}\r\n}\r\n","import { DThemes } from \"../../theme/d-themes\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionValue, EThemeShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\n\r\nexport abstract class EShapeActionValueBase implements EShapeActionValue {\r\n\treadonly type: EShapeActionValueType;\r\n\treadonly condition: string;\r\n\r\n\tconstructor( type: EShapeActionValueType, condition: string ) {\r\n\t\tthis.type = type;\r\n\t\tthis.condition = condition;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tthis.type === value.type &&\r\n\t\t\tthis.condition === value.condition\r\n\t\t);\r\n\t}\r\n\r\n\ttoLabel(): string {\r\n\t\treturn DThemes.getInstance().get<EThemeShapeActionValue>( \"EShapeActionValue\" ).toLabel( this );\r\n\t}\r\n\r\n\tabstract toRuntime( shape: EShape ): EShapeActionRuntime;\r\n\tabstract serialize( manager: EShapeResourceManagerSerialization ): number;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueType {\r\n\tSHOW_HIDE,\r\n\tBLINK,\r\n\tTRANSFORM,\r\n\tOPEN,\r\n\tEMIT_EVENT,\r\n\tCHANGE_COLOR,\r\n\tCHANGE_TEXT,\r\n\tCHANGE_CURSOR,\r\n\tMISC\r\n}\r\n","import { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueBase } from \"./e-shape-action-value-base\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\n\r\nexport abstract class EShapeActionValueSubtyped<SUBTYPE extends number> extends EShapeActionValueBase {\r\n\treadonly subtype: SUBTYPE;\r\n\r\n\tconstructor( type: EShapeActionValueType, condition: string, subtype: SUBTYPE ) {\r\n\t\tsuper( type, condition );\r\n\t\tthis.subtype = subtype;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueSubtyped) &&\r\n\t\t\tthis.subtype === value.subtype\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { isNumber } from \"../../util/is-number\";\r\n\r\nexport class EShapeActionValues {\r\n\tstatic toResource( index: number, parsed: number[], resources: string[] ): string {\r\n\t\tif( 0 <= index && index < parsed.length ) {\r\n\t\t\tconst id = parsed[ index ];\r\n\t\t\tif( isNumber( id ) && 0 <= id && id < resources.length ) {\r\n\t\t\t\treturn resources[ id ];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueChangeColorTarget {\r\n\tCOLOR_AND_ALPHA,\r\n\tCOLOR,\r\n\tALPHA,\r\n\tCODE,\r\n\tBRIGHTNESS\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeBlink } from \"./e-shape-action-runtime-blink\";\r\nimport { EShapeActionRuntimeBlinkBrighten } from \"./e-shape-action-runtime-blink-brighten\";\r\nimport { EShapeActionRuntimeBlinkColorFill } from \"./e-shape-action-runtime-blink-color-fill\";\r\nimport { EShapeActionRuntimeBlinkColorStroke } from \"./e-shape-action-runtime-blink-color-stroke\";\r\nimport { EShapeActionRuntimeBlinkDarken } from \"./e-shape-action-runtime-blink-darken\";\r\nimport { EShapeActionRuntimeBlinkOpacity } from \"./e-shape-action-runtime-blink-opacity\";\r\nimport { EShapeActionRuntimeBlinkVisibility } from \"./e-shape-action-runtime-blink-visibility\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueBlinkType } from \"./e-shape-action-value-blink-type\";\r\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueBlinkSerialized = [\r\n\tEShapeActionValueType.BLINK, number,\r\n\tEShapeActionValueBlinkType.COLOR_FILL | EShapeActionValueBlinkType.COLOR_STROKE,\r\n\tnumber, number, number\r\n];\r\n\r\nexport class EShapeActionValueBlink extends EShapeActionValueSubtyped<EShapeActionValueBlinkType> {\r\n\treadonly interval: number;\r\n\treadonly color: number;\r\n\treadonly alpha: number;\r\n\r\n\tconstructor( subtype: EShapeActionValueBlinkType, condition: string, interval: number, color: number, alpha: number ) {\r\n\t\tsuper( EShapeActionValueType.BLINK, condition, subtype );\r\n\t\tthis.interval = interval;\r\n\t\tthis.color = color;\r\n\t\tthis.alpha = alpha;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueBlink) &&\r\n\t\t\tthis.interval === value.interval &&\r\n\t\t\tthis.color === value.color &&\r\n\t\t\tthis.alpha === value.alpha\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeBlink {\r\n\t\tswitch( this.subtype ) {\r\n\t\tcase EShapeActionValueBlinkType.BRIGHTEN:\r\n\t\t\treturn new EShapeActionRuntimeBlinkBrighten( this );\r\n\t\tcase EShapeActionValueBlinkType.COLOR_FILL:\r\n\t\t\treturn new EShapeActionRuntimeBlinkColorFill( this );\r\n\t\tcase EShapeActionValueBlinkType.COLOR_STROKE:\r\n\t\t\treturn new EShapeActionRuntimeBlinkColorStroke( this );\r\n\t\tcase EShapeActionValueBlinkType.DARKEN:\r\n\t\t\treturn new EShapeActionRuntimeBlinkDarken( this );\r\n\t\tcase EShapeActionValueBlinkType.OPACITY:\r\n\t\t\treturn new EShapeActionRuntimeBlinkOpacity( this );\r\n\t\tcase EShapeActionValueBlinkType.VISIBILITY:\r\n\t\t\treturn new EShapeActionRuntimeBlinkVisibility( this );\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\treturn manager.add(\r\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.interval},${this.color},${this.alpha}]`\r\n\t\t);\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueBlinkSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueBlink {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueBlink(\r\n\t\t\tserialized[ 2 ], condition, serialized[ 3 ],\r\n\t\t\tserialized[ 4 ], serialized[ 5 ]\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class UtilAlpha {\r\n\tstatic blend( alphaA: number, alphaB: number, t: number ): number {\r\n\t\tconst w = Math.max( 0, Math.min( 1, t ) );\r\n\t\treturn Math.max( 0, Math.min( 1, alphaA * (1 - w) + alphaB * w ) );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { UtilAlpha } from \"../../util/util-alpha\";\r\nimport { UtilRgb } from \"../../util/util-rgb\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeFill, EShapeFillLike } from \"../e-shape-fill\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeStroke, EShapeStrokeLike } from \"../e-shape-stroke\";\r\nimport { EShapeText, EShapeTextLike } from \"../e-shape-text\";\r\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"../e-shape-text-outline\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueChangeColor } from \"./e-shape-action-value-change-color\";\r\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\r\n\r\nconst blendDefault = (): number | null => null;\r\n\r\nexport class EShapeActionRuntimeChangeColor extends EShapeActionRuntimeConditional {\r\n\tprotected readonly color: number | undefined;\r\n\tprotected readonly alpha: number | undefined;\r\n\tprotected readonly blend: EShapeActionExpression<number | null>;\r\n\r\n\tconstructor( value: EShapeActionValueChangeColor, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( value, reset );\r\n\r\n\t\tswitch( value.target ) {\r\n\t\tcase EShapeActionValueChangeColorTarget.COLOR:\r\n\t\t\tthis.color = value.color;\r\n\t\t\tthis.alpha = undefined;\r\n\t\t\tbreak;\r\n\t\tcase EShapeActionValueChangeColorTarget.ALPHA:\r\n\t\t\tthis.color = undefined;\r\n\t\t\tthis.alpha = value.alpha;\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.color = value.color;\r\n\t\t\tthis.alpha = value.alpha;\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.blend = this.toExpression( value.blend, blendDefault, \"null\" );\r\n\t}\r\n\r\n\tprotected set(\r\n\t\tshape: EShape, runtime: EShapeRuntime, time: number,\r\n\t\ttarget: EShapeStroke | EShapeFill | EShapeText | EShapeTextOutline,\r\n\t\tbase: EShapeStrokeLike | EShapeFillLike | EShapeTextLike | EShapeTextOutlineLike\r\n\t): void {\r\n\t\tconst color = this.color;\r\n\t\tconst alpha = this.alpha;\r\n\t\tif( color != null ) {\r\n\t\t\tif( alpha != null ) {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\ttarget.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( base.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( base.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget.set( undefined, color, alpha );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\ttarget.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( base.color, color, blend ),\r\n\t\t\t\t\t\tbase.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget.set( undefined, color, base.alpha );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t} else if( alpha != null ) {\r\n\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\tif( blend != null ) {\r\n\t\t\t\ttarget.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbase.color,\r\n\t\t\t\t\tUtilAlpha.blend( base.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\ttarget.set( undefined, base.color, alpha );\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected sets(\r\n\t\tshape: EShape, runtime: EShapeRuntime, time: number,\r\n\t\tfill: EShapeFill, stroke: EShapeStroke,\r\n\t\tbaseFill: EShapeFillLike, baseStroke: EShapeStrokeLike\r\n\t): void {\r\n\t\tconst color = this.color;\r\n\t\tconst alpha = this.alpha;\r\n\t\tif( color != null ) {\r\n\t\t\tif( alpha != null ) {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\tfill.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseFill.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseFill.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tstroke.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseStroke.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseStroke.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfill.set( undefined, color, alpha );\r\n\t\t\t\t\tstroke.set( undefined, color, alpha );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\tfill.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseFill.color, color, blend ),\r\n\t\t\t\t\t\tbaseFill.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t\tstroke.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseStroke.color, color, blend ),\r\n\t\t\t\t\t\tbaseStroke.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfill.set( undefined, color, baseFill.alpha );\r\n\t\t\t\t\tstroke.set( undefined, color, baseStroke.alpha );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t} else if( alpha != null ) {\r\n\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\tif( blend != null ) {\r\n\t\t\t\tfill.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseFill.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseFill.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t\tstroke.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseStroke.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseStroke.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tfill.set( undefined, baseFill.color, alpha );\r\n\t\t\t\tstroke.set( undefined, baseStroke.color, alpha );\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setAll(\r\n\t\tshape: EShape, runtime: EShapeRuntime, time: number,\r\n\t\tfill: EShapeFill, stroke: EShapeStroke, text: EShapeText, outline: EShapeTextOutline,\r\n\t\tbaseFill: EShapeFillLike, baseStroke: EShapeStrokeLike, baseText: EShapeTextLike, baseOutline: EShapeTextOutlineLike\r\n\t): void {\r\n\t\tconst color = this.color;\r\n\t\tconst alpha = this.alpha;\r\n\t\tif( color != null ) {\r\n\t\t\tif( alpha != null ) {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\tfill.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseFill.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseFill.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tstroke.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseStroke.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseStroke.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t\ttext.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseText.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseText.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t\toutline.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseOutline.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseOutline.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfill.set( undefined, color, alpha );\r\n\t\t\t\t\tstroke.set( undefined, color, alpha );\r\n\t\t\t\t\ttext.set( undefined, color, alpha );\r\n\t\t\t\t\toutline.set( undefined, color, alpha );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\tfill.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseFill.color, color, blend ),\r\n\t\t\t\t\t\tbaseFill.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t\tstroke.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseStroke.color, color, blend ),\r\n\t\t\t\t\t\tbaseStroke.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t\ttext.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseText.color, color, blend ),\r\n\t\t\t\t\t\tbaseText.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t\toutline.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseOutline.color, color, blend ),\r\n\t\t\t\t\t\tbaseOutline.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfill.set( undefined, color, baseFill.alpha );\r\n\t\t\t\t\tstroke.set( undefined, color, baseStroke.alpha );\r\n\t\t\t\t\ttext.set( undefined, color, baseText.alpha );\r\n\t\t\t\t\toutline.set( undefined, color, baseOutline.alpha );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t} else if( alpha != null ) {\r\n\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\tif( blend != null ) {\r\n\t\t\t\tfill.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseFill.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseFill.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t\tstroke.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseStroke.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseStroke.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t\ttext.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseFill.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseText.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t\toutline.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseStroke.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseOutline.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tfill.set( undefined, baseFill.color, alpha );\r\n\t\t\t\tstroke.set( undefined, baseStroke.color, alpha );\r\n\t\t\t\ttext.set( undefined, baseText.color, alpha );\r\n\t\t\t\toutline.set( undefined, baseOutline.color, alpha );\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueChangeColorType {\r\n\tFILL,\r\n\tSTROKE,\r\n\tFILL_AND_STROKE,\r\n\tTEXT,\r\n\tTEXT_OUTLINE,\r\n\tALL\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColor } from \"./e-shape-action-runtime-change-color\";\r\nimport { EShapeActionValueChangeColor } from \"./e-shape-action-value-change-color\";\r\n\r\nexport class EShapeActionRuntimeChangeColorAll extends EShapeActionRuntimeChangeColor {\r\n\tconstructor( value: EShapeActionValueChangeColor ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.setAll(\r\n\t\t\t\tshape, runtime, time,\r\n\t\t\t\tshape.fill,\r\n\t\t\t\tshape.stroke,\r\n\t\t\t\tshape.text,\r\n\t\t\t\tshape.text.outline,\r\n\t\t\t\tEShapeActionBases.toBaseFill( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseStroke( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseText( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseTextOutline( shape, runtime )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColor } from \"./e-shape-action-runtime-change-color\";\r\nimport { EShapeActionValueChangeColor } from \"./e-shape-action-value-change-color\";\r\n\r\nexport class EShapeActionRuntimeChangeColorFill extends EShapeActionRuntimeChangeColor {\r\n\tconstructor( value: EShapeActionValueChangeColor ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_FILL );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.fill, EShapeActionBases.toBaseFill( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColor } from \"./e-shape-action-runtime-change-color\";\r\nimport { EShapeActionValueChangeColor } from \"./e-shape-action-value-change-color\";\r\n\r\nexport class EShapeActionRuntimeChangeColorFillAndStroke extends EShapeActionRuntimeChangeColor {\r\n\tconstructor( value: EShapeActionValueChangeColor ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_FILL_AND_STROKE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.sets(\r\n\t\t\t\tshape, runtime, time,\r\n\t\t\t\tshape.fill,\r\n\t\t\t\tshape.stroke,\r\n\t\t\t\tEShapeActionBases.toBaseFill( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseStroke( shape, runtime )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColor } from \"./e-shape-action-runtime-change-color\";\r\nimport { EShapeActionValueChangeColor } from \"./e-shape-action-value-change-color\";\r\n\r\nexport class EShapeActionRuntimeChangeColorStroke extends EShapeActionRuntimeChangeColor {\r\n\tconstructor( value: EShapeActionValueChangeColor ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_STROKE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.stroke, EShapeActionBases.toBaseStroke( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColor } from \"./e-shape-action-runtime-change-color\";\r\nimport { EShapeActionValueChangeColor } from \"./e-shape-action-value-change-color\";\r\n\r\nexport class EShapeActionRuntimeChangeColorText extends EShapeActionRuntimeChangeColor {\r\n\tconstructor( value: EShapeActionValueChangeColor ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_TEXT );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.text, EShapeActionBases.toBaseText( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColor } from \"./e-shape-action-runtime-change-color\";\r\nimport { EShapeActionValueChangeColor } from \"./e-shape-action-value-change-color\";\r\n\r\nexport class EShapeActionRuntimeChangeColorTextOutline extends EShapeActionRuntimeChangeColor {\r\n\tconstructor( value: EShapeActionValueChangeColor ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_TEXT_OUTLINE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.text.outline, EShapeActionBases.toBaseTextOutline( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeChangeColor } from \"./e-shape-action-runtime-change-color\";\r\nimport { EShapeActionRuntimeChangeColorAll } from \"./e-shape-action-runtime-change-color-all\";\r\nimport { EShapeActionRuntimeChangeColorFill } from \"./e-shape-action-runtime-change-color-fill\";\r\nimport { EShapeActionRuntimeChangeColorFillAndStroke } from \"./e-shape-action-runtime-change-color-fill-and-stroke\";\r\nimport { EShapeActionRuntimeChangeColorStroke } from \"./e-shape-action-runtime-change-color-stroke\";\r\nimport { EShapeActionRuntimeChangeColorText } from \"./e-shape-action-runtime-change-color-text\";\r\nimport { EShapeActionRuntimeChangeColorTextOutline } from \"./e-shape-action-runtime-change-color-text-outline\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\r\nimport { EShapeActionValueChangeColorType } from \"./e-shape-action-value-change-color-type\";\r\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\ntype Target = EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA | EShapeActionValueChangeColorTarget.COLOR |\r\n\tEShapeActionValueChangeColorTarget.ALPHA;\r\nexport type EShapeActionValueChangeColorSerialized = [\r\n\tEShapeActionValueType.CHANGE_COLOR, number, EShapeActionValueChangeColorType,\r\n\tTarget, number, number, number\r\n];\r\n\r\nexport class EShapeActionValueChangeColor extends EShapeActionValueSubtyped<EShapeActionValueChangeColorType> {\r\n\treadonly target: Target;\r\n\treadonly color: number;\r\n\treadonly alpha: number;\r\n\treadonly blend: string;\r\n\r\n\tconstructor(\r\n\t\tsubtype: EShapeActionValueChangeColorType, condition: string,\r\n\t\ttarget: Target, color: number, alpha: number, blend: string\r\n\t) {\r\n\t\tsuper( EShapeActionValueType.CHANGE_COLOR, condition, subtype );\r\n\t\tthis.target = target;\r\n\t\tthis.color = color;\r\n\t\tthis.alpha = alpha;\r\n\t\tthis.blend = blend;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueChangeColor) &&\r\n\t\t\tthis.target === value.target &&\r\n\t\t\tthis.color === value.color &&\r\n\t\t\tthis.alpha === value.alpha &&\r\n\t\t\tthis.blend === value.blend\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeChangeColor {\r\n\t\tswitch( this.subtype ) {\r\n\t\tcase EShapeActionValueChangeColorType.FILL:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorFill( this );\r\n\t\tcase EShapeActionValueChangeColorType.STROKE:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorStroke( this );\r\n\t\tcase EShapeActionValueChangeColorType.FILL_AND_STROKE:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorFillAndStroke( this );\r\n\t\tcase EShapeActionValueChangeColorType.TEXT:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorText( this );\r\n\t\tcase EShapeActionValueChangeColorType.TEXT_OUTLINE:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorTextOutline( this );\r\n\t\tcase EShapeActionValueChangeColorType.ALL:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorAll( this );\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\tconst blendId = manager.add(this.blend);\r\n\t\treturn manager.add(\r\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.target},${this.color},${this.alpha},${blendId}]`\r\n\t\t);\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueChangeColorSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueChangeColor {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst blend = EShapeActionValues.toResource( 6, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueChangeColor(\r\n\t\t\tserialized[ 2 ], condition, serialized[ 3 ], serialized[ 4 ], serialized[ 5 ], blend\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueChangeTextType {\r\n\tTEXT,\r\n\tNUMBER\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { UtilRgb } from \"../../util/util-rgb\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeFill, EShapeFillLike } from \"../e-shape-fill\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeStroke, EShapeStrokeLike } from \"../e-shape-stroke\";\r\nimport { EShapeText, EShapeTextLike } from \"../e-shape-text\";\r\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"../e-shape-text-outline\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueChangeColorBrightness } from \"./e-shape-action-value-change-color-brightness\";\r\n\r\nconst brightnessDefault = (): number | null => null;\r\n\r\nexport class EShapeActionRuntimeChangeColorBrightness extends EShapeActionRuntimeConditional {\r\n\tprotected readonly brightness: EShapeActionExpression<number | null>;\r\n\r\n\tconstructor( value: EShapeActionValueChangeColorBrightness, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( value, reset );\r\n\t\tthis.brightness = this.toExpression( value.brightness, brightnessDefault, \"null\" );\r\n\t}\r\n\r\n\tprotected set(\r\n\t\tshape: EShape, runtime: EShapeRuntime, time: number,\r\n\t\ttarget: EShapeStroke | EShapeFill | EShapeText | EShapeTextOutline,\r\n\t\tbase: EShapeStrokeLike | EShapeFillLike | EShapeTextLike | EShapeTextOutlineLike\r\n\t): void {\r\n\t\tconst brightness = this.brightness( shape, time );\r\n\t\tif( brightness != null ) {\r\n\t\t\ttarget.set(\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.toColorAdjusted( base.color, brightness ),\r\n\t\t\t\tbase.alpha\r\n\t\t\t);\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected sets(\r\n\t\tshape: EShape, runtime: EShapeRuntime, time: number,\r\n\t\tfill: EShapeFill, stroke: EShapeStroke,\r\n\t\tbaseFill: EShapeFillLike, baseStroke: EShapeStrokeLike\r\n\t): void {\r\n\t\tconst brightness = this.brightness( shape, time );\r\n\t\tif( brightness != null ) {\r\n\t\t\tfill.set(\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.toColorAdjusted( baseFill.color, brightness ),\r\n\t\t\t\tbaseFill.alpha\r\n\t\t\t);\r\n\r\n\t\t\tstroke.set(\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.toColorAdjusted( baseStroke.color, brightness ),\r\n\t\t\t\tbaseStroke.alpha\r\n\t\t\t);\r\n\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setAll(\r\n\t\tshape: EShape, runtime: EShapeRuntime, time: number,\r\n\t\tfill: EShapeFill, stroke: EShapeStroke, text: EShapeText, outline: EShapeTextOutline,\r\n\t\tbaseFill: EShapeFillLike, baseStroke: EShapeStrokeLike, baseText: EShapeTextLike, baseOutline: EShapeTextOutlineLike\r\n\t): void {\r\n\t\tconst brightness = this.brightness( shape, time );\r\n\t\tif( brightness != null ) {\r\n\t\t\tfill.set(\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.toColorAdjusted( baseFill.color, brightness ),\r\n\t\t\t\tbaseFill.alpha\r\n\t\t\t);\r\n\r\n\t\t\tstroke.set(\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.toColorAdjusted( baseStroke.color, brightness ),\r\n\t\t\t\tbaseStroke.alpha\r\n\t\t\t);\r\n\r\n\t\t\ttext.set(\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.toColorAdjusted( baseText.color, brightness ),\r\n\t\t\t\tbaseText.alpha\r\n\t\t\t);\r\n\r\n\t\t\toutline.set(\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.toColorAdjusted( baseOutline.color, brightness ),\r\n\t\t\t\tbaseOutline.alpha\r\n\t\t\t);\r\n\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toColorAdjusted( color: number, brightness: number ): number {\r\n\t\tif( 0 <= brightness ) {\r\n\t\t\treturn UtilRgb.brighten( color, +brightness );\r\n\t\t} else {\r\n\t\t\treturn UtilRgb.darken( color, -brightness );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorBrightness } from \"./e-shape-action-runtime-change-color-brightness\";\r\nimport { EShapeActionValueChangeColorBrightness } from \"./e-shape-action-value-change-color-brightness\";\r\n\r\nexport class EShapeActionRuntimeChangeColorBrightnessAll extends EShapeActionRuntimeChangeColorBrightness {\r\n\tconstructor( value: EShapeActionValueChangeColorBrightness ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.setAll(\r\n\t\t\t\tshape, runtime, time,\r\n\t\t\t\tshape.fill,\r\n\t\t\t\tshape.stroke,\r\n\t\t\t\tshape.text,\r\n\t\t\t\tshape.text.outline,\r\n\t\t\t\tEShapeActionBases.toBaseFill( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseStroke( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseText( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseTextOutline( shape, runtime )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorBrightness } from \"./e-shape-action-runtime-change-color-brightness\";\r\nimport { EShapeActionValueChangeColorBrightness } from \"./e-shape-action-value-change-color-brightness\";\r\n\r\nexport class EShapeActionRuntimeChangeColorBrightnessFill extends EShapeActionRuntimeChangeColorBrightness {\r\n\tconstructor( value: EShapeActionValueChangeColorBrightness ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_FILL );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.fill, EShapeActionBases.toBaseFill( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorBrightness } from \"./e-shape-action-runtime-change-color-brightness\";\r\nimport { EShapeActionValueChangeColorBrightness } from \"./e-shape-action-value-change-color-brightness\";\r\n\r\nexport class EShapeActionRuntimeChangeColorBrightnessFillAndStroke extends EShapeActionRuntimeChangeColorBrightness {\r\n\tconstructor( value: EShapeActionValueChangeColorBrightness ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_FILL_AND_STROKE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.sets(\r\n\t\t\t\tshape, runtime, time,\r\n\t\t\t\tshape.fill,\r\n\t\t\t\tshape.stroke,\r\n\t\t\t\tEShapeActionBases.toBaseFill( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseStroke( shape, runtime )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorBrightness } from \"./e-shape-action-runtime-change-color-brightness\";\r\nimport { EShapeActionValueChangeColorBrightness } from \"./e-shape-action-value-change-color-brightness\";\r\n\r\nexport class EShapeActionRuntimeChangeColorBrightnessStroke extends EShapeActionRuntimeChangeColorBrightness {\r\n\tconstructor( value: EShapeActionValueChangeColorBrightness ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_STROKE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.stroke, EShapeActionBases.toBaseStroke( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorBrightness } from \"./e-shape-action-runtime-change-color-brightness\";\r\nimport { EShapeActionValueChangeColorBrightness } from \"./e-shape-action-value-change-color-brightness\";\r\n\r\nexport class EShapeActionRuntimeChangeColorBrightnessText extends EShapeActionRuntimeChangeColorBrightness {\r\n\tconstructor( value: EShapeActionValueChangeColorBrightness ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_TEXT );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.text, EShapeActionBases.toBaseText( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases} from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorBrightness } from \"./e-shape-action-runtime-change-color-brightness\";\r\nimport { EShapeActionValueChangeColorBrightness } from \"./e-shape-action-value-change-color-brightness\";\r\n\r\nexport class EShapeActionRuntimeChangeColorBrightnessTextOutline extends EShapeActionRuntimeChangeColorBrightness {\r\n\tconstructor( value: EShapeActionValueChangeColorBrightness ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_TEXT_OUTLINE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.text.outline, EShapeActionBases.toBaseTextOutline( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeChangeColorBrightness } from \"./e-shape-action-runtime-change-color-brightness\";\r\nimport { EShapeActionRuntimeChangeColorBrightnessAll } from \"./e-shape-action-runtime-change-color-brightness-all\";\r\nimport { EShapeActionRuntimeChangeColorBrightnessFill } from \"./e-shape-action-runtime-change-color-brightness-fill\";\r\nimport {\r\n\tEShapeActionRuntimeChangeColorBrightnessFillAndStroke\r\n} from \"./e-shape-action-runtime-change-color-brightness-fill-and-stroke\";\r\nimport {\r\n\tEShapeActionRuntimeChangeColorBrightnessStroke\r\n} from \"./e-shape-action-runtime-change-color-brightness-stroke\";\r\nimport { EShapeActionRuntimeChangeColorBrightnessText } from \"./e-shape-action-runtime-change-color-brightness-text\";\r\nimport {\r\n\tEShapeActionRuntimeChangeColorBrightnessTextOutline\r\n} from \"./e-shape-action-runtime-change-color-brightness-text-outline\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\r\nimport { EShapeActionValueChangeColorType } from \"./e-shape-action-value-change-color-type\";\r\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueChangeColorBrightnessSerialized = [\r\n\tEShapeActionValueType.CHANGE_COLOR, number, EShapeActionValueChangeColorType,\r\n\tEShapeActionValueChangeColorTarget.BRIGHTNESS, number\r\n];\r\n\r\nexport class EShapeActionValueChangeColorBrightness\r\n\textends EShapeActionValueSubtyped<EShapeActionValueChangeColorType> {\r\n\treadonly brightness: string;\r\n\r\n\tconstructor(\r\n\t\tsubtype: EShapeActionValueChangeColorType, condition: string, brightness: string\r\n\t) {\r\n\t\tsuper( EShapeActionValueType.CHANGE_COLOR, condition, subtype );\r\n\t\tthis.brightness = brightness;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueChangeColorBrightness) &&\r\n\t\t\tthis.brightness === value.brightness\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeChangeColorBrightness {\r\n\t\tswitch( this.subtype ) {\r\n\t\tcase EShapeActionValueChangeColorType.FILL:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorBrightnessFill( this );\r\n\t\tcase EShapeActionValueChangeColorType.STROKE:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorBrightnessStroke( this );\r\n\t\tcase EShapeActionValueChangeColorType.FILL_AND_STROKE:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorBrightnessFillAndStroke( this );\r\n\t\tcase EShapeActionValueChangeColorType.TEXT:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorBrightnessText( this );\r\n\t\tcase EShapeActionValueChangeColorType.TEXT_OUTLINE:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorBrightnessTextOutline( this );\r\n\t\tcase EShapeActionValueChangeColorType.ALL:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorBrightnessAll( this );\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\tconst target = EShapeActionValueChangeColorTarget.BRIGHTNESS;\r\n\t\tconst brightnessId = manager.add(this.brightness);\r\n\t\treturn manager.add(\r\n\t\t\t`[${this.type},${conditionId},${this.subtype},${target},${brightnessId}]`\r\n\t\t);\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueChangeColorBrightnessSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueChangeColorBrightness {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst brightness = EShapeActionValues.toResource( 4, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueChangeColorBrightness(\r\n\t\t\tserialized[ 2 ], condition, brightness\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { UtilAlpha } from \"../../util/util-alpha\";\r\nimport { UtilRgb } from \"../../util/util-rgb\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeFill, EShapeFillLike } from \"../e-shape-fill\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeStroke, EShapeStrokeLike } from \"../e-shape-stroke\";\r\nimport { EShapeText, EShapeTextLike } from \"../e-shape-text\";\r\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"../e-shape-text-outline\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueChangeColorCode } from \"./e-shape-action-value-change-color-code\";\r\n\r\nconst colorDefault = (): number | null => null;\r\nconst alphaDefault = (): number | null => null;\r\nconst blendDefault = (): number | null => null;\r\n\r\nexport class EShapeActionRuntimeChangeColorCode extends EShapeActionRuntimeConditional {\r\n\tprotected readonly color: EShapeActionExpression<number | null>;\r\n\tprotected readonly alpha: EShapeActionExpression<number | null>;\r\n\tprotected readonly blend: EShapeActionExpression<number | null>;\r\n\r\n\tconstructor( value: EShapeActionValueChangeColorCode, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( value, reset );\r\n\t\tthis.color = this.toExpression( value.color, colorDefault, \"null\" );\r\n\t\tthis.alpha = this.toExpression( value.alpha, alphaDefault, \"null\" );\r\n\t\tthis.blend = this.toExpression( value.blend, blendDefault, \"null\" );\r\n\t}\r\n\r\n\tprotected set(\r\n\t\tshape: EShape, runtime: EShapeRuntime, time: number,\r\n\t\ttarget: EShapeStroke | EShapeFill | EShapeText | EShapeTextOutline,\r\n\t\tbase: EShapeStrokeLike | EShapeFillLike | EShapeTextLike | EShapeTextOutlineLike\r\n\t): void {\r\n\t\tconst color = this.color( shape, time );\r\n\t\tconst alpha = this.alpha( shape, time );\r\n\t\tif( color != null ) {\r\n\t\t\tif( alpha != null ) {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\ttarget.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( base.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( base.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget.set( undefined, color, alpha );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\ttarget.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( base.color, color, blend ),\r\n\t\t\t\t\t\tbase.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget.set( undefined, color, base.alpha );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t} else if( alpha != null ) {\r\n\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\tif( blend != null ) {\r\n\t\t\t\ttarget.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbase.color,\r\n\t\t\t\t\tUtilAlpha.blend( base.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\ttarget.set( undefined, base.color, alpha );\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected sets(\r\n\t\tshape: EShape, runtime: EShapeRuntime, time: number,\r\n\t\tfill: EShapeFill, stroke: EShapeStroke,\r\n\t\tbaseFill: EShapeFillLike, baseStroke: EShapeStrokeLike\r\n\t): void {\r\n\t\tconst color = this.color( shape, time );\r\n\t\tconst alpha = this.alpha( shape, time );\r\n\t\tif( color != null ) {\r\n\t\t\tif( alpha != null ) {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\tfill.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseFill.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseFill.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tstroke.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseStroke.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseStroke.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfill.set( undefined, color, alpha );\r\n\t\t\t\t\tstroke.set( undefined, color, alpha );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\tfill.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseFill.color, color, blend ),\r\n\t\t\t\t\t\tbaseFill.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t\tstroke.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseStroke.color, color, blend ),\r\n\t\t\t\t\t\tbaseStroke.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfill.set( undefined, color, baseFill.alpha );\r\n\t\t\t\t\tstroke.set( undefined, color, baseStroke.alpha );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t} else if( alpha != null ) {\r\n\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\tif( blend != null ) {\r\n\t\t\t\tfill.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseFill.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseFill.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t\tstroke.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseStroke.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseStroke.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tfill.set( undefined, baseFill.color, alpha );\r\n\t\t\t\tstroke.set( undefined, baseStroke.color, alpha );\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setAll(\r\n\t\tshape: EShape, runtime: EShapeRuntime, time: number,\r\n\t\tfill: EShapeFill, stroke: EShapeStroke, text: EShapeText, outline: EShapeTextOutline,\r\n\t\tbaseFill: EShapeFillLike, baseStroke: EShapeStrokeLike, baseText: EShapeTextLike, baseOutline: EShapeTextOutlineLike\r\n\t): void {\r\n\t\tconst color = this.color( shape, time );\r\n\t\tconst alpha = this.alpha( shape, time );\r\n\t\tif( color != null ) {\r\n\t\t\tif( alpha != null ) {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\tfill.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseFill.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseFill.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tstroke.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseStroke.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseStroke.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t\ttext.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseText.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseText.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t\toutline.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseOutline.color, color, blend ),\r\n\t\t\t\t\t\tUtilAlpha.blend( baseOutline.alpha, alpha, blend )\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfill.set( undefined, color, alpha );\r\n\t\t\t\t\tstroke.set( undefined, color, alpha );\r\n\t\t\t\t\ttext.set( undefined, color, alpha );\r\n\t\t\t\t\toutline.set( undefined, color, alpha );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\t\tif( blend != null ) {\r\n\t\t\t\t\tfill.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseFill.color, color, blend ),\r\n\t\t\t\t\t\tbaseFill.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t\tstroke.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseStroke.color, color, blend ),\r\n\t\t\t\t\t\tbaseStroke.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t\ttext.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseText.color, color, blend ),\r\n\t\t\t\t\t\tbaseText.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t\toutline.set(\r\n\t\t\t\t\t\tundefined,\r\n\t\t\t\t\t\tUtilRgb.blend( baseOutline.color, color, blend ),\r\n\t\t\t\t\t\tbaseOutline.alpha\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfill.set( undefined, color, baseFill.alpha );\r\n\t\t\t\t\tstroke.set( undefined, color, baseStroke.alpha );\r\n\t\t\t\t\ttext.set( undefined, color, baseText.alpha );\r\n\t\t\t\t\toutline.set( undefined, color, baseOutline.alpha );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t} else if( alpha != null ) {\r\n\t\t\tconst blend = this.blend( shape, time );\r\n\t\t\tif( blend != null ) {\r\n\t\t\t\tfill.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseFill.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseFill.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t\tstroke.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseStroke.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseStroke.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t\ttext.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseFill.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseText.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t\toutline.set(\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tbaseStroke.color,\r\n\t\t\t\t\tUtilAlpha.blend( baseOutline.alpha, alpha, blend )\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tfill.set( undefined, baseFill.color, alpha );\r\n\t\t\t\tstroke.set( undefined, baseStroke.color, alpha );\r\n\t\t\t\ttext.set( undefined, baseText.color, alpha );\r\n\t\t\t\toutline.set( undefined, baseOutline.color, alpha );\r\n\t\t\t}\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorCode } from \"./e-shape-action-runtime-change-color-code\";\r\nimport { EShapeActionValueChangeColorCode } from \"./e-shape-action-value-change-color-code\";\r\n\r\nexport class EShapeActionRuntimeChangeColorCodeAll extends EShapeActionRuntimeChangeColorCode {\r\n\tconstructor( value: EShapeActionValueChangeColorCode ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.setAll(\r\n\t\t\t\tshape, runtime, time,\r\n\t\t\t\tshape.fill,\r\n\t\t\t\tshape.stroke,\r\n\t\t\t\tshape.text,\r\n\t\t\t\tshape.text.outline,\r\n\t\t\t\tEShapeActionBases.toBaseFill( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseStroke( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseText( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseTextOutline( shape, runtime )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorCode } from \"./e-shape-action-runtime-change-color-code\";\r\nimport { EShapeActionValueChangeColorCode } from \"./e-shape-action-value-change-color-code\";\r\n\r\nexport class EShapeActionRuntimeChangeColorCodeFill extends EShapeActionRuntimeChangeColorCode {\r\n\tconstructor( value: EShapeActionValueChangeColorCode ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_FILL );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.fill, EShapeActionBases.toBaseFill( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorCode } from \"./e-shape-action-runtime-change-color-code\";\r\nimport { EShapeActionValueChangeColorCode } from \"./e-shape-action-value-change-color-code\";\r\n\r\nexport class EShapeActionRuntimeChangeColorCodeFillAndStroke extends EShapeActionRuntimeChangeColorCode {\r\n\tconstructor( value: EShapeActionValueChangeColorCode ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_FILL_AND_STROKE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.sets(\r\n\t\t\t\tshape, runtime, time,\r\n\t\t\t\tshape.fill,\r\n\t\t\t\tshape.stroke,\r\n\t\t\t\tEShapeActionBases.toBaseFill( shape, runtime ),\r\n\t\t\t\tEShapeActionBases.toBaseStroke( shape, runtime )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorCode } from \"./e-shape-action-runtime-change-color-code\";\r\nimport { EShapeActionValueChangeColorCode } from \"./e-shape-action-value-change-color-code\";\r\n\r\nexport class EShapeActionRuntimeChangeColorCodeStroke extends EShapeActionRuntimeChangeColorCode {\r\n\tconstructor( value: EShapeActionValueChangeColorCode ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_STROKE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.stroke, EShapeActionBases.toBaseStroke( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorCode } from \"./e-shape-action-runtime-change-color-code\";\r\nimport { EShapeActionValueChangeColorCode } from \"./e-shape-action-value-change-color-code\";\r\n\r\nexport class EShapeActionRuntimeChangeColorCodeText extends EShapeActionRuntimeChangeColorCode {\r\n\tconstructor( value: EShapeActionValueChangeColorCode ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_TEXT );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.text, EShapeActionBases.toBaseText( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionBases } from \"./e-shape-action-bases\";\r\nimport { EShapeActionRuntimeChangeColorCode } from \"./e-shape-action-runtime-change-color-code\";\r\nimport { EShapeActionValueChangeColorCode } from \"./e-shape-action-value-change-color-code\";\r\n\r\nexport class EShapeActionRuntimeChangeColorCodeTextOutline extends EShapeActionRuntimeChangeColorCode {\r\n\tconstructor( value: EShapeActionValueChangeColorCode ) {\r\n\t\tsuper( value, EShapeRuntimeReset.COLOR_TEXT_OUTLINE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tthis.set( shape, runtime, time, shape.text.outline, EShapeActionBases.toBaseTextOutline( shape, runtime ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeChangeColorCode } from \"./e-shape-action-runtime-change-color-code\";\r\nimport { EShapeActionRuntimeChangeColorCodeAll } from \"./e-shape-action-runtime-change-color-code-all\";\r\nimport { EShapeActionRuntimeChangeColorCodeFill } from \"./e-shape-action-runtime-change-color-code-fill\";\r\nimport {\r\n\tEShapeActionRuntimeChangeColorCodeFillAndStroke\r\n} from \"./e-shape-action-runtime-change-color-code-fill-and-stroke\";\r\nimport { EShapeActionRuntimeChangeColorCodeStroke } from \"./e-shape-action-runtime-change-color-code-stroke\";\r\nimport { EShapeActionRuntimeChangeColorCodeText } from \"./e-shape-action-runtime-change-color-code-text\";\r\nimport { EShapeActionRuntimeChangeColorCodeTextOutline } from \"./e-shape-action-runtime-change-color-code-text-outline\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\r\nimport { EShapeActionValueChangeColorType } from \"./e-shape-action-value-change-color-type\";\r\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueChangeColorCodeSerialized = [\r\n\tEShapeActionValueType.CHANGE_COLOR, number, EShapeActionValueChangeColorType,\r\n\tEShapeActionValueChangeColorTarget.CODE, number, number, number\r\n];\r\n\r\nexport class EShapeActionValueChangeColorCode extends EShapeActionValueSubtyped<EShapeActionValueChangeColorType> {\r\n\treadonly color: string;\r\n\treadonly alpha: string;\r\n\treadonly blend: string;\r\n\r\n\tconstructor(\r\n\t\tsubtype: EShapeActionValueChangeColorType, condition: string,\r\n\t\tcolor: string, alpha: string, blend: string\r\n\t) {\r\n\t\tsuper( EShapeActionValueType.CHANGE_COLOR, condition, subtype );\r\n\t\tthis.color = color;\r\n\t\tthis.alpha = alpha;\r\n\t\tthis.blend = blend;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueChangeColorCode) &&\r\n\t\t\tthis.color === value.color &&\r\n\t\t\tthis.alpha === value.alpha &&\r\n\t\t\tthis.blend === value.blend\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeChangeColorCode {\r\n\t\tswitch( this.subtype ) {\r\n\t\tcase EShapeActionValueChangeColorType.FILL:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorCodeFill( this );\r\n\t\tcase EShapeActionValueChangeColorType.STROKE:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorCodeStroke( this );\r\n\t\tcase EShapeActionValueChangeColorType.FILL_AND_STROKE:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorCodeFillAndStroke( this );\r\n\t\tcase EShapeActionValueChangeColorType.TEXT:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorCodeText( this );\r\n\t\tcase EShapeActionValueChangeColorType.TEXT_OUTLINE:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorCodeTextOutline( this );\r\n\t\tcase EShapeActionValueChangeColorType.ALL:\r\n\t\t\treturn new EShapeActionRuntimeChangeColorCodeAll( this );\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\tconst target = EShapeActionValueChangeColorTarget.CODE;\r\n\t\tconst colorId = manager.add(this.color);\r\n\t\tconst alphaId = manager.add(this.alpha);\r\n\t\tconst blendId = manager.add(this.blend);\r\n\t\treturn manager.add(\r\n\t\t\t`[${this.type},${conditionId},${this.subtype},${target},${colorId},${alphaId},${blendId}]`\r\n\t\t);\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueChangeColorCodeSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueChangeColorCode {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst color = EShapeActionValues.toResource( 4, serialized, manager.resources );\r\n\t\tconst alpha = EShapeActionValues.toResource( 5, serialized, manager.resources );\r\n\t\tconst blend = EShapeActionValues.toResource( 6, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueChangeColorCode(\r\n\t\t\tserialized[ 2 ], condition, color, alpha, blend\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueChangeCursor } from \"./e-shape-action-value-change-cursor\";\r\n\r\nconst nameDefault = (): string | null => null;\r\n\r\nexport class EShapeActionRuntimeChangeCursor extends EShapeActionRuntimeConditional {\r\n\tprotected name: EShapeActionExpression<string | null>;\r\n\r\n\tconstructor( value: EShapeActionValueChangeCursor ) {\r\n\t\tsuper( value, EShapeRuntimeReset.CURSOR );\r\n\t\tthis.name = this.toExpression( value.name, nameDefault, \"null\" );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst name = this.name( shape, time );\r\n\t\t\tif( name != null ) {\r\n\t\t\t\tshape.cursor = name;\r\n\t\t\t\truntime.written |= this.reset;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeChangeCursor } from \"./e-shape-action-runtime-change-cursor\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueBase } from \"./e-shape-action-value-base\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueChangeCursorSerialized = [\r\n\tEShapeActionValueType.CHANGE_CURSOR, number, number\r\n];\r\n\r\nexport class EShapeActionValueChangeCursor extends EShapeActionValueBase {\r\n\treadonly name: string;\r\n\r\n\tconstructor( condition: string, name: string ) {\r\n\t\tsuper( EShapeActionValueType.CHANGE_CURSOR, condition );\r\n\t\tthis.name = name;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueChangeCursor) &&\r\n\t\t\tthis.name === value.name\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeChangeCursor {\r\n\t\treturn new EShapeActionRuntimeChangeCursor( this );\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\tconst nameId = manager.add(this.name);\r\n\t\treturn manager.add(\r\n\t\t\t`[${this.type},${conditionId},${nameId}]`\r\n\t\t);\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueChangeCursorSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueChangeCursor {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst name = EShapeActionValues.toResource( 2, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueChangeCursor( condition, name );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeA implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn (date.getHours() < 12 ? \"AM\" : \"PM\");\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodea implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn (date.getHours() < 12 ? \"am\" : \"pm\");\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeD implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn String(date.getDate());\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNoded implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn `${target | 0}`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport abstract class FormatNodePrecision implements FormatNode {\r\n\tprotected precision: number | undefined;\r\n\r\n\tconstructor( precision?: string ) {\r\n\t\tif( precision != null ) {\r\n\t\t\tthis.precision = +precision.substring( 1, precision.length );\r\n\t\t} else {\r\n\t\t\tthis.precision = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tabstract format( target: number, step: number, date: Date ): string;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNodePrecision } from \"./format-node-precision\";\r\n\r\nexport class FormatNodee extends FormatNodePrecision {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn target.toExponential(this.precision);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNodePrecision } from \"./format-node-precision\";\r\n\r\nexport class FormatNodef extends FormatNodePrecision {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn target.toFixed(this.precision);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNodePrecision } from \"./format-node-precision\";\r\n\r\nexport class FormatNodefsi extends FormatNodePrecision {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\tconst abs = this.toAbs( target, step, date );\r\n\t\tif( abs < 1e-24 ) {\r\n\t\t\treturn this.format_( target, 1e+00, \"\"  );\r\n\t\t} else if( abs < 1e-21 ) {\r\n\t\t\treturn this.format_( target, 1e+24, \"y\" );\r\n\t\t} else if( abs < 1e-18 ) {\r\n\t\t\treturn this.format_( target, 1e+21, \"z\" );\r\n\t\t} else if( abs < 1e-15 ) {\r\n\t\t\treturn this.format_( target, 1e+18, \"a\" );\r\n\t\t} else if( abs < 1e-12 ) {\r\n\t\t\treturn this.format_( target, 1e+15, \"f\" );\r\n\t\t} else if( abs < 1e-09 ) {\r\n\t\t\treturn this.format_( target, 1e+12, \"p\" );\r\n\t\t} else if( abs < 1e-06 ) {\r\n\t\t\treturn this.format_( target, 1e+09, \"n\" );\r\n\t\t} else if( abs < 1e-03 ) {\r\n\t\t\treturn this.format_( target, 1e+06, \"μ\" );\r\n\t\t} else if( abs < 1e+00 ) {\r\n\t\t\treturn this.format_( target, 1e+03, \"m\" );\r\n\t\t} else if( abs < 1e+03 ) {\r\n\t\t\treturn this.format_( target, 1e+00, \"\"  );\r\n\t\t} else if( abs < 1e+06 ) {\r\n\t\t\treturn this.format_( target, 1e-03, \"k\" );\r\n\t\t} else if( abs < 1e+09 ) {\r\n\t\t\treturn this.format_( target, 1e-06, \"M\" );\r\n\t\t} else if( abs < 1e+12 ) {\r\n\t\t\treturn this.format_( target, 1e-09, \"G\" );\r\n\t\t} else if( abs < 1e+15 ) {\r\n\t\t\treturn this.format_( target, 1e-12, \"T\" );\r\n\t\t} else if( abs < 1e+18 ) {\r\n\t\t\treturn this.format_( target, 1e-15, \"P\" );\r\n\t\t} else if( abs < 1e+21 ) {\r\n\t\t\treturn this.format_( target, 1e-18, \"E\" );\r\n\t\t} else if( abs < 1e+24 ) {\r\n\t\t\treturn this.format_( target, 1e-21, \"Z\" );\r\n\t\t} else {\r\n\t\t\treturn this.format_( target, 1e-24, \"Y\" );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toAbs(target: number, step: number, date: Date): number {\r\n\t\treturn Math.abs(target);\r\n\t}\r\n\r\n\tprotected format_(target: number, unitInverse: number, postfix: string): string {\r\n\t\tconst value = target * unitInverse;\r\n\t\treturn `${value.toFixed(this.precision)}${postfix}`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNodePrecision } from \"./format-node-precision\";\r\n\r\nexport class FormatNodeg extends FormatNodePrecision {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn target.toPrecision(this.precision);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeH implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn String(date.getHours());\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeh implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn String(date.getHours() % 12);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeM implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn String(date.getMonth() + 1);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodem implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn String(date.getMinutes());\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodemi implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn String(date.getMilliseconds());\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeP implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn `${(target * 100) | 0}%`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodep implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn `${target | 0}%`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { toPadded } from \"../to-padded\";\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodePadding implements FormatNode {\r\n\tprotected length: number;\r\n\tprotected character: string;\r\n\tprotected node: FormatNode;\r\n\r\n\tconstructor( length: number, character: string, node: FormatNode ) {\r\n\t\tthis.length = length;\r\n\t\tthis.character = character;\r\n\t\tthis.node = node;\r\n\t}\r\n\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn toPadded(this.node.format(target, step, date), this.length, this.character);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeParenthesis {\r\n\tprotected node: FormatNode;\r\n\r\n\tconstructor( node: FormatNode ) {\r\n\t\tthis.node = node;\r\n\t}\r\n\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\tconst result = this.node.format(target, step, date);\r\n\t\tif (0 < result.length && result[0] === \"-\") {\r\n\t\t\treturn `(${result.substring(1, result.length)})`;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodePlus implements FormatNode {\r\n\tprotected node: FormatNode;\r\n\r\n\tconstructor(node: FormatNode) {\r\n\t\tthis.node = node;\r\n\t}\r\n\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\tconst result = this.node.format(target, step, date);\r\n\t\tif (0 < result.length && result[0] !== \"-\") {\r\n\t\t\treturn `+${result}`;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeRP implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn `${Math.round(target * 100)}%`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNoderp implements FormatNode {\r\n\tformat(target: number, step: number, date: Date): string {\r\n\t\treturn `${Math.round(target)}%`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodesdt implements FormatNode {\r\n\tprotected Y: FormatNode;\r\n\tprotected M: FormatNode;\r\n\tprotected D: FormatNode;\r\n\tprotected H: FormatNode;\r\n\tprotected m: FormatNode;\r\n\tprotected s: FormatNode;\r\n\tprotected mi: FormatNode;\r\n\r\n\tconstructor(\r\n\t\tY: FormatNode, M: FormatNode, D: FormatNode,\r\n\t\tH: FormatNode, m: FormatNode, s: FormatNode, mi: FormatNode\r\n\t) {\r\n\t\tthis.Y = Y;\r\n\t\tthis.M = M;\r\n\t\tthis.D = D;\r\n\t\tthis.H = H;\r\n\t\tthis.m = m;\r\n\t\tthis.s = s;\r\n\t\tthis.mi = mi;\r\n\t}\r\n\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\tif (step < 1000) {\r\n\t\t\treturn `${this.s.format(target, step, date)}.${this.mi.format(target, step, date)}`;\r\n\t\t} else if (step < 60000) {\r\n\t\t\treturn `${this.m.format(target, step, date)}:${this.s.format(target, step, date)}`;\r\n\t\t} else if (step < 3600000) {\r\n\t\t\treturn `${this.H.format(target, step, date)}:${this.m.format(target, step, date)}`;\r\n\t\t} else if (step < 86400000) {\r\n\t\t\tconst M = this.M.format(target, step, date);\r\n\t\t\tconst D = this.D.format(target, step, date);\r\n\t\t\treturn `${M}/${D} ${this.H.format(target, step, date)}`;\r\n\t\t} else if (step < 2592000000) {\r\n\t\t\treturn `${this.M.format(target, step, date)}/${this.D.format(target, step, date)}`;\r\n\t\t} else {\r\n\t\t\treturn `${this.Y.format(target, step, date)}/${this.M.format(target, step, date)}`;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeSpace {\r\n\tprotected node: FormatNode;\r\n\tconstructor(node: FormatNode) {\r\n\t\tthis.node = node;\r\n\t}\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\tconst result = this.node.format(target, step, date);\r\n\t\tif( 0 < result.length && result[0] !== \"-\" ) {\r\n\t\t\treturn ` ${result}`;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNodefsi } from \"./format-node-fsi\";\r\n\r\nexport class FormatNodessi extends FormatNodefsi {\r\n\tprotected toAbs( target: number, step: number, date: Date ): number {\r\n\t\treturn Math.abs(step);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeString implements FormatNode {\r\n\tprotected str: string;\r\n\r\n\tconstructor(str: string) {\r\n\t\tthis.str = str;\r\n\t}\r\n\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn this.str;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodeY implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn String(date.getFullYear());\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodey implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn String(date.getFullYear() % 100);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { toPadded } from \"../to-padded\";\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodez implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\tconst z = date.getTimezoneOffset();\r\n\t\tconst tzs = (z <= 0 ? \"+\" : \"-\");\r\n\t\tconst tzh = toPadded(String(Math.floor(Math.abs(z) / 60)), 2, \"0\");\r\n\t\tconst tzm = toPadded(String(Math.floor(Math.abs(z) % 60)), 2, \"0\");\r\n\t\treturn `${tzs}${tzh}:${tzm}`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNoderd implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn `${Math.round(target)}`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node\";\r\n\r\nexport class FormatNodes implements FormatNode {\r\n\tformat( target: number, step: number, date: Date ): string {\r\n\t\treturn String(date.getSeconds());\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { FormatNode } from \"./format-node/format-node\";\r\nimport { FormatNodeA } from \"./format-node/format-node-a-large\";\r\nimport { FormatNodea } from \"./format-node/format-node-a-small\";\r\nimport { FormatNodeD } from \"./format-node/format-node-d-large\";\r\nimport { FormatNoded } from \"./format-node/format-node-d-small\";\r\nimport { FormatNodee } from \"./format-node/format-node-e\";\r\nimport { FormatNodef } from \"./format-node/format-node-f\";\r\nimport { FormatNodefsi } from \"./format-node/format-node-fsi\";\r\nimport { FormatNodeg } from \"./format-node/format-node-g\";\r\nimport { FormatNodeH } from \"./format-node/format-node-h-large\";\r\nimport { FormatNodeh } from \"./format-node/format-node-h-small\";\r\nimport { FormatNodeM } from \"./format-node/format-node-m-large\";\r\nimport { FormatNodem } from \"./format-node/format-node-m-small\";\r\nimport { FormatNodemi } from \"./format-node/format-node-mi\";\r\nimport { FormatNodeP } from \"./format-node/format-node-p-large\";\r\nimport { FormatNodep } from \"./format-node/format-node-p-small\";\r\nimport { FormatNodePadding } from \"./format-node/format-node-padding\";\r\nimport { FormatNodeParenthesis } from \"./format-node/format-node-parenthesis\";\r\nimport { FormatNodePlus } from \"./format-node/format-node-plus\";\r\nimport { FormatNodeRP } from \"./format-node/format-node-rp-large\";\r\nimport { FormatNoderp } from \"./format-node/format-node-rp-small\";\r\nimport { FormatNodesdt } from \"./format-node/format-node-sdt\";\r\nimport { FormatNodeSpace } from \"./format-node/format-node-space\";\r\nimport { FormatNodessi } from \"./format-node/format-node-ssi\";\r\nimport { FormatNodeString } from \"./format-node/format-node-string\";\r\nimport { FormatNodeY } from \"./format-node/format-node-y-large\";\r\nimport { FormatNodey } from \"./format-node/format-node-y-small\";\r\nimport { FormatNodez } from \"./format-node/format-node-z\";\r\nimport { FormatNoderd } from \"./format-node/format-noder-d\";\r\nimport { FormatNodes } from \"./format-node/format-nodes\";\r\nimport { NumberFormatter } from \"./number-formatter\";\r\n\r\n// tslint:disable-next-line: max-line-length\r\nconst REGEXP = /%(0|_|-|\\+|\\()?(\\.\\d+)?(Y(?:MD?)?|y(?:MD?)?|MD?|D|H(?:ms?)?|h(?:ms?)?|m(?:i|s)?|a|A|s(?:s?i|dt)?|z|%|f(?:si)?|e|g|d|r(?:d|p)|p|P|RP)/g;\r\n\r\n/**\r\n * A NumberFormatter implementation class.\r\n */\r\nexport class NumberFormatterImpl implements NumberFormatter {\r\n\tprotected isDateRequired: boolean;\r\n\tprotected nodes: FormatNode[];\r\n\tprotected date: Date;\r\n\r\n\tconstructor( format: string ) {\r\n\t\tlet previousIndex = 0;\r\n\t\tlet isDateRequired = false;\r\n\t\tconst nodes: FormatNode[] = [];\r\n\t\tREGEXP.lastIndex = 0;\r\n\t\twhile( true ) {\r\n\t\t\tconst matched = REGEXP.exec( format );\r\n\t\t\tif( matched != null ) {\r\n\t\t\t\tconst index = matched.index;\r\n\t\t\t\tif( previousIndex < index ) {\r\n\t\t\t\t\tnodes.push( new FormatNodeString( format.substring( previousIndex, index ) ) );\r\n\t\t\t\t}\r\n\t\t\t\tpreviousIndex = index + matched[ 0 ].length;\r\n\r\n\t\t\t\tconst all = matched[ 0 ];\r\n\t\t\t\tconst modifier = matched[ 1 ];\r\n\t\t\t\tconst precision = matched[ 2 ];\r\n\t\t\t\tconst specifier = matched[ 3 ];\r\n\r\n\t\t\t\tswitch( specifier ) {\r\n\t\t\t\tcase \"Y\": // full year\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( new FormatNodeY() );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"YM\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tnew FormatNodeY(),\r\n\t\t\t\t\t\tnew FormatNodeString( \"/\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeM() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"YMD\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tnew FormatNodeY(),\r\n\t\t\t\t\t\tnew FormatNodeString( \"/\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeM() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \"/\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeD() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"y\": // short year: [0, 99]\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeDatetime2( modifier, new FormatNodey() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"yM\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodey() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \"/\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeM() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"yMD\":\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodey() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \"/\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeM() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \"/\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeD() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"M\": // month: [1, 12]\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeDatetime2( modifier, new FormatNodeM() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"MD\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeM() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \"/\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeD() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"D\": // day of the month: [1, 31]\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeDatetime2( modifier, new FormatNodeD() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"H\": // 24-hour clock: [0, 23]\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeDatetime2( modifier, new FormatNodeH() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"Hm\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeH() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \":\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodem() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"Hms\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeH() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \":\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodem() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \":\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodes() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"h\": // 12-hour clock: [1, 12]\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeDatetime2( modifier, new FormatNodeh() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hm\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeh() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \":\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodem() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hms\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeh() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \":\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodem() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \":\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodes() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"m\": // minute [0, 59]\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeDatetime2( modifier, new FormatNodem() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"ms\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodem() ),\r\n\t\t\t\t\t\tnew FormatNodeString( \":\" ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodes() )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"mi\": // milliseconds [0, 999]\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeDatetime3( modifier, new FormatNodemi() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"a\": // am or pm\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( new FormatNodea() );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"A\": // AM or PM\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( new FormatNodeA() );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"s\": // seconds: [0, 61]\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeDatetime2( modifier, new FormatNodes() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"sdt\":\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push(new FormatNodesdt(\r\n\t\t\t\t\t\tnew FormatNodeY(),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeM() ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeD() ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodeH() ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodem() ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime2( modifier, new FormatNodes() ),\r\n\t\t\t\t\t\tthis.toModifiedNodeDatetime3( modifier, new FormatNodemi() )\r\n\t\t\t\t\t));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"z\": // time zone\r\n\t\t\t\t\tisDateRequired = true;\r\n\t\t\t\t\tnodes.push( new FormatNodez() );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"%\": // a % literal\r\n\t\t\t\t\tnodes.push( new FormatNodeString( \"%\" ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"f\": // fixed point notation\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNodef( precision ) ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"e\": // exponent notation\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNodee( precision ) ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"g\": // %f or %e\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNodeg( precision ) ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"rd\": // rounded decimal notation\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNoderd() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"d\": // decimal notation\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNoded() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"P\": // percent notation (Multiplied by 100)\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNodeP() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"p\": // percent notation (Not multiplied by 100)\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNodep() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"RP\": // percent notation (Multiplied by 100)\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNodeRP() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"rp\": // percent notation (Not multiplied by 100)\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNoderp() ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"fsi\": // fixed point notation with a SI prefix\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNodefsi( precision ) ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"ssi\": // Step-based fixed point notation with a SI prefix\r\n\t\t\t\t\tnodes.push( this.toModifiedNodeNumber( modifier, new FormatNodessi( precision ) ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tnodes.push( new FormatNodeString( all ) );\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( previousIndex < format.length ) {\r\n\t\t\t\t\tnodes.push( new FormatNodeString( format.substring( previousIndex, format.length ) ) );\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.isDateRequired = isDateRequired;\r\n\t\tthis.nodes = nodes;\r\n\t\tthis.date = new Date();\r\n\t}\r\n\r\n\tprotected toModifiedNodeDatetime2( modifier: string, node: FormatNode ): FormatNode {\r\n\t\tswitch( modifier ) {\r\n\t\tcase \"_\":\r\n\t\t\treturn new FormatNodePadding( 2, \" \", node );\r\n\t\tcase \"-\":\r\n\t\t\treturn node;\r\n\t\tdefault:\r\n\t\t\treturn new FormatNodePadding( 2, \"0\", node );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toModifiedNodeDatetime3( modifier: string, node: FormatNode ): FormatNode {\r\n\t\tswitch( modifier ) {\r\n\t\tcase \"_\":\r\n\t\t\treturn new FormatNodePadding( 3, \" \", node );\r\n\t\tcase \"-\":\r\n\t\t\treturn node;\r\n\t\tdefault:\r\n\t\t\treturn new FormatNodePadding( 3, \"0\", node );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toModifiedNodeNumber( modifier: string, node: FormatNode ): FormatNode {\r\n\t\tswitch( modifier ) {\r\n\t\tcase \"_\": // space for non-negative numbers\r\n\t\t\treturn new FormatNodeSpace( node );\r\n\t\tcase \"+\": // plus sign for non-negative numbers\r\n\t\t\treturn new FormatNodePlus( node );\r\n\t\tcase \"(\": // parenthesis for the negative numbers\r\n\t\t\treturn new FormatNodeParenthesis( node );\r\n\t\tdefault:\r\n\t\t\treturn node;\r\n\t\t}\r\n\t}\r\n\r\n\tformat( target: number, step: number ): string {\r\n\t\tconst nodes = this.nodes;\r\n\t\tconst date = this.date;\r\n\t\tif( this.isDateRequired ) {\r\n\t\t\tdate.setTime( target );\r\n\t\t}\r\n\t\tlet result = \"\";\r\n\t\tfor( let i = 0, imax = nodes.length; i < imax; ++i ) {\r\n\t\t\tresult += nodes[ i ].format( target, step, date );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { NumberFormatter } from \"./number-formatter\";\r\nimport { NumberFormatterImpl } from \"./number-formatter-impl\";\r\n\r\n/**\r\n * An number formatter utility class.\r\n */\r\nexport class NumberFormatters {\r\n\t/**\r\n\t * Creates a number formatter of the given format.\r\n\t * Please refer to {@link NumberFormatter} for format details.\r\n\t *\r\n\t * @return A created number formatter\r\n\t */\r\n\tstatic create( format: string ): NumberFormatter {\r\n\t\treturn new NumberFormatterImpl( format );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { NumberFormatter } from \"../../util/number-formatter\";\r\nimport { NumberFormatters } from \"../../util/number-formatters\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueChangeText } from \"./e-shape-action-value-change-text\";\r\n\r\nconst numberDefault = (): number => 0;\r\n\r\nexport class EShapeActionRuntimeChangeTextNumber extends EShapeActionRuntimeConditional {\r\n\tprotected number: EShapeActionExpression<number>;\r\n\tprotected formatter: NumberFormatter | null;\r\n\r\n\tconstructor( value: EShapeActionValueChangeText, format: string ) {\r\n\t\tsuper( value, EShapeRuntimeReset.TEXT );\r\n\r\n\t\tthis.number = this.toExpression( value.value, numberDefault, `0` );\r\n\r\n\t\tformat = format.trim();\r\n\t\tthis.formatter = ( 0 < format.length ? NumberFormatters.create( format ) : null );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst value = this.number( shape, time );\r\n\t\t\tshape.text.value = ( this.formatter != null ? this.formatter.format( value, 0 ) : String(value) );\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueChangeText } from \"./e-shape-action-value-change-text\";\r\n\r\nconst textDefault = () => \"\";\r\n\r\nexport class EShapeActionRuntimeChangeTextText extends EShapeActionRuntimeConditional {\r\n\tprotected text: EShapeActionExpression<string>;\r\n\r\n\tconstructor( value: EShapeActionValueChangeText ) {\r\n\t\tsuper( value, EShapeRuntimeReset.TEXT );\r\n\t\tthis.text = this.toExpression( value.value, textDefault, `\"\"` );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tshape.text.value = String(this.text( shape, time ));\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeChangeTextNumber } from \"./e-shape-action-runtime-change-text-number\";\r\nimport { EShapeActionRuntimeChangeTextText } from \"./e-shape-action-runtime-change-text-text\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueChangeTextType } from \"./e-shape-action-value-change-text-type\";\r\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueChangeTextSerialized = [\r\n\tEShapeActionValueType.CHANGE_TEXT, number, EShapeActionValueChangeTextType, number\r\n];\r\n\r\nexport class EShapeActionValueChangeText extends EShapeActionValueSubtyped<EShapeActionValueChangeTextType> {\r\n\treadonly value: string;\r\n\r\n\tconstructor( subtype: EShapeActionValueChangeTextType, condition: string, value: string ) {\r\n\t\tsuper( EShapeActionValueType.CHANGE_TEXT, condition, subtype );\r\n\t\tthis.value = value;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueChangeText) &&\r\n\t\t\tthis.value === value.value\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime( shape: EShape ): EShapeActionRuntimeChangeTextText | EShapeActionRuntimeChangeTextNumber {\r\n\t\tswitch( this.subtype ) {\r\n\t\tcase EShapeActionValueChangeTextType.TEXT:\r\n\t\t\treturn new EShapeActionRuntimeChangeTextText( this );\r\n\t\tcase EShapeActionValueChangeTextType.NUMBER:\r\n\t\t\treturn new EShapeActionRuntimeChangeTextNumber( this, shape.text.value );\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\tconst valueId = manager.add(this.value);\r\n\t\treturn manager.add(\r\n\t\t\t`[${this.type},${conditionId},${this.subtype},${valueId}]`\r\n\t\t);\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueChangeTextSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueChangeText {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst value = EShapeActionValues.toResource( 3, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueChangeText( serialized[ 2 ], condition, value );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueMiscType {\r\n\tINPUT\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueEmitEvent } from \"./e-shape-action-value-emit-event\";\r\n\r\nconst nameDefault = (): string | null => null;\r\n\r\nexport class EShapeActionRuntimeEmitEvent extends EShapeActionRuntimeConditional {\r\n\tprotected name: EShapeActionExpression<string | null>;\r\n\r\n\tconstructor( value: EShapeActionValueEmitEvent ) {\r\n\t\tsuper( value, EShapeRuntimeReset.NONE );\r\n\t\tthis.name = this.toExpression( value.name, nameDefault, \"null\" );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst name = this.name( shape, time );\r\n\t\t\tif( name != null ) {\r\n\t\t\t\tshape.emit( name, shape );\r\n\t\t\t\tconst container = this.toContainer( shape );\r\n\t\t\t\tif( container && (\"shape\" in container) ) {\r\n\t\t\t\t\tcontainer.shape.emit( name, shape );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeEmitEvent } from \"./e-shape-action-runtime-emit-event\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueBase } from \"./e-shape-action-value-base\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueEmitEventSerialized = [\r\n\tEShapeActionValueType.EMIT_EVENT, number, number\r\n];\r\n\r\nexport class EShapeActionValueEmitEvent extends EShapeActionValueBase {\r\n\treadonly name: string;\r\n\r\n\tconstructor( condition: string, name: string ) {\r\n\t\tsuper( EShapeActionValueType.EMIT_EVENT, condition );\r\n\t\tthis.name = name;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueEmitEvent) &&\r\n\t\t\tthis.name === value.name\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeEmitEvent {\r\n\t\treturn new EShapeActionRuntimeEmitEvent( this );\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\tconst nameId = manager.add(this.name);\r\n\t\treturn manager.add( `[${this.type},${conditionId},${nameId}]` );\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueEmitEventSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueEmitEvent {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst name = EShapeActionValues.toResource( 2, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueEmitEvent( condition, name );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const ASCII_CHARACTERS =\r\n\t\" !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\";\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class DynamicFontAtlasCharacterOrigin {\r\n\tx: number;\r\n\ty: number;\r\n\r\n\tconstructor( x: number, y: number ) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DynamicFontAtlasCharacterOrigin } from \"./dynamic-font-atlas-chaaracter-origin\";\r\n\r\nexport class DynamicFontAtlasCharacter {\r\n\tref: number;\r\n\tlife: number;\r\n\tx: number;\r\n\ty: number;\r\n\twidth: number;\r\n\theight: number;\r\n\tadvance: number;\r\n\torigin: DynamicFontAtlasCharacterOrigin;\r\n\treserved: boolean;\r\n\r\n\tconstructor( advance: number, width: number, height: number, reserved: boolean ) {\r\n\t\tthis.ref = 1;\r\n\t\tthis.life = 10;\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t\tthis.advance = advance;\r\n\t\tthis.origin = new DynamicFontAtlasCharacterOrigin( 0, 0 );\r\n\t\tthis.reserved = reserved;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nconst VERTEX_SHADER = `\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nvarying mediump vec2 vTextureCoord;\r\nvoid main(void) {\r\n\tgl_Position = vec4(aVertexPosition, 0.0, 1.0);\r\n\tvTextureCoord = aTextureCoord;\r\n}\r\n`;\r\n\r\nconst FRAGMENT_SHADER = `\r\nprecision mediump float;\r\n\r\nvarying mediump vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\nuniform vec2 uSize;\r\n\r\nfloat calcDistance( float x, float y, float dx, float dy ) {\r\n\tfloat xd = x + dx;\r\n\tfloat yd = y + dy;\r\n\tfloat u = xd / uSize.x;\r\n\tfloat v = yd / uSize.y;\r\n\tfloat ul = (xd - 1.0) / uSize.x;\r\n\tfloat vt = (yd - 1.0) / uSize.y;\r\n\r\n\tfloat m = texture2D(uSampler, vec2(u , v )).a;\r\n\tfloat l = texture2D(uSampler, vec2(ul, v )).a;\r\n\tfloat t = texture2D(uSampler, vec2(u , vt)).a;\r\n\r\n\tfloat xl = mix( xd - 1.0, xd, (0.5 - l) / (m - l) );\r\n\tfloat yt = mix( yd - 1.0, yd, (0.5 - t) / (m - t) );\r\n\r\n\tbool bl = ( min(l, m) < 0.5 && 0.5 <= max(l, m) );\r\n\tbool bt = ( min(t, m) < 0.5 && 0.5 <= max(t, m) );\r\n\r\n\tfloat ll = (bl ? length( vec2( xl - x, yd - y ) ) : 100.0);\r\n\tfloat lt = (bt ? length( vec2( xd - x, yt - y ) ) : 100.0);\r\n\r\n\treturn min( ll, lt );\r\n}\r\n\r\nfloat calcDistancesY( float x, float y, float dx ) {\r\n\tfloat d = 100.0;\r\n\tfor( float dy=-6.0; dy<6.5; dy++ ) {\r\n\t\td = min( d, calcDistance( x, y, dx, dy ) );\r\n\t}\r\n\treturn d;\r\n}\r\n\r\nfloat calcDistances( float x, float y ) {\r\n\tfloat d = 100.0;\r\n\tfor( float dx=-6.0; dx<6.5; dx++ ) {\r\n\t\td = min( d, calcDistancesY( x, y, dx ) );\r\n\t}\r\n\treturn d;\r\n}\r\n\r\nvoid main(void) {\r\n\tfloat t = texture2D(uSampler, vTextureCoord).a;\r\n\tfloat x = vTextureCoord.x * uSize.x;\r\n\tfloat y = vTextureCoord.y * uSize.y;\r\n\tfloat d = min( 6.0, calcDistances( x, y ) ) / 12.0;\r\n\td = clamp( mix( 0.5 - d, 0.5 + d, step( 0.5, t ) ), 0.0, 1.0 );\r\n\tgl_FragColor = vec4(1.0, 1.0, 1.0, d);\r\n}\r\n`;\r\n\r\nexport class DynamicSDFFontGenerator {\r\n\tprotected static _INSTANCE: DynamicSDFFontGenerator | null = null;\r\n\r\n\tprotected _canvas: HTMLCanvasElement | null;\r\n\tprotected _onLostBound: EventListener;\r\n\tprotected _onRestoreBound: EventListener;\r\n\tprotected _onUnloadBound: EventListener;\r\n\tprotected _gl: WebGLRenderingContext | null;\r\n\tprotected _texture: WebGLTexture | null;\r\n\tprotected _shaderProgram: WebGLProgram | null;\r\n\tprotected _vertexPositionAttribute: number;\r\n\tprotected _textureCoordAttribute: number;\r\n\tprotected _samplerUniform: WebGLUniformLocation | null;\r\n\tprotected _sizeUniform: WebGLUniformLocation | null;\r\n\tprotected _vb: WebGLBuffer | null;\r\n\tprotected _uvb: WebGLBuffer | null;\r\n\r\n\tconstructor() {\r\n\t\tthis._gl = null;\r\n\t\tthis._texture = null;\r\n\t\tthis._shaderProgram = null;\r\n\t\tthis._vertexPositionAttribute = NaN;\r\n\t\tthis._textureCoordAttribute = NaN;\r\n\t\tthis._samplerUniform = NaN;\r\n\t\tthis._sizeUniform = NaN;\r\n\t\tthis._vb = null;\r\n\t\tthis._uvb = null;\r\n\r\n\t\tconst canvas = this._canvas = document.createElement( \"canvas\" );\r\n\t\tcanvas.width = 64;\r\n\t\tcanvas.height = 64;\r\n\t\tthis._onLostBound = ( e: Event ): void => {\r\n\t\t\te.preventDefault();\r\n\t\t};\r\n\t\tthis._onRestoreBound = (): void => {\r\n\t\t\tthis.restore();\r\n\t\t};\r\n\t\tthis._onUnloadBound = (): void => {\r\n\t\t\tthis.destroy();\r\n\t\t};\r\n\t\tcanvas.addEventListener( \"webglcontextlost\", this._onLostBound, false);\r\n\t\tcanvas.addEventListener( \"webglcontextrestored\", this._onRestoreBound, false);\r\n\t\twindow.addEventListener( \"unload\", this._onUnloadBound, false );\r\n\t}\r\n\r\n\tinit(): this {\r\n\t\tconst canvas = this._canvas;\r\n\t\tif( canvas != null && (this._gl == null || this._gl.isContextLost()) ) {\r\n\t\t\tconst config: WebGLContextAttributes = {\r\n\t\t\t\talpha: true,\r\n\t\t\t\tantialias: false,\r\n\t\t\t\tdepth: false,\r\n\t\t\t\tstencil: false,\r\n\t\t\t\tpremultipliedAlpha: false\r\n\t\t\t};\r\n\t\t\tconst gl = this._gl = (\r\n\t\t\t\tcanvas.getContext( \"webgl\", config ) ||\r\n\t\t\t\tcanvas.getContext( \"experimental-webgl\", config ) as WebGLRenderingContext | null\r\n\t\t\t);\r\n\t\t\tif( gl != null ) {\r\n\t\t\t\tgl.clearColor(1.0, 1.0, 1.0, 0.0);\r\n\t\t\t\tthis.makeVertexBuffer();\r\n\t\t\t\tthis.makeUvBuffer();\r\n\t\t\t\tthis.makeShaders();\r\n\t\t\t\tthis._texture = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\trestore(): void {\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tgetCanvas(): HTMLCanvasElement | null {\r\n\t\treturn this._canvas;\r\n\t}\r\n\r\n\tgetShader( gl: WebGLRenderingContext, code: string, type: boolean ): WebGLShader | null {\r\n\t\tconst shader = ( type ?\r\n\t\t\tgl.createShader( gl.FRAGMENT_SHADER ) :\r\n\t\t\tgl.createShader( gl.VERTEX_SHADER )\r\n\t\t);\r\n\t\tif( shader != null ) {\r\n\t\t\tgl.shaderSource( shader, code );\r\n\t\t\tgl.compileShader( shader );\r\n\t\t\tif( ! gl.getShaderParameter( shader, gl.COMPILE_STATUS ) ) {\r\n\t\t\t\t// tslint:disable-next-line: no-console no-unused-expression\r\n\t\t\t\tconsole && console.error( `Failed to compile the shader: ${gl.getShaderInfoLog(shader)}` );\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn shader;\r\n\t}\r\n\r\n\tmakeShaders(): WebGLShader | null {\r\n\t\tconst gl = this._gl;\r\n\t\tif( gl != null && gl.isContextLost() !== true ) {\r\n\t\t\tconst vertexShader = this.getShader( gl, VERTEX_SHADER, false );\r\n\t\t\tif( vertexShader != null ) {\r\n\t\t\t\tconst fragmentShader = this.getShader( gl, FRAGMENT_SHADER, true );\r\n\t\t\t\tif( fragmentShader != null ) {\r\n\t\t\t\t\tconst shaderProgram = this._shaderProgram = gl.createProgram();\r\n\t\t\t\t\tif( shaderProgram != null ) {\r\n\t\t\t\t\t\tgl.attachShader( shaderProgram, vertexShader );\r\n\t\t\t\t\t\tgl.attachShader( shaderProgram, fragmentShader );\r\n\t\t\t\t\t\tgl.linkProgram( shaderProgram );\r\n\t\t\t\t\t\tif( ! gl.getProgramParameter(shaderProgram, gl.LINK_STATUS) ) {\r\n\t\t\t\t\t\t\t// tslint:disable-next-line: no-console no-unused-expression\r\n\t\t\t\t\t\t\tconsole && console.error( `Failed to link the program: ${gl.getError()}` );\r\n\t\t\t\t\t\t\tgl.deleteShader( vertexShader );\r\n\t\t\t\t\t\t\tgl.deleteShader( fragmentShader );\r\n\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tgl.deleteShader( vertexShader );\r\n\t\t\t\t\t\t\tgl.deleteShader( fragmentShader );\r\n\r\n\t\t\t\t\t\t\tgl.useProgram( shaderProgram );\r\n\t\t\t\t\t\t\tthis._vertexPositionAttribute = gl.getAttribLocation( shaderProgram, \"aVertexPosition\" );\r\n\t\t\t\t\t\t\tthis._textureCoordAttribute = gl.getAttribLocation( shaderProgram, \"aTextureCoord\" );\r\n\t\t\t\t\t\t\tthis._samplerUniform = gl.getUniformLocation( shaderProgram, \"uSampler\" );\r\n\t\t\t\t\t\t\tthis._sizeUniform = gl.getUniformLocation( shaderProgram, \"uSize\" );\r\n\t\t\t\t\t\t\tgl.useProgram( null );\r\n\t\t\t\t\t\t\treturn shaderProgram;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgl.deleteShader( vertexShader );\r\n\t\t\t\t\t\tgl.deleteShader( fragmentShader );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tgl.deleteShader( vertexShader );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tdestroyShaders(): void {\r\n\t\tconst gl = this._gl;\r\n\t\tif( gl != null && gl.isContextLost() !== true ) {\r\n\t\t\tconst shaderProgram = this._shaderProgram;\r\n\t\t\tif( shaderProgram != null ) {\r\n\t\t\t\tthis._shaderProgram = null;\r\n\t\t\t\tgl.useProgram( null );\r\n\t\t\t\tgl.deleteProgram( shaderProgram );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateTexture( source: TexImageSource ): WebGLTexture | null {\r\n\t\tconst gl = this._gl;\r\n\t\tconst canvas = this._canvas;\r\n\t\tif( gl != null && gl.isContextLost() !== true && canvas != null ) {\r\n\t\t\tconst width = source.width;\r\n\t\t\tconst height = source.height;\r\n\t\t\tif( canvas.width !== width || canvas.height !== height ) {\r\n\t\t\t\tcanvas.width = width;\r\n\t\t\t\tcanvas.height = height;\r\n\t\t\t\tgl.viewport( 0, 0, width, height );\r\n\t\t\t}\r\n\r\n\t\t\tlet texture = this._texture;\r\n\t\t\tif( texture == null ) {\r\n\t\t\t\ttexture = this._texture = gl.createTexture();\r\n\t\t\t\tgl.bindTexture( gl.TEXTURE_2D, texture );\r\n\t\t\t\tgl.texImage2D( gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source );\r\n\t\t\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE );\r\n\t\t\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE );\r\n\t\t\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\r\n\t\t\t\tgl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\r\n\t\t\t\tgl.bindTexture( gl.TEXTURE_2D, null );\r\n\t\t\t} else {\r\n\t\t\t\tgl.bindTexture( gl.TEXTURE_2D, texture );\r\n\t\t\t\tgl.texImage2D( gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source );\r\n\t\t\t\tgl.bindTexture( gl.TEXTURE_2D, null );\r\n\t\t\t}\r\n\t\t\treturn texture;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tdestroyTexture(): void {\r\n\t\tconst gl = this._gl;\r\n\t\tconst texture = this._texture;\r\n\t\tif( gl != null && gl.isContextLost() !== true && texture != null ) {\r\n\t\t\tthis._texture = null;\r\n\t\t\tgl.bindTexture( gl.TEXTURE_2D, null );\r\n\t\t\tgl.deleteTexture( texture );\r\n\t\t}\r\n\t}\r\n\r\n\tmakeVertexBuffer(): WebGLBuffer | null {\r\n\t\tconst gl = this._gl;\r\n\t\tif( gl != null && gl.isContextLost() !== true ) {\r\n\t\t\tconst vb = this._vb = gl.createBuffer();\r\n\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vb );\r\n\r\n\t\t\tconst vertices = [\r\n\t\t\t\t-1.0, +1.0,\r\n\t\t\t\t+1.0, +1.0,\r\n\t\t\t\t-1.0, -1.0,\r\n\t\t\t\t+1.0, -1.0\r\n\t\t\t];\r\n\r\n\t\t\tgl.bufferData( gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW );\r\n\t\t\treturn vb;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tdestroyVertexBuffer(): void {\r\n\t\tconst gl = this._gl;\r\n\t\tconst vb = this._vb;\r\n\t\tif( gl != null && gl.isContextLost() !== true && vb != null ) {\r\n\t\t\tthis._vb = null;\r\n\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, null );\r\n\t\t\tgl.deleteBuffer( vb );\r\n\t\t}\r\n\t}\r\n\r\n\tmakeUvBuffer(): WebGLBuffer | null {\r\n\t\tconst gl = this._gl;\r\n\t\tif( gl != null && gl.isContextLost() !== true ) {\r\n\t\t\tconst uvb = this._uvb = gl.createBuffer();\r\n\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, uvb );\r\n\r\n\t\t\tconst uvs = [\r\n\t\t\t\t0.0,  0.0,\r\n\t\t\t\t1.0,  0.0,\r\n\t\t\t\t0.0,  1.0,\r\n\t\t\t\t1.0,  1.0\r\n\t\t\t];\r\n\r\n\t\t\tgl.bufferData( gl.ARRAY_BUFFER, new Float32Array(uvs), gl.STATIC_DRAW );\r\n\t\t\treturn uvb;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tdestroyUvBuffer(): void {\r\n\t\tconst gl = this._gl;\r\n\t\tconst uvb = this._uvb;\r\n\t\tif( gl != null && gl.isContextLost() !== true && uvb != null ) {\r\n\t\t\tthis._uvb = null;\r\n\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, null );\r\n\t\t\tgl.deleteBuffer( uvb );\r\n\t\t}\r\n\t}\r\n\r\n\trender(): void {\r\n\t\tconst gl = this._gl;\r\n\t\tconst canvas = this._canvas;\r\n\t\tconst shaderProgram = this._shaderProgram;\r\n\t\tconst vb = this._vb;\r\n\t\tconst uvb = this._uvb;\r\n\t\tconst texture = this._texture;\r\n\t\tif( gl != null && gl.isContextLost() !== true && canvas != null &&\r\n\t\t\tshaderProgram != null && vb != null && uvb != null && texture != null ) {\r\n\t\t\tgl.clear( gl.COLOR_BUFFER_BIT );\r\n\r\n\t\t\tgl.useProgram( shaderProgram );\r\n\r\n\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, vb );\r\n\t\t\tconst vertexPositionAttribute = this._vertexPositionAttribute;\r\n\t\t\tgl.enableVertexAttribArray( vertexPositionAttribute );\r\n\t\t\tgl.vertexAttribPointer( vertexPositionAttribute, 2, gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, uvb );\r\n\t\t\tconst textureCoordAttribute = this._textureCoordAttribute;\r\n\t\t\tgl.enableVertexAttribArray( textureCoordAttribute );\r\n\t\t\tgl.vertexAttribPointer( textureCoordAttribute, 2, gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\tgl.activeTexture( gl.TEXTURE0 );\r\n\t\t\tgl.bindTexture( gl.TEXTURE_2D, texture );\r\n\t\t\tgl.uniform1i( this._samplerUniform, 0 );\r\n\t\t\tgl.uniform2f( this._sizeUniform, canvas.width, canvas.height );\r\n\r\n\t\t\tgl.drawArrays( gl.TRIANGLE_STRIP, 0, 4 );\r\n\r\n\t\t\tgl.bindTexture( gl.TEXTURE_2D, null );\r\n\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, null );\r\n\t\t\tgl.useProgram( null );\r\n\t\t}\r\n\t}\r\n\r\n\tread( copyCanvas: HTMLCanvasElement ): void {\r\n\t\tconst gl = this._gl;\r\n\t\tconst canvas = this._canvas;\r\n\t\tif( gl != null && gl.isContextLost() !== true && canvas != null ) {\r\n\t\t\tconst width = canvas.width;\r\n\t\t\tconst height = canvas.height;\r\n\t\t\tcopyCanvas.width = width;\r\n\t\t\tcopyCanvas.height = height;\r\n\t\t\tconst copyContext = copyCanvas.getContext( \"2d\" );\r\n\t\t\tif( copyContext != null ) {\r\n\t\t\t\tcopyContext.drawImage( canvas, 0, 0 );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis.destroyVertexBuffer();\r\n\t\tthis.destroyUvBuffer();\r\n\t\tthis.destroyShaders();\r\n\r\n\t\tconst canvas = this._canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tthis._canvas = null;\r\n\t\t\tcanvas.removeEventListener( \"webglcontextlost\", this._onLostBound, false);\r\n\t\t\tcanvas.removeEventListener( \"webglcontextrestored\", this._onRestoreBound, false);\r\n\t\t\twindow.removeEventListener( \"unload\", this._onUnloadBound, false );\r\n\t\t}\r\n\r\n\t\tconst gl = this._gl;\r\n\t\tif( gl != null ) {\r\n\t\t\tthis._gl = null;\r\n\t\t\tconst WebGLLoseContext = gl.getExtension( \"WEBGL_lose_context\" );\r\n\t\t\tif( WebGLLoseContext != null ) {\r\n\t\t\t\tWebGLLoseContext.loseContext();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstatic getInstance(): DynamicSDFFontGenerator {\r\n\t\tif( DynamicSDFFontGenerator._INSTANCE == null ) {\r\n\t\t\tDynamicSDFFontGenerator._INSTANCE = new DynamicSDFFontGenerator();\r\n\t\t}\r\n\t\treturn DynamicSDFFontGenerator._INSTANCE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DThemes } from \"../theme/d-themes\";\r\nimport { ASCII_CHARACTERS } from \"./ascii\";\r\nimport { DynamicFontAtlasCharacter } from \"./dynamic-font-atlas-character\";\r\nimport { DynamicFontAtlasCharacters } from \"./dynamic-font-atlas-characters\";\r\nimport { DynamicSDFFontGenerator } from \"./dynamic-sdf-font-generator\";\r\nimport { UtilCharacterIterator } from \"./util-character-iterator\";\r\n\r\nexport interface DynamicSDFFontAtlasFont {\r\n\tfamily: string;\r\n\tsize: number;\r\n\titalic: boolean;\r\n}\r\n\r\nexport interface DynamicSDFFontAtlasJson {\r\n\twidth: number;\r\n\theight: number;\r\n\tfont: DynamicSDFFontAtlasFont;\r\n\tcharacters: DynamicFontAtlasCharacters;\r\n}\r\n\r\nexport class DynamicSDFFontAtlas {\r\n\tprotected static FONT_FAMILY_AUTO: string | null = null;\r\n\r\n\tprotected _id: string;\r\n\tprotected _generator: DynamicSDFFontGenerator | null;\r\n\tprotected _canvas: HTMLCanvasElement | null;\r\n\tprotected _font: DynamicSDFFontAtlasFont;\r\n\tprotected _characters: DynamicFontAtlasCharacters;\r\n\tprotected _length: number;\r\n\tprotected _width: number;\r\n\tprotected _height: number;\r\n\tprotected _isDirty: boolean;\r\n\r\n\tconstructor( fontFamily: string ) {\r\n\t\tthis._id = `font-atlas:${fontFamily}`;\r\n\t\tthis._generator = DynamicSDFFontGenerator.getInstance().init();\r\n\t\tthis._canvas = document.createElement( \"canvas\" );\r\n\t\tthis._font = {\r\n\t\t\tfamily: DynamicSDFFontAtlas.toFontFamily( fontFamily ),\r\n\t\t\tsize: 32,\r\n\t\t\titalic: false\r\n\t\t};\r\n\t\tthis._characters = {};\r\n\t\tthis._length = 0;\r\n\t\tthis._width = 1;\r\n\t\tthis._height = 1;\r\n\t\tthis._isDirty = true;\r\n\t}\r\n\r\n\tget id() {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget font(): DynamicSDFFontAtlasFont {\r\n\t\treturn this._font;\r\n\t}\r\n\r\n\tset font( font: DynamicSDFFontAtlasFont ) {\r\n\t\tthis._font.family = font.family;\r\n\t\tthis._font.size = font.size;\r\n\t\tthis._font.italic = font.italic;\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tget canvas(): HTMLCanvasElement | null {\r\n\t\treturn this._canvas;\r\n\t}\r\n\r\n\tget generator(): DynamicSDFFontGenerator | null {\r\n\t\treturn this._generator;\r\n\t}\r\n\r\n\tget characters(): DynamicFontAtlasCharacters {\r\n\t\treturn this._characters;\r\n\t}\r\n\r\n\tbegin(): void {\r\n\t\tthis._length = 0;\r\n\t\tconst characters = this._characters;\r\n\t\tfor( const character in characters ) {\r\n\t\t\tcharacters[ character ].ref = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tend(): void {\r\n\t\tconst characters = this._characters;\r\n\t\tfor( const character in characters ) {\r\n\t\t\tconst data = characters[ character ];\r\n\t\t\tif( data.ref <= 0 ) {\r\n\t\t\t\tdata.life -= 1;\r\n\t\t\t\tif( data.life <= 0 ) {\r\n\t\t\t\t\tdelete characters[ character ];\r\n\t\t\t\t\tthis._isDirty =  true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\taddAscii(): void {\r\n\t\tthis.add( ASCII_CHARACTERS );\r\n\t\tthis.addChar( \"...\" );\r\n\t}\r\n\r\n\taddChar( character: string ): void {\r\n\t\tconst characters = this._characters;\r\n\t\tif( character !== \"\\n\" ) {\r\n\t\t\tconst data = characters[ character ];\r\n\t\t\tif( data != null ) {\r\n\t\t\t\tif( data.ref <= 0 ) {\r\n\t\t\t\t\tthis._length += 1;\r\n\t\t\t\t}\r\n\t\t\t\tdata.ref += 1;\r\n\t\t\t} else {\r\n\t\t\t\tcharacters[ character ] = new DynamicFontAtlasCharacter( 0, 1, 1, false );\r\n\t\t\t\tthis._length += 1;\r\n\t\t\t\tthis._isDirty = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tadd( characters: string ): void {\r\n\t\tconst iterator = UtilCharacterIterator.from( characters );\r\n\t\twhile( iterator.hasNext() ) {\r\n\t\t\tthis.addChar( iterator.next() );\r\n\t\t}\r\n\t}\r\n\r\n\tget( character: string ): DynamicFontAtlasCharacter | undefined {\r\n\t\treturn this._characters[ character ];\r\n\t}\r\n\r\n\tupdate(): boolean {\r\n\t\tif( this._isDirty ) {\r\n\t\t\tconst canvas = this._canvas;\r\n\t\t\tconst generator = this._generator;\r\n\t\t\tif( canvas != null && generator != null ) {\r\n\t\t\t\tconst context = canvas.getContext( \"2d\" );\r\n\t\t\t\tif( context != null ) {\r\n\t\t\t\t\tthis._isDirty = false;\r\n\r\n\t\t\t\t\tconst font = this._font;\r\n\t\t\t\t\tconst characters = this._characters;\r\n\t\t\t\t\tconst characterSize = font.size + 14;\r\n\t\t\t\t\tconst width = DynamicSDFFontAtlas.toPowerOf2( Math.ceil( Math.sqrt( this._length ) ) * characterSize );\r\n\t\t\t\t\tthis._width = width;\r\n\t\t\t\t\tconst fontStyle = (font.italic ? \"italic \" : \"\") + (font.size + \"px \") + font.family;\r\n\r\n\t\t\t\t\tcontext.font = fontStyle;\r\n\t\t\t\t\tcontext.textAlign = \"left\";\r\n\t\t\t\t\tcontext.textBaseline = \"middle\";\r\n\t\t\t\t\tcontext.lineWidth = 0;\r\n\t\t\t\t\tcontext.lineCap = \"round\";\r\n\t\t\t\t\tcontext.lineJoin = \"miter\";\r\n\t\t\t\t\tcontext.miterLimit = 0;\r\n\t\t\t\t\tcontext.fillStyle = \"#FFFFFF\";\r\n\r\n\t\t\t\t\tconst offsetX = 7;\r\n\t\t\t\t\tconst offsetY = ( characterSize >> 1 );\r\n\t\t\t\t\tlet x = 0;\r\n\t\t\t\t\tlet y = 0;\r\n\t\t\t\t\tfor( const character in characters ) {\r\n\t\t\t\t\t\tconst data = characters[ character ];\r\n\t\t\t\t\t\tconst advance = context.measureText( character ).width;\r\n\t\t\t\t\t\tconst characterWidth = Math.ceil( offsetX + advance + offsetX );\r\n\t\t\t\t\t\tconst characterHeight = characterSize;\r\n\t\t\t\t\t\tif( width <= x + characterWidth ) {\r\n\t\t\t\t\t\t\tx = 0;\r\n\t\t\t\t\t\t\ty += characterSize;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdata.x = x;\r\n\t\t\t\t\t\tdata.y = y;\r\n\t\t\t\t\t\tdata.width = characterWidth;\r\n\t\t\t\t\t\tdata.height = characterHeight;\r\n\t\t\t\t\t\tdata.advance = advance;\r\n\t\t\t\t\t\tdata.origin.x = x + offsetX;\r\n\t\t\t\t\t\tdata.origin.y = y + offsetY;\r\n\r\n\t\t\t\t\t\tx += characterWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst height = this._height = y + characterSize;\r\n\r\n\t\t\t\t\t// Make a input canvas\r\n\t\t\t\t\t// Here, we need to reset the context because\r\n\t\t\t\t\t// context settings will be lost when we set the width/height.\r\n\t\t\t\t\tcanvas.width = width;\r\n\t\t\t\t\tcanvas.height = height;\r\n\t\t\t\t\tcontext.font = fontStyle;\r\n\t\t\t\t\tcontext.textAlign = \"left\";\r\n\t\t\t\t\tcontext.textBaseline = \"middle\";\r\n\t\t\t\t\tcontext.lineWidth = 0;\r\n\t\t\t\t\tcontext.lineCap = \"round\";\r\n\t\t\t\t\tcontext.lineJoin = \"miter\";\r\n\t\t\t\t\tcontext.miterLimit = 4;\r\n\t\t\t\t\tcontext.fillStyle = \"#FFFFFF\";\r\n\t\t\t\t\tcontext.clearRect( 0, 0, width, height );\r\n\t\t\t\t\tfor( const character in characters ) {\r\n\t\t\t\t\t\tconst data = characters[ character ];\r\n\t\t\t\t\t\tcontext.fillText( character, data.origin.x, data.origin.y );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Convert to SDF font texture\r\n\t\t\t\t\tgenerator.updateTexture( canvas );\r\n\t\t\t\t\tgenerator.render();\r\n\t\t\t\t\tgenerator.read( canvas );\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tget length(): number {\r\n\t\treturn this._length;\r\n\t}\r\n\r\n\ttoJson(): DynamicSDFFontAtlasJson {\r\n\t\treturn {\r\n\t\t\twidth: this._width,\r\n\t\t\theight: this._height,\r\n\t\t\tfont: this._font,\r\n\t\t\tcharacters: this._characters\r\n\t\t};\r\n\t}\r\n\r\n\ttoString(): string {\r\n\t\treturn JSON.stringify( this.toJson() );\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tconst generator = this._generator;\r\n\t\tif( generator != null ) {\r\n\t\t\tthis._generator = null;\r\n\t\t}\r\n\r\n\t\tconst canvas = this._canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tthis._canvas = null;\r\n\t\t}\r\n\r\n\t\tconst characters = this._characters;\r\n\t\tfor( const character in characters ) {\r\n\t\t\tdelete characters[ character ];\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toFontFamily( fontFamily: string ) {\r\n\t\treturn ( fontFamily === \"auto\" ?\r\n\t\t\tDynamicSDFFontAtlas.getAutoFontFamily() :\r\n\t\t\tfontFamily\r\n\t\t);\r\n\t}\r\n\r\n\tstatic toPowerOf2( size: number ): number {\r\n\t\tlet result = 32;\r\n\t\twhile( result < size ) {\r\n\t\t\tresult <<= 1;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic getAutoFontFamily(): string {\r\n\t\tif( DynamicSDFFontAtlas.FONT_FAMILY_AUTO == null ) {\r\n\t\t\tDynamicSDFFontAtlas.FONT_FAMILY_AUTO = (DThemes.getInstance().get( \"DBase\" ) as any).getFontFamilly() as string;\r\n\t\t}\r\n\t\treturn DynamicSDFFontAtlas.FONT_FAMILY_AUTO;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix, Point, Rectangle, Renderer } from \"pixi.js\";\r\nimport { DApplicationLayerLike } from \"../../d-application-layer-like\";\r\nimport { DApplications } from \"../../d-applications\";\r\nimport { DynamicSDFFontAtlas } from \"../../util/dynamic-sdf-font-atlas\";\r\nimport { UtilKeyboardEvent } from \"../../util/util-keyboard-event\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeTextWeight } from \"../e-shape-text\";\r\n\r\ntype OnChange = ( shape: EShape, value: string ) => void;\r\ntype OnInput = ( shape: EShape, value: string ) => void;\r\n\r\nexport class EShapeActionRuntimeMiscInputData {\r\n\tprotected input: HTMLInputElement | null;\r\n\tprotected shape: EShape | null;\r\n\tprotected value: string;\r\n\tprotected onChange?: OnChange;\r\n\tprotected onInput?: OnInput;\r\n\r\n\tprotected point: Point;\r\n\tprotected rect: Rectangle;\r\n\r\n\tprotected _onInputKeyDownBound!: ( e: KeyboardEvent ) => void;\r\n\tprotected _onInputBlurBound!: ( e: FocusEvent ) => void;\r\n\tprotected _updateInputBound!: () => void;\r\n\tprotected _onInputChangeBound!: ( e: Event ) => void;\r\n\tprotected _onInputInputBound!: ( e: Event ) => void;\r\n\tprotected _updateInputBoundRenderer!: Renderer | null;\r\n\r\n\tconstructor() {\r\n\t\tthis.input = null;\r\n\t\tthis.shape = null;\r\n\t\tthis.value = \"\";\r\n\r\n\t\tthis.point = new Point();\r\n\t\tthis.rect = new Rectangle();\r\n\r\n\t\tthis._onInputKeyDownBound = ( e: KeyboardEvent ) => {\r\n\t\t\tthis.onInputKeyDown( e );\r\n\t\t};\r\n\r\n\t\tthis._onInputBlurBound = ( e: FocusEvent ) => {\r\n\t\t\tthis.onInputBlur( e );\r\n\t\t};\r\n\r\n\t\tthis._updateInputBound = () => {\r\n\t\t\tthis.updateInput();\r\n\t\t};\r\n\r\n\t\tthis._onInputChangeBound = () => {\r\n\t\t\tthis.onInputChange();\r\n\t\t};\r\n\r\n\t\tthis._onInputInputBound = ( e ) => {\r\n\t\t\tthis.onInputInput( e );\r\n\t\t};\r\n\r\n\t\tthis._updateInputBoundRenderer = null;\r\n\t}\r\n\r\n\tprotected getInput( layer: DApplicationLayerLike ): HTMLInputElement | null {\r\n\t\tif( this.input == null ) {\r\n\t\t\tlayer.application.getRootElement().appendChild(\r\n\t\t\t\tthis.input = this.createInput()\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn this.input;\r\n\t}\r\n\r\n\tprotected createInput(): HTMLInputElement {\r\n\t\tconst result = document.createElement( \"input\" );\r\n\t\tresult.setAttribute( \"spellcheck\", \"false\" );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getInputType(): string {\r\n\t\treturn \"text\";\r\n\t}\r\n\r\n\tprotected initInput( shape: EShape, input: HTMLInputElement, value: string ): void {\r\n\t\tinput.type = this.getInputType();\r\n\t\tinput.value = value;\r\n\t\tinput.addEventListener( \"keydown\", this._onInputKeyDownBound );\r\n\t\tinput.addEventListener( \"blur\", this._onInputBlurBound );\r\n\t\tinput.addEventListener( \"change\", this._onInputChangeBound );\r\n\t\tinput.addEventListener( \"input\", this._onInputInputBound );\r\n\r\n\t\t// Style\r\n\t\tinput.setAttribute( \"style\", this.getInputStyle( shape ) );\r\n\r\n\t\t// ReadOnly\r\n\t\tif( shape.readonly ) {\r\n\t\t\tinput.setAttribute( \"readonly\", \"readonly\" );\r\n\t\t} else {\r\n\t\t\tinput.removeAttribute( \"readonly\" );\r\n\t\t}\r\n\r\n\t\t// Disabled\r\n\t\tif( shape.disabled ) {\r\n\t\t\tinput.setAttribute( \"disabled\", \"disabled\" );\r\n\t\t} else {\r\n\t\t\tinput.removeAttribute( \"disabled\" );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getInputStyleBackground(): string {\r\n\t\treturn `background-color: transparent;`;\r\n\t}\r\n\r\n\tprotected getInputStyleBorder(): string {\r\n\t\treturn `border: none; box-sizing: border-box;`;\r\n\t}\r\n\r\n\tprotected getInputStylePadding( shape: EShape, scale: number ): string {\r\n\t\tconst padding = shape.text.padding;\r\n\t\tconst paddingVertical = 0;\r\n\t\tconst paddingHorizontal = padding.horizontal * scale;\r\n\t\treturn `padding: ${paddingVertical}px ${paddingHorizontal}px ${paddingVertical}px ${paddingHorizontal}px;`;\r\n\t}\r\n\r\n\tprotected getInputStyleOutline(): string {\r\n\t\treturn `outline: none;`;\r\n\t}\r\n\r\n\tprotected getInputStylePosition( rect: Rectangle, matrix: Matrix ): string {\r\n\t\treturn `position: absolute;` +\r\n\t\t\t`left: ${rect.x}px;` +\r\n\t\t\t`top: ${rect.y}px;` +\r\n\t\t\t`width: ${rect.width}px;` +\r\n\t\t\t`height: ${rect.height}px;` +\r\n\t\t\t`line-height: ${rect.height}px;` +\r\n\t\t\t`transform: matrix(${matrix.a},${matrix.b},${matrix.c},${matrix.d},${matrix.tx},${matrix.ty});`;\r\n\t}\r\n\r\n\tprotected getInputStyleText( shape: EShape, rect: Rectangle, scale: number ): string {\r\n\t\tconst text = shape.text;\r\n\t\treturn `font-family: ${DynamicSDFFontAtlas.toFontFamily( text.family )};` +\r\n\t\t\t`font-size: ${text.size * scale}px;` +\r\n\t\t\t`font-weight: ${text.weight === EShapeTextWeight.NORMAL ? \"normal\" : \"bold\" };` +\r\n\t\t\t`color: #${text.color.toString( 16 )};`;\r\n\t}\r\n\r\n\tprotected getInputStyleMargin( shape: EShape, rect: Rectangle, scale: number ): string {\r\n\t\treturn `margin: 0;`;\r\n\t}\r\n\r\n\tprotected getInputStyle( shape: EShape ): string {\r\n\t\tconst pivot = shape.transform.pivot;\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst rect = this.rect;\r\n\t\trect.x = -0.5 * sizeX + pivot.x;\r\n\t\trect.y = -0.5 * sizeY + pivot.y;\r\n\t\trect.width = sizeX;\r\n\t\trect.height = sizeY;\r\n\r\n\t\tshape.updateTransform();\r\n\t\tconst scale = 1.0;\r\n\t\tconst worldTransform = shape.transform.worldTransform;\r\n\r\n\t\treturn this.getInputStylePosition( rect, worldTransform ) +\r\n\t\t\tthis.getInputStyleMargin( shape, rect, scale ) +\r\n\t\t\tthis.getInputStyleText( shape, rect, scale ) +\r\n\t\t\tthis.getInputStyleBackground() +\r\n\t\t\tthis.getInputStyleBorder() +\r\n\t\t\tthis.getInputStylePadding( shape, scale ) +\r\n\t\t\tthis.getInputStyleOutline();\r\n\t}\r\n\r\n\tprotected onInputKeyDown( e: KeyboardEvent ): void {\r\n\t\tif( UtilKeyboardEvent.isFocusKey( e ) ) {\r\n\t\t\tconst shape = this.shape;\r\n\t\t\tif( shape != null ) {\r\n\t\t\t\tthis.onInputChange();\r\n\t\t\t\tthis.hide();\r\n\r\n\t\t\t\tconst layer = DApplications.getLayer( shape );\r\n\t\t\t\tif( layer ) {\r\n\t\t\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\t\t\tconst direction = UtilKeyboardEvent.getFocusDirection( e );\r\n\t\t\t\t\tconst focusable = focusController.findFocusable( shape, false, false, direction );\r\n\t\t\t\t\tif( focusable != null ) {\r\n\t\t\t\t\t\tlayer.view.focus();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tfocusController.setFocused( focusable, true, true );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if( UtilKeyboardEvent.isOkKey( e ) ) {\r\n\t\t\tthis.onInputChange();\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onInputBlur( e: FocusEvent ): void {\r\n\t\tthis.onInputChange();\r\n\t\tthis.hide();\r\n\t}\r\n\r\n\tprotected onInputInput( e: Event ): void {\r\n\t\tif( e.target instanceof HTMLInputElement ) {\r\n\t\t\tconst shape = this.shape;\r\n\t\t\tconst onInput = this.onInput;\r\n\t\t\tif( shape != null && onInput != null ) {\r\n\t\t\t\tonInput( shape, e.target.value );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateInput(): void {\r\n\t\tconst shape = this.shape;\r\n\t\tif( shape != null ) {\r\n\t\t\tif( shape.visible ) {\r\n\t\t\t\tconst input = this.input;\r\n\t\t\t\tif( input != null ) {\r\n\t\t\t\t\tinput.setAttribute( \"style\", this.getInputStyle( shape ) );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.hide();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tisShown( shape: EShape ): boolean {\r\n\t\treturn ( this.shape === shape );\r\n\t}\r\n\r\n\tshow(\r\n\t\tnewShape: EShape, value: string,\r\n\t\tonChange?: OnChange, onInput?: OnInput\r\n\t): void {\r\n\t\tconst oldShape = this.shape;\r\n\t\tif( oldShape != null && oldShape !== newShape ) {\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t\tif( this.shape == null ) {\r\n\t\t\tthis.shape = newShape;\r\n\t\t\tthis.value = value;\r\n\t\t\tthis.onChange = onChange;\r\n\t\t\tthis.onInput = onInput;\r\n\r\n\t\t\tconst text = newShape.text;\r\n\t\t\tif( text != null ) {\r\n\t\t\t\ttext.enable = false;\r\n\t\t\t}\r\n\r\n\t\t\tconst layer = DApplications.getLayer( newShape );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tconst input = this.getInput( layer );\r\n\t\t\t\tif( input ) {\r\n\t\t\t\t\tthis.initInput( newShape, input, value );\r\n\r\n\t\t\t\t\tconst updateInputBound = this._updateInputBound;\r\n\t\t\t\t\tconst renderer = this._updateInputBoundRenderer;\r\n\t\t\t\t\tif( renderer != null ) {\r\n\t\t\t\t\t\trenderer.off( \"postrender\", updateInputBound );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._updateInputBoundRenderer = layer.renderer;\r\n\t\t\t\t\tlayer.renderer.on( \"postrender\", updateInputBound );\r\n\r\n\t\t\t\t\tinput.style.display = \"\";\r\n\t\t\t\t\tinput.focus();\r\n\t\t\t\t\tinput.select();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayer.update();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thide(): void {\r\n\t\tconst shape = this.shape;\r\n\t\tif( shape != null ) {\r\n\t\t\tthis.shape = null;\r\n\t\t\tthis.value = \"\";\r\n\r\n\t\t\tconst text = shape.text;\r\n\t\t\tif( text != null ) {\r\n\t\t\t\ttext.enable = true;\r\n\t\t\t}\r\n\r\n\t\t\tconst input = this.input;\r\n\t\t\tif( input != null ) {\r\n\t\t\t\tinput.removeEventListener( \"keydown\", this._onInputKeyDownBound );\r\n\t\t\t\tinput.removeEventListener( \"blur\", this._onInputBlurBound );\r\n\t\t\t\tinput.removeEventListener( \"change\", this._onInputChangeBound );\r\n\t\t\t\tinput.removeEventListener( \"input\", this._onInputInputBound );\r\n\t\t\t\tinput.style.display = \"none\";\r\n\t\t\t}\r\n\r\n\t\t\tconst renderer = this._updateInputBoundRenderer;\r\n\t\t\tif( renderer != null ) {\r\n\t\t\t\tthis._updateInputBoundRenderer = null;\r\n\t\t\t\trenderer.off( \"postrender\", this._updateInputBound );\r\n\t\t\t}\r\n\r\n\t\t\tDApplications.update( shape );\r\n\t\t}\r\n\t}\r\n\r\n\tonInputChange(): void {\r\n\t\tconst shape = this.shape;\r\n\t\tconst input = this.input;\r\n\t\tconst onChange = this.onChange;\r\n\t\tif( shape != null && input != null && onChange != null ) {\r\n\t\t\tconst newValue = input.value;\r\n\t\t\tif( this.value !== newValue ) {\r\n\t\t\t\tonChange( shape, newValue );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeMiscInputData } from \"./e-shape-action-runtime-misc-input-data\";\r\n\r\nexport class EShapeActionRuntimeMiscInput extends EShapeActionRuntime {\r\n\tstatic data: EShapeActionRuntimeMiscInputData | null = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( ! shape.disabled ) {\r\n\t\t\tconst data = EShapeActionRuntimeMiscInput.getData();\r\n\t\t\tif( shape.focused ) {\r\n\t\t\t\tif( ! data.isShown( shape ) ) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tdata.show( shape, shape.text.value, ( _: EShape, value: string ): void => {\r\n\t\t\t\t\t\t\tshape.text.value = value;\r\n\t\t\t\t\t\t\tshape.emit( name, shape, value );\r\n\t\t\t\t\t\t\tconst container = this.toContainer( shape );\r\n\t\t\t\t\t\t\tif( container && (\"shape\" in container) ) {\r\n\t\t\t\t\t\t\t\tcontainer.shape.emit( name, shape, value );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( data.isShown( shape ) ) {\r\n\t\t\t\t\tdata.onInputChange();\r\n\t\t\t\t\tdata.hide();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstatic getData(): EShapeActionRuntimeMiscInputData {\r\n\t\tif( EShapeActionRuntimeMiscInput.data == null ) {\r\n\t\t\tEShapeActionRuntimeMiscInput.data = new EShapeActionRuntimeMiscInputData();\r\n\t\t}\r\n\t\treturn EShapeActionRuntimeMiscInput.data;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntime } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeMiscInput } from \"./e-shape-action-runtime-misc-input\";\r\nimport { EShapeActionValueMiscType } from \"./e-shape-action-value-misc-type\";\r\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueMiscSerialized = [\r\n\tEShapeActionValueType.MISC, number, EShapeActionValueMiscType\r\n];\r\n\r\nexport class EShapeActionValueMisc extends EShapeActionValueSubtyped<EShapeActionValueMiscType> {\r\n\tconstructor( subtype: EShapeActionValueMiscType, condition: string ) {\r\n\t\tsuper( EShapeActionValueType.MISC, condition, subtype );\r\n\t}\r\n\r\n\ttoRuntime( shape: EShape ): EShapeActionRuntime {\r\n\t\tswitch( this.subtype ) {\r\n\t\tcase EShapeActionValueMiscType.INPUT:\r\n\t\t\treturn new EShapeActionRuntimeMiscInput();\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\treturn manager.add( `[${this.type},${conditionId},${this.subtype}]` );\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueMiscSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueMisc {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueMisc( serialized[ 2 ], condition );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueOpenType {\r\n\tFLOW,\r\n\tPAGE,\r\n\tPAGE_INPLACE\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\r\n\r\nconst targetDefault = (): string | null => null;\r\n\r\nexport class EShapeActionRuntimeOpen extends EShapeActionRuntimeConditional {\r\n\tprotected readonly target: EShapeActionExpression<string | null>;\r\n\r\n\tconstructor( value: EShapeActionValueOpen, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( value, reset );\r\n\t\tthis.target = this.toExpression( value.target, targetDefault, \"null\" );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeOpen } from \"./e-shape-action-runtime-open\";\r\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\r\n\r\nexport class EShapeActionRuntimeOpenFlow extends EShapeActionRuntimeOpen {\r\n\tconstructor( value: EShapeActionValueOpen ) {\r\n\t\tsuper( value, EShapeRuntimeReset.NONE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst target = this.target( shape, time );\r\n\t\t\tif( target != null ) {\r\n\t\t\t\tconst container = this.toContainer( shape );\r\n\t\t\t\tif( container && (\"opener\" in container) ) {\r\n\t\t\t\t\tcontainer.opener( target );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeOpen } from \"./e-shape-action-runtime-open\";\r\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\r\n\r\nexport class EShapeActionRuntimeOpenPage extends EShapeActionRuntimeOpen {\r\n\tconstructor( value: EShapeActionValueOpen ) {\r\n\t\tsuper( value, EShapeRuntimeReset.NONE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst target = this.target( shape, time );\r\n\t\t\tif( target != null ) {\r\n\t\t\t\twindow.open( target );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeOpen } from \"./e-shape-action-runtime-open\";\r\nimport { EShapeActionValueOpen } from \"./e-shape-action-value-open\";\r\n\r\nexport class EShapeActionRuntimeOpenPageInplace extends EShapeActionRuntimeOpen {\r\n\tconstructor( value: EShapeActionValueOpen ) {\r\n\t\tsuper( value, EShapeRuntimeReset.NONE );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst target = this.target( shape, time );\r\n\t\t\tif( target != null ) {\r\n\t\t\t\twindow.location.href = target;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeOpen } from \"./e-shape-action-runtime-open\";\r\nimport { EShapeActionRuntimeOpenFlow } from \"./e-shape-action-runtime-open-flow\";\r\nimport { EShapeActionRuntimeOpenPage } from \"./e-shape-action-runtime-open-page\";\r\nimport { EShapeActionRuntimeOpenPageInplace } from \"./e-shape-action-runtime-open-page-inplace\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueOpenType } from \"./e-shape-action-value-open-type\";\r\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueOpenSerialized = [\r\n\tEShapeActionValueType.OPEN, number, EShapeActionValueOpenType, number\r\n];\r\n\r\nexport class EShapeActionValueOpen extends EShapeActionValueSubtyped<EShapeActionValueOpenType> {\r\n\treadonly target: string;\r\n\r\n\tconstructor( subtype: EShapeActionValueOpenType, condition: string, target: string ) {\r\n\t\tsuper( EShapeActionValueType.OPEN, condition, subtype );\r\n\t\tthis.target = target;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueOpen) &&\r\n\t\t\tthis.target === value.target\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeOpen {\r\n\t\tswitch( this.subtype ) {\r\n\t\tcase EShapeActionValueOpenType.FLOW:\r\n\t\t\treturn new EShapeActionRuntimeOpenFlow( this );\r\n\t\tcase EShapeActionValueOpenType.PAGE:\r\n\t\t\treturn new EShapeActionRuntimeOpenPage( this );\r\n\t\tcase EShapeActionValueOpenType.PAGE_INPLACE:\r\n\t\t\treturn new EShapeActionRuntimeOpenPageInplace( this );\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\tconst targetId = manager.add(this.target);\r\n\t\treturn manager.add( `[${this.type},${conditionId},${this.subtype},${targetId}]` );\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueOpenSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueOpen {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst target = EShapeActionValues.toResource( 3, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueOpen( serialized[ 2 ], condition, target );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueShowHideType {\r\n\tSHOW,\r\n\tHIDE\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueShowHide } from \"./e-shape-action-value-show-hide\";\r\nimport { EShapeActionValueShowHideType } from \"./e-shape-action-value-show-hide-type\";\r\n\r\nexport class EShapeActionRuntimeShowHide extends EShapeActionRuntimeConditional {\r\n\tvisibility: boolean;\r\n\r\n\tconstructor( value: EShapeActionValueShowHide ) {\r\n\t\tsuper( value, EShapeRuntimeReset.VISIBILITY );\r\n\t\tthis.visibility = ( value.subtype === EShapeActionValueShowHideType.SHOW );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tshape.visible = this.visibility;\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueTransformMoveType {\r\n\tRELATIVE_X,\r\n\tRELATIVE_Y,\r\n\tABSOLUTE_X,\r\n\tABSOLUTE_Y,\r\n\tFORWARD_OR_BACKWARD,\r\n\tLEFT_OR_RIGHT\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueTransformType {\r\n\tRESIZE,\r\n\tMOVE,\r\n\tROTATE\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeShowHide } from \"./e-shape-action-runtime-show-hide\";\r\nimport { EShapeActionValueShowHideType } from \"./e-shape-action-value-show-hide-type\";\r\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueShowHideSerialized = [\r\n\tEShapeActionValueType.SHOW_HIDE, number, EShapeActionValueShowHideType\r\n];\r\n\r\nexport class EShapeActionValueShowHide extends EShapeActionValueSubtyped<EShapeActionValueShowHideType> {\r\n\tconstructor( subtype: EShapeActionValueShowHideType, condition: string ) {\r\n\t\tsuper( EShapeActionValueType.SHOW_HIDE, condition, subtype );\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeShowHide {\r\n\t\treturn new EShapeActionRuntimeShowHide( this );\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\treturn manager.add( `[${this.type},${conditionId},${this.subtype}]` );\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueShowHideSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueShowHide {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueShowHide( serialized[ 2 ], condition );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\r\n\r\nconst amountDefault = (): number => 0;\r\n\r\nexport class EShapeActionRuntimeTransformMove extends EShapeActionRuntimeConditional {\r\n\tprotected readonly amount: EShapeActionExpression<number>;\r\n\r\n\tconstructor( value: EShapeActionValueTransformMove, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( value, reset );\r\n\t\tthis.amount = this.toExpression( value.amount, amountDefault, \"0\" );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\r\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\r\n\r\nexport class EShapeActionRuntimeTransformMoveAbsoluteX extends EShapeActionRuntimeTransformMove {\r\n\tconstructor( value: EShapeActionValueTransformMove ) {\r\n\t\tsuper( value, EShapeRuntimeReset.POSITION_X );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst amount = this.amount( shape, time );\r\n\t\t\tshape.transform.position.x = amount;\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\r\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\r\n\r\nexport class EShapeActionRuntimeTransformMoveAbsoluteY extends EShapeActionRuntimeTransformMove {\r\n\tconstructor( value: EShapeActionValueTransformMove ) {\r\n\t\tsuper( value, EShapeRuntimeReset.POSITION_Y );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst amount = this.amount( shape, time );\r\n\t\t\tshape.transform.position.y = amount;\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\r\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\r\n\r\nexport class EShapeActionRuntimeTransformMoveForwardOrBackward extends EShapeActionRuntimeTransformMove {\r\n\tconstructor( value: EShapeActionValueTransformMove ) {\r\n\t\tsuper( value, EShapeRuntimeReset.POSITION );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst amount = this.amount( shape, time );\r\n\t\t\tconst transform = shape.transform;\r\n\t\t\tconst position = transform.position;\r\n\t\t\tconst writtenPositionX = ( (runtime.written & EShapeRuntimeReset.POSITION_X) !== 0 );\r\n\t\t\tconst writtenPositionY = ( (runtime.written & EShapeRuntimeReset.POSITION_Y) !== 0 );\r\n\t\t\tconst oldPositionX = ( writtenPositionX ? position.x : runtime.x );\r\n\t\t\tconst oldPositionY = ( writtenPositionY ? position.y : runtime.y );\r\n\t\t\tshape.updateTransform();\r\n\t\t\tconst localTransform = shape.transform.localTransform;\r\n\t\t\tposition.set( oldPositionX - localTransform.c * amount, oldPositionY - localTransform.d * amount );\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\r\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\r\n\r\nexport class EShapeActionRuntimeTransformMoveLeftOrRight extends EShapeActionRuntimeTransformMove {\r\n\tconstructor( value: EShapeActionValueTransformMove ) {\r\n\t\tsuper( value, EShapeRuntimeReset.POSITION );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst amount = this.amount( shape, time );\r\n\t\t\tconst transform = shape.transform;\r\n\t\t\tconst position = transform.position;\r\n\t\t\tconst writtenPositionX = ( (runtime.written & EShapeRuntimeReset.POSITION_X) !== 0 );\r\n\t\t\tconst writtenPositionY = ( (runtime.written & EShapeRuntimeReset.POSITION_Y) !== 0 );\r\n\t\t\tconst oldPositionX = ( writtenPositionX ? position.x : runtime.x );\r\n\t\t\tconst oldPositionY = ( writtenPositionY ? position.y : runtime.y );\r\n\t\t\tshape.updateTransform();\r\n\t\t\tconst localTransform = shape.transform.localTransform;\r\n\t\t\tposition.set( oldPositionX + localTransform.a * amount, oldPositionY + localTransform.b * amount );\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\r\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\r\n\r\nexport class EShapeActionRuntimeTransformMoveRelativeX extends EShapeActionRuntimeTransformMove {\r\n\tconstructor( value: EShapeActionValueTransformMove ) {\r\n\t\tsuper( value, EShapeRuntimeReset.POSITION_X );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst amount = this.amount( shape, time );\r\n\t\t\tconst writtenPositionX = ( (runtime.written & EShapeRuntimeReset.POSITION_X) !== 0 );\r\n\t\t\tconst position = shape.transform.position;\r\n\t\t\tconst oldPositionX = ( writtenPositionX ? position.x : runtime.x );\r\n\t\t\tposition.x = oldPositionX + amount;\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\r\nimport { EShapeActionValueTransformMove } from \"./e-shape-action-value-transform-move\";\r\n\r\nexport class EShapeActionRuntimeTransformMoveRelativeY extends EShapeActionRuntimeTransformMove {\r\n\tconstructor( action: EShapeActionValueTransformMove ) {\r\n\t\tsuper( action, EShapeRuntimeReset.POSITION_Y );\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst amount = this.amount( shape, time );\r\n\t\t\tconst writtenPositionY = ( (runtime.written & EShapeRuntimeReset.POSITION_Y) !== 0 );\r\n\t\t\tconst position = shape.transform.position;\r\n\t\t\tconst oldPositionY = ( writtenPositionY ? position.y : runtime.y );\r\n\t\t\tposition.y = oldPositionY + amount;\r\n\t\t\truntime.written |= this.reset;\r\n\t\t}\r\n\t}\r\n}\r\n","import { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueSubtyped } from \"./e-shape-action-value-subtyped\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\n\r\nexport abstract class EShapeActionValueOpetyped<\r\n\tSUBTYPE extends number,\r\n\tOPETYPE extends number\r\n> extends EShapeActionValueSubtyped<SUBTYPE> {\r\n\treadonly opetype: OPETYPE;\r\n\r\n\tconstructor( type: EShapeActionValueType, condition: string, subtype: SUBTYPE, opetype: OPETYPE ) {\r\n\t\tsuper( type, condition, subtype );\r\n\t\tthis.opetype = opetype;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueOpetyped) &&\r\n\t\t\tthis.opetype === value.opetype\r\n\t\t);\r\n\t}\r\n\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeTransformMove } from \"./e-shape-action-runtime-transform-move\";\r\nimport { EShapeActionRuntimeTransformMoveAbsoluteX } from \"./e-shape-action-runtime-transform-move-absolute-x\";\r\nimport { EShapeActionRuntimeTransformMoveAbsoluteY } from \"./e-shape-action-runtime-transform-move-absolute-y\";\r\nimport {\r\n\tEShapeActionRuntimeTransformMoveForwardOrBackward\r\n} from \"./e-shape-action-runtime-transform-move-forward-or-backward\";\r\nimport { EShapeActionRuntimeTransformMoveLeftOrRight } from \"./e-shape-action-runtime-transform-move-left-or-right\";\r\nimport { EShapeActionRuntimeTransformMoveRelativeX } from \"./e-shape-action-runtime-transform-move-relative-x\";\r\nimport { EShapeActionRuntimeTransformMoveRelativeY } from \"./e-shape-action-runtime-transform-move-relative-y\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueOpetyped } from \"./e-shape-action-value-opetyped\";\r\nimport { EShapeActionValueTransformMoveType } from \"./e-shape-action-value-transform-move-type\";\r\nimport { EShapeActionValueTransformType } from \"./e-shape-action-value-transform-type\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueTransformMoveSerialized = [\r\n\tEShapeActionValueType.TRANSFORM, number, EShapeActionValueTransformType.MOVE,\r\n\tEShapeActionValueTransformMoveType, number\r\n];\r\n\r\nexport class EShapeActionValueTransformMove\r\n\textends EShapeActionValueOpetyped<EShapeActionValueTransformType, EShapeActionValueTransformMoveType> {\r\n\treadonly amount: string;\r\n\r\n\tconstructor( opetype: EShapeActionValueTransformMoveType, condition: string, amount: string ) {\r\n\t\tsuper( EShapeActionValueType.TRANSFORM, condition, EShapeActionValueTransformType.MOVE, opetype );\r\n\t\tthis.amount = amount;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueTransformMove) &&\r\n\t\t\tthis.amount === value.amount\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeTransformMove {\r\n\t\tswitch( this.opetype ) {\r\n\t\tcase EShapeActionValueTransformMoveType.ABSOLUTE_X:\r\n\t\t\treturn new EShapeActionRuntimeTransformMoveAbsoluteX( this );\r\n\t\tcase EShapeActionValueTransformMoveType.ABSOLUTE_Y:\r\n\t\t\treturn new EShapeActionRuntimeTransformMoveAbsoluteY( this );\r\n\t\tcase EShapeActionValueTransformMoveType.FORWARD_OR_BACKWARD:\r\n\t\t\treturn new EShapeActionRuntimeTransformMoveForwardOrBackward( this );\r\n\t\tcase EShapeActionValueTransformMoveType.LEFT_OR_RIGHT:\r\n\t\t\treturn new EShapeActionRuntimeTransformMoveLeftOrRight( this );\r\n\t\tcase EShapeActionValueTransformMoveType.RELATIVE_X:\r\n\t\t\treturn new EShapeActionRuntimeTransformMoveRelativeX( this );\r\n\t\tcase EShapeActionValueTransformMoveType.RELATIVE_Y:\r\n\t\t\treturn new EShapeActionRuntimeTransformMoveRelativeY( this );\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add(this.condition);\r\n\t\tconst amountId = manager.add(this.amount);\r\n\t\treturn manager.add(\r\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.opetype},${amountId}]`\r\n\t\t);\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueTransformMoveSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueTransformMove {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst amount = EShapeActionValues.toResource( 4, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueTransformMove( serialized[ 3 ], condition, amount );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueTransformResizeType {\r\n\tRELATIVE_SIZE,\r\n\tRELATIVE_HEIGHT,\r\n\tRELATIVE_WIDTH,\r\n\tABSOLUTE_SIZE,\r\n\tABSOLUTE_HEIGHT,\r\n\tABSOLUTE_WIDTH\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { EShape } from \"./e-shape\";\r\n\r\nexport class EShapeSizes {\r\n\tstatic toRounded( value: number ): number {\r\n\t\treturn Math.round( value * 100 ) / 100;\r\n\t}\r\n\r\n\tstatic toNormalized( size: number ): number {\r\n\t\tconst THRESHOLD = 0.001;\r\n\t\tif( Math.abs( size ) < THRESHOLD ) {\r\n\t\t\treturn ( size < 0 ? -THRESHOLD : +THRESHOLD );\r\n\t\t}\r\n\t\treturn EShapeSizes.toRounded( size );\r\n\t}\r\n\r\n\tstatic resize( shape: EShape, from: IPoint, to: IPoint, centerMode: boolean, isPerfect: boolean ): void {\r\n\t\tshape.disallowUploadedUpdate();\r\n\t\tconst position = shape.transform.position;\r\n\t\tif( centerMode ) {\r\n\t\t\tconst dx = Math.abs(to.x - from.x);\r\n\t\t\tconst dy = Math.abs(to.y - from.y);\r\n\t\t\tif (isPerfect) {\r\n\t\t\t\tconst hsize = Math.max(dx, dy);\r\n\t\t\t\tconst size = hsize + hsize;\r\n\t\t\t\tshape.size.set(\r\n\t\t\t\t\tEShapeSizes.toNormalized( size ),\r\n\t\t\t\t\tEShapeSizes.toNormalized( size )\r\n\t\t\t\t);\r\n\t\t\t\tposition.set(\r\n\t\t\t\t\tEShapeSizes.toRounded( from.x ),\r\n\t\t\t\t\tEShapeSizes.toRounded( from.y )\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tshape.size.set(\r\n\t\t\t\t\tEShapeSizes.toNormalized( dx + dx ),\r\n\t\t\t\t\tEShapeSizes.toNormalized( dy + dy )\r\n\t\t\t\t);\r\n\t\t\t\tposition.set(\r\n\t\t\t\t\tEShapeSizes.toRounded( from.x ),\r\n\t\t\t\t\tEShapeSizes.toRounded( from.y )\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( isPerfect ) {\r\n\t\t\t\tconst dx = to.x - from.x;\r\n\t\t\t\tconst dy = to.y - from.y;\r\n\t\t\t\tconst size = Math.max(Math.abs(dx), Math.abs(dy));\r\n\t\t\t\tconst x2 = from.x + (dx < 0 ? -size : +size);\r\n\t\t\t\tconst y2 = from.y + (dy < 0 ? -size : +size);\r\n\t\t\t\tconst hsize = size * 0.5;\r\n\t\t\t\tconst x = Math.min(from.x, x2) + hsize;\r\n\t\t\t\tconst y = Math.min(from.y, y2) + hsize;\r\n\t\t\t\tshape.size.set(\r\n\t\t\t\t\tEShapeSizes.toNormalized( size ),\r\n\t\t\t\t\tEShapeSizes.toNormalized( size )\r\n\t\t\t\t);\r\n\t\t\t\tposition.set(\r\n\t\t\t\t\tEShapeSizes.toRounded( x ),\r\n\t\t\t\t\tEShapeSizes.toRounded( y )\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tconst x0 = Math.min(from.x, to.x);\r\n\t\t\t\tconst y0 = Math.min(from.y, to.y);\r\n\t\t\t\tconst x1 = Math.max(from.x, to.x);\r\n\t\t\t\tconst y1 = Math.max(from.y, to.y);\r\n\t\t\t\tconst width = x1 - x0;\r\n\t\t\t\tconst height = y1 - y0;\r\n\t\t\t\tconst px = width * 0.5;\r\n\t\t\t\tconst py = height * 0.5;\r\n\t\t\t\tshape.size.set(\r\n\t\t\t\t\tEShapeSizes.toNormalized( width ),\r\n\t\t\t\t\tEShapeSizes.toNormalized( height )\r\n\t\t\t\t);\r\n\t\t\t\tposition.set(\r\n\t\t\t\t\tEShapeSizes.toRounded( x0 + px ),\r\n\t\t\t\t\tEShapeSizes.toRounded( y0 + py )\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\tshape.allowUploadedUpdate();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\r\nimport { EShapeActionValueTransformResizeType } from \"./e-shape-action-value-transform-resize-type\";\r\n\r\nconst sizeRelativeDefault = (): number => 1;\r\nconst sizeAbsoluteDefault = (): number => 100;\r\n\r\nexport class EShapeActionRuntimeTransformResize extends EShapeActionRuntimeConditional {\r\n\tprotected readonly size: EShapeActionExpression<number>;\r\n\r\n\tconstructor( value: EShapeActionValueTransformResize, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( value, reset );\r\n\t\tswitch( value.opetype ) {\r\n\t\tcase EShapeActionValueTransformResizeType.RELATIVE_SIZE:\r\n\t\t\tthis.size = this.toExpression( value.amount, sizeRelativeDefault, \"1\" );\r\n\t\t\tbreak;\r\n\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_SIZE:\r\n\t\t\tthis.size = this.toExpression( value.amount, sizeAbsoluteDefault, \"100\" );\r\n\t\t\tbreak;\r\n\t\tcase EShapeActionValueTransformResizeType.RELATIVE_HEIGHT:\r\n\t\t\tthis.size = this.toExpression( value.amount, sizeRelativeDefault, \"1\" );\r\n\t\t\tbreak;\r\n\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT:\r\n\t\t\tthis.size = this.toExpression( value.amount, sizeAbsoluteDefault, \"100\" );\r\n\t\t\tbreak;\r\n\t\tcase EShapeActionValueTransformResizeType.RELATIVE_WIDTH:\r\n\t\t\tthis.size = this.toExpression( value.amount, sizeRelativeDefault, \"1\" );\r\n\t\t\tbreak;\r\n\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH:\r\n\t\t\tthis.size = this.toExpression( value.amount, sizeAbsoluteDefault, \"100\" );\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthis.size = sizeRelativeDefault;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected adjustPosition(\r\n\t\tshape: EShape, runtime: EShapeRuntime,\r\n\t\tdsx: number, dsy: number,\r\n\t\toriginX: number, originY: number\r\n\t): void {\r\n\t\tconst dx = ( -0.5 + originX ) * dsx;\r\n\t\tconst dy = ( -0.5 + originY ) * dsy;\r\n\t\tshape.updateTransform();\r\n\t\tconst transform = shape.transform;\r\n\t\tconst position = transform.position;\r\n\t\tconst localTransform = transform.localTransform;\r\n\t\tconst writtenPositionX = ( (runtime.written & EShapeRuntimeReset.POSITION_X) !== 0 );\r\n\t\tconst writtenPositionY = ( (runtime.written & EShapeRuntimeReset.POSITION_Y) !== 0 );\r\n\t\tconst oldPositionX = ( writtenPositionX ? position.x : runtime.x );\r\n\t\tconst oldPositionY = ( writtenPositionY ? position.y : runtime.y );\r\n\t\truntime.written |= EShapeRuntimeReset.POSITION;\r\n\t\tposition.set(\r\n\t\t\toldPositionX + dx * localTransform.a + dy * localTransform.c,\r\n\t\t\toldPositionY + dx * localTransform.b + dy * localTransform.d\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeActionValueTransformRotateType {\r\n\tRELATIVE,\r\n\tABSOLUTE\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeSizes } from \"../e-shape-sizes\";\r\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\r\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\r\n\r\nexport class EShapeActionRuntimeTransformResizeHeightAbsolute extends EShapeActionRuntimeTransformResize {\r\n\tprotected origin: number;\r\n\r\n\tconstructor( value: EShapeActionValueTransformResize ) {\r\n\t\tsuper( value, EShapeRuntimeReset.HEIGHT );\r\n\t\tthis.origin = value.originY;\r\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst sizeAbsolute = this.size( shape, time );\r\n\t\t\tconst size = shape.size;\r\n\t\t\tconst writtenHeight = ( (runtime.written & EShapeRuntimeReset.HEIGHT) !== 0 );\r\n\t\t\tconst oldSizeY = (writtenHeight ? size.y : runtime.size.y);\r\n\t\t\tsize.y = EShapeSizes.toNormalized( sizeAbsolute );\r\n\t\t\truntime.written |= EShapeRuntimeReset.HEIGHT;\r\n\t\t\tthis.adjustPosition(\r\n\t\t\t\tshape, runtime,\r\n\t\t\t\t0, oldSizeY - size.y,\r\n\t\t\t\t0.5, this.origin\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeSizes } from \"../e-shape-sizes\";\r\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\r\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\r\n\r\nexport class EShapeActionRuntimeTransformResizeHeightRelative extends EShapeActionRuntimeTransformResize {\r\n\tprotected origin: number;\r\n\r\n\tconstructor( value: EShapeActionValueTransformResize ) {\r\n\t\tsuper( value, EShapeRuntimeReset.HEIGHT );\r\n\t\tthis.origin = value.originY;\r\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst sizeRelative = this.size( shape, time );\r\n\t\t\tconst size = shape.size;\r\n\t\t\tconst writtenHeight = ( (runtime.written & EShapeRuntimeReset.HEIGHT) !== 0 );\r\n\t\t\tconst oldSizeY = (writtenHeight ? size.y : runtime.size.y);\r\n\t\t\tsize.y = EShapeSizes.toNormalized( oldSizeY * sizeRelative );\r\n\t\t\truntime.written |= EShapeRuntimeReset.HEIGHT;\r\n\t\t\tthis.adjustPosition(\r\n\t\t\t\tshape, runtime,\r\n\t\t\t\t0, oldSizeY - size.y,\r\n\t\t\t\t0.5, this.origin\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeSizes } from \"../e-shape-sizes\";\r\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\r\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\r\n\r\nexport class EShapeActionRuntimeTransformResizeSizeAbsolute extends EShapeActionRuntimeTransformResize {\r\n\tprotected originX: number;\r\n\tprotected originY: number;\r\n\r\n\tconstructor( value: EShapeActionValueTransformResize ) {\r\n\t\tsuper( value, EShapeRuntimeReset.SIZE );\r\n\t\tthis.originX = value.originX;\r\n\t\tthis.originY = value.originY;\r\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst sizeAbsolute = EShapeSizes.toNormalized( this.size( shape, time ) );\r\n\t\t\tconst size = shape.size;\r\n\t\t\tconst writtenWidth = ( (runtime.written & EShapeRuntimeReset.WIDTH) !== 0 );\r\n\t\t\tconst writtenHeight = ( (runtime.written & EShapeRuntimeReset.HEIGHT) !== 0 );\r\n\t\t\tconst oldSizeX = (writtenWidth ? size.x : runtime.size.x);\r\n\t\t\tconst oldSizeY = (writtenHeight ? size.y : runtime.size.y);\r\n\t\t\tsize.set( sizeAbsolute, sizeAbsolute );\r\n\t\t\truntime.written |= EShapeRuntimeReset.SIZE;\r\n\t\t\tthis.adjustPosition(\r\n\t\t\t\tshape, runtime,\r\n\t\t\t\toldSizeX - size.x, oldSizeY - size.y,\r\n\t\t\t\tthis.originX, this.originY\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeSizes } from \"../e-shape-sizes\";\r\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\r\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\r\n\r\nexport class EShapeActionRuntimeTransformResizeSizeRelative extends EShapeActionRuntimeTransformResize {\r\n\tprotected originX: number;\r\n\tprotected originY: number;\r\n\r\n\tconstructor( value: EShapeActionValueTransformResize ) {\r\n\t\tsuper( value, EShapeRuntimeReset.SIZE );\r\n\t\tthis.originX = value.originX;\r\n\t\tthis.originY = value.originY;\r\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst sizeRelative = this.size( shape, time );\r\n\t\t\tconst size = shape.size;\r\n\t\t\tconst writtenWidth = ( (runtime.written & EShapeRuntimeReset.WIDTH) !== 0 );\r\n\t\t\tconst writtenHeight = ( (runtime.written & EShapeRuntimeReset.HEIGHT) !== 0 );\r\n\t\t\tconst oldSizeX = (writtenWidth ? size.x : runtime.size.x);\r\n\t\t\tconst oldSizeY = (writtenHeight ? size.y : runtime.size.y);\r\n\t\t\tsize.set(\r\n\t\t\t\tEShapeSizes.toNormalized( oldSizeX * sizeRelative ),\r\n\t\t\t\tEShapeSizes.toNormalized( oldSizeY * sizeRelative )\r\n\t\t\t);\r\n\t\t\truntime.written |= EShapeRuntimeReset.SIZE;\r\n\t\t\tthis.adjustPosition(\r\n\t\t\t\tshape, runtime,\r\n\t\t\t\toldSizeX - size.x, oldSizeY - size.y,\r\n\t\t\t\tthis.originX, this.originY\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeSizes } from \"../e-shape-sizes\";\r\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\r\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\r\n\r\nexport class EShapeActionRuntimeTransformResizeWidthAbsolute extends EShapeActionRuntimeTransformResize {\r\n\tprotected origin: number;\r\n\r\n\tconstructor( value: EShapeActionValueTransformResize ) {\r\n\t\tsuper( value, EShapeRuntimeReset.WIDTH );\r\n\t\tthis.origin = value.originX;\r\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst sizeAbsolute = this.size( shape, time );\r\n\t\t\tconst size = shape.size;\r\n\t\t\tconst writtenWidth = ( (runtime.written & EShapeRuntimeReset.WIDTH) !== 0 );\r\n\t\t\tconst oldSizeX = (writtenWidth ? size.x : runtime.size.x);\r\n\t\t\tsize.x = EShapeSizes.toNormalized( sizeAbsolute );\r\n\t\t\truntime.written |= EShapeRuntimeReset.WIDTH;\r\n\t\t\tthis.adjustPosition(\r\n\t\t\t\tshape, runtime,\r\n\t\t\t\toldSizeX - size.x, 0,\r\n\t\t\t\tthis.origin, 0.5\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeSizes } from \"../e-shape-sizes\";\r\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\r\nimport { EShapeActionValueTransformResize } from \"./e-shape-action-value-transform-resize\";\r\n\r\nexport class EShapeActionRuntimeTransformResizeWidthRelative extends EShapeActionRuntimeTransformResize {\r\n\tprotected origin: number;\r\n\r\n\tconstructor( value: EShapeActionValueTransformResize ) {\r\n\t\tsuper( value, EShapeRuntimeReset.WIDTH );\r\n\t\tthis.origin = value.originX;\r\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst sizeRelative = this.size( shape, time );\r\n\t\t\tconst size = shape.size;\r\n\t\t\tconst writtenWidth = ( (runtime.written & EShapeRuntimeReset.WIDTH) !== 0 );\r\n\t\t\tconst oldSizeX = ( writtenWidth ? size.x : runtime.size.x );\r\n\t\t\tsize.x = EShapeSizes.toNormalized( oldSizeX * sizeRelative );\r\n\t\t\truntime.written |= EShapeRuntimeReset.WIDTH;\r\n\t\t\tthis.adjustPosition(\r\n\t\t\t\tshape, runtime,\r\n\t\t\t\toldSizeX - size.x, 0,\r\n\t\t\t\tthis.origin, 0.5\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeTransformResize } from \"./e-shape-action-runtime-transform-resize\";\r\nimport {\r\n\tEShapeActionRuntimeTransformResizeHeightAbsolute\r\n} from \"./e-shape-action-runtime-transform-resize-height-absolute\";\r\nimport {\r\n\tEShapeActionRuntimeTransformResizeHeightRelative\r\n} from \"./e-shape-action-runtime-transform-resize-height-relative\";\r\nimport {\r\n\tEShapeActionRuntimeTransformResizeSizeAbsolute\r\n} from \"./e-shape-action-runtime-transform-resize-size-absolute\";\r\nimport {\r\n\tEShapeActionRuntimeTransformResizeSizeRelative\r\n} from \"./e-shape-action-runtime-transform-resize-size-relative\";\r\nimport {\r\n\tEShapeActionRuntimeTransformResizeWidthAbsolute\r\n} from \"./e-shape-action-runtime-transform-resize-width-absolute\";\r\nimport {\r\n\tEShapeActionRuntimeTransformResizeWidthRelative\r\n} from \"./e-shape-action-runtime-transform-resize-width-relative\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueOpetyped } from \"./e-shape-action-value-opetyped\";\r\nimport { EShapeActionValueTransformResizeType } from \"./e-shape-action-value-transform-resize-type\";\r\nimport { EShapeActionValueTransformType } from \"./e-shape-action-value-transform-type\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueTransformResizeSerialized = [\r\n\tEShapeActionValueType.TRANSFORM, number, EShapeActionValueTransformType.RESIZE,\r\n\tEShapeActionValueTransformResizeType,\r\n\tnumber, number, number\r\n];\r\n\r\nexport class EShapeActionValueTransformResize\r\n\textends EShapeActionValueOpetyped<EShapeActionValueTransformType, EShapeActionValueTransformResizeType> {\r\n\treadonly originX: number;\r\n\treadonly originY: number;\r\n\treadonly amount: string;\r\n\r\n\tconstructor(\r\n\t\topetype: EShapeActionValueTransformResizeType,\r\n\t\tcondition: string,\r\n\t\toriginX: number, originY: number,\r\n\t\tamount: string\r\n\t) {\r\n\t\tsuper( EShapeActionValueType.TRANSFORM, condition, EShapeActionValueTransformType.RESIZE, opetype );\r\n\t\tthis.originX = originX;\r\n\t\tthis.originY = originY;\r\n\t\tthis.amount = amount;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueTransformResize) &&\r\n\t\t\tthis.originX === value.originX &&\r\n\t\t\tthis.originY === value.originY &&\r\n\t\t\tthis.amount === value.amount\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeTransformResize {\r\n\t\tswitch( this.opetype ) {\r\n\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_HEIGHT:\r\n\t\t\treturn new EShapeActionRuntimeTransformResizeHeightAbsolute( this );\r\n\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_WIDTH:\r\n\t\t\treturn new EShapeActionRuntimeTransformResizeWidthAbsolute( this );\r\n\t\tcase EShapeActionValueTransformResizeType.ABSOLUTE_SIZE:\r\n\t\t\treturn new EShapeActionRuntimeTransformResizeSizeAbsolute( this );\r\n\t\tcase EShapeActionValueTransformResizeType.RELATIVE_HEIGHT:\r\n\t\t\treturn new EShapeActionRuntimeTransformResizeHeightRelative( this );\r\n\t\tcase EShapeActionValueTransformResizeType.RELATIVE_WIDTH:\r\n\t\t\treturn new EShapeActionRuntimeTransformResizeWidthRelative( this );\r\n\t\tcase EShapeActionValueTransformResizeType.RELATIVE_SIZE:\r\n\t\t\treturn new EShapeActionRuntimeTransformResizeSizeRelative( this );\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add( this.condition );\r\n\t\tconst amountId = manager.add( this.amount );\r\n\t\treturn manager.add(\r\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.opetype},${this.originX},${this.originY},${amountId}]`\r\n\t\t);\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueTransformResizeSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueTransformResize {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst amount = EShapeActionValues.toResource( 6, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueTransformResize(\r\n\t\t\tserialized[ 3 ], condition,\r\n\t\t\tserialized[ 4 ], serialized[ 5 ], amount\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionExpression } from \"./e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeConditional } from \"./e-shape-action-runtime-conditional\";\r\nimport { EShapeActionValueTransformRotate } from \"./e-shape-action-value-transform-rotate\";\r\n\r\nconst amountDefault = (): number => 0;\r\n\r\nexport class EShapeActionRuntimeTransformRotate extends EShapeActionRuntimeConditional {\r\n\tprotected originY: number;\r\n\tprotected originX: number;\r\n\tprotected readonly amount: EShapeActionExpression<number>;\r\n\r\n\tconstructor( value: EShapeActionValueTransformRotate, reset: EShapeRuntimeReset ) {\r\n\t\tsuper( value, reset );\r\n\t\tthis.originX = value.originX;\r\n\t\tthis.originY = value.originY;\r\n\t\tthis.amount = this.toExpression( `(${value.amount}) * (Math.PI / 180)`, amountDefault, \"0\" );\r\n\t}\r\n\r\n\tprotected adjustPosition(\r\n\t\tshape: EShape, runtime: EShapeRuntime,\r\n\t\toldRotation: number, newRotation: number,\r\n\t\toriginX: number, originY: number\r\n\t): void {\r\n\t\tconst writtenWidth = ( (runtime.written & EShapeRuntimeReset.WIDTH) !== 0 );\r\n\t\tconst writtenHeight = ( (runtime.written & EShapeRuntimeReset.HEIGHT) !== 0 );\r\n\t\tconst dx = (-0.5 + originX) * (writtenWidth ? shape.size.x : runtime.size.x);\r\n\t\tconst dy = (-0.5 + originY) * (writtenHeight ? shape.size.y : runtime.size.y);\r\n\t\tconst s = Math.sin( oldRotation ) - Math.sin( newRotation );\r\n\t\tconst c = Math.cos( oldRotation ) - Math.cos( newRotation );\r\n\t\tconst position = shape.transform.position;\r\n\t\tconst writtenPositionX = ( (runtime.written & EShapeRuntimeReset.POSITION_X) !== 0 );\r\n\t\tconst writtenPositionY = ( (runtime.written & EShapeRuntimeReset.POSITION_Y) !== 0 );\r\n\t\tconst oldPositionX = ( writtenPositionX ? position.x : runtime.x );\r\n\t\tconst oldPositionY = ( writtenPositionY ? position.y : runtime.y );\r\n\t\truntime.written |= EShapeRuntimeReset.POSITION;\r\n\t\tposition.set(\r\n\t\t\toldPositionX + dx * c - dy * s,\r\n\t\t\toldPositionY + dx * s + dy * c\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeTransformRotate } from \"./e-shape-action-runtime-transform-rotate\";\r\nimport { EShapeActionValueTransformRotate } from \"./e-shape-action-value-transform-rotate\";\r\n\r\nexport class EShapeActionRuntimeTransformRotateAbsolute extends EShapeActionRuntimeTransformRotate {\r\n\tconstructor( value: EShapeActionValueTransformRotate ) {\r\n\t\tsuper( value, EShapeRuntimeReset.ROTATION );\r\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst amount = this.amount( shape, time );\r\n\t\t\tconst transform = shape.transform;\r\n\t\t\tconst writtenRotation = ( (runtime.written & EShapeRuntimeReset.ROTATION) !== 0 );\r\n\t\t\tconst oldRotation = (writtenRotation ? transform.rotation : runtime.rotation);\r\n\t\t\ttransform.rotation = amount;\r\n\t\t\truntime.written |= EShapeRuntimeReset.ROTATION;\r\n\t\t\tthis.adjustPosition(\r\n\t\t\t\tshape, runtime,\r\n\t\t\t\toldRotation, amount,\r\n\t\t\t\tthis.originX, this.originY\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeRuntime, EShapeRuntimeReset } from \"../e-shape-runtime\";\r\nimport { EShapeActionRuntimeTransformRotate } from \"./e-shape-action-runtime-transform-rotate\";\r\nimport { EShapeActionValueTransformRotate } from \"./e-shape-action-value-transform-rotate\";\r\n\r\nexport class EShapeActionRuntimeTransformRotateRelative extends EShapeActionRuntimeTransformRotate {\r\n\tconstructor( value: EShapeActionValueTransformRotate ) {\r\n\t\tsuper( value, EShapeRuntimeReset.ROTATION );\r\n\t\tthis.reset |= EShapeRuntimeReset.POSITION;\r\n\t}\r\n\r\n\texecute( shape: EShape, runtime: EShapeRuntime, time: number ): void {\r\n\t\tif( !! this.condition( shape, time ) ) {\r\n\t\t\tconst amount = this.amount( shape, time );\r\n\t\t\tconst transform = shape.transform;\r\n\t\t\tconst writtenRotation = ( (runtime.written & EShapeRuntimeReset.ROTATION) !== 0 );\r\n\t\t\tconst oldRotation = (writtenRotation ? transform.rotation : runtime.rotation);\r\n\t\t\ttransform.rotation = oldRotation + amount;\r\n\t\t\truntime.written |= EShapeRuntimeReset.ROTATION;\r\n\t\t\tthis.adjustPosition(\r\n\t\t\t\tshape, runtime,\r\n\t\t\t\toldRotation, transform.rotation,\r\n\t\t\t\tthis.originX, this.originY\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeActionRuntimeTransformRotate } from \"./e-shape-action-runtime-transform-rotate\";\r\nimport { EShapeActionRuntimeTransformRotateAbsolute } from \"./e-shape-action-runtime-transform-rotate-absolute\";\r\nimport { EShapeActionRuntimeTransformRotateRelative } from \"./e-shape-action-runtime-transform-rotate-relative\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueOpetyped } from \"./e-shape-action-value-opetyped\";\r\nimport { EShapeActionValueTransformRotateType } from \"./e-shape-action-value-transform-rotate-type\";\r\nimport { EShapeActionValueTransformType } from \"./e-shape-action-value-transform-type\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\nimport { EShapeActionValues } from \"./e-shape-action-values\";\r\n\r\nexport type EShapeActionValueTransformRotateSerialized = [\r\n\tEShapeActionValueType.TRANSFORM, number, EShapeActionValueTransformType.ROTATE,\r\n\tEShapeActionValueTransformRotateType,\r\n\tnumber, number, number\r\n];\r\n\r\nexport class EShapeActionValueTransformRotate\r\n\textends EShapeActionValueOpetyped<EShapeActionValueTransformType, EShapeActionValueTransformRotateType> {\r\n\treadonly originX: number;\r\n\treadonly originY: number;\r\n\treadonly amount: string;\r\n\r\n\tconstructor(\r\n\t\topetype: EShapeActionValueTransformRotateType, condition: string,\r\n\t\toriginX: number, originY: number, amount: string\r\n\t) {\r\n\t\tsuper( EShapeActionValueType.TRANSFORM, condition, EShapeActionValueTransformType.ROTATE, opetype );\r\n\t\tthis.originX = originX;\r\n\t\tthis.originY = originY;\r\n\t\tthis.amount = amount;\r\n\t}\r\n\r\n\tisEquals( value: EShapeActionValue ): boolean {\r\n\t\treturn (\r\n\t\t\tsuper.isEquals( value ) &&\r\n\t\t\t(value instanceof EShapeActionValueTransformRotate) &&\r\n\t\t\tthis.originX === value.originX &&\r\n\t\t\tthis.originY === value.originY &&\r\n\t\t\tthis.amount === value.amount\r\n\t\t);\r\n\t}\r\n\r\n\ttoRuntime(): EShapeActionRuntimeTransformRotate {\r\n\t\tswitch( this.opetype ) {\r\n\t\tcase EShapeActionValueTransformRotateType.ABSOLUTE:\r\n\t\t\treturn new EShapeActionRuntimeTransformRotateAbsolute( this );\r\n\t\tcase EShapeActionValueTransformRotateType.RELATIVE:\r\n\t\t\treturn new EShapeActionRuntimeTransformRotateRelative( this );\r\n\t\t}\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst conditionId = manager.add( this.condition );\r\n\t\tconst amountId = manager.add( this.amount );\r\n\t\treturn manager.add(\r\n\t\t\t`[${this.type},${conditionId},${this.subtype},${this.opetype},${this.originX},${this.originY},${amountId}]`\r\n\t\t);\r\n\t}\r\n\r\n\tstatic deserialize(\r\n\t\tserialized: EShapeActionValueTransformRotateSerialized,\r\n\t\tmanager: EShapeResourceManagerDeserialization\r\n\t): EShapeActionValueTransformRotate {\r\n\t\tconst condition = EShapeActionValues.toResource( 1, serialized, manager.resources );\r\n\t\tconst amount = EShapeActionValues.toResource( 6, serialized, manager.resources );\r\n\t\treturn new EShapeActionValueTransformRotate(\r\n\t\t\tserialized[ 3 ], condition,\r\n\t\t\tserialized[ 4 ], serialized[ 5 ], amount\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { isArray } from \"../../util/is-array\";\r\nimport { isNumber } from \"../../util/is-number\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeActionValue } from \"./e-shape-action-value\";\r\nimport { EShapeActionValueBlink, EShapeActionValueBlinkSerialized } from \"./e-shape-action-value-blink\";\r\nimport {\r\n\tEShapeActionValueChangeColor, EShapeActionValueChangeColorSerialized } from \"./e-shape-action-value-change-color\";\r\nimport {\r\n\tEShapeActionValueChangeColorBrightness, EShapeActionValueChangeColorBrightnessSerialized\r\n} from \"./e-shape-action-value-change-color-brightness\";\r\nimport {\r\n\tEShapeActionValueChangeColorCode, EShapeActionValueChangeColorCodeSerialized\r\n} from \"./e-shape-action-value-change-color-code\";\r\nimport { EShapeActionValueChangeColorTarget } from \"./e-shape-action-value-change-color-target\";\r\nimport {\r\n\tEShapeActionValueChangeCursor, EShapeActionValueChangeCursorSerialized } from \"./e-shape-action-value-change-cursor\";\r\nimport { EShapeActionValueChangeText, EShapeActionValueChangeTextSerialized } from \"./e-shape-action-value-change-text\";\r\nimport { EShapeActionValueEmitEvent, EShapeActionValueEmitEventSerialized } from \"./e-shape-action-value-emit-event\";\r\nimport { EShapeActionValueMisc, EShapeActionValueMiscSerialized } from \"./e-shape-action-value-misc\";\r\nimport { EShapeActionValueOpen, EShapeActionValueOpenSerialized } from \"./e-shape-action-value-open\";\r\nimport { EShapeActionValueShowHide, EShapeActionValueShowHideSerialized } from \"./e-shape-action-value-show-hide\";\r\nimport {\r\n\tEShapeActionValueShowHideType\r\n} from \"./e-shape-action-value-show-hide-type\";\r\nimport {\r\n\tEShapeActionValueTransformMove, EShapeActionValueTransformMoveSerialized\r\n} from \"./e-shape-action-value-transform-move\";\r\nimport {\r\n\tEShapeActionValueTransformResize, EShapeActionValueTransformResizeSerialized\r\n} from \"./e-shape-action-value-transform-resize\";\r\nimport {\r\n\tEShapeActionValueTransformRotate, EShapeActionValueTransformRotateSerialized\r\n} from \"./e-shape-action-value-transform-rotate\";\r\nimport { EShapeActionValueTransformType } from \"./e-shape-action-value-transform-type\";\r\nimport { EShapeActionValueType } from \"./e-shape-action-value-type\";\r\n\r\nexport type EShapeActionValueSerialized = EShapeActionValueShowHideSerialized |\r\n\tEShapeActionValueBlinkSerialized | EShapeActionValueBlinkSerialized |\r\n\tEShapeActionValueChangeColorSerialized | EShapeActionValueChangeColorCodeSerialized |\r\n\tEShapeActionValueChangeColorBrightnessSerialized | EShapeActionValueChangeTextSerialized |\r\n\tEShapeActionValueChangeCursorSerialized | EShapeActionValueEmitEventSerialized |\r\n\tEShapeActionValueOpenSerialized | EShapeActionValueTransformMoveSerialized |\r\n\tEShapeActionValueTransformResizeSerialized | EShapeActionValueTransformRotateSerialized |\r\n\tEShapeActionValueMiscSerialized;\r\n\r\nexport class EShapeActionValueDeserializer {\r\n\tstatic toSerialized( resource: string ): EShapeActionValueSerialized | null {\r\n\t\ttry {\r\n\t\t\tconst parsed = JSON.parse( resource );\r\n\t\t\tif( isArray( parsed ) ) {\r\n\t\t\t\tfor( let i = 0, imax = parsed.length; i < imax; ++i ) {\r\n\t\t\t\t\tif( ! isNumber( parsed[ i ] ) ) {\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif( 2 <= parsed.length ) {\r\n\t\t\t\t\treturn parsed as EShapeActionValueSerialized;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t} catch( e ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic deserialize( id: number, manager: EShapeResourceManagerDeserialization ): EShapeActionValue {\r\n\t\tconst actions = manager.actions;\r\n\t\tconst action = actions.get( id );\r\n\t\tif( action != null ) {\r\n\t\t\treturn action;\r\n\t\t}\r\n\r\n\t\tconst resources = manager.resources;\r\n\t\tconst resource = resources[ id ];\r\n\t\tif( resource != null ) {\r\n\t\t\tconst serialized = this.toSerialized( resource );\r\n\t\t\tif( serialized != null ) {\r\n\t\t\t\tswitch( serialized[ 0 ] ) {\r\n\t\t\t\tcase EShapeActionValueType.SHOW_HIDE:\r\n\t\t\t\t\treturn EShapeActionValueShowHide.deserialize( serialized, manager );\r\n\t\t\t\tcase EShapeActionValueType.BLINK:\r\n\t\t\t\t\treturn EShapeActionValueBlink.deserialize( serialized, manager );\r\n\t\t\t\tcase EShapeActionValueType.CHANGE_COLOR:\r\n\t\t\t\t\tswitch( serialized[ 3 ] ) {\r\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.COLOR_AND_ALPHA:\r\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.COLOR:\r\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.ALPHA:\r\n\t\t\t\t\t\t\treturn EShapeActionValueChangeColor.deserialize( serialized, manager );\r\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.CODE:\r\n\t\t\t\t\t\t\treturn EShapeActionValueChangeColorCode.deserialize( serialized, manager );\r\n\t\t\t\t\t\tcase EShapeActionValueChangeColorTarget.BRIGHTNESS:\r\n\t\t\t\t\t\t\treturn EShapeActionValueChangeColorBrightness.deserialize( serialized, manager );\r\n\t\t\t\t\t}\r\n\t\t\t\tcase EShapeActionValueType.CHANGE_TEXT:\r\n\t\t\t\t\treturn EShapeActionValueChangeText.deserialize( serialized, manager );\r\n\t\t\t\tcase EShapeActionValueType.CHANGE_CURSOR:\r\n\t\t\t\t\treturn EShapeActionValueChangeCursor.deserialize( serialized, manager );\r\n\t\t\t\tcase EShapeActionValueType.EMIT_EVENT:\r\n\t\t\t\t\treturn EShapeActionValueEmitEvent.deserialize( serialized, manager );\r\n\t\t\t\tcase EShapeActionValueType.OPEN:\r\n\t\t\t\t\treturn EShapeActionValueOpen.deserialize( serialized, manager );\r\n\t\t\t\tcase EShapeActionValueType.TRANSFORM:\r\n\t\t\t\t\tswitch( serialized[ 2 ] ) {\r\n\t\t\t\t\tcase EShapeActionValueTransformType.MOVE:\r\n\t\t\t\t\t\treturn EShapeActionValueTransformMove.deserialize( serialized, manager );\r\n\t\t\t\t\tcase EShapeActionValueTransformType.RESIZE:\r\n\t\t\t\t\t\treturn EShapeActionValueTransformResize.deserialize( serialized, manager );\r\n\t\t\t\t\tcase EShapeActionValueTransformType.ROTATE:\r\n\t\t\t\t\t\treturn EShapeActionValueTransformRotate.deserialize( serialized, manager );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase EShapeActionValueType.MISC:\r\n\t\t\t\t\treturn EShapeActionValueMisc.deserialize( serialized, manager );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn new EShapeActionValueShowHide( EShapeActionValueShowHideType.SHOW, \"\" );\r\n\t}\r\n}\r\n","\r\nexport class EShapeImageElements {\r\n\tstatic imageElements: { [ src: string ]: Promise<HTMLImageElement> | HTMLImageElement | undefined } = {};\r\n\r\n\tstatic toImageElement( dataUrl: string ): Promise<HTMLImageElement> {\r\n\t\tconst imageElements = EShapeImageElements.imageElements;\r\n\t\tconst cachedImageElement = imageElements[ dataUrl ];\r\n\t\tif( cachedImageElement != null ) {\r\n\t\t\tif( cachedImageElement instanceof HTMLImageElement ) {\r\n\t\t\t\treturn Promise.resolve( cachedImageElement );\r\n\t\t\t} else {\r\n\t\t\t\treturn cachedImageElement;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst result = new Promise<HTMLImageElement>(( resolve, reject ): void => {\r\n\t\t\t\tconst imageElement = document.createElement( \"img\" );\r\n\t\t\t\timageElement.onload = () => {\r\n\t\t\t\t\timageElements[ dataUrl ] = imageElement;\r\n\t\t\t\t\tresolve( imageElement );\r\n\t\t\t\t};\r\n\t\t\t\timageElement.onabort = imageElement.onerror = () => {\r\n\t\t\t\t\treject();\r\n\t\t\t\t};\r\n\t\t\t\timageElement.src = dataUrl;\r\n\t\t\t});\r\n\t\t\timageElements[ dataUrl ] = result;\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {\r\n\tDDiagramSerializedFill, DDiagramSerializedStroke, DDiagramSerializedTagRange, DDiagramSerializedTagValue,\r\n\tDDiagramSerializedText, DDiagramSerializedTextOutline\r\n} from \"../d-diagram-serialized\";\r\nimport { EShapeActionValue } from \"./action/e-shape-action-value\";\r\n\r\nexport class EShapeResourceManagerDeserialization {\r\n\tresources: string[];\r\n\tactions: Map<number, EShapeActionValue>;\r\n\tfills: Map<number, DDiagramSerializedFill>;\r\n\tstrokes: Map<number, DDiagramSerializedStroke>;\r\n\ttagValues: Map<number, DDiagramSerializedTagValue>;\r\n\ttags: Map<number, number[]>;\r\n\tranges: Map<number, DDiagramSerializedTagRange>;\r\n\taligns: Map<number, [ number, number ]>;\r\n\tmargins: Map<number, [ number, number ]>;\r\n\ttexts: Map<number, DDiagramSerializedText>;\r\n\ttextOutlines: Map<number, DDiagramSerializedTextOutline>;\r\n\textensions: Map<number, unknown>;\r\n\r\n\tconstructor( resources: string[] ) {\r\n\t\tthis.resources = resources;\r\n\t\tthis.actions = new Map<number, EShapeActionValue>();\r\n\t\tthis.fills = new Map<number, DDiagramSerializedFill>();\r\n\t\tthis.strokes = new Map<number, DDiagramSerializedStroke>();\r\n\t\tthis.tags = new Map<number, number[]>();\r\n\t\tthis.tagValues = new Map<number, DDiagramSerializedTagValue>();\r\n\t\tthis.ranges = new Map<number, DDiagramSerializedTagRange>();\r\n\t\tthis.aligns = new Map<number, [ number, number ]>();\r\n\t\tthis.margins = new Map<number, [ number, number ]>();\r\n\t\tthis.texts = new Map<number, DDiagramSerializedText>();\r\n\t\tthis.textOutlines = new Map<number, DDiagramSerializedTextOutline>();\r\n\t\tthis.extensions = new Map<number, unknown>();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../d-diagram-serialized\";\r\nimport { isString } from \"../util/is-string\";\r\nimport { EShapeActionValueDeserializer } from \"./action/e-shape-action-value-deserializer\";\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeDeserializers } from \"./e-shape-deserializers\";\r\nimport { EShapeImageElements } from \"./e-shape-image-elements\";\r\nimport { EShapeResourceManagerDeserialization } from \"./e-shape-resource-manager-deserialization\";\r\nimport { EShapeSizes } from \"./e-shape-sizes\";\r\nimport { EShapeGradients } from \"./variant/e-shape-gradients\";\r\n\r\nexport class EShapeDeserializer {\r\n\tstatic toShape(\r\n\t\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n\t): Promise<EShape> | EShape | null {\r\n\t\tconst shapeDeserializer = EShapeDeserializers[ item[ 0 ] ];\r\n\t\tif( shapeDeserializer != null ) {\r\n\t\t\treturn shapeDeserializer( item, manager );\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic deserialize<SHAPE extends EShape>(\r\n\t\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization, result: SHAPE\r\n\t): Promise<SHAPE> | SHAPE {\r\n\t\tresult.id = manager.resources[ item[ 1 ] ] || \"\";\r\n\t\tresult.transform.position.set( item[ 2 ], item[ 3 ] );\r\n\t\tresult.transform.rotation = item[ 6 ];\r\n\t\tresult.transform.skew.set( item[ 7 ], item[ 7 ] );\r\n\t\tresult.transform.pivot.set( item[ 21 ], item[ 22 ] );\r\n\t\tresult.size.set( EShapeSizes.toNormalized( item[ 4 ] ), EShapeSizes.toNormalized( item[ 5 ] ) );\r\n\t\tresult.fill.deserialize( item[ 8 ], manager );\r\n\t\tresult.stroke.deserialize( item[ 9 ], manager );\r\n\t\tresult.cursor = manager.resources[ item[ 10 ] ] || \"\";\r\n\t\tresult.text.deserialize( item[ 11 ], manager );\r\n\t\tresult.tag.deserialize( item[ 12 ], manager );\r\n\t\tresult.radius = item[ 13 ];\r\n\t\tresult.corner = item[ 14 ];\r\n\t\tresult.interactive = !! ( item[ 23 ] & 1 );\r\n\t\tresult.unfocusable = !! ( item[ 23 ] & 2 );\r\n\t\tresult.shortcut = ( 0 <= item[ 24 ] ? manager.resources[ item[ 24 ] ] : undefined );\r\n\t\tresult.title = ( 0 <= item[ 25 ] ? manager.resources[ item[ 25 ] ] : undefined );\r\n\r\n\t\t// Children\r\n\t\tlet childrenPromise: Promise<SHAPE> | null = null;\r\n\t\tconst childrenSerialized = item[ 20 ];\r\n\t\tif( 0 < childrenSerialized.length ) {\r\n\t\t\tconst childrenOrPromises = [];\r\n\t\t\tfor( let i = 0, imax = childrenSerialized.length; i < imax; ++i ) {\r\n\t\t\t\tconst childSerialized = childrenSerialized[ i ];\r\n\t\t\t\tconst childOrPromise = EShapeDeserializer.toShape( childSerialized, manager );\r\n\t\t\t\tif( childOrPromise != null ) {\r\n\t\t\t\t\tchildrenOrPromises.push( childOrPromise );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tchildrenPromise = Promise.all( childrenOrPromises ).then(( children: EShape[] ) => {\r\n\t\t\t\tresult.children = children;\r\n\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\t\tchildren[ i ].parent = result;\r\n\t\t\t\t}\r\n\t\t\t\tresult.onChildTransformChange();\r\n\t\t\t\tresult.toDirty();\r\n\t\t\t\treturn result;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Action\r\n\t\tconst serializedActions = item[ 17 ];\r\n\t\tfor( let i = 0, imax = serializedActions.length; i < imax; ++i ) {\r\n\t\t\tresult.action.add( EShapeActionValueDeserializer.deserialize( serializedActions[ i ], manager ) );\r\n\t\t}\r\n\r\n\t\t// Gradient\r\n\t\tconst gradientId = item[ 19 ];\r\n\t\tif( 0 <= gradientId && gradientId < manager.resources.length ) {\r\n\t\t\tconst gradient = manager.resources[ gradientId ];\r\n\t\t\tif( isString( gradient ) ) {\r\n\t\t\t\tresult.gradient = EShapeGradients.deserializeGradient( gradient );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Image\r\n\t\tlet imagePromise: Promise<SHAPE> | null = null;\r\n\t\tconst imageId = item[ 18 ];\r\n\t\tif( 0 <= imageId && imageId < manager.resources.length ) {\r\n\t\t\tconst imageSrc = manager.resources[ imageId ];\r\n\t\t\tif( isString( imageSrc ) ) {\r\n\t\t\t\timagePromise = EShapeImageElements.toImageElement( imageSrc ).then(( imageElement ) => {\r\n\t\t\t\t\tresult.image = imageElement;\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tif( childrenPromise != null ) {\r\n\t\t\tif( imagePromise != null ) {\r\n\t\t\t\treturn Promise.all([ childrenPromise, imagePromise ]).then(() => {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn childrenPromise;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( imagePromise != null ) {\r\n\t\t\t\treturn imagePromise;\r\n\t\t\t} else {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstatic deserializeAll( serializeds: DDiagramSerializedItem[], resources: string[] ): Promise<EShape[]> | null {\r\n\t\tconst manager = new EShapeResourceManagerDeserialization( resources );\r\n\t\tconst shapes: Array<Promise<EShape> | EShape> = [];\r\n\t\tfor( let i = 0, imax = serializeds.length; i < imax; ++i ) {\r\n\t\t\tconst serialized = serializeds[ i ];\r\n\t\t\tconst shape = EShapeDeserializer.toShape( serialized, manager );\r\n\t\t\tif( shape == null ) {\r\n\t\t\t\tif( 0 < shapes.length ) {\r\n\t\t\t\t\tPromise.all( shapes ).then( ( resolved: EShape[] ): void => {\r\n\t\t\t\t\t\tfor( let j = 0, jmax = resolved.length; j < jmax; ++j ) {\r\n\t\t\t\t\t\t\tresolved[ j ].destroy();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tshapes.push( shape );\r\n\t\t}\r\n\t\tif( 0 < shapes.length ) {\r\n\t\t\treturn Promise.all( shapes );\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeBar } from \"./e-shape-bar\";\r\nimport { EShapeBarPosition } from \"./e-shape-bar-position\";\r\n\r\nexport const deserializeBar = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeBar> | EShapeBar => {\r\n\tconst shape = new EShapeBar( EShapeBarPosition.RIGHT, 10, 3, EShapePointsStyle.NONE );\r\n\tconst result = EShapeDeserializer.deserialize( item, manager, shape );\r\n\tshape.points.deserialize( item[ 15 ], manager );\r\n\treturn result;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createBarUploaded } from \"../variant/create-bar-uploaded\";\r\nimport { deserializeBar } from \"../variant/deserialize-bar\";\r\n\r\nexport const loadShapeBar = () => {\r\n\tEShapeUploadeds[ EShapeType.BAR ] = createBarUploaded;\r\n\tEShapeDeserializers[ EShapeType.BAR ] = deserializeBar;\r\n};\r\n","\r\nexport const buildStep = (\r\n\tsteps: Float32Array,\r\n\tclippings: Float32Array,\r\n\tvoffset: number, vcount: number,\r\n\tswx: number, swy: number, px0: number, py0: number, px1: number, py1: number\r\n): void => {\r\n\tlet ic = voffset * 3;\r\n\tlet is = voffset * 6;\r\n\tfor( let i = 0; i < vcount; ++i ) {\r\n\t\tsteps[ is + 0 ] = swx * clippings[ ic + 0 ];\r\n\t\tsteps[ is + 1 ] = swy * clippings[ ic + 1 ];\r\n\t\tsteps[ is + 2 ] = px0;\r\n\t\tsteps[ is + 3 ] = py0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tic += 3;\r\n\t\tis += 6;\r\n\t}\r\n};\r\n","export const STEP_VALUES: [ number, number, number ] = [ 0, 0, 0 ];\r\n\r\nexport const toStep = (\r\n\tsize: number,\r\n\tstrokeWidth: number,\r\n\tantialiasWeight: number,\r\n\tresult: [ number, number, number ]\r\n): [ number, number, number ] => {\r\n\tconst FMIN: number = 0.00001;\r\n\tif( FMIN < strokeWidth ) {\r\n\t\tconst dpc0 = size - strokeWidth;\r\n\t\tif( FMIN < dpc0 ) {\r\n\t\t\tconst pc0 = antialiasWeight / dpc0;\r\n\t\t\tconst pc1 = antialiasWeight / Math.max( FMIN, size );\r\n\t\t\tconst swc = 1 / Math.max( FMIN, 1 - strokeWidth / size );\r\n\t\t\tresult[ 0 ] = swc;\r\n\t\t\tresult[ 1 ] = pc0;\r\n\t\t\tresult[ 2 ] = pc1;\r\n\t\t} else {\r\n\t\t\tconst pc0 = antialiasWeight / FMIN;\r\n\t\t\tconst pc1 = antialiasWeight / Math.max( FMIN, size );\r\n\t\t\tconst swc = 1 / FMIN;\r\n\t\t\tresult[ 0 ] = swc;\r\n\t\t\tresult[ 1 ] = pc0;\r\n\t\t\tresult[ 2 ] = pc1;\r\n\t\t}\r\n\t} else {\r\n\t\t// Assumes strokeWidth === 0\r\n\t\tconst pc = antialiasWeight / Math.max( FMIN, size );\r\n\t\tresult[ 0 ] = 1;\r\n\t\tresult[ 1 ] = pc;\r\n\t\tresult[ 2 ] = pc;\r\n\t}\r\n\treturn result;\r\n};\r\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\r\nimport { buildStep } from \"./build-step\";\r\nimport { toLength } from \"./to-length\";\r\nimport { STEP_VALUES, toStep } from \"./to-step\";\r\n\r\nexport const CIRCLE_VERTEX_COUNT = 9;\r\nexport const CIRCLE_INDEX_COUNT = 8;\r\nexport const CIRCLE_WORLD_SIZE: [ number, number ] = [ 0, 0 ];\r\nconst CIRCLE_WORK_POINT: Point = new Point();\r\n\r\nexport const buildCircleClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number\r\n): void => {\r\n\tconst ic = voffset * 3;\r\n\tclippings[ ic +  0 ] = 1;\r\n\tclippings[ ic +  1 ] = 1;\r\n\tclippings[ ic +  2 ] = 1;\r\n\r\n\tclippings[ ic +  3 ] = 0;\r\n\tclippings[ ic +  4 ] = 1;\r\n\tclippings[ ic +  5 ] = 1;\r\n\r\n\tclippings[ ic +  6 ] = 1;\r\n\tclippings[ ic +  7 ] = 1;\r\n\tclippings[ ic +  8 ] = 1;\r\n\r\n\tclippings[ ic +  9 ] = 1;\r\n\tclippings[ ic + 10 ] = 0;\r\n\tclippings[ ic + 11 ] = 1;\r\n\r\n\tclippings[ ic + 12 ] = 0;\r\n\tclippings[ ic + 13 ] = 0;\r\n\tclippings[ ic + 14 ] = 1;\r\n\r\n\tclippings[ ic + 15 ] = 1;\r\n\tclippings[ ic + 16 ] = 0;\r\n\tclippings[ ic + 17 ] = 1;\r\n\r\n\tclippings[ ic + 18 ] = 1;\r\n\tclippings[ ic + 19 ] = 1;\r\n\tclippings[ ic + 20 ] = 1;\r\n\r\n\tclippings[ ic + 21 ] = 0;\r\n\tclippings[ ic + 22 ] = 1;\r\n\tclippings[ ic + 23 ] = 1;\r\n\r\n\tclippings[ ic + 24 ] = 1;\r\n\tclippings[ ic + 25 ] = 1;\r\n\tclippings[ ic + 26 ] = 1;\r\n};\r\n\r\nexport const buildCircleIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number\r\n): void => {\r\n\tconst ii = ioffset * 3;\r\n\tindices[ ii +  0 ] = voffset + 0;\r\n\tindices[ ii +  1 ] = voffset + 1;\r\n\tindices[ ii +  2 ] = voffset + 3;\r\n\r\n\tindices[ ii +  3 ] = voffset + 1;\r\n\tindices[ ii +  4 ] = voffset + 4;\r\n\tindices[ ii +  5 ] = voffset + 3;\r\n\r\n\tindices[ ii +  6 ] = voffset + 1;\r\n\tindices[ ii +  7 ] = voffset + 2;\r\n\tindices[ ii +  8 ] = voffset + 4;\r\n\r\n\tindices[ ii +  9 ] = voffset + 2;\r\n\tindices[ ii + 10 ] = voffset + 5;\r\n\tindices[ ii + 11 ] = voffset + 4;\r\n\r\n\tindices[ ii + 12 ] = voffset + 3;\r\n\tindices[ ii + 13 ] = voffset + 4;\r\n\tindices[ ii + 14 ] = voffset + 6;\r\n\r\n\tindices[ ii + 15 ] = voffset + 4;\r\n\tindices[ ii + 16 ] = voffset + 7;\r\n\tindices[ ii + 17 ] = voffset + 6;\r\n\r\n\tindices[ ii + 18 ] = voffset + 4;\r\n\tindices[ ii + 19 ] = voffset + 5;\r\n\tindices[ ii + 20 ] = voffset + 7;\r\n\r\n\tindices[ ii + 21 ] = voffset + 5;\r\n\tindices[ ii + 22 ] = voffset + 8;\r\n\tindices[ ii + 23 ] = voffset + 7;\r\n};\r\n\r\nexport const buildCircleVertex = (\r\n\tvertices: Float32Array,\r\n\tvoffset: number,\r\n\toriginX: number,\r\n\toriginY: number,\r\n\tsizeX: number,\r\n\tsizeY: number,\r\n\tstrokeAlign: number,\r\n\tstrokeWidth: number,\r\n\tinternalTransform: Matrix,\r\n\tworldSize: [ number, number ]\r\n): void => {\r\n\t// Calculate the transformed positions\r\n\t//\r\n\t//  0       1       2\r\n\t// |-------|-------|\r\n\t// |3      |4      |5\r\n\t// |-------|-------|\r\n\t// |6      |7      |8\r\n\t// |-------|-------|\r\n\t//\r\n\tconst work = CIRCLE_WORK_POINT;\r\n\tconst s = strokeAlign * strokeWidth;\r\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\r\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\r\n\twork.set( -sx + originX, -sy + originY );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x0 = work.x;\r\n\tconst y0 = work.y;\r\n\twork.set( 0 + originX, -sy + originY );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x1 = work.x;\r\n\tconst y1 = work.y;\r\n\tconst dx = x1 - x0;\r\n\tconst dy = y1 - y0;\r\n\twork.set( originX, originY );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x4 = work.x;\r\n\tconst y4 = work.y;\r\n\tconst x7 = x4 + (x4 - x1);\r\n\tconst y7 = y4 + (y4 - y1);\r\n\tconst x3 = x4 - dx;\r\n\tconst y3 = y4 - dy;\r\n\r\n\t// Vertices\r\n\tconst iv = voffset * 2;\r\n\tvertices[ iv +  0 ] = x0;\r\n\tvertices[ iv +  1 ] = y0;\r\n\tvertices[ iv +  2 ] = x1;\r\n\tvertices[ iv +  3 ] = y1;\r\n\tvertices[ iv +  4 ] = x1 + dx;\r\n\tvertices[ iv +  5 ] = y1 + dy;\r\n\r\n\tvertices[ iv +  6 ] = x3;\r\n\tvertices[ iv +  7 ] = y3;\r\n\tvertices[ iv +  8 ] = x4;\r\n\tvertices[ iv +  9 ] = y4;\r\n\tvertices[ iv + 10 ] = x4 + dx;\r\n\tvertices[ iv + 11 ] = y4 + dy;\r\n\r\n\tvertices[ iv + 12 ] = x7 - dx;\r\n\tvertices[ iv + 13 ] = y7 - dy;\r\n\tvertices[ iv + 14 ] = x7;\r\n\tvertices[ iv + 15 ] = y7;\r\n\tvertices[ iv + 16 ] = x7 + dx;\r\n\tvertices[ iv + 17 ] = y7 + dy;\r\n\r\n\tworldSize[ 0 ] = toLength( x0, y0, x1, y1 );\r\n\tworldSize[ 1 ] = toLength( x0, y0, x3, y3 );\r\n};\r\n\r\nexport const buildCircleStep = (\r\n\tsteps: Float32Array,\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tstrokeWidth: number,\r\n\tantialiasWeight: number,\r\n\tworldSize: [ number, number ]\r\n): void => {\r\n\ttoStep( worldSize[ 0 ], strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swx = STEP_VALUES[ 0 ];\r\n\tconst px0 = STEP_VALUES[ 1 ];\r\n\tconst px1 = STEP_VALUES[ 2 ];\r\n\r\n\ttoStep( worldSize[ 1 ], strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swy = STEP_VALUES[ 0 ];\r\n\tconst py0 = STEP_VALUES[ 1 ];\r\n\tconst py1 = STEP_VALUES[ 2 ];\r\n\r\n\tbuildStep(\r\n\t\tsteps, clippings,\r\n\t\tvoffset, CIRCLE_VERTEX_COUNT,\r\n\t\tswx, swy, px0, py0, px1, py1\r\n\t);\r\n};\r\n\r\nexport const buildCircleUv = (\r\n\tuvs: Float32Array,\r\n\tvoffset: number,\r\n\ttextureUvs: TextureUvs\r\n): void => {\r\n\tconst x0 = textureUvs.x0;\r\n\tconst x1 = textureUvs.x1;\r\n\tconst x2 = textureUvs.x2;\r\n\tconst x3 = textureUvs.x3;\r\n\tconst y0 = textureUvs.y0;\r\n\tconst y1 = textureUvs.y1;\r\n\tconst y2 = textureUvs.y2;\r\n\tconst y3 = textureUvs.y3;\r\n\r\n\t// UVs\r\n\tconst iuv = voffset * 2;\r\n\tuvs[ iuv +  0 ] = x0;\r\n\tuvs[ iuv +  1 ] = y0;\r\n\tuvs[ iuv +  2 ] = 0.5 * ( x0 + x1 );\r\n\tuvs[ iuv +  3 ] = 0.5 * ( y0 + y1 );\r\n\tuvs[ iuv +  4 ] = x1;\r\n\tuvs[ iuv +  5 ] = y1;\r\n\r\n\tuvs[ iuv +  6 ] = 0.5 * ( x0 + x3 );\r\n\tuvs[ iuv +  7 ] = 0.5 * ( y0 + y3 );\r\n\tuvs[ iuv +  8 ] = 0.5 * ( x0 + x2 );\r\n\tuvs[ iuv +  9 ] = 0.5 * ( y0 + y2 );\r\n\tuvs[ iuv + 10 ] = 0.5 * ( x1 + x2 );\r\n\tuvs[ iuv + 11 ] = 0.5 * ( y1 + y2 );\r\n\r\n\tuvs[ iuv + 12 ] = x3;\r\n\tuvs[ iuv + 13 ] = y3;\r\n\tuvs[ iuv + 14 ] = 0.5 * ( x3 + x2 );\r\n\tuvs[ iuv + 15 ] = 0.5 * ( y3 + y2 );\r\n\tuvs[ iuv + 16 ] = x2;\r\n\tuvs[ iuv + 17 ] = y2;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport {\r\n\tbuildCircleClipping, buildCircleIndex, buildCircleStep, buildCircleUv,\r\n\tbuildCircleVertex, CIRCLE_WORLD_SIZE\r\n} from \"./build-circle\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport class EShapeCircleUploaded extends EShapeTextUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Clippings & indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateClippings();\r\n\t\tbuffer.updateIndices();\r\n\t\tconst voffset = this.vertexOffset;\r\n\t\tbuildCircleClipping(\r\n\t\t\tbuffer.clippings,\r\n\t\t\tvoffset\r\n\t\t);\r\n\t\tbuildCircleIndex(\r\n\t\t\tbuffer.indices,\r\n\t\t\tvoffset,\r\n\t\t\tthis.indexOffset\r\n\t\t);\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tthis.updateCircleVertexAndStep( buffer, shape );\r\n\t\tthis.updateColor( buffer, shape );\r\n\t\tthis.updateCircleUv( buffer, shape );\r\n\t\tthis.updateText( buffer, shape );\r\n\t}\r\n\r\n\tprotected updateCircleVertexAndStep( buffer: EShapeBuffer, shape: EShape ) {\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign || this.strokeWidth !== strokeWidth );\r\n\r\n\t\tif( isSizeChanged || isTransformChanged || isStrokeChanged ) {\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\r\n\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\tthis.textSpacingHorizontal = NaN;\r\n\r\n\t\t\t// Buffer\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tbuffer.updateSteps();\r\n\t\t\tbuildCircleVertex(\r\n\t\t\t\tbuffer.vertices, this.vertexOffset,\r\n\t\t\t\t0, 0,\r\n\t\t\t\tsizeX, sizeY,\r\n\t\t\t\tstrokeAlign, strokeWidth,\r\n\t\t\t\tshape.transform.internalTransform,\r\n\t\t\t\tCIRCLE_WORLD_SIZE\r\n\t\t\t);\r\n\t\t\tbuildCircleStep(\r\n\t\t\t\tbuffer.steps, buffer.clippings,\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\tstrokeWidth,\r\n\t\t\t\tthis.antialiasWeight,\r\n\t\t\t\tCIRCLE_WORLD_SIZE\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateCircleUv( buffer: EShapeBuffer, shape: EShape ) {\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tif( texture !== this.texture || textureTransformId !== this.textureTransformId ) {\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tbuffer.updateUvs();\r\n\t\t\tconst textureUvs = this.toTextureUvs( texture );\r\n\t\t\tbuildCircleUv(\r\n\t\t\t\tbuffer.uvs,\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\ttextureUvs\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { CIRCLE_INDEX_COUNT, CIRCLE_VERTEX_COUNT } from \"./build-circle\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\nimport { EShapeCircleUploaded } from \"./e-shape-circle-uploaded\";\r\n\r\nexport const createCircle = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeCircleUploaded | null => {\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst vcount = CIRCLE_VERTEX_COUNT + tvcount;\r\n\tconst icount = CIRCLE_INDEX_COUNT + ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new EShapeCircleUploaded(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapePrimitive } from \"./e-shape-primitive\";\r\n\r\nexport class EShapeCircle extends EShapePrimitive {\r\n\tconstructor( type = EShapeType.CIRCLE ) {\r\n\t\tsuper( type );\r\n\t}\r\n\r\n\tclone(): EShapeCircle {\r\n\t\treturn new EShapeCircle().copy( this );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tif( super.containsAbsBBox( x, y, ax, ay ) ) {\r\n\t\t\tconst fill = this.fill;\r\n\t\t\tconst stroke = this.stroke;\r\n\t\t\tif( fill.enable ) {\r\n\t\t\t\tconst x2 = x * x;\r\n\t\t\t\tconst y2 = y * y;\r\n\t\t\t\tconst ax2 = ax * ax;\r\n\t\t\t\tconst ay2 = ay * ay;\r\n\t\t\t\tif( x2 * ay2 + y2 * ax2 <= ax2 * ay2 ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst strokeWidth = stroke.width;\r\n\t\t\t\tif( stroke.enable && 0 < strokeWidth ) {\r\n\t\t\t\t\tconst x2 = x * x;\r\n\t\t\t\t\tconst y2 = y * y;\r\n\t\t\t\t\tconst wx = Math.max( 0.0, ax - strokeWidth );\r\n\t\t\t\t\tconst wy = Math.max( 0.0, ay - strokeWidth );\r\n\t\t\t\t\tconst wx2 = wx * wx;\r\n\t\t\t\t\tconst wy2 = wy * wy;\r\n\t\t\t\t\tif( wx2 * wy2 <= x2 * wy2 + y2 * wx2 ) {\r\n\t\t\t\t\t\tconst ax2 = ax * ax;\r\n\t\t\t\t\t\tconst ay2 = ay * ay;\r\n\t\t\t\t\t\tif( x2 * ay2 + y2 * ax2 <= ax2 * ay2 ) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeCircle } from \"./e-shape-circle\";\r\n\r\nexport const deserializeCircle = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeCircle> | EShapeCircle => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeCircle() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createCircle } from \"../variant/create-circle-uploaded\";\r\nimport { deserializeCircle } from \"../variant/deserialize-circle\";\r\n\r\nexport const loadShapeCircle = () => {\r\n\tEShapeUploadeds[ EShapeType.CIRCLE ] = createCircle;\r\n\tEShapeDeserializers[ EShapeType.CIRCLE ] = deserializeCircle;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { EShapeUploadedBase } from \"../e-shape-uploaded\";\r\n\r\nexport class EShapeGroupUploaded extends EShapeUploadedBase {\r\n\tconstructor( buffer: EShapeBuffer, voffset: number, ioffset: number ) {\r\n\t\tsuper( buffer, voffset, ioffset, 0, 0, 1 );\r\n\t}\r\n\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\t\tthis.texture = shape.texture || Texture.WHITE;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { EShapeGroupUploaded } from \"./e-shape-group-uploaded\";\r\n\r\nexport const createGroupUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number\r\n): EShapeGroupUploaded | null => {\r\n\treturn new EShapeGroupUploaded(\r\n\t\tbuffer,\r\n\t\tvoffset, ioffset\r\n\t).init( shape );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeFill, EShapeFillLike } from \"../e-shape-fill\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\n\r\nexport class EShapeGroupFillEditor implements EShapeFill {\r\n\tprotected _parent: EShapeGroupPropertyParent;\r\n\r\n\tconstructor( parent: EShapeGroupPropertyParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].fill.enable;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].fill.enable = enable;\r\n\t\t}\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].fill.color;\r\n\t\t}\r\n\t\treturn 0xffffff;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].fill.color = color;\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].fill.alpha;\r\n\t\t}\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].fill.alpha = alpha;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeFillLike> ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].fill.copy( target );\r\n\t\t}\r\n\t}\r\n\r\n\tset( enable: boolean, color: number, alpha: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].fill.set( enable, color, alpha );\r\n\t\t}\r\n\t}\r\n\r\n\tclone(): EShapeGroupFillEditor {\r\n\t\treturn new EShapeGroupFillEditor( this._parent );\r\n\t}\r\n\r\n\ttoObject(): EShapeFillLike {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].fill.toObject();\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tenable: true,\r\n\t\t\tcolor: 0xffffff,\r\n\t\t\talpha: 1.0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ) {\r\n\t\t//\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix, Point } from \"pixi.js\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapePoints } from \"../e-shape-points\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\n\r\nexport class EShapeGroupPoints implements EShapePoints {\r\n\tprotected _parent: EShapeGroupPropertyParent;\r\n\r\n\tconstructor( parent: EShapeGroupPropertyParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tget length(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\tconst points = children[ children.length - 1 ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\treturn points.length;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\tconst points = children[ children.length - 1 ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\treturn points.id;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tget values(): number[] {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\tconst points = children[ children.length - 1 ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\treturn points.values;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [];\r\n\t}\r\n\r\n\tset values( values: number[] ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst points = children[ i ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\tpoints.values = values;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget segments(): number[] {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\tconst points = children[ children.length - 1 ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\treturn points.segments;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [];\r\n\t}\r\n\r\n\tset segments( segments: number[] ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst points = children[ i ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\tpoints.segments = segments;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget style(): EShapePointsStyle {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\tconst points = children[ children.length - 1 ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\treturn points.style;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn EShapePointsStyle.NONE;\r\n\t}\r\n\r\n\tset style( style: EShapePointsStyle ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst points = children[ i ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\tpoints.style = style;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( source: EShapePoints ): this {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst points = children[ i ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\tpoints.copy( source );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tset( values?: number[], segments?: number[], style?: EShapePointsStyle ): this {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst points = children[ i ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\tpoints.set( values, segments, style );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone( parent: EShape ): EShapeGroupPoints {\r\n\t\treturn new EShapeGroupPoints( parent );\r\n\t}\r\n\r\n\ttoPoints( transform: Matrix ): Point[] {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst points = children[ i ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\treturn points.toPoints( transform );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [];\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst points = children[ i ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\treturn points.serialize( manager );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix, Point } from \"pixi.js\";\r\n\r\nexport class EShapeEditor {\r\n\tlocalTransform: Matrix;\r\n\tinternalTransform: Matrix;\r\n\tinternalTransformParentInverse: Matrix;\r\n\trotation: number;\r\n\tsize: Point;\r\n\r\n\tconstructor() {\r\n\t\tthis.localTransform = new Matrix();\r\n\t\tthis.internalTransform = new Matrix();\r\n\t\tthis.internalTransformParentInverse = new Matrix();\r\n\t\tthis.rotation = 0;\r\n\t\tthis.size = new Point();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix } from \"pixi.js\";\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeEditor } from \"./e-shape-editor\";\r\nimport { EShapeSizes } from \"./e-shape-sizes\";\r\nimport { EShapeBase } from \"./variant/e-shape-base\";\r\n\r\nexport class EShapeTransforms {\r\n\tstatic prepare( shape: EShape ): void {\r\n\t\tconst editor = shape.editor = (shape.editor || new EShapeEditor());\r\n\r\n\t\t// Ttransform\r\n\t\tshape.updateTransform();\r\n\t\tconst parent = shape.parent;\r\n\t\tif( parent instanceof EShapeBase ) {\r\n\t\t\tparent.transform.internalTransform.copyTo(editor.internalTransformParentInverse).invert();\r\n\t\t} else {\r\n\t\t\teditor.internalTransformParentInverse.identity();\r\n\t\t}\r\n\t\tshape.transform.internalTransform.copyTo(editor.internalTransform);\r\n\r\n\t\t// Rotation\r\n\t\teditor.rotation = shape.transform.rotation;\r\n\r\n\t\t// Size\r\n\t\teditor.size.copyFrom( shape.size );\r\n\r\n\t\t//\r\n\t\tshape.disallowOnTransformChange();\r\n\t}\r\n\r\n\tstatic finalize( shape: EShape ): void {\r\n\t\tshape.allowOnTransformChange( true );\r\n\t}\r\n\r\n\tstatic apply( shape: EShape, transform: Matrix, keepSize: boolean ): void {\r\n\t\tconst editor = shape.editor;\r\n\t\tif( editor != null ) {\r\n\t\t\tconst newLocalTransform = editor.localTransform;\r\n\t\t\teditor.internalTransformParentInverse.copyTo(newLocalTransform)\r\n\t\t\t\t.append(transform).append(editor.internalTransform);\r\n\t\t\tif( keepSize ) {\r\n\t\t\t\tthis.applyLocal( shape, newLocalTransform );\r\n\t\t\t} else {\r\n\t\t\t\tconst size = editor.size;\r\n\t\t\t\tthis.applyLocal( shape, newLocalTransform, size.x, size.y );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstatic applyLocal( shape: EShape, localTransform: Matrix, bx?: number, by?: number ): void {\r\n\t\tshape.disallowUploadedUpdate();\r\n\r\n\t\t// Reconstruct the position, the rotation and the size\r\n\t\tconst a = localTransform.a;\r\n\t\tconst b = localTransform.b;\r\n\t\tconst c = localTransform.c;\r\n\t\tconst d = localTransform.d;\r\n\t\tconst tx = localTransform.tx;\r\n\t\tconst ty = localTransform.ty;\r\n\r\n\t\t// Rotation\r\n\t\tconst transform = shape.transform;\r\n\t\tconst rx = Math.atan2(-c, d); // rotation - skewX\r\n\t\tconst ry = Math.atan2(+b, a); // rotation + skewY\r\n\t\ttransform.rotation = (rx + ry) * 0.5; // Here, assumes `skewX` === `skewY`\r\n\r\n\t\t// Skew\r\n\t\tconst skew = (ry - rx) * 0.5;\r\n\t\ttransform.skew.set(skew, skew);\r\n\r\n\t\t// Position: Assumes the pivot is invariant.\r\n\t\t// tx = position.x - (a * px + c * py)\r\n\t\t// ty = position.y - (b * px + d * py)\r\n\t\t//\r\n\t\t// Thus,\r\n\t\t// position.x = tx + (a * px + c * py)\r\n\t\t// position.y = ty + (b * px + d * py)\r\n\t\tconst pivot = transform.pivot;\r\n\t\tconst px = pivot.x;\r\n\t\tconst py = pivot.y;\r\n\t\ttransform.position.set(\r\n\t\t\ttx + (a * px + c * py),\r\n\t\t\tty + (b * px + d * py)\r\n\t\t);\r\n\r\n\t\t// Scale\r\n\t\tif( bx != null && by != null ) {\r\n\t\t\tconst sx = Math.sqrt( a * a + b * b );\r\n\t\t\tconst sy = Math.sqrt( c * c + d * d );\r\n\t\t\tshape.size.set(\r\n\t\t\t\tEShapeSizes.toNormalized( bx * sx ),\r\n\t\t\t\tEShapeSizes.toNormalized( by * sy )\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tshape.allowUploadedUpdate();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix, Point } from \"pixi.js\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeLayout } from \"../e-shape-layout\";\r\nimport { EShapeTransforms } from \"../e-shape-transforms\";\r\n\r\nexport class EShapeGroupSizeLayout implements EShapeLayout {\r\n\tprotected static WORK_TRANSFORM: Matrix = new Matrix();\r\n\r\n\tprotected shape: EShape;\r\n\tprotected base: Point;\r\n\tprotected shapeBase: Point;\r\n\tprotected transform: Matrix;\r\n\r\n\tconstructor( shape: EShape, bx: number, by: number ) {\r\n\t\tthis.shape = shape;\r\n\r\n\t\t// Base group size\r\n\t\tthis.base = new Point( bx, by );\r\n\r\n\t\t// Base shape size\r\n\t\tconst size = shape.size;\r\n\t\tthis.shapeBase = new Point( size.x, size.y );\r\n\r\n\t\t// Transform\r\n\t\tthis.transform = new Matrix();\r\n\t\tshape.updateTransform();\r\n\t\tshape.transform.localTransform.copyTo( this.transform );\r\n\t}\r\n\r\n\tisCompatible( shape: EShape ): boolean {\r\n\t\treturn this.shape === shape;\r\n\t}\r\n\r\n\treset( shape: EShape, baseX: number, baseY: number ): void {\r\n\t\tthis.base.set( baseX, baseY );\r\n\r\n\t\t// Base shape size\r\n\t\tconst size = shape.size;\r\n\t\tthis.shapeBase.copyFrom( size );\r\n\r\n\t\t// Transform\r\n\t\tshape.updateTransform();\r\n\t\tshape.transform.localTransform.copyTo( this.transform );\r\n\t}\r\n\r\n\tupdate(\r\n\t\tshape: EShape, baseX: number, baseY: number,\r\n\t\tpivotX: number, pivotY: number\r\n\t) {\r\n\t\tconst sx = baseX / this.base.x;\r\n\t\tconst sy = baseY / this.base.y;\r\n\t\tconst childBase = this.shapeBase;\r\n\t\tconst transform = EShapeGroupSizeLayout.WORK_TRANSFORM;\r\n\t\ttransform.identity()\r\n\t\t\t.append( this.transform )\r\n\t\t\t.translate( -pivotX, -pivotY )\r\n\t\t\t.scale( sx, sy )\r\n\t\t\t.translate( +pivotX, +pivotY );\r\n\t\tshape.disallowOnTransformChange();\r\n\t\tEShapeTransforms.applyLocal( shape, transform, childBase.x, childBase.y );\r\n\t\tshape.allowOnTransformChange( false );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint, Point, Rectangle } from \"pixi.js\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeLayout } from \"../e-shape-layout\";\r\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\r\nimport { EShapeGroupSizeLayout } from \"./e-shape-group-size-layout\";\r\nimport { EShapeGroupSizeParent } from \"./e-shape-group-size-parent\";\r\n\r\nexport class EShapeGroupSizeEditor implements EShapeGroupSize {\r\n\tprotected _parent: EShapeGroupSizeParent;\r\n\tprotected _size: Point;\r\n\tprotected _layouts: EShapeLayout[];\r\n\tprotected _workPoint: Point = new Point();\r\n\tprotected _workRectForCalcRect: Rectangle = new Rectangle();\r\n\tprotected _workRectForFit: Rectangle = new Rectangle();\r\n\r\n\tconstructor( parent: EShapeGroupSizeParent, x: number, y: number ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._layouts = [];\r\n\t\tthis._size = new Point( x, y );\r\n\t}\r\n\r\n\tinit(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._size.x;\r\n\t}\r\n\r\n\tset x( x: number ) {\r\n\t\tconst size = this._size;\r\n\t\tif( size.x !== x ) {\r\n\t\t\tconst ox = size.x;\r\n\t\t\tsize.x = x;\r\n\t\t\tthis.onChange( ox, size.y );\r\n\t\t}\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._size.y;\r\n\t}\r\n\r\n\tset y( y: number ) {\r\n\t\tconst size = this._size;\r\n\t\tif( size.y !== y ) {\r\n\t\t\tconst oy = size.y;\r\n\t\t\tsize.y = y;\r\n\t\t\tthis.onChange( size.x, oy );\r\n\t\t}\r\n\t}\r\n\r\n\tset( x?: number, y?: number ): this {\r\n\t\tlet isChanged = false;\r\n\t\tconst size = this._size;\r\n\t\tconst ox = size.x;\r\n\t\tconst oy = size.y;\r\n\t\tif( x != null && ox !== x ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tsize.x = x;\r\n\t\t}\r\n\t\tif( y != null && oy !== y ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tsize.y = y;\r\n\t\t}\r\n\t\tif( isChanged ) {\r\n\t\t\tthis.onChange( ox, oy );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone(): EShapeGroupSizeEditor {\r\n\t\tconst size = this._size;\r\n\t\treturn new EShapeGroupSizeEditor( this._parent, size.x, size.y );\r\n\t}\r\n\r\n\tcopy(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopyFrom( point: IPoint ): this {\r\n\t\tconst x = point.x;\r\n\t\tconst y = point.y;\r\n\t\tconst size = this._size;\r\n\t\tconst ox = size.x;\r\n\t\tconst oy = size.y;\r\n\t\tif( ox !== x || oy !== y ) {\r\n\t\t\tsize.x = x;\r\n\t\t\tsize.y = y;\r\n\t\t\tthis.onChange( ox, oy );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcopyTo( point: IPoint ): IPoint {\r\n\t\treturn this._size.copyTo( point );\r\n\t}\r\n\r\n\tequals( point: IPoint ): boolean {\r\n\t\treturn this._size.equals( point );\r\n\t}\r\n\r\n\tfit(): void {\r\n\t\tconst parent = this._parent;\r\n\t\tparent.disallowOnTransformChange();\r\n\r\n\t\t// Calculate the rect\r\n\t\tconst rect = this.calcRect( this._workRectForFit );\r\n\r\n\t\t// Set size\r\n\t\tconst size = this._size;\r\n\t\tsize.set( rect.width, rect.height );\r\n\r\n\t\t// Position & Pivot\r\n\t\t// rx := rect.x\r\n\t\t// ry := rect.y\r\n\t\t//\r\n\t\t// | a c tx | | 1 0 +rx | | 1 0 -rx |   | a c tx + (a * rx + c * ry) | | 1 0 -rx |\r\n\t\t// | b d ty | | 0 1 +ry | | 0 1 -ry | = | b d ty + (b * rx + d * ry) | | 0 1 -ry |\r\n\t\t// | 0 0 1  | | 0 0  1  | | 0 0  1  |   | 0 0 1                      | | 0 0  1  |\r\n\t\t//\r\n\t\t// tx -> tx + (a * rx + c * ry) = poxition.x - (a * pivot.x + c * pivot.y)\r\n\t\t// ty -> ty + (b * rx + d * ry) = poxition.y - (b * pivot.x + d * pivot.y)\r\n\t\t// position.x -> position.x + (a * rx + c * ry) - (a * pivot.x + c * pivot.y)\r\n\t\t// position.y -> position.y + (b * rx + d * ry) - (b * pivot.x + d * pivot.y)\r\n\t\t// pivot.x -> 0\r\n\t\t// pivot.y -> 0\r\n\t\t//\r\n\t\t// a -> a', b -> b', c -> c', tx -> tx', ty -> ty'\r\n\t\t//\r\n\t\t// | a' c' tx' | | 1 0 -rx |   | a' c' tx' - (a' * rx + c' * ry) |\r\n\t\t// | b' d' ty' | | 0 1 -ry | = | b' d' ty' - (b' * rx + d' * ry) |\r\n\t\t// | 0  0  1   | | 0 0  1  |   | 0  0  1                         |\r\n\t\t//\r\n\t\t// tx' -> tx' - (a' * rx + c' * ry) = poxition.x - (a' * pivot.x + c' * pivot.y)\r\n\t\t// ty' -> ty' - (b' * rx + d' * ry) = poxition.y - (b' * pivot.x + d' * pivot.y)\r\n\t\t// pivot.x -> pivot.x + rx\r\n\t\t// pivot.y -> pivot.y + ry\r\n\t\tparent.updateTransform();\r\n\t\tconst transform = parent.transform;\r\n\t\tconst x = rect.x + rect.width * 0.5;\r\n\t\tconst y = rect.y + rect.height * 0.5;\r\n\t\tconst position = transform.position;\r\n\t\tconst localTransform = transform.localTransform;\r\n\t\tconst a = localTransform.a;\r\n\t\tconst b = localTransform.b;\r\n\t\tconst c = localTransform.c;\r\n\t\tconst d = localTransform.d;\r\n\t\tconst pivot = transform.pivot;\r\n\t\tposition.set(\r\n\t\t\tposition.x + (a * x + c * y) - (a * pivot.x + c * pivot.y),\r\n\t\t\tposition.y + (b * x + d * y) - (b * pivot.x + d * pivot.y)\r\n\t\t);\r\n\t\tpivot.set( x, y );\r\n\r\n\t\t// Reset the data\r\n\t\tthis.reset( parent.children, this._layouts, size );\r\n\r\n\t\t//\r\n\t\tparent.allowOnTransformChange( true );\r\n\t}\r\n\r\n\tprotected reset( children: EShape[], layouts: EShapeLayout[], size: IPoint ): void {\r\n\t\tfor( let i = 0, imax = Math.min( layouts.length, children.length ); i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tconst layout = layouts[ i ];\r\n\t\t\tif( layout.isCompatible( child ) ) {\r\n\t\t\t\tlayout.reset( child, size.x, size.y );\r\n\t\t\t} else {\r\n\t\t\t\tlayouts.length = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( children.length < layouts.length ) {\r\n\t\t\tlayouts.length = children.length;\r\n\t\t}\r\n\t}\r\n\r\n\tcalcRect( result: Rectangle ): Rectangle {\r\n\t\tconst parent = this._parent;\r\n\t\tconst children = parent.children;\r\n\t\tif( children.length <= 0 ) {\r\n\t\t\tresult.x = 0;\r\n\t\t\tresult.y = 0;\r\n\t\t\tresult.width = 0;\r\n\t\t\tresult.height = 0;\r\n\t\t} else {\r\n\t\t\tconst workPoint = this._workPoint;\r\n\t\t\tconst workRect = this._workRectForCalcRect;\r\n\t\t\tchildren[ 0 ].getBoundsLocal( workPoint, false, result );\r\n\t\t\tfor( let i = 1, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tchild.getBoundsLocal( workPoint, false, workRect );\r\n\t\t\t\tresult.enlarge( workRect );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected onChange( ox: number, oy: number ): void {\r\n\t\tconst parent = this._parent;\r\n\t\tconst size = this._size;\r\n\t\tconst pivot = parent.transform.pivot;\r\n\t\tthis.onChange_( parent.children, this._layouts, size.x, size.y, pivot.x, pivot.y, ox, oy );\r\n\t\tparent.onSizeChange();\r\n\t}\r\n\r\n\tprotected onChange_(\r\n\t\tchildren: EShape[],\r\n\t\tlayouts: EShapeLayout[],\r\n\t\tsx: number, sy: number,\r\n\t\tpx: number, py: number,\r\n\t\tox: number, oy: number\r\n\t): void {\r\n\t\tfor( let i = 0, imax = Math.min( layouts.length, children.length ); i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tconst layout = layouts[ i ];\r\n\t\t\tif( layout.isCompatible( child ) ) {\r\n\t\t\t\tlayout.update( child, sx, sy, px, py );\r\n\t\t\t} else {\r\n\t\t\t\tlayouts.length = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor( let i = layouts.length, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tconst layout = this.newLayout( child, ox, oy );\r\n\t\t\tlayout.update( child, sx, sy, px, py );\r\n\t\t\tlayouts.push( layout );\r\n\t\t}\r\n\t\tif( layouts.length !== children.length ) {\r\n\t\t\tlayouts.length = children.length;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newLayout( shape: EShape, ox: number, oy: number ): EShapeLayout {\r\n\t\treturn shape.layout || new EShapeGroupSizeLayout( shape, ox, oy );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { ObservablePoint, Point } from \"pixi.js\";\r\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\r\n\r\nexport class EShapeGroupSizeViewer extends ObservablePoint implements EShapeGroupSize {\r\n\tbase: Point;\r\n\r\n\tconstructor( cb: () => void, x: number, y: number ) {\r\n\t\tsuper( cb, undefined, x, y );\r\n\t\tthis.base = new Point( x, y );\r\n\t}\r\n\r\n\tinit(): void {\r\n\t\tthis.base.copyFrom( this );\r\n\t\t(this as any).cb();\r\n\t}\r\n\r\n\tfit(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeStroke, EShapeStrokeLike } from \"../e-shape-stroke\";\r\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\n\r\nexport class EShapeGroupStrokeEditor implements EShapeStroke {\r\n\tprotected _parent: EShapeGroupPropertyParent;\r\n\r\n\tconstructor( parent: EShapeGroupPropertyParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].stroke.enable;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].stroke.enable = enable;\r\n\t\t}\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].stroke.color;\r\n\t\t}\r\n\t\treturn 0xffffff;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].stroke.color = color;\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].stroke.alpha;\r\n\t\t}\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].stroke.alpha = alpha;\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].stroke.width;\r\n\t\t}\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].stroke.width = width;\r\n\t\t}\r\n\t}\r\n\r\n\tget align(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].stroke.align;\r\n\t\t}\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset align( align: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].stroke.align = align;\r\n\t\t}\r\n\t}\r\n\r\n\tget side(): EShapeStrokeSide {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].stroke.side;\r\n\t\t}\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset side( side: EShapeStrokeSide ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].stroke.side = side;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeStrokeLike> ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].stroke.copy( target );\r\n\t\t}\r\n\t}\r\n\r\n\tset( enable: boolean, color: number, alpha: number, width: number, side: EShapeStrokeSide ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].stroke.set( enable, color, alpha, width, side );\r\n\t\t}\r\n\t}\r\n\r\n\tclone(): EShapeGroupStrokeEditor {\r\n\t\treturn new EShapeGroupStrokeEditor( this._parent );\r\n\t}\r\n\r\n\ttoObject(): EShapeStrokeLike {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].stroke.toObject();\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tenable: false,\r\n\t\t\tcolor: 0xffffff,\r\n\t\t\talpha: 1.0,\r\n\t\t\twidth: 1.0,\r\n\t\t\talign: 0.0,\r\n\t\t\tside: EShapeStrokeSide.NONE\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t//\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextAlign, EShapeTextAlignLike } from \"../e-shape-text-align\";\r\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\r\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\n\r\nexport class EShapeGroupTextAlignEditor implements EShapeTextAlign {\r\n\tprotected _parent: EShapeGroupPropertyParent;\r\n\r\n\tconstructor( parent: EShapeGroupPropertyParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tget horizontal(): EShapeTextAlignHorizontal {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.align.horizontal;\r\n\t\t}\r\n\t\treturn EShapeTextAlignHorizontal.CENTER;\r\n\t}\r\n\r\n\tset horizontal( horizontal: EShapeTextAlignHorizontal ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.align.horizontal = horizontal;\r\n\t\t}\r\n\t}\r\n\r\n\tget vertical(): EShapeTextAlignVertical {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.align.vertical;\r\n\t\t}\r\n\t\treturn EShapeTextAlignVertical.MIDDLE;\r\n\t}\r\n\r\n\tset vertical( vertical: EShapeTextAlignVertical ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.align.vertical = vertical;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextAlignLike> ): void {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.align.copy( target );\r\n\t\t}\r\n\t}\r\n\r\n\tset( horizontal?: EShapeTextAlignHorizontal, vertical?: EShapeTextAlignVertical ): void {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.align.set( horizontal, vertical );\r\n\t\t}\r\n\t}\r\n\r\n\ttoObject(): EShapeTextAlignLike {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.align.toObject();\r\n\t\t}\r\n\t\treturn {\r\n\t\t\thorizontal: EShapeTextAlignHorizontal.CENTER,\r\n\t\t\tvertical: EShapeTextAlignVertical.MIDDLE\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOffsetLike } from \"../e-shape-text-offset\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\n\r\nexport class EShapeGroupTextOffsetEditor {\r\n\tprotected _parent: EShapeGroupPropertyParent;\r\n\r\n\tconstructor( parent: EShapeGroupPropertyParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tget horizontal(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.offset.horizontal;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset horizontal( horizontal: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.offset.horizontal = horizontal;\r\n\t\t}\r\n\t}\r\n\r\n\tget vertical(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.offset.vertical;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset vertical( vertical: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.offset.vertical = vertical;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target: EShapeTextOffsetLike ): void {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.offset.copy( target );\r\n\t\t}\r\n\t}\r\n\r\n\tset( horizontal: number, vertical: number ): void {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.offset.set( horizontal, vertical );\r\n\t\t}\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOffsetLike {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.offset.toObject();\r\n\t\t}\r\n\t\treturn {\r\n\t\t\thorizontal: 0,\r\n\t\t\tvertical: 0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"../e-shape-text-outline\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\n\r\nexport class EShapeGroupTextOutlineEditor implements EShapeTextOutline {\r\n\tprotected _parent: EShapeGroupPropertyParent;\r\n\r\n\tconstructor( parent: EShapeGroupPropertyParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.outline.enable;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.outline.enable = enable;\r\n\t\t}\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.outline.color;\r\n\t\t}\r\n\t\treturn 0xffffff;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.outline.color = color;\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.outline.alpha;\r\n\t\t}\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.outline.alpha = alpha;\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.outline.width;\r\n\t\t}\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.outline.width = width;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextOutlineLike> ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.outline.copy( target );\r\n\t\t}\r\n\t}\r\n\r\n\tset( enable?: boolean, color?: number, alpha?: number, width?: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.outline.set( enable, color, alpha, width );\r\n\t\t}\r\n\t}\r\n\r\n\tclone(): EShapeGroupTextOutlineEditor {\r\n\t\treturn new EShapeGroupTextOutlineEditor( this._parent );\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOutlineLike {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.outline.toObject();\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tenable: false,\r\n\t\t\tcolor: 0xffffff,\r\n\t\t\talpha: 1.0,\r\n\t\t\twidth: 1.0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t//\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOffsetLike } from \"../e-shape-text-offset\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\n\r\nexport class EShapeGroupTextPaddingEditor {\r\n\tprotected _parent: EShapeGroupPropertyParent;\r\n\r\n\tconstructor( parent: EShapeGroupPropertyParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tget horizontal(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.padding.horizontal;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset horizontal( horizontal: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.padding.horizontal = horizontal;\r\n\t\t}\r\n\t}\r\n\r\n\tget vertical(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.padding.vertical;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset vertical( vertical: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.padding.vertical = vertical;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target: EShapeTextOffsetLike ): void {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.padding.copy( target );\r\n\t\t}\r\n\t}\r\n\r\n\tset( horizontal: number, vertical: number ): void {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.padding.set( horizontal, vertical );\r\n\t\t}\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOffsetLike {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.padding.toObject();\r\n\t\t}\r\n\t\treturn {\r\n\t\t\thorizontal: 0,\r\n\t\t\tvertical: 0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOffsetLike } from \"../e-shape-text-offset\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\n\r\nexport class EShapeGroupTextSpacingEditor {\r\n\tprotected _parent: EShapeGroupPropertyParent;\r\n\r\n\tconstructor( parent: EShapeGroupPropertyParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tget horizontal(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.spacing.horizontal;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset horizontal( horizontal: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.spacing.horizontal = horizontal;\r\n\t\t}\r\n\t}\r\n\r\n\tget vertical(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.spacing.vertical;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset vertical( vertical: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.spacing.vertical = vertical;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target: EShapeTextOffsetLike ): void {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.spacing.copy( target );\r\n\t\t}\r\n\t}\r\n\r\n\tset( horizontal: number, vertical: number ): void {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.spacing.set( horizontal, vertical );\r\n\t\t}\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOffsetLike {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.spacing.toObject();\r\n\t\t}\r\n\t\treturn {\r\n\t\t\thorizontal: 0,\r\n\t\t\tvertical: 0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DeepPartial } from \"../../util/deep-partial\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeText, EShapeTextLike, EShapeTextStyle, EShapeTextWeight } from \"../e-shape-text\";\r\nimport { EShapeTextDirection } from \"../e-shape-text-direction\";\r\nimport { EShapeTextOutline } from \"../e-shape-text-outline\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\nimport { EShapeGroupTextAlignEditor } from \"./e-shape-group-text-align-editor\";\r\nimport { EShapeGroupTextOffsetEditor } from \"./e-shape-group-text-offset-editor\";\r\nimport { EShapeGroupTextOutlineEditor } from \"./e-shape-group-text-outline-editor\";\r\nimport { EShapeGroupTextPaddingEditor } from \"./e-shape-group-text-padding-editor\";\r\nimport { EShapeGroupTextSpacingEditor } from \"./e-shape-group-text-spacing-editor\";\r\n\r\nexport class EShapeGroupTextEditor implements EShapeText {\r\n\tprotected _parent: EShapeGroupPropertyParent;\r\n\r\n\talign: EShapeGroupTextAlignEditor;\r\n\toffset: EShapeGroupTextOffsetEditor;\r\n\toutline: EShapeTextOutline;\r\n\tspacing: EShapeGroupTextSpacingEditor;\r\n\tpadding: EShapeGroupTextPaddingEditor;\r\n\r\n\tconstructor( parent: EShapeGroupPropertyParent ) {\r\n\t\tthis._parent = parent;\r\n\r\n\t\tthis.align = new EShapeGroupTextAlignEditor( parent );\r\n\t\tthis.offset = new EShapeGroupTextOffsetEditor( parent );\r\n\t\tthis.outline = new EShapeGroupTextOutlineEditor( parent );\r\n\t\tthis.spacing = new EShapeGroupTextSpacingEditor( parent );\r\n\t\tthis.padding = new EShapeGroupTextPaddingEditor( parent );\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.enable;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.enable = enable;\r\n\t\t}\r\n\t}\r\n\r\n\tget value(): string {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.value;\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tset value( value: string ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.value = value;\r\n\t\t}\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.color;\r\n\t\t}\r\n\t\treturn 0x000000;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.color = color;\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.alpha;\r\n\t\t}\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.alpha = alpha;\r\n\t\t}\r\n\t}\r\n\r\n\tget family(): string {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.family;\r\n\t\t}\r\n\t\treturn \"auto\";\r\n\t}\r\n\r\n\tset family( family: string ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.family = family;\r\n\t\t}\r\n\t}\r\n\r\n\tget size(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.size;\r\n\t\t}\r\n\t\treturn 24;\r\n\t}\r\n\r\n\tset size( size: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.size = size;\r\n\t\t}\r\n\t}\r\n\r\n\tget weight(): EShapeTextWeight {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.weight;\r\n\t\t}\r\n\t\treturn EShapeTextWeight.NORMAL;\r\n\t}\r\n\r\n\tset weight( weight: EShapeTextWeight ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.weight = weight;\r\n\t\t}\r\n\t}\r\n\r\n\tget style(): EShapeTextStyle {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.style;\r\n\t\t}\r\n\t\treturn EShapeTextStyle.NORMAL;\r\n\t}\r\n\r\n\tset style( style: EShapeTextStyle ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.style = style;\r\n\t\t}\r\n\t}\r\n\r\n\tget direction(): number {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.direction;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset direction( direction: number ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.direction = direction;\r\n\t\t}\r\n\t}\r\n\r\n\tget clipping(): boolean {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.clipping;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tset clipping( clipping: boolean ) {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.clipping = clipping;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( target?: DeepPartial<EShapeTextLike> ): this {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.copy( target );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue?: string, color?: number, alpha?: number,\r\n\t\tfamily?: string, size?: number, weight?: EShapeTextWeight,\r\n\t\tstyle?: EShapeTextStyle, direction?: EShapeTextDirection\r\n\t): this {\r\n\t\tconst children = this._parent.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].text.set( value, color, alpha, family, size, weight, style, direction );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ttoObject(): EShapeTextLike {\r\n\t\tconst children = this._parent.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].text.toObject();\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tvalue: \"\",\r\n\t\t\tcolor: 0x000000,\r\n\t\t\talpha: 1.0,\r\n\t\t\tfamily: \"auto\",\r\n\t\t\tsize: 24,\r\n\t\t\tweight: EShapeTextWeight.NORMAL,\r\n\t\t\talign: this.align.toObject(),\r\n\t\t\toffset: this.offset.toObject(),\r\n\t\t\tstyle: EShapeTextStyle.NORMAL,\r\n\t\t\toutline: this.outline.toObject(),\r\n\t\t\tspacing: this.spacing.toObject(),\r\n\t\t\tdirection: EShapeTextDirection.LEFT_TO_RIGHT,\r\n\t\t\tpadding: this.padding.toObject(),\r\n\t\t\tclipping: false\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ) {\r\n\t\t//\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { EShapeCorner } from \"../e-shape-corner\";\r\nimport { EShapeDefaults } from \"../e-shape-defaults\";\r\nimport { EShapeFill } from \"../e-shape-fill\";\r\nimport { EShapeGradientLike } from \"../e-shape-gradient\";\r\nimport { EShapePoints } from \"../e-shape-points\";\r\nimport { EShapeStroke } from \"../e-shape-stroke\";\r\nimport { EShapeTag } from \"../e-shape-tag\";\r\nimport { EShapeText } from \"../e-shape-text\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeBase } from \"./e-shape-base\";\r\nimport { EShapeGroupFillEditor } from \"./e-shape-group-fill-editor\";\r\nimport { EShapeGroupPoints } from \"./e-shape-group-points\";\r\nimport { EShapeGroupPropertyParent } from \"./e-shape-group-property-parent\";\r\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\r\nimport { EShapeGroupSizeEditor } from \"./e-shape-group-size-editor\";\r\nimport { EShapeGroupSizeViewer } from \"./e-shape-group-size-viewer\";\r\nimport { EShapeGroupStrokeEditor } from \"./e-shape-group-stroke-editor\";\r\nimport { EShapeGroupTextEditor } from \"./e-shape-group-text-editor\";\r\nimport { EShapeTagImpl } from \"./e-shape-tag-impl\";\r\n\r\nexport class EShapeGroup extends EShapeBase implements EShapeGroupPropertyParent {\r\n\tsize: EShapeGroupSize;\r\n\tfill: EShapeFill;\r\n\tstroke: EShapeStroke;\r\n\ttag: EShapeTag;\r\n\ttext: EShapeText;\r\n\r\n\tprotected _points?: EShapeGroupPoints;\r\n\r\n\tconstructor( type = EShapeType.GROUP ) {\r\n\t\tsuper( type );\r\n\t\tthis.tag = new EShapeTagImpl();\r\n\t\tthis.size = this.newGroupSize();\r\n\t\tthis.fill = this.newGroupFill();\r\n\t\tthis.stroke = this.newGroupStroke();\r\n\t\tthis.text = this.newGroupText();\r\n\t\tthis.points = this.newGroupPoints();\r\n\t}\r\n\r\n\tprotected newGroupSize(): EShapeGroupSize {\r\n\t\tif( EShapeDefaults.IS_EDIT_MODE ) {\r\n\t\t\treturn new EShapeGroupSizeEditor(\r\n\t\t\t\tthis,\r\n\t\t\t\tEShapeDefaults.SIZE_X,\r\n\t\t\t\tEShapeDefaults.SIZE_Y\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tconst result = new EShapeGroupSizeViewer(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tconst base = result.base;\r\n\t\t\t\t\tthis.transform.scale.set(\r\n\t\t\t\t\t\tresult.x / base.x,\r\n\t\t\t\t\t\tresult.y / base.y\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\tEShapeDefaults.SIZE_X,\r\n\t\t\t\tEShapeDefaults.SIZE_Y\r\n\t\t\t);\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newGroupFill(): EShapeFill {\r\n\t\treturn new EShapeGroupFillEditor( this );\r\n\t}\r\n\r\n\tprotected newGroupStroke(): EShapeStroke {\r\n\t\treturn new EShapeGroupStrokeEditor( this );\r\n\t}\r\n\r\n\tprotected newGroupText(): EShapeText {\r\n\t\treturn new EShapeGroupTextEditor( this );\r\n\t}\r\n\r\n\tprotected newGroupPoints(): EShapePoints | undefined {\r\n\t\treturn new EShapeGroupPoints( this );\r\n\t}\r\n\r\n\tprotected getBoundsSize(): IPoint {\r\n\t\tconst size = this.size;\r\n\t\tif( size instanceof EShapeGroupSizeViewer ) {\r\n\t\t\treturn size.base;\r\n\t\t} else {\r\n\t\t\treturn size;\r\n\t\t}\r\n\t}\r\n\r\n\tonChildTransformChange(): void {\r\n\t\tsuper.onChildTransformChange();\r\n\t\tthis.size.fit();\r\n\t}\r\n\r\n\tget corner(): EShapeCorner {\r\n\t\tconst children = this.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].corner;\r\n\t\t}\r\n\t\treturn EShapeCorner.ALL;\r\n\t}\r\n\r\n\tset corner( corner: EShapeCorner ) {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].corner = corner;\r\n\t\t}\r\n\t}\r\n\r\n\tget cursor(): string {\r\n\t\tconst children = this.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].cursor;\r\n\t\t}\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tset cursor( cursor: string ) {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].cursor = cursor;\r\n\t\t}\r\n\t}\r\n\r\n\tget gradient(): EShapeGradientLike | undefined {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst gradient = children[ i ].gradient;\r\n\t\t\tif( gradient != null ) {\r\n\t\t\t\treturn gradient;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tset gradient( gradient: EShapeGradientLike | undefined ) {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].gradient = gradient;\r\n\t\t}\r\n\t}\r\n\r\n\tget radius(): number {\r\n\t\tconst children = this.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn children[ children.length - 1 ].radius;\r\n\t\t}\r\n\t\treturn 0.5;\r\n\t}\r\n\r\n\tset radius( radius: number ) {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].radius = radius;\r\n\t\t}\r\n\t}\r\n\r\n\tget image(): HTMLImageElement | undefined {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst image = children[ i ].image;\r\n\t\t\tif( image != null ) {\r\n\t\t\t\treturn image;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tset image( image: HTMLImageElement | undefined ) {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tchildren[ i ].image = image;\r\n\t\t}\r\n\t}\r\n\r\n\tget points(): EShapePoints | undefined {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst points = children[ i ].points;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\treturn this._points;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tset points( points: EShapePoints | undefined ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tclone(): EShapeGroup {\r\n\t\tconst constructor = this.constructor as new () => EShapeGroup;\r\n\t\tconst result = new constructor().copy( this );\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst clone = children[ i ].clone();\r\n\t\t\tclone.parent = result;\r\n\t\t\tresult.children.push( clone );\r\n\t\t}\r\n\t\tresult.onChildTransformChange();\r\n\t\tresult.toDirty();\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeGroup } from \"./e-shape-group\";\r\n\r\nexport const deserializeGroup = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeGroup> | EShapeGroup => {\r\n\tconst shape = new EShapeGroup();\r\n\tconst result = EShapeDeserializer.deserialize( item, manager, shape );\r\n\tshape.size.init();\r\n\treturn result;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createGroupUploaded } from \"../variant/create-group-uploaded\";\r\nimport { deserializeGroup } from \"../variant/deserialize-group\";\r\n\r\nexport const loadShapeGroup = () => {\r\n\tEShapeUploadeds[ EShapeType.GROUP ] = createGroupUploaded;\r\n\tEShapeDeserializers[ EShapeType.GROUP ] = deserializeGroup;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint, Point } from \"pixi.js\";\r\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\r\nimport { EShapeGroupSizeParent } from \"./e-shape-group-size-parent\";\r\n\r\nexport class EShapeGroupSizeShadowed implements EShapeGroupSize {\r\n\tprotected _parent: EShapeGroupSizeParent;\r\n\tprotected _size: Point;\r\n\r\n\tconstructor( parent: EShapeGroupSizeParent, x: number, y: number ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._size = new Point( x, y );\r\n\t}\r\n\r\n\tinit(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._size.x;\r\n\t}\r\n\r\n\tset x( x: number ) {\r\n\t\tconst size = this._size;\r\n\t\tif( size.x !== x ) {\r\n\t\t\tconst ox = size.x;\r\n\t\t\tsize.x = x;\r\n\t\t\tthis.onChange( ox, size.y );\r\n\t\t}\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._size.y;\r\n\t}\r\n\r\n\tset y( y: number ) {\r\n\t\tconst size = this._size;\r\n\t\tif( size.y !== y ) {\r\n\t\t\tconst oy = size.y;\r\n\t\t\tsize.y = y;\r\n\t\t\tthis.onChange( size.x, oy );\r\n\t\t}\r\n\t}\r\n\r\n\tset( x?: number | undefined, y?: number | undefined ): this {\r\n\t\tlet isChanged = false;\r\n\t\tconst size = this._size;\r\n\t\tconst ox = size.x;\r\n\t\tconst oy = size.y;\r\n\t\tif( x != null && ox !== x ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tsize.x = x;\r\n\t\t}\r\n\t\tif( y != null && oy !== y ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tsize.y = y;\r\n\t\t}\r\n\t\tif( isChanged ) {\r\n\t\t\tthis.onChange( ox, oy );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone(): EShapeGroupSizeShadowed {\r\n\t\tconst size = this._size;\r\n\t\treturn new EShapeGroupSizeShadowed( this._parent, size.x, size.y );\r\n\t}\r\n\r\n\tcopy(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopyFrom( point: IPoint ): this {\r\n\t\tconst x = point.x;\r\n\t\tconst y = point.y;\r\n\t\tconst size = this._size;\r\n\t\tconst ox = size.x;\r\n\t\tconst oy = size.y;\r\n\t\tif( ox !== x || oy !== y ) {\r\n\t\t\tsize.x = x;\r\n\t\t\tsize.y = y;\r\n\t\t\tthis.onChange( ox, oy );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcopyTo( point: IPoint ): IPoint {\r\n\t\treturn this._size.copyTo( point );\r\n\t}\r\n\r\n\tequals( point: IPoint ): boolean {\r\n\t\treturn this._size.equals( point );\r\n\t}\r\n\r\n\tfit(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected onChange( ox: number, oy: number ): void {\r\n\t\tthis._parent.onSizeChange();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDefaults } from \"../e-shape-defaults\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeGroup } from \"./e-shape-group\";\r\nimport { EShapeGroupSize } from \"./e-shape-group-size\";\r\nimport { EShapeGroupSizeShadowed } from \"./e-shape-group-size-shadowed\";\r\n\r\nexport class EShapeGroupShadowed extends EShapeGroup {\r\n\tconstructor( type: EShapeType = EShapeType.GROUP_SHADOWED ) {\r\n\t\tsuper( type );\r\n\t}\r\n\r\n\tprotected newGroupSize(): EShapeGroupSize {\r\n\t\tif( EShapeDefaults.IS_EDIT_MODE ) {\r\n\t\t\treturn new EShapeGroupSizeShadowed(\r\n\t\t\t\tthis,\r\n\t\t\t\tEShapeDefaults.SIZE_X,\r\n\t\t\t\tEShapeDefaults.SIZE_Y\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn super.newGroupSize();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeGroupShadowed } from \"./e-shape-group-shadowed\";\r\n\r\nexport const deserializeGroupShadowed = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeGroupShadowed> | EShapeGroupShadowed => {\r\n\tconst shape = new EShapeGroupShadowed();\r\n\tconst result = EShapeDeserializer.deserialize( item, manager, shape );\r\n\tshape.size.init();\r\n\treturn result;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createGroupUploaded } from \"../variant/create-group-uploaded\";\r\nimport { deserializeGroupShadowed } from \"../variant/deserialize-group-shadowed\";\r\n\r\nexport const loadShapeGroupShadowed = () => {\r\n\tEShapeUploadeds[ EShapeType.GROUP_SHADOWED ] = createGroupUploaded;\r\n\tEShapeDeserializers[ EShapeType.GROUP_SHADOWED ] = deserializeGroupShadowed;\r\n};\r\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\r\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\r\nimport { toLength } from \"./to-length\";\r\nimport { STEP_VALUES, toStep } from \"./to-step\";\r\n\r\nexport const RECTANGLE_VERTEX_COUNT = 18;\r\nexport const RECTANGLE_INDEX_COUNT = 12;\r\nexport const RECTANGLE_WORLD_SIZE: [ number, number, number ] = [ 0, 0, 0 ];\r\nconst RECTANGLE_WORK_POINT: Point = new Point();\r\n\r\nexport const buildRectangleClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\tconst br = worldSize[ 0 ];\r\n\tconst bri = 1 - br;\r\n\tconst worldSizeX = worldSize[ 1 ];\r\n\tconst worldSizeY = worldSize[ 2 ];\r\n\tif( worldSizeX < worldSizeY ) {\r\n\t\tbuildRectangleClippingVertical(\r\n\t\t\t0, 1,\r\n\t\t\t0, bri,\r\n\t\t\tclippings,\r\n\t\t\tvoffset\r\n\t\t);\r\n\t} else {\r\n\t\tbuildRectangleClippingVertical(\r\n\t\t\t1, 0,\r\n\t\t\tbri, 0,\r\n\t\t\tclippings,\r\n\t\t\tvoffset\r\n\t\t);\r\n\t}\r\n};\r\n\r\nexport const buildRectangleClippingVertical = (\r\n\tcx: number, cy: number,\r\n\tcbx: number, cby: number,\r\n\tclippings: Float32Array,\r\n\tvoffset: number\r\n): void => {\r\n\tlet ic = voffset * 3;\r\n\r\n\tclippings[ ic + 0 ] = cx;\r\n\tclippings[ ic + 1 ] = cy;\r\n\tclippings[ ic + 2 ] = 0;\r\n\r\n\tclippings[ ic + 3 ] = cx;\r\n\tclippings[ ic + 4 ] = cy;\r\n\tclippings[ ic + 5 ] = 0;\r\n\r\n\tclippings[ ic + 6 ] = cx;\r\n\tclippings[ ic + 7 ] = cy;\r\n\tclippings[ ic + 8 ] = 0;\r\n\tic += 9;\r\n\r\n\tclippings[ ic + 0 ] = cbx;\r\n\tclippings[ ic + 1 ] = cby;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = cbx;\r\n\tclippings[ ic + 1 ] = cby;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = cx;\r\n\tclippings[ ic + 1 ] = cy;\r\n\tclippings[ ic + 2 ] = 0;\r\n\r\n\tclippings[ ic + 3 ] = cx;\r\n\tclippings[ ic + 4 ] = cy;\r\n\tclippings[ ic + 5 ] = 0;\r\n\r\n\tclippings[ ic + 6 ] = cx;\r\n\tclippings[ ic + 7 ] = cy;\r\n\tclippings[ ic + 8 ] = 0;\r\n\tic += 9;\r\n\r\n\t// --------------------------------\r\n\r\n\tclippings[ ic +  0 ] = cy;\r\n\tclippings[ ic +  1 ] = cx;\r\n\tclippings[ ic +  2 ] = 0;\r\n\r\n\tclippings[ ic +  3 ] = cy;\r\n\tclippings[ ic +  4 ] = cx;\r\n\tclippings[ ic +  5 ] = 0;\r\n\r\n\tclippings[ ic +  6 ] = cy;\r\n\tclippings[ ic +  7 ] = cx;\r\n\tclippings[ ic +  8 ] = 0;\r\n\r\n\tclippings[ ic +  9 ] = cy;\r\n\tclippings[ ic + 10 ] = cx;\r\n\tclippings[ ic + 11 ] = 0;\r\n\tic += 12;\r\n\r\n\tclippings[ ic + 0 ] = 0;\r\n\tclippings[ ic + 1 ] = 0;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 0;\r\n\tclippings[ ic + 1 ] = 0;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\t// --------------------------------\r\n\r\n\tclippings[ ic +  0 ] = cy;\r\n\tclippings[ ic +  1 ] = cx;\r\n\tclippings[ ic +  2 ] = 0;\r\n\r\n\tclippings[ ic +  3 ] = cy;\r\n\tclippings[ ic +  4 ] = cx;\r\n\tclippings[ ic +  5 ] = 0;\r\n\r\n\tclippings[ ic +  6 ] = cy;\r\n\tclippings[ ic +  7 ] = cx;\r\n\tclippings[ ic +  8 ] = 0;\r\n\r\n\tclippings[ ic +  9 ] = cy;\r\n\tclippings[ ic + 10 ] = cx;\r\n\tclippings[ ic + 11 ] = 0;\r\n};\r\n\r\nexport const buildRectangleIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number\r\n): void => {\r\n\tlet ii = ioffset * 3;\r\n\tindices[ ii + 0 ] = voffset + 0;\r\n\tindices[ ii + 1 ] = voffset + 1;\r\n\tindices[ ii + 2 ] = voffset + 3;\r\n\tii += 3;\r\n\r\n\tindices[ ii + 0 ] = voffset + 1;\r\n\tindices[ ii + 1 ] = voffset + 2;\r\n\tindices[ ii + 2 ] = voffset + 3;\r\n\tii += 3;\r\n\r\n\tindices[ ii + 0 ] = voffset + 4;\r\n\tindices[ ii + 1 ] = voffset + 6;\r\n\tindices[ ii + 2 ] = voffset + 5;\r\n\tii += 3;\r\n\r\n\tindices[ ii + 0 ] = voffset + 4;\r\n\tindices[ ii + 1 ] = voffset + 7;\r\n\tindices[ ii + 2 ] = voffset + 6;\r\n\tii += 3;\r\n\r\n\t// --------------------------------\r\n\r\n\tindices[ ii + 0 ] = voffset + 8;\r\n\tindices[ ii + 1 ] = voffset + 12;\r\n\tindices[ ii + 2 ] = voffset + 9;\r\n\tii += 3;\r\n\r\n\tindices[ ii + 0 ] = voffset + 9;\r\n\tindices[ ii + 1 ] = voffset + 12;\r\n\tindices[ ii + 2 ] = voffset + 10;\r\n\tii += 3;\r\n\r\n\tindices[ ii + 0 ] = voffset + 10;\r\n\tindices[ ii + 1 ] = voffset + 12;\r\n\tindices[ ii + 2 ] = voffset + 13;\r\n\tii += 3;\r\n\r\n\tindices[ ii + 0 ] = voffset + 10;\r\n\tindices[ ii + 1 ] = voffset + 13;\r\n\tindices[ ii + 2 ] = voffset + 11;\r\n\tii += 3;\r\n\r\n\t// --------------------------------\r\n\r\n\tindices[ ii + 0 ] = voffset + 14;\r\n\tindices[ ii + 1 ] = voffset + 15;\r\n\tindices[ ii + 2 ] = voffset + 12;\r\n\tii += 3;\r\n\r\n\tindices[ ii + 0 ] = voffset + 12;\r\n\tindices[ ii + 1 ] = voffset + 15;\r\n\tindices[ ii + 2 ] = voffset + 16;\r\n\tii += 3;\r\n\r\n\tindices[ ii + 0 ] = voffset + 16;\r\n\tindices[ ii + 1 ] = voffset + 13;\r\n\tindices[ ii + 2 ] = voffset + 12;\r\n\tii += 3;\r\n\r\n\tindices[ ii + 0 ] = voffset + 13;\r\n\tindices[ ii + 1 ] = voffset + 16;\r\n\tindices[ ii + 2 ] = voffset + 17;\r\n};\r\n\r\nexport const buildRectangleVertex = (\r\n\tvertices: Float32Array,\r\n\tvoffset: number,\r\n\toriginX: number,\r\n\toriginY: number,\r\n\tsizeX: number,\r\n\tsizeY: number,\r\n\tstrokeAlign: number,\r\n\tstrokeWidth: number,\r\n\tinternalTransform: Matrix,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\t// 0               1\r\n\t// |-------|-------|\r\n\t// |       |       |\r\n\t// |-------|-------|\r\n\t// |       |       |\r\n\t// |-------|-------|\r\n\t//                 2\r\n\tconst s = strokeAlign * strokeWidth;\r\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\r\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\r\n\tconst work = RECTANGLE_WORK_POINT;\r\n\twork.set( originX - sx, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst bx0 = work.x;\r\n\tconst by0 = work.y;\r\n\twork.set( originX + sx, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst bx1 = work.x;\r\n\tconst by1 = work.y;\r\n\twork.set( originX + sx, originY + sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst bx2 = work.x;\r\n\tconst by2 = work.y;\r\n\tconst bx3 = bx0 + (bx2 - bx1);\r\n\tconst by3 = by0 + (by2 - by1);\r\n\r\n\tconst ax = toLength( bx0, by0, bx1, by1 ) * 0.5;\r\n\tconst ay = toLength( bx1, by1, bx2, by2 ) * 0.5;\r\n\tworldSize[ 1 ] = ax;\r\n\tworldSize[ 2 ] = ay;\r\n\tif( ax <= ay ) {\r\n\t\tconst br = ax / ay;\r\n\t\tworldSize[ 0 ] = br;\r\n\t\tbuildRectangleVertexVertical(\r\n\t\t\tbr,\r\n\t\t\tbx0, by0,\r\n\t\t\tbx1, by1,\r\n\t\t\tbx2, by2,\r\n\t\t\tbx3, by3,\r\n\t\t\tvertices,\r\n\t\t\tvoffset,\r\n\t\t\tworldSize\r\n\t\t);\r\n\t} else {\r\n\t\tconst br = ay / ax;\r\n\t\tworldSize[ 0 ] = br;\r\n\t\tbuildRectangleVertexVertical(\r\n\t\t\tbr,\r\n\t\t\tbx3, by3,\r\n\t\t\tbx0, by0,\r\n\t\t\tbx1, by1,\r\n\t\t\tbx2, by2,\r\n\t\t\tvertices,\r\n\t\t\tvoffset,\r\n\t\t\tworldSize\r\n\t\t);\r\n\t}\r\n};\r\n\r\nexport const buildRectangleVertexVertical = (\r\n\tbr: number,\r\n\tbx0: number, by0: number,\r\n\tbx1: number, by1: number,\r\n\tbx2: number, by2: number,\r\n\tbx3: number, by3: number,\r\n\tvertices: Float32Array,\r\n\tvoffset: number,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\t// 0       1       2\r\n\t// |-------|-------|\r\n\t// |       |       |\r\n\t// |-------3-------|\r\n\t// |       |       |\r\n\t// |-------4-------|\r\n\t// |       |       |\r\n\t// |-------|-------|\r\n\t// 5       6       7\r\n\tconst x0 = bx0;\r\n\tconst y0 = by0;\r\n\tconst x1 = (bx0 + bx1) * 0.5;\r\n\tconst y1 = (by0 + by1) * 0.5;\r\n\tconst x2 = bx1;\r\n\tconst y2 = by1;\r\n\r\n\tconst xc = (bx0 + bx2) * 0.5;\r\n\tconst yc = (by0 + by2) * 0.5;\r\n\tconst x3 = x1 + br * (xc - x1);\r\n\tconst y3 = y1 + br * (yc - y1);\r\n\r\n\tconst x5 = bx3;\r\n\tconst y5 = by3;\r\n\tconst x6 = (bx3 + bx2) * 0.5;\r\n\tconst y6 = (by3 + by2) * 0.5;\r\n\tconst x7 = bx2;\r\n\tconst y7 = by2;\r\n\r\n\tconst x4 = x6 + br * (xc - x6);\r\n\tconst y4 = y6 + br * (yc - y6);\r\n\r\n\tlet iv = voffset << 1;\r\n\tvertices[ iv + 0 ] = x0;\r\n\tvertices[ iv + 1 ] = y0;\r\n\tvertices[ iv + 2 ] = x1;\r\n\tvertices[ iv + 3 ] = y1;\r\n\tvertices[ iv + 4 ] = x2;\r\n\tvertices[ iv + 5 ] = y2;\r\n\tiv += 6;\r\n\r\n\tvertices[ iv + 0 ] = x3;\r\n\tvertices[ iv + 1 ] = y3;\r\n\tiv += 2;\r\n\r\n\tvertices[ iv + 0 ] = x4;\r\n\tvertices[ iv + 1 ] = y4;\r\n\tiv += 2;\r\n\r\n\tvertices[ iv + 0 ] = x5;\r\n\tvertices[ iv + 1 ] = y5;\r\n\tvertices[ iv + 2 ] = x6;\r\n\tvertices[ iv + 3 ] = y6;\r\n\tvertices[ iv + 4 ] = x7;\r\n\tvertices[ iv + 5 ] = y7;\r\n\tiv += 6;\r\n\r\n\t// 8               14\r\n\t// |-------|-------|\r\n\t// |       |       |\r\n\t// 9-------12------15\r\n\t// |       |       |\r\n\t// 10------13------16\r\n\t// |       |       |\r\n\t// |-------|-------|\r\n\t// 11              17\r\n\tconst xcl = (bx0 + bx3) * 0.5;\r\n\tconst ycl = (by0 + by3) * 0.5;\r\n\tconst x8 = bx0;\r\n\tconst y8 = by0;\r\n\tconst x9 = bx0 + br * (xcl - bx0);\r\n\tconst y9 = by0 + br * (ycl - by0);\r\n\tconst x10 = bx3 + br * (xcl - bx3);\r\n\tconst y10 = by3 + br * (ycl - by3);\r\n\tconst x11 = bx3;\r\n\tconst y11 = by3;\r\n\r\n\tconst x12 = x3;\r\n\tconst y12 = y3;\r\n\tconst x13 = x4;\r\n\tconst y13 = y4;\r\n\r\n\tconst xcr = (bx1 + bx2) * 0.5;\r\n\tconst ycr = (by1 + by2) * 0.5;\r\n\tconst x14 = bx1;\r\n\tconst y14 = by1;\r\n\tconst x15 = bx1 + br * (xcr - bx1);\r\n\tconst y15 = by1 + br * (ycr - by1);\r\n\tconst x16 = bx2 + br * (xcr - bx2);\r\n\tconst y16 = by2 + br * (ycr - by2);\r\n\tconst x17 = bx2;\r\n\tconst y17 = by2;\r\n\r\n\tvertices[ iv + 0 ] = x8;\r\n\tvertices[ iv + 1 ] = y8;\r\n\tvertices[ iv + 2 ] = x9;\r\n\tvertices[ iv + 3 ] = y9;\r\n\tvertices[ iv + 4 ] = x10;\r\n\tvertices[ iv + 5 ] = y10;\r\n\tvertices[ iv + 6 ] = x11;\r\n\tvertices[ iv + 7 ] = y11;\r\n\tiv += 8;\r\n\r\n\tvertices[ iv + 0 ] = x12;\r\n\tvertices[ iv + 1 ] = y12;\r\n\tiv += 2;\r\n\r\n\tvertices[ iv + 0 ] = x13;\r\n\tvertices[ iv + 1 ] = y13;\r\n\tiv += 2;\r\n\r\n\tvertices[ iv + 0 ] = x14;\r\n\tvertices[ iv + 1 ] = y14;\r\n\tvertices[ iv + 2 ] = x15;\r\n\tvertices[ iv + 3 ] = y15;\r\n\tvertices[ iv + 4 ] = x16;\r\n\tvertices[ iv + 5 ] = y16;\r\n\tvertices[ iv + 6 ] = x17;\r\n\tvertices[ iv + 7 ] = y17;\r\n};\r\n\r\nexport const buildRectangleStep = (\r\n\tvoffset: number,\r\n\tsteps: Float32Array,\r\n\tstrokeWidth: number,\r\n\tstrokeSide: EShapeStrokeSide,\r\n\tantialiasWeight: number,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\tconst br = worldSize[ 0 ];\r\n\tconst bri = 1 - br;\r\n\tconst worldSizeX = worldSize[ 1 ];\r\n\tconst worldSizeY = worldSize[ 2 ];\r\n\ttoStep( worldSizeX, strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swx = STEP_VALUES[ 0 ];\r\n\tconst px0 = STEP_VALUES[ 1 ];\r\n\tconst px1 = STEP_VALUES[ 2 ];\r\n\r\n\ttoStep( worldSizeY, strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swy = STEP_VALUES[ 0 ];\r\n\tconst py0 = STEP_VALUES[ 1 ];\r\n\tconst py1 = STEP_VALUES[ 2 ];\r\n\r\n\tlet swt = swy;\r\n\tlet pt0 = py0;\r\n\tif( ! (strokeSide & EShapeStrokeSide.TOP) ) {\r\n\t\tswt = 1;\r\n\t\tpt0 = py1;\r\n\t}\r\n\tlet swr = swx;\r\n\tlet pr0 = px0;\r\n\tif( ! (strokeSide & EShapeStrokeSide.RIGHT) ) {\r\n\t\tswr = 1;\r\n\t\tpr0 = px1;\r\n\t}\r\n\tlet swb = swy;\r\n\tlet pb0 = py0;\r\n\tif( ! (strokeSide & EShapeStrokeSide.BOTTOM) ) {\r\n\t\tswb = 1;\r\n\t\tpb0 = py1;\r\n\t}\r\n\tlet swl = swx;\r\n\tlet pl0 = px0;\r\n\tif( ! (strokeSide & EShapeStrokeSide.LEFT) ) {\r\n\t\tswl = 1;\r\n\t\tpl0 = px1;\r\n\t}\r\n\tconst pc0 = 0.5 * (pl0 + pr0);\r\n\tconst pm0 = 0.5 * (pt0 + pb0);\r\n\tif( worldSizeX < worldSizeY ) {\r\n\t\tbuildRectangleStepVertical(\r\n\t\t\tbri,\r\n\t\t\tswx, px0, px1,\r\n\t\t\tswy, py0, py1,\r\n\t\t\tswt, pt0,\r\n\t\t\tswr, pr0,\r\n\t\t\tswb, pb0,\r\n\t\t\tswl, pl0,\r\n\t\t\tpc0, pm0,\r\n\t\t\tvoffset,\r\n\t\t\tsteps\r\n\t\t);\r\n\t} else {\r\n\t\tbuildRectangleStepHorizontal(\r\n\t\t\tbri,\r\n\t\t\tswx, px0, px1,\r\n\t\t\tswy, py0, py1,\r\n\t\t\tswt, pt0,\r\n\t\t\tswr, pr0,\r\n\t\t\tswb, pb0,\r\n\t\t\tswl, pl0,\r\n\t\t\tpc0, pm0,\r\n\t\t\tvoffset,\r\n\t\t\tsteps\r\n\t\t);\r\n\t}\r\n};\r\n\r\nexport const buildRectangleStepVertical = (\r\n\tbri: number,\r\n\tswx: number, px0: number, px1: number,\r\n\tswy: number, py0: number, py1: number,\r\n\tswt: number, pt0: number,\r\n\tswr: number, pr0: number,\r\n\tswb: number, pb0: number,\r\n\tswl: number, pl0: number,\r\n\tpc0: number, pm0: number,\r\n\tvoffset: number,\r\n\tsteps: Float32Array\r\n): void => {\r\n\tlet is = voffset * 6;\r\n\r\n\t// 0\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 1\r\n\tsteps[ is     ] = 0;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pc0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 2\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 3\r\n\tsteps[ is     ] = 0;\r\n\tsteps[ is + 1 ] = bri * swt;\r\n\tsteps[ is + 2 ] = pc0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 4\r\n\tsteps[ is     ] = 0;\r\n\tsteps[ is + 1 ] = bri * swb;\r\n\tsteps[ is + 2 ] = pc0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 5\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 6\r\n\tsteps[ is     ] = 0;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pc0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 7\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// ------------------------------\r\n\r\n\t// 8\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 9\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = bri * swt;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 10\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = bri * swb;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 11\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// ------------------------------\r\n\r\n\t// 12\r\n\tsteps[ is     ] = 0;\r\n\tsteps[ is + 1 ] = bri * swt;\r\n\tsteps[ is + 2 ] = pc0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 13\r\n\tsteps[ is     ] = 0;\r\n\tsteps[ is + 1 ] = bri * swb;\r\n\tsteps[ is + 2 ] = pc0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// ------------------------------\r\n\r\n\t// 14\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 15\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = bri * swt;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 16\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = bri * swb;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 17\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n};\r\n\r\nexport const buildRectangleStepHorizontal = (\r\n\tbri: number,\r\n\tswx: number, px0: number, px1: number,\r\n\tswy: number, py0: number, py1: number,\r\n\tswt: number, pt0: number,\r\n\tswr: number, pr0: number,\r\n\tswb: number, pb0: number,\r\n\tswl: number, pl0: number,\r\n\tpc0: number, pm0: number,\r\n\tvoffset: number,\r\n\tsteps: Float32Array\r\n): void => {\r\n\tlet is = voffset * 6;\r\n\r\n\t// 0\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 1\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pm0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 2\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 3\r\n\tsteps[ is     ] = bri * swl;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pm0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 4\r\n\tsteps[ is     ] = bri * swr;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pm0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 5\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 6\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pm0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 7\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// ------------------------------\r\n\r\n\t// 8\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 9\r\n\tsteps[ is     ] = bri * swl;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 10\r\n\tsteps[ is     ] = bri * swr;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 11\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// ------------------------------\r\n\r\n\t// 12\r\n\tsteps[ is     ] = bri * swl;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pm0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 13\r\n\tsteps[ is     ] = bri * swr;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pm0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// ------------------------------\r\n\r\n\t// 14\r\n\tsteps[ is     ] = swl;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 15\r\n\tsteps[ is     ] = bri * swl;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 16\r\n\tsteps[ is     ] = bri * swr;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// 17\r\n\tsteps[ is     ] = swr;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n};\r\n\r\nexport const buildRectangleUv = (\r\n\tuvs: Float32Array,\r\n\tvoffset: number,\r\n\ttextureUvs: TextureUvs,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\tconst br = worldSize[ 0 ];\r\n\tconst bri = 1 - br;\r\n\tconst worldSizeX = worldSize[ 1 ];\r\n\tconst worldSizeY = worldSize[ 2 ];\r\n\tconst x0 = textureUvs.x0;\r\n\tconst x1 = textureUvs.x1;\r\n\tconst x2 = textureUvs.x2;\r\n\tconst x3 = textureUvs.x3;\r\n\tconst y0 = textureUvs.y0;\r\n\tconst y1 = textureUvs.y1;\r\n\tconst y2 = textureUvs.y2;\r\n\tconst y3 = textureUvs.y3;\r\n\tif( worldSizeX < worldSizeY ) {\r\n\t\tbuildRectangleUvVertical(\r\n\t\t\tbri,\r\n\t\t\tx0, x1, x2, x3,\r\n\t\t\ty0, y1, y2, y3,\r\n\t\t\tuvs, voffset\r\n\t\t);\r\n\t} else {\r\n\t\tbuildRectangleUvVertical(\r\n\t\t\tbri,\r\n\t\t\tx3, x0, x1, x2,\r\n\t\t\ty3, y0, y1, y2,\r\n\t\t\tuvs, voffset\r\n\t\t);\r\n\t}\r\n};\r\n\r\nexport const buildRectangleUvVertical = (\r\n\tbri: number,\r\n\tx0: number, x1: number, x2: number, x3: number,\r\n\ty0: number, y1: number, y2: number, y3: number,\r\n\tuvs: Float32Array,\r\n\tvoffset: number\r\n): void => {\r\n\tconst x01 = 0.5 * ( x0 + x1 );\r\n\tconst y01 = 0.5 * ( y0 + y1 );\r\n\tconst x02 = 0.5 * ( x0 + x2 );\r\n\tconst y02 = 0.5 * ( y0 + y2 );\r\n\tconst x23 = 0.5 * ( x2 + x3 );\r\n\tconst y23 = 0.5 * ( y2 + y3 );\r\n\tconst x03 = 0.5 * ( x0 + x3 );\r\n\tconst y03 = 0.5 * ( y0 + y3 );\r\n\tconst x12 = 0.5 * ( x1 + x2 );\r\n\tconst y12 = 0.5 * ( y1 + y2 );\r\n\r\n\tconst xbu = x02 + bri * (x01 - x02);\r\n\tconst ybu = y02 + bri * (y01 - y02);\r\n\r\n\tconst xbb = x02 + bri * (x23 - x02);\r\n\tconst ybb = y02 + bri * (y23 - y02);\r\n\r\n\t// UVs\r\n\tlet iuv = voffset << 1;\r\n\tuvs[ iuv + 0 ] = x0;\r\n\tuvs[ iuv + 1 ] = y0;\r\n\tuvs[ iuv + 2 ] = x01;\r\n\tuvs[ iuv + 3 ] = y01;\r\n\tuvs[ iuv + 4 ] = x1;\r\n\tuvs[ iuv + 5 ] = y1;\r\n\tiuv += 6;\r\n\r\n\tuvs[ iuv + 0 ] = xbu;\r\n\tuvs[ iuv + 1 ] = ybu;\r\n\tiuv += 2;\r\n\r\n\tuvs[ iuv + 0 ] = xbb;\r\n\tuvs[ iuv + 1 ] = ybb;\r\n\tiuv += 2;\r\n\r\n\tuvs[ iuv + 0 ] = x3;\r\n\tuvs[ iuv + 1 ] = y3;\r\n\tuvs[ iuv + 2 ] = x23;\r\n\tuvs[ iuv + 3 ] = y23;\r\n\tuvs[ iuv + 4 ] = x2;\r\n\tuvs[ iuv + 5 ] = y2;\r\n\tiuv += 6;\r\n\r\n\t// ------------------------------\r\n\r\n\tuvs[ iuv + 0 ] = x0;\r\n\tuvs[ iuv + 1 ] = y0;\r\n\tuvs[ iuv + 2 ] = x03 + bri * (x0 - x03);\r\n\tuvs[ iuv + 3 ] = y03 + bri * (y0 - y03);\r\n\tuvs[ iuv + 4 ] = x03 + bri * (x3 - x03);\r\n\tuvs[ iuv + 5 ] = y03 + bri * (y3 - y03);\r\n\tuvs[ iuv + 6 ] = x3;\r\n\tuvs[ iuv + 7 ] = y3;\r\n\tiuv += 8;\r\n\r\n\tuvs[ iuv + 0 ] = xbu;\r\n\tuvs[ iuv + 1 ] = ybu;\r\n\tiuv += 2;\r\n\r\n\tuvs[ iuv + 0 ] = xbb;\r\n\tuvs[ iuv + 1 ] = ybb;\r\n\tiuv += 2;\r\n\r\n\tuvs[ iuv + 0 ] = x1;\r\n\tuvs[ iuv + 1 ] = y1;\r\n\tuvs[ iuv + 2 ] = x12 + bri * (x1 - x12);\r\n\tuvs[ iuv + 3 ] = y12 + bri * (y1 - y12);\r\n\tuvs[ iuv + 4 ] = x12 + bri * (x2 - x12);\r\n\tuvs[ iuv + 5 ] = y12 + bri * (y2 - y12);\r\n\tuvs[ iuv + 6 ] = x2;\r\n\tuvs[ iuv + 7 ] = y2;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport {\r\n\tbuildRectangleClipping, buildRectangleIndex, buildRectangleStep, buildRectangleUv,\r\n\tbuildRectangleVertex, RECTANGLE_WORLD_SIZE\r\n} from \"./build-rectangle\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport class EShapeRectangleUploaded extends EShapeTextUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateIndices();\r\n\t\tbuildRectangleIndex(\r\n\t\t\tbuffer.indices,\r\n\t\t\tthis.vertexOffset,\r\n\t\t\tthis.indexOffset\r\n\t\t);\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tthis.updateVertexClippingStepAndUv( buffer, shape );\r\n\t\tthis.updateColor( buffer, shape );\r\n\t\tthis.updateText( buffer, shape );\r\n\t}\r\n\r\n\tprotected updateVertexClippingStepAndUv( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst strokeSide = stroke.side;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign ||\r\n\t\t\tthis.strokeWidth !== strokeWidth || this.strokeSide !== strokeSide );\r\n\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tconst isTextureChanged = ( texture !== this.texture || textureTransformId !== this.textureTransformId );\r\n\r\n\t\tconst isVertexChanged = isSizeChanged || isStrokeChanged;\r\n\r\n\t\tif( isVertexChanged || isTransformChanged || isTextureChanged ) {\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\t\t\tthis.strokeSide = strokeSide;\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t}\r\n\r\n\t\t\t// Vertices\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tbuildRectangleVertex(\r\n\t\t\t\tbuffer.vertices, voffset,\r\n\t\t\t\t0, 0,\r\n\t\t\t\tsizeX, sizeY,\r\n\t\t\t\tstrokeAlign, strokeWidth,\r\n\t\t\t\tshape.transform.internalTransform,\r\n\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t);\r\n\r\n\t\t\t// Steps\r\n\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t\tbuildRectangleStep(\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tbuffer.steps,\r\n\t\t\t\t\tstrokeWidth, strokeSide,\r\n\t\t\t\t\tthis.antialiasWeight,\r\n\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// Clippings\r\n\t\t\tif( isVertexChanged ) {\r\n\t\t\t\tbuffer.updateClippings();\r\n\t\t\t\tbuildRectangleClipping(\r\n\t\t\t\t\tbuffer.clippings,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// UVs\r\n\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\tbuffer.updateUvs();\r\n\t\t\t\tbuildRectangleUv(\r\n\t\t\t\t\tbuffer.uvs,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tthis.toTextureUvs( texture ),\r\n\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { RECTANGLE_INDEX_COUNT, RECTANGLE_VERTEX_COUNT } from \"./build-rectangle\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\nimport { EShapeRectangleUploaded } from \"./e-shape-rectangle-uploaded\";\r\n\r\nexport const createRectangleUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeRectangleUploaded | null => {\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst vcount = RECTANGLE_VERTEX_COUNT + tvcount;\r\n\tconst icount = RECTANGLE_INDEX_COUNT + ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new EShapeRectangleUploaded(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapePrimitive } from \"./e-shape-primitive\";\r\n\r\nexport class EShapeRectangle extends EShapePrimitive {\r\n\tconstructor( type = EShapeType.RECTANGLE ) {\r\n\t\tsuper( type );\r\n\t}\r\n\r\n\tclone(): EShapeRectangle {\r\n\t\treturn new EShapeRectangle().copy( this );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tif( super.containsAbsBBox( x, y, ax, ay ) ) {\r\n\t\t\tconst fill = this.fill;\r\n\t\t\tconst stroke = this.stroke;\r\n\t\t\tif( fill.enable ) {\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\tconst strokeWidth = stroke.width;\r\n\t\t\t\tconst strokeSide = stroke.side;\r\n\t\t\t\tif( stroke.enable && 0 < strokeWidth && strokeSide !== EShapeStrokeSide.NONE ) {\r\n\t\t\t\t\tconst wx = Math.max( 0.0, ax - strokeWidth );\r\n\t\t\t\t\tconst wy = Math.max( 0.0, ay - strokeWidth );\r\n\t\t\t\t\tif( ! this.containsAbsBBox( x, y, wx, wy ) ) {\r\n\t\t\t\t\t\tif( strokeSide === EShapeStrokeSide.ALL ) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif( x <= -wx ) {\r\n\t\t\t\t\t\t\t\tif( y <= -wy ) {\r\n\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.TOP_OR_LEFT ) !== 0;\r\n\t\t\t\t\t\t\t\t} else if( +wy <= y ) {\r\n\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.BOTTOM_OR_LEFT ) !== 0;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.LEFT ) !== 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else if( +wx <= x ) {\r\n\t\t\t\t\t\t\t\tif( y <= -wy ) {\r\n\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.TOP_OR_RIGHT ) !== 0;\r\n\t\t\t\t\t\t\t\t} else if( +wy <= y ) {\r\n\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.BOTTOM_OR_RIGHT ) !== 0;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.RIGHT ) !== 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif( y <= -wy ) {\r\n\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.TOP ) !== 0;\r\n\t\t\t\t\t\t\t\t} else if( +wy <= y ) {\r\n\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.BOTTOM ) !== 0;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeRectangle } from \"./e-shape-rectangle\";\r\n\r\nexport class EShapeImage extends EShapeRectangle {\r\n\tconstructor( image?: HTMLImageElement, type = EShapeType.IMAGE ) {\r\n\t\tsuper( type );\r\n\t\tif( image != null ) {\r\n\t\t\tthis.image = image;\r\n\t\t\tthis.size.set( image.width, image.height );\r\n\t\t}\r\n\t\tthis.fill.alpha = 1.0;\r\n\t}\r\n\r\n\tclone(): EShapeImage {\r\n\t\treturn new EShapeImage( this.image ).copy( this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeImage } from \"./e-shape-image\";\r\n\r\nexport const deserializeImage = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeImage> | EShapeImage => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeImage() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createRectangleUploaded } from \"../variant/create-rectangle-uploaded\";\r\nimport { deserializeImage } from \"../variant/deserialize-image\";\r\n\r\nexport const loadShapeImage = () => {\r\n\tEShapeUploadeds[ EShapeType.IMAGE ] = createRectangleUploaded;\r\n\tEShapeDeserializers[ EShapeType.IMAGE ] = deserializeImage;\r\n};\r\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\r\nimport { toLength } from \"./to-length\";\r\n\r\nexport const IMAGE_SDF_VERTEX_COUNT = 9;\r\nexport const IMAGE_SDF_INDEX_COUNT = 8;\r\nexport const IMAGE_SDF_WORLD_SIZE: [ number, number ] = [ 0, 0 ];\r\nconst IMAGE_SDF_FMIN: number = 0.00001;\r\nconst IMAGE_SDF_SDF_WINDOW: number = 12;\r\nconst IMAGE_SDF_WORK_POINT: Point = new Point();\r\n\r\nexport const buildImageSdfClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number\r\n): void => {\r\n\tfor( let ic = voffset * 3, imax = (voffset + IMAGE_SDF_VERTEX_COUNT) * 3; ic < imax; ic += 3 ) {\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 2;\r\n\t}\r\n};\r\n\r\nexport const buildImageSdfIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number\r\n): void => {\r\n\tlet ii = ioffset * 3;\r\n\tindices[ ii + 0 ] = voffset + 0;\r\n\tindices[ ii + 1 ] = voffset + 1;\r\n\tindices[ ii + 2 ] = voffset + 3;\r\n\tindices[ ii + 3 ] = voffset + 1;\r\n\tindices[ ii + 4 ] = voffset + 4;\r\n\tindices[ ii + 5 ] = voffset + 3;\r\n\tii += 6;\r\n\r\n\tindices[ ii + 0 ] = voffset + 1;\r\n\tindices[ ii + 1 ] = voffset + 2;\r\n\tindices[ ii + 2 ] = voffset + 4;\r\n\tindices[ ii + 3 ] = voffset + 2;\r\n\tindices[ ii + 4 ] = voffset + 5;\r\n\tindices[ ii + 5 ] = voffset + 4;\r\n\tii += 6;\r\n\r\n\tindices[ ii + 0 ] = voffset + 3;\r\n\tindices[ ii + 1 ] = voffset + 4;\r\n\tindices[ ii + 2 ] = voffset + 6;\r\n\tindices[ ii + 3 ] = voffset + 4;\r\n\tindices[ ii + 4 ] = voffset + 7;\r\n\tindices[ ii + 5 ] = voffset + 6;\r\n\tii += 6;\r\n\r\n\tindices[ ii + 0 ] = voffset + 4;\r\n\tindices[ ii + 1 ] = voffset + 5;\r\n\tindices[ ii + 2 ] = voffset + 7;\r\n\tindices[ ii + 3 ] = voffset + 5;\r\n\tindices[ ii + 4 ] = voffset + 8;\r\n\tindices[ ii + 5 ] = voffset + 7;\r\n};\r\n\r\nexport const buildImageSdfStep = (\r\n\tsteps: Float32Array,\r\n\tvoffset: number,\r\n\tstrokeAlign: number,\r\n\tstrokeWidth: number,\r\n\ttextureWidth: number,\r\n\ttextureHeight: number,\r\n\tantialiasWeight: number,\r\n\tworldSize: [ number, number ]\r\n): void => {\r\n\tconst scaleBase = (0.333 / IMAGE_SDF_SDF_WINDOW) * antialiasWeight;\r\n\tconst scaleX = scaleBase * ( textureWidth / worldSize[ 0 ] );\r\n\tconst scaleY = scaleBase * ( textureHeight / worldSize[ 1 ] );\r\n\tconst scaleZ = (scaleX + scaleY) * 0.5;\r\n\tconst outlineLimit = 0.4;\r\n\tconst strokeWidthMax = ( outlineLimit / 0.5 ) * IMAGE_SDF_SDF_WINDOW;\r\n\tconst strokeWidthRatio = Math.max( 0.0, Math.min( 1.0, strokeWidth / strokeWidthMax ));\r\n\tconst outlineWidth = strokeWidthRatio * outlineLimit;\r\n\tconst outlinePosition = -outlineWidth * (1 - strokeAlign);\r\n\r\n\tlet is = voffset * 6;\r\n\tsteps[ is + 0 ] = scaleZ;\r\n\tsteps[ is + 1 ] = outlineWidth;\r\n\tsteps[ is + 2 ] = outlinePosition;\r\n\tsteps[ is + 3 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 4 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 5 ] = IMAGE_SDF_FMIN;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = scaleY;\r\n\tsteps[ is + 1 ] = outlineWidth;\r\n\tsteps[ is + 2 ] = outlinePosition;\r\n\tsteps[ is + 3 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 4 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 5 ] = IMAGE_SDF_FMIN;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = scaleZ;\r\n\tsteps[ is + 1 ] = outlineWidth;\r\n\tsteps[ is + 2 ] = outlinePosition;\r\n\tsteps[ is + 3 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 4 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 5 ] = IMAGE_SDF_FMIN;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = scaleX;\r\n\tsteps[ is + 1 ] = outlineWidth;\r\n\tsteps[ is + 2 ] = outlinePosition;\r\n\tsteps[ is + 3 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 4 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 5 ] = IMAGE_SDF_FMIN;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = scaleZ;\r\n\tsteps[ is + 1 ] = outlineWidth;\r\n\tsteps[ is + 2 ] = outlinePosition;\r\n\tsteps[ is + 3 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 4 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 5 ] = IMAGE_SDF_FMIN;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = scaleX;\r\n\tsteps[ is + 1 ] = outlineWidth;\r\n\tsteps[ is + 2 ] = outlinePosition;\r\n\tsteps[ is + 3 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 4 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 5 ] = IMAGE_SDF_FMIN;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = scaleZ;\r\n\tsteps[ is + 1 ] = outlineWidth;\r\n\tsteps[ is + 2 ] = outlinePosition;\r\n\tsteps[ is + 3 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 4 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 5 ] = IMAGE_SDF_FMIN;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = scaleY;\r\n\tsteps[ is + 1 ] = outlineWidth;\r\n\tsteps[ is + 2 ] = outlinePosition;\r\n\tsteps[ is + 3 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 4 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 5 ] = IMAGE_SDF_FMIN;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = scaleY;\r\n\tsteps[ is + 1 ] = outlineWidth;\r\n\tsteps[ is + 2 ] = outlinePosition;\r\n\tsteps[ is + 3 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 4 ] = IMAGE_SDF_FMIN;\r\n\tsteps[ is + 5 ] = IMAGE_SDF_FMIN;\r\n\tis += 6;\r\n};\r\n\r\nexport const buildImageSdfVertex = (\r\n\tvertices: Float32Array,\r\n\tvoffset: number,\r\n\toriginX: number,\r\n\toriginY: number,\r\n\tsizeX: number,\r\n\tsizeY: number,\r\n\tinternalTransform: Matrix,\r\n\tworldSize: [ number, number ]\r\n): void => {\r\n\t// Calculate the transformed positions\r\n\t//\r\n\t// 0       1       2\r\n\t// |-------|-------|\r\n\t// |       |       |\r\n\t// 3-------4-------5\r\n\t// |       |       |\r\n\t// |-------|-------|\r\n\t// 6       7       8\r\n\t//\r\n\tconst work = IMAGE_SDF_WORK_POINT;\r\n\tconst sx = sizeX * 0.5;\r\n\tconst sy = sizeY * 0.5;\r\n\twork.set( originX - sx, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x0 = work.x;\r\n\tconst y0 = work.y;\r\n\twork.set( originX + sx, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x2 = work.x;\r\n\tconst y2 = work.y;\r\n\twork.set( originX + sx, originY + sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x8 = work.x;\r\n\tconst y8 = work.y;\r\n\tconst x6 = x0 + (x8 - x2);\r\n\tconst y6 = y0 + (y8 - y2);\r\n\r\n\t// Vertices\r\n\tlet iv = voffset << 1;\r\n\tvertices[ iv + 0 ] = x0;\r\n\tvertices[ iv + 1 ] = y0;\r\n\tvertices[ iv + 2 ] = (x0 + x2) * 0.5;\r\n\tvertices[ iv + 3 ] = (y0 + y2) * 0.5;\r\n\tvertices[ iv + 4 ] = x2;\r\n\tvertices[ iv + 5 ] = y2;\r\n\tiv += 6;\r\n\r\n\tvertices[ iv + 0 ] = (x0 + x6) * 0.5;\r\n\tvertices[ iv + 1 ] = (y0 + y6) * 0.5;\r\n\tvertices[ iv + 2 ] = (x0 + x8) * 0.5;\r\n\tvertices[ iv + 3 ] = (y0 + y8) * 0.5;\r\n\tvertices[ iv + 4 ] = (x2 + x8) * 0.5;\r\n\tvertices[ iv + 5 ] = (y2 + y8) * 0.5;\r\n\tiv += 6;\r\n\r\n\tvertices[ iv + 0 ] = x6;\r\n\tvertices[ iv + 1 ] = y6;\r\n\tvertices[ iv + 2 ] = (x6 + x8) * 0.5;\r\n\tvertices[ iv + 3 ] = (y6 + y8) * 0.5;\r\n\tvertices[ iv + 4 ] = x8;\r\n\tvertices[ iv + 5 ] = y8;\r\n\r\n\tworldSize[ 0 ] = toLength( x0, y0, x2, y2 ) * 0.5;\r\n\tworldSize[ 1 ] = toLength( x0, y0, x6, y6 ) * 0.5;\r\n};\r\n\r\nexport const buildImageSdfUv = (\r\n\tuvs: Float32Array,\r\n\tvoffset: number,\r\n\ttextureUv: TextureUvs\r\n): void => {\r\n\tconst x0 = textureUv.x0;\r\n\tconst y0 = textureUv.y0;\r\n\tconst x1 = textureUv.x1;\r\n\tconst y1 = textureUv.y1;\r\n\tconst x2 = textureUv.x2;\r\n\tconst y2 = textureUv.y2;\r\n\tconst x3 = textureUv.x3;\r\n\tconst y3 = textureUv.y3;\r\n\r\n\tlet iv = voffset << 1;\r\n\tuvs[ iv + 0 ] = x0;\r\n\tuvs[ iv + 1 ] = y0;\r\n\tuvs[ iv + 2 ] = (x1 + x0) * 0.5;\r\n\tuvs[ iv + 3 ] = (y1 + y0) * 0.5;\r\n\tuvs[ iv + 4 ] = x1;\r\n\tuvs[ iv + 5 ] = y1;\r\n\tiv += 6;\r\n\r\n\tuvs[ iv + 0 ] = (x0 + x3) * 0.5;\r\n\tuvs[ iv + 1 ] = (y0 + y3) * 0.5;\r\n\tuvs[ iv + 2 ] = (x0 + x2) * 0.5;\r\n\tuvs[ iv + 3 ] = (y0 + y2) * 0.5;\r\n\tuvs[ iv + 4 ] = (x1 + x2) * 0.5;\r\n\tuvs[ iv + 5 ] = (y1 + y2) * 0.5;\r\n\tiv += 6;\r\n\r\n\tuvs[ iv + 0 ] = x3;\r\n\tuvs[ iv + 1 ] = y3;\r\n\tuvs[ iv + 2 ] = (x3 + x2) * 0.5;\r\n\tuvs[ iv + 3 ] = (y3 + y2) * 0.5;\r\n\tuvs[ iv + 4 ] = x2;\r\n\tuvs[ iv + 5 ] = y2;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport {\r\n\tbuildImageSdfClipping, buildImageSdfIndex, buildImageSdfStep,\r\n\tbuildImageSdfUv, buildImageSdfVertex, IMAGE_SDF_WORLD_SIZE\r\n} from \"./build-image-sdf\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport class EShapeImageSdfUploaded extends EShapeTextUploaded {\r\n\tprotected textureWidth: number;\r\n\tprotected textureHeight: number;\r\n\r\n\tconstructor(\r\n\t\tbuffer: EShapeBuffer,\r\n\t\tvoffset: number, ioffset: number,\r\n\t\ttvcount: number, ticount: number,\r\n\t\tvcount: number, icount: number,\r\n\t\tantialiasWeight: number\r\n\t) {\r\n\t\tsuper( buffer, voffset, ioffset, tvcount, ticount, vcount, icount, antialiasWeight );\r\n\r\n\t\tthis.textureWidth = -1;\r\n\t\tthis.textureHeight = -1;\r\n\t}\r\n\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Clippings & indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tconst voffset = this.vertexOffset;\r\n\t\tbuffer.updateClippings();\r\n\t\tbuffer.updateIndices();\r\n\t\tbuildImageSdfClipping(\r\n\t\t\tbuffer.clippings,\r\n\t\t\tvoffset\r\n\t\t);\r\n\t\tbuildImageSdfIndex(\r\n\t\t\tbuffer.indices,\r\n\t\t\tvoffset,\r\n\t\t\tthis.indexOffset\r\n\t\t);\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tthis.updateVertexAndStep( buffer, shape );\r\n\t\tthis.updateColor( buffer, shape );\r\n\t\tthis.updateUv( buffer, shape );\r\n\t\tthis.updateText( buffer, shape );\r\n\t}\r\n\r\n\tprotected updateVertexAndStep( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign || this.strokeWidth !== strokeWidth );\r\n\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureWidth = texture.width * texture.resolution;\r\n\t\tconst textureHeight = texture.height * texture.resolution;\r\n\t\tconst isTextureSizeChanged = ( this.textureWidth !== textureWidth || this.textureHeight !== textureHeight );\r\n\r\n\t\tif( isSizeChanged || isTransformChanged || isStrokeChanged || isTextureSizeChanged ) {\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\t\t\tthis.textureWidth = textureWidth;\r\n\t\t\tthis.textureHeight = textureHeight;\r\n\r\n\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\tthis.textSpacingHorizontal = NaN;\r\n\r\n\t\t\t// Vertices\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tbuildImageSdfVertex(\r\n\t\t\t\tbuffer.vertices,\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\t0, 0,\r\n\t\t\t\tsizeX, sizeY,\r\n\t\t\t\tshape.transform.internalTransform,\r\n\t\t\t\tIMAGE_SDF_WORLD_SIZE\r\n\t\t\t);\r\n\r\n\t\t\t// Steps\r\n\t\t\tbuffer.updateSteps();\r\n\t\t\tbuildImageSdfStep(\r\n\t\t\t\tbuffer.steps,\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\tstrokeAlign,\r\n\t\t\t\tstrokeWidth,\r\n\t\t\t\ttextureWidth,\r\n\t\t\t\ttextureHeight,\r\n\t\t\t\tthis.antialiasWeight,\r\n\t\t\t\tIMAGE_SDF_WORLD_SIZE\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateUv( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tif( texture !== this.texture || textureTransformId !== this.textureTransformId ) {\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tbuffer.updateUvs();\r\n\t\t\tbuildImageSdfUv(\r\n\t\t\t\tbuffer.uvs,\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\tthis.toTextureUvs( texture )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { IMAGE_SDF_INDEX_COUNT, IMAGE_SDF_VERTEX_COUNT } from \"./build-image-sdf\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\nimport { EShapeImageSdfUploaded } from \"./e-shape-image-sdf-uploaded\";\r\n\r\nexport const createImageSdfUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeImageSdfUploaded | null => {\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst vcount = IMAGE_SDF_VERTEX_COUNT + tvcount;\r\n\tconst icount = IMAGE_SDF_INDEX_COUNT + ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new EShapeImageSdfUploaded(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeImage } from \"./e-shape-image\";\r\n\r\nexport class EShapeImageSdf extends EShapeImage {\r\n\tconstructor( image?: HTMLImageElement, type = EShapeType.IMAGE_SDF ) {\r\n\t\tsuper( image, type );\r\n\t}\r\n\r\n\tclone(): EShapeImageSdf {\r\n\t\treturn new EShapeImageSdf( this.image ).copy( this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeImageSdf } from \"./e-shape-image-sdf\";\r\n\r\nexport const deserializeImageSdf = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeImageSdf> | EShapeImageSdf => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeImageSdf() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport class EShapeLabelUploaded extends EShapeTextUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\t\tthis.initText();\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tthis.updateLabelVertex( buffer, shape );\r\n\t\tthis.updateLabelUv( buffer, shape );\r\n\t\tthis.updateText( buffer, shape );\r\n\t}\r\n\r\n\tupdateLabelVertex( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\t\tif( isSizeChanged || isTransformChanged ) {\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\r\n\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateLabelUv( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tthis.texture = this.toTexture( shape );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\nimport { EShapeLabelUploaded } from \"./e-shape-label-uploaded\";\r\n\r\nexport const createLabelUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeLabelUploaded | null => {\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst vcount = tvcount;\r\n\tconst icount = ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new EShapeLabelUploaded(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapePrimitive } from \"./e-shape-primitive\";\r\n\r\nexport class EShapeLabel extends EShapePrimitive {\r\n\tconstructor( type: EShapeType = EShapeType.LABEL ) {\r\n\t\tsuper( type );\r\n\t}\r\n\r\n\tclone(): EShapeLabel {\r\n\t\treturn new EShapeLabel().copy( this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeLabel } from \"./e-shape-label\";\r\n\r\nexport const deserializeLabel = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeLabel> | EShapeLabel => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeLabel() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createLabelUploaded } from \"../variant/create-label-uploaded\";\r\nimport { deserializeLabel } from \"../variant/deserialize-label\";\r\n\r\nexport const loadShapeLabel = () => {\r\n\tEShapeUploadeds[ EShapeType.LABEL ] = createLabelUploaded;\r\n\tEShapeDeserializers[ EShapeType.LABEL ] = deserializeLabel;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const toIndexOf = <V>( array: V[], value: V ): number => {\r\n\tlet i0 = 0;\r\n\tlet i1 = array.length - 1;\r\n\r\n\twhile( i0 <= i1 ) {\r\n\t\tconst i2 = i0 + ((i1 - i0) >> 1);\r\n\t\tconst v2 = array[ i2 ];\r\n\t\tif( value < v2 ) {\r\n\t\t\ti1 = i2 - 1;\r\n\t\t} else if( v2 < value ) {\r\n\t\t\ti0 = i2 + 1;\r\n\t\t} else {\r\n\t\t\treturn i2;\r\n\t\t}\r\n\t}\r\n\r\n\treturn -1;\r\n};\r\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\r\nimport { toIndexOf } from \"../../util/to-index-of\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { toDash } from \"./to-dash\";\r\nimport { toLength } from \"./to-length\";\r\nimport { toScaleInvariant } from \"./to-scale-invariant\";\r\n\r\nconst LINE_FMIN: number = 0.00001;\r\nconst LINE_WORK_POINT: Point = new Point();\r\n\r\nexport const toLineVertexCount = ( pointCount: number ): number => {\r\n\treturn (Math.ceil( pointCount / 12 ) * 12) * 4 + 2;\r\n};\r\n\r\nexport const buildLineClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number,\r\n\tpointCount: number,\r\n\tpointsClosed: boolean\r\n): void => {\r\n\tlet ic = voffset * 3;\r\n\tif( 2 <= pointCount ) {\r\n\t\t// First\r\n\t\tif( ! pointsClosed ) {\r\n\t\t\tclippings[ ic +  0 ] = 1;\r\n\t\t\tclippings[ ic +  1 ] = 0;\r\n\t\t\tclippings[ ic +  2 ] = 3;\r\n\r\n\t\t\tclippings[ ic +  3 ] = 0;\r\n\t\t\tclippings[ ic +  4 ] = 1;\r\n\t\t\tclippings[ ic +  5 ] = 5;\r\n\t\t\tic += 6;\r\n\t\t}\r\n\r\n\t\t// Middle\r\n\t\tfor( let i = (pointsClosed ? 0 : 1), imax = pointCount - i; i < imax; ++i ) {\r\n\t\t\tclippings[ ic +  0 ] = 1;\r\n\t\t\tclippings[ ic +  1 ] = 0;\r\n\t\t\tclippings[ ic +  2 ] = 3;\r\n\r\n\t\t\tclippings[ ic +  3 ] = 0;\r\n\t\t\tclippings[ ic +  4 ] = 1;\r\n\t\t\tclippings[ ic +  5 ] = 5;\r\n\r\n\t\t\tclippings[ ic +  6 ] = 1;\r\n\t\t\tclippings[ ic +  7 ] = 0;\r\n\t\t\tclippings[ ic +  8 ] = 4;\r\n\r\n\t\t\tclippings[ ic +  9 ] = 0;\r\n\t\t\tclippings[ ic + 10 ] = 1;\r\n\t\t\tclippings[ ic + 11 ] = 6;\r\n\t\t\tic += 12;\r\n\t\t}\r\n\r\n\t\t// Last\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 3;\r\n\r\n\t\tclippings[ ic + 3 ] = 0;\r\n\t\tclippings[ ic + 4 ] = 1;\r\n\t\tclippings[ ic + 5 ] = 5;\r\n\t\tic += 6;\r\n\t}\r\n\r\n\t// Fill the rest\r\n\tfor( const icmax = (voffset + vcount) * 3; ic < icmax; ic += 3 ) {\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t}\r\n};\r\n\r\nexport const buildLineIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number,\r\n\ticount: number\r\n): void => {\r\n\tfor( let ii = ioffset * 3, iimax = (ioffset + icount) * 3, io = voffset; ii < iimax; ii += 6, io += 2 ) {\r\n\t\tindices[ ii + 0 ] = io + 0;\r\n\t\tindices[ ii + 1 ] = io + 2;\r\n\t\tindices[ ii + 2 ] = io + 1;\r\n\t\tindices[ ii + 3 ] = io + 1;\r\n\t\tindices[ ii + 4 ] = io + 2;\r\n\t\tindices[ ii + 5 ] = io + 3;\r\n\t}\r\n};\r\n\r\nexport const buildLineUv = (\r\n\tuvs: Float32Array,\r\n\tcolorFills: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number,\r\n\tpointCount: number,\r\n\tpointsClosed: boolean,\r\n\ttextureUvs: TextureUvs,\r\n\tlength: number\r\n): void => {\r\n\tlet iuv = voffset << 1;\r\n\tif( 2 <= pointCount ) {\r\n\t\tconst x0 = textureUvs.x0;\r\n\t\tconst x1 = textureUvs.x1;\r\n\t\tconst x2 = textureUvs.x2;\r\n\t\tconst x3 = textureUvs.x3;\r\n\t\tconst y0 = textureUvs.y0;\r\n\t\tconst y1 = textureUvs.y1;\r\n\t\tconst y2 = textureUvs.y2;\r\n\t\tconst y3 = textureUvs.y3;\r\n\r\n\t\tconst dx01 = x1 - x0;\r\n\t\tconst dy01 = y1 - y0;\r\n\t\tconst dx32 = x2 - x3;\r\n\t\tconst dy32 = y2 - y3;\r\n\r\n\t\t// Uvs\r\n\t\tlet icf = voffset << 2;\r\n\t\tconst lengthInverse = 1 / Math.max( LINE_FMIN, length );\r\n\t\tlet r = 0;\r\n\r\n\t\t// UV: First\r\n\t\tif( ! pointsClosed ) {\r\n\t\t\tr = colorFills[ icf ] * lengthInverse;\r\n\t\t\tuvs[ iuv + 0 ] = x0 + r * dx01;\r\n\t\t\tuvs[ iuv + 1 ] = y0 + r * dy01;\r\n\t\t\tuvs[ iuv + 2 ] = x3 + r * dx32;\r\n\t\t\tuvs[ iuv + 3 ] = y3 + r * dy32;\r\n\t\t\tiuv += 4;\r\n\t\t\ticf += 8;\r\n\t\t}\r\n\r\n\t\t// UV: Middle\r\n\t\tfor( let i = (pointsClosed ? 0 : 1), imax = pointCount - i; i < imax; ++i ) {\r\n\t\t\tr = colorFills[ icf ] * lengthInverse;\r\n\t\t\tuvs[ iuv + 0 ] = x0 + r * dx01;\r\n\t\t\tuvs[ iuv + 1 ] = y0 + r * dy01;\r\n\t\t\tuvs[ iuv + 2 ] = x3 + r * dx32;\r\n\t\t\tuvs[ iuv + 3 ] = y3 + r * dy32;\r\n\t\t\tiuv += 4;\r\n\t\t\ticf += 8;\r\n\r\n\t\t\tr = colorFills[ icf ] * lengthInverse;\r\n\t\t\tuvs[ iuv + 0 ] = x0 + r * dx01;\r\n\t\t\tuvs[ iuv + 1 ] = y0 + r * dy01;\r\n\t\t\tuvs[ iuv + 2 ] = x3 + r * dx32;\r\n\t\t\tuvs[ iuv + 3 ] = y3 + r * dy32;\r\n\t\t\tiuv += 4;\r\n\t\t\ticf += 8;\r\n\t\t}\r\n\r\n\t\t// UV: Last\r\n\t\tr = colorFills[ icf ] * lengthInverse;\r\n\t\tuvs[ iuv + 0 ] = x0 + r * dx01;\r\n\t\tuvs[ iuv + 1 ] = y0 + r * dy01;\r\n\t\tuvs[ iuv + 2 ] = x3 + r * dx32;\r\n\t\tuvs[ iuv + 3 ] = y3 + r * dy32;\r\n\t\tiuv += 4;\r\n\t}\r\n\r\n\t// Fill the rest\r\n\tfor( const iuvmax = ((voffset + vcount) << 1); iuv < iuvmax; iuv += 2 ) {\r\n\t\tuvs[ iuv + 0 ] = 0;\r\n\t\tuvs[ iuv + 1 ] = 0;\r\n\t}\r\n};\r\n\r\nexport const buildLineVertexStepAndColorFill = (\r\n\tvertices: Float32Array,\r\n\tsteps: Float32Array,\r\n\tcolorFills: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number,\r\n\tpointCount: number,\r\n\tpointsClosed: boolean,\r\n\tpointValues: number[],\r\n\tpointSegments: number[],\r\n\tpointsStyle: EShapePointsStyle,\r\n\tstrokeWidth: number,\r\n\tinternalTransform: Matrix\r\n): number => {\r\n\tlet iv = voffset << 1;\r\n\tlet is = voffset * 6;\r\n\tlet icf = voffset << 2;\r\n\tlet lmax = 0;\r\n\tlet px = 0;\r\n\tlet py = 0;\r\n\tif( 2 <= pointCount ) {\r\n\t\tconst scaleInvariant = toScaleInvariant( pointsStyle );\r\n\r\n\t\t//\r\n\t\tlet l = 0;\r\n\t\tlet lprev = 0;\r\n\t\tlet lnext = 0;\r\n\t\tlet llop = 0;\r\n\t\tlet llo = 0;\r\n\t\tlet pprevx = 0;\r\n\t\tlet pprevy = 0;\r\n\t\tlet pnextx = 0;\r\n\t\tlet pnexty = 0;\r\n\t\tlet pseg = false;\r\n\t\tlet psegnext = false;\r\n\t\tlet icfprev = icf;\r\n\t\tlet loffset = 0;\r\n\r\n\t\t//\r\n\t\tconst a  = internalTransform.a;\r\n\t\tconst b  = internalTransform.b;\r\n\t\tconst c  = internalTransform.c;\r\n\t\tconst d  = internalTransform.d;\r\n\t\tconst tx = internalTransform.tx;\r\n\t\tconst ty = internalTransform.ty;\r\n\r\n\t\t// First point\r\n\t\tconst pv0 = pointValues[ 0 ];\r\n\t\tconst pv1 = pointValues[ 1 ];\r\n\t\tconst pfirstx = a * pv0 + c * pv1 + tx;\r\n\t\tconst pfirsty = b * pv0 + d * pv1 + ty;\r\n\t\tconst psegfirst = ( 0 <= toIndexOf( pointSegments, 0 ) );\r\n\r\n\t\t// Last point\r\n\t\tconst lastIndex = (pointCount - 1) << 1;\r\n\t\tconst pvl0 = pointValues[ lastIndex + 0 ];\r\n\t\tconst pvl1 = pointValues[ lastIndex + 1 ];\r\n\t\tconst plastx = a * pvl0 + c * pvl1 + tx;\r\n\t\tconst plasty = b * pvl0 + d * pvl1 + ty;\r\n\t\tconst pseglast = ( 0 <= toIndexOf( pointSegments, pointCount - 1 ) );\r\n\r\n\t\t// Second point\r\n\t\tlet psecondx = plastx;\r\n\t\tlet psecondy = plasty;\r\n\t\tlet psegsecond = pseglast;\r\n\t\tif( 2 < pointCount ) {\r\n\t\t\tconst pv2 = pointValues[ 2 ];\r\n\t\t\tconst pv3 = pointValues[ 3 ];\r\n\t\t\tpsecondx = a * pv2 + c * pv3 + tx;\r\n\t\t\tpsecondy = b * pv2 + d * pv3 + ty;\r\n\t\t\tpsegsecond = ( 0 <= toIndexOf( pointSegments, 1 ) );\r\n\t\t}\r\n\r\n\t\t// First segment\r\n\t\tif( pointsClosed ) {\r\n\t\t\tpx = plastx;\r\n\t\t\tpy = plasty;\r\n\t\t\tpnextx = pfirstx;\r\n\t\t\tpnexty = pfirsty;\r\n\t\t\tpseg = pseglast;\r\n\t\t\tpsegnext = psegfirst;\r\n\t\t} else {\r\n\t\t\tpprevx = pfirstx - (psecondx - pfirstx);\r\n\t\t\tpprevy = pfirsty - (psecondy - pfirsty);\r\n\t\t\tpx = pfirstx;\r\n\t\t\tpy = pfirsty;\r\n\t\t\tpnextx = psecondx;\r\n\t\t\tpnexty = psecondy;\r\n\t\t\tpseg = psegfirst;\r\n\t\t\tpsegnext = psegsecond;\r\n\t\t\tlnext += toLength( px, py, pnextx, pnexty );\r\n\r\n\t\t\t//\r\n\t\t\tvertices[ iv + 0 ] = px;\r\n\t\t\tvertices[ iv + 1 ] = py;\r\n\t\t\tvertices[ iv + 2 ] = px;\r\n\t\t\tvertices[ iv + 3 ] = py;\r\n\t\t\tsteps[ is +  0 ] = strokeWidth;\r\n\t\t\tsteps[ is +  1 ] = scaleInvariant;\r\n\t\t\tsteps[ is +  2 ] = pprevx;\r\n\t\t\tsteps[ is +  3 ] = pprevy;\r\n\t\t\tsteps[ is +  4 ] = pnextx;\r\n\t\t\tsteps[ is +  5 ] = pnexty;\r\n\t\t\tsteps[ is +  6 ] = strokeWidth;\r\n\t\t\tsteps[ is +  7 ] = scaleInvariant;\r\n\t\t\tsteps[ is +  8 ] = pprevx;\r\n\t\t\tsteps[ is +  9 ] = pprevy;\r\n\t\t\tsteps[ is + 10 ] = pnextx;\r\n\t\t\tsteps[ is + 11 ] = pnexty;\r\n\t\t\tcolorFills[ icf + 0 ] = llo;\r\n\t\t\tcolorFills[ icf + 4 ] = llo;\r\n\t\t\tiv += 4;\r\n\t\t\tis += 12;\r\n\t\t\ticf += 8;\r\n\t\t}\r\n\r\n\t\t// Middle segments\r\n\t\tfor( let i = ( pointsClosed ? 0 : 1 ), imax = pointCount - i; i < imax; ++i ) {\r\n\t\t\tpprevx = px;\r\n\t\t\tpprevy = py;\r\n\t\t\tpx = pnextx;\r\n\t\t\tpy = pnexty;\r\n\t\t\tpseg = psegnext;\r\n\t\t\tif( i === pointCount - 2 ) {\r\n\t\t\t\tpnextx = plastx;\r\n\t\t\t\tpnexty = plasty;\r\n\t\t\t\tpsegnext = pseglast;\r\n\t\t\t} else if( i === 0 ) {\r\n\t\t\t\tpnextx = psecondx;\r\n\t\t\t\tpnexty = psecondy;\r\n\t\t\t\tpsegnext = psegsecond;\r\n\t\t\t} else if( i < pointCount - 1 ) {\r\n\t\t\t\tconst nextIndex = (i + 1) << 1;\r\n\t\t\t\tconst pvn0 = pointValues[ nextIndex + 0 ];\r\n\t\t\t\tconst pvn1 = pointValues[ nextIndex + 1 ];\r\n\t\t\t\tpnextx = a * pvn0 + c * pvn1 + tx;\r\n\t\t\t\tpnexty = b * pvn0 + d * pvn1 + ty;\r\n\t\t\t\tpsegnext = ( 0 <= toIndexOf( pointSegments, i + 1 ) );\r\n\t\t\t} else {\r\n\t\t\t\tpnextx = pfirstx;\r\n\t\t\t\tpnexty = pfirsty;\r\n\t\t\t\tpsegnext = psegfirst;\r\n\t\t\t}\r\n\t\t\tlprev = l;\r\n\t\t\tl = lnext;\r\n\t\t\tlnext += toLength( px, py, pnextx, pnexty );\r\n\r\n\t\t\tlet pnextxn = pnextx;\r\n\t\t\tlet pnextyn = pnexty;\r\n\t\t\tlet loffsetprev = loffset;\r\n\t\t\tif( pseg ) {\r\n\t\t\t\tpprevx = px - (pnextx - px);\r\n\t\t\t\tpprevy = py - (pnexty - py);\r\n\r\n\t\t\t\tlmax = Math.max( lmax, llo );\r\n\r\n\t\t\t\tllop = lprev - loffset;\r\n\t\t\t\tconst dash = toDash( llop, strokeWidth, pointsStyle, LINE_WORK_POINT );\r\n\t\t\t\tconst dash0 = dash.x;\r\n\t\t\t\tconst dash1 = dash.y;\r\n\t\t\t\tfor( let j = icfprev; j < icf + 8; j += 4 ) {\r\n\t\t\t\t\tcolorFills[ j + 1 ] = dash0;\r\n\t\t\t\t\tcolorFills[ j + 2 ] = dash1;\r\n\t\t\t\t\tcolorFills[ j + 3 ] = llop;\r\n\t\t\t\t}\r\n\t\t\t\ticfprev = icf + 8;\r\n\t\t\t\tloffsetprev = loffset;\r\n\t\t\t\tloffset = l;\r\n\t\t\t} else if( psegnext ) {\r\n\t\t\t\tpnextxn = px + (px - pprevx);\r\n\t\t\t\tpnextyn = py + (py - pprevy);\r\n\t\t\t}\r\n\r\n\t\t\t// Vertices\r\n\t\t\tvertices[ iv + 0 ] = px;\r\n\t\t\tvertices[ iv + 1 ] = py;\r\n\t\t\tvertices[ iv + 2 ] = px;\r\n\t\t\tvertices[ iv + 3 ] = py;\r\n\t\t\tsteps[ is +  0 ] = strokeWidth;\r\n\t\t\tsteps[ is +  1 ] = scaleInvariant;\r\n\t\t\tsteps[ is +  2 ] = pprevx;\r\n\t\t\tsteps[ is +  3 ] = pprevy;\r\n\t\t\tsteps[ is +  4 ] = pnextxn;\r\n\t\t\tsteps[ is +  5 ] = pnextyn;\r\n\t\t\tsteps[ is +  6 ] = strokeWidth;\r\n\t\t\tsteps[ is +  7 ] = scaleInvariant;\r\n\t\t\tsteps[ is +  8 ] = pprevx;\r\n\t\t\tsteps[ is +  9 ] = pprevy;\r\n\t\t\tsteps[ is + 10 ] = pnextxn;\r\n\t\t\tsteps[ is + 11 ] = pnextyn;\r\n\t\t\tllop = l - loffsetprev;\r\n\t\t\tcolorFills[ icf + 0 ] = llop;\r\n\t\t\tcolorFills[ icf + 4 ] = llop;\r\n\t\t\tiv += 4;\r\n\t\t\tis += 12;\r\n\t\t\ticf += 8;\r\n\r\n\t\t\tvertices[ iv + 0 ] = px;\r\n\t\t\tvertices[ iv + 1 ] = py;\r\n\t\t\tvertices[ iv + 2 ] = px;\r\n\t\t\tvertices[ iv + 3 ] = py;\r\n\t\t\tsteps[ is +  0 ] = strokeWidth;\r\n\t\t\tsteps[ is +  1 ] = scaleInvariant;\r\n\t\t\tsteps[ is +  2 ] = pprevx;\r\n\t\t\tsteps[ is +  3 ] = pprevy;\r\n\t\t\tsteps[ is +  4 ] = pnextxn;\r\n\t\t\tsteps[ is +  5 ] = pnextyn;\r\n\t\t\tsteps[ is +  6 ] = strokeWidth;\r\n\t\t\tsteps[ is +  7 ] = scaleInvariant;\r\n\t\t\tsteps[ is +  8 ] = pprevx;\r\n\t\t\tsteps[ is +  9 ] = pprevy;\r\n\t\t\tsteps[ is + 10 ] = pnextxn;\r\n\t\t\tsteps[ is + 11 ] = pnextyn;\r\n\t\t\tllo = l - loffset;\r\n\t\t\tcolorFills[ icf + 0 ] = llo;\r\n\t\t\tcolorFills[ icf + 4 ] = llo;\r\n\t\t\tiv += 4;\r\n\t\t\tis += 12;\r\n\t\t\ticf += 8;\r\n\t\t}\r\n\r\n\t\t// Last segment\r\n\t\t{\r\n\t\t\tpprevx = px;\r\n\t\t\tpprevy = py;\r\n\t\t\tpx = pnextx;\r\n\t\t\tpy = pnexty;\r\n\t\t\tpseg = psegnext;\r\n\t\t\tif( pointsClosed ) {\r\n\t\t\t\tpnextx = psecondx;\r\n\t\t\t\tpnexty = psecondy;\r\n\t\t\t\tpsegnext = psegsecond;\r\n\t\t\t} else {\r\n\t\t\t\tpnextx = px + (px - pprevx);\r\n\t\t\t\tpnexty = py + (py - pprevy);\r\n\t\t\t\tpsegnext = false;\r\n\t\t\t}\r\n\t\t\tlprev = l;\r\n\t\t\tl = lnext;\r\n\r\n\t\t\tlet pnextxn = pnextx;\r\n\t\t\tlet pnextyn = pnexty;\r\n\t\t\tlet loffsetprev = loffset;\r\n\t\t\tif( pseg ) {\r\n\t\t\t\tpprevx = px - (pnextx - px);\r\n\t\t\t\tpprevy = py - (pnexty - py);\r\n\r\n\t\t\t\tlmax = Math.max( lmax, llo );\r\n\r\n\t\t\t\tllop = lprev - loffset;\r\n\t\t\t\tconst dash = toDash( llop, strokeWidth, pointsStyle, LINE_WORK_POINT );\r\n\t\t\t\tconst dash0 = dash.x;\r\n\t\t\t\tconst dash1 = dash.y;\r\n\t\t\t\tfor( let j = icfprev; j < icf + 8; j += 4 ) {\r\n\t\t\t\t\tcolorFills[ j + 1 ] = dash0;\r\n\t\t\t\t\tcolorFills[ j + 2 ] = dash1;\r\n\t\t\t\t\tcolorFills[ j + 3 ] = llop;\r\n\t\t\t\t}\r\n\t\t\t\ticfprev = icf + 8;\r\n\t\t\t\tloffsetprev = loffset;\r\n\t\t\t\tloffset = l;\r\n\t\t\t} else if( psegnext ) {\r\n\t\t\t\tpnextxn = px + (px - pprevx);\r\n\t\t\t\tpnextyn = py + (py - pprevy);\r\n\t\t\t}\r\n\r\n\t\t\t// Vertices\r\n\t\t\tvertices[ iv + 0 ] = px;\r\n\t\t\tvertices[ iv + 1 ] = py;\r\n\t\t\tvertices[ iv + 2 ] = px;\r\n\t\t\tvertices[ iv + 3 ] = py;\r\n\t\t\tsteps[ is +  0 ] = strokeWidth;\r\n\t\t\tsteps[ is +  1 ] = scaleInvariant;\r\n\t\t\tsteps[ is +  2 ] = pprevx;\r\n\t\t\tsteps[ is +  3 ] = pprevy;\r\n\t\t\tsteps[ is +  4 ] = pnextxn;\r\n\t\t\tsteps[ is +  5 ] = pnextyn;\r\n\t\t\tsteps[ is +  6 ] = strokeWidth;\r\n\t\t\tsteps[ is +  7 ] = scaleInvariant;\r\n\t\t\tsteps[ is +  8 ] = pprevx;\r\n\t\t\tsteps[ is +  9 ] = pprevy;\r\n\t\t\tsteps[ is + 10 ] = pnextxn;\r\n\t\t\tsteps[ is + 11 ] = pnextyn;\r\n\t\t\tllop = l - loffsetprev;\r\n\t\t\tlmax = Math.max( lmax, llop );\r\n\t\t\tcolorFills[ icf + 0 ] = llop;\r\n\t\t\tcolorFills[ icf + 4 ] = llop;\r\n\t\t\tiv += 4;\r\n\t\t\tis += 12;\r\n\t\t\ticf += 8;\r\n\r\n\t\t\t// Total length\r\n\t\t\tif( icfprev < icf ) {\r\n\t\t\t\tconst dash = toDash( llop, strokeWidth, pointsStyle, LINE_WORK_POINT );\r\n\t\t\t\tconst dash0 = dash.x;\r\n\t\t\t\tconst dash1 = dash.y;\r\n\t\t\t\tif( pointsClosed ) {\r\n\t\t\t\t\tfor( let i = icfprev; i < icf; i += 4 ) {\r\n\t\t\t\t\t\tcolorFills[ i + 1 ] = dash0;\r\n\t\t\t\t\t\tcolorFills[ i + 2 ] = dash1;\r\n\t\t\t\t\t\tcolorFills[ i + 3 ] = -1;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor( let i = icfprev; i < icf; i += 4 ) {\r\n\t\t\t\t\t\tcolorFills[ i + 1 ] = dash0;\r\n\t\t\t\t\t\tcolorFills[ i + 2 ] = dash1;\r\n\t\t\t\t\t\tcolorFills[ i + 3 ] = llop;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t// Fill the rest\r\n\tfor( const ivmax = ((voffset + vcount) << 1); iv < ivmax; iv += 2, is += 6, icf += 4 ) {\r\n\t\tvertices[ iv + 0 ] = px;\r\n\t\tvertices[ iv + 1 ] = py;\r\n\t\tsteps[ is + 0 ] = 0;\r\n\t\tsteps[ is + 1 ] = 0;\r\n\t\tsteps[ is + 2 ] = 0;\r\n\t\tsteps[ is + 3 ] = 0;\r\n\t\tsteps[ is + 4 ] = 0;\r\n\t\tsteps[ is + 5 ] = 0;\r\n\t\tcolorFills[ icf + 0 ] = 0;\r\n\t\tcolorFills[ icf + 1 ] = 0;\r\n\t\tcolorFills[ icf + 2 ] = 0;\r\n\t\tcolorFills[ icf + 4 ] = 0;\r\n\t}\r\n\r\n\treturn lmax;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport {\r\n\tbuildLineClipping, buildLineIndex, buildLineUv,\r\n\tbuildLineVertexStepAndColorFill, toLineVertexCount\r\n} from \"./build-line\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport class EShapeLineUploaded extends EShapeTextUploaded {\r\n\tprotected pointCount: number;\r\n\tprotected pointId: number;\r\n\tprotected pointsClosed: boolean;\r\n\tprotected length: number;\r\n\r\n\tconstructor(\r\n\t\tbuffer: EShapeBuffer,\r\n\t\tvoffset: number, ioffset: number,\r\n\t\ttvcount: number, ticount: number,\r\n\t\tvcount: number, icount: number,\r\n\t\tantialiasWeight: number\r\n\t) {\r\n\t\tsuper( buffer, voffset, ioffset, tvcount, ticount, vcount, icount, antialiasWeight );\r\n\t\tthis.pointId = -1;\r\n\t\tthis.pointCount = 0;\r\n\t\tthis.pointsClosed = false;\r\n\t\tthis.length = 1;\r\n\t}\r\n\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Clipping & indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateIndices();\r\n\t\tbuildLineIndex(\r\n\t\t\tbuffer.indices,\r\n\t\t\tthis.vertexOffset,\r\n\t\t\tthis.indexOffset,\r\n\t\t\tthis.indexCount - this.textIndexCount\r\n\t\t);\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\t//\r\n\t\tthis.update( shape );\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tisCompatible( shape: EShape ): boolean {\r\n\t\tif( super.isCompatible( shape ) ) {\r\n\t\t\tconst points = shape.points;\r\n\t\t\tconst vcount = toLineVertexCount( points ? points.length : 0 );\r\n\t\t\treturn vcount === this.vertexCount - this.textVertexCount;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tthis.updateLineClipping( buffer, shape );\r\n\t\tthis.updateLineVertexStepAndColorFill( buffer, shape );\r\n\t\tthis.updateColor( buffer, shape );\r\n\t\tthis.updateLineUv( buffer, shape );\r\n\t\tthis.updateText( buffer, shape );\r\n\t}\r\n\r\n\tprotected updateLineClipping( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst points = shape.points;\r\n\t\tif( points ) {\r\n\t\t\tconst pointCount = points.length;\r\n\t\t\tconst pointsClosed = (!! (points.style & EShapePointsStyle.CLOSED));\r\n\t\t\tif( this.pointCount !== pointCount || this.pointsClosed !== pointsClosed ) {\r\n\t\t\t\tthis.pointCount = pointCount;\r\n\t\t\t\tthis.pointsClosed = pointsClosed;\r\n\r\n\t\t\t\t// Invalidate the pointId to update the vertices\r\n\t\t\t\tthis.pointId = -1;\r\n\r\n\t\t\t\tbuffer.updateClippings();\r\n\t\t\t\tbuildLineClipping(\r\n\t\t\t\t\tbuffer.clippings,\r\n\t\t\t\t\tthis.vertexOffset,\r\n\t\t\t\t\tthis.vertexCount - this.textVertexCount,\r\n\t\t\t\t\tpointCount,\r\n\t\t\t\t\tpointsClosed\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateLineVertexStepAndColorFill( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst points = shape.points;\r\n\t\tif( points ) {\r\n\t\t\tconst pointId = points.id;\r\n\t\t\tconst isPointChanged = ( pointId !== this.pointId );\r\n\r\n\t\t\tconst stroke = shape.stroke;\r\n\t\t\tconst strokeWidth = ( stroke.enable ? stroke.width : 0 );\r\n\t\t\tconst isStrokeWidthChanged = ( strokeWidth !== this.strokeWidth );\r\n\r\n\t\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\t\tif( isPointChanged || isTransformChanged || isStrokeWidthChanged ) {\r\n\t\t\t\tthis.pointId = pointId;\r\n\t\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\t\tthis.transformLocalId = transformLocalId;\r\n\r\n\t\t\t\tif( isPointChanged || isTransformChanged ) {\r\n\t\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t\t}\r\n\t\t\t\tif( isPointChanged ) {\r\n\t\t\t\t\t// Invalidate the texture transform ID to update the UVs\r\n\t\t\t\t\tthis.textureTransformId = NaN;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbuffer.updateVertices();\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t\tbuffer.updateColorFills();\r\n\t\t\t\tthis.length = buildLineVertexStepAndColorFill(\r\n\t\t\t\t\tbuffer.vertices,\r\n\t\t\t\t\tbuffer.steps,\r\n\t\t\t\t\tbuffer.colorFills,\r\n\t\t\t\t\tthis.vertexOffset,\r\n\t\t\t\t\tthis.vertexCount - this.textVertexCount,\r\n\t\t\t\t\tthis.pointCount,\r\n\t\t\t\t\tthis.pointsClosed,\r\n\t\t\t\t\tpoints.values,\r\n\t\t\t\t\tpoints.segments,\r\n\t\t\t\t\tpoints.style,\r\n\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\tshape.transform.internalTransform\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateColorFillAndStroke( buffer: EShapeBuffer, shape: EShape, vertexCount: number ) {\r\n\t\tthis.updateColorStroke( buffer, shape, vertexCount );\r\n\t}\r\n\r\n\tupdateLineUv( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tif( texture !== this.texture || textureTransformId !== this.textureTransformId ) {\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tconst pointCount = this.pointCount;\r\n\t\t\tbuffer.updateUvs();\r\n\t\t\tbuildLineUv(\r\n\t\t\t\tbuffer.uvs,\r\n\t\t\t\tbuffer.colorFills,\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\tthis.vertexCount - this.textVertexCount,\r\n\t\t\t\tpointCount,\r\n\t\t\t\tthis.pointsClosed,\r\n\t\t\t\tthis.toTextureUvs( texture ),\r\n\t\t\t\tthis.length\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { toLineVertexCount } from \"./build-line\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\nimport { EShapeLineUploaded } from \"./e-shape-line-uploaded\";\r\n\r\nexport const createLineUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeLineUploaded | null => {\r\n\tconst points = shape.points;\r\n\tconst pointCount = ( points ? points.length : 0 );\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst vcount = toLineVertexCount( pointCount ) + tvcount;\r\n\tconst icount = vcount - tvcount - 2 + ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new EShapeLineUploaded(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix, Point } from \"pixi.js\";\r\nimport { toIndexOf } from \"../../util/to-index-of\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapePoints } from \"../e-shape-points\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeLineBasePointsHitTester, EShapeLineBasePointsTestRange } from \"./e-shape-line-base-points\";\r\n\r\nexport class EShapeLinePoints implements EShapePoints {\r\n\tprotected static WORK_RANGE: [ number, number ] = [ 0, 0 ];\r\n\r\n\tprotected _parent: EShape;\r\n\tprotected _valuesBase?: number[];\r\n\tprotected _valuesBaseLength: number;\r\n\tprotected _values: number[];\r\n\tprotected _segments: number[];\r\n\treadonly position: Point;\r\n\tprotected _sizeBase: Point;\r\n\treadonly size: Point;\r\n\tprotected _id: number;\r\n\tprotected _style: EShapePointsStyle;\r\n\r\n\tconstructor(\r\n\t\tparent: EShape,\r\n\t\tpoints: number[],\r\n\t\tsegments: number[],\r\n\t\tstyle: EShapePointsStyle\r\n\t) {\r\n\t\t// Calculate the center\r\n\t\tconst values: number[] = [];\r\n\t\tlet minX = 0;\r\n\t\tlet maxX = 0;\r\n\t\tlet minY = 0;\r\n\t\tlet maxY = 0;\r\n\t\tconst pointsLength = points.length;\r\n\t\tif( 2 <= pointsLength ) {\r\n\t\t\tminX = maxX = points[ 0 ];\r\n\t\t\tminY = maxY = points[ 1 ];\r\n\t\t\tfor( let i = 2; i < pointsLength; i += 2 ) {\r\n\t\t\t\tconst x = points[ i ];\r\n\t\t\t\tconst y = points[ i + 1 ];\r\n\t\t\t\tminX = Math.min( minX, x );\r\n\t\t\t\tmaxX = Math.max( maxX, x );\r\n\t\t\t\tminY = Math.min( minY, y );\r\n\t\t\t\tmaxY = Math.max( maxY, y );\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst cx = (maxX + minX) * 0.5;\r\n\t\tconst cy = (maxY + minY) * 0.5;\r\n\t\tfor( let i = 0; i < pointsLength; i += 2 ) {\r\n\t\t\tconst x = points[ i + 0 ] - cx;\r\n\t\t\tconst y = points[ i + 1 ] - cy;\r\n\t\t\tvalues.push( x, y );\r\n\t\t}\r\n\t\tconst sx = maxX - minX;\r\n\t\tconst sy = maxY - minY;\r\n\r\n\t\t//\r\n\t\tthis._parent = parent;\r\n\t\tthis._valuesBase = undefined;\r\n\t\tthis._valuesBaseLength = values.length;\r\n\t\tthis._values = values;\r\n\t\tthis._segments = segments.slice( 0 );\r\n\t\tthis._sizeBase = new Point( sx, sy );\r\n\t\tthis.size = new Point( sx, sy );\r\n\t\tthis.position = new Point( cx, cy );\r\n\t\tthis._id = 0;\r\n\t\tthis._style = style!;\r\n\t}\r\n\r\n\tget length(): number {\r\n\t\treturn this._values.length >> 1;\r\n\t}\r\n\r\n\tprivate fitToParentSize() {\r\n\t\tconst size = this.size;\r\n\t\tconst parentSize = this._parent.size;\r\n\t\tconst ssx = parentSize.x;\r\n\t\tconst ssy = parentSize.y;\r\n\t\tconst threshold = 0.00001;\r\n\t\tif( threshold < Math.abs( ssx - size.x ) || threshold < Math.abs( ssy - size.y ) ) {\r\n\t\t\tsize.set( ssx, ssy );\r\n\r\n\t\t\tconst sizeBase = this._sizeBase;\r\n\t\t\tconst hasSizeBaseX = threshold < Math.abs( sizeBase.x );\r\n\t\t\tconst hasSizeBaseY = threshold < Math.abs( sizeBase.y );\r\n\t\t\tif( hasSizeBaseX || hasSizeBaseY ) {\r\n\t\t\t\tconst scaleX = ( hasSizeBaseX ? ssx / sizeBase.x : 1 );\r\n\t\t\t\tconst scaleY = ( hasSizeBaseY ? ssy / sizeBase.y : 1 );\r\n\r\n\t\t\t\tconst values = this._values;\r\n\t\t\t\tlet valuesBase = this._valuesBase;\r\n\t\t\t\tif( valuesBase == null ) {\r\n\t\t\t\t\tvaluesBase = [];\r\n\t\t\t\t\tthis._valuesBase = valuesBase;\r\n\r\n\t\t\t\t\tfor( let i = 0, imax = this.length << 1; i < imax; i += 2 ) {\r\n\t\t\t\t\t\tconst x = values[ i ];\r\n\t\t\t\t\t\tconst y = values[ i + 1 ];\r\n\t\t\t\t\t\tvalues[ i ] = x * scaleX;\r\n\t\t\t\t\t\tvalues[ i + 1 ] = y * scaleY;\r\n\t\t\t\t\t\tvaluesBase.push( x, y );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor( let i = 0, imax = this.length << 1; i < imax; i += 2 ) {\r\n\t\t\t\t\t\tvalues[ i ] = valuesBase[ i ] * scaleX;\r\n\t\t\t\t\t\tvalues[ i + 1 ] = valuesBase[ i + 1 ] * scaleY;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._id += 1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\tthis.fitToParentSize();\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget values(): number[] {\r\n\t\tthis.fitToParentSize();\r\n\t\treturn this._values;\r\n\t}\r\n\r\n\tset values( values: number[] ) {\r\n\t\tthis.set( values, undefined, undefined );\r\n\t}\r\n\r\n\tget segments(): number[] {\r\n\t\treturn this._segments;\r\n\t}\r\n\r\n\t/**\r\n\t * Must be sorted in ascending order.\r\n\t */\r\n\tset segments( segments: number[] ) {\r\n\t\tthis.set( undefined, segments, undefined );\r\n\t}\r\n\r\n\tget style(): EShapePointsStyle {\r\n\t\treturn this._style;\r\n\t}\r\n\r\n\tset style( style: EShapePointsStyle ) {\r\n\t\tthis.set( undefined, undefined, style );\r\n\t}\r\n\r\n\tcopy( source: EShapePoints ): this {\r\n\t\treturn this.set( source.values, source.segments, source.style );\r\n\t}\r\n\r\n\tset( newValues?: number[], newSegments?: number[], newStyle?: EShapePointsStyle ): this {\r\n\t\tlet isDirty = false;\r\n\t\tlet isUpdated = false;\r\n\r\n\t\t// Values\r\n\t\tif( newValues != null ) {\r\n\t\t\tconst values = this._values;\r\n\t\t\tconst valuesBaseLength = this._valuesBaseLength;\r\n\t\t\tconst newValuesLength = newValues.length;\r\n\t\t\tconst iupdate = Math.min( newValuesLength, valuesBaseLength );\r\n\t\t\tthis._valuesBase = undefined;\r\n\t\t\tif( values !== newValues ) {\r\n\t\t\t\tfor( let i = 0; i < iupdate; ++i ) {\r\n\t\t\t\t\tvalues[ i ] = newValues[ i ];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor( let i = iupdate; i < newValuesLength; ++i ) {\r\n\t\t\t\t\tvalues.push( newValues[ i ] );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( valuesBaseLength !== newValuesLength ) {\r\n\t\t\t\t\tvalues.length = newValuesLength;\r\n\t\t\t\t\tthis._valuesBaseLength = newValuesLength;\r\n\t\t\t\t\tisDirty = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tisUpdated = true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( valuesBaseLength !== newValuesLength ) {\r\n\t\t\t\t\tthis._valuesBaseLength = newValuesLength;\r\n\t\t\t\t\tisDirty = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tisUpdated = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Segments\r\n\t\tif( newSegments != null ) {\r\n\t\t\tconst segments = this._segments;\r\n\t\t\tif( segments !== newSegments ) {\r\n\t\t\t\tconst newSegmentsLength = newSegments.length;\r\n\t\t\t\tconst iupdate = Math.min( segments.length, newSegmentsLength );\r\n\t\t\t\tfor( let i = 0; i < iupdate; ++i ) {\r\n\t\t\t\t\tsegments[ i ] = newSegments[ i ];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor( let i = iupdate; i < newSegmentsLength; ++i ) {\r\n\t\t\t\t\tsegments.push( newSegments[ i ] );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( segments.length !== newSegmentsLength ) {\r\n\t\t\t\t\tsegments.length = newSegmentsLength;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tisUpdated = true;\r\n\t\t}\r\n\r\n\t\t// Style\r\n\t\tif( newStyle != null ) {\r\n\t\t\tconst oldStyle = this._style;\r\n\t\t\tif( oldStyle !== newStyle ) {\r\n\t\t\t\tthis._style = newStyle;\r\n\t\t\t\tisUpdated = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tif( isDirty ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tconst parent = this._parent;\r\n\t\t\tconst uploaded = parent.uploaded;\r\n\t\t\tif( uploaded ) {\r\n\t\t\t\tif( uploaded.isCompatible( parent ) ) {\r\n\t\t\t\t\tparent.updateUploaded();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparent.uploaded = undefined;\r\n\t\t\t\t\tparent.toDirty();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tparent.updateUploaded();\r\n\t\t\t}\r\n\t\t} else if( isUpdated ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclone( parent: EShape ): EShapeLinePoints {\r\n\t\treturn new EShapeLinePoints( parent, this._values, this._segments, this._style );\r\n\t}\r\n\r\n\ttoPoints( transform: Matrix ): Point[] {\r\n\t\tconst result: Point[] = [];\r\n\t\tconst values = this.values;\r\n\t\tfor( let i = 0, imax = values.length; i < imax; i += 2 ) {\r\n\t\t\tconst point = new Point( values[ i + 0 ], values[ i + 1 ] );\r\n\t\t\tresult.push( transform.apply( point, point ) );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn manager.add( `[${JSON.stringify(this._values)},${JSON.stringify(this._segments)},${this._style}]` );\r\n\t}\r\n\r\n\tcalcHitPointAbs<RESULT>(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tthreshold: number,\r\n\t\trange: EShapeLineBasePointsTestRange | null,\r\n\t\ttester: EShapeLineBasePointsHitTester<RESULT>,\r\n\t\tresult: RESULT\r\n\t): boolean {\r\n\t\tconst pointCount = this.length;\r\n\t\tif( 2 <= pointCount ) {\r\n\t\t\tconst pointValues = this._values;\r\n\t\t\tconst pointSegments = this._segments;\r\n\t\t\tlet istart = 0;\r\n\t\t\tlet iend = pointCount;\r\n\t\t\tif( range ) {\r\n\t\t\t\tconst rangeResult = range( x, y, threshold, pointValues, EShapeLinePoints.WORK_RANGE );\r\n\t\t\t\tistart = rangeResult[ 0 ];\r\n\t\t\t\tiend = rangeResult[ 1 ];\r\n\t\t\t}\r\n\t\t\tfor( let i = istart, imax = Math.min( iend, pointCount - 1 ), iv = 2 * istart; i < imax; i += 1, iv += 2 ) {\r\n\t\t\t\tif( toIndexOf( pointSegments, i + 1 ) < 0 ) {\r\n\t\t\t\t\tconst p0x = pointValues[ iv + 0 ];\r\n\t\t\t\t\tconst p0y = pointValues[ iv + 1 ];\r\n\t\t\t\t\tconst p1x = pointValues[ iv + 2 ];\r\n\t\t\t\t\tconst p1y = pointValues[ iv + 3 ];\r\n\t\t\t\t\tif( tester( x, y, p0x, p0y, p1x, p1y, i, threshold, result ) ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( 2 < pointCount && pointCount <= iend && (this.style & EShapePointsStyle.CLOSED) ) {\r\n\t\t\t\tif( toIndexOf( pointSegments, 0 ) < 0 ) {\r\n\t\t\t\t\tconst i = pointCount - 1;\r\n\t\t\t\t\tconst iv = i << 1;\r\n\t\t\t\t\tconst p0x = pointValues[ iv + 0 ];\r\n\t\t\t\t\tconst p0y = pointValues[ iv + 1 ];\r\n\t\t\t\t\tconst p1x = pointValues[ 0 ];\r\n\t\t\t\t\tconst p1y = pointValues[ 1 ];\r\n\t\t\t\t\tif( tester( x, y, p0x, p0y, p1x, p1y, i, threshold, result ) ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeLineBase } from \"./e-shape-line-base\";\r\nimport { EShapeLinePoints } from \"./e-shape-line-points\";\r\n\r\nexport class EShapeLine extends EShapeLineBase {\r\n\tpoints!: EShapeLinePoints;\r\n\r\n\tconstructor( line: EShapeLine );\r\n\tconstructor( points: number[], segments: number[], width: number, style: EShapePointsStyle );\r\n\tconstructor(\r\n\t\tlineOrPoints: EShapeLine | number[],\r\n\t\tsegments?: number[],\r\n\t\twidth?: number,\r\n\t\tstyle?: EShapePointsStyle\r\n\t) {\r\n\t\tsuper( EShapeType.LINE );\r\n\t\tif( lineOrPoints instanceof EShapeLine ) {\r\n\t\t\tthis.copy( lineOrPoints );\r\n\t\t} else {\r\n\t\t\tthis.fill.enable = false;\r\n\t\t\tthis.stroke.set( true, undefined, undefined, width! );\r\n\t\t\tthis.points = new EShapeLinePoints( this, lineOrPoints, segments!, style! );\r\n\t\t\tthis.transform.position.copyFrom( this.points.position );\r\n\t\t\tthis.size.copyFrom( this.points.size );\r\n\t\t}\r\n\t}\r\n\r\n\tclone(): EShapeLine {\r\n\t\treturn new EShapeLine( this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDefaults } from \"../e-shape-defaults\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeLine } from \"./e-shape-line\";\r\n\r\nexport const deserializeLine = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeLine> | EShapeLine | null => {\r\n\tconst resources = manager.resources;\r\n\tconst resourceId = item[ 15 ];\r\n\tif( 0 <= resourceId && resourceId < resources.length ) {\r\n\t\tlet parsed = manager.extensions.get( resourceId ) as [ number[], number[], number ] | undefined;\r\n\t\tif( parsed == null ) {\r\n\t\t\tparsed = JSON.parse( resources[ resourceId ] ) as [ number[], number[], number ];\r\n\t\t\tmanager.extensions.set( resourceId, parsed );\r\n\t\t}\r\n\t\tconst shape = new EShapeLine(\r\n\t\t\tparsed[ 0 ],\r\n\t\t\tparsed[ 1 ],\r\n\t\t\tEShapeDefaults.STROKE_WIDTH,\r\n\t\t\tparsed[ 2 ]\r\n\t\t);\r\n\t\treturn EShapeDeserializer.deserialize( item, manager, shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createLineUploaded } from \"../variant/create-line-uploaded\";\r\nimport { deserializeLine } from \"../variant/deserialize-line\";\r\n\r\nexport const loadShapeLine = () => {\r\n\tEShapeUploadeds[ EShapeType.LINE ] = createLineUploaded;\r\n\tEShapeDeserializers[ EShapeType.LINE ] = deserializeLine;\r\n};\r\n","import { buildColor } from \"./build-color\";\r\nimport { EShapeLineOfAnyPointsFill } from \"./e-shape-line-of-any-points-fill\";\r\nimport { EShapeLineOfAnyPointsStroke } from \"./e-shape-line-of-any-points-stroke\";\r\n\r\nexport const toLineOfAnyPointCount = ( pointCount: number ): number => {\r\n\treturn (Math.ceil( pointCount / 12 ) * 12);\r\n};\r\n\r\nexport const buildLineOfAnyColor = (\r\n\tvoffset: number,\r\n\tvcountPerPoint: number,\r\n\tpoint: EShapeLineOfAnyPointsStroke | EShapeLineOfAnyPointsFill,\r\n\tpointCount: number,\r\n\tcolors: Float32Array,\r\n\tisEnabled: boolean,\r\n\tcolorDef: number,\r\n\talphaDef: number\r\n): void => {\r\n\tif( isEnabled ) {\r\n\t\tif( point.isStaticColor() ) {\r\n\t\t\tconst color = point.getColor( 0, colorDef );\r\n\t\t\tif( point.isStaticAlpha() ) {\r\n\t\t\t\tconst alpha = point.getAlpha( 0, alphaDef );\r\n\t\t\t\tbuildColor( color, alpha, voffset, vcountPerPoint * pointCount, colors );\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0, iv = voffset; i < pointCount; i += 1, iv += vcountPerPoint ) {\r\n\t\t\t\t\tconst alpha = point.getAlpha( i, alphaDef );\r\n\t\t\t\t\tbuildColor( color, alpha, iv, vcountPerPoint, colors );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( point.isStaticAlpha() ) {\r\n\t\t\t\tconst alpha = point.getAlpha( 0, alphaDef );\r\n\t\t\t\tfor( let i = 0, iv = voffset; i < pointCount; i += 1, iv += vcountPerPoint ) {\r\n\t\t\t\t\tconst color = point.getColor( i, colorDef );\r\n\t\t\t\t\tbuildColor( color, alpha, iv, vcountPerPoint, colors );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0, iv = voffset; i < pointCount; i += 1, iv += vcountPerPoint ) {\r\n\t\t\t\t\tconst color = point.getColor( i, colorDef );\r\n\t\t\t\t\tconst alpha = point.getAlpha( i, alphaDef );\r\n\t\t\t\t\tbuildColor( color, alpha, iv, vcountPerPoint, colors );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tif( point.isStaticColor() ) {\r\n\t\t\tconst color = point.getColor( 0, colorDef );\r\n\t\t\tbuildColor( color, 0, voffset, vcountPerPoint * pointCount, colors );\r\n\t\t} else {\r\n\t\t\tfor( let i = 0, iv = voffset; i < pointCount; i += 1, iv += vcountPerPoint ) {\r\n\t\t\t\tconst color = point.getColor( i, colorDef );\r\n\t\t\t\tbuildColor( color, 0, iv, vcountPerPoint, colors );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { toLineOfAnyPointCount } from \"./build-line-of-any\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\n\r\ninterface Initializable {\r\n\tinit( shape: EShape ): this;\r\n}\r\n\r\nexport type EShapeLineOfAnyUploadedConstructor<T extends Initializable> = new (\r\n\tbuffer: EShapeBuffer,\r\n\tvoffset: number, ioffset: number,\r\n\ttvcount: number, ticount: number,\r\n\tvcount: number, icount: number,\r\n\tantialiasWeight: number,\r\n\tpointCount: number\r\n) => T;\r\n\r\nexport const createLineOfAnyUploaded = <T extends Initializable>(\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number,\r\n\tvcountPerPoint: number,\r\n\tioffset: number,\r\n\ticountPerPoint: number,\r\n\tantialiasWeight: number,\r\n\tconstructor: EShapeLineOfAnyUploadedConstructor<T>\r\n): T | null => {\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst points = shape.points;\r\n\tconst pointCount = toLineOfAnyPointCount( points ? points.length : 0 );\r\n\tconst vcount = pointCount * vcountPerPoint + tvcount;\r\n\tconst icount = pointCount * icountPerPoint + ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new constructor(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight,\r\n\t\t\tpointCount\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","\r\nexport const buildNullClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number\r\n): void => {\r\n\tfor( let i = voffset * 3, imax = (voffset + vcount) * 3; i < imax; i += 3 ) {\r\n\t\tclippings[ i + 0 ] = 0;\r\n\t\tclippings[ i + 1 ] = 0;\r\n\t\tclippings[ i + 2 ] = 0;\r\n\t}\r\n};\r\n\r\nexport const buildNullIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number,\r\n\ticount: number\r\n): void => {\r\n\tfor( let ii = ioffset * 3, iimax = (ioffset + icount) * 3; ii < iimax; ii += 3 ) {\r\n\t\tindices[ ii + 0 ] = voffset;\r\n\t\tindices[ ii + 1 ] = voffset;\r\n\t\tindices[ ii + 2 ] = voffset;\r\n\t}\r\n};\r\n\r\nexport const buildNullVertex = (\r\n\tvertices: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number\r\n): void => {\r\n\tfor( let i = voffset * 2, imax = (voffset + vcount) * 2; i < imax; i += 2 ) {\r\n\t\tvertices[ i + 0 ] = 0;\r\n\t\tvertices[ i + 1 ] = 0;\r\n\t}\r\n};\r\n\r\nexport const buildNullStep = (\r\n\tsteps: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number\r\n): void => {\r\n\tfor( let i = voffset * 6, imax = (voffset + vcount) * 6; i < imax; i += 6 ) {\r\n\t\tsteps[ i + 0 ] = 0;\r\n\t\tsteps[ i + 1 ] = 0;\r\n\t\tsteps[ i + 2 ] = 0;\r\n\t\tsteps[ i + 3 ] = 0;\r\n\t\tsteps[ i + 4 ] = 0;\r\n\t\tsteps[ i + 5 ] = 0;\r\n\t}\r\n};\r\n\r\nexport const buildNullUv = (\r\n\tuvs: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number\r\n): void => {\r\n\tfor( let i = voffset * 2, imax = (voffset + vcount) * 2; i < imax; i += 2 ) {\r\n\t\tuvs[ i + 0 ] = 0;\r\n\t\tuvs[ i + 1 ] = 0;\r\n\t}\r\n};\r\n","\r\nexport const copyClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tvcountPerPoint: number,\r\n\tpointCount: number\r\n): void => {\r\n\tlet iv = voffset + vcountPerPoint;\r\n\tfor( let i = 1; i < pointCount; ++i ) {\r\n\t\tlet icd = iv * 3;\r\n\t\tlet ics = voffset * 3;\r\n\t\tfor( let j = 0; j < vcountPerPoint; ++j ) {\r\n\t\t\tclippings[ icd + 0 ] = clippings[ ics + 0 ];\r\n\t\t\tclippings[ icd + 1 ] = clippings[ ics + 1 ];\r\n\t\t\tclippings[ icd + 2 ] = clippings[ ics + 2 ];\r\n\t\t\ticd += 3;\r\n\t\t\tics += 3;\r\n\t\t}\r\n\t\tiv += vcountPerPoint;\r\n\t}\r\n};\r\n","export const copyIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvcountPerPoint: number,\r\n\tioffset: number,\r\n\ticountPerPoint: number,\r\n\tpointCount: number\r\n): void => {\r\n\tlet idiv = vcountPerPoint;\r\n\tlet ii = ioffset + icountPerPoint;\r\n\tfor( let i = 1; i < pointCount; ++i ) {\r\n\t\tlet iid = ii * 3;\r\n\t\tlet iis = ioffset * 3;\r\n\t\tfor( let j = 0; j < icountPerPoint; ++j ) {\r\n\t\t\tindices[ iid + 0 ] = indices[ iis + 0 ] + idiv;\r\n\t\t\tindices[ iid + 1 ] = indices[ iis + 1 ] + idiv;\r\n\t\t\tindices[ iid + 2 ] = indices[ iis + 2 ] + idiv;\r\n\t\t\tiid += 3;\r\n\t\t\tiis += 3;\r\n\t\t}\r\n\t\tidiv += vcountPerPoint;\r\n\t\tii += icountPerPoint;\r\n\t}\r\n};\r\n","export const copyStep = (\r\n\tsteps: Float32Array,\r\n\tvoffset: number,\r\n\tvcountPerPoint: number,\r\n\tpointCount: number\r\n): void => {\r\n\tconst iss0 = voffset * 6;\r\n\tlet isd = (voffset + vcountPerPoint) * 6;\r\n\tfor( let i = 1; i < pointCount; ++i ) {\r\n\t\tlet iss = iss0;\r\n\t\tfor( let j = 0; j < vcountPerPoint; ++j ) {\r\n\t\t\tsteps[ isd + 0 ] = steps[ iss + 0 ];\r\n\t\t\tsteps[ isd + 1 ] = steps[ iss + 1 ];\r\n\t\t\tsteps[ isd + 2 ] = steps[ iss + 2 ];\r\n\t\t\tsteps[ isd + 3 ] = steps[ iss + 3 ];\r\n\t\t\tsteps[ isd + 4 ] = steps[ iss + 4 ];\r\n\t\t\tsteps[ isd + 5 ] = steps[ iss + 5 ];\r\n\t\t\tisd += 6;\r\n\t\t\tiss += 6;\r\n\t\t}\r\n\t}\r\n};\r\n","\r\nexport const copyUvs = (\r\n\tuvs: Float32Array,\r\n\tvoffset: number,\r\n\tvcountPerPoint: number,\r\n\tpointCount: number\r\n): void => {\r\n\tlet iv = voffset + vcountPerPoint;\r\n\tfor( let i = 1; i < pointCount; ++i ) {\r\n\t\tlet iuvd = iv << 1;\r\n\t\tlet iuvs = voffset << 1;\r\n\t\tfor( let j = 0; j < vcountPerPoint; ++j ) {\r\n\t\t\tuvs[ iuvd     ] = uvs[ iuvs     ];\r\n\t\t\tuvs[ iuvd + 1 ] = uvs[ iuvs + 1 ];\r\n\t\t\tiuvd += 2;\r\n\t\t\tiuvs += 2;\r\n\t\t}\r\n\t\tiv += vcountPerPoint;\r\n\t}\r\n};\r\n","import { Matrix } from \"pixi.js\";\r\nimport { EShapeLineOfAnyPointsPoint } from \"./e-shape-line-of-any-points-point\";\r\n\r\nexport const copyVertex = (\r\n\tvertices: Float32Array,\r\n\tinternalTransform: Matrix,\r\n\tvoffset: number,\r\n\tvcountPerPoint: number,\r\n\tpointCount: number,\r\n\tpointsValues: number[],\r\n\tpointOffset: EShapeLineOfAnyPointsPoint\r\n): void => {\r\n\tconst a = internalTransform.a;\r\n\tconst b = internalTransform.b;\r\n\tconst c = internalTransform.c;\r\n\tconst d = internalTransform.d;\r\n\tlet i = pointCount - 1;\r\n\tlet iv = voffset + i * vcountPerPoint;\r\n\tif( pointOffset.isStaticX() && pointOffset.isStaticY() ) {\r\n\t\tconst ox = pointOffset.getX( 0 );\r\n\t\tconst oy = pointOffset.getY( 0 );\r\n\t\tfor( ; 0 <= i; --i ) {\r\n\t\t\tconst ip = i << 1;\r\n\t\t\tconst px = pointsValues[ ip     ] + ox;\r\n\t\t\tconst py = pointsValues[ ip + 1 ] + oy;\r\n\t\t\tconst dx = a * px + c * py;\r\n\t\t\tconst dy = b * px + d * py;\r\n\t\t\tlet ivd = iv << 1;\r\n\t\t\tlet ivs = voffset << 1;\r\n\t\t\tfor( let j = 0; j < vcountPerPoint; ++j ) {\r\n\t\t\t\tvertices[ ivd     ] = vertices[ ivs     ] + dx;\r\n\t\t\t\tvertices[ ivd + 1 ] = vertices[ ivs + 1 ] + dy;\r\n\t\t\t\tivd += 2;\r\n\t\t\t\tivs += 2;\r\n\t\t\t}\r\n\t\t\tiv -= vcountPerPoint;\r\n\t\t}\r\n\t} else {\r\n\t\tfor( ; 0 <= i; --i ) {\r\n\t\t\tconst ip = i << 1;\r\n\t\t\tconst px = pointsValues[ ip     ] + pointOffset.getX( i );\r\n\t\t\tconst py = pointsValues[ ip + 1 ] + pointOffset.getY( i );\r\n\t\t\tconst dx = a * px + c * py;\r\n\t\t\tconst dy = b * px + d * py;\r\n\t\t\tlet ivd = iv << 1;\r\n\t\t\tlet ivs = voffset << 1;\r\n\t\t\tfor( let j = 0; j < vcountPerPoint; ++j ) {\r\n\t\t\t\tvertices[ ivd     ] = vertices[ ivs     ] + dx;\r\n\t\t\t\tvertices[ ivd + 1 ] = vertices[ ivs + 1 ] + dy;\r\n\t\t\t\tivd += 2;\r\n\t\t\t\tivs += 2;\r\n\t\t\t}\r\n\t\t\tiv -= vcountPerPoint;\r\n\t\t}\r\n\t}\r\n};\r\n","import { isNumber } from \"../../util/is-number\";\r\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\r\n\r\nexport const isStatic = ( value: EShapeLineOfAnyValue ): boolean => {\r\n\treturn isNumber( value ) || value == null;\r\n};\r\n","import { isFunction } from \"../../util/is-function\";\r\nimport { isNumber } from \"../../util/is-number\";\r\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\r\n\r\nexport const toComputed = ( index: number, value: EShapeLineOfAnyValue, def: number ): number => {\r\n\tif( isNumber( value ) ) {\r\n\t\treturn value;\r\n\t} else if( isFunction( value ) ) {\r\n\t\treturn value( index );\r\n\t} else if( value ) {\r\n\t\treturn value[ index % value.length ];\r\n\t}\r\n\treturn def;\r\n};\r\n","/*\r\n * Copyright (C) 2020 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeLineOfAnyPointsFill } from \"./e-shape-line-of-any-points-fill\";\r\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\r\nimport { isStatic } from \"./is-static\";\r\nimport { toComputed } from \"./to-computed\";\r\n\r\nexport interface EShapeLineOfAnyPointsFillImplParent {\r\n\tupdateUploaded(): void;\r\n}\r\n\r\nexport class EShapeLineOfAnyPointsFillImpl implements EShapeLineOfAnyPointsFill {\r\n\tprotected _parent: EShapeLineOfAnyPointsFillImplParent;\r\n\tprotected _id: number;\r\n\tprotected _color: EShapeLineOfAnyValue;\r\n\tprotected _alpha: EShapeLineOfAnyValue;\r\n\r\n\tconstructor( parent: EShapeLineOfAnyPointsFillImplParent ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._id = 0;\r\n\t\tthis._color = null;\r\n\t\tthis._alpha = null;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget color(): EShapeLineOfAnyValue {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: EShapeLineOfAnyValue ) {\r\n\t\tthis.set( color, undefined );\r\n\t}\r\n\r\n\tget alpha(): EShapeLineOfAnyValue {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: EShapeLineOfAnyValue ) {\r\n\t\tthis.set( undefined, alpha );\r\n\t}\r\n\r\n\tset( color?: EShapeLineOfAnyValue, alpha?: EShapeLineOfAnyValue ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( color !== undefined && this._color !== color ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tthis._color = color;\r\n\t\t}\r\n\r\n\t\tif( alpha !== undefined && this._alpha !== alpha ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tthis._alpha = alpha;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tgetColor( index: number, def: number ): number {\r\n\t\treturn toComputed( index, this._color, def );\r\n\t}\r\n\r\n\tgetAlpha( index: number, def: number ): number {\r\n\t\treturn toComputed( index, this._alpha, def );\r\n\t}\r\n\r\n\tisStaticColor(): boolean {\r\n\t\treturn isStatic( this._color );\r\n\t}\r\n\r\n\tisStaticAlpha(): boolean {\r\n\t\treturn isStatic( this._alpha );\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._id += 1;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { BaseTexture, Rectangle, Texture } from \"pixi.js\";\r\n\r\nexport abstract class DynamicAtlasItem {\r\n\tid: string;\r\n\tref: number;\r\n\tframe: Rectangle;\r\n\ttexture: Texture;\r\n\r\n\twidth: number;\r\n\theight: number;\r\n\tstrokeWidth: number;\r\n\r\n\tconstructor(\r\n\t\tid: string,\r\n\t\twidth: number, height: number, strokeWidth: number,\r\n\t\tbaseTexture: BaseTexture\r\n\t) {\r\n\t\tthis.id = id;\r\n\t\tthis.ref = 0;\r\n\t\tconst resolution = baseTexture.resolution;\r\n\t\tthis.frame = new Rectangle( 0, 0, width * resolution, height * resolution );\r\n\t\tthis.texture = new Texture( baseTexture, new Rectangle( 0, 0, 1, 1 ) );\r\n\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t\tthis.strokeWidth = strokeWidth;\r\n\t}\r\n\r\n\tabstract render( context: CanvasRenderingContext2D ): void;\r\n\r\n\tapplyFrame(): void {\r\n\t\tconst resolutionInverse = 1 / this.texture.baseTexture.resolution;\r\n\t\tthis.texture.frame.x = this.frame.x * resolutionInverse;\r\n\t\tthis.texture.frame.y = this.frame.y * resolutionInverse;\r\n\t\tthis.texture.frame.width = this.width;\r\n\t\tthis.texture.frame.height = this.height;\r\n\t\tthis.texture.updateUvs();\r\n\t\tthis.texture.emit( \"update\", this );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis.texture.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\r\n\r\nexport class DynamicAtlasItemEmpty extends DynamicAtlasItem {\r\n\trender( context: CanvasRenderingContext2D ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { BaseTexture } from \"pixi.js\";\r\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\r\nimport { DynamicSDFFontAtlas } from \"./dynamic-sdf-font-atlas\";\r\n\r\nexport class DynamicAtlasItemFontAtlas extends DynamicAtlasItem {\r\n\tcanvas: HTMLCanvasElement | null;\r\n\r\n\tconstructor( atlas: DynamicSDFFontAtlas, baseTexture: BaseTexture ) {\r\n\t\tsuper( atlas.id, atlas.width / baseTexture.resolution, atlas.height / baseTexture.resolution, 0, baseTexture );\r\n\t\tthis.canvas = atlas.canvas;\r\n\t}\r\n\r\n\trender( context: CanvasRenderingContext2D ): void {\r\n\t\tconst canvas = this.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst frame = this.frame;\r\n\t\t\tcontext.drawImage( canvas, frame.x, frame.y, frame.width, frame.height );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { BaseTexture } from \"pixi.js\";\r\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\r\n\r\nexport class DynamicAtlasItemImage extends DynamicAtlasItem {\r\n\timage: HTMLImageElement;\r\n\r\n\tconstructor( image: HTMLImageElement, baseTexture: BaseTexture ) {\r\n\t\tsuper( image.src, image.width / baseTexture.resolution, image.height / baseTexture.resolution, 0, baseTexture );\r\n\t\tthis.image = image;\r\n\t}\r\n\r\n\trender( context: CanvasRenderingContext2D ): void {\r\n\t\tconst frame = this.frame;\r\n\t\tconst x = frame.x;\r\n\t\tconst y = frame.y;\r\n\t\tconst w = frame.width;\r\n\t\tconst h = frame.height;\r\n\t\tconst image = this.image;\r\n\r\n\t\tcontext.drawImage( image, x, y, w, h );\r\n\r\n\t\tcontext.drawImage( image, 0, 0, 1, h, x - 1, y - 1, 1, h + 2 );\r\n\t\tcontext.drawImage( image, 0, 0, w, 1, x, y - 1, w, 1 );\r\n\t\tcontext.drawImage( image, w - 1, 0, 1, h, x + w, y - 1, 1, h + 2 );\r\n\t\tcontext.drawImage( image, 0, h - 1, w, 1, x, y + h, w, 1 );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { BaseTexture, Text } from \"pixi.js\";\r\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\r\n\r\nexport class DynamicAtlasItemText extends DynamicAtlasItem {\r\n\tprotected _text: Text;\r\n\r\n\tconstructor( id: string, text: Text, baseTexture: BaseTexture ) {\r\n\t\tsuper( id, text.width, text.height, 0, baseTexture );\r\n\t\tthis._text = text;\r\n\t}\r\n\r\n\trender( context: CanvasRenderingContext2D ): void {\r\n\t\tconst frame = this.frame;\r\n\t\tcontext.drawImage( this._text.canvas, frame.x, frame.y, frame.width, frame.height );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\r\n\r\nexport class DynamicAtlasItemWhite extends DynamicAtlasItem {\r\n\trender( context: CanvasRenderingContext2D ): void {\r\n\t\tconst frame = this.frame;\r\n\r\n\t\tcontext.save();\r\n\t\tcontext.fillStyle = \"#ffffff\";\r\n\t\tcontext.fillRect( frame.x - 1, frame.y - 1, frame.width + 2, frame.height + 2 );\r\n\t\tcontext.restore();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { BaseTexture, MIPMAP_MODES, Texture } from \"pixi.js\";\r\nimport { DynamicAtlasItem } from \"./dynamic-atlas-item\";\r\nimport { DynamicAtlasItemEmpty } from \"./dynamic-atlas-item-empty\";\r\nimport { DynamicAtlasItemWhite } from \"./dynamic-atlas-item-white\";\r\n\r\nconst MAXIMUM_TEXTURE_SIZE = 4096;\r\n\r\nexport class DynamicAtlas {\r\n\tprotected static INSTANCE: DynamicAtlas | null;\r\n\r\n\tprotected _canvas: HTMLCanvasElement;\r\n\tprotected _sortedData: DynamicAtlasItem[];\r\n\tprotected _idToDatum: { [ id: string ]: DynamicAtlasItem };\r\n\tprotected _baseTexture: BaseTexture;\r\n\tprotected _isDirty: boolean;\r\n\tprotected _predefined: { [ id: string ]: DynamicAtlasItem };\r\n\r\n\tconstructor( resolution: number ) {\r\n\t\tconst canvas = this._canvas = document.createElement( \"canvas\" );\r\n\t\tcanvas.width = canvas.height = 256;\r\n\r\n\t\tconst baseTexture = this._baseTexture = BaseTexture.from( canvas, {\r\n\t\t\tmipmap: MIPMAP_MODES.OFF,\r\n\t\t\tresolution\r\n\t\t});\r\n\r\n\t\tthis._idToDatum = {};\r\n\t\tthis._sortedData = [];\r\n\t\tthis._predefined = {\r\n\t\t\tempty: new DynamicAtlasItemEmpty(\r\n\t\t\t\t\"empty\", 10, 10, 0, baseTexture\r\n\t\t\t),\r\n\t\t\twhite: new DynamicAtlasItemWhite(\r\n\t\t\t\t\"white\", 10, 10, 0, baseTexture\r\n\t\t\t)\r\n\t\t};\r\n\r\n\t\tthis._isDirty = true;\r\n\t}\r\n\r\n\tupdateFrames( width: number, data: DynamicAtlasItem[] ): number {\r\n\t\tconst padding = 4;\r\n\t\tlet x = padding;\r\n\t\tlet y = padding;\r\n\t\tlet maxRowHeight = 0;\r\n\t\tfor( let i = 0, imax = data.length; i < imax; ++i ) {\r\n\t\t\tconst datum = data[ i ];\r\n\t\t\tif( width < x + datum.frame.width + padding ) {\r\n\t\t\t\tx = padding;\r\n\t\t\t\ty += maxRowHeight + padding;\r\n\t\t\t\tmaxRowHeight = 0;\r\n\t\t\t}\r\n\t\t\tdatum.frame.x = x | 0;\r\n\t\t\tdatum.frame.y = y | 0;\r\n\t\t\tx += datum.frame.width + padding;\r\n\t\t\tmaxRowHeight = Math.max( maxRowHeight, datum.frame.height );\r\n\t\t}\r\n\r\n\t\tconst minHeight = y + maxRowHeight + padding;\r\n\t\tlet result = 256;\r\n\t\twhile( result < minHeight ) {\r\n\t\t\tresult <<= 1;\r\n\t\t}\r\n\t\treturn Math.min( MAXIMUM_TEXTURE_SIZE, result );\r\n\t}\r\n\r\n\trenderFrames( width: number, height: number, data: DynamicAtlasItem[] ): void {\r\n\t\tconst canvas = this._canvas;\r\n\t\tcanvas.width = width;\r\n\t\tcanvas.height = height;\r\n\t\tconst context = canvas.getContext( \"2d\" );\r\n\t\tif( context != null ) {\r\n\t\t\tfor( let i = 0, imax = data.length; i < imax; ++i ) {\r\n\t\t\t\tconst datum = data[ i ];\r\n\t\t\t\tdatum.render( context );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tapplyFrames( data: DynamicAtlasItem[] ): void {\r\n\t\tfor( let i = 0, imax = data.length; i < imax; ++i ) {\r\n\t\t\tconst datum = data[ i ];\r\n\t\t\tdatum.applyFrame();\r\n\t\t}\r\n\t}\r\n\r\n\tcalcCanvasWidth( data: DynamicAtlasItem[] ): number {\r\n\t\tlet result = 128;\r\n\t\tfor( let i = data.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst datum = data[ i ];\r\n\t\t\tconst size = Math.max( datum.frame.width, datum.frame.height );\r\n\t\t\twhile( result < size ) {\r\n\t\t\t\tresult <<= 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Math.min( MAXIMUM_TEXTURE_SIZE, result << 1 );\r\n\t}\r\n\r\n\tcleanup( data: DynamicAtlasItem[] ): void {\r\n\t\tdata.sort( DynamicAtlas.ITEM_COMPARATOR );\r\n\t\tfor( let i = data.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst datum = data[ i ];\r\n\t\t\tif( 0 < datum.ref ) {\r\n\t\t\t\tdata.length = i + 1;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdata.length = 0;\r\n\t}\r\n\r\n\tbegin(): void {\r\n\t\tconst data = this._sortedData;\r\n\t\tfor( let i = 0, imax = data.length; i < imax; ++i ) {\r\n\t\t\tconst datum = data[ i ];\r\n\t\t\tdatum.ref = 0;\r\n\t\t}\r\n\r\n\t\tthis._isDirty = false;\r\n\t}\r\n\r\n\tend(): void {\r\n\t\tconst idToDatum = this._idToDatum;\r\n\t\tconst data = this._sortedData;\r\n\t\tfor( let i = 0, imax = data.length; i < imax; ++i ) {\r\n\t\t\tconst datum = data[ i ];\r\n\t\t\tif( datum.ref <= 0 ) {\r\n\t\t\t\tif( !( datum.id in this._predefined ) ) {\r\n\t\t\t\t\tdatum.destroy();\r\n\t\t\t\t}\r\n\t\t\t\tdelete idToDatum[ datum.id ];\r\n\t\t\t\tthis._isDirty = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trepack( forcibly?: boolean ): void {\r\n\t\tif( forcibly === true || this._isDirty ) {\r\n\t\t\tthis._isDirty = false;\r\n\t\t\tconst data = this._sortedData;\r\n\t\t\tthis.cleanup( data );\r\n\t\t\tconst canvasWidth = this.calcCanvasWidth( data );\r\n\t\t\tconst canvasHeight = this.updateFrames( canvasWidth, data );\r\n\t\t\tthis.renderFrames( canvasWidth, canvasHeight, data );\r\n\t\t\tthis._baseTexture.setRealSize( canvasWidth, canvasHeight );\r\n\t\t\tthis.applyFrames( data );\r\n\t\t}\r\n\t}\r\n\r\n\tget( id: string ): DynamicAtlasItem | null {\r\n\t\tconst idToDatum = this._idToDatum;\r\n\t\tconst datum =  idToDatum[ id ];\r\n\t\tif( datum != null ) {\r\n\t\t\tdatum.ref += 1;\r\n\t\t\treturn datum;\r\n\t\t} else {\r\n\t\t\tconst predefined = this._predefined[ id ];\r\n\t\t\tif( predefined != null ) {\r\n\t\t\t\tthis.set( id, predefined );\r\n\t\t\t\treturn predefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tset( id: string, item: DynamicAtlasItem ): DynamicAtlasItem | undefined {\r\n\t\tconst result = this._idToDatum[ id ];\r\n\t\titem.ref += 1;\r\n\t\tthis._idToDatum[ id ] = item;\r\n\t\tthis._sortedData.push( item );\r\n\t\tthis._isDirty = true;\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._isDirty = true;\r\n\t}\r\n\r\n\tgetDefaultTexture(): Texture {\r\n\t\treturn this.get( \"white\" )!.texture;\r\n\t}\r\n\r\n\tgetBaseTexture(): BaseTexture {\r\n\t\treturn this._baseTexture;\r\n\t}\r\n\r\n\trelease( id: string ): void {\r\n\t\tconst idToDatum = this._idToDatum;\r\n\t\tconst datum = idToDatum[ id ];\r\n\t\tif( datum != null ) {\r\n\t\t\tdatum.ref -= 1;\r\n\t\t\tif( datum.ref <= 0 ) {\r\n\t\t\t\tif( !( datum.id in this._predefined ) ) {\r\n\t\t\t\t\tdatum.destroy();\r\n\t\t\t\t}\r\n\t\t\t\tdelete idToDatum[ id ];\r\n\t\t\t\tthis._isDirty = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstatic ITEM_COMPARATOR = ( a: DynamicAtlasItem, b: DynamicAtlasItem ): number => {\r\n\t\tif( a.ref <= 0 ) {\r\n\t\t\tif( b.ref <= 0 ) {\r\n\t\t\t\treturn 0;\r\n\t\t\t} else {\r\n\t\t\t\treturn +1;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( b.ref <= 0 ) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( a.frame.height < b.frame.height ) {\r\n\t\t\treturn -1;\r\n\t\t} else if( b.frame.height < a.frame.height ) {\r\n\t\t\treturn +1;\r\n\t\t} else {\r\n\t\t\treturn a.frame.width - b.frame.width;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { TextMetrics, utils } from \"pixi.js\";\r\n\r\nexport class DynamicFontAtlasFont {\r\n\tid: string;\r\n\tsize: number;\r\n\tcolor: string;\r\n\theight: number;\r\n\r\n\tascent: number;\r\n\tdescent: number;\r\n\r\n\tconstructor( fontId: string, size: number, color: number, padding: number ) {\r\n\t\tthis.id = fontId;\r\n\t\tthis.size = size;\r\n\t\tthis.color = utils.hex2string( color );\r\n\t\tthis.height = size + padding * 2;\r\n\t\tconst metrics = TextMetrics.measureFont( fontId );\r\n\t\tthis.ascent = metrics.ascent;\r\n\t\tthis.descent = metrics.descent;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { MIPMAP_MODES, SCALE_MODES, Texture } from \"pixi.js\";\r\nimport { ASCII_CHARACTERS } from \"./ascii\";\r\nimport { DynamicFontAtlasCharacter } from \"./dynamic-font-atlas-character\";\r\nimport { DynamicFontAtlasCharacters } from \"./dynamic-font-atlas-characters\";\r\nimport { DynamicFontAtlasFont } from \"./dynamic-font-atlas-font\";\r\nimport { UtilCharacterIterator } from \"./util-character-iterator\";\r\n\r\nconst PADDING = 3;\r\n\r\nexport class DynamicFontAtlas {\r\n\tprotected _id: string;\r\n\tprotected _canvas: HTMLCanvasElement | null;\r\n\tprotected _context: CanvasRenderingContext2D | null;\r\n\tprotected _font: DynamicFontAtlasFont;\r\n\tprotected _characters: DynamicFontAtlasCharacters;\r\n\tprotected _length: number;\r\n\tprotected _unrefCount: number;\r\n\tprotected _width: number;\r\n\tprotected _height: number;\r\n\tprotected _revision: number;\r\n\tprotected _revisionUpdated: number;\r\n\tprotected _texture: Texture;\r\n\r\n\tconstructor( fontId: string, fontSize: number, fontColor: number, resolution: number ) {\r\n\t\tthis._id = fontId;\r\n\t\tthis._canvas = document.createElement( \"canvas\" );\r\n\t\tthis._context = null;\r\n\t\tthis._font = new DynamicFontAtlasFont( fontId, fontSize, fontColor, PADDING );\r\n\t\tthis._characters = {};\r\n\t\tthis._length = 0;\r\n\t\tthis._unrefCount = 0;\r\n\t\tthis._width = 1;\r\n\t\tthis._height = 1;\r\n\t\tthis._revision = 0;\r\n\t\tthis._revisionUpdated = 0;\r\n\t\tthis._texture = Texture.from( this._canvas, {\r\n\t\t\tmipmap: MIPMAP_MODES.OFF,\r\n\t\t\tresolution,\r\n\t\t\tscaleMode: SCALE_MODES.NEAREST\r\n\t\t});\r\n\r\n\t\tthis.add( ASCII_CHARACTERS, true );\r\n\t\tthis.add_( \"...\", this._characters, true );\r\n\t}\r\n\r\n\tget id() {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget font(): DynamicFontAtlasFont {\r\n\t\treturn this._font;\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tget canvas(): HTMLCanvasElement | null {\r\n\t\treturn this._canvas;\r\n\t}\r\n\r\n\tget characters(): DynamicFontAtlasCharacters {\r\n\t\treturn this._characters;\r\n\t}\r\n\r\n\tget texture(): Texture {\r\n\t\treturn this._texture;\r\n\t}\r\n\r\n\tprotected add_( character: string, characters: DynamicFontAtlasCharacters, reserved?: boolean ): void {\r\n\t\tif( character !== \"\\n\" ) {\r\n\t\t\tconst data = characters[ character ];\r\n\t\t\tif( data != null ) {\r\n\t\t\t\tif( ! data.reserved ) {\r\n\t\t\t\t\tif( data.ref === 0 ) {\r\n\t\t\t\t\t\tthis._unrefCount -= 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata.ref += 1;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst advance = this.getAdvance( character );\r\n\t\t\t\tconst width = Math.ceil( PADDING + advance + PADDING );\r\n\t\t\t\tconst height = this.font.height;\r\n\t\t\t\tcharacters[ character ] = new DynamicFontAtlasCharacter( advance, width, height, !! reserved );\r\n\t\t\t\tthis._length += 1;\r\n\t\t\t\tthis._revision += 1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected remove_( character: string, characters: DynamicFontAtlasCharacters ): void {\r\n\t\tif( character !== \"\\n\" ) {\r\n\t\t\tconst data = characters[ character ];\r\n\t\t\tif( data != null ) {\r\n\t\t\t\tif( ! data.reserved && 0 < data.ref ) {\r\n\t\t\t\t\tdata.ref -= 1;\r\n\t\t\t\t\tif( data.ref === 0 ) {\r\n\t\t\t\t\t\tthis._unrefCount += 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected cleanup_(): void {\r\n\t\tif( (this._length >> 1) <= this._unrefCount ) {\r\n\t\t\tconst characters = this._characters;\r\n\t\t\tfor( const character in characters ) {\r\n\t\t\t\tif( characters[ character ].ref <= 0 ) {\r\n\t\t\t\t\tdelete characters[ character ];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._length -= this._unrefCount;\r\n\t\t\tthis._revision += 1;\r\n\t\t\tthis._unrefCount = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tadd( targets: string, reserved?: boolean ): void {\r\n\t\tconst characters = this._characters;\r\n\t\tconst iterator = UtilCharacterIterator.from( targets );\r\n\t\twhile( iterator.hasNext() ) {\r\n\t\t\tthis.add_( iterator.next(), characters, reserved );\r\n\t\t}\r\n\t}\r\n\r\n\tremove( targets: string ): void {\r\n\t\tconst characters = this._characters;\r\n\t\tconst iterator = UtilCharacterIterator.from( targets );\r\n\t\twhile( iterator.hasNext() ) {\r\n\t\t\tthis.remove_( iterator.next(), characters );\r\n\t\t}\r\n\t}\r\n\r\n\tget( character: string ): DynamicFontAtlasCharacter | undefined {\r\n\t\treturn this._characters[ character ];\r\n\t}\r\n\r\n\tgetAdvance( target: string ): number {\r\n\t\tconst context = this.getContext();\r\n\t\tif( context != null ) {\r\n\t\t\treturn context.measureText( target ).width;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tgetContext(): CanvasRenderingContext2D | null {\r\n\t\tlet context = this._context;\r\n\t\tif( context == null ) {\r\n\t\t\tconst canvas = this._canvas;\r\n\t\t\tif( canvas != null ) {\r\n\t\t\t\tcontext = this._context = canvas.getContext( \"2d\", { alpha: true } );\r\n\t\t\t\tif( context == null ) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst font = this._font;\r\n\t\tif( context.font !== font.id ) {\r\n\t\t\tcontext.font = font.id;\r\n\t\t\tfont.id = context.font;\r\n\t\t\tcontext.textAlign = \"left\";\r\n\t\t\tcontext.textBaseline = \"alphabetic\";\r\n\t\t\tcontext.lineWidth = 0;\r\n\t\t\tcontext.lineCap = \"round\";\r\n\t\t\tcontext.lineJoin = \"miter\";\r\n\t\t\tcontext.miterLimit = 0;\r\n\t\t\tcontext.fillStyle = font.color;\r\n\t\t\tcontext.strokeStyle = \"#0000ff\";\r\n\t\t}\r\n\t\treturn context;\r\n\t}\r\n\r\n\tupdate(): boolean {\r\n\t\tthis.cleanup_();\r\n\r\n\t\tif( this._revisionUpdated < this._revision ) {\r\n\t\t\tthis._revisionUpdated = this._revision;\r\n\r\n\t\t\tconst canvas = this._canvas;\r\n\t\t\tif( canvas != null ) {\r\n\t\t\t\tconst font = this._font;\r\n\t\t\t\tconst fontHeight = font.height;\r\n\t\t\t\tconst characters = this._characters;\r\n\t\t\t\tconst width = this._width = this.toPowerOf2( Math.ceil( Math.sqrt( this._length ) ) * fontHeight );\r\n\r\n\t\t\t\tconst offsetX = PADDING;\r\n\t\t\t\tconst offsetY = Math.round( (fontHeight - (font.ascent + font.descent)) * 0.5 + font.ascent );\r\n\t\t\t\tlet x = 0;\r\n\t\t\t\tlet y = 0;\r\n\t\t\t\tfor( const key in characters ) {\r\n\t\t\t\t\tconst character = characters[ key ];\r\n\t\t\t\t\tif( width <= x + character.width ) {\r\n\t\t\t\t\t\tx = 0;\r\n\t\t\t\t\t\ty += fontHeight;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcharacter.x = x;\r\n\t\t\t\t\tcharacter.y = y;\r\n\t\t\t\t\tcharacter.origin.x = x + offsetX;\r\n\t\t\t\t\tcharacter.origin.y = y + offsetY;\r\n\r\n\t\t\t\t\tx += character.width;\r\n\t\t\t\t}\r\n\t\t\t\tconst height = this._height = y + fontHeight;\r\n\r\n\t\t\t\t// Make a input canvas\r\n\t\t\t\t// Here, we need to reset the context because\r\n\t\t\t\t// context settings will be lost when we set the width/height.\r\n\t\t\t\tconst baseTexture = this._texture.baseTexture;\r\n\t\t\t\tconst resolution = baseTexture.resolution;\r\n\t\t\t\tconst realWidth = Math.ceil( width * resolution );\r\n\t\t\t\tconst realHeight = Math.ceil( height * resolution );\r\n\t\t\t\tcanvas.width = realWidth;\r\n\t\t\t\tcanvas.height = realHeight;\r\n\t\t\t\tconst context = this.getContext();\r\n\t\t\t\tif( context != null ) {\r\n\t\t\t\t\tcontext.save();\r\n\t\t\t\t\tcontext.scale( resolution, resolution );\r\n\t\t\t\t\tcontext.clearRect( 0, 0, width, height );\r\n\t\t\t\t\tfor( const key in characters ) {\r\n\t\t\t\t\t\tconst character = characters[ key ];\r\n\t\t\t\t\t\tcontext.fillText( key, character.origin.x, character.origin.y );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontext.restore();\r\n\t\t\t\t}\r\n\t\t\t\tbaseTexture.setRealSize( realWidth, realHeight );\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetRevision(): number {\r\n\t\treturn this._revision;\r\n\t}\r\n\r\n\tgetRevisionUpdate(): number {\r\n\t\treturn this._revisionUpdated;\r\n\t}\r\n\r\n\tget length(): number {\r\n\t\treturn this._length;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tconst canvas = this._canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tthis._canvas = null;\r\n\t\t}\r\n\r\n\t\tconst characters = this._characters;\r\n\t\tfor( const character in characters ) {\r\n\t\t\tdelete characters[ character ];\r\n\t\t}\r\n\t}\r\n\r\n\ttoPowerOf2( size: number ): number {\r\n\t\tlet result = 32;\r\n\t\twhile( result < size ) {\r\n\t\t\tresult <<= 1;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DApplicationLayerLike } from \"../d-application-layer-like\";\r\nimport { DynamicFontAtlas } from \"./dynamic-font-atlas\";\r\n\r\nconst update = ( atlas: DynamicFontAtlas ): void => {\r\n\tatlas.update();\r\n};\r\n\r\nconst updateAll = ( colorToAltas: Map<number, DynamicFontAtlas> ): void => {\r\n\tcolorToAltas.forEach( update );\r\n};\r\n\r\nconst destroy = ( atlas: DynamicFontAtlas ): void => {\r\n\tatlas.update();\r\n};\r\n\r\nconst destroyAll = ( colorToAltas: Map<number, DynamicFontAtlas> ): void => {\r\n\tcolorToAltas.forEach( destroy );\r\n};\r\n\r\nexport class DynamicFontAtlases {\r\n\tprotected _atlases: Map<string, Map<number, DynamicFontAtlas>>;\r\n\tprotected _resolution: number;\r\n\r\n\tconstructor( layer: DApplicationLayerLike ) {\r\n\t\tthis._atlases = new Map<string, Map<number, DynamicFontAtlas>>();\r\n\t\tthis._resolution = layer.renderer.resolution;\r\n\r\n\t\tlayer.renderer.on( \"prerender\", (): void => {\r\n\t\t\tthis.update();\r\n\t\t});\r\n\t}\r\n\r\n\tadd( fontId: string, fontSize: number, fontColor: number, targets: string ): void {\r\n\t\tconst atlases = this._atlases;\r\n\t\tlet colorToAtlas = atlases.get( fontId );\r\n\t\tif( colorToAtlas == null ) {\r\n\t\t\tcolorToAtlas = new Map<number, DynamicFontAtlas>();\r\n\t\t\tatlases.set( fontId, colorToAtlas );\r\n\t\t}\r\n\t\tlet atlas = colorToAtlas.get( fontColor );\r\n\t\tif( atlas == null ) {\r\n\t\t\tatlas = new DynamicFontAtlas( fontId, fontSize, fontColor, this._resolution );\r\n\t\t\tcolorToAtlas.set( fontColor, atlas );\r\n\t\t}\r\n\t\tatlas.add( targets );\r\n\t}\r\n\r\n\tremove( fontId: string, fontColor: number, targets: string ): void {\r\n\t\tconst colorToAtlas = this._atlases.get( fontId );\r\n\t\tif( colorToAtlas != null ) {\r\n\t\t\tconst atlas = colorToAtlas.get( fontColor );\r\n\t\t\tif( atlas != null ) {\r\n\t\t\t\tatlas.remove( targets );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget( fontId: string, fontColor: number ): DynamicFontAtlas | null {\r\n\t\tconst atlases = this._atlases;\r\n\t\tconst colorToAtlas = atlases.get( fontId );\r\n\t\tif( colorToAtlas == null ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst atlas = colorToAtlas.get( fontColor );\r\n\t\tif( atlas == null ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn atlas;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tthis._atlases.forEach( updateAll );\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tconst atlases = this._atlases;\r\n\t\tatlases.forEach( destroyAll );\r\n\t\tatlases.clear();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DynamicAtlas } from \"./dynamic-atlas\";\r\nimport { DynamicAtlasItemFontAtlas } from \"./dynamic-atlas-item-font-atlas\";\r\nimport { DynamicSDFFontAtlas } from \"./dynamic-sdf-font-atlas\";\r\n\r\nexport class DynamicSDFFontAtlases {\r\n\tprotected _atlases: { [ family: string ]: DynamicSDFFontAtlas };\r\n\r\n\tconstructor() {\r\n\t\tthis._atlases = {};\r\n\t}\r\n\r\n\tbegin(): void {\r\n\t\tconst atlases = this._atlases;\r\n\t\tfor( const family in atlases ) {\r\n\t\t\tconst atlas = atlases[ family ];\r\n\t\t\tatlas.begin();\r\n\t\t}\r\n\t}\r\n\r\n\tend(): void {\r\n\t\tconst atlases = this._atlases;\r\n\t\tfor( const family in atlases ) {\r\n\t\t\tconst atlas = atlases[ family ];\r\n\t\t\tif( 0 < atlas.length ) {\r\n\t\t\t\tatlas.addAscii();\r\n\t\t\t}\r\n\t\t\tatlas.end();\r\n\t\t\tif( atlas.length <= 0 ) {\r\n\t\t\t\tatlas.destroy();\r\n\t\t\t\tdelete atlases[ family ];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tadd( family: string, targets: string ) {\r\n\t\tconst atlas = this._atlases[ family ];\r\n\t\tif( atlas != null ) {\r\n\t\t\tatlas.add( targets );\r\n\t\t} else {\r\n\t\t\tconst newAtlas = new DynamicSDFFontAtlas( family );\r\n\t\t\tnewAtlas.add( targets );\r\n\t\t\tthis._atlases[ family ] = newAtlas;\r\n\t\t}\r\n\t}\r\n\r\n\tget( family: string ): DynamicSDFFontAtlas | null {\r\n\t\tconst atlas = this._atlases[ family ];\r\n\t\tif( atlas != null ) {\r\n\t\t\treturn atlas;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tupdate( baseAtlas: DynamicAtlas ): void {\r\n\t\tconst atlases = this._atlases;\r\n\t\tconst baseTexture = baseAtlas.getBaseTexture();\r\n\t\tfor( const family in atlases ) {\r\n\t\t\tconst atlas = atlases[ family ];\r\n\t\t\tif( atlas.update() ) {\r\n\t\t\t\tconst atlasId = atlas.id;\r\n\t\t\t\tconst item = baseAtlas.get( atlasId );\r\n\t\t\t\tif( item != null ) {\r\n\t\t\t\t\tconst width = atlas.width;\r\n\t\t\t\t\tconst height = atlas.height;\r\n\t\t\t\t\tconst resolution = baseTexture.resolution;\r\n\t\t\t\t\titem.frame.width = width;\r\n\t\t\t\t\titem.frame.height = height;\r\n\t\t\t\t\titem.width = width / resolution;\r\n\t\t\t\t\titem.height = height / resolution;\r\n\t\t\t\t\tbaseAtlas.toDirty();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbaseAtlas.set(\r\n\t\t\t\t\t\tatlasId,\r\n\t\t\t\t\t\tnew DynamicAtlasItemFontAtlas( atlas, baseTexture )\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst atlases = this._atlases;\r\n\t\tfor( const family in atlases ) {\r\n\t\t\tconst atlas = atlases[ family ];\r\n\t\t\tatlas.destroy();\r\n\t\t}\r\n\t\tthis._atlases = {};\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const isNaN = ( target: number ): boolean => {\r\n\treturn target !== target;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"../d-base\";\r\n\r\nexport class Lazy<INSTANCE, OPTIONS> {\r\n\tinstance: INSTANCE | null;\r\n\tnewInstance: new ( options: OPTIONS ) => INSTANCE;\r\n\toptions: OPTIONS;\r\n\r\n\tconstructor( newInstance: new ( options: OPTIONS ) => INSTANCE, options: OPTIONS, base?: DBase ) {\r\n\t\tthis.instance = null;\r\n\t\tthis.newInstance = newInstance;\r\n\t\tthis.options = options;\r\n\r\n\t\tif( base != null ) {\r\n\t\t\tif( base.isActive() ) {\r\n\t\t\t\tsetTimeout((): void => {\r\n\t\t\t\t\tthis.get();\r\n\t\t\t\t}, 0);\r\n\t\t\t}\r\n\r\n\t\t\tbase.on( \"active\", (): void => {\r\n\t\t\t\tthis.get();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tget(): INSTANCE {\r\n\t\tlet instance = this.instance;\r\n\t\tif( instance == null ) {\r\n\t\t\tinstance = this.instance = new (this.newInstance)( this.options );\r\n\t\t}\r\n\t\treturn instance;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * Returns a ceiling index of the given value.\r\n * The array must be sorted in an ascending order.\r\n *\r\n * @param array an array sorted in an ascending order\r\n * @param value a value to be searched\r\n * @returns a ceiling index of the given value\r\n */\r\nexport const toCeilingIndex = <V>( array: V[], value: V, size: number, offset: number ): number => {\r\n\tlet i0 = 0;\r\n\tlet i1 = Math.floor( array.length / size ) - 1;\r\n\r\n\twhile( i0 <= i1 ) {\r\n\t\tconst i2 = i0 + ((i1 - i0) >> 1);\r\n\t\tconst v2 = array[ i2 * size + offset ];\r\n\t\tif( value < v2 ) {\r\n\t\t\ti1 = i2 - 1;\r\n\t\t} else if( v2 < value ) {\r\n\t\t\ti0 = i2 + 1;\r\n\t\t} else {\r\n\t\t\treturn i2;\r\n\t\t}\r\n\t}\r\n\r\n\treturn Math.max( i0, i1 );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const toString = ( value: unknown ): string => {\r\n\treturn ( value != null ? String( value ) : \"\" );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport const toSvgUrl = ( svg: string ): string => {\r\n\treturn `data:image/svg+xml;base64,${btoa(svg)}`;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { resources } from \"pixi.js\";\r\n\r\nexport class SVGResource extends resources.BaseImageResource {\r\n\treadonly source!: HTMLImageElement;\r\n\treadonly svg: string;\r\n\r\n\tprotected _load: Promise<void> | null = null;\r\n\r\n\tconstructor( source: string, options: any ) {\r\n\t\tsuper( new Image() );\r\n\t\tthis._width = 0;\r\n\t\tthis._height = 0;\r\n\t\tthis.svg = source;\r\n\r\n\t\tresources.BaseImageResource.crossOrigin( this.source, this.svg, options && options.crossorigin );\r\n\r\n\t\tif( ! options || options.autoLoad !== false ) {\r\n\t\t\tthis.load();\r\n\t\t}\r\n\t}\r\n\r\n\tload(): Promise<void> {\r\n\t\tif( this._load ) {\r\n\t\t\treturn this._load;\r\n\t\t}\r\n\r\n\t\tthis._load = new Promise(( resolve ): void => {\r\n\t\t\tconst image: HTMLImageElement = this.source;\r\n\r\n\t\t\timage.onerror = ( event ): void => {\r\n\t\t\t\timage.onerror = null;\r\n\t\t\t\t(this as any).onError.run( event ); // TODO: Fix PixiJS\r\n\t\t\t};\r\n\r\n\t\t\tconst ua = navigator.userAgent;\r\n\r\n\t\t\t// IE and Edge generates wrong images without setTimeout.\r\n\t\t\tif( 0 <= ua.indexOf( \"Trident/\" ) || 0 <= ua.indexOf( \"Edge/\" ) ) {\r\n\t\t\t\timage.onload = (): void => {\r\n\t\t\t\t\tsetTimeout((): void => {\r\n\t\t\t\t\t\tthis.resize( image.width, image.height );\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\timage.onload = (): void => {\r\n\t\t\t\t\tthis.resize( image.width, image.height );\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\timage.src = this.svg;\r\n\t\t});\r\n\r\n\t\treturn this._load;\r\n\t}\r\n\r\n\tstatic test( source: unknown, extension: string ) {\r\n\t\t// url file extension is SVG\r\n\t\treturn extension === \"svg\"\r\n\t\t\t// source is SVG data-uri\r\n\t\t\t|| (typeof source === \"string\" && source.indexOf(\"data:image/svg+xml;base64\") === 0)\r\n\t\t\t// source is SVG inline\r\n\t\t\t|| (typeof source === \"string\" && source.indexOf(\"<svg\") === 0);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { BaseTexture, Rectangle, resources, SCALE_MODES, Texture } from \"pixi.js\";\r\nimport { SVGResource } from \"../resource/svg-resource\";\r\nimport { toSvgUrl } from \"./to-svg-url\";\r\n\r\n// PixiJS's SVGResource has a issue on Microsoft Edge.\r\n// Edge may invoke the HTMLImageElement#onload on an unexpected timing.\r\n// Thus, PixiJS may lost the `load` event in some situations.\r\nresources.INSTALLED.push( SVGResource );\r\n\r\nexport interface UtilSvgAtlasBuilderBuildOptions {\r\n\tforce?: boolean;\r\n\tscaling?: SCALE_MODES;\r\n\tresolution?: number;\r\n}\r\n\r\nexport class UtilSvgAtlasBuilder {\r\n\tprotected _width: number;\r\n\tprotected _ratio: number;\r\n\tprotected _margin: number;\r\n\r\n\tprotected _frames: { [ name: string ]: Rectangle };\r\n\tprotected _svg: string;\r\n\tprotected _nextX: number;\r\n\tprotected _nextY: number;\r\n\tprotected _height: number;\r\n\r\n\tprotected _built?: { [ name: string ]: Texture };\r\n\r\n\tconstructor( width: number, ratio: number, margin: number ) {\r\n\t\tthis._width = width;\r\n\t\tthis._ratio = ratio;\r\n\t\tthis._margin = margin;\r\n\r\n\t\tthis._frames = {};\r\n\t\tthis._svg = \"\";\r\n\t\tthis._nextX = 0;\r\n\t\tthis._nextY = 0;\r\n\t\tthis._height = 0;\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\tget ratio(): number {\r\n\t\treturn this._ratio;\r\n\t}\r\n\r\n\tget margin(): number {\r\n\t\treturn this._margin;\r\n\t}\r\n\r\n\tadd( name: string, width: number, height: number, path: string ): boolean {\r\n\t\tconst frames = this._frames;\r\n\t\tif( ! ( name in frames ) ) {\r\n\t\t\t// Position\r\n\t\t\tconst margin = this._margin;\r\n\t\t\tlet x = this._nextX;\r\n\t\t\tlet y = this._nextY;\r\n\t\t\tif( this._width <= x + width ) {\r\n\t\t\t\tx = 0;\r\n\t\t\t\ty = this._nextY + this._height + margin;\r\n\t\t\t\tthis._height = height;\r\n\t\t\t\tthis._nextY = y;\r\n\t\t\t} else {\r\n\t\t\t\tthis._height = Math.max( this._height, height );\r\n\t\t\t}\r\n\t\t\tthis._nextX = x + width + margin;\r\n\r\n\t\t\t// Frame\r\n\t\t\tframes[ name ] = new Rectangle( x, y, width, height );\r\n\r\n\t\t\t// Svg\r\n\t\t\tconst ratio = this._ratio;\r\n\t\t\tthis._svg += `<g transform=\"translate(${x * ratio},${y * ratio})\">${path}</g>`;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tget mappings(): { [ name: string ]: Texture } {\r\n\t\treturn this.build();\r\n\t}\r\n\r\n\tbuild( options?: UtilSvgAtlasBuilderBuildOptions ): { [ name: string ]: Texture } {\r\n\t\tlet built = this._built;\r\n\t\tif( built == null || (options && options.force) ) {\r\n\t\t\tconst resolution = ( options && options.resolution != null ?\r\n\t\t\t\toptions.resolution : (window.devicePixelRatio || 1)\r\n\t\t\t);\r\n\t\t\tconst width = this._width;\r\n\t\t\tconst height = Math.pow( 2, Math.ceil( Math.log( this._nextY + this._height ) / Math.LN2 ) );\r\n\t\t\tconst realWidth = width * resolution;\r\n\t\t\tconst realHeight = height * resolution;\r\n\t\t\tconst ratio = this._ratio;\r\n\t\t\tconst attrWidth = `width=\"${realWidth}\"`;\r\n\t\t\tconst attrHeight = `height=\"${realHeight}\"`;\r\n\t\t\tconst attrViewBox = `viewBox=\"0 0 ${width * ratio} ${height * ratio}\"`;\r\n\t\t\tconst attrXmlns = `xmlns=\"http://www.w3.org/2000/svg\"`;\r\n\t\t\tconst url = toSvgUrl( `<svg ${attrWidth} ${attrHeight} ${attrViewBox} ${attrXmlns}>${this._svg}</svg>` );\r\n\t\t\tconst scaleMode = (options && options.scaling != null ? options.scaling : SCALE_MODES.NEAREST);\r\n\t\t\tconst baseTexture = BaseTexture.from( url, {\r\n\t\t\t\tresolution,\r\n\t\t\t\tscaleMode\r\n\t\t\t});\r\n\t\t\tconst frames = this._frames;\r\n\t\t\tbuilt = this._built = {};\r\n\t\t\tfor( const name in frames ) {\r\n\t\t\t\tbuilt[ name ] = new Texture( baseTexture, frames[ name ] );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn built;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint, Rectangle } from \"pixi.js\";\r\n\r\nexport interface UtilAttachTarget {\r\n\treadonly width: number;\r\n\treadonly height: number;\r\n\treadonly position: IPoint;\r\n}\r\n\r\nexport enum UtilAttachAlign {\r\n\tTOP,\r\n\tLEFT,\r\n\tRIGHT,\r\n\tBOTTOM\r\n}\r\n\r\nexport class UtilAttach {\r\n\tstatic attach(\r\n\t\ttarget: UtilAttachTarget,\r\n\t\tbounds: Rectangle,\r\n\t\toffsetX: number, offsetY: number,\r\n\t\tclippingWidth: number, clippingHeight: number,\r\n\t\talign: UtilAttachAlign\r\n\t): void {\r\n\t\tconst width = target.width;\r\n\t\tconst height = target.height;\r\n\t\tlet x = 0;\r\n\t\tlet y = 0;\r\n\t\tswitch( align ) {\r\n\t\tcase UtilAttachAlign.LEFT:\r\n\t\t\tx = bounds.left - width - offsetX;\r\n\t\t\tif( x < 0 ) {\r\n\t\t\t\tx = bounds.right + offsetX;\r\n\t\t\t\tif( clippingWidth < x + width ) {\r\n\t\t\t\t\tx = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ty = this.adjust( bounds.top, bounds.bottom, height, clippingHeight );\r\n\t\t\tbreak;\r\n\t\tcase UtilAttachAlign.TOP:\r\n\t\t\tx = this.adjust( bounds.left, bounds.right, width, clippingWidth );\r\n\t\t\ty = bounds.top - height - offsetY;\r\n\t\t\tif( y < 0 ) {\r\n\t\t\t\ty = bounds.bottom + offsetY;\r\n\t\t\t\tif( clippingHeight < y + height ) {\r\n\t\t\t\t\ty = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase UtilAttachAlign.RIGHT:\r\n\t\t\tx = bounds.right + offsetX;\r\n\t\t\tif( clippingWidth < x + width ) {\r\n\t\t\t\tx = bounds.left - width - offsetX;\r\n\t\t\t\tif( x < 0 ) {\r\n\t\t\t\t\tx = clippingWidth - width;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ty = this.adjust( bounds.top, bounds.bottom, height, clippingHeight );\r\n\t\t\tbreak;\r\n\t\tcase UtilAttachAlign.BOTTOM:\r\n\t\t\tx = this.adjust( bounds.left, bounds.right, width, clippingWidth );\r\n\t\t\ty = bounds.bottom + offsetY;\r\n\t\t\tif( clippingHeight < y + height ) {\r\n\t\t\t\ty = bounds.top - height - offsetY;\r\n\t\t\t\tif( y < 0 ) {\r\n\t\t\t\t\ty = clippingHeight - height;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\ttarget.position.set( x, y );\r\n\t}\r\n\r\n\tstatic adjust( positionFirst: number, positionSecond: number, size: number, clippingSize: number ): number {\r\n\t\tif( positionFirst < 0 ) {\r\n\t\t\tif( clippingSize < positionFirst + size ) {\r\n\t\t\t\treturn (clippingSize - size) * 0.5;\r\n\t\t\t} else {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t} else if( clippingSize < positionFirst + size ) {\r\n\t\t\tif( clippingSize < size ) {\r\n\t\t\t\treturn (clippingSize - size) * 0.5;\r\n\t\t\t} else {\r\n\t\t\t\treturn Math.min( clippingSize, positionSecond ) - size;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn positionFirst;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * An output format.\r\n */\r\nexport enum UtilFileAs {\r\n\tTEXT,\r\n\tDATA_URL,\r\n\tBINARY_STRING,\r\n\tARRAY_BUTTER\r\n}\r\n\r\nexport interface UtilFileFacade {\r\n\temit( name: string, ...args: any[] ): void;\r\n}\r\n\r\n/**\r\n * An `open` event handler.\r\n *\r\n * @param result a file contents\r\n * @param self an event emitter\r\n */\r\nexport type UtilFileOnOpen<RESULT, SELF> = ( result: RESULT, self: SELF ) => void;\r\n\r\n/**\r\n * Mappings of event names and halders.\r\n */\r\nexport interface UtilFileOnOptions<SELF> {\r\n\t/**\r\n\t * Triggered when a file is opened.\r\n\t */\r\n\topen?: UtilFileOnOpen<string, SELF> | UtilFileOnOpen<ArrayBuffer, SELF>;\r\n\r\n\t/**\r\n\t * Triggered when an operation is aborted.\r\n\t *\r\n\t * @param e an event object\r\n\t * @param en event emitter\r\n\t */\r\n\tabort?: ( e: ProgressEvent, self: SELF ) => void;\r\n\r\n\t/**\r\n\t * Triggered when an operation is canceled.\r\n\t *\r\n\t * @param en event emitter\r\n\t */\r\n\tcancel?: ( self: SELF ) => void;\r\n}\r\n\r\nexport class UtilFileOpener {\r\n\tprotected _input: HTMLInputElement | null;\r\n\tprotected _as: UtilFileAs;\r\n\tprotected _facade: UtilFileFacade;\r\n\r\n\tconstructor( as: UtilFileAs, facade: UtilFileFacade ) {\r\n\t\tthis._input = null;\r\n\t\tthis._as = as;\r\n\t\tthis._facade = facade;\r\n\t}\r\n\r\n\topen() {\r\n\t\tconst input = this.getOrCreateInput();\r\n\t\tif( input != null ) {\r\n\t\t\tinput.click();\r\n\t\t} else {\r\n\t\t\tthis.onCancel();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getOrCreateInput(): HTMLInputElement | null {\r\n\t\tif( \"FileReader\" in window && this._input == null ) {\r\n\t\t\tconst input = this._input = document.createElement( \"input\" );\r\n\t\t\tinput.setAttribute( \"type\", \"file\" );\r\n\t\t\tinput.setAttribute( \"style\", \"display:none\" );\r\n\t\t\tinput.addEventListener( \"change\", ( e: Event ): void => {\r\n\t\t\t\tthis.onInputChange( input );\r\n\t\t\t\tinput.value = \"\";\r\n\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t});\r\n\t\t\tdocument.body.appendChild( input );\r\n\t\t}\r\n\t\treturn this._input;\r\n\t}\r\n\r\n\tprotected onInputChange( input: HTMLInputElement ) {\r\n\t\tconst files = input.files;\r\n\t\tif( files != null && 0 < files.length ) {\r\n\t\t\tconst file = files[ 0 ];\r\n\t\t\tconst fileReader = new FileReader();\r\n\t\t\tfileReader.onload = ( e: ProgressEvent ) => {\r\n\t\t\t\tif( e.target != null ) {\r\n\t\t\t\t\tconst target = e.target as any;\r\n\t\t\t\t\tthis.onOpen( target.result );\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tfileReader.onabort = ( e: ProgressEvent ) => {\r\n\t\t\t\tthis.onAboart( e );\r\n\t\t\t};\r\n\t\t\tswitch( this._as ) {\r\n\t\t\tcase UtilFileAs.TEXT:\r\n\t\t\t\tfileReader.readAsText( file );\r\n\t\t\t\tbreak;\r\n\t\t\tcase UtilFileAs.DATA_URL:\r\n\t\t\t\tfileReader.readAsDataURL( file );\r\n\t\t\t\tbreak;\r\n\t\t\tcase UtilFileAs.BINARY_STRING:\r\n\t\t\t\tfileReader.readAsBinaryString( file );\r\n\t\t\t\tbreak;\r\n\t\t\tcase UtilFileAs.ARRAY_BUTTER:\r\n\t\t\t\tfileReader.readAsArrayBuffer( file );\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tfileReader.readAsText( file );\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.onCancel();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onOpen( result: string | ArrayBuffer ): void {\r\n\t\tconst facade = this._facade;\r\n\t\tfacade.emit( \"open\", result, facade );\r\n\t}\r\n\r\n\tprotected onAboart( e: ProgressEvent ): void {\r\n\t\tconst facade = this._facade;\r\n\t\tfacade.emit( \"abort\", e, facade );\r\n\t}\r\n\r\n\tprotected onCancel(): void {\r\n\t\tconst facade = this._facade;\r\n\t\tfacade.emit( \"cancel\", facade );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DBase } from \"../d-base\";\r\nimport { UtilPointerEvent } from \"./util-pointer-event\";\r\n\r\nexport type UtilClickOutsideOnClick = ( e: InteractionEvent ) => void;\r\n\r\nexport class UtilClickOutside {\r\n\tprotected static point = new Point();\r\n\r\n\tstatic apply( target: DBase<any, any>, onClick: UtilClickOutsideOnClick ) {\r\n\t\ttarget.on( UtilPointerEvent.down, ( e: InteractionEvent ): void => {\r\n\t\t\tif( e.target === target ) {\r\n\t\t\t\tconst point = this.point;\r\n\t\t\t\tpoint.copyFrom( e.data.global );\r\n\t\t\t\ttarget.toLocal( point, undefined, point, true );\r\n\t\t\t\tconst x = point.x;\r\n\t\t\t\tconst y = point.y;\r\n\t\t\t\tif( x < 0 || y < 0 || target.width < x || target.height < y ) {\r\n\t\t\t\t\tonClick( e );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\n\r\nconst getSelection = ( element: Element ): Selection | null => {\r\n\tconst selection = document.getSelection();\r\n\tif( selection ) {\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNodeContents( element );\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange( range );\r\n\t}\r\n\treturn selection;\r\n};\r\n\r\nconst toClipboardData = ( e: ClipboardEvent ): DataTransfer => {\r\n\treturn e.clipboardData || (window as any).clipboardData;\r\n};\r\n\r\nconst copyUsingDiv = ( text: string ): boolean => {\r\n\tconst div = document.createElement( \"div\" );\r\n\tdiv.setAttribute( \"style\", \"-webkit-user-select: text !important\" );\r\n\tdiv.textContent = \"Dummy\";\r\n\tdocument.body.appendChild( div );\r\n\tconst selection = getSelection( div );\r\n\tlet result = false;\r\n\tif( selection ) {\r\n\t\tconst handler = ( e: ClipboardEvent ): void => {\r\n\t\t\tif( e.target === div ) {\r\n\t\t\t\tconst clipboardData = toClipboardData( e );\r\n\t\t\t\tclipboardData.setData( \"text/plain\", text );\r\n\t\t\t\tresult = ( clipboardData.getData( \"text/plain\" ) === text );\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}\r\n\t\t};\r\n\t\tdocument.addEventListener( \"copy\", handler );\r\n\t\ttry {\r\n\t\t\tdocument.execCommand( \"copy\" );\r\n\t\t} finally {\r\n\t\t\tdocument.removeEventListener( \"copy\", handler );\r\n\t\t}\r\n\t\tselection.removeAllRanges();\r\n\t}\r\n\tdocument.body.removeChild( div );\r\n\treturn result;\r\n};\r\n\r\nconst copyUsingSpan = ( text: string ): boolean => {\r\n\tconst div = document.createElement( \"div\" );\r\n\tdiv.setAttribute( \"style\", \"-webkit-user-select: text !important\" );\r\n\tconst span = document.createElement( \"span\" );\r\n\tspan.innerText = text;\r\n\tconst root: Node = ( div.attachShadow ? div.attachShadow({ mode: \"open\" }) : div );\r\n\troot.appendChild( span );\r\n\tdocument.body.appendChild( div );\r\n\tlet result = false;\r\n\tconst selection = getSelection( div );\r\n\tif( selection ) {\r\n\t\tresult = document.execCommand( \"copy\" );\r\n\t\tselection.removeAllRanges();\r\n\t}\r\n\tdocument.body.removeChild( div );\r\n\treturn result;\r\n};\r\n\r\nconst copyUsingWindow = ( window: Window, text: string ): boolean => {\r\n\tif( typeof ClipboardEvent === \"undefined\" ) {\r\n\t\tconst clipboardData = (window as any).clipboardData;\r\n\t\tif( typeof clipboardData !== \"undefined\" && typeof clipboardData.setData !== \"undefined\" ) {\r\n\t\t\tclipboardData.setData( \"Text\", text );\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nexport class UtilClipboard extends utils.EventEmitter {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tconst element = document.body;\r\n\t\telement.addEventListener( \"copy\", ( e: ClipboardEvent ): void => {\r\n\t\t\tif( e.target === element ) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\tthis.emit( \"copy\", toClipboardData( e ) );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\telement.addEventListener( \"cut\", ( e: ClipboardEvent ): void => {\r\n\t\t\tif( e.target === element ) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\tthis.emit( \"cut\", toClipboardData( e ) );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\telement.addEventListener( \"paste\", ( e: ClipboardEvent ): void => {\r\n\t\t\tif( e.target === element ) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\tthis.emit( \"paste\", toClipboardData( e ) );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tstatic copy( text: string ): void {\r\n\t\tconst clipboard = navigator.clipboard;\r\n\t\tif( clipboard && clipboard.writeText ) {\r\n\t\t\tclipboard.writeText( text );\r\n\t\t} else {\r\n\t\t\tif( ! copyUsingWindow( window, text ) ) {\r\n\t\t\t\tif( ! copyUsingDiv( text ) ) {\r\n\t\t\t\t\tif( navigator.userAgent.indexOf( \"Edge\" ) < 0 ) {\r\n\t\t\t\t\t\tcopyUsingSpan( text );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Extract, Matrix, Renderer, RenderTexture, SCALE_MODES, utils } from \"pixi.js\";\r\nimport { DApplications } from \"../d-applications\";\r\nimport { DBase } from \"../d-base\";\r\nimport { UtilExtractorPixels } from \"./util-extractor-pixels\";\r\n\r\nexport class UtilExtractor {\r\n\tstatic toTexture(\r\n\t\ttarget: DBase, resolution?: number,\r\n\t\tclear?: boolean, skipUpdateTransform?: boolean\r\n\t): RenderTexture {\r\n\t\tconst result = RenderTexture.create({\r\n\t\t\twidth: target.width,\r\n\t\t\theight: target.height,\r\n\t\t\tscaleMode: SCALE_MODES.LINEAR,\r\n\t\t\tresolution\r\n\t\t});\r\n\t\tconst matrix = new Matrix(\r\n\t\t\tundefined, undefined, undefined, undefined,\r\n\t\t\t-target.position.x, -target.position.y\r\n\t\t);\r\n\t\tconst layer = DApplications.getLayer( target );\r\n\t\tif( layer ) {\r\n\t\t\tlayer.renderer.render( target, result, clear, matrix, skipUpdateTransform );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toPixels( renderTexture: RenderTexture, renderer: Renderer ): UtilExtractorPixels {\r\n\t\tconst resolution = renderTexture.resolution;\r\n\t\tconst frame = renderTexture.frame;\r\n\t\tconst width = Math.floor( frame.width * resolution );\r\n\t\tconst height = Math.floor( frame.height * resolution );\r\n\t\tconst pixels = new Uint8Array( 4 * width * height );\r\n\r\n\t\trenderer.renderTexture.bind( renderTexture );\r\n\t\tconst gl = renderer.gl;\r\n\t\tgl.readPixels(\r\n\t\t\tframe.x * resolution,\r\n\t\t\tframe.y * resolution,\r\n\t\t\twidth,\r\n\t\t\theight,\r\n\t\t\tgl.RGBA,\r\n\t\t\tgl.UNSIGNED_BYTE,\r\n\t\t\tpixels\r\n\t\t);\r\n\r\n\t\treturn {\r\n\t\t\twidth,\r\n\t\t\theight,\r\n\t\t\tarray: pixels\r\n\t\t};\r\n\t}\r\n\r\n\tstatic toCanvas( pixels: UtilExtractorPixels, scale?: number, ignorePremutipliedAlpha?: boolean ): HTMLCanvasElement {\r\n\t\tconst width = pixels.width;\r\n\t\tconst height = pixels.height;\r\n\t\tconst array = pixels.array;\r\n\t\tconst canvasRenderTarget = new utils.CanvasRenderTarget( width, height, 1 );\r\n\r\n\t\tconst imageData = canvasRenderTarget.context.getImageData( 0, 0, width, height );\r\n\t\tif( ignorePremutipliedAlpha ) {\r\n\t\t\timageData.data.set( array );\r\n\t\t} else {\r\n\t\t\t(Extract as any).arrayPostDivide( array, imageData.data );\r\n\t\t}\r\n\t\tcanvasRenderTarget.context.putImageData( imageData, 0, 0 );\r\n\r\n\t\t// Scale down\r\n\t\tif( scale != null && scale !== 1 ) {\r\n\t\t\tcanvasRenderTarget.context.scale( scale, scale );\r\n\t\t\tcanvasRenderTarget.context.drawImage( canvasRenderTarget.canvas, 0, 0 );\r\n\t\t\tconst scaledWidth = Math.floor( width * scale );\r\n\t\t\tconst scaledHeight = Math.floor( height * scale );\r\n\t\t\tconst scaledImageData = canvasRenderTarget.context.getImageData( 0, 0, scaledWidth, scaledHeight );\r\n\t\t\tcanvasRenderTarget.resize( scaledWidth, scaledHeight );\r\n\t\t\tcanvasRenderTarget.context.putImageData( scaledImageData, 0, 0 );\r\n\t\t}\r\n\r\n\t\treturn canvasRenderTarget.canvas;\r\n\t}\r\n\r\n\tstatic toBase64( canvas: HTMLCanvasElement, format?: string, quality?: number ): string {\r\n\t\treturn canvas.toDataURL( format, quality );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class UtilFileDownloader {\r\n\tstatic downloadUrl( filename: string, url: string ): void {\r\n\t\tconst a = document.createElement( \"a\" );\r\n\t\tif( \"download\" in a ) {\r\n\t\t\ta.href = url;\r\n\t\t\ta.setAttribute( \"download\", filename );\r\n\t\t\ta.style.display = \"none\";\r\n\t\t\tdocument.body.appendChild( a );\r\n\t\t\ta.click();\r\n\t\t\tsetTimeout((): void => {\r\n\t\t\t\tdocument.body.removeChild( a );\r\n\t\t\t}, 66);\r\n\t\t} else {\r\n\t\t\tif( ! window.open( url ) ) {\r\n\t\t\t\tlocation.href = url;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstatic download( filename: string, contents: string ): void {\r\n\t\tconst blob = new Blob(\r\n\t\t\t[ contents ],\r\n\t\t\t{ type: \"text/plain\" }\r\n\t\t);\r\n\t\tif( window.navigator.msSaveBlob ) {\r\n\t\t\twindow.navigator.msSaveBlob( blob, filename );\r\n\t\t} else {\r\n\t\t\tthis.downloadUrl( filename, URL.createObjectURL( blob ) );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Renderer, RenderTexture } from \"pixi.js\";\r\nimport { DApplicationLayerLike } from \"../d-application-layer-like\";\r\nimport { DApplicationLike } from \"../d-application-like\";\r\nimport { DApplications } from \"../d-applications\";\r\nimport { DBase } from \"../d-base\";\r\nimport { isNumber } from \"./is-number\";\r\nimport { UtilExtractor } from \"./util-extractor\";\r\nimport { UtilExtractorPixels } from \"./util-extractor-pixels\";\r\nimport { UtilFileDownloader } from \"./util-file-downloader\";\r\n\r\nexport interface UtilExtractTextureResolutionOptions {\r\n\tsize: number;\r\n}\r\n\r\nexport interface UtilExtractTextureTransformOptions {\r\n\tupdate?: boolean;\r\n}\r\n\r\nexport interface UtilExtractTextureOptions {\r\n\ttarget: DBase;\r\n\tresolution?: number | UtilExtractTextureResolutionOptions;\r\n\ttransform?: UtilExtractTextureTransformOptions;\r\n\tclear?: boolean;\r\n}\r\n\r\nexport interface UtilExtractPixelsOptions extends UtilExtractTextureOptions {\r\n\trenderer?: Renderer;\r\n\tapplication?: DApplicationLike;\r\n\tlayer?: DApplicationLayerLike;\r\n}\r\n\r\nexport interface UtilExtractCanvasOptions extends UtilExtractPixelsOptions {\r\n\tscale?: number | {\r\n\t\tsize: number;\r\n\t};\r\n\talpha?: {\r\n\t\tpremultiplied?: {\r\n\t\t\tignore?: boolean;\r\n\t\t}\r\n\t};\r\n}\r\n\r\nexport interface UtilExtractBase64Options extends UtilExtractCanvasOptions {\r\n\tformat?: string;\r\n\tquality?: number;\r\n}\r\n\r\nexport interface UtilExtractFileOptions extends UtilExtractBase64Options {\r\n\tfilename: string;\r\n}\r\n\r\nconst toSkipUpdateTransform = ( options: UtilExtractTextureOptions ): boolean | undefined => {\r\n\treturn options.transform && options.transform.update;\r\n};\r\n\r\nconst toResolution = ( options: UtilExtractTextureOptions ): number => {\r\n\tconst target = options.target;\r\n\tif( options.resolution != null ) {\r\n\t\tif( isNumber( options.resolution ) ) {\r\n\t\t\treturn options.resolution;\r\n\t\t} else {\r\n\t\t\treturn Math.min( 1, options.resolution.size / Math.max( target.width, target.height ) );\r\n\t\t}\r\n\t} else {\r\n\t\treturn window.devicePixelRatio || 1;\r\n\t}\r\n};\r\n\r\nconst toIgnorePremultipliedAlpha = ( options: UtilExtractCanvasOptions ): boolean | undefined => {\r\n\treturn ( options.alpha && options.alpha.premultiplied && options.alpha.premultiplied.ignore );\r\n};\r\n\r\nconst toScale = ( pixels: UtilExtractorPixels, options: UtilExtractCanvasOptions ): number | undefined => {\r\n\tif( options.scale != null ) {\r\n\t\tif( isNumber( options.scale ) ) {\r\n\t\t\treturn options.scale;\r\n\t\t} else {\r\n\t\t\tconst size = options.scale.size;\r\n\t\t\treturn Math.min( 1, size / pixels.width, size / pixels.height );\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst toRenderer = ( options: UtilExtractPixelsOptions ): Renderer => {\r\n\tif( options.renderer ) {\r\n\t\treturn options.renderer;\r\n\t} else if( options.application ) {\r\n\t\treturn options.application.getLayerBase().renderer;\r\n\t} else if( options.layer ) {\r\n\t\treturn options.layer.renderer;\r\n\t} else {\r\n\t\tconst layer = DApplications.getLayer( options.target );\r\n\t\tif( layer ) {\r\n\t\t\treturn layer.renderer;\r\n\t\t} else {\r\n\t\t\tthrow new Error( \"No renderer / application / layer found.\" );\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport class UtilExtract {\r\n\tstatic texture( options: UtilExtractTextureOptions ): RenderTexture {\r\n\t\tconst target = options.target;\r\n\t\tconst resolution = toResolution( options );\r\n\t\tconst skipUpdateTransform = toSkipUpdateTransform( options );\r\n\t\treturn UtilExtractor.toTexture( target, resolution, options.clear, skipUpdateTransform );\r\n\t}\r\n\r\n\tstatic pixels( options: UtilExtractPixelsOptions ): UtilExtractorPixels {\r\n\t\tconst renderer = toRenderer( options );\r\n\t\treturn UtilExtractor.toPixels( this.texture( options ), renderer );\r\n\t}\r\n\r\n\tstatic canvas( options: UtilExtractCanvasOptions ): HTMLCanvasElement {\r\n\t\tconst pixels = this.pixels( options );\r\n\t\tconst ignorePremutipliedAlpha = toIgnorePremultipliedAlpha( options );\r\n\t\tconst scale = toScale( pixels, options );\r\n\t\treturn UtilExtractor.toCanvas( pixels, scale, ignorePremutipliedAlpha );\r\n\t}\r\n\r\n\tstatic base64( options: UtilExtractBase64Options ): string {\r\n\t\treturn UtilExtractor.toBase64( this.canvas( options ), options.format, options.quality );\r\n\t}\r\n\r\n\tstatic file( options: UtilExtractFileOptions ): void {\r\n\t\tUtilFileDownloader.downloadUrl( options.filename, this.base64( options ) );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum EShapeCapability {\r\n\tNONE\t\t\t= 0,\r\n\r\n\tID\t\t\t\t= 1 << 0,\r\n\tPOSITION\t\t= 1 << 1,\r\n\tWIDTH\t\t\t= 1 << 2,\r\n\tHEIGHT\t\t\t= 1 << 3,\r\n\tROTATION\t\t= 1 << 4,\r\n\tSKEW\t\t\t= 1 << 5,\r\n\tALIGN\t\t\t= 1 << 6,\r\n\r\n\tREPLACING\t\t= 1 << 7,\r\n\tGROUPING\t\t= 1 << 8,\r\n\tFILL\t\t\t= 1 << 9,\r\n\tSTROKE\t\t\t= 1 << 10,\r\n\tSTROKE_SIDE\t\t= 1 << 11,\r\n\tBORDER_RADIUS\t= 1 << 12,\r\n\r\n\tTEXT\t\t\t= 1 << 13,\r\n\tTEXTURE\t\t\t= 1 << 14,\r\n\tTAG\t\t\t\t= 1 << 15,\r\n\tACTION\t\t\t= 1 << 16,\r\n\tCURSOR\t\t\t= 1 << 17,\r\n\tORDER_IN_LAYER\t= 1 << 18,\r\n\r\n\tCOORDINATE\t\t= ID | POSITION | WIDTH | HEIGHT | ROTATION | SKEW | ALIGN,\r\n\tSHAPE\t\t\t= REPLACING | GROUPING | FILL | STROKE,\r\n\tSHAPE_ROUNDED\t= SHAPE | BORDER_RADIUS,\r\n\tSHAPE_SIDED\t\t= SHAPE | STROKE_SIDE,\r\n\tSHAPE_SIDED_AND_ROUNDED = SHAPE | STROKE_SIDE | BORDER_RADIUS,\r\n\tLAYER\t\t\t= ORDER_IN_LAYER,\r\n\tPRIMITIVE\t\t= COORDINATE | SHAPE | TEXT | TEXTURE | TAG | ACTION | CURSOR | LAYER,\r\n\tSHADOW\t\t\t= NONE,\r\n\tALL\t\t\t\t= PRIMITIVE | STROKE_SIDE | BORDER_RADIUS\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class UtilHsv {\r\n\tstatic fromRgb( color: number ): [ number, number, number ] {\r\n\t\tconst r = (color & 0xff0000) >> 16;\r\n\t\tconst g = (color & 0x00ff00) >> 8;\r\n\t\tconst b = (color & 0x0000ff) | 0;\r\n\r\n\t\tconst max = Math.max( r, g, b );\r\n\t\tconst min = Math.min( r, g, b );\r\n\t\tconst length = max - min;\r\n\t\tlet h = 0;\r\n\t\tif( 0 < length ) {\r\n\t\t\tif( r === max ) {\r\n\t\t\t\th = 60 * ( g - b ) / length;\r\n\t\t\t} else if( g === max ) {\r\n\t\t\t\th = 60 * ( b - r ) / length + 120;\r\n\t\t\t} else if( b === max ) {\r\n\t\t\t\th = 60 * ( r - g ) / length + 240;\r\n\t\t\t}\r\n\t\t\tif( h < 0 ) {\r\n\t\t\t\th += 360;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst s = ( length / max ) * 255;\r\n\t\tconst v = max;\r\n\t\treturn [ h, s, v ];\r\n\t}\r\n\r\n\tstatic toRgb( h: number, s: number, v: number ): number {\r\n\t\tconst max = v;\r\n\t\tconst min = v - (s / 255) * v;\r\n\t\tconst length = max - min;\r\n\r\n\t\tlet r = 0;\r\n\t\tlet g = 0;\r\n\t\tlet b = 0;\r\n\t\tif( h <= 60 ) {\r\n\t\t\tr = max;\r\n\t\t\tg = (h / 60) * length + min;\r\n\t\t\tb = min;\r\n\t\t} else if( h <= 120 ) {\r\n\t\t\tr = ((120 - h) / 60) * length + min;\r\n\t\t\tg = max;\r\n\t\t\tb = min;\r\n\t\t} else if( h <= 180 ) {\r\n\t\t\tr = min;\r\n\t\t\tg = max;\r\n\t\t\tb = ((h - 120) / 60) * length + min;\r\n\t\t} else if( h <= 240 ) {\r\n\t\t\tr = min;\r\n\t\t\tg = ((240 - h) / 60) * length + min;\r\n\t\t\tb = max;\r\n\t\t} else if( h <= 300 ) {\r\n\t\t\tr = ((h - 240) / 60) * length + min;\r\n\t\t\tg = min;\r\n\t\t\tb = max;\r\n\t\t} else {\r\n\t\t\tr = max;\r\n\t\t\tg = min;\r\n\t\t\tb = ((360 - h) / 60) * length + min;\r\n\t\t}\r\n\r\n\t\tr = Math.max( 0, Math.min( 255, r ) );\r\n\t\tg = Math.max( 0, Math.min( 255, g ) );\r\n\t\tb = Math.max( 0, Math.min( 255, b ) );\r\n\r\n\t\treturn (r << 16) | (g << 8) | b;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class UtilName {\r\n\tprotected static _mapping: { [ key: string]: number } = {};\r\n\r\n\tstatic create( type: string ) {\r\n\t\tconst mapping = this._mapping;\r\n\t\tif( type in mapping ) {\r\n\t\t\treturn `${type} ${++mapping[ type ]}`;\r\n\t\t} else {\r\n\t\t\tmapping[ type ] = 1;\r\n\t\t\treturn `${type} 1`;\r\n\t\t}\r\n\t}\r\n}\r\n","import { DApplicationLayerLike } from \"../d-application-layer-like\";\r\nimport { DApplicationLike, DApplicationTarget } from \"../d-application-like\";\r\nimport { DApplications } from \"../d-applications\";\r\n\r\nexport class UtilOverlay {\r\n\tprotected _layer: DApplicationLayerLike | null;\r\n\tprotected _application: DApplicationLike | null;\r\n\r\n\tconstructor( options?: { parent?: unknown; } ) {\r\n\t\tthis._layer = null;\r\n\t\tthis._application = ( options == null || options.parent == null ?\r\n\t\t\tDApplications.last() : null\r\n\t\t);\r\n\t}\r\n\r\n\tget picked(): DApplicationLayerLike | null {\r\n\t\treturn this._layer;\r\n\t}\r\n\r\n\tpick( target: DApplicationTarget ): DApplicationLayerLike {\r\n\t\tlet layer = this._layer;\r\n\t\tif( layer == null ) {\r\n\t\t\tlayer = DApplications.getLayerOverlay( target );\r\n\t\t\tif( ! layer ) {\r\n\t\t\t\tconst application = this._application;\r\n\t\t\t\tif( application ) {\r\n\t\t\t\t\tlayer = application.getLayerOverlay();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlayer = DApplications.last().getLayerOverlay();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._layer = layer;\r\n\t\t}\r\n\t\treturn layer;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class UtilPromise {\r\n\tstatic IDENTITY = () => { /* DO NOTHING*/ };\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class UtilRgba {\r\n\tstatic toCode( color: number, alpha: number ): string {\r\n\t\tconst r = ( color >> 16 ) & 0xff;\r\n\t\tconst g = ( color >> 8 ) & 0xff;\r\n\t\tconst b = ( color & 0xff );\r\n\t\treturn `rgba(${r},${g},${b},${alpha})`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\nimport { DApplications } from \"../d-applications\";\r\nimport { DCornerMask } from \"../d-corner-mask\";\r\nimport { toSvgUrl } from \"./to-svg-url\";\r\n\r\nexport class UtilTexturePlane {\r\n\tprotected static INSTANCE: UtilTexturePlane | null = null;\r\n\r\n\tprotected _backgroundCache: Map<number, Texture>;\r\n\tprotected _backgroundAttribute: string;\r\n\tprotected _borderCache: Map<number, Map<number, Texture>>;\r\n\tprotected _borderAttribute: ( width: number ) => string;\r\n\tprotected _onUpdate: () => void;\r\n\r\n\tconstructor() {\r\n\t\tthis._backgroundCache = new Map<number, Texture>();\r\n\t\tthis._backgroundAttribute = `fill=\"#fff\" stroke=\"none\"`;\r\n\t\tthis._borderCache = new Map<number, Map<number, Texture>>();\r\n\t\tthis._borderAttribute = ( width: number ): string => {\r\n\t\t\treturn `fill=\"none\" stroke=\"#fff\" stroke-width=\"${width}\"`;\r\n\t\t};\r\n\t\tthis._onUpdate = (): void => {\r\n\t\t\tDApplications.update();\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toCornerTl( offset: number, size: number, tl: number ): string {\r\n\t\treturn ( 0 < tl ? `A${tl} ${tl} 0 0 1 ${offset + tl} ${offset}` : \"\" );\r\n\t}\r\n\r\n\tprotected toCornerBr( offset: number, size: number, br: number ): string {\r\n\t\treturn ( 0 < br ? `A${br} ${br} 0 0 1 ${offset + size - br} ${offset + size}` : \"\" );\r\n\t}\r\n\r\n\tprotected make( radius: number, offset: number, attr: string ): Texture {\r\n\t\tconst realRadius = Math.max( 0, radius - offset );\r\n\t\tconst size: number = realRadius * 2 + 4;\r\n\t\tconst realSize: number = size + offset * 2;\r\n\t\tconst d =\r\n\t\t\t`M${offset + realRadius} ${offset}` +\r\n\t\t\t`L${offset + size} ${offset}` +\r\n\t\t\t`L${offset + size} ${offset + size - realRadius}` +\r\n\t\t\tthis.toCornerBr( offset, size, realRadius ) +\r\n\t\t\t`L${offset} ${offset + size}` +\r\n\t\t\t`L${offset} ${offset + realRadius}` +\r\n\t\t\tthis.toCornerTl( offset, size, realRadius ) +\r\n\t\t\t`Z`;\r\n\t\treturn this.toSvg( realSize, attr, d );\r\n\t}\r\n\r\n\tprotected toSvg( realSize: number, attr: string, d: string ): Texture {\r\n\t\tconst resolution = (window.devicePixelRatio || 1);\r\n\t\tconst widthAttr = `width=\"${realSize * resolution}\"`;\r\n\t\tconst heightAttr = `height=\"${realSize * resolution}\"`;\r\n\t\tconst viewBoxAttr = `viewBox=\"0 0 ${realSize} ${realSize}\"`;\r\n\t\tconst svg = `<svg ${widthAttr} ${heightAttr} ${viewBoxAttr} xmlns=\"http://www.w3.org/2000/svg\">` +\r\n\t\t\t`<path ${attr} d=\"${d}\"></path>` +\r\n\t\t`</svg>`;\r\n\t\treturn Texture.from( toSvgUrl( svg ), {\r\n\t\t\tresolution\r\n\t\t});\r\n\t}\r\n\r\n\tnewBackground( radius: number ): Texture {\r\n\t\tconst result = this.make( radius, 0, this._backgroundAttribute );\r\n\t\tresult.on( \"update\", this._onUpdate );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tnewBorder( radius: number, width: number ): Texture {\r\n\t\tconst result = this.make( radius, 0.5 * width, this._borderAttribute( width ) );\r\n\t\tresult.on( \"update\", this._onUpdate );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetBackground( radius: number ): Texture {\r\n\t\tconst cache = this._backgroundCache;\r\n\r\n\t\tlet texture = cache.get( radius );\r\n\t\tif( texture == null ) {\r\n\t\t\ttexture = this.newBackground( radius );\r\n\t\t\tcache.set( radius, texture );\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\t}\r\n\r\n\tgetBorder( radius: number, width: number ): Texture {\r\n\t\tconst cache = this._borderCache;\r\n\r\n\t\tlet maskToTexture = cache.get( radius );\r\n\t\tif( maskToTexture == null ) {\r\n\t\t\tmaskToTexture = new Map<DCornerMask, Texture>();\r\n\t\t\tcache.set( radius, maskToTexture );\r\n\t\t}\r\n\r\n\t\tlet texture = maskToTexture.get( width );\r\n\t\tif( texture == null ) {\r\n\t\t\ttexture = this.newBorder( radius, width );\r\n\t\t\tmaskToTexture.set( width, texture );\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\t}\r\n\r\n\tstatic getInstance(): UtilTexturePlane {\r\n\t\tif( UtilTexturePlane.INSTANCE == null ) {\r\n\t\t\tUtilTexturePlane.INSTANCE = new UtilTexturePlane();\r\n\t\t}\r\n\t\treturn UtilTexturePlane.INSTANCE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\n\r\nexport class UtilTexture {\r\n\tstatic fromImage( url: string, resolution: number, onLoad: ( texture: Texture ) => void ) {\r\n\t\tconst texture = Texture.from( url, {\r\n\t\t\tresolution\r\n\t\t});\r\n\t\tif( ! texture.baseTexture.valid ) {\r\n\t\t\ttexture.once( \"update\", onLoad );\r\n\t\t} else {\r\n\t\t\tonLoad( texture );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"../d-base\";\r\n\r\nexport interface UtilTransitionOptions {\r\n\tduration?: number;\r\n}\r\n\r\nexport class UtilTransition {\r\n\tprotected _duration: number;\r\n\tprotected _current: DBase<any, any> | null;\r\n\tprotected _lastUpdate: number;\r\n\tprotected _updateId: number | null;\r\n\r\n\tconstructor( options?: UtilTransitionOptions ) {\r\n\t\tthis._duration = ( options != null && options.duration != null ? options.duration : 300 );\r\n\t\tthis._current = null;\r\n\t\tthis._lastUpdate = 0;\r\n\t\tthis._updateId = null;\r\n\t}\r\n\r\n\tshow( next: DBase<any, any> | null, forcibly?: boolean ): void {\r\n\t\tconst updateId = this._updateId;\r\n\t\tif( updateId != null ) {\r\n\t\t\tclearTimeout( updateId );\r\n\t\t}\r\n\r\n\t\tconst current = this._current;\r\n\t\tif( next !== current ) {\r\n\t\t\tconst duration = this._duration;\r\n\t\t\tconst lastUpdate = this._lastUpdate;\r\n\t\t\tconst now = Date.now();\r\n\t\t\tconst remaining = (lastUpdate + duration) - now;\r\n\t\t\tif( forcibly === true || remaining <= 0 ) {\r\n\t\t\t\tthis.update( now, next );\r\n\t\t\t} else {\r\n\t\t\t\tthis._updateId = window.setTimeout(() => {\r\n\t\t\t\t\tthis.update( Date.now(), next );\r\n\t\t\t\t}, remaining );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected update( now: number, next: DBase<any, any> | null ) {\r\n\t\tconst current = this._current;\r\n\t\tif( current !== next ) {\r\n\t\t\tthis._lastUpdate = now;\r\n\r\n\t\t\tif( current !== null ) {\r\n\t\t\t\tcurrent.hide();\r\n\t\t\t}\r\n\r\n\t\t\tthis._current = next;\r\n\t\t\tif( next != null ) {\r\n\t\t\t\tnext.show();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thide(): void {\r\n\t\tthis.show( null );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DThemeFont } from \"../d-font\";\r\nimport { DThemes } from \"../theme/d-themes\";\r\n\r\nexport interface UtilWheelEventDeltas {\r\n\tmode: number;\r\n\tdelta: number;\r\n\tdeltaX: number;\r\n\tdeltaY: number;\r\n\tlowest: number;\r\n}\r\n\r\n/*!\r\n* jQuery Mousewheel 3.1.13\r\n*\r\n* Copyright jQuery Foundation and other contributors\r\n* Released under the MIT license\r\n* http://jquery.org/license\r\n*\r\n* See also https://github.com/mapbox/mapbox-gl-js/blob/001c7b9/js/ui/handler/scroll_zoom.js\r\n* and https://github.com/openlayers/openlayers/blob/v5.2.0/src/ol/interaction/MouseWheelZoom.js#L51\r\n*/\r\nexport class UtilWheelEvent {\r\n\tprivate static INSTANCE: UtilWheelEvent | null;\r\n\tprivate _names: Array<\"wheel\" | \"mousewheel\" | \"DOMMouseScroll\" | \"MozMousePixelScroll\">;\r\n\tprivate _lowest: number | null = null;\r\n\tprivate _timestamp: number = 0;\r\n\tprivate _lineHeight: number | null = null;\r\n\tprivate _pageHeight: number | null = null;\r\n\r\n\tconstructor() {\r\n\t\tthis._names = ( \"onwheel\" in document || 9 <= (document as any).documentMode ?\r\n\t\t\t[ \"wheel\" ] : [ \"mousewheel\", \"DOMMouseScroll\", \"MozMousePixelScroll\" ]\r\n\t\t);\r\n\t}\r\n\r\n\ton( target: HTMLElement, handler: ( e: WheelEvent | Event ) => void, useCapture: boolean = false ) {\r\n\t\tconst names = this._names;\r\n\t\tfor( let i = names.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst name = names[ i ];\r\n\t\t\ttarget.addEventListener( name, handler, useCapture );\r\n\t\t}\r\n\t}\r\n\r\n\toff( target: HTMLElement, handler: ( e: WheelEvent | Event ) => void, useCapture: boolean = false ) {\r\n\t\tconst names = this._names;\r\n\t\tfor( let i = names.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst name = names[ i ];\r\n\t\t\ttarget.removeEventListener( name, handler, useCapture );\r\n\t\t}\r\n\t}\r\n\r\n\tgetLineHeight(): number {\r\n\t\tif( this._lineHeight == null ) {\r\n\t\t\tconst theme = DThemes.getInstance().get( \"DBase\" ) as DThemeFont;\r\n\t\t\tthis._lineHeight = theme.getLineHeight();\r\n\t\t}\r\n\t\treturn this._lineHeight;\r\n\t}\r\n\r\n\tgetPageHeight(): number {\r\n\t\tif( this._pageHeight == null ) {\r\n\t\t\tthis._pageHeight = this.getLineHeight() * 12;\r\n\t\t}\r\n\t\treturn this._pageHeight;\r\n\t}\r\n\r\n\tnormalize( e: any ): UtilWheelEventDeltas | null {\r\n\t\tlet deltaX = 0;\r\n\t\tlet deltaY = 0;\r\n\r\n\t\t// Old school scrollwheel delta\r\n\t\tif ( \"detail\" in e ) {\r\n\t\t\tdeltaY = e.detail * -1;\r\n\t\t}\r\n\t\tif ( \"wheelDelta\" in e ) {\r\n\t\t\tdeltaY = e.wheelDelta;\r\n\t\t}\r\n\t\tif ( \"wheelDeltaY\" in e ) {\r\n\t\t\tdeltaY = e.wheelDeltaY;\r\n\t\t}\r\n\t\tif ( \"wheelDeltaX\" in e ) {\r\n\t\t\tdeltaX = e.wheelDeltaX * -1;\r\n\t\t}\r\n\r\n\t\t// Firefox < 17 horizontal scrolling related to DOMMouseScroll event\r\n\t\tif ( \"axis\" in e && e.axis === e.HORIZONTAL_AXIS ) {\r\n\t\t\tdeltaX = deltaY * -1;\r\n\t\t\tdeltaY = 0;\r\n\t\t}\r\n\r\n\t\t// New school wheel delta (wheel event)\r\n\t\tif ( \"deltaY\" in e ) {\r\n\t\t\tdeltaY = e.deltaY * -1;\r\n\t\t}\r\n\t\tif ( \"deltaX\" in e ) {\r\n\t\t\tdeltaX = e.deltaX;\r\n\t\t}\r\n\r\n\t\t// No change actually happened, no reason to go any further\r\n\t\tif ( deltaY === 0 && deltaX === 0 ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// Store lowest absolute delta to normalize the delta values\r\n\t\tlet delta = Math.max( Math.abs(deltaY), Math.abs(deltaX) );\r\n\r\n\t\t// Reset the this._lowest to better handle multiple device types\r\n\t\t// that give different a different lowestDelta\r\n\t\t// Ex: trackpad = 3 and mouse wheel = 120\r\n\t\tconst now = Date.now();\r\n\t\tif( this._timestamp + 200 <= now ) {\r\n\t\t\tthis._lowest = null;\r\n\t\t}\r\n\t\tthis._timestamp = now;\r\n\r\n\t\t//\r\n\t\tconst shouldAdjust = (e.type === \"mousewheel\" && delta % 120 === 0);\r\n\t\tif ( ! this._lowest || delta < this._lowest ) {\r\n\t\t\tthis._lowest = delta;\r\n\r\n\t\t\t// Adjust older deltas if necessary\r\n\t\t\tif ( shouldAdjust ) {\r\n\t\t\t\tthis._lowest /= 40;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Adjust older deltas if necessary\r\n\t\tif ( shouldAdjust ) {\r\n\t\t\t// Divide all the things by 40!\r\n\t\t\tdelta  /= 40;\r\n\t\t\tdeltaX /= 40;\r\n\t\t\tdeltaY /= 40;\r\n\t\t}\r\n\r\n\t\t// Get a whole, normalized value for the deltas\r\n\t\tconst lowest = this._lowest;\r\n\t\tdelta  = Math.floor( delta  / lowest );\r\n\t\tdeltaX = Math[ 1 <= deltaX ? \"floor\" : \"ceil\" ](deltaX / lowest);\r\n\t\tdeltaY = Math[ 1 <= deltaY ? \"floor\" : \"ceil\" ](deltaY / lowest);\r\n\r\n\t\t// Mode\r\n\t\tconst mode = e.deltaMode || 0;\r\n\t\tif( mode !== 0 ) {\r\n\t\t\tconst scale = ( mode === 1 ? this.getLineHeight() : this.getPageHeight() );\r\n\t\t\tdelta *= scale;\r\n\t\t\tdeltaX *= scale;\r\n\t\t\tdeltaY *= scale;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tmode,\r\n\t\t\tdelta,\r\n\t\t\tdeltaX,\r\n\t\t\tdeltaY,\r\n\t\t\tlowest\r\n\t\t};\r\n\t}\r\n\r\n\tstatic getInstance(): UtilWheelEvent {\r\n\t\tif( this.INSTANCE == null ) {\r\n\t\t\tthis.INSTANCE = new UtilWheelEvent();\r\n\t\t}\r\n\t\treturn this.INSTANCE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2020 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { isFunction, isNumber } from \"../../util\";\r\nimport { EShapeLineOfAnyPointsPoint } from \"./e-shape-line-of-any-points-point\";\r\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\r\nimport { isStatic } from \"./is-static\";\r\nimport { toComputed } from \"./to-computed\";\r\n\r\nexport interface EShapeLineOfAnyPointsPointImplParent {\r\n\treadonly length: number;\r\n\tupdateUploaded(): void;\r\n}\r\n\r\nexport class EShapeLineOfAnyPointsPointImpl implements EShapeLineOfAnyPointsPoint {\r\n\tprotected _parent: EShapeLineOfAnyPointsPointImplParent;\r\n\tprotected _id: number;\r\n\tprotected _x: EShapeLineOfAnyValue;\r\n\tprotected _y: EShapeLineOfAnyValue;\r\n\tprotected _defX: number;\r\n\tprotected _defY: number;\r\n\tprotected _limit: number | null;\r\n\tprotected _limitComputed: number;\r\n\tprotected _limitId: number;\r\n\tprotected _limitParentLength: number;\r\n\r\n\tconstructor( parent: EShapeLineOfAnyPointsPointImplParent, defX: number, defY: number ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._id = 0;\r\n\t\tthis._x = null;\r\n\t\tthis._y = null;\r\n\t\tthis._defX = defX;\r\n\t\tthis._defY = defY;\r\n\t\tthis._limit = null;\r\n\t\tthis._limitComputed = 0;\r\n\t\tthis._limitId = -1;\r\n\t\tthis._limitParentLength = 0;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget x(): EShapeLineOfAnyValue {\r\n\t\treturn this._x;\r\n\t}\r\n\r\n\tset x( x: EShapeLineOfAnyValue ) {\r\n\t\tthis.set( x, undefined );\r\n\t}\r\n\r\n\tget y(): EShapeLineOfAnyValue {\r\n\t\treturn this._y;\r\n\t}\r\n\r\n\tset y( y: EShapeLineOfAnyValue ) {\r\n\t\tthis.set( undefined, y );\r\n\t}\r\n\r\n\tget limit(): number | null {\r\n\t\treturn this._limit;\r\n\t}\r\n\r\n\tset limit( limit: number | null ) {\r\n\t\tthis._limit = limit;\r\n\t}\r\n\r\n\tset( x?: EShapeLineOfAnyValue, y?: EShapeLineOfAnyValue ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( x !== undefined && this._x !== x ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tthis._x = x;\r\n\t\t}\r\n\r\n\t\tif( y !== undefined && this._y !== y ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tthis._y = y;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tgetX( index: number ): number {\r\n\t\treturn toComputed( index, this._x, this._defX );\r\n\t}\r\n\r\n\tgetY( index: number ): number {\r\n\t\treturn toComputed( index, this._y, this._defY );\r\n\t}\r\n\r\n\tgetLimit(): number {\r\n\t\tconst limit = this._limit;\r\n\t\tif( limit != null ) {\r\n\t\t\treturn limit;\r\n\t\t}\r\n\t\tthis.updateLimitComputed();\r\n\t\treturn this._limitComputed;\r\n\t}\r\n\r\n\tprotected updateLimitComputed(): void {\r\n\t\tconst limitId = this._id;\r\n\t\tconst parent = this._parent;\r\n\t\tconst limitParentLength = parent.length;\r\n\t\tif( this._limitId !== limitId || this._limitParentLength !== limitParentLength ) {\r\n\t\t\tthis._limitId = limitId;\r\n\t\t\tthis._limitParentLength = limitParentLength;\r\n\t\t\tthis._limitComputed = Math.max(\r\n\t\t\t\tthis.calcLimit( this._x, limitParentLength, this._defX ),\r\n\t\t\t\tthis.calcLimit( this._y, limitParentLength, this._defY )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected calcLimit( value: EShapeLineOfAnyValue, parentLenght: number, def: number ): number {\r\n\t\tif( isNumber( value ) ) {\r\n\t\t\treturn Math.abs( value );\r\n\t\t} else if( isFunction( value ) ) {\r\n\t\t\tif( 0 < parentLenght ) {\r\n\t\t\t\tlet result = Math.abs( value( 0 ) );\r\n\t\t\t\tfor( let i = 1; i < parentLenght; ++i ) {\r\n\t\t\t\t\tresult = Math.max( result, Math.abs( value( i ) ) );\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t} else if( value != null ) {\r\n\t\t\tconst l = value.length;\r\n\t\t\tif( 0 < l ) {\r\n\t\t\t\tlet result = value[ 0 ];\r\n\t\t\t\tfor( let i = 1; i < l; ++i ) {\r\n\t\t\t\t\tresult = Math.max( result, Math.abs( value[ i ] ) );\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t} else {\r\n\t\t\treturn Math.abs( def );\r\n\t\t}\r\n\t}\r\n\r\n\tisStaticX(): boolean {\r\n\t\treturn isStatic( this._x );\r\n\t}\r\n\r\n\tisStaticY(): boolean {\r\n\t\treturn isStatic( this._y );\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._id += 1;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2020 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeLineOfAnyPointsStroke } from \"./e-shape-line-of-any-points-stroke\";\r\nimport { EShapeLineOfAnyValue } from \"./e-shape-line-of-any-value\";\r\nimport { isStatic } from \"./is-static\";\r\nimport { toComputed } from \"./to-computed\";\r\n\r\nexport interface EShapeLineOfAnyPointsStrokeImplParent {\r\n\tupdateUploaded(): void;\r\n}\r\n\r\nexport class EShapeLineOfAnyPointsStrokeImpl implements EShapeLineOfAnyPointsStroke {\r\n\tprotected _parent: EShapeLineOfAnyPointsStrokeImplParent;\r\n\tprotected _id: number;\r\n\tprotected _color: EShapeLineOfAnyValue;\r\n\tprotected _alpha: EShapeLineOfAnyValue;\r\n\r\n\tconstructor( parent: EShapeLineOfAnyPointsStrokeImplParent ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._id = 0;\r\n\t\tthis._color = null;\r\n\t\tthis._alpha = null;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget color(): EShapeLineOfAnyValue {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: EShapeLineOfAnyValue ) {\r\n\t\tthis.set( color, undefined );\r\n\t}\r\n\r\n\tget alpha(): EShapeLineOfAnyValue {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: EShapeLineOfAnyValue ) {\r\n\t\tthis.set( undefined, alpha );\r\n\t}\r\n\r\n\tset( color?: EShapeLineOfAnyValue, alpha?: EShapeLineOfAnyValue ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( color !== undefined && this._color !== color ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tthis._color = color;\r\n\t\t}\r\n\r\n\t\tif( alpha !== undefined && this._alpha !== alpha ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tthis._alpha = alpha;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\t}\r\n\r\n\tgetColor( index: number, def: number ): number {\r\n\t\treturn toComputed( index, this._color, def );\r\n\t}\r\n\r\n\tgetAlpha( index: number, def: number ): number {\r\n\t\treturn toComputed( index, this._alpha, def );\r\n\t}\r\n\r\n\tisStaticColor(): boolean {\r\n\t\treturn isStatic( this._color );\r\n\t}\r\n\r\n\tisStaticAlpha(): boolean {\r\n\t\treturn isStatic( this._alpha );\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._id += 1;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix, Point } from \"pixi.js\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeDefaults } from \"../e-shape-defaults\";\r\nimport { EShapePoints } from \"../e-shape-points\";\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport {\r\n\tEShapeLineOfAnyPoints, EShapeLineOfAnyPointsHitTester, EShapeLineOfAnyPointsTestRange\r\n} from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsFill } from \"./e-shape-line-of-any-points-fill\";\r\nimport { EShapeLineOfAnyPointsFillImpl } from \"./e-shape-line-of-any-points-fill-impl\";\r\nimport { EShapeLineOfAnyPointsPoint } from \"./e-shape-line-of-any-points-point\";\r\nimport { EShapeLineOfAnyPointsPointImpl } from \"./e-shape-line-of-any-points-point-impl\";\r\nimport { EShapeLineOfAnyPointsStroke } from \"./e-shape-line-of-any-points-stroke\";\r\nimport { EShapeLineOfAnyPointsStrokeImpl } from \"./e-shape-line-of-any-points-stroke-impl\";\r\n\r\nexport class EShapeLineOfAnyPointsImpl implements EShapeLineOfAnyPoints {\r\n\tprotected static WORK_RANGE: [ number, number ] = [ 0, 0 ];\r\n\r\n\tprotected _parent: EShape;\r\n\tprotected _values: number[];\r\n\tprotected _valuesLength: number;\r\n\tprotected _segments: number[];\r\n\tprotected _size: EShapeLineOfAnyPointsPoint;\r\n\tprotected _offset: EShapeLineOfAnyPointsPoint;\r\n\tprotected _fill: EShapeLineOfAnyPointsFill;\r\n\tprotected _stroke: EShapeLineOfAnyPointsStroke;\r\n\tprotected _id: number;\r\n\r\n\tconstructor( parent: EShape ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._values = [];\r\n\t\tthis._valuesLength = 0;\r\n\t\tthis._segments = [];\r\n\t\tthis._size = new EShapeLineOfAnyPointsPointImpl( this, EShapeDefaults.SIZE_X, EShapeDefaults.SIZE_Y );\r\n\t\tthis._offset = new EShapeLineOfAnyPointsPointImpl( this, 0, 0 );\r\n\t\tthis._fill = new EShapeLineOfAnyPointsFillImpl( parent );\r\n\t\tthis._stroke = new EShapeLineOfAnyPointsStrokeImpl( parent );\r\n\t\tthis._id = 0;\r\n\t}\r\n\r\n\tget length(): number {\r\n\t\treturn this._values.length >> 1;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget values(): number[] {\r\n\t\treturn this._values;\r\n\t}\r\n\r\n\tset values( values: number[] ) {\r\n\t\tthis.set( values, undefined, undefined );\r\n\t}\r\n\r\n\tget segments(): number[] {\r\n\t\treturn this._segments;\r\n\t}\r\n\r\n\tset segments( segments: number[] ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget style(): EShapePointsStyle {\r\n\t\treturn EShapePointsStyle.NONE;\r\n\t}\r\n\r\n\tset style( style: EShapePointsStyle ) {\r\n\t\tthis.set( undefined, undefined, style );\r\n\t}\r\n\r\n\tget size(): EShapeLineOfAnyPointsPoint {\r\n\t\treturn this._size;\r\n\t}\r\n\r\n\tget offset(): EShapeLineOfAnyPointsPoint {\r\n\t\treturn this._offset;\r\n\t}\r\n\r\n\tget fill(): EShapeLineOfAnyPointsFill {\r\n\t\treturn this._fill;\r\n\t}\r\n\r\n\tget stroke(): EShapeLineOfAnyPointsStroke {\r\n\t\treturn this._stroke;\r\n\t}\r\n\r\n\tcopy( source: EShapePoints ): this {\r\n\t\treturn this.set( source.values, source.segments, source.style );\r\n\t}\r\n\r\n\tset( newValues?: number[], newSegments?: number[], newStyle?: EShapePointsStyle ): this {\r\n\t\tlet isDirty = false;\r\n\t\tlet isUpdated = false;\r\n\r\n\t\t// Values\r\n\t\tif( newValues != null ) {\r\n\t\t\tconst values = this._values;\r\n\t\t\tconst valuesLength = this._valuesLength;\r\n\t\t\tconst newValuesLength = newValues.length;\r\n\t\t\tif( values !== newValues ) {\r\n\t\t\t\tconst iupdate = Math.min( valuesLength, newValuesLength );\r\n\r\n\t\t\t\tfor( let i = 0; i < iupdate; ++i ) {\r\n\t\t\t\t\tvalues[ i ] = newValues[ i ];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor( let i = iupdate; i < newValuesLength; ++i ) {\r\n\t\t\t\t\tvalues.push( newValues[ i ] );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( valuesLength !== newValuesLength ) {\r\n\t\t\t\t\tvalues.length = newValuesLength;\r\n\t\t\t\t\tthis._valuesLength = newValuesLength;\r\n\t\t\t\t\tisDirty = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tisUpdated = true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( valuesLength !== newValuesLength ) {\r\n\t\t\t\t\tthis._valuesLength = newValuesLength;\r\n\t\t\t\t\tisDirty = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tisUpdated = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tif( isDirty ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tconst parent = this._parent;\r\n\t\t\tconst uploaded = parent.uploaded;\r\n\t\t\tif( uploaded ) {\r\n\t\t\t\tif( uploaded.isCompatible( parent ) ) {\r\n\t\t\t\t\tparent.updateUploaded();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparent.uploaded = undefined;\r\n\t\t\t\t\tparent.toDirty();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tparent.updateUploaded();\r\n\t\t\t}\r\n\t\t} else if( isUpdated ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._parent.updateUploaded();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdateUploaded(): void {\r\n\t\tthis._parent.updateUploaded();\r\n\t}\r\n\r\n\tclone( parent: EShape ): EShapeLineOfAnyPointsImpl {\r\n\t\treturn new EShapeLineOfAnyPointsImpl( parent );\r\n\t}\r\n\r\n\ttoPoints( transform: Matrix ): Point[] {\r\n\t\tconst result: Point[] = [];\r\n\t\tconst values = this.values;\r\n\t\tfor( let i = 0, imax = values.length; i < imax; i += 2 ) {\r\n\t\t\tconst point = new Point( values[ i + 0 ], values[ i + 1 ] );\r\n\t\t\tresult.push( transform.apply( point, point ) );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn manager.add( `[]` );\r\n\t}\r\n\r\n\tcalcHitPointAbs<RESULT>(\r\n\t\tx: number, y: number,\r\n\t\tthreshold: number,\r\n\t\trange: EShapeLineOfAnyPointsTestRange | null,\r\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT>,\r\n\t\tresult: RESULT\r\n\t): boolean {\r\n\t\tconst pointCount = this.length;\r\n\t\tconst pointValues = this._values;\r\n\t\tconst size = this._size;\r\n\t\tconst offset = this._offset;\r\n\t\tlet istart = 0;\r\n\t\tlet iend = pointCount;\r\n\t\tif( range ) {\r\n\t\t\tconst s = size.getLimit() * 0.5;\r\n\t\t\tconst o = offset.getLimit();\r\n\t\t\tconst rangeResult = range( x, y, s, s, o, o, threshold, pointValues, EShapeLineOfAnyPointsImpl.WORK_RANGE );\r\n\t\t\tistart = rangeResult[ 0 ];\r\n\t\t\tiend = rangeResult[ 1 ];\r\n\t\t}\r\n\t\ttester = tester;\r\n\t\tfor( let i = istart, imax = Math.min( iend, pointCount ), iv = istart << 1; i < imax; i += 1, iv += 2 ) {\r\n\t\t\tconst px = pointValues[ iv     ];\r\n\t\t\tconst py = pointValues[ iv + 1 ];\r\n\t\t\tconst sx = size.getX( i ) * 0.5;\r\n\t\t\tconst sy = size.getY( i ) * 0.5;\r\n\t\t\tconst ox = offset.getX( i );\r\n\t\t\tconst oy = offset.getY( i );\r\n\t\t\tif( tester( x, y, sx, sy, ox, oy, px, py, i, threshold, result ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { buildLineOfAnyColor, toLineOfAnyPointCount } from \"./build-line-of-any\";\r\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport abstract class EShapeLineOfAnyUploaded extends EShapeTextUploaded {\r\n\tprotected pointId: number;\r\n\tprotected pointCount: number;\r\n\tprotected pointCountReserved: number;\r\n\tprotected pointSizeId: number;\r\n\tprotected pointOffsetId: number;\r\n\tprotected pointFillId: number;\r\n\tprotected pointStrokeId: number;\r\n\r\n\tconstructor(\r\n\t\tbuffer: EShapeBuffer,\r\n\t\tvoffset: number, ioffset: number,\r\n\t\ttvcount: number, ticount: number,\r\n\t\tvcount: number, icount: number,\r\n\t\tantialiasWeight: number,\r\n\t\tpointCountReserved: number\r\n\t) {\r\n\t\tsuper( buffer, voffset, ioffset, tvcount, ticount, vcount, icount, antialiasWeight );\r\n\t\tthis.pointId = -1;\r\n\t\tthis.pointCount = 0;\r\n\t\tthis.pointCountReserved = pointCountReserved;\r\n\t\tthis.pointSizeId = -1;\r\n\t\tthis.pointOffsetId = -1;\r\n\t\tthis.pointFillId = -1;\r\n\t\tthis.pointStrokeId = -1;\r\n\t}\r\n\r\n\tisCompatible( shape: EShape ): boolean {\r\n\t\tif( super.isCompatible( shape ) ) {\r\n\t\t\tconst points = shape.points;\r\n\t\t\tconst pointCount = toLineOfAnyPointCount( points ? points.length : 0 );\r\n\t\t\treturn pointCount === this.pointCountReserved;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected updateLineOfAnyColorFill(\r\n\t\tbuffer: EShapeBuffer, shape: EShape,\r\n\t\tpoints: EShapeLineOfAnyPoints, vcountPerPoint: number\r\n\t): void {\r\n\t\tconst pointFill = points.fill;\r\n\t\tconst pointFillId = pointFill.id;\r\n\t\tconst isPointFillChanged = ( pointFillId !== this.pointFillId );\r\n\r\n\t\tconst fill = shape.fill;\r\n\t\tconst isFillEnabled = shape.visible && fill.enable;\r\n\t\tconst colorFill = fill.color;\r\n\t\tconst alphaFill = (isFillEnabled ? fill.alpha : 0);\r\n\t\tconst isFillChanged = ( colorFill !== this.colorFill || alphaFill !== this.alphaFill );\r\n\r\n\t\tif( isPointFillChanged || isFillChanged ) {\r\n\t\t\tthis.colorFill = colorFill;\r\n\t\t\tthis.alphaFill = alphaFill;\r\n\t\t\tthis.pointFillId = pointFillId;\r\n\t\t\tbuffer.updateColorFills();\r\n\t\t\tbuildLineOfAnyColor(\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\tvcountPerPoint,\r\n\t\t\t\tpointFill,\r\n\t\t\t\tthis.pointCountReserved,\r\n\t\t\t\tbuffer.colorFills,\r\n\t\t\t\tisFillEnabled,\r\n\t\t\t\tcolorFill,\r\n\t\t\t\talphaFill\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateLineOfAnyColorStroke(\r\n\t\tbuffer: EShapeBuffer, shape: EShape,\r\n\t\tpoints: EShapeLineOfAnyPoints, vcountPerPoint: number\r\n\t): void {\r\n\t\tconst pointStroke = points.stroke;\r\n\t\tconst pointStrokeId = pointStroke.id;\r\n\t\tconst isPointStrokeChanged = ( pointStrokeId !== this.pointStrokeId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst isStrokeEnabled = shape.visible && stroke.enable;\r\n\t\tconst colorStroke = stroke.color;\r\n\t\tconst alphaStroke = (isStrokeEnabled ? stroke.alpha : 0);\r\n\t\tconst isStrokeChanged = ( colorStroke !== this.colorStroke || alphaStroke !== this.alphaStroke );\r\n\r\n\t\tif( isPointStrokeChanged || isStrokeChanged ) {\r\n\t\t\tthis.colorStroke = colorStroke;\r\n\t\t\tthis.alphaStroke = alphaStroke;\r\n\t\t\tthis.pointStrokeId = pointStrokeId;\r\n\t\t\tbuffer.updateColorStrokes();\r\n\t\t\tbuildLineOfAnyColor(\r\n\t\t\t\tthis.vertexOffset,\r\n\t\t\t\tvcountPerPoint,\r\n\t\t\t\tpointStroke,\r\n\t\t\t\tthis.pointCountReserved,\r\n\t\t\t\tbuffer.colorStrokes,\r\n\t\t\t\tisStrokeEnabled,\r\n\t\t\t\tcolorStroke,\r\n\t\t\t\talphaStroke\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport {\r\n\tbuildCircleClipping, buildCircleIndex, buildCircleStep, buildCircleUv,\r\n\tbuildCircleVertex, CIRCLE_INDEX_COUNT, CIRCLE_VERTEX_COUNT, CIRCLE_WORLD_SIZE\r\n} from \"./build-circle\";\r\nimport { buildNullStep, buildNullVertex } from \"./build-null\";\r\nimport { copyClipping } from \"./copy-clipping\";\r\nimport { copyIndex } from \"./copy-index\";\r\nimport { copyStep } from \"./copy-step\";\r\nimport { copyUvs } from \"./copy-uv\";\r\nimport { copyVertex } from \"./copy-vertex\";\r\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { EShapeLineOfAnyUploaded } from \"./e-shape-line-of-any-uploaded\";\r\n\r\nexport class EShapeLineOfCirclesUploaded extends EShapeLineOfAnyUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Clippings & indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateClippings();\r\n\t\tbuffer.updateIndices();\r\n\t\tconst clippings = buffer.clippings;\r\n\t\tconst indices = buffer.indices;\r\n\t\tconst voffset = this.vertexOffset;\r\n\t\tconst ioffset = this.indexOffset;\r\n\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\tif( 0 < pointCountReserved ) {\r\n\t\t\tbuildCircleClipping(\r\n\t\t\t\tclippings,\r\n\t\t\t\tvoffset\r\n\t\t\t);\r\n\t\t\tcopyClipping(\r\n\t\t\t\tclippings,\r\n\t\t\t\tvoffset,\r\n\t\t\t\tCIRCLE_VERTEX_COUNT,\r\n\t\t\t\tpointCountReserved\r\n\t\t\t);\r\n\t\t\tbuildCircleIndex(\r\n\t\t\t\tindices,\r\n\t\t\t\tvoffset,\r\n\t\t\t\tioffset\r\n\t\t\t);\r\n\t\t\tcopyIndex(\r\n\t\t\t\tindices,\r\n\t\t\t\tCIRCLE_VERTEX_COUNT,\r\n\t\t\t\tioffset,\r\n\t\t\t\tCIRCLE_INDEX_COUNT,\r\n\t\t\t\tpointCountReserved\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tconst points = shape.points;\r\n\t\tif( points instanceof EShapeLineOfAnyPointsImpl ) {\r\n\t\t\tthis.updateVertexAndStep( buffer, shape, points );\r\n\t\t\tthis.updateLineOfAnyColorFill( buffer, shape, points, CIRCLE_VERTEX_COUNT );\r\n\t\t\tthis.updateLineOfAnyColorStroke( buffer, shape, points, CIRCLE_VERTEX_COUNT );\r\n\t\t\tthis.updateUv( buffer, shape );\r\n\t\t\tthis.updateText( buffer, shape );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateVertexAndStep( buffer: EShapeBuffer, shape: EShape, points: EShapeLineOfAnyPoints ): void {\r\n\t\tconst pointId = points.id;\r\n\t\tconst pointOffset = points.offset;\r\n\t\tconst pointOffsetId = pointOffset.id;\r\n\t\tconst isPointChanged = ( pointId !== this.pointId || pointOffsetId !== this.pointOffsetId );\r\n\r\n\t\tconst pointSize = points.size;\r\n\t\tconst pointSizeId = pointSize.id;\r\n\t\tconst isPointSizeChanged = ( pointSizeId !== this.pointSizeId );\r\n\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign || this.strokeWidth !== strokeWidth );\r\n\r\n\t\tif( isPointChanged || isPointSizeChanged || isSizeChanged || isTransformChanged || isStrokeChanged ) {\r\n\t\t\tthis.pointId = pointId;\r\n\t\t\tthis.pointCount = points.length;\r\n\t\t\tthis.pointOffsetId = pointOffsetId;\r\n\t\t\tthis.pointSizeId = pointSizeId;\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\r\n\t\t\tif( isSizeChanged || isTransformChanged || isStrokeChanged ) {\r\n\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t}\r\n\r\n\t\t\t// Buffer\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tbuffer.updateSteps();\r\n\t\t\tconst pointCount = this.pointCount;\r\n\t\t\tconst pointsValues = points.values;\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\t\t\tconst vertices = buffer.vertices;\r\n\t\t\tconst steps = buffer.steps;\r\n\t\t\tconst clippings = buffer.clippings;\r\n\t\t\tconst internalTransform = shape.transform.internalTransform;\r\n\t\t\tconst antialiasWeight = this.antialiasWeight;\r\n\t\t\tif( 0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY() ) {\r\n\t\t\t\tconst pointSizeX = pointSize.getX( 0 );\r\n\t\t\t\tconst pointSizeY = pointSize.getY( 0 );\r\n\r\n\t\t\t\tbuildCircleVertex(\r\n\t\t\t\t\tvertices, voffset,\r\n\t\t\t\t\t0, 0,\r\n\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\tstrokeAlign, strokeWidth,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tCIRCLE_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t\tcopyVertex(\r\n\t\t\t\t\tvertices,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tvoffset, CIRCLE_VERTEX_COUNT,\r\n\t\t\t\t\tpointCount, pointsValues,\r\n\t\t\t\t\tpointOffset\r\n\t\t\t\t);\r\n\t\t\t\tbuildCircleStep(\r\n\t\t\t\t\tsteps, clippings,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\tCIRCLE_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t\tcopyStep(\r\n\t\t\t\t\tsteps,\r\n\t\t\t\t\tvoffset, CIRCLE_VERTEX_COUNT,\r\n\t\t\t\t\tpointCount\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0; i < pointCount; ++i ) {\r\n\t\t\t\t\tconst ip = i << 1;\r\n\t\t\t\t\tconst px = pointsValues[ ip     ] + pointOffset.getX( i );\r\n\t\t\t\t\tconst py = pointsValues[ ip + 1 ] + pointOffset.getY( i );\r\n\t\t\t\t\tconst pointSizeX = pointSize.getX( i );\r\n\t\t\t\t\tconst pointSizeY = pointSize.getY( i );\r\n\t\t\t\t\tconst iv = voffset + i * CIRCLE_VERTEX_COUNT;\r\n\t\t\t\t\tbuildCircleVertex(\r\n\t\t\t\t\t\tvertices, iv,\r\n\t\t\t\t\t\tpx, py,\r\n\t\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\t\tstrokeAlign, strokeWidth,\r\n\t\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\t\tCIRCLE_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbuildCircleStep(\r\n\t\t\t\t\t\tsteps, clippings,\r\n\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\t\tCIRCLE_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Fill the rest\r\n\t\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\t\tconst voffsetReserved = voffset + pointCount * CIRCLE_VERTEX_COUNT;\r\n\t\t\tconst vcountReserved = CIRCLE_VERTEX_COUNT * (pointCountReserved - pointCount);\r\n\t\t\tbuildNullVertex(\r\n\t\t\t\tvertices,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullStep(\r\n\t\t\t\tsteps,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateUv( buffer: EShapeBuffer, shape: EShape ) {\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tif( texture !== this.texture || textureTransformId !== this.textureTransformId ) {\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tbuffer.updateUvs();\r\n\t\t\tconst uvs = buffer.uvs;\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\t\t\tconst textureUvs = this.toTextureUvs( texture );\r\n\t\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\t\tif( 0 < pointCountReserved ) {\r\n\t\t\t\tbuildCircleUv(\r\n\t\t\t\t\tuvs,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\ttextureUvs\r\n\t\t\t\t);\r\n\t\t\t\tcopyUvs(\r\n\t\t\t\t\tuvs,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tCIRCLE_VERTEX_COUNT,\r\n\t\t\t\t\tpointCountReserved\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { CIRCLE_INDEX_COUNT, CIRCLE_VERTEX_COUNT } from \"./build-circle\";\r\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\r\nimport { EShapeLineOfCirclesUploaded } from \"./e-shape-line-of-circles-uploaded\";\r\n\r\nexport const createLineOfCirclesUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeLineOfCirclesUploaded | null => {\r\n\treturn createLineOfAnyUploaded(\r\n\t\tbuffer, shape,\r\n\t\tvoffset, CIRCLE_VERTEX_COUNT,\r\n\t\tioffset, CIRCLE_INDEX_COUNT,\r\n\t\tantialiasWeight,\r\n\t\tEShapeLineOfCirclesUploaded\r\n\t);\r\n};\r\n","import { EShapeStroke } from \"../e-shape-stroke\";\r\nimport { EShapeLineOfAnyPoints, EShapeLineOfAnyPointsToHitThreshold } from \"./e-shape-line-of-any-points\";\r\n\r\nexport const toHitThreshold = (\r\n\ttarget: { readonly stroke: EShapeStroke, readonly points: EShapeLineOfAnyPoints; },\r\n\ttoThreshold: EShapeLineOfAnyPointsToHitThreshold | null\r\n): number => {\r\n\tconst stroke = target.stroke;\r\n\tconst size = target.points.size.getLimit() + ( stroke.enable ? stroke.width * stroke.align : 0 );\r\n\treturn ( toThreshold ?\r\n\t\ttoThreshold( size, 1 ) :\r\n\t\tsize * 0.5\r\n\t);\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeBase } from \"./e-shape-base\";\r\nimport { EShapeCircle } from \"./e-shape-circle\";\r\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\r\nimport {\r\n\tEShapeLineOfAnyPoints, EShapeLineOfAnyPointsHitTester,\r\n\tEShapeLineOfAnyPointsTestRange, EShapeLineOfAnyPointsToHitThreshold\r\n} from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { toHitThreshold } from \"./to-hit-threshold\";\r\n\r\nexport class EShapeLineOfCircles extends EShapeCircle implements EShapeLineOfAny {\r\n\tpoints!: EShapeLineOfAnyPoints;\r\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\tprotected _testerBBox: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\r\n\tconstructor( other?: EShapeLineOfCircles ) {\r\n\t\tsuper( EShapeType.LINE_OF_CIRCLES );\r\n\t\tif( other ) {\r\n\t\t\tthis.copy( other );\r\n\t\t} else {\r\n\t\t\tthis.points = new EShapeLineOfAnyPointsImpl( this );\r\n\t\t}\r\n\r\n\t\tthis._tester = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbs( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\r\n\t\tthis._testerBBox = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbsBBox( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\t}\r\n\r\n\tclone(): EShapeLineOfCircles {\r\n\t\treturn new EShapeLineOfCircles( this );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tconst threshold = toHitThreshold( this, null );\r\n\t\tif( this.containsAbsBBox( x, y, ax + threshold, ay + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\tx, y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\tnull,\r\n\t\t\t\tthis._tester,\r\n\t\t\t\tnull\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontainsPointAbs(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbs( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcontainsPointAbsBBox(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbsBBox( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcalcHitPoint<RESULT>(\r\n\t\tpoint: IPoint,\r\n\t\ttoThreshold: EShapeLineOfAnyPointsToHitThreshold | null,\r\n\t\trange: EShapeLineOfAnyPointsTestRange | null,\r\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\r\n\t\tresult: RESULT\r\n\t): boolean {\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\tconst threshold = toHitThreshold( this, toThreshold );\r\n\t\tif( this.containsAbsBBox( rect.x, rect.y, rect.width + threshold, rect.height + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\trect.x, rect.y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\trange,\r\n\t\t\t\ttester || this._tester,\r\n\t\t\t\tresult\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeLineOfCircles } from \"./e-shape-line-of-circles\";\r\n\r\nexport const deserializeLineOfCircles = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeLineOfCircles> | EShapeLineOfCircles => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeLineOfCircles() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createLineOfCirclesUploaded } from \"../variant/create-line-of-circles-uploaded\";\r\nimport { deserializeLineOfCircles } from \"../variant/deserialize-line-of-circles\";\r\n\r\nexport const loadShapeLineOfCircles = () => {\r\n\tEShapeUploadeds[ EShapeType.LINE_OF_CIRCLES ] = createLineOfCirclesUploaded;\r\n\tEShapeDeserializers[ EShapeType.LINE_OF_CIRCLES ] = deserializeLineOfCircles;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeCapability } from \"./e-shape-capability\";\r\nimport { EShapeType } from \"./e-shape-type\";\r\n\r\nexport class EShapeCapabilities {\r\n\tstatic mappings: { [ type: number ]: EShapeCapability } = {};\r\n\r\n\tstatic get( type: EShapeType ): EShapeCapability {\r\n\t\treturn this.mappings[ type ] || EShapeCapability.PRIMITIVE;\r\n\t}\r\n\r\n\tstatic contains( shape: EShape | null | undefined, capability: EShapeCapability ): shape is EShape {\r\n\t\tif( shape != null ) {\r\n\t\t\tif( this.get( shape.type ) & capability ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tconst children = shape.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tif( this.contains( children[ i ], capability ) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tstatic set( type: EShapeType, capability: EShapeCapability ): void {\r\n\t\tthis.mappings[ type ] = capability;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DAlignHorizontal {\r\n\tLEFT,\r\n\tCENTER,\r\n\tRIGHT\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DAlignVertical {\r\n\tTOP,\r\n\tMIDDLE,\r\n\tBOTTOM\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DAlignWith {\r\n\tTEXT,\r\n\tPADDING,\r\n\tBORDER\r\n}\r\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\r\nimport { EShapeCorner } from \"../e-shape-corner\";\r\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\r\nimport { toLength } from \"./to-length\";\r\nimport { STEP_VALUES, toStep } from \"./to-step\";\r\n\r\nexport const RECTANGLE_ROUNDED_VERTEX_COUNT = 36;\r\nexport const RECTANGLE_ROUNDED_INDEX_COUNT = 24;\r\nexport const RECTANGLE_ROUNDED_WORLD_SIZE: [ number, number, number ] = [ 0, 0, 0 ];\r\nconst RECTANGLE_ROUNDED_WORK_POINT: Point = new Point();\r\n\r\nexport const buildRectangleRoundedIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number\r\n): void => {\r\n\t// Top-left corner\r\n\tlet ii = ioffset * 3;\r\n\tindices[ ii + 0 ] = voffset + 0;\r\n\tindices[ ii + 1 ] = voffset + 1;\r\n\tindices[ ii + 2 ] = voffset + 2;\r\n\tindices[ ii + 3 ] = voffset + 1;\r\n\tindices[ ii + 4 ] = voffset + 3;\r\n\tindices[ ii + 5 ] = voffset + 2;\r\n\tii += 6;\r\n\r\n\t// Top-right corner\r\n\tindices[ ii + 0 ] = voffset + 4;\r\n\tindices[ ii + 1 ] = voffset + 5;\r\n\tindices[ ii + 2 ] = voffset + 6;\r\n\tindices[ ii + 3 ] = voffset + 5;\r\n\tindices[ ii + 4 ] = voffset + 7;\r\n\tindices[ ii + 5 ] = voffset + 6;\r\n\tii += 6;\r\n\r\n\t// Bottom-left corner\r\n\tindices[ ii + 0 ] = voffset + 8;\r\n\tindices[ ii + 1 ] = voffset + 9;\r\n\tindices[ ii + 2 ] = voffset + 10;\r\n\tindices[ ii + 3 ] = voffset + 9;\r\n\tindices[ ii + 4 ] = voffset + 11;\r\n\tindices[ ii + 5 ] = voffset + 10;\r\n\tii += 6;\r\n\r\n\t// Bottom-right corner\r\n\tindices[ ii + 0 ] = voffset + 12;\r\n\tindices[ ii + 1 ] = voffset + 13;\r\n\tindices[ ii + 2 ] = voffset + 14;\r\n\tindices[ ii + 3 ] = voffset + 13;\r\n\tindices[ ii + 4 ] = voffset + 15;\r\n\tindices[ ii + 5 ] = voffset + 14;\r\n\tii += 6;\r\n\r\n\t// Top edge\r\n\tindices[ ii + 0 ] = voffset + 16;\r\n\tindices[ ii + 1 ] = voffset + 17;\r\n\tindices[ ii + 2 ] = voffset + 20;\r\n\tindices[ ii + 3 ] = voffset + 17;\r\n\tindices[ ii + 4 ] = voffset + 21;\r\n\tindices[ ii + 5 ] = voffset + 20;\r\n\tii += 6;\r\n\r\n\tindices[ ii + 0 ] = voffset + 17;\r\n\tindices[ ii + 1 ] = voffset + 18;\r\n\tindices[ ii + 2 ] = voffset + 21;\r\n\tindices[ ii + 3 ] = voffset + 18;\r\n\tindices[ ii + 4 ] = voffset + 22;\r\n\tindices[ ii + 5 ] = voffset + 21;\r\n\tii += 6;\r\n\r\n\t// Upper middle\r\n\tindices[ ii + 0 ] = voffset + 19;\r\n\tindices[ ii + 1 ] = voffset + 21;\r\n\tindices[ ii + 2 ] = voffset + 24;\r\n\tindices[ ii + 3 ] = voffset + 21;\r\n\tindices[ ii + 4 ] = voffset + 25;\r\n\tindices[ ii + 5 ] = voffset + 24;\r\n\tii += 6;\r\n\r\n\tindices[ ii + 0 ] = voffset + 21;\r\n\tindices[ ii + 1 ] = voffset + 23;\r\n\tindices[ ii + 2 ] = voffset + 26;\r\n\tindices[ ii + 3 ] = voffset + 23;\r\n\tindices[ ii + 4 ] = voffset + 27;\r\n\tindices[ ii + 5 ] = voffset + 26;\r\n\tii += 6;\r\n\r\n\t// Lower middle\r\n\tindices[ ii + 0 ] = voffset + 24;\r\n\tindices[ ii + 1 ] = voffset + 25;\r\n\tindices[ ii + 2 ] = voffset + 28;\r\n\tindices[ ii + 3 ] = voffset + 25;\r\n\tindices[ ii + 4 ] = voffset + 30;\r\n\tindices[ ii + 5 ] = voffset + 28;\r\n\tii += 6;\r\n\r\n\tindices[ ii + 0 ] = voffset + 26;\r\n\tindices[ ii + 1 ] = voffset + 27;\r\n\tindices[ ii + 2 ] = voffset + 30;\r\n\tindices[ ii + 3 ] = voffset + 27;\r\n\tindices[ ii + 4 ] = voffset + 32;\r\n\tindices[ ii + 5 ] = voffset + 30;\r\n\tii += 6;\r\n\r\n\t// Bottom edge\r\n\tindices[ ii + 0 ] = voffset + 29;\r\n\tindices[ ii + 1 ] = voffset + 30;\r\n\tindices[ ii + 2 ] = voffset + 33;\r\n\tindices[ ii + 3 ] = voffset + 30;\r\n\tindices[ ii + 4 ] = voffset + 34;\r\n\tindices[ ii + 5 ] = voffset + 33;\r\n\tii += 6;\r\n\r\n\tindices[ ii + 0 ] = voffset + 30;\r\n\tindices[ ii + 1 ] = voffset + 31;\r\n\tindices[ ii + 2 ] = voffset + 34;\r\n\tindices[ ii + 3 ] = voffset + 31;\r\n\tindices[ ii + 4 ] = voffset + 35;\r\n\tindices[ ii + 5 ] = voffset + 34;\r\n};\r\n\r\nexport const buildRectangleRoundedVertex = (\r\n\tvertices: Float32Array,\r\n\tvoffset: number,\r\n\toriginX: number,\r\n\toriginY: number,\r\n\tsizeX: number,\r\n\tsizeY: number,\r\n\tstrokeAlign: number,\r\n\tstrokeWidth: number,\r\n\tradius: number,\r\n\tinternalTransform: Matrix,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\t// Calculate the transformed positions\r\n\t//\r\n\t//  0   1       4   5\r\n\t// |---|       |---|\r\n\t// |2  |3      |6  |7\r\n\t// |---|       |---|\r\n\t//\r\n\t//\r\n\t//\r\n\t//\r\n\t//\r\n\t// |---|       |---|\r\n\t// |8  |9      |12 |13\r\n\t// |---|       |---|\r\n\t//  10  11      14  15\r\n\t//\r\n\t//\r\n\t//      16  17  18       <-- Top edge\r\n\t//     |---|---|\r\n\t//  19 |20 |21 |22  23   <-- Top\r\n\t// |---|---|---|---|\r\n\t// |       |       |\r\n\t// |24   25|26     |27   <-- Middle\r\n\t// |-------|-------|\r\n\t// |       |       |\r\n\t// |       |       |\r\n\t// |---|---|---|---|\r\n\t//  28 |29 |30 |31  32   <-- Bottom\r\n\t//     |---|---|\r\n\t//      33  34  35       <-- Bottom edge\r\n\t//\r\n\tconst s = strokeAlign * strokeWidth;\r\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\r\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\r\n\tconst ax = Math.abs( sx );\r\n\tconst ay = Math.abs( sy );\r\n\tconst a = radius * Math.min( ax, ay );\r\n\tconst rx = a / ax;\r\n\tconst ry = a / ay;\r\n\r\n\tconst work = RECTANGLE_ROUNDED_WORK_POINT;\r\n\twork.set( originX - sx, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x0 = work.x;\r\n\tconst y0 = work.y;\r\n\twork.set( originX, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x2 = work.x;\r\n\tconst y2 = work.y;\r\n\tconst dxh = x2 - x0;\r\n\tconst dyh = y2 - y0;\r\n\tconst dxhr = rx * dxh;\r\n\tconst dyhr = rx * dyh;\r\n\tconst x1 = x0 + dxhr;\r\n\tconst y1 = y0 + dyhr;\r\n\tconst x4 = x2 + dxh;\r\n\tconst y4 = y2 + dyh;\r\n\tconst x3 = x4 - dxhr;\r\n\tconst y3 = y4 - dyhr;\r\n\twork.set( originX, originY );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x11 = work.x;\r\n\tconst y11 = work.y;\r\n\tconst dxv = x11 - x2;\r\n\tconst dyv = y11 - y2;\r\n\tconst dxvr = ry * dxv;\r\n\tconst dyvr = ry * dyv;\r\n\tconst x7 = x2 + dxvr;\r\n\tconst y7 = y2 + dyvr;\r\n\tconst x5 = x7 - dxh;\r\n\tconst y5 = y7 - dyh;\r\n\tconst x6 = x5 + dxhr;\r\n\tconst y6 = y5 + dyhr;\r\n\tconst x9 = x7 + dxh;\r\n\tconst y9 = y7 + dyh;\r\n\tconst x8 = x9 - dxhr;\r\n\tconst y8 = y9 - dyhr;\r\n\tconst x10 = x11 - dxh;\r\n\tconst y10 = y11 - dyh;\r\n\tconst x12 = x11 + dxh;\r\n\tconst y12 = y11 + dyh;\r\n\tconst x20 = x11 + dxv;\r\n\tconst y20 = y11 + dyv;\r\n\tconst x15 = x20 - dxvr;\r\n\tconst y15 = y20 - dyvr;\r\n\tconst x13 = x15 - dxh;\r\n\tconst y13 = y15 - dyh;\r\n\tconst x14 = x13 + dxhr;\r\n\tconst y14 = y13 + dyhr;\r\n\tconst x17 = x15 + dxh;\r\n\tconst y17 = y15 + dyh;\r\n\tconst x16 = x17 - dxhr;\r\n\tconst y16 = y17 - dyhr;\r\n\tconst x18 = x20 - dxh;\r\n\tconst y18 = y20 - dyh;\r\n\tconst x19 = x18 + dxhr;\r\n\tconst y19 = y18 + dyhr;\r\n\tconst x22 = x20 + dxh;\r\n\tconst y22 = y20 + dyh;\r\n\tconst x21 = x22 - dxhr;\r\n\tconst y21 = y22 - dyhr;\r\n\r\n\t// World size\r\n\tworldSize[ 0 ] = toLength( x0, y0, x1, y1 );\r\n\tworldSize[ 1 ] = toLength( x0, y0, x2, y2 );\r\n\tworldSize[ 2 ] = toLength( x0, y0, x10, y10 );\r\n\r\n\t// Vertices\r\n\tlet iv = voffset * 2;\r\n\r\n\t// Top-left corner\r\n\tvertices[ iv + 0 ] = x0;\r\n\tvertices[ iv + 1 ] = y0;\r\n\tvertices[ iv + 2 ] = x1;\r\n\tvertices[ iv + 3 ] = y1;\r\n\tvertices[ iv + 4 ] = x5;\r\n\tvertices[ iv + 5 ] = y5;\r\n\tvertices[ iv + 6 ] = x6;\r\n\tvertices[ iv + 7 ] = y6;\r\n\tiv += 8;\r\n\r\n\t// Top-right corner\r\n\tvertices[ iv + 0 ] = x3;\r\n\tvertices[ iv + 1 ] = y3;\r\n\tvertices[ iv + 2 ] = x4;\r\n\tvertices[ iv + 3 ] = y4;\r\n\tvertices[ iv + 4 ] = x8;\r\n\tvertices[ iv + 5 ] = y8;\r\n\tvertices[ iv + 6 ] = x9;\r\n\tvertices[ iv + 7 ] = y9;\r\n\tiv += 8;\r\n\r\n\t// Bottom-left corner\r\n\tvertices[ iv + 0 ] = x13;\r\n\tvertices[ iv + 1 ] = y13;\r\n\tvertices[ iv + 2 ] = x14;\r\n\tvertices[ iv + 3 ] = y14;\r\n\tvertices[ iv + 4 ] = x18;\r\n\tvertices[ iv + 5 ] = y18;\r\n\tvertices[ iv + 6 ] = x19;\r\n\tvertices[ iv + 7 ] = y19;\r\n\tiv += 8;\r\n\r\n\t// Bottom-right corner\r\n\tvertices[ iv + 0 ] = x16;\r\n\tvertices[ iv + 1 ] = y16;\r\n\tvertices[ iv + 2 ] = x17;\r\n\tvertices[ iv + 3 ] = y17;\r\n\tvertices[ iv + 4 ] = x21;\r\n\tvertices[ iv + 5 ] = y21;\r\n\tvertices[ iv + 6 ] = x22;\r\n\tvertices[ iv + 7 ] = y22;\r\n\tiv += 8;\r\n\r\n\t// Top edge\r\n\tvertices[ iv + 0 ] = x1;\r\n\tvertices[ iv + 1 ] = y1;\r\n\tvertices[ iv + 2 ] = x2;\r\n\tvertices[ iv + 3 ] = y2;\r\n\tvertices[ iv + 4 ] = x3;\r\n\tvertices[ iv + 5 ] = y3;\r\n\tiv += 6;\r\n\r\n\t// Top\r\n\tvertices[ iv + 0 ] = x5;\r\n\tvertices[ iv + 1 ] = y5;\r\n\tvertices[ iv + 2 ] = x6;\r\n\tvertices[ iv + 3 ] = y6;\r\n\tvertices[ iv + 4 ] = x7;\r\n\tvertices[ iv + 5 ] = y7;\r\n\tvertices[ iv + 6 ] = x8;\r\n\tvertices[ iv + 7 ] = y8;\r\n\tvertices[ iv + 8 ] = x9;\r\n\tvertices[ iv + 9 ] = y9;\r\n\tiv += 10;\r\n\r\n\t// Middle\r\n\tvertices[ iv + 0 ] = x10;\r\n\tvertices[ iv + 1 ] = y10;\r\n\tvertices[ iv + 2 ] = x11;\r\n\tvertices[ iv + 3 ] = y11;\r\n\tvertices[ iv + 4 ] = x11;\r\n\tvertices[ iv + 5 ] = y11;\r\n\tvertices[ iv + 6 ] = x12;\r\n\tvertices[ iv + 7 ] = y12;\r\n\tiv += 8;\r\n\r\n\t// Bottom\r\n\tvertices[ iv + 0 ] = x13;\r\n\tvertices[ iv + 1 ] = y13;\r\n\tvertices[ iv + 2 ] = x14;\r\n\tvertices[ iv + 3 ] = y14;\r\n\tvertices[ iv + 4 ] = x15;\r\n\tvertices[ iv + 5 ] = y15;\r\n\tvertices[ iv + 6 ] = x16;\r\n\tvertices[ iv + 7 ] = y16;\r\n\tvertices[ iv + 8 ] = x17;\r\n\tvertices[ iv + 9 ] = y17;\r\n\tiv += 10;\r\n\r\n\t// Bottom edge\r\n\tvertices[ iv + 0 ] = x19;\r\n\tvertices[ iv + 1 ] = y19;\r\n\tvertices[ iv + 2 ] = x20;\r\n\tvertices[ iv + 3 ] = y20;\r\n\tvertices[ iv + 4 ] = x21;\r\n\tvertices[ iv + 5 ] = y21;\r\n};\r\n\r\nexport const buildRectangleRoundedClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tcorner: EShapeCorner,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\tlet ic = voffset * 3;\r\n\tconst rxc = 1 - worldSize[ 0 ] / worldSize[ 1 ];\r\n\tconst ryc = 1 - worldSize[ 0 ] / worldSize[ 2 ];\r\n\r\n\t// Top-left corner\r\n\tif( corner & EShapeCorner.TOP_LEFT ) {\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\t} else {\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = rxc;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = ryc;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = rxc;\r\n\t\tclippings[ ic + 1 ] = ryc;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\t}\r\n\r\n\t// Top-right corner\r\n\tif( corner & EShapeCorner.TOP_RIGHT ) {\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\t} else {\r\n\t\tclippings[ ic + 0 ] = rxc;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = rxc;\r\n\t\tclippings[ ic + 1 ] = ryc;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = ryc;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\t}\r\n\r\n\t// Bottom-left corner\r\n\tif( corner & EShapeCorner.BOTTOM_LEFT ) {\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\t} else {\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = ryc;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = rxc;\r\n\t\tclippings[ ic + 1 ] = ryc;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = rxc;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\t}\r\n\r\n\t// Bottom-right corner\r\n\tif( corner & EShapeCorner.BOTTOM_RIGHT ) {\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 0;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 0;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 1;\r\n\t\tic += 3;\r\n\t} else {\r\n\t\tclippings[ ic + 0 ] = rxc;\r\n\t\tclippings[ ic + 1 ] = ryc;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = ryc;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = rxc;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\r\n\t\tclippings[ ic + 0 ] = 1;\r\n\t\tclippings[ ic + 1 ] = 1;\r\n\t\tclippings[ ic + 2 ] = 0;\r\n\t\tic += 3;\r\n\t}\r\n\r\n\t// Top edge\r\n\tclippings[ ic + 0 ] = rxc;\r\n\tclippings[ ic + 1 ] = 1;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 0;\r\n\tclippings[ ic + 1 ] = 1;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = rxc;\r\n\tclippings[ ic + 1 ] = 1;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\t// Top\r\n\tclippings[ ic + 0 ] = 1;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = rxc;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 0;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = rxc;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 1;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\t// Middle\r\n\tclippings[ ic + 0 ] = 1;\r\n\tclippings[ ic + 1 ] = 0;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 0;\r\n\tclippings[ ic + 1 ] = 0;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 0;\r\n\tclippings[ ic + 1 ] = 0;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 1;\r\n\tclippings[ ic + 1 ] = 0;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\t// Bottom\r\n\tclippings[ ic + 0 ] = 1;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = rxc;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 0;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = rxc;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 1;\r\n\tclippings[ ic + 1 ] = ryc;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\t// Bottom edge\r\n\tclippings[ ic + 0 ] = rxc;\r\n\tclippings[ ic + 1 ] = 1;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = 0;\r\n\tclippings[ ic + 1 ] = 1;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n\r\n\tclippings[ ic + 0 ] = rxc;\r\n\tclippings[ ic + 1 ] = 1;\r\n\tclippings[ ic + 2 ] = 0;\r\n\tic += 3;\r\n};\r\n\r\nexport const buildRectangleRoundedStep = (\r\n\tsteps: Float32Array,\r\n\tvoffset: number,\r\n\tstrokeWidth: number,\r\n\tstrokeSide: EShapeStrokeSide,\r\n\tcorner: EShapeCorner,\r\n\tantialiasWeight: number,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\ttoStep( worldSize[ 0 ], strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swc = STEP_VALUES[ 0 ];\r\n\tconst pc0 = STEP_VALUES[ 1 ];\r\n\tconst pc1 = STEP_VALUES[ 2 ];\r\n\r\n\ttoStep( worldSize[ 1 ], strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swx = STEP_VALUES[ 0 ];\r\n\tconst px0 = STEP_VALUES[ 1 ];\r\n\tconst px1 = STEP_VALUES[ 2 ];\r\n\r\n\ttoStep( worldSize[ 2 ], strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swy = STEP_VALUES[ 0 ];\r\n\tconst py0 = STEP_VALUES[ 1 ];\r\n\tconst py1 = STEP_VALUES[ 2 ];\r\n\r\n\tconst rxc = 1 - worldSize[ 0 ] / worldSize[ 1 ];\r\n\tconst ryc = 1 - worldSize[ 0 ] / worldSize[ 2 ];\r\n\r\n\tlet swt = swy;\r\n\tlet pt0 = py0;\r\n\tlet swtc = swc;\r\n\tlet ptc0 = pc0;\r\n\tif( ! (strokeSide & EShapeStrokeSide.TOP) ) {\r\n\t\tswt = 1;\r\n\t\tpt0 = py1;\r\n\t\tswtc = 1;\r\n\t\tptc0 = pc1;\r\n\t}\r\n\tlet swr = swx;\r\n\tlet pr0 = px0;\r\n\tlet swrc = swc;\r\n\tlet prc0 = pc0;\r\n\tif( ! (strokeSide & EShapeStrokeSide.RIGHT) ) {\r\n\t\tswr = 1;\r\n\t\tpr0 = px1;\r\n\t\tswrc = 1;\r\n\t\tprc0 = pc1;\r\n\t}\r\n\tlet swb = swy;\r\n\tlet pb0 = py0;\r\n\tlet swbc = swc;\r\n\tlet pbc0 = pc0;\r\n\tif( ! (strokeSide & EShapeStrokeSide.BOTTOM) ) {\r\n\t\tswb = 1;\r\n\t\tpb0 = py1;\r\n\t\tswbc = 1;\r\n\t\tpbc0 = pc1;\r\n\t}\r\n\tlet swl = swx;\r\n\tlet pl0 = px0;\r\n\tlet swlc = swc;\r\n\tlet plc0 = pc0;\r\n\tif( ! (strokeSide & EShapeStrokeSide.LEFT) ) {\r\n\t\tswl = 1;\r\n\t\tpl0 = px1;\r\n\t\tswlc = 1;\r\n\t\tplc0 = pc1;\r\n\t}\r\n\tconst plr0 = 0.5 * (pl0 + pr0);\r\n\tconst ptb0 = 0.5 * (pt0 + pb0);\r\n\r\n\t// Top-left corner\r\n\tlet is = voffset * 6;\r\n\tif( corner & EShapeCorner.TOP_LEFT ) {\r\n\t\tsteps[ is + 0 ] = swlc;\r\n\t\tsteps[ is + 1 ] = swtc;\r\n\t\tsteps[ is + 2 ] = plc0;\r\n\t\tsteps[ is + 3 ] = ptc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = 0;\r\n\t\tsteps[ is + 1 ] = swtc;\r\n\t\tsteps[ is + 2 ] = plc0;\r\n\t\tsteps[ is + 3 ] = ptc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swlc;\r\n\t\tsteps[ is + 1 ] = 0;\r\n\t\tsteps[ is + 2 ] = plc0;\r\n\t\tsteps[ is + 3 ] = ptc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = 0;\r\n\t\tsteps[ is + 1 ] = 0;\r\n\t\tsteps[ is + 2 ] = plc0;\r\n\t\tsteps[ is + 3 ] = ptc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\t} else {\r\n\t\tsteps[ is + 0 ] = swl;\r\n\t\tsteps[ is + 1 ] = swt;\r\n\t\tsteps[ is + 2 ] = pl0;\r\n\t\tsteps[ is + 3 ] = pt0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swl * rxc;\r\n\t\tsteps[ is + 1 ] = swt;\r\n\t\tsteps[ is + 2 ] = pl0;\r\n\t\tsteps[ is + 3 ] = pt0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swl;\r\n\t\tsteps[ is + 1 ] = swt * ryc;\r\n\t\tsteps[ is + 2 ] = pl0;\r\n\t\tsteps[ is + 3 ] = pt0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swl * rxc;\r\n\t\tsteps[ is + 1 ] = swt * ryc;\r\n\t\tsteps[ is + 2 ] = pl0;\r\n\t\tsteps[ is + 3 ] = pt0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\t}\r\n\r\n\t// Top-right corner\r\n\tif( corner & EShapeCorner.TOP_RIGHT ) {\r\n\t\tsteps[ is + 0 ] = 0;\r\n\t\tsteps[ is + 1 ] = swtc;\r\n\t\tsteps[ is + 2 ] = prc0;\r\n\t\tsteps[ is + 3 ] = ptc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swrc;\r\n\t\tsteps[ is + 1 ] = swtc;\r\n\t\tsteps[ is + 2 ] = prc0;\r\n\t\tsteps[ is + 3 ] = ptc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = 0;\r\n\t\tsteps[ is + 1 ] = 0;\r\n\t\tsteps[ is + 2 ] = prc0;\r\n\t\tsteps[ is + 3 ] = ptc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swrc;\r\n\t\tsteps[ is + 1 ] = 0;\r\n\t\tsteps[ is + 2 ] = prc0;\r\n\t\tsteps[ is + 3 ] = ptc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\t} else {\r\n\t\tsteps[ is + 0 ] = swr * rxc;\r\n\t\tsteps[ is + 1 ] = swt;\r\n\t\tsteps[ is + 2 ] = pr0;\r\n\t\tsteps[ is + 3 ] = pt0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swr;\r\n\t\tsteps[ is + 1 ] = swt;\r\n\t\tsteps[ is + 2 ] = pr0;\r\n\t\tsteps[ is + 3 ] = pt0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swr * rxc;\r\n\t\tsteps[ is + 1 ] = swt * ryc;\r\n\t\tsteps[ is + 2 ] = pr0;\r\n\t\tsteps[ is + 3 ] = pt0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swr;\r\n\t\tsteps[ is + 1 ] = swt * ryc;\r\n\t\tsteps[ is + 2 ] = pr0;\r\n\t\tsteps[ is + 3 ] = pt0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\t}\r\n\r\n\t// Bottom-left corner\r\n\tif( corner & EShapeCorner.BOTTOM_LEFT ) {\r\n\t\tsteps[ is + 0 ] = swlc;\r\n\t\tsteps[ is + 1 ] = 0;\r\n\t\tsteps[ is + 2 ] = plc0;\r\n\t\tsteps[ is + 3 ] = pbc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = 0;\r\n\t\tsteps[ is + 1 ] = 0;\r\n\t\tsteps[ is + 2 ] = plc0;\r\n\t\tsteps[ is + 3 ] = pbc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swlc;\r\n\t\tsteps[ is + 1 ] = swbc;\r\n\t\tsteps[ is + 2 ] = plc0;\r\n\t\tsteps[ is + 3 ] = pbc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = 0;\r\n\t\tsteps[ is + 1 ] = swbc;\r\n\t\tsteps[ is + 2 ] = plc0;\r\n\t\tsteps[ is + 3 ] = pbc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\t} else {\r\n\t\tsteps[ is + 0 ] = swl;\r\n\t\tsteps[ is + 1 ] = swb * ryc;\r\n\t\tsteps[ is + 2 ] = pl0;\r\n\t\tsteps[ is + 3 ] = pb0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swl * rxc;\r\n\t\tsteps[ is + 1 ] = swb * ryc;\r\n\t\tsteps[ is + 2 ] = pl0;\r\n\t\tsteps[ is + 3 ] = pb0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swl;\r\n\t\tsteps[ is + 1 ] = swb;\r\n\t\tsteps[ is + 2 ] = pl0;\r\n\t\tsteps[ is + 3 ] = pb0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swl * rxc;\r\n\t\tsteps[ is + 1 ] = swb;\r\n\t\tsteps[ is + 2 ] = pl0;\r\n\t\tsteps[ is + 3 ] = pb0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\t}\r\n\r\n\t// Bottom-right corner\r\n\tif( corner & EShapeCorner.BOTTOM_RIGHT ) {\r\n\t\tsteps[ is + 0 ] = 0;\r\n\t\tsteps[ is + 1 ] = 0;\r\n\t\tsteps[ is + 2 ] = prc0;\r\n\t\tsteps[ is + 3 ] = pbc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swrc;\r\n\t\tsteps[ is + 1 ] = 0;\r\n\t\tsteps[ is + 2 ] = prc0;\r\n\t\tsteps[ is + 3 ] = pbc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = 0;\r\n\t\tsteps[ is + 1 ] = swbc;\r\n\t\tsteps[ is + 2 ] = prc0;\r\n\t\tsteps[ is + 3 ] = pbc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swrc;\r\n\t\tsteps[ is + 1 ] = swbc;\r\n\t\tsteps[ is + 2 ] = prc0;\r\n\t\tsteps[ is + 3 ] = pbc0;\r\n\t\tsteps[ is + 4 ] = pc1;\r\n\t\tsteps[ is + 5 ] = pc1;\r\n\t\tis += 6;\r\n\t} else {\r\n\t\tsteps[ is + 0 ] = swr * rxc;\r\n\t\tsteps[ is + 1 ] = swb * ryc;\r\n\t\tsteps[ is + 2 ] = pr0;\r\n\t\tsteps[ is + 3 ] = pb0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swr;\r\n\t\tsteps[ is + 1 ] = swb * ryc;\r\n\t\tsteps[ is + 2 ] = pr0;\r\n\t\tsteps[ is + 3 ] = pb0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swr * rxc;\r\n\t\tsteps[ is + 1 ] = swb;\r\n\t\tsteps[ is + 2 ] = pr0;\r\n\t\tsteps[ is + 3 ] = pb0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\r\n\t\tsteps[ is + 0 ] = swr;\r\n\t\tsteps[ is + 1 ] = swb;\r\n\t\tsteps[ is + 2 ] = pr0;\r\n\t\tsteps[ is + 3 ] = pb0;\r\n\t\tsteps[ is + 4 ] = px1;\r\n\t\tsteps[ is + 5 ] = py1;\r\n\t\tis += 6;\r\n\t}\r\n\r\n\t// Top edge\r\n\tsteps[ is + 0 ] = swl * rxc;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = 0;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = plr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = swr * rxc;\r\n\tsteps[ is + 1 ] = swt;\r\n\tsteps[ is + 2 ] = plr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// Top\r\n\tsteps[ is + 0 ] = swl;\r\n\tsteps[ is + 1 ] = swt * ryc;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = swl * rxc;\r\n\tsteps[ is + 1 ] = swt * ryc;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = 0;\r\n\tsteps[ is + 1 ] = swt * ryc;\r\n\tsteps[ is + 2 ] = plr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = swr * rxc;\r\n\tsteps[ is + 1 ] = swt * ryc;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = swr;\r\n\tsteps[ is + 1 ] = swt * ryc;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pt0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// Middle\r\n\tsteps[ is + 0 ] = swl;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = ptb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = 0;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = ptb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = 0;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = ptb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = swr;\r\n\tsteps[ is + 1 ] = 0;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = ptb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// Bottom\r\n\tsteps[ is + 0 ] = swl;\r\n\tsteps[ is + 1 ] = swb * ryc;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = swl * rxc;\r\n\tsteps[ is + 1 ] = swb * ryc;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = 0;\r\n\tsteps[ is + 1 ] = swb * ryc;\r\n\tsteps[ is + 2 ] = plr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = swr * rxc;\r\n\tsteps[ is + 1 ] = swb * ryc;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = swr;\r\n\tsteps[ is + 1 ] = swb * ryc;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\t// Bottom edge\r\n\tsteps[ is + 0 ] = swl * rxc;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pl0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = 0;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = plr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n\r\n\tsteps[ is + 0 ] = swr * rxc;\r\n\tsteps[ is + 1 ] = swb;\r\n\tsteps[ is + 2 ] = pr0;\r\n\tsteps[ is + 3 ] = pb0;\r\n\tsteps[ is + 4 ] = px1;\r\n\tsteps[ is + 5 ] = py1;\r\n\tis += 6;\r\n};\r\n\r\nexport const buildRectangleRoundedUv = (\r\n\tuvs: Float32Array,\r\n\tvoffset: number,\r\n\ttextureUvs: TextureUvs,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\tconst x0 = textureUvs.x0;\r\n\tconst x1 = textureUvs.x1;\r\n\tconst x2 = textureUvs.x2;\r\n\tconst x3 = textureUvs.x3;\r\n\tconst y0 = textureUvs.y0;\r\n\tconst y1 = textureUvs.y1;\r\n\tconst y2 = textureUvs.y2;\r\n\tconst y3 = textureUvs.y3;\r\n\r\n\tconst x4 = 0.5 * (x0 + x1);\r\n\tconst y4 = 0.5 * (y0 + y1);\r\n\tconst x5 = 0.5 * (x3 + x2);\r\n\tconst y5 = 0.5 * (y3 + y2);\r\n\r\n\tconst ruvx = 0.5 * worldSize[ 0 ] / worldSize[ 1 ];\r\n\tconst ruvy = 0.5 * worldSize[ 0 ] / worldSize[ 2 ];\r\n\tconst d0x = ruvx * (x1 - x0);\r\n\tconst d0y = ruvx * (y1 - y0);\r\n\tconst d1x = ruvy * (x3 - x0);\r\n\tconst d1y = ruvy * (y3 - y0);\r\n\r\n\t// UVs\r\n\tlet iuv = voffset * 2;\r\n\r\n\t// Top-left corner\r\n\tuvs[ iuv + 0 ] = x0;\r\n\tuvs[ iuv + 1 ] = y0;\r\n\tuvs[ iuv + 2 ] = x0 + d0x;\r\n\tuvs[ iuv + 3 ] = y0 + d0y;\r\n\tuvs[ iuv + 4 ] = x0 + d1x;\r\n\tuvs[ iuv + 5 ] = y0 + d1y;\r\n\tuvs[ iuv + 6 ] = x0 + d0x + d1x;\r\n\tuvs[ iuv + 7 ] = y0 + d0y + d1y;\r\n\tiuv += 8;\r\n\r\n\t// Top-right corner\r\n\tuvs[ iuv + 0 ] = x1 - d0x;\r\n\tuvs[ iuv + 1 ] = y1 - d0y;\r\n\tuvs[ iuv + 2 ] = x1;\r\n\tuvs[ iuv + 3 ] = y1;\r\n\tuvs[ iuv + 4 ] = x1 - d0x + d1x;\r\n\tuvs[ iuv + 5 ] = y1 - d0y + d1y;\r\n\tuvs[ iuv + 6 ] = x1 + d1x;\r\n\tuvs[ iuv + 7 ] = y1 + d1y;\r\n\tiuv += 8;\r\n\r\n\t// Bottom-left corner\r\n\tuvs[ iuv + 0 ] = x3 - d1x;\r\n\tuvs[ iuv + 1 ] = y3 - d1y;\r\n\tuvs[ iuv + 2 ] = x3 + d0x - d1x;\r\n\tuvs[ iuv + 3 ] = y3 + d0y - d1y;\r\n\tuvs[ iuv + 4 ] = x3;\r\n\tuvs[ iuv + 5 ] = y3;\r\n\tuvs[ iuv + 6 ] = x3 + d0x;\r\n\tuvs[ iuv + 7 ] = y3 + d0y;\r\n\tiuv += 8;\r\n\r\n\t// Bottom-right corner\r\n\tuvs[ iuv + 0 ] = x2 - d0x - d1x;\r\n\tuvs[ iuv + 1 ] = y2 - d0y - d1y;\r\n\tuvs[ iuv + 2 ] = x2 - d1x;\r\n\tuvs[ iuv + 3 ] = y2 - d1y;\r\n\tuvs[ iuv + 4 ] = x2 - d0x;\r\n\tuvs[ iuv + 5 ] = y2 - d0y;\r\n\tuvs[ iuv + 6 ] = x2;\r\n\tuvs[ iuv + 7 ] = y2;\r\n\tiuv += 8;\r\n\r\n\t// Top edge\r\n\tuvs[ iuv + 0 ] = x0 + d0x;\r\n\tuvs[ iuv + 1 ] = y0 + d0y;\r\n\tuvs[ iuv + 2 ] = x4;\r\n\tuvs[ iuv + 3 ] = y4;\r\n\tuvs[ iuv + 4 ] = x1 - d0x;\r\n\tuvs[ iuv + 5 ] = y1 - d0y;\r\n\tiuv += 6;\r\n\r\n\t// Top\r\n\tuvs[ iuv + 0 ] = x0 + d1x;\r\n\tuvs[ iuv + 1 ] = y0 + d1y;\r\n\tuvs[ iuv + 2 ] = x0 + d1x + d0x;\r\n\tuvs[ iuv + 3 ] = y0 + d1y + d0y;\r\n\tuvs[ iuv + 4 ] = x4 + d1x;\r\n\tuvs[ iuv + 5 ] = y4 + d1y;\r\n\tuvs[ iuv + 6 ] = x1 + d1x - d0x;\r\n\tuvs[ iuv + 7 ] = y1 + d1y - d0y;\r\n\tuvs[ iuv + 8 ] = x1 + d1x;\r\n\tuvs[ iuv + 9 ] = y1 + d1y;\r\n\tiuv += 10;\r\n\r\n\t// Middle\r\n\tconst x02 = 0.5 * (x0 + x2);\r\n\tconst y02 = 0.5 * (y0 + y2);\r\n\tuvs[ iuv + 0 ] = 0.5 * (x0 + x3);\r\n\tuvs[ iuv + 1 ] = 0.5 * (y0 + y3);\r\n\tuvs[ iuv + 2 ] = x02;\r\n\tuvs[ iuv + 3 ] = y02;\r\n\tuvs[ iuv + 4 ] = x02;\r\n\tuvs[ iuv + 5 ] = y02;\r\n\tuvs[ iuv + 6 ] = 0.5 * (x1 + x2);\r\n\tuvs[ iuv + 7 ] = 0.5 * (y1 + y2);\r\n\tiuv += 8;\r\n\r\n\t// Bottom\r\n\tuvs[ iuv + 0 ] = x3 - d1x;\r\n\tuvs[ iuv + 1 ] = y3 - d1y;\r\n\tuvs[ iuv + 2 ] = x3 - d1x + d0x;\r\n\tuvs[ iuv + 3 ] = y3 - d1y + d0y;\r\n\tuvs[ iuv + 4 ] = x5 - d1x;\r\n\tuvs[ iuv + 5 ] = y5 - d1y;\r\n\tuvs[ iuv + 6 ] = x2 - d1x - d0x;\r\n\tuvs[ iuv + 7 ] = y2 - d1y - d0y;\r\n\tuvs[ iuv + 8 ] = x2 - d1x;\r\n\tuvs[ iuv + 9 ] = y2 - d1y;\r\n\tiuv += 10;\r\n\r\n\t// Bottom edge\r\n\tuvs[ iuv + 0 ] = x3 + d0x;\r\n\tuvs[ iuv + 1 ] = y3 + d0y;\r\n\tuvs[ iuv + 2 ] = x5;\r\n\tuvs[ iuv + 3 ] = y5;\r\n\tuvs[ iuv + 4 ] = x2 - d0x;\r\n\tuvs[ iuv + 5 ] = y2 - d0y;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { buildNullClipping, buildNullStep, buildNullUv, buildNullVertex } from \"./build-null\";\r\nimport {\r\n\tbuildRectangleRoundedClipping, buildRectangleRoundedIndex, buildRectangleRoundedStep, buildRectangleRoundedUv,\r\n\tbuildRectangleRoundedVertex, RECTANGLE_ROUNDED_INDEX_COUNT, RECTANGLE_ROUNDED_VERTEX_COUNT,\r\n\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n} from \"./build-rectangle-rounded\";\r\nimport { copyClipping } from \"./copy-clipping\";\r\nimport { copyIndex } from \"./copy-index\";\r\nimport { copyStep } from \"./copy-step\";\r\nimport { copyUvs } from \"./copy-uv\";\r\nimport { copyVertex } from \"./copy-vertex\";\r\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { EShapeLineOfAnyUploaded } from \"./e-shape-line-of-any-uploaded\";\r\n\r\nexport class EShapeLineOfRectangleRoundedsUploaded extends EShapeLineOfAnyUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateIndices();\r\n\t\tconst indices = buffer.indices;\r\n\t\tconst voffset = this.vertexOffset;\r\n\t\tconst ioffset = this.indexOffset;\r\n\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\tif( 0 < pointCountReserved ) {\r\n\t\t\tbuildRectangleRoundedIndex(\r\n\t\t\t\tindices,\r\n\t\t\t\tvoffset,\r\n\t\t\t\tioffset\r\n\t\t\t);\r\n\t\t\tcopyIndex(\r\n\t\t\t\tindices,\r\n\t\t\t\tRECTANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\tioffset,\r\n\t\t\t\tRECTANGLE_ROUNDED_INDEX_COUNT,\r\n\t\t\t\tpointCountReserved\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tconst points = shape.points;\r\n\t\tif( points instanceof EShapeLineOfAnyPointsImpl ) {\r\n\t\t\tthis.updateVertexClippingStepAndUv( buffer, shape, points );\r\n\t\t\tthis.updateLineOfAnyColorFill( buffer, shape, points, RECTANGLE_ROUNDED_VERTEX_COUNT );\r\n\t\t\tthis.updateLineOfAnyColorStroke( buffer, shape, points, RECTANGLE_ROUNDED_VERTEX_COUNT );\r\n\t\t\tthis.updateText( buffer, shape );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateVertexClippingStepAndUv(\r\n\t\tbuffer: EShapeBuffer,\r\n\t\tshape: EShape,\r\n\t\tpoints: EShapeLineOfAnyPoints\r\n\t): void {\r\n\t\tconst pointId = points.id;\r\n\t\tconst pointOffset = points.offset;\r\n\t\tconst pointOffsetId = pointOffset.id;\r\n\t\tconst isPointChanged = ( pointId !== this.pointId || pointOffsetId !== this.pointOffsetId );\r\n\r\n\t\tconst pointSize = points.size;\r\n\t\tconst pointSizeId = pointSize.id;\r\n\t\tconst isPointSizeChanged = ( pointSizeId !== this.pointSizeId );\r\n\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst radius = shape.radius;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY || radius !== this.radius );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst strokeSide = stroke.side;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign ||\r\n\t\t\tthis.strokeWidth !== strokeWidth || this.strokeSide !== strokeSide );\r\n\r\n\t\tconst corner = shape.corner;\r\n\t\tconst isCornerChanged = ( corner !== this.corner );\r\n\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tconst isTextureChanged = ( texture !== this.texture || textureTransformId !== this.textureTransformId );\r\n\r\n\t\tconst isVertexChanged = isPointChanged || isPointSizeChanged || isSizeChanged || isStrokeChanged;\r\n\r\n\t\tif( isVertexChanged || isTransformChanged || isCornerChanged || isTextureChanged ) {\r\n\t\t\tthis.pointId = pointId;\r\n\t\t\tthis.pointCount = points.length;\r\n\t\t\tthis.pointOffsetId = pointOffsetId;\r\n\t\t\tthis.pointSizeId = pointSizeId;\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.radius = radius;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\t\t\tthis.strokeSide = strokeSide;\r\n\t\t\tthis.corner = corner;\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tif( isSizeChanged || isTransformChanged || isStrokeChanged ) {\r\n\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t}\r\n\r\n\t\t\t// Buffer\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t}\r\n\t\t\tif( isVertexChanged || isCornerChanged ) {\r\n\t\t\t\tbuffer.updateClippings();\r\n\t\t\t}\r\n\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\tbuffer.updateUvs();\r\n\t\t\t}\r\n\t\t\tconst pointCount = this.pointCount;\r\n\t\t\tconst pointsValues = points.values;\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\t\t\tconst vertices = buffer.vertices;\r\n\t\t\tconst clippings = buffer.clippings;\r\n\t\t\tconst steps = buffer.steps;\r\n\t\t\tconst uvs = buffer.uvs;\r\n\t\t\tconst internalTransform = shape.transform.internalTransform;\r\n\t\t\tconst textureUvs = this.toTextureUvs( texture );\r\n\t\t\tconst antialiasWeight = this.antialiasWeight;\r\n\t\t\tif( 0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY() ) {\r\n\t\t\t\tconst pointSizeX = pointSize.getX( 0 );\r\n\t\t\t\tconst pointSizeY = pointSize.getY( 0 );\r\n\r\n\t\t\t\t// Vertices\r\n\t\t\t\tbuildRectangleRoundedVertex(\r\n\t\t\t\t\tvertices, voffset,\r\n\t\t\t\t\t0, 0,\r\n\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\tstrokeAlign, strokeWidth, radius,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t\tcopyVertex(\r\n\t\t\t\t\tvertices,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tvoffset, RECTANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\t\tpointCount, pointsValues,\r\n\t\t\t\t\tpointOffset\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Steps\r\n\t\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\t\tbuildRectangleRoundedStep(\r\n\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tstrokeWidth, strokeSide,\r\n\t\t\t\t\t\tcorner,\r\n\t\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyStep(\r\n\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\tvoffset, RECTANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Clippings\r\n\t\t\t\tif( isVertexChanged || isCornerChanged ) {\r\n\t\t\t\t\tbuildRectangleRoundedClipping(\r\n\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tcorner,\r\n\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyClipping(\r\n\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tRECTANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// UVs\r\n\t\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\t\tbuildRectangleRoundedUv(\r\n\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\ttextureUvs,\r\n\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyUvs(\r\n\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tRECTANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0; i < pointCount; ++i ) {\r\n\t\t\t\t\tconst ip = i << 1;\r\n\t\t\t\t\tconst px = pointsValues[ ip     ] + pointOffset.getX( i );\r\n\t\t\t\t\tconst py = pointsValues[ ip + 1 ] + pointOffset.getY( i );\r\n\t\t\t\t\tconst pointSizeX = pointSize.getX( i );\r\n\t\t\t\t\tconst pointSizeY = pointSize.getY( i );\r\n\r\n\t\t\t\t\tconst iv = voffset + i * RECTANGLE_ROUNDED_VERTEX_COUNT;\r\n\r\n\t\t\t\t\t// Vertices\r\n\t\t\t\t\tbuildRectangleRoundedVertex(\r\n\t\t\t\t\t\tvertices, iv,\r\n\t\t\t\t\t\tpx, py,\r\n\t\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\t\tstrokeAlign, strokeWidth, radius,\r\n\t\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Steps\r\n\t\t\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\t\t\tbuildRectangleRoundedStep(\r\n\t\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\tstrokeWidth, strokeSide,\r\n\t\t\t\t\t\t\tcorner,\r\n\t\t\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Clippings\r\n\t\t\t\t\tif( isVertexChanged || isCornerChanged ) {\r\n\t\t\t\t\t\tbuildRectangleRoundedClipping(\r\n\t\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\tcorner,\r\n\t\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// UVs\r\n\t\t\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\t\t\tbuildRectangleRoundedUv(\r\n\t\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\ttextureUvs,\r\n\t\t\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Fill the rest\r\n\t\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\t\tconst voffsetReserved = voffset + pointCount * RECTANGLE_ROUNDED_VERTEX_COUNT;\r\n\t\t\tconst vcountReserved = RECTANGLE_ROUNDED_VERTEX_COUNT * (pointCountReserved - pointCount);\r\n\t\t\tbuildNullVertex(\r\n\t\t\t\tvertices,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullStep(\r\n\t\t\t\tsteps,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullClipping(\r\n\t\t\t\tclippings,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullUv(\r\n\t\t\t\tuvs,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { RECTANGLE_ROUNDED_INDEX_COUNT, RECTANGLE_ROUNDED_VERTEX_COUNT } from \"./build-rectangle-rounded\";\r\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\r\nimport { EShapeLineOfRectangleRoundedsUploaded } from \"./e-shape-line-of-rectangle-roundeds-uploaded\";\r\n\r\nexport const createLineOfRectangleRoundedsUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeLineOfRectangleRoundedsUploaded | null => {\r\n\treturn createLineOfAnyUploaded(\r\n\t\tbuffer, shape,\r\n\t\tvoffset, RECTANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\tioffset, RECTANGLE_ROUNDED_INDEX_COUNT,\r\n\t\tantialiasWeight,\r\n\t\tEShapeLineOfRectangleRoundedsUploaded\r\n\t);\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeCorner } from \"../e-shape-corner\";\r\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapePrimitive } from \"./e-shape-primitive\";\r\n\r\nexport class EShapeRectangleRounded extends EShapePrimitive {\r\n\tconstructor( type = EShapeType.RECTANGLE_ROUNDED ) {\r\n\t\tsuper( type );\r\n\t}\r\n\r\n\tclone(): EShapeRectangleRounded {\r\n\t\treturn new EShapeRectangleRounded().copy( this );\r\n\t}\r\n\r\n\tprivate containsAbs_( x: number, y: number, ax: number, ay: number, r: number, corner: EShapeCorner ): boolean {\r\n\t\tconst bx0 = -ax + r;\r\n\t\tif( x <= bx0 ) {\r\n\t\t\tconst by0 = -ay + r;\r\n\t\t\tif( y <= by0 && (corner & EShapeCorner.TOP_LEFT) ) {\r\n\t\t\t\t// Top-left corner\r\n\t\t\t\tconst dx = x - bx0;\r\n\t\t\t\tconst dy = y - by0;\r\n\t\t\t\treturn dx * dx + dy * dy <= r * r;\r\n\t\t\t} else {\r\n\t\t\t\tconst by1 = +ay - r;\r\n\t\t\t\tif( by1 <= y && (corner & EShapeCorner.BOTTOM_LEFT) ) {\r\n\t\t\t\t\t// Bottom-left corner\r\n\t\t\t\t\tconst dx = x - bx0;\r\n\t\t\t\t\tconst dy = y - by1;\r\n\t\t\t\t\treturn dx * dx + dy * dy <= r * r;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Middle-left box\r\n\t\t\t\t\treturn -ax <= x;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst bx1 = +ax - r;\r\n\t\t\tif( bx1 <= x ) {\r\n\t\t\t\tconst by0 = -ay + r;\r\n\t\t\t\tif( y <= by0 && (corner & EShapeCorner.TOP_RIGHT) ) {\r\n\t\t\t\t\t// Top-right corner\r\n\t\t\t\t\tconst dx = x - bx1;\r\n\t\t\t\t\tconst dy = y - by0;\r\n\t\t\t\t\treturn dx * dx + dy * dy <= r * r;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst by1 = +ay - r;\r\n\t\t\t\t\tif( by1 <= y && (corner & EShapeCorner.BOTTOM_RIGHT) ) {\r\n\t\t\t\t\t\t// Bottom-right corner\r\n\t\t\t\t\t\tconst dx = x - bx1;\r\n\t\t\t\t\t\tconst dy = y - by1;\r\n\t\t\t\t\t\treturn dx * dx + dy * dy <= r * r;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Middle-right box\r\n\t\t\t\t\t\treturn x <= +ax;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn -ay <= y && y <= +ay;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tif( super.containsAbsBBox( x, y, ax, ay ) ) {\r\n\t\t\tconst fill = this.fill;\r\n\t\t\tconst stroke = this.stroke;\r\n\t\t\tconst strokeWidth = ( stroke.enable ? stroke.width : 0 );\r\n\t\t\tif( fill.enable || 0 < strokeWidth ) {\r\n\t\t\t\tconst r = this.radius * Math.min( ax, ay );\r\n\t\t\t\tconst corner = this.corner;\r\n\t\t\t\tconst strokeSide = stroke.side;\r\n\t\t\t\tif( this.containsAbs_( x, y, ax, ay, r, corner ) ) {\r\n\t\t\t\t\tif( fill.enable ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst wx = Math.max( 0.0, ax - strokeWidth );\r\n\t\t\t\t\t\tconst wy = Math.max( 0.0, ay - strokeWidth );\r\n\t\t\t\t\t\tconst wr = Math.max( 0.0, r - strokeWidth );\r\n\t\t\t\t\t\tif( ! this.containsAbs_( x, y, wx, wy, wr, corner ) ) {\r\n\t\t\t\t\t\t\tif( strokeSide === EShapeStrokeSide.ALL ) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif( x <= -wx + wr ) {\r\n\t\t\t\t\t\t\t\t\tconst hasLeftSide = ( strokeSide & EShapeStrokeSide.LEFT ) !== 0;\r\n\t\t\t\t\t\t\t\t\tif( y <= -wy + wr ) {\r\n\t\t\t\t\t\t\t\t\t\tconst hasTopSide = ( strokeSide & EShapeStrokeSide.TOP );\r\n\t\t\t\t\t\t\t\t\t\tif( hasTopSide && hasLeftSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t\t} else if( hasTopSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn -wx <= y;\r\n\t\t\t\t\t\t\t\t\t\t} else if( hasLeftSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn x <= -wx;\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else if( +wy - wr <= y ) {\r\n\t\t\t\t\t\t\t\t\t\tconst hasBottomSide = ( strokeSide & EShapeStrokeSide.BOTTOM );\r\n\t\t\t\t\t\t\t\t\t\tif( hasBottomSide && hasLeftSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t\t} else if( hasBottomSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn +wx <= y;\r\n\t\t\t\t\t\t\t\t\t\t} else if( hasLeftSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn x <= -wx;\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\treturn hasLeftSide;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else if( +wx - wr <= x ) {\r\n\t\t\t\t\t\t\t\t\tconst hasRightSide = ( strokeSide & EShapeStrokeSide.RIGHT ) !== 0;\r\n\t\t\t\t\t\t\t\t\tif( y <= -wy + wr ) {\r\n\t\t\t\t\t\t\t\t\t\tconst hasTopSide = ( strokeSide & EShapeStrokeSide.TOP );\r\n\t\t\t\t\t\t\t\t\t\tif( hasTopSide && hasRightSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t\t} else if( hasTopSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn -wx <= y;\r\n\t\t\t\t\t\t\t\t\t\t} else if( hasRightSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn +wx <= x;\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else if( +wy - wr <= y ) {\r\n\t\t\t\t\t\t\t\t\t\tconst hasBottomSide = ( strokeSide & EShapeStrokeSide.BOTTOM );\r\n\t\t\t\t\t\t\t\t\t\tif( hasBottomSide && hasRightSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t\t\t\t} else if( hasBottomSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn +wx <= y;\r\n\t\t\t\t\t\t\t\t\t\t} else if( hasRightSide ) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn +wx <= x;\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\treturn hasRightSide;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tif( y <= -wy + wr ) {\r\n\t\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.TOP ) !== 0;\r\n\t\t\t\t\t\t\t\t\t} else if( +wy - wr <= y ) {\r\n\t\t\t\t\t\t\t\t\t\treturn ( strokeSide & EShapeStrokeSide.BOTTOM ) !== 0;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeBase } from \"./e-shape-base\";\r\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\r\nimport {\r\n\tEShapeLineOfAnyPoints, EShapeLineOfAnyPointsHitTester,\r\n\tEShapeLineOfAnyPointsTestRange, EShapeLineOfAnyPointsToHitThreshold\r\n} from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { EShapeRectangleRounded } from \"./e-shape-rectangle-rounded\";\r\nimport { toHitThreshold } from \"./to-hit-threshold\";\r\n\r\nexport class EShapeLineOfRectangleRoundeds extends EShapeRectangleRounded implements EShapeLineOfAny {\r\n\tpoints!: EShapeLineOfAnyPoints;\r\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\tprotected _testerBBox: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\r\n\tconstructor( other?: EShapeLineOfRectangleRoundeds ) {\r\n\t\tsuper( EShapeType.LINE_OF_RECTANGLE_ROUNDEDS );\r\n\t\tif( other ) {\r\n\t\t\tthis.copy( other );\r\n\t\t} else {\r\n\t\t\tthis.points = new EShapeLineOfAnyPointsImpl( this );\r\n\t\t}\r\n\r\n\t\tthis._tester = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbs( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\r\n\t\tthis._testerBBox = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbsBBox( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\t}\r\n\r\n\tclone(): EShapeLineOfRectangleRoundeds {\r\n\t\treturn new EShapeLineOfRectangleRoundeds( this );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tconst threshold = toHitThreshold( this, null );\r\n\t\tif( this.containsAbsBBox( x, y, ax + threshold, ay + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\tx, y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\tnull,\r\n\t\t\t\tthis._tester,\r\n\t\t\t\tnull\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontainsPointAbs(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbs( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcontainsPointAbsBBox(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbsBBox( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcalcHitPoint<RESULT>(\r\n\t\tpoint: IPoint,\r\n\t\ttoThreshold: EShapeLineOfAnyPointsToHitThreshold | null,\r\n\t\trange: EShapeLineOfAnyPointsTestRange | null,\r\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\r\n\t\tresult: RESULT\r\n\t): boolean {\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\tconst threshold = toHitThreshold( this, toThreshold );\r\n\t\tif( this.containsAbsBBox( rect.x, rect.y, rect.width + threshold, rect.height + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\trect.x, rect.y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\trange,\r\n\t\t\t\ttester || this._tester,\r\n\t\t\t\tresult\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeLineOfRectangleRoundeds } from \"./e-shape-line-of-rectangle-roundeds\";\r\n\r\nexport const deserializeLineOfRectangleRoundeds = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeLineOfRectangleRoundeds> | EShapeLineOfRectangleRoundeds => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeLineOfRectangleRoundeds() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\r\nimport { EShapeCapability } from \"../e-shape-capability\";\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createLineOfRectangleRoundedsUploaded } from \"../variant/create-line-of-rectangle-roundeds-uploaded\";\r\nimport { deserializeLineOfRectangleRoundeds } from \"../variant/deserialize-line-of-rectangle-roundeds\";\r\n\r\nexport const loadShapeLineOfRectangleRoundeds = () => {\r\n\tEShapeUploadeds[ EShapeType.LINE_OF_RECTANGLE_ROUNDEDS ] = createLineOfRectangleRoundedsUploaded;\r\n\tEShapeDeserializers[ EShapeType.LINE_OF_RECTANGLE_ROUNDEDS ] = deserializeLineOfRectangleRoundeds;\r\n\tEShapeCapabilities.set(\r\n\t\tEShapeType.LINE_OF_RECTANGLE_ROUNDEDS,\r\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE | EShapeCapability.BORDER_RADIUS\r\n\t);\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { buildNullClipping, buildNullStep, buildNullUv, buildNullVertex } from \"./build-null\";\r\nimport {\r\n\tbuildRectangleClipping, buildRectangleIndex, buildRectangleStep,\r\n\tbuildRectangleUv, buildRectangleVertex,\r\n\tRECTANGLE_INDEX_COUNT, RECTANGLE_VERTEX_COUNT, RECTANGLE_WORLD_SIZE\r\n} from \"./build-rectangle\";\r\nimport { copyClipping } from \"./copy-clipping\";\r\nimport { copyIndex } from \"./copy-index\";\r\nimport { copyStep } from \"./copy-step\";\r\nimport { copyUvs } from \"./copy-uv\";\r\nimport { copyVertex } from \"./copy-vertex\";\r\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { EShapeLineOfAnyUploaded } from \"./e-shape-line-of-any-uploaded\";\r\n\r\nexport class EShapeLineOfRectanglesUploaded extends EShapeLineOfAnyUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateIndices();\r\n\t\tconst indices = buffer.indices;\r\n\t\tconst voffset = this.vertexOffset;\r\n\t\tconst ioffset = this.indexOffset;\r\n\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\tif( 0 < pointCountReserved ) {\r\n\t\t\tbuildRectangleIndex(\r\n\t\t\t\tindices,\r\n\t\t\t\tvoffset,\r\n\t\t\t\tioffset\r\n\t\t\t);\r\n\t\t\tcopyIndex(\r\n\t\t\t\tindices,\r\n\t\t\t\tRECTANGLE_VERTEX_COUNT,\r\n\t\t\t\tioffset,\r\n\t\t\t\tRECTANGLE_INDEX_COUNT,\r\n\t\t\t\tpointCountReserved\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tconst points = shape.points;\r\n\t\tif( points instanceof EShapeLineOfAnyPointsImpl ) {\r\n\t\t\tthis.updateVertexClippingStepAndUv( buffer, shape, points );\r\n\t\t\tthis.updateLineOfAnyColorFill( buffer, shape, points, RECTANGLE_VERTEX_COUNT );\r\n\t\t\tthis.updateLineOfAnyColorStroke( buffer, shape, points, RECTANGLE_VERTEX_COUNT );\r\n\t\t\tthis.updateText( buffer, shape );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateVertexClippingStepAndUv( buffer: EShapeBuffer, shape: EShape, points: EShapeLineOfAnyPoints ) {\r\n\t\tconst pointId = points.id;\r\n\t\tconst pointOffset = points.offset;\r\n\t\tconst pointOffsetId = pointOffset.id;\r\n\t\tconst isPointChanged = ( pointId !== this.pointId || pointOffsetId !== this.pointOffsetId );\r\n\r\n\t\tconst pointSize = points.size;\r\n\t\tconst pointSizeId = pointSize.id;\r\n\t\tconst isPointSizeChanged = ( pointSizeId !== this.pointSizeId );\r\n\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst strokeSide = stroke.side;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign ||\r\n\t\t\tthis.strokeWidth !== strokeWidth || this.strokeSide !== strokeSide );\r\n\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tconst isTextureChanged = ( texture !== this.texture || textureTransformId !== this.textureTransformId );\r\n\r\n\t\tconst isVertexChanged = isPointChanged || isPointSizeChanged || isSizeChanged || isStrokeChanged;\r\n\r\n\t\tif( isVertexChanged || isTransformChanged || isTextureChanged ) {\r\n\t\t\tthis.pointId = pointId;\r\n\t\t\tthis.pointCount = points.length;\r\n\t\t\tthis.pointOffsetId = pointOffsetId;\r\n\t\t\tthis.pointSizeId = pointSizeId;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\t\t\tthis.strokeSide = strokeSide;\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tif( isSizeChanged || isTransformChanged || isStrokeChanged ) {\r\n\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t}\r\n\r\n\t\t\t// Buffer\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t}\r\n\t\t\tif( isVertexChanged ) {\r\n\t\t\t\tbuffer.updateClippings();\r\n\t\t\t}\r\n\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\tbuffer.updateUvs();\r\n\t\t\t}\r\n\t\t\tconst pointCount = this.pointCount;\r\n\t\t\tconst pointsValues = points.values;\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\t\t\tconst vertices = buffer.vertices;\r\n\t\t\tconst clippings = buffer.clippings;\r\n\t\t\tconst steps = buffer.steps;\r\n\t\t\tconst uvs = buffer.uvs;\r\n\t\t\tconst internalTransform = shape.transform.internalTransform;\r\n\t\t\tconst antialiasWeight = this.antialiasWeight;\r\n\t\t\tconst textureUvs = this.toTextureUvs( texture );\r\n\t\t\tif( 0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY() ) {\r\n\t\t\t\tconst pointSizeX = pointSize.getX( 0 );\r\n\t\t\t\tconst pointSizeY = pointSize.getY( 0 );\r\n\r\n\t\t\t\t// Vertices\r\n\t\t\t\tbuildRectangleVertex(\r\n\t\t\t\t\tvertices, voffset,\r\n\t\t\t\t\t0, 0,\r\n\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\tstrokeAlign, strokeWidth,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t\tcopyVertex(\r\n\t\t\t\t\tvertices,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tvoffset, RECTANGLE_VERTEX_COUNT,\r\n\t\t\t\t\tpointCount, pointsValues,\r\n\t\t\t\t\tpointOffset\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Steps\r\n\t\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\t\tbuildRectangleStep(\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\tstrokeWidth, strokeSide,\r\n\t\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyStep(\r\n\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\tvoffset, RECTANGLE_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Clippings\r\n\t\t\t\tif( isVertexChanged ) {\r\n\t\t\t\t\tbuildRectangleClipping(\r\n\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyClipping(\r\n\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\tvoffset, RECTANGLE_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// UVs\r\n\t\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\t\tbuildRectangleUv(\r\n\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\ttextureUvs,\r\n\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyUvs(\r\n\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\tvoffset, RECTANGLE_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0; i < pointCount; ++i ) {\r\n\t\t\t\t\tconst ip = i << 1;\r\n\t\t\t\t\tconst px = pointsValues[ ip     ] + pointOffset.getX( i );\r\n\t\t\t\t\tconst py = pointsValues[ ip + 1 ] + pointOffset.getY( i );\r\n\t\t\t\t\tconst pointSizeX = pointSize.getX( i );\r\n\t\t\t\t\tconst pointSizeY = pointSize.getY( i );\r\n\t\t\t\t\tconst iv = voffset + i * RECTANGLE_VERTEX_COUNT;\r\n\r\n\t\t\t\t\t// Vertices\r\n\t\t\t\t\tbuildRectangleVertex(\r\n\t\t\t\t\t\tvertices, iv,\r\n\t\t\t\t\t\tpx, py,\r\n\t\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\t\tstrokeAlign, strokeWidth,\r\n\t\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Steps\r\n\t\t\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\t\t\tbuildRectangleStep(\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\t\tstrokeWidth, strokeSide,\r\n\t\t\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Clippings\r\n\t\t\t\t\tif( isVertexChanged ) {\r\n\t\t\t\t\t\tbuildRectangleClipping(\r\n\t\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// UVs\r\n\t\t\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\t\t\tbuildRectangleUv(\r\n\t\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\ttextureUvs,\r\n\t\t\t\t\t\t\tRECTANGLE_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Fill the rest\r\n\t\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\t\tconst voffsetReserved = voffset + pointCount * RECTANGLE_VERTEX_COUNT;\r\n\t\t\tconst vcountReserved = RECTANGLE_VERTEX_COUNT * (pointCountReserved - pointCount);\r\n\t\t\tbuildNullVertex(\r\n\t\t\t\tvertices,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullStep(\r\n\t\t\t\tsteps,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullClipping(\r\n\t\t\t\tclippings,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullUv(\r\n\t\t\t\tuvs,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { RECTANGLE_INDEX_COUNT, RECTANGLE_VERTEX_COUNT } from \"./build-rectangle\";\r\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\r\nimport { EShapeLineOfRectanglesUploaded } from \"./e-shape-line-of-rectangles-uploaded\";\r\n\r\nexport const createLineOfRectanglesUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeLineOfRectanglesUploaded | null => {\r\n\treturn createLineOfAnyUploaded(\r\n\t\tbuffer, shape,\r\n\t\tvoffset, RECTANGLE_VERTEX_COUNT,\r\n\t\tioffset, RECTANGLE_INDEX_COUNT,\r\n\t\tantialiasWeight,\r\n\t\tEShapeLineOfRectanglesUploaded\r\n\t);\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeBase } from \"./e-shape-base\";\r\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\r\nimport {\r\n\tEShapeLineOfAnyPoints, EShapeLineOfAnyPointsHitTester,\r\n\tEShapeLineOfAnyPointsTestRange, EShapeLineOfAnyPointsToHitThreshold\r\n} from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { EShapeRectangle } from \"./e-shape-rectangle\";\r\nimport { toHitThreshold } from \"./to-hit-threshold\";\r\n\r\nexport class EShapeLineOfRectangles extends EShapeRectangle implements EShapeLineOfAny {\r\n\tpoints!: EShapeLineOfAnyPoints;\r\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\tprotected _testerBBox: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\r\n\tconstructor( other?: EShapeLineOfRectangles ) {\r\n\t\tsuper( EShapeType.LINE_OF_RECTANGLES );\r\n\t\tif( other ) {\r\n\t\t\tthis.copy( other );\r\n\t\t} else {\r\n\t\t\tthis.points = new EShapeLineOfAnyPointsImpl( this );\r\n\t\t}\r\n\r\n\t\tthis._tester = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbs( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\r\n\t\tthis._testerBBox = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbsBBox( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\t}\r\n\r\n\tclone(): EShapeLineOfRectangles {\r\n\t\treturn new EShapeLineOfRectangles( this );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tconst threshold = toHitThreshold( this, null );\r\n\t\tif( this.containsAbsBBox( x, y, ax + threshold, ay + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\tx, y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\tnull,\r\n\t\t\t\tthis._tester,\r\n\t\t\t\tnull\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontainsPointAbs(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbs( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcontainsPointAbsBBox(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbsBBox( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcalcHitPoint<RESULT>(\r\n\t\tpoint: IPoint,\r\n\t\ttoThreshold: EShapeLineOfAnyPointsToHitThreshold | null,\r\n\t\trange: EShapeLineOfAnyPointsTestRange | null,\r\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\r\n\t\tresult: RESULT\r\n\t): boolean {\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\tconst threshold = toHitThreshold( this, toThreshold );\r\n\t\tif( this.containsAbsBBox( rect.x, rect.y, rect.width + threshold, rect.height + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\trect.x, rect.y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\trange,\r\n\t\t\t\ttester || this._tester,\r\n\t\t\t\tresult\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeLineOfRectangles } from \"./e-shape-line-of-rectangles\";\r\n\r\nexport const deserializeLineOfRectangles = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeLineOfRectangles> | EShapeLineOfRectangles => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeLineOfRectangles() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\r\nimport { EShapeCapability } from \"../e-shape-capability\";\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createLineOfRectanglesUploaded } from \"../variant/create-line-of-rectangles-uploaded\";\r\nimport { deserializeLineOfRectangles } from \"../variant/deserialize-line-of-rectangles\";\r\n\r\nexport const loadShapeLineOfRectangles = () => {\r\n\tEShapeUploadeds[ EShapeType.LINE_OF_RECTANGLES ] = createLineOfRectanglesUploaded;\r\n\tEShapeDeserializers[ EShapeType.LINE_OF_RECTANGLES ] = deserializeLineOfRectangles;\r\n\tEShapeCapabilities.set(\r\n\t\tEShapeType.LINE_OF_RECTANGLES,\r\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE\r\n\t);\r\n};\r\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\r\nimport { EShapeCorner } from \"../e-shape-corner\";\r\nimport { toLength } from \"./to-length\";\r\nimport { STEP_VALUES, toStep } from \"./to-step\";\r\n\r\nexport const TRIANGLE_ROUNDED_VERTEX_COUNT = 22;\r\nexport const TRIANGLE_ROUNDED_INDEX_COUNT = 15;\r\nexport const TRIANGLE_ROUNDED_WORLD_SIZE: [ number, number, number, number, number ] = [ 0, 0, 0, 0, 0 ];\r\nconst TRIANGLE_ROUNDED_WORK_POINT: Point = new Point();\r\n\r\nexport const buildTriangleRoundedIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number\r\n): void => {\r\n\t// Top corner\r\n\tconst ii = ioffset * 3;\r\n\tindices[ ii +  0 ] = voffset + 0;\r\n\tindices[ ii +  1 ] = voffset + 1;\r\n\tindices[ ii +  2 ] = voffset + 3;\r\n\r\n\tindices[ ii +  3 ] = voffset + 1;\r\n\tindices[ ii +  4 ] = voffset + 2;\r\n\tindices[ ii +  5 ] = voffset + 3;\r\n\r\n\t// Bottom-right corner\r\n\tindices[ ii +  6 ] = voffset + 4;\r\n\tindices[ ii +  7 ] = voffset + 5;\r\n\tindices[ ii +  8 ] = voffset + 7;\r\n\r\n\tindices[ ii +  9 ] = voffset + 5;\r\n\tindices[ ii + 10 ] = voffset + 6;\r\n\tindices[ ii + 11 ] = voffset + 7;\r\n\r\n\t// Bottom-left corner\r\n\tindices[ ii + 12 ] = voffset + 8;\r\n\tindices[ ii + 13 ] = voffset + 9;\r\n\tindices[ ii + 14 ] = voffset + 11;\r\n\r\n\tindices[ ii + 15 ] = voffset + 9;\r\n\tindices[ ii + 16 ] = voffset + 10;\r\n\tindices[ ii + 17 ] = voffset + 11;\r\n\r\n\t// Others\r\n\tindices[ ii + 18 ] = voffset + 12;\r\n\tindices[ ii + 19 ] = voffset + 13;\r\n\tindices[ ii + 20 ] = voffset + 16;\r\n\r\n\tindices[ ii + 21 ] = voffset + 13;\r\n\tindices[ ii + 22 ] = voffset + 14;\r\n\tindices[ ii + 23 ] = voffset + 16;\r\n\r\n\tindices[ ii + 24 ] = voffset + 14;\r\n\tindices[ ii + 25 ] = voffset + 15;\r\n\tindices[ ii + 26 ] = voffset + 16;\r\n\r\n\t//\r\n\tindices[ ii + 27 ] = voffset + 12;\r\n\tindices[ ii + 28 ] = voffset + 16;\r\n\tindices[ ii + 29 ] = voffset + 19;\r\n\r\n\tindices[ ii + 30 ] = voffset + 16;\r\n\tindices[ ii + 31 ] = voffset + 17;\r\n\tindices[ ii + 32 ] = voffset + 19;\r\n\r\n\tindices[ ii + 33 ] = voffset + 17;\r\n\tindices[ ii + 34 ] = voffset + 18;\r\n\tindices[ ii + 35 ] = voffset + 19;\r\n\r\n\t//\r\n\tindices[ ii + 36 ] = voffset + 12;\r\n\tindices[ ii + 37 ] = voffset + 19;\r\n\tindices[ ii + 38 ] = voffset + 13;\r\n\r\n\tindices[ ii + 39 ] = voffset + 19;\r\n\tindices[ ii + 40 ] = voffset + 20;\r\n\tindices[ ii + 41 ] = voffset + 13;\r\n\r\n\tindices[ ii + 42 ] = voffset + 20;\r\n\tindices[ ii + 43 ] = voffset + 21;\r\n\tindices[ ii + 44 ] = voffset + 13;\r\n};\r\n\r\nexport const buildTriangleRoundedVertex = (\r\n\tvertices: Float32Array,\r\n\tvoffset: number,\r\n\toriginX: number,\r\n\toriginY: number,\r\n\tsizeX: number,\r\n\tsizeY: number,\r\n\tstrokeAlign: number,\r\n\tstrokeWidth: number,\r\n\tradius: number,\r\n\tinternalTransform: Matrix,\r\n\tworldSize: [ number, number, number, number, number ]\r\n): void => {\r\n\t// Calculate the transformed positions\r\n\tconst s = strokeAlign * strokeWidth;\r\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\r\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\r\n\tconst sz = Math.sqrt( sx * sx + 4 * sy * sy );\r\n\tconst sw = 2 * sx * sy / (sx + sz);\r\n\tconst ry = ( sw * radius ) / ( 2 * sy );\r\n\tconst rz = ( 0.5 * ( sz - sw ) * radius ) / ( sz );\r\n\tconst rx = ( ry * sz ) / ( 2 * sx );\r\n\r\n\tconst work = TRIANGLE_ROUNDED_WORK_POINT;\r\n\twork.set( originX, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x1 = work.x;\r\n\tconst y1 = work.y;\r\n\twork.set( originX, originY );\r\n\tinternalTransform.apply( work, work );\r\n\tconst tx = work.x;\r\n\tconst ty = work.y;\r\n\twork.set( originX + sx, originY );\r\n\tinternalTransform.apply( work, work );\r\n\tconst dx = tx - x1;\r\n\tconst dy = ty - y1;\r\n\tconst x4 = work.x + dx;\r\n\tconst y4 = work.y + dy;\r\n\tconst x7 = tx + (tx - work.x) + dx;\r\n\tconst y7 = ty + (ty - work.y) + dy;\r\n\tconst dx14 = x4 - x1;\r\n\tconst dy14 = y4 - y1;\r\n\tconst x2 = x1 + rz * dx14;\r\n\tconst y2 = y1 + rz * dy14;\r\n\tconst x3 = x4 - ry * dx14;\r\n\tconst y3 = y4 - ry * dy14;\r\n\tconst dx47r = rx * (x7 - x4);\r\n\tconst dy47r = rx * (y7 - y4);\r\n\tconst x5 = x4 + dx47r;\r\n\tconst y5 = y4 + dy47r;\r\n\tconst x6 = x7 - dx47r;\r\n\tconst y6 = y7 - dy47r;\r\n\tconst dx71 = x1 - x7;\r\n\tconst dy71 = y1 - y7;\r\n\tconst x8 = x7 + ry * dx71;\r\n\tconst y8 = y7 + ry * dy71;\r\n\tconst x9 = x1 - rz * dx71;\r\n\tconst y9 = y1 - rz * dy71;\r\n\twork.set( originX, originY + sy - sw ); // Incenter of a triangle\r\n\tinternalTransform.apply( work, work );\r\n\tconst x0 = work.x;\r\n\tconst y0 = work.y;\r\n\r\n\tconst x10 = x1 + radius * ( x0 - x1 );\r\n\tconst y10 = y1 + radius * ( y0 - y1 );\r\n\tconst x11 = x4 + radius * ( x0 - x4 );\r\n\tconst y11 = y4 + radius * ( y0 - y4 );\r\n\tconst x12 = x7 + radius * ( x0 - x7 );\r\n\tconst y12 = y7 + radius * ( y0 - y7 );\r\n\r\n\t// World size\r\n\tconst xb = tx + dx;\r\n\tconst yb = ty + dy;\r\n\tworldSize[ 0 ] = toLength( xb, yb, x0, y0 );\r\n\tworldSize[ 1 ] = rx;\r\n\tworldSize[ 2 ] = ry;\r\n\tworldSize[ 3 ] = rz;\r\n\tworldSize[ 4 ] = 1 - 0.5 * sw / sy;\r\n\r\n\t// Vertices\r\n\t// Top corner\r\n\tconst iv = voffset * 2;\r\n\tvertices[ iv +  0 ] = x10;\r\n\tvertices[ iv +  1 ] = y10;\r\n\tvertices[ iv +  2 ] = x9;\r\n\tvertices[ iv +  3 ] = y9;\r\n\tvertices[ iv +  4 ] = x1;\r\n\tvertices[ iv +  5 ] = y1;\r\n\tvertices[ iv +  6 ] = x2;\r\n\tvertices[ iv +  7 ] = y2;\r\n\r\n\t// Bottom-right corner\r\n\tvertices[ iv +  8 ] = x11;\r\n\tvertices[ iv +  9 ] = y11;\r\n\tvertices[ iv + 10 ] = x3;\r\n\tvertices[ iv + 11 ] = y3;\r\n\tvertices[ iv + 12 ] = x4;\r\n\tvertices[ iv + 13 ] = y4;\r\n\tvertices[ iv + 14 ] = x5;\r\n\tvertices[ iv + 15 ] = y5;\r\n\r\n\t// Bottom-left corner\r\n\tvertices[ iv + 16 ] = x12;\r\n\tvertices[ iv + 17 ] = y12;\r\n\tvertices[ iv + 18 ] = x6;\r\n\tvertices[ iv + 19 ] = y6;\r\n\tvertices[ iv + 20 ] = x7;\r\n\tvertices[ iv + 21 ] = y7;\r\n\tvertices[ iv + 22 ] = x8;\r\n\tvertices[ iv + 23 ] = y8;\r\n\r\n\t// Others\r\n\tvertices[ iv + 24 ] = x0;\r\n\tvertices[ iv + 25 ] = y0;\r\n\r\n\tvertices[ iv + 26 ] = x10;\r\n\tvertices[ iv + 27 ] = y10;\r\n\r\n\tvertices[ iv + 28 ] = x2;\r\n\tvertices[ iv + 29 ] = y2;\r\n\tvertices[ iv + 30 ] = x3;\r\n\tvertices[ iv + 31 ] = y3;\r\n\r\n\tvertices[ iv + 32 ] = x11;\r\n\tvertices[ iv + 33 ] = y11;\r\n\r\n\tvertices[ iv + 34 ] = x5;\r\n\tvertices[ iv + 35 ] = y5;\r\n\tvertices[ iv + 36 ] = x6;\r\n\tvertices[ iv + 37 ] = y6;\r\n\r\n\tvertices[ iv + 38 ] = x12;\r\n\tvertices[ iv + 39 ] = y12;\r\n\r\n\tvertices[ iv + 40 ] = x8;\r\n\tvertices[ iv + 41 ] = y8;\r\n\tvertices[ iv + 42 ] = x9;\r\n\tvertices[ iv + 43 ] = y9;\r\n};\r\n\r\nexport const buildTriangleRoundedClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tcorner: EShapeCorner,\r\n\tradius: number\r\n): void => {\r\n\t// Top corner\r\n\tlet iv = voffset * 3;\r\n\tconst w = 1 - radius;\r\n\tif( corner & EShapeCorner.TOP ) {\r\n\t\tclippings[ iv +  0 ] = 0;\r\n\t\tclippings[ iv +  1 ] = 0;\r\n\t\tclippings[ iv +  2 ] = 1;\r\n\t\tclippings[ iv +  3 ] = 1;\r\n\t\tclippings[ iv +  4 ] = 0;\r\n\t\tclippings[ iv +  5 ] = 1;\r\n\t\tclippings[ iv +  6 ] = 1;\r\n\t\tclippings[ iv +  7 ] = 1;\r\n\t\tclippings[ iv +  8 ] = 1;\r\n\t\tclippings[ iv +  9 ] = 0;\r\n\t\tclippings[ iv + 10 ] = 1;\r\n\t\tclippings[ iv + 11 ] = 1;\r\n\t} else {\r\n\t\tclippings[ iv +  0 ] = w;\r\n\t\tclippings[ iv +  1 ] = w;\r\n\t\tclippings[ iv +  2 ] = 0;\r\n\t\tclippings[ iv +  3 ] = 1;\r\n\t\tclippings[ iv +  4 ] = w;\r\n\t\tclippings[ iv +  5 ] = 0;\r\n\t\tclippings[ iv +  6 ] = 1;\r\n\t\tclippings[ iv +  7 ] = 1;\r\n\t\tclippings[ iv +  8 ] = 0;\r\n\t\tclippings[ iv +  9 ] = w;\r\n\t\tclippings[ iv + 10 ] = 1;\r\n\t\tclippings[ iv + 11 ] = 0;\r\n\t}\r\n\tiv += 12;\r\n\r\n\t// Bottom-right corner\r\n\tif( corner & EShapeCorner.BOTTOM_RIGHT ) {\r\n\t\tclippings[ iv +  0 ] = 0;\r\n\t\tclippings[ iv +  1 ] = 0;\r\n\t\tclippings[ iv +  2 ] = 1;\r\n\t\tclippings[ iv +  3 ] = 1;\r\n\t\tclippings[ iv +  4 ] = 0;\r\n\t\tclippings[ iv +  5 ] = 1;\r\n\t\tclippings[ iv +  6 ] = 1;\r\n\t\tclippings[ iv +  7 ] = 1;\r\n\t\tclippings[ iv +  8 ] = 1;\r\n\t\tclippings[ iv +  9 ] = 0;\r\n\t\tclippings[ iv + 10 ] = 1;\r\n\t\tclippings[ iv + 11 ] = 1;\r\n\t} else {\r\n\t\tclippings[ iv +  0 ] = w;\r\n\t\tclippings[ iv +  1 ] = w;\r\n\t\tclippings[ iv +  2 ] = 0;\r\n\t\tclippings[ iv +  3 ] = 1;\r\n\t\tclippings[ iv +  4 ] = w;\r\n\t\tclippings[ iv +  5 ] = 0;\r\n\t\tclippings[ iv +  6 ] = 1;\r\n\t\tclippings[ iv +  7 ] = 1;\r\n\t\tclippings[ iv +  8 ] = 0;\r\n\t\tclippings[ iv +  9 ] = w;\r\n\t\tclippings[ iv + 10 ] = 1;\r\n\t\tclippings[ iv + 11 ] = 0;\r\n\t}\r\n\tiv += 12;\r\n\r\n\t// Bottom-left corner\r\n\tif( corner & EShapeCorner.BOTTOM_LEFT ) {\r\n\t\tclippings[ iv +  0 ] = 0;\r\n\t\tclippings[ iv +  1 ] = 0;\r\n\t\tclippings[ iv +  2 ] = 1;\r\n\t\tclippings[ iv +  3 ] = 1;\r\n\t\tclippings[ iv +  4 ] = 0;\r\n\t\tclippings[ iv +  5 ] = 1;\r\n\t\tclippings[ iv +  6 ] = 1;\r\n\t\tclippings[ iv +  7 ] = 1;\r\n\t\tclippings[ iv +  8 ] = 1;\r\n\t\tclippings[ iv +  9 ] = 0;\r\n\t\tclippings[ iv + 10 ] = 1;\r\n\t\tclippings[ iv + 11 ] = 1;\r\n\t} else {\r\n\t\tclippings[ iv +  0 ] = w;\r\n\t\tclippings[ iv +  1 ] = w;\r\n\t\tclippings[ iv +  2 ] = 0;\r\n\t\tclippings[ iv +  3 ] = 1;\r\n\t\tclippings[ iv +  4 ] = w;\r\n\t\tclippings[ iv +  5 ] = 0;\r\n\t\tclippings[ iv +  6 ] = 1;\r\n\t\tclippings[ iv +  7 ] = 1;\r\n\t\tclippings[ iv +  8 ] = 0;\r\n\t\tclippings[ iv +  9 ] = w;\r\n\t\tclippings[ iv + 10 ] = 1;\r\n\t\tclippings[ iv + 11 ] = 0;\r\n\t}\r\n\tiv += 12;\r\n\r\n\t// Others\r\n\tclippings[ iv + 0 ] = 0;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = w;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = 1;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tclippings[ iv + 3 ] = 1;\r\n\tclippings[ iv + 4 ] = 0;\r\n\tclippings[ iv + 5 ] = 0;\r\n\tiv += 6;\r\n\r\n\tclippings[ iv + 0 ] = w;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = 1;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tclippings[ iv + 3 ] = 1;\r\n\tclippings[ iv + 4 ] = 0;\r\n\tclippings[ iv + 5 ] = 0;\r\n\tiv += 6;\r\n\r\n\tclippings[ iv + 0 ] = w;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = 1;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tclippings[ iv + 3 ] = 1;\r\n\tclippings[ iv + 4 ] = 0;\r\n\tclippings[ iv + 5 ] = 0;\r\n};\r\n\r\nexport const buildTriangleRoundedStep = (\r\n\tsteps: Float32Array,\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tstrokeWidth: number,\r\n\tradius: number,\r\n\tantialiasWeight: number,\r\n\tworldSize: [ number, number, number, number, number ]\r\n): void => {\r\n\tconst wsr = worldSize[ 0 ];\r\n\ttoStep( wsr, strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swc = STEP_VALUES[ 0 ];\r\n\tconst pc0 = STEP_VALUES[ 1 ];\r\n\tconst pc1 = STEP_VALUES[ 2 ];\r\n\r\n\ttoStep( radius * wsr, strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swr = STEP_VALUES[ 0 ];\r\n\tconst pr0 = STEP_VALUES[ 1 ];\r\n\tconst pr1 = STEP_VALUES[ 2 ];\r\n\r\n\tlet ic = voffset * 3;\r\n\tlet is = voffset * 6;\r\n\tfor( let i = 0; i < TRIANGLE_ROUNDED_VERTEX_COUNT; ++i ) {\r\n\t\tlet sw = swc;\r\n\t\tlet p0 = pc0;\r\n\t\tlet p1 = pc1;\r\n\t\tif( 0.5 < clippings[ ic + 2 ] ) {\r\n\t\t\tsw = swr;\r\n\t\t\tp0 = pr0;\r\n\t\t\tp1 = pr1;\r\n\t\t}\r\n\t\tsteps[ is + 0 ] = sw * clippings[ ic + 0 ];\r\n\t\tsteps[ is + 1 ] = sw * clippings[ ic + 1 ];\r\n\t\tsteps[ is + 2 ] = p0;\r\n\t\tsteps[ is + 3 ] = p0;\r\n\t\tsteps[ is + 4 ] = p1;\r\n\t\tsteps[ is + 5 ] = p1;\r\n\t\tic += 3;\r\n\t\tis += 6;\r\n\t}\r\n};\r\n\r\nexport const buildTriangleRoundedUv = (\r\n\tuvs: Float32Array,\r\n\tvoffset: number,\r\n\ttextureUvs: TextureUvs,\r\n\tradius: number,\r\n\tworldSize: [ number, number, number, number, number ]\r\n): void => {\r\n\tconst x0 = textureUvs.x0;\r\n\tconst x1 = textureUvs.x1;\r\n\tconst x2 = textureUvs.x2;\r\n\tconst x3 = textureUvs.x3;\r\n\tconst y0 = textureUvs.y0;\r\n\tconst y1 = textureUvs.y1;\r\n\tconst y2 = textureUvs.y2;\r\n\tconst y3 = textureUvs.y3;\r\n\r\n\tconst x4 = 0.5 * ( x0 + x1 );\r\n\tconst y4 = 0.5 * ( y0 + y1 );\r\n\r\n\tconst c = worldSize[ 4 ];\r\n\tconst x5 = x4 + c * ( x3 - x0 );\r\n\tconst y5 = y4 + c * ( y3 - y0 );\r\n\r\n\tconst rx = worldSize[ 1 ];\r\n\tconst ry = worldSize[ 2 ];\r\n\tconst rz = worldSize[ 3 ];\r\n\tconst x6 = x4 + rz * (x3 - x4);\r\n\tconst y6 = y4 + rz * (y3 - y4);\r\n\tconst x7 = x4 + radius * (x5 - x4);\r\n\tconst y7 = y4 + radius * (y5 - y4);\r\n\tconst x8 = x4 + rz * (x2 - x4);\r\n\tconst y8 = y4 + rz * (y2 - y4);\r\n\r\n\tconst x9 = x2 + ry * (x4 - x2);\r\n\tconst y9 = y2 + ry * (y4 - y2);\r\n\tconst x10 = x2 + radius * (x5 - x2);\r\n\tconst y10 = y2 + radius * (y5 - y2);\r\n\tconst x11 = x2 + rx * (x3 - x2);\r\n\tconst y11 = y2 + rx * (y3 - y2);\r\n\r\n\tconst x12 = x3 + rx * (x2 - x3);\r\n\tconst y12 = y3 + rx * (y2 - y3);\r\n\tconst x13 = x3 + radius * (x5 - x3);\r\n\tconst y13 = y3 + radius * (y5 - y3);\r\n\tconst x14 = x3 + ry * (x4 - x3);\r\n\tconst y14 = y3 + ry * (y4 - y3);\r\n\r\n\t// Uvs\r\n\t// Top corner\r\n\tlet iuv = voffset * 2;\r\n\tuvs[ iuv + 0 ] = x7;\r\n\tuvs[ iuv + 1 ] = y7;\r\n\tuvs[ iuv + 2 ] = x6;\r\n\tuvs[ iuv + 3 ] = y6;\r\n\tuvs[ iuv + 4 ] = x4;\r\n\tuvs[ iuv + 5 ] = y4;\r\n\tuvs[ iuv + 6 ] = x8;\r\n\tuvs[ iuv + 7 ] = y8;\r\n\tiuv += 8;\r\n\r\n\t// Bottom-right corner\r\n\tuvs[ iuv + 0 ] = x10;\r\n\tuvs[ iuv + 1 ] = y10;\r\n\tuvs[ iuv + 2 ] = x9;\r\n\tuvs[ iuv + 3 ] = y9;\r\n\tuvs[ iuv + 4 ] = x2;\r\n\tuvs[ iuv + 5 ] = y2;\r\n\tuvs[ iuv + 6 ] = x11;\r\n\tuvs[ iuv + 7 ] = y11;\r\n\tiuv += 8;\r\n\r\n\t// Bottom-left corner\r\n\tuvs[ iuv + 0 ] = x13;\r\n\tuvs[ iuv + 1 ] = y13;\r\n\tuvs[ iuv + 2 ] = x12;\r\n\tuvs[ iuv + 3 ] = y12;\r\n\tuvs[ iuv + 4 ] = x3;\r\n\tuvs[ iuv + 5 ] = y3;\r\n\tuvs[ iuv + 6 ] = x14;\r\n\tuvs[ iuv + 7 ] = y14;\r\n\tiuv += 8;\r\n\r\n\t// Others\r\n\tuvs[ iuv +  0 ] = x5;\r\n\tuvs[ iuv +  1 ] = y5;\r\n\r\n\tuvs[ iuv +  2 ] = x7;\r\n\tuvs[ iuv +  3 ] = y7;\r\n\r\n\tuvs[ iuv +  4 ] = x8;\r\n\tuvs[ iuv +  5 ] = y8;\r\n\tuvs[ iuv +  6 ] = x9;\r\n\tuvs[ iuv +  7 ] = y9;\r\n\r\n\tuvs[ iuv +  8 ] = x10;\r\n\tuvs[ iuv +  9 ] = y10;\r\n\r\n\tuvs[ iuv + 10 ] = x11;\r\n\tuvs[ iuv + 11 ] = y11;\r\n\tuvs[ iuv + 12 ] = x12;\r\n\tuvs[ iuv + 13 ] = y12;\r\n\r\n\tuvs[ iuv + 14 ] = x13;\r\n\tuvs[ iuv + 15 ] = y13;\r\n\r\n\tuvs[ iuv + 16 ] = x14;\r\n\tuvs[ iuv + 17 ] = y14;\r\n\tuvs[ iuv + 18 ] = x6;\r\n\tuvs[ iuv + 19 ] = y6;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { buildNullClipping, buildNullStep, buildNullUv, buildNullVertex } from \"./build-null\";\r\nimport {\r\n\tbuildTriangleRoundedClipping, buildTriangleRoundedIndex, buildTriangleRoundedStep,\r\n\tbuildTriangleRoundedUv, buildTriangleRoundedVertex, TRIANGLE_ROUNDED_INDEX_COUNT, TRIANGLE_ROUNDED_VERTEX_COUNT,\r\n\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n} from \"./build-triangle-rounded\";\r\nimport { copyClipping } from \"./copy-clipping\";\r\nimport { copyIndex } from \"./copy-index\";\r\nimport { copyStep } from \"./copy-step\";\r\nimport { copyUvs } from \"./copy-uv\";\r\nimport { copyVertex } from \"./copy-vertex\";\r\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { EShapeLineOfAnyUploaded } from \"./e-shape-line-of-any-uploaded\";\r\n\r\nexport class EShapeLineOfTriangleRoundedsUploaded extends EShapeLineOfAnyUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateIndices();\r\n\t\tconst voffset = this.vertexOffset;\r\n\t\tconst ioffset = this.indexOffset;\r\n\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\tif( 0 < pointCountReserved ) {\r\n\t\t\tbuildTriangleRoundedIndex(\r\n\t\t\t\tbuffer.indices,\r\n\t\t\t\tvoffset,\r\n\t\t\t\tioffset\r\n\t\t\t);\r\n\t\t\tcopyIndex(\r\n\t\t\t\tbuffer.indices,\r\n\t\t\t\tTRIANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\tioffset,\r\n\t\t\t\tTRIANGLE_ROUNDED_INDEX_COUNT,\r\n\t\t\t\tpointCountReserved\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tconst points = shape.points;\r\n\t\tif( points instanceof EShapeLineOfAnyPointsImpl ) {\r\n\t\t\tthis.updateVertexClippingStepAndUv( buffer, shape, points );\r\n\t\t\tthis.updateLineOfAnyColorFill( buffer, shape, points, TRIANGLE_ROUNDED_VERTEX_COUNT );\r\n\t\t\tthis.updateLineOfAnyColorStroke( buffer, shape, points, TRIANGLE_ROUNDED_VERTEX_COUNT );\r\n\t\t\tthis.updateText( buffer, shape );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateVertexClippingStepAndUv(\r\n\t\tbuffer: EShapeBuffer,\r\n\t\tshape: EShape,\r\n\t\tpoints: EShapeLineOfAnyPoints\r\n\t): void {\r\n\t\tconst pointId = points.id;\r\n\t\tconst pointOffset = points.offset;\r\n\t\tconst pointOffsetId = pointOffset.id;\r\n\t\tconst isPointChanged = ( pointId !== this.pointId || pointOffsetId !== this.pointOffsetId );\r\n\r\n\t\tconst pointSize = points.size;\r\n\t\tconst pointSizeId = pointSize.id;\r\n\t\tconst isPointSizeChanged = ( pointSizeId !== this.pointSizeId );\r\n\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\tconst radius = shape.radius;\r\n\t\tconst isRadiusChanged = ( radius !== this.radius );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign || this.strokeWidth !== strokeWidth );\r\n\r\n\t\tconst corner = shape.corner;\r\n\t\tconst isCornerChanged = ( this.corner !== corner );\r\n\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tconst isTextureChanged = ( texture !== this.texture || textureTransformId !== this.textureTransformId );\r\n\r\n\t\tconst isVertexChanged = isPointChanged || isPointSizeChanged || isSizeChanged || isRadiusChanged || isStrokeChanged;\r\n\r\n\t\tif( isVertexChanged || isTransformChanged || isCornerChanged || isTextureChanged ) {\r\n\t\t\tthis.pointId = pointId;\r\n\t\t\tthis.pointCount = points.length;\r\n\t\t\tthis.pointOffsetId = pointOffsetId;\r\n\t\t\tthis.pointSizeId = pointSizeId;\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.radius = radius;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\t\t\tthis.corner = corner;\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tif( isSizeChanged || isTransformChanged || isStrokeChanged ) {\r\n\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t}\r\n\r\n\t\t\t// Buffer\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tif( isVertexChanged || isCornerChanged ) {\r\n\t\t\t\tbuffer.updateClippings();\r\n\t\t\t}\r\n\t\t\tif( isVertexChanged || isTransformChanged || isCornerChanged ) {\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t}\r\n\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\tbuffer.updateUvs();\r\n\t\t\t}\r\n\t\t\tconst pointCount = this.pointCount;\r\n\t\t\tconst pointsValues = points.values;\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\t\t\tconst vertices = buffer.vertices;\r\n\t\t\tconst clippings = buffer.clippings;\r\n\t\t\tconst steps = buffer.steps;\r\n\t\t\tconst uvs = buffer.uvs;\r\n\t\t\tconst internalTransform = shape.transform.internalTransform;\r\n\t\t\tconst textureUvs = this.toTextureUvs( texture );\r\n\t\t\tconst antialiasWeight = this.antialiasWeight;\r\n\t\t\tif( 0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY() ) {\r\n\t\t\t\tconst pointSizeX = pointSize.getX( 0 );\r\n\t\t\t\tconst pointSizeY = pointSize.getY( 0 );\r\n\r\n\t\t\t\t// Vertices\r\n\t\t\t\tbuildTriangleRoundedVertex(\r\n\t\t\t\t\tvertices, voffset,\r\n\t\t\t\t\t0, 0,\r\n\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\tstrokeAlign, strokeWidth, radius,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t\tcopyVertex(\r\n\t\t\t\t\tvertices,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tvoffset, TRIANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\t\tpointCount, pointsValues,\r\n\t\t\t\t\tpointOffset\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Clippings\r\n\t\t\t\tif( isVertexChanged || isCornerChanged ) {\r\n\t\t\t\t\tbuildTriangleRoundedClipping(\r\n\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tcorner,\r\n\t\t\t\t\t\tradius\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyClipping(\r\n\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tTRIANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Steps\r\n\t\t\t\tif( isVertexChanged || isTransformChanged || isCornerChanged ) {\r\n\t\t\t\t\tbuildTriangleRoundedStep(\r\n\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\t\tradius,\r\n\t\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyStep(\r\n\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\tvoffset, TRIANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// UVs\r\n\t\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\t\tbuildTriangleRoundedUv(\r\n\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\ttextureUvs,\r\n\t\t\t\t\t\tradius,\r\n\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyUvs(\r\n\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tTRIANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0; i < pointCount; ++i ) {\r\n\t\t\t\t\tconst ip = i << 1;\r\n\t\t\t\t\tconst px = pointsValues[ ip     ] + pointOffset.getX( i );\r\n\t\t\t\t\tconst py = pointsValues[ ip + 1 ] + pointOffset.getY( i );\r\n\t\t\t\t\tconst pointSizeX = pointSize.getX( i );\r\n\t\t\t\t\tconst pointSizeY = pointSize.getY( i );\r\n\r\n\t\t\t\t\tconst iv = voffset + i * TRIANGLE_ROUNDED_VERTEX_COUNT;\r\n\r\n\t\t\t\t\t// Vertices\r\n\t\t\t\t\tbuildTriangleRoundedVertex(\r\n\t\t\t\t\t\tvertices, iv,\r\n\t\t\t\t\t\tpx, py,\r\n\t\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\t\tstrokeAlign, strokeWidth, radius,\r\n\t\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Clippings\r\n\t\t\t\t\tif( isVertexChanged || isCornerChanged ) {\r\n\t\t\t\t\t\tbuildTriangleRoundedClipping(\r\n\t\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\tcorner,\r\n\t\t\t\t\t\t\tradius\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Steps\r\n\t\t\t\t\tif( isVertexChanged || isTransformChanged || isCornerChanged ) {\r\n\t\t\t\t\t\tbuildTriangleRoundedStep(\r\n\t\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\t\t\tradius,\r\n\t\t\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// UVs\r\n\t\t\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\t\t\tbuildTriangleRoundedUv(\r\n\t\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\ttextureUvs,\r\n\t\t\t\t\t\t\tradius,\r\n\t\t\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Fill the rest\r\n\t\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\t\tconst voffsetReserved = voffset + pointCount * TRIANGLE_ROUNDED_VERTEX_COUNT;\r\n\t\t\tconst vcountReserved = TRIANGLE_ROUNDED_VERTEX_COUNT * (pointCountReserved - pointCount);\r\n\t\t\tbuildNullVertex(\r\n\t\t\t\tvertices,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullStep(\r\n\t\t\t\tsteps,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullClipping(\r\n\t\t\t\tclippings,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullUv(\r\n\t\t\t\tuvs,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { TRIANGLE_ROUNDED_INDEX_COUNT, TRIANGLE_ROUNDED_VERTEX_COUNT } from \"./build-triangle-rounded\";\r\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\r\nimport { EShapeLineOfTriangleRoundedsUploaded } from \"./e-shape-line-of-triangle-roundeds-uploaded\";\r\n\r\nexport const createLineOfTriangleRoundedsUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeLineOfTriangleRoundedsUploaded | null => {\r\n\treturn createLineOfAnyUploaded(\r\n\t\tbuffer, shape,\r\n\t\tvoffset, TRIANGLE_ROUNDED_VERTEX_COUNT,\r\n\t\tioffset, TRIANGLE_ROUNDED_INDEX_COUNT,\r\n\t\tantialiasWeight,\r\n\t\tEShapeLineOfTriangleRoundedsUploaded\r\n\t);\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapePrimitive } from \"./e-shape-primitive\";\r\n\r\nexport class EShapeTriangle extends EShapePrimitive {\r\n\tconstructor( type = EShapeType.TRIANGLE ) {\r\n\t\tsuper( type );\r\n\t}\r\n\r\n\tclone(): EShapeTriangle {\r\n\t\treturn new EShapeTriangle().copy( this );\r\n\t}\r\n\r\n\tprotected containsAbs_( x: number, y: number, a: number, ay1: number, ay2: number ): boolean {\r\n\t\t// a = 2 * ay / ax\r\n\t\t// y = + a * x + ay1\r\n\t\t// y = - a * x + ay1\r\n\t\t// y = ay2;\r\n\t\treturn ( +a * x + ay1 - y <= 0 && -a * x + ay1 - y <= 0 && y <= ay2 );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tif( super.containsAbsBBox( x, y, ax, ay ) ) {\r\n\t\t\tconst a = 2 * ay / ax;\r\n\t\t\tconst fill = this.fill;\r\n\t\t\tif( fill.enable ) {\r\n\t\t\t\tif( this.containsAbs_( x, y, a, -ay, +ay ) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst stroke = this.stroke;\r\n\t\t\t\tconst strokeWidth = stroke.width;\r\n\t\t\t\tif( stroke.enable && 0 < strokeWidth ) {\r\n\t\t\t\t\tif( this.containsAbs_( x, y, a, -ay, +ay ) ) {\r\n\t\t\t\t\t\tconst az = Math.sqrt( ax * ax + 4 * ay * ay );\r\n\t\t\t\t\t\tconst aw = 2 * ax * ay / (ax + az);\r\n\r\n\t\t\t\t\t\tconst cy = ay - aw;\r\n\t\t\t\t\t\tconst ay1 = cy + (-ay - cy) * Math.max( 0.0, aw - strokeWidth ) / aw;\r\n\t\t\t\t\t\tconst ay2 = ay - strokeWidth;\r\n\t\t\t\t\t\tif( ! this.containsAbs_( x, y, a, ay1, ay2 ) ) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeCorner } from \"../e-shape-corner\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeTriangle } from \"./e-shape-triangle\";\r\n\r\nconst FMIN = 0.00001;\r\n\r\nexport class EShapeTriangleRounded extends EShapeTriangle {\r\n\tconstructor( type = EShapeType.TRIANGLE_ROUNDED ) {\r\n\t\tsuper( type );\r\n\t}\r\n\r\n\tclone(): EShapeTriangleRounded {\r\n\t\treturn new EShapeTriangleRounded().copy( this );\r\n\t}\r\n\r\n\tprotected containsCorner_( x: number, y: number, r: number, aw: number ) {\r\n\t\tconst fill = this.fill;\r\n\t\tif( fill.enable ) {\r\n\t\t\tif( x * x + y * y <= r * r ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst stroke = this.stroke;\r\n\t\t\tconst strokeWidth = stroke.width;\r\n\t\t\tif( stroke.enable && 0 < strokeWidth ) {\r\n\t\t\t\tconst d = x * x + y * y;\r\n\t\t\t\tif( d <= r * r ) {\r\n\t\t\t\t\tconst w = Math.max( 0.0, r * ( 1 - strokeWidth / aw ) );\r\n\t\t\t\t\tif( w * w <= d ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected containsCorner(\r\n\t\tx: number, y: number,\r\n\t\tx0: number, y0: number,\r\n\t\tx1: number, y1: number,\r\n\t\tx2: number, y2: number,\r\n\t\tx3: number, y3: number,\r\n\t\tr12: number, r13: number,\r\n\t\taw: number,\r\n\t\tradius: number\r\n\t) {\r\n\t\tconst xl = x1 + r12 * ( x2 - x1 ) - x0;\r\n\t\tconst yl = y1 + r12 * ( y2 - y1 ) - y0;\r\n\t\tconst n = Math.sqrt( xl * xl + yl * yl );\r\n\t\tif( FMIN < n ) {\r\n\t\t\tconst ni = 1 / n;\r\n\t\t\tconst nlx = xl * ni;\r\n\t\t\tconst nly = yl * ni;\r\n\r\n\t\t\tconst xr = x1 + r13 * ( x3 - x1 ) - x0;\r\n\t\t\tconst yr = y1 + r13 * ( y3 - y1 ) - y0;\r\n\t\t\tconst nrx = xr * ni;\r\n\t\t\tconst nry = yr * ni;\r\n\r\n\t\t\tconst det = nlx * nry - nrx * nly;\r\n\t\t\tif( FMIN < Math.abs( det ) ) {\r\n\t\t\t\tconst deti = 1 / det;\r\n\t\t\t\tconst xc = x - x0;\r\n\t\t\t\tconst yc = y - y0;\r\n\t\t\t\tconst dx = ( +nry * xc - nrx * yc ) * deti;\r\n\t\t\t\tconst dy = ( -nly * xc + nlx * yc ) * deti;\r\n\t\t\t\tif( this.containsCorner_( dx, dy, n, aw * radius ) ) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ) {\r\n\t\tif( super.containsAbsBBox( x, y, ax, ay ) ) {\r\n\t\t\tconst a = 2 * ay / ax;\r\n\t\t\tif( this.containsAbs_( x, y, a, -ay, +ay ) ) {\r\n\t\t\t\tconst az = Math.sqrt( ax * ax + 4 * ay * ay );\r\n\t\t\t\tconst aw = 2 * ax * ay / (ax + az);\r\n\t\t\t\tconst radius = this.radius;\r\n\r\n\t\t\t\tconst x0 = 0;\r\n\t\t\t\tconst y0 = ay - aw;\r\n\t\t\t\tconst x1 = 0;\r\n\t\t\t\tconst y1 = -ay;\r\n\t\t\t\tconst x4 = +ax;\r\n\t\t\t\tconst y4 = +ay;\r\n\t\t\t\tconst x7 = -x4;\r\n\t\t\t\tconst y7 = +y4;\r\n\t\t\t\tconst x10 = x1 + radius * ( x0 - x1 );\r\n\t\t\t\tconst y10 = y1 + radius * ( y0 - y1 );\r\n\t\t\t\tconst x11 = x4 + radius * ( x0 - x4 );\r\n\t\t\t\tconst y11 = y4 + radius * ( y0 - y4 );\r\n\t\t\t\tconst y12 = +y11;\r\n\t\t\t\tconst x12 = -x11;\r\n\r\n\t\t\t\tconst c0 = -a * x + y10 - y <= 0;\r\n\t\t\t\tconst c1 = +a * x + y10 - y <= 0;\r\n\t\t\t\tconst c2 = y <= y11;\r\n\t\t\t\tconst corner = this.corner;\r\n\t\t\t\tif( ! c0 && ! c1 && (corner & EShapeCorner.TOP) ) {\r\n\t\t\t\t\t// Top corner\r\n\t\t\t\t\tconst rz = ( 0.5 * ( az - aw ) * radius ) / ( az );\r\n\t\t\t\t\tif( this.containsCorner( x, y, x10, y10, x1, y1, x7, y7, x4, y4, rz, rz, aw, radius ) ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if( ! c0 && ! c2 && (corner & EShapeCorner.BOTTOM_LEFT) ) {\r\n\t\t\t\t\t// Bottom-left corner\r\n\t\t\t\t\tconst ry = ( aw * radius ) / ( 2 * ay );\r\n\t\t\t\t\tconst rx = ( ry * az ) / ( 2 * ax );\r\n\t\t\t\t\tif( this.containsCorner( x, y, x12, y12, x7, y7, x4, y4, x1, y1, rx, ry, aw, radius ) ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if( ! c1 && ! c2 && (corner & EShapeCorner.BOTTOM_RIGHT) ) {\r\n\t\t\t\t\t// Bottom-right corner\r\n\t\t\t\t\tconst ry = ( aw * radius ) / ( 2 * ay );\r\n\t\t\t\t\tconst rx = ( ry * az ) / ( 2 * ax );\r\n\t\t\t\t\tif( this.containsCorner( x, y, x11, y11, x4, y4, x1, y1, x7, y7, ry, rx, aw, radius ) ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Others\r\n\t\t\t\t\tconst fill = this.fill;\r\n\t\t\t\t\tif( fill.enable ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst stroke = this.stroke;\r\n\t\t\t\t\t\tconst strokeWidth = stroke.width;\r\n\t\t\t\t\t\tif( stroke.enable && 0 < strokeWidth ) {\r\n\t\t\t\t\t\t\tconst cy = ay - aw;\r\n\t\t\t\t\t\t\tconst ay1 = cy + (-ay - cy) * Math.max( 0.0, aw - strokeWidth ) / aw;\r\n\t\t\t\t\t\t\tconst ay2 = ay - strokeWidth;\r\n\t\t\t\t\t\t\tif( ! this.containsAbs_( x, y, a, ay1, ay2 ) ) {\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeBase } from \"./e-shape-base\";\r\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\r\nimport {\r\n\tEShapeLineOfAnyPoints, EShapeLineOfAnyPointsHitTester,\r\n\tEShapeLineOfAnyPointsTestRange, EShapeLineOfAnyPointsToHitThreshold\r\n} from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { EShapeTriangleRounded } from \"./e-shape-triangle-rounded\";\r\nimport { toHitThreshold } from \"./to-hit-threshold\";\r\n\r\nexport class EShapeLineOfTriangleRoundeds extends EShapeTriangleRounded implements EShapeLineOfAny {\r\n\tpoints!: EShapeLineOfAnyPoints;\r\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\tprotected _testerBBox: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\r\n\tconstructor( other?: EShapeLineOfTriangleRoundeds ) {\r\n\t\tsuper( EShapeType.LINE_OF_TRIANGLE_ROUNDEDS );\r\n\t\tif( other ) {\r\n\t\t\tthis.copy( other );\r\n\t\t} else {\r\n\t\t\tthis.points = new EShapeLineOfAnyPointsImpl( this );\r\n\t\t}\r\n\r\n\t\tthis._tester = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbs( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\r\n\t\tthis._testerBBox = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbsBBox( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\t}\r\n\r\n\tclone(): EShapeLineOfTriangleRoundeds {\r\n\t\treturn new EShapeLineOfTriangleRoundeds( this );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tconst threshold = toHitThreshold( this, null );\r\n\t\tif( this.containsAbsBBox( x, y, ax + threshold, ay + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\tx, y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\tnull,\r\n\t\t\t\tthis._tester,\r\n\t\t\t\tnull\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontainsPointAbs(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbs( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcontainsPointAbsBBox(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbsBBox( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcalcHitPoint<RESULT>(\r\n\t\tpoint: IPoint,\r\n\t\ttoThreshold: EShapeLineOfAnyPointsToHitThreshold | null,\r\n\t\trange: EShapeLineOfAnyPointsTestRange | null,\r\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\r\n\t\tresult: RESULT\r\n\t): boolean {\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\tconst threshold = toHitThreshold( this, toThreshold );\r\n\t\tif( this.containsAbsBBox( rect.x, rect.y, rect.width + threshold, rect.height + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\trect.x, rect.y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\trange,\r\n\t\t\t\ttester || this._tester,\r\n\t\t\t\tresult\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeLineOfTriangleRoundeds } from \"./e-shape-line-of-triangle-roundeds\";\r\n\r\nexport const deserializeLineOfTriangleRoundeds = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeLineOfTriangleRoundeds> | EShapeLineOfTriangleRoundeds => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeLineOfTriangleRoundeds() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\r\nimport { EShapeCapability } from \"../e-shape-capability\";\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createLineOfTriangleRoundedsUploaded } from \"../variant/create-line-of-triangle-roundeds-uploaded\";\r\nimport { deserializeLineOfTriangleRoundeds } from \"../variant/deserialize-line-of-triangle-roundeds\";\r\n\r\nexport const loadShapeLineOfTriangleRoundeds = () => {\r\n\tEShapeUploadeds[ EShapeType.LINE_OF_TRIANGLE_ROUNDEDS ] = createLineOfTriangleRoundedsUploaded;\r\n\tEShapeDeserializers[ EShapeType.LINE_OF_TRIANGLE_ROUNDEDS ] = deserializeLineOfTriangleRoundeds;\r\n\tEShapeCapabilities.set(\r\n\t\tEShapeType.LINE_OF_TRIANGLE_ROUNDEDS,\r\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.BORDER_RADIUS\r\n\t);\r\n};\r\n","import { Matrix, Point, TextureUvs } from \"pixi.js\";\r\nimport { buildStep } from \"./build-step\";\r\nimport { toLength } from \"./to-length\";\r\nimport { STEP_VALUES, toStep } from \"./to-step\";\r\n\r\nexport const TRIANGLE_VERTEX_COUNT = 7;\r\nexport const TRIANGLE_INDEX_COUNT = 3;\r\nexport const TRIANGLE_WORLD_SIZE: [ number, number, number ] = [ 0, 0, 0 ];\r\nconst TRIANGLE_WORK_POINT: Point = new Point();\r\n\r\nexport const buildTriangleClipping = (\r\n\tclippings: Float32Array,\r\n\tvoffset: number\r\n): void => {\r\n\t// Clippings\r\n\tlet iv = voffset * 3;\r\n\tclippings[ iv + 0 ] = 0;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = 1;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = 1;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = 0;\r\n\tclippings[ iv + 1 ] = 1;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = 0;\r\n\tclippings[ iv + 1 ] = 1;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = 1;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n\tiv += 3;\r\n\r\n\tclippings[ iv + 0 ] = 1;\r\n\tclippings[ iv + 1 ] = 0;\r\n\tclippings[ iv + 2 ] = 0;\r\n};\r\n\r\nexport const buildTriangleIndex = (\r\n\tindices: Uint16Array | Uint32Array,\r\n\tvoffset: number,\r\n\tioffset: number\r\n): void => {\r\n\t// Indices\r\n\tconst ii = ioffset * 3;\r\n\tindices[ ii + 0 ] = voffset + 0;\r\n\tindices[ ii + 1 ] = voffset + 1;\r\n\tindices[ ii + 2 ] = voffset + 2;\r\n\r\n\tindices[ ii + 3 ] = voffset + 0;\r\n\tindices[ ii + 4 ] = voffset + 3;\r\n\tindices[ ii + 5 ] = voffset + 4;\r\n\r\n\tindices[ ii + 6 ] = voffset + 0;\r\n\tindices[ ii + 7 ] = voffset + 5;\r\n\tindices[ ii + 8 ] = voffset + 6;\r\n};\r\n\r\nexport const buildTriangleVertex = (\r\n\tvertices: Float32Array,\r\n\tvoffset: number,\r\n\toriginX: number,\r\n\toriginY: number,\r\n\tsizeX: number,\r\n\tsizeY: number,\r\n\tstrokeAlign: number,\r\n\tstrokeWidth: number,\r\n\tinternalTransform: Matrix,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\tconst s = strokeAlign * strokeWidth;\r\n\tconst sx = sizeX * 0.5 + (0 <= sizeX ? +s : -s);\r\n\tconst sy = sizeY * 0.5 + (0 <= sizeY ? +s : -s);\r\n\tconst sz = Math.sqrt( sx * sx + 4 * sy * sy );\r\n\tconst sw = 2 * sx * sy / (sx + sz);\r\n\r\n\tconst work = TRIANGLE_WORK_POINT;\r\n\twork.set( originX, originY - sy );\r\n\tinternalTransform.apply( work, work );\r\n\tconst x0 = work.x;\r\n\tconst y0 = work.y;\r\n\twork.set( originX, originY );\r\n\tinternalTransform.apply( work, work );\r\n\tconst tx = work.x;\r\n\tconst ty = work.y;\r\n\twork.set( originX + sx, originY );\r\n\tinternalTransform.apply( work, work );\r\n\tconst dx = tx - x0;\r\n\tconst dy = ty - y0;\r\n\tconst x1 = work.x + dx;\r\n\tconst y1 = work.y + dy;\r\n\tconst x2 = tx + (tx - work.x) + dx;\r\n\tconst y2 = ty + (ty - work.y) + dy;\r\n\twork.set( originX, originY + sy - sw ); // Incenter of a triangle\r\n\tinternalTransform.apply( work, work );\r\n\tconst x3 = work.x;\r\n\tconst y3 = work.y;\r\n\r\n\t// World size\r\n\tconst xb = tx + dx;\r\n\tconst yb = ty + dy;\r\n\tworldSize[ 0 ] = toLength( xb, yb, x3, y3 );\r\n\tworldSize[ 1 ] = toLength( x1, y1, xb, yb );\r\n\tworldSize[ 2 ] = toLength( x0, y0, tx, ty );\r\n\r\n\t// Vertices\r\n\tconst iv = voffset << 1;\r\n\tvertices[ iv +  0 ] = x3;\r\n\tvertices[ iv +  1 ] = y3;\r\n\r\n\tvertices[ iv +  2 ] = x0;\r\n\tvertices[ iv +  3 ] = y0;\r\n\tvertices[ iv +  4 ] = x1;\r\n\tvertices[ iv +  5 ] = y1;\r\n\r\n\tvertices[ iv +  6 ] = x1;\r\n\tvertices[ iv +  7 ] = y1;\r\n\tvertices[ iv +  8 ] = x2;\r\n\tvertices[ iv +  9 ] = y2;\r\n\r\n\tvertices[ iv + 10 ] = x2;\r\n\tvertices[ iv + 11 ] = y2;\r\n\tvertices[ iv + 12 ] = x0;\r\n\tvertices[ iv + 13 ] = y0;\r\n};\r\n\r\nexport const buildTriangleStep = (\r\n\tsteps: Float32Array,\r\n\tclippings: Float32Array,\r\n\tvoffset: number,\r\n\tvcount: number,\r\n\tstrokeWidth: number,\r\n\tantialiasWeight: number,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\ttoStep( worldSize[ 0 ], strokeWidth, antialiasWeight, STEP_VALUES );\r\n\tconst swc = STEP_VALUES[ 0 ];\r\n\tconst pc0 = STEP_VALUES[ 1 ];\r\n\tconst pc1 = STEP_VALUES[ 2 ];\r\n\r\n\tbuildStep(\r\n\t\tsteps,\r\n\t\tclippings,\r\n\t\tvoffset,\r\n\t\tvcount,\r\n\t\tswc, swc,\r\n\t\tpc0, pc0,\r\n\t\tpc1, pc1\r\n\t);\r\n};\r\n\r\nexport const buildTriangleUv = (\r\n\tuvs: Float32Array,\r\n\ttextureUvs: TextureUvs,\r\n\tvoffset: number,\r\n\tworldSize: [ number, number, number ]\r\n): void => {\r\n\tconst x0 = textureUvs.x0;\r\n\tconst x1 = textureUvs.x1;\r\n\tconst x2 = textureUvs.x2;\r\n\tconst x3 = textureUvs.x3;\r\n\tconst y0 = textureUvs.y0;\r\n\tconst y1 = textureUvs.y1;\r\n\tconst y2 = textureUvs.y2;\r\n\tconst y3 = textureUvs.y3;\r\n\r\n\tconst x4 = 0.5 * ( x0 + x1 );\r\n\tconst y4 = 0.5 * ( y0 + y1 );\r\n\r\n\tconst c = 1 - 0.5 * worldSize[ 0 ] / worldSize[ 2 ];\r\n\tconst x5 = x4 + c * ( x3 - x0 );\r\n\tconst y5 = y4 + c * ( y3 - y0 );\r\n\r\n\tconst iuv = voffset << 1;\r\n\tuvs[ iuv +  0 ] = x5;\r\n\tuvs[ iuv +  1 ] = y5;\r\n\r\n\tuvs[ iuv +  2 ] = x4;\r\n\tuvs[ iuv +  3 ] = y4;\r\n\tuvs[ iuv +  4 ] = x2;\r\n\tuvs[ iuv +  5 ] = y2;\r\n\r\n\tuvs[ iuv +  6 ] = x2;\r\n\tuvs[ iuv +  7 ] = y2;\r\n\tuvs[ iuv +  8 ] = x3;\r\n\tuvs[ iuv +  9 ] = y3;\r\n\r\n\tuvs[ iuv + 10 ] = x3;\r\n\tuvs[ iuv + 11 ] = y3;\r\n\tuvs[ iuv + 12 ] = x4;\r\n\tuvs[ iuv + 13 ] = y4;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { buildNullStep, buildNullUv, buildNullVertex } from \"./build-null\";\r\nimport {\r\n\tbuildTriangleClipping, buildTriangleIndex, buildTriangleStep, buildTriangleUv, buildTriangleVertex,\r\n\tTRIANGLE_INDEX_COUNT, TRIANGLE_VERTEX_COUNT, TRIANGLE_WORLD_SIZE\r\n} from \"./build-triangle\";\r\nimport { copyClipping } from \"./copy-clipping\";\r\nimport { copyIndex } from \"./copy-index\";\r\nimport { copyStep } from \"./copy-step\";\r\nimport { copyUvs } from \"./copy-uv\";\r\nimport { copyVertex } from \"./copy-vertex\";\r\nimport { EShapeLineOfAnyPoints } from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { EShapeLineOfAnyUploaded } from \"./e-shape-line-of-any-uploaded\";\r\n\r\nexport class EShapeLineOfTrianglesUploaded extends EShapeLineOfAnyUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateClippings();\r\n\t\tbuffer.updateIndices();\r\n\t\tconst clippings = buffer.clippings;\r\n\t\tconst indices = buffer.indices;\r\n\t\tconst voffset = this.vertexOffset;\r\n\t\tconst ioffset = this.indexOffset;\r\n\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\tif( 0 < pointCountReserved ) {\r\n\t\t\tbuildTriangleClipping(\r\n\t\t\t\tclippings,\r\n\t\t\t\tvoffset\r\n\t\t\t);\r\n\t\t\tcopyClipping(\r\n\t\t\t\tclippings,\r\n\t\t\t\tvoffset,\r\n\t\t\t\tTRIANGLE_VERTEX_COUNT,\r\n\t\t\t\tpointCountReserved\r\n\t\t\t);\r\n\t\t\tbuildTriangleIndex(\r\n\t\t\t\tindices,\r\n\t\t\t\tvoffset,\r\n\t\t\t\tioffset\r\n\t\t\t);\r\n\t\t\tcopyIndex(\r\n\t\t\t\tindices,\r\n\t\t\t\tTRIANGLE_VERTEX_COUNT,\r\n\t\t\t\tioffset,\r\n\t\t\t\tTRIANGLE_INDEX_COUNT,\r\n\t\t\t\tpointCountReserved\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tconst points = shape.points;\r\n\t\tif( points instanceof EShapeLineOfAnyPointsImpl ) {\r\n\t\t\tthis.updateVertexStepAndUvs( buffer, shape, points );\r\n\t\t\tthis.updateLineOfAnyColorFill( buffer, shape, points, TRIANGLE_VERTEX_COUNT );\r\n\t\t\tthis.updateLineOfAnyColorStroke( buffer, shape, points, TRIANGLE_VERTEX_COUNT );\r\n\t\t\tthis.updateText( buffer, shape );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateVertexStepAndUvs( buffer: EShapeBuffer, shape: EShape, points: EShapeLineOfAnyPoints ) {\r\n\t\tconst pointId = points.id;\r\n\t\tconst pointOffset = points.offset;\r\n\t\tconst pointOffsetId = pointOffset.id;\r\n\t\tconst isPointChanged = ( pointId !== this.pointId || pointOffsetId !== this.pointOffsetId );\r\n\r\n\t\tconst pointSize = points.size;\r\n\t\tconst pointSizeId = pointSize.id;\r\n\t\tconst isPointSizeChanged = ( pointSizeId !== this.pointSizeId );\r\n\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign || this.strokeWidth !== strokeWidth );\r\n\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tconst isTextureChanged = ( texture !== this.texture || textureTransformId !== this.textureTransformId );\r\n\r\n\t\tconst isVertexChanged = isPointChanged || isPointSizeChanged || isSizeChanged || isStrokeChanged;\r\n\r\n\t\tif( isVertexChanged || isTransformChanged || isTextureChanged ) {\r\n\t\t\tthis.pointId = pointId;\r\n\t\t\tthis.pointCount = points.length;\r\n\t\t\tthis.pointOffsetId = pointOffsetId;\r\n\t\t\tthis.pointSizeId = pointSizeId;\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\r\n\t\t\tif( isSizeChanged || isTransformChanged || isStrokeChanged ) {\r\n\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t}\r\n\r\n\t\t\t// Buffer\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t}\r\n\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\tbuffer.updateUvs();\r\n\t\t\t}\r\n\r\n\t\t\tconst pointCount = this.pointCount;\r\n\t\t\tconst pointsValues = points.values;\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\t\t\tconst vertices = buffer.vertices;\r\n\t\t\tconst steps = buffer.steps;\r\n\t\t\tconst clippings = buffer.clippings;\r\n\t\t\tconst uvs = buffer.uvs;\r\n\t\t\tconst textureUvs = this.toTextureUvs( texture );\r\n\t\t\tconst internalTransform = shape.transform.internalTransform;\r\n\t\t\tconst antialiasWeight = this.antialiasWeight;\r\n\t\t\tif( 0 < pointCount && pointSize.isStaticX() && pointSize.isStaticY() ) {\r\n\t\t\t\tconst pointSizeX = pointSize.getX( 0 );\r\n\t\t\t\tconst pointSizeY = pointSize.getY( 0 );\r\n\r\n\t\t\t\tbuildTriangleVertex(\r\n\t\t\t\t\tvertices,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\t0, 0,\r\n\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\tstrokeAlign,\r\n\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tTRIANGLE_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t\tcopyVertex(\r\n\t\t\t\t\tvertices,\r\n\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\tvoffset, TRIANGLE_VERTEX_COUNT,\r\n\t\t\t\t\tpointCount, pointsValues,\r\n\t\t\t\t\tpointOffset\r\n\t\t\t\t);\r\n\t\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\t\tbuildTriangleStep(\r\n\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tTRIANGLE_VERTEX_COUNT,\r\n\t\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\t\tTRIANGLE_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyStep(\r\n\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\tvoffset, TRIANGLE_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\t\tbuildTriangleUv(\r\n\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\ttextureUvs,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tTRIANGLE_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tcopyUvs(\r\n\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\tvoffset,\r\n\t\t\t\t\t\tTRIANGLE_VERTEX_COUNT,\r\n\t\t\t\t\t\tpointCount\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0; i < pointCount; ++i ) {\r\n\t\t\t\t\tconst ip = i << 1;\r\n\t\t\t\t\tconst px = pointsValues[ ip     ] + pointOffset.getX( i );\r\n\t\t\t\t\tconst py = pointsValues[ ip + 1 ] + pointOffset.getY( i );\r\n\t\t\t\t\tconst pointSizeX = pointSize.getX( i );\r\n\t\t\t\t\tconst pointSizeY = pointSize.getY( i );\r\n\t\t\t\t\tconst iv = voffset + i * TRIANGLE_VERTEX_COUNT;\r\n\r\n\t\t\t\t\tbuildTriangleVertex(\r\n\t\t\t\t\t\tvertices,\r\n\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\tpx, py,\r\n\t\t\t\t\t\tpointSizeX, pointSizeY,\r\n\t\t\t\t\t\tstrokeAlign,\r\n\t\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\t\tinternalTransform,\r\n\t\t\t\t\t\tTRIANGLE_WORLD_SIZE\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\t\t\tbuildTriangleStep(\r\n\t\t\t\t\t\t\tsteps,\r\n\t\t\t\t\t\t\tclippings,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\tTRIANGLE_VERTEX_COUNT,\r\n\t\t\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\t\t\tantialiasWeight,\r\n\t\t\t\t\t\t\tTRIANGLE_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\t\t\tbuildTriangleUv(\r\n\t\t\t\t\t\t\tuvs,\r\n\t\t\t\t\t\t\ttextureUvs,\r\n\t\t\t\t\t\t\tiv,\r\n\t\t\t\t\t\t\tTRIANGLE_WORLD_SIZE\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Fill the rest\r\n\t\t\tconst pointCountReserved = this.pointCountReserved;\r\n\t\t\tconst voffsetReserved = voffset + pointCount * TRIANGLE_VERTEX_COUNT;\r\n\t\t\tconst vcountReserved = TRIANGLE_VERTEX_COUNT * (pointCountReserved - pointCount);\r\n\t\t\tbuildNullVertex(\r\n\t\t\t\tvertices,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullStep(\r\n\t\t\t\tsteps,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t\tbuildNullUv(\r\n\t\t\t\tuvs,\r\n\t\t\t\tvoffsetReserved,\r\n\t\t\t\tvcountReserved\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { TRIANGLE_INDEX_COUNT, TRIANGLE_VERTEX_COUNT } from \"./build-triangle\";\r\nimport { createLineOfAnyUploaded } from \"./create-line-of-any-uploaded\";\r\nimport { EShapeLineOfTrianglesUploaded } from \"./e-shape-line-of-triangles-uploaded\";\r\n\r\nexport const createLineOfTrianglesUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeLineOfTrianglesUploaded | null => {\r\n\treturn createLineOfAnyUploaded(\r\n\t\tbuffer, shape,\r\n\t\tvoffset, TRIANGLE_VERTEX_COUNT,\r\n\t\tioffset, TRIANGLE_INDEX_COUNT,\r\n\t\tantialiasWeight,\r\n\t\tEShapeLineOfTrianglesUploaded\r\n\t);\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeBase } from \"./e-shape-base\";\r\nimport { EShapeLineOfAny } from \"./e-shape-line-of-any\";\r\nimport {\r\n\tEShapeLineOfAnyPoints, EShapeLineOfAnyPointsHitTester,\r\n\tEShapeLineOfAnyPointsTestRange, EShapeLineOfAnyPointsToHitThreshold\r\n} from \"./e-shape-line-of-any-points\";\r\nimport { EShapeLineOfAnyPointsImpl } from \"./e-shape-line-of-any-points-impl\";\r\nimport { EShapeTriangle } from \"./e-shape-triangle\";\r\nimport { toHitThreshold } from \"./to-hit-threshold\";\r\n\r\nexport class EShapeLineOfTriangles extends EShapeTriangle implements EShapeLineOfAny {\r\n\tpoints!: EShapeLineOfAnyPoints;\r\n\tprotected _tester: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\tprotected _testerBBox: EShapeLineOfAnyPointsHitTester<unknown>;\r\n\r\n\tconstructor( other?: EShapeLineOfTriangles ) {\r\n\t\tsuper( EShapeType.LINE_OF_TRIANGLES );\r\n\t\tif( other ) {\r\n\t\t\tthis.copy( other );\r\n\t\t} else {\r\n\t\t\tthis.points = new EShapeLineOfAnyPointsImpl( this );\r\n\t\t}\r\n\r\n\t\tthis._tester = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbs( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\r\n\t\tthis._testerBBox = ( x, y, ax, ay, ox, oy, px, py ): boolean => {\r\n\t\t\treturn this.containsPointAbsBBox( x, y, ax, ay, ox, oy, px, py );\r\n\t\t};\r\n\t}\r\n\r\n\tclone(): EShapeLineOfTriangles {\r\n\t\treturn new EShapeLineOfTriangles( this );\r\n\t}\r\n\r\n\tcontainsAbs( x: number, y: number, ax: number, ay: number ): boolean {\r\n\t\tconst threshold = toHitThreshold( this, null );\r\n\t\tif( this.containsAbsBBox( x, y, ax + threshold, ay + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\tx, y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\tnull,\r\n\t\t\t\tthis._tester,\r\n\t\t\t\tnull\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontainsPointAbs(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbs( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcontainsPointAbsBBox(\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number\r\n\t): boolean {\r\n\t\treturn super.containsAbsBBox( x - px - ox, y - py - oy, ax, ay );\r\n\t}\r\n\r\n\tcalcHitPoint<RESULT>(\r\n\t\tpoint: IPoint,\r\n\t\ttoThreshold: EShapeLineOfAnyPointsToHitThreshold | null,\r\n\t\trange: EShapeLineOfAnyPointsTestRange | null,\r\n\t\ttester: EShapeLineOfAnyPointsHitTester<RESULT> | null,\r\n\t\tresult: RESULT\r\n\t): boolean {\r\n\t\tconst rect = this.toLocalRect( point, EShapeBase.WORK_RECT );\r\n\t\tconst threshold = toHitThreshold( this, toThreshold );\r\n\t\tif( this.containsAbsBBox( rect.x, rect.y, rect.width + threshold, rect.height + threshold ) ) {\r\n\t\t\treturn this.points.calcHitPointAbs(\r\n\t\t\t\trect.x, rect.y,\r\n\t\t\t\tthreshold,\r\n\t\t\t\trange,\r\n\t\t\t\ttester || this._tester,\r\n\t\t\t\tresult\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeLineOfTriangles } from \"./e-shape-line-of-triangles\";\r\n\r\nexport const deserializeLineOfTriangles = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeLineOfTriangles> | EShapeLineOfTriangles => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeLineOfTriangles() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createLineOfTrianglesUploaded } from \"../variant/create-line-of-triangles-uploaded\";\r\nimport { deserializeLineOfTriangles } from \"../variant/deserialize-line-of-triangles\";\r\n\r\nexport const loadShapeLineOfTriangles = () => {\r\n\tEShapeUploadeds[ EShapeType.LINE_OF_TRIANGLES ] = createLineOfTrianglesUploaded;\r\n\tEShapeDeserializers[ EShapeType.LINE_OF_TRIANGLES ] = deserializeLineOfTriangles;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { EShapeUploadedBase } from \"../e-shape-uploaded\";\r\n\r\nexport class EShapeNullUploaded extends EShapeUploadedBase {\r\n\tconstructor( buffer: EShapeBuffer, voffset: number, ioffset: number ) {\r\n\t\tsuper( buffer, voffset, ioffset, 0, 0, 1 );\r\n\t}\r\n\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\t\tthis.texture = shape.texture || Texture.WHITE;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { EShapeNullUploaded } from \"./e-shape-null-uploaded\";\r\n\r\nexport const createNullUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number\r\n): EShapeNullUploaded | null => {\r\n\treturn new EShapeNullUploaded(\r\n\t\tbuffer,\r\n\t\tvoffset, ioffset\r\n\t).init( shape );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapePrimitive } from \"./e-shape-primitive\";\r\n\r\nexport class EShapeNull extends EShapePrimitive {\r\n\tconstructor( type: EShapeType = EShapeType.NULL ) {\r\n\t\tsuper( type );\r\n\t}\r\n\r\n\tclone(): EShapeNull {\r\n\t\treturn new EShapeNull().copy( this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeNull } from \"./e-shape-null\";\r\n\r\nexport const deserializeNull = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeNull> | EShapeNull => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeNull() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createNullUploaded } from \"../variant/create-null-uploaded\";\r\nimport { deserializeNull } from \"../variant/deserialize-null\";\r\n\r\nexport const loadShapeNull = () => {\r\n\tEShapeUploadeds[ EShapeType.NULL ] = createNullUploaded;\r\n\tEShapeDeserializers[ EShapeType.NULL ] = deserializeNull;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeRectangle } from \"./e-shape-rectangle\";\r\n\r\nexport const deserializeRectangle = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeRectangle> | EShapeRectangle => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeRectangle() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\r\nimport { EShapeCapability } from \"../e-shape-capability\";\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createRectangleUploaded } from \"../variant/create-rectangle-uploaded\";\r\nimport { deserializeRectangle } from \"../variant/deserialize-rectangle\";\r\n\r\nexport const loadShapeRectangle = () => {\r\n\tEShapeUploadeds[ EShapeType.RECTANGLE ] = createRectangleUploaded;\r\n\tEShapeDeserializers[ EShapeType.RECTANGLE ] = deserializeRectangle;\r\n\tEShapeCapabilities.set(\r\n\t\tEShapeType.RECTANGLE,\r\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE\r\n\t);\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport {\r\n\tbuildRectangleRoundedClipping, buildRectangleRoundedIndex, buildRectangleRoundedStep,\r\n\tbuildRectangleRoundedUv, buildRectangleRoundedVertex, RECTANGLE_ROUNDED_WORLD_SIZE\r\n} from \"./build-rectangle-rounded\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport class EShapeRectangleRoundedUploaded extends EShapeTextUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateIndices();\r\n\t\tbuildRectangleRoundedIndex(\r\n\t\t\tbuffer.indices,\r\n\t\t\tthis.vertexOffset,\r\n\t\t\tthis.indexOffset\r\n\t\t);\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tthis.updateVertexClippingStepAndUv( buffer, shape );\r\n\t\tthis.updateColor( buffer, shape );\r\n\t\tthis.updateText( buffer, shape );\r\n\t}\r\n\r\n\tprotected updateVertexClippingStepAndUv( buffer: EShapeBuffer, shape: EShape ) {\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst radius = shape.radius;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY || radius !== this.radius );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst strokeSide = stroke.side;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign ||\r\n\t\t\tthis.strokeWidth !== strokeWidth || this.strokeSide !== strokeSide );\r\n\r\n\t\tconst corner = shape.corner;\r\n\t\tconst isCornerChanged = ( corner !== this.corner );\r\n\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tconst isTextureChanged = ( texture !== this.texture || textureTransformId !== this.textureTransformId );\r\n\r\n\t\tconst isVertexChanged = isSizeChanged || isStrokeChanged;\r\n\r\n\t\tif( isVertexChanged || isTransformChanged || isCornerChanged || isTextureChanged ) {\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.radius = radius;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeSide = strokeSide;\r\n\t\t\tthis.corner = corner;\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t}\r\n\r\n\t\t\t// Vertices\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tbuildRectangleRoundedVertex(\r\n\t\t\t\tbuffer.vertices, voffset,\r\n\t\t\t\t0, 0,\r\n\t\t\t\tsizeX, sizeY,\r\n\t\t\t\tstrokeAlign, strokeWidth, radius,\r\n\t\t\t\tshape.transform.internalTransform,\r\n\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t);\r\n\r\n\t\t\t// Steps\r\n\t\t\tif( isVertexChanged || isCornerChanged || isTransformChanged ) {\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t\tbuildRectangleRoundedStep(\r\n\t\t\t\t\tbuffer.steps,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tstrokeWidth, strokeSide,\r\n\t\t\t\t\tcorner,\r\n\t\t\t\t\tthis.antialiasWeight,\r\n\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// Clippings\r\n\t\t\tif( isVertexChanged || isCornerChanged ) {\r\n\t\t\t\tbuffer.updateClippings();\r\n\t\t\t\tbuildRectangleRoundedClipping(\r\n\t\t\t\t\tbuffer.clippings,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tcorner,\r\n\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// UVs\r\n\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\tbuffer.updateUvs();\r\n\t\t\t\tbuildRectangleRoundedUv(\r\n\t\t\t\t\tbuffer.uvs,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tthis.toTextureUvs( texture ),\r\n\t\t\t\t\tRECTANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { RECTANGLE_ROUNDED_INDEX_COUNT, RECTANGLE_ROUNDED_VERTEX_COUNT } from \"./build-rectangle-rounded\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\nimport { EShapeRectangleRoundedUploaded } from \"./e-shape-rectangle-rounded-uploaded\";\r\n\r\nexport const createRectangleRoundedUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeRectangleRoundedUploaded | null => {\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst vcount = RECTANGLE_ROUNDED_VERTEX_COUNT + tvcount;\r\n\tconst icount = RECTANGLE_ROUNDED_INDEX_COUNT + ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new EShapeRectangleRoundedUploaded(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeRectangleRounded } from \"./e-shape-rectangle-rounded\";\r\n\r\nexport const deserializeRectangleRounded = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeRectangleRounded> | EShapeRectangleRounded => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeRectangleRounded() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\r\nimport { EShapeCapability } from \"../e-shape-capability\";\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createRectangleRoundedUploaded } from \"../variant/create-rectangle-rounded-uploaded\";\r\nimport { deserializeRectangleRounded } from \"../variant/deserialize-rectangle-rounded\";\r\n\r\nexport const loadShapeRectangleRounded = () => {\r\n\tEShapeUploadeds[ EShapeType.RECTANGLE_ROUNDED ] = createRectangleRoundedUploaded;\r\n\tEShapeDeserializers[ EShapeType.RECTANGLE_ROUNDED ] = deserializeRectangleRounded;\r\n\tEShapeCapabilities.set(\r\n\t\tEShapeType.RECTANGLE_ROUNDED,\r\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.STROKE_SIDE | EShapeCapability.BORDER_RADIUS\r\n\t);\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport {\r\n\tbuildTriangleClipping, buildTriangleIndex, buildTriangleStep, buildTriangleUv,\r\n\tbuildTriangleVertex, TRIANGLE_VERTEX_COUNT, TRIANGLE_WORLD_SIZE\r\n} from \"./build-triangle\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport class EShapeTriangleUploaded extends EShapeTextUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateClippings();\r\n\t\tbuffer.updateIndices();\r\n\t\tbuildTriangleClipping(\r\n\t\t\tbuffer.clippings,\r\n\t\t\tthis.vertexOffset\r\n\t\t);\r\n\t\tbuildTriangleIndex(\r\n\t\t\tbuffer.indices,\r\n\t\t\tthis.vertexOffset,\r\n\t\t\tthis.indexOffset\r\n\t\t);\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tthis.updateVertexStepAndUv( buffer, shape );\r\n\t\tthis.updateColor( buffer, shape );\r\n\t\tthis.updateText( buffer, shape );\r\n\t}\r\n\r\n\tprotected updateVertexStepAndUv( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign || this.strokeWidth !== strokeWidth );\r\n\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tconst isTextureChanged = ( texture !== this.texture || textureTransformId !== this.textureTransformId );\r\n\r\n\t\tconst isVertexChanged = isSizeChanged || isStrokeChanged;\r\n\r\n\t\tif( isVertexChanged || isTransformChanged || isTextureChanged ) {\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t}\r\n\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tbuildTriangleVertex(\r\n\t\t\t\tbuffer.vertices,\r\n\t\t\t\tvoffset,\r\n\t\t\t\t0, 0,\r\n\t\t\t\tsizeX, sizeY,\r\n\t\t\t\tstrokeAlign,\r\n\t\t\t\tstrokeWidth,\r\n\t\t\t\tshape.transform.internalTransform,\r\n\t\t\t\tTRIANGLE_WORLD_SIZE\r\n\t\t\t);\r\n\r\n\t\t\tif( isVertexChanged || isTransformChanged ) {\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t\tbuildTriangleStep(\r\n\t\t\t\t\tbuffer.steps,\r\n\t\t\t\t\tbuffer.clippings,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tTRIANGLE_VERTEX_COUNT,\r\n\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\tthis.antialiasWeight,\r\n\t\t\t\t\tTRIANGLE_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\tbuffer.updateUvs();\r\n\t\t\t\tbuildTriangleUv(\r\n\t\t\t\t\tbuffer.uvs,\r\n\t\t\t\t\tthis.toTextureUvs( texture ),\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tTRIANGLE_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\nimport { TRIANGLE_INDEX_COUNT, TRIANGLE_VERTEX_COUNT } from \"./build-triangle\";\r\nimport { EShapeTriangleUploaded } from \"./e-shape-triangle-uploaded\";\r\n\r\nexport const createTriangleUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeTriangleUploaded | null => {\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst vcount = TRIANGLE_VERTEX_COUNT + tvcount;\r\n\tconst icount = TRIANGLE_INDEX_COUNT + ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new EShapeTriangleUploaded(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeTriangle } from \"./e-shape-triangle\";\r\n\r\nexport const deserializeTriangle = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeTriangle> | EShapeTriangle => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeTriangle() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createTriangleUploaded } from \"../variant/create-triangle-uploaded\";\r\nimport { deserializeTriangle } from \"../variant/deserialize-triangle\";\r\n\r\nexport const loadShapeTriangle = () => {\r\n\tEShapeUploadeds[ EShapeType.TRIANGLE ] = createTriangleUploaded;\r\n\tEShapeDeserializers[ EShapeType.TRIANGLE ] = deserializeTriangle;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport {\r\n\tbuildTriangleRoundedClipping, buildTriangleRoundedIndex, buildTriangleRoundedStep,\r\n\tbuildTriangleRoundedUv, buildTriangleRoundedVertex, TRIANGLE_ROUNDED_WORLD_SIZE\r\n} from \"./build-triangle-rounded\";\r\nimport { EShapeTextUploaded } from \"./e-shape-text-uploaded\";\r\n\r\nexport class EShapeTriangleRoundedUploaded extends EShapeTextUploaded {\r\n\tinit( shape: EShape ): this {\r\n\t\tsuper.init( shape );\r\n\r\n\t\t// Indices\r\n\t\tconst buffer = this.buffer;\r\n\t\tbuffer.updateIndices();\r\n\t\tbuildTriangleRoundedIndex(\r\n\t\t\tbuffer.indices,\r\n\t\t\tthis.vertexOffset,\r\n\t\t\tthis.indexOffset\r\n\t\t);\r\n\r\n\t\t// Text\r\n\t\tthis.initText();\r\n\r\n\t\tthis.update( shape );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tupdate( shape: EShape ): void {\r\n\t\tconst buffer = this.buffer;\r\n\t\tthis.updateVertexClippingStepAndUv( buffer, shape );\r\n\t\tthis.updateColor( buffer, shape );\r\n\t\tthis.updateText( buffer, shape );\r\n\t}\r\n\r\n\tprotected updateVertexClippingStepAndUv( buffer: EShapeBuffer, shape: EShape ): void {\r\n\t\tconst size = shape.size;\r\n\t\tconst sizeX = size.x;\r\n\t\tconst sizeY = size.y;\r\n\t\tconst isSizeChanged = ( sizeX !== this.sizeX || sizeY !== this.sizeY );\r\n\r\n\t\tconst radius = shape.radius;\r\n\t\tconst isRadiusChanged = ( radius !== this.radius );\r\n\r\n\t\tconst transformLocalId = this.toTransformLocalId( shape );\r\n\t\tconst isTransformChanged = ( this.transformLocalId !== transformLocalId );\r\n\r\n\t\tconst stroke = shape.stroke;\r\n\t\tconst strokeWidth = (stroke.enable ? stroke.width : 0);\r\n\t\tconst strokeAlign = stroke.align;\r\n\t\tconst isStrokeChanged = ( this.strokeAlign !== strokeAlign || this.strokeWidth !== strokeWidth );\r\n\r\n\t\tconst corner = shape.corner;\r\n\t\tconst isCornerChanged = ( corner !== this.corner );\r\n\r\n\t\tconst texture = this.toTexture( shape );\r\n\t\tconst textureTransformId = this.toTextureTransformId( texture );\r\n\t\tconst isTextureChanged = ( texture !== this.texture || textureTransformId !== this.textureTransformId );\r\n\r\n\t\tconst isVertexChanged = isSizeChanged || isRadiusChanged || isStrokeChanged;\r\n\r\n\t\tif( isVertexChanged || isTransformChanged || isCornerChanged || isTextureChanged ) {\r\n\t\t\tthis.sizeX = sizeX;\r\n\t\t\tthis.sizeY = sizeY;\r\n\t\t\tthis.radius = radius;\r\n\t\t\tthis.transformLocalId = transformLocalId;\r\n\t\t\tthis.strokeWidth = strokeWidth;\r\n\t\t\tthis.strokeAlign = strokeAlign;\r\n\t\t\tthis.corner = corner;\r\n\t\t\tthis.texture = texture;\r\n\t\t\tthis.textureTransformId = textureTransformId;\r\n\r\n\t\t\tif( isSizeChanged || isTransformChanged || isStrokeChanged ) {\r\n\t\t\t\t// Invalidate the text layout to update the text layout.\r\n\t\t\t\tthis.textSpacingHorizontal = NaN;\r\n\t\t\t}\r\n\r\n\t\t\tconst voffset = this.vertexOffset;\r\n\r\n\t\t\tbuffer.updateVertices();\r\n\t\t\tbuildTriangleRoundedVertex(\r\n\t\t\t\tbuffer.vertices,\r\n\t\t\t\tvoffset,\r\n\t\t\t\t0,\r\n\t\t\t\t0,\r\n\t\t\t\tsizeX,\r\n\t\t\t\tsizeY,\r\n\t\t\t\tstrokeAlign,\r\n\t\t\t\tstrokeWidth,\r\n\t\t\t\tradius,\r\n\t\t\t\tshape.transform.internalTransform,\r\n\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t);\r\n\r\n\t\t\tif( isRadiusChanged || isCornerChanged ) {\r\n\t\t\t\tbuffer.updateClippings();\r\n\t\t\t\tbuildTriangleRoundedClipping(\r\n\t\t\t\t\tbuffer.clippings,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tcorner,\r\n\t\t\t\t\tradius\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif( isVertexChanged || isTransformChanged || isCornerChanged ) {\r\n\t\t\t\tbuffer.updateSteps();\r\n\t\t\t\tbuildTriangleRoundedStep(\r\n\t\t\t\t\tbuffer.steps,\r\n\t\t\t\t\tbuffer.clippings,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tstrokeWidth,\r\n\t\t\t\t\tshape.radius,\r\n\t\t\t\t\tthis.antialiasWeight,\r\n\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif( isVertexChanged || isTextureChanged ) {\r\n\t\t\t\tbuffer.updateUvs();\r\n\t\t\t\tbuildTriangleRoundedUv(\r\n\t\t\t\t\tbuffer.uvs,\r\n\t\t\t\t\tvoffset,\r\n\t\t\t\t\tthis.toTextureUvs( texture ),\r\n\t\t\t\t\tradius,\r\n\t\t\t\t\tTRIANGLE_ROUNDED_WORLD_SIZE\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"../e-shape\";\r\nimport { EShapeBuffer } from \"../e-shape-buffer\";\r\nimport { TEXT_INDEX_COUNT, TEXT_VERTEX_COUNT, toTextBufferCount } from \"./build-text\";\r\nimport { TRIANGLE_ROUNDED_INDEX_COUNT, TRIANGLE_ROUNDED_VERTEX_COUNT } from \"./build-triangle-rounded\";\r\nimport { EShapeTriangleRoundedUploaded } from \"./e-shape-triangle-rounded-uploaded\";\r\n\r\nexport const createTriangleRoundedUploaded = (\r\n\tbuffer: EShapeBuffer, shape: EShape,\r\n\tvoffset: number, ioffset: number,\r\n\tantialiasWeight: number\r\n): EShapeTriangleRoundedUploaded | null => {\r\n\tconst tcount = toTextBufferCount( shape );\r\n\tconst tvcount = tcount * TEXT_VERTEX_COUNT;\r\n\tconst ticount = tcount * TEXT_INDEX_COUNT;\r\n\tconst vcount = TRIANGLE_ROUNDED_VERTEX_COUNT + tvcount;\r\n\tconst icount = TRIANGLE_ROUNDED_INDEX_COUNT + ticount;\r\n\tif( buffer.check( voffset, ioffset, vcount, icount ) ) {\r\n\t\treturn new EShapeTriangleRoundedUploaded(\r\n\t\t\tbuffer,\r\n\t\t\tvoffset, ioffset,\r\n\t\t\ttvcount, ticount,\r\n\t\t\tvcount, icount,\r\n\t\t\tantialiasWeight\r\n\t\t).init( shape );\r\n\t}\r\n\treturn null;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem } from \"../../d-diagram-serialized\";\r\nimport { EShapeDeserializer } from \"../e-shape-deserializer\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeTriangleRounded } from \"./e-shape-triangle-rounded\";\r\n\r\nexport const deserializeTriangleRounded = (\r\n\titem: DDiagramSerializedItem, manager: EShapeResourceManagerDeserialization\r\n): Promise<EShapeTriangleRounded> | EShapeTriangleRounded => {\r\n\treturn EShapeDeserializer.deserialize( item, manager, new EShapeTriangleRounded() );\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeCapabilities } from \"../e-shape-capabilities\";\r\nimport { EShapeCapability } from \"../e-shape-capability\";\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createTriangleRoundedUploaded } from \"../variant/create-triangle-rounded-uploaded\";\r\nimport { deserializeTriangleRounded } from \"../variant/deserialize-triangle-rounded\";\r\n\r\nexport const loadShapeTriangleRounded = () => {\r\n\tEShapeUploadeds[ EShapeType.TRIANGLE_ROUNDED ] = createTriangleRoundedUploaded;\r\n\tEShapeDeserializers[ EShapeType.TRIANGLE_ROUNDED ] = deserializeTriangleRounded;\r\n\tEShapeCapabilities.set(\r\n\t\tEShapeType.TRIANGLE_ROUNDED,\r\n\t\tEShapeCapability.PRIMITIVE | EShapeCapability.BORDER_RADIUS\r\n\t);\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { loadShapeBar } from \"./load-shape-bar\";\r\nimport { loadShapeCircle } from \"./load-shape-circle\";\r\nimport { loadShapeGroup } from \"./load-shape-group\";\r\nimport { loadShapeGroupShadowed } from \"./load-shape-group-shadowed\";\r\nimport { loadShapeImage } from \"./load-shape-image\";\r\nimport { loadShapeImageSdf } from \"./load-shape-image-sdf\";\r\nimport { loadShapeLabel } from \"./load-shape-label\";\r\nimport { loadShapeLine } from \"./load-shape-line\";\r\nimport { loadShapeLineOfCircles } from \"./load-shape-line-of-circles\";\r\nimport { loadShapeLineOfRectangleRoundeds } from \"./load-shape-line-of-rectangle-roundeds\";\r\nimport { loadShapeLineOfRectangles } from \"./load-shape-line-of-rectangles\";\r\nimport { loadShapeLineOfTriangleRoundeds } from \"./load-shape-line-of-triangle-roundeds\";\r\nimport { loadShapeLineOfTriangles } from \"./load-shape-line-of-triangles\";\r\nimport { loadShapeNull } from \"./load-shape-null\";\r\nimport { loadShapeRectangle } from \"./load-shape-rectangle\";\r\nimport { loadShapeRectangleRounded } from \"./load-shape-rectangle-rounded\";\r\nimport { loadShapeTriangle } from \"./load-shape-triangle\";\r\nimport { loadShapeTriangleRounded } from \"./load-shape-triangle-rounded\";\r\n\r\nexport const loadShapeAll = () => {\r\n\tloadShapeBar();\r\n\tloadShapeCircle();\r\n\tloadShapeGroupShadowed();\r\n\tloadShapeGroup();\r\n\tloadShapeImage();\r\n\tloadShapeImageSdf();\r\n\tloadShapeLabel();\r\n\tloadShapeLine();\r\n\tloadShapeNull();\r\n\tloadShapeRectangleRounded();\r\n\tloadShapeRectangle();\r\n\tloadShapeTriangleRounded();\r\n\tloadShapeTriangle();\r\n\tloadShapeLineOfCircles();\r\n\tloadShapeLineOfRectangleRoundeds();\r\n\tloadShapeLineOfRectangles();\r\n\tloadShapeLineOfTriangleRoundeds();\r\n\tloadShapeLineOfTriangles();\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeDeserializers } from \"../e-shape-deserializers\";\r\nimport { EShapeType } from \"../e-shape-type\";\r\nimport { EShapeUploadeds } from \"../e-shape-uploadeds\";\r\nimport { createImageSdfUploaded } from \"../variant/create-image-sdf-uploaded\";\r\nimport { deserializeImageSdf } from \"../variant/deserialize-image-sdf\";\r\n\r\nexport const loadShapeImageSdf = () => {\r\n\tEShapeUploadeds[ EShapeType.IMAGE_SDF ] = createImageSdfUploaded;\r\n\tEShapeDeserializers[ EShapeType.IMAGE_SDF ] = deserializeImageSdf;\r\n};\r\n","import { DynamicFontAtlasCharacter } from \"./util/dynamic-font-atlas-character\";\r\n\r\nexport class DDynamicTextMeasureResultCharacter {\r\n\tx: number;\r\n\ty: number;\r\n\tcharacter: DynamicFontAtlasCharacter;\r\n\r\n\tconstructor( x: number, y: number, character: DynamicFontAtlasCharacter ) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.character = character;\r\n\t}\r\n\r\n\tset( x: number, y: number, character: DynamicFontAtlasCharacter ): void {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.character = character;\r\n\t}\r\n}\r\n","import { DDynamicTextMeasureResultCharacter } from \"./d-dynamic-text-measure-result-character\";\r\nimport { DynamicFontAtlasCharacter } from \"./util/dynamic-font-atlas-character\";\r\n\r\nexport class DDynamicTextMeasureResult {\r\n\tcount: number;\r\n\twidth: number;\r\n\theight: number;\r\n\tcharacters: DDynamicTextMeasureResultCharacter[];\r\n\tclipped: boolean;\r\n\r\n\tx: number;\r\n\ty: number;\r\n\r\n\tconstructor() {\r\n\t\tthis.count = 0;\r\n\t\tthis.width = 0;\r\n\t\tthis.height = 0;\r\n\t\tthis.characters = [];\r\n\t\tthis.clipped = false;\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t}\r\n\r\n\tstart(): void {\r\n\t\tthis.count = 0;\r\n\t\tthis.width = 0;\r\n\t\tthis.height = 0;\r\n\t\tthis.clipped = false;\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t}\r\n\r\n\tpush( character: DynamicFontAtlasCharacter ): void {\r\n\t\tconst x = this.x;\r\n\t\tthis.x += character.advance;\r\n\t\tconst y = this.y;\r\n\t\tconst count = this.count;\r\n\t\tconst characters = this.characters;\r\n\t\tif( count < characters.length ) {\r\n\t\t\tcharacters[ count ].set( x, y, character );\r\n\t\t} else {\r\n\t\t\tcharacters.push( new DDynamicTextMeasureResultCharacter( x, y, character ) );\r\n\t\t}\r\n\t\tthis.count += 1;\r\n\t}\r\n\r\n\tnewLine( lineHeight: number ): void {\r\n\t\tthis.width = Math.max( this.width, this.x );\r\n\t\tthis.x = 0;\r\n\t\tthis.y += lineHeight;\r\n\t}\r\n\r\n\tpop(): boolean {\r\n\t\tif( 0 < this.x ) {\r\n\t\t\tconst count = this.count;\r\n\t\t\tconst characters = this.characters;\r\n\t\t\tif( 0 < count ) {\r\n\t\t\t\tconst character = characters[ count - 1 ];\r\n\t\t\t\tthis.x -= character.character.advance;\r\n\t\t\t\tthis.count -= 1;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tend( lineHeight: number ): void {\r\n\t\tthis.newLine( lineHeight );\r\n\t\tthis.height = this.y;\r\n\t}\r\n}\r\n","import { DDynamicTextMeasureResult } from \"./d-dynamic-text-measure-result\";\r\nimport { DynamicFontAtlas } from \"./util/dynamic-font-atlas\";\r\nimport { UtilCharacterIterator } from \"./util/util-character-iterator\";\r\n\r\nexport class DDynamicTextMeasure {\r\n\tprotected static RESULT: DDynamicTextMeasureResult | null = null;\r\n\r\n\tstatic measure(\r\n\t\ttext: string, atlas: DynamicFontAtlas | null, clippingWidth: number | undefined\r\n\t): DDynamicTextMeasureResult {\r\n\t\tconst result = DDynamicTextMeasure.RESULT = DDynamicTextMeasure.RESULT || new DDynamicTextMeasureResult();\r\n\t\tresult.start();\r\n\t\tif( atlas != null ) {\r\n\t\t\tconst iterator = UtilCharacterIterator.from( text );\r\n\t\t\tconst lineHeight = atlas.font.height;\r\n\t\t\tconst newLine = \"\\n\";\r\n\t\t\twhile( iterator.hasNext() ) {\r\n\t\t\t\tconst character = iterator.next();\r\n\t\t\t\tif( character === newLine ) {\r\n\t\t\t\t\tresult.newLine( lineHeight );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst a = atlas.get( character );\r\n\t\t\t\t\tif( a != null ) {\r\n\t\t\t\t\t\tif( clippingWidth != null && clippingWidth < result.x + a.advance ) {\r\n\t\t\t\t\t\t\tresult.clipped = true;\r\n\t\t\t\t\t\t\tconst dots = atlas.get( \"...\" );\r\n\t\t\t\t\t\t\tif( dots != null ) {\r\n\t\t\t\t\t\t\t\twhile( clippingWidth - dots.advance < result.x ) {\r\n\t\t\t\t\t\t\t\t\tif( ! result.pop() ) {\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif( result.x <= clippingWidth - dots.advance ) {\r\n\t\t\t\t\t\t\t\t\tresult.push( dots );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\twhile( iterator.hasNext() ) {\r\n\t\t\t\t\t\t\t\tif( iterator.next() === newLine ) {\r\n\t\t\t\t\t\t\t\t\tresult.newLine( lineHeight );\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresult.push( a );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tresult.end( lineHeight );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { MeshGeometry } from \"pixi.js\";\r\nimport { DDynamicTextMeasure } from \"./d-dynamic-text-measure\";\r\nimport { DynamicFontAtlas } from \"./util/dynamic-font-atlas\";\r\nimport { DynamicFontAtlasCharacter } from \"./util/dynamic-font-atlas-character\";\r\n\r\nexport class DDynamicTextGeometry extends MeshGeometry {\r\n\twidth: number;\r\n\theight: number;\r\n\tclipped: boolean;\r\n\r\n\tconstructor() {\r\n\t\tsuper( new Float32Array( 64 ), new Float32Array( 64 ), new Uint16Array( 48 ) );\r\n\t\tthis.width = 0;\r\n\t\tthis.height = 0;\r\n\t\tthis.clipped = false;\r\n\t}\r\n\r\n\tupdate( text: string, atlas: DynamicFontAtlas | null, clippingWidth: number | undefined ): void {\r\n\t\tconst vertexBuffer = this.getBuffer( \"aVertexPosition\" );\r\n\t\tconst uvBuffer = this.getBuffer( \"aTextureCoord\" );\r\n\t\tconst indexBuffer = this.getIndex();\r\n\r\n\t\tconst result = DDynamicTextMeasure.measure( text, atlas, clippingWidth );\r\n\t\tconst requiredTextSize = Math.ceil( result.count / 8 ) << 3;\r\n\t\tconst requiredVertexSize = requiredTextSize << 3;\r\n\t\tif( (vertexBuffer.data as Float32Array).length < requiredVertexSize ) {\r\n\t\t\tvertexBuffer.data = new Float32Array( requiredVertexSize );\r\n\t\t\tuvBuffer.data = new Float32Array( requiredVertexSize );\r\n\t\t}\r\n\t\tconst requiredIndexSize = requiredTextSize * 6;\r\n\t\tif( (indexBuffer.data as Uint16Array).length < requiredIndexSize ) {\r\n\t\t\tindexBuffer.data = new Uint16Array( requiredIndexSize );\r\n\t\t}\r\n\r\n\t\tconst vertices = vertexBuffer.data as Float32Array;\r\n\t\tconst uvs = uvBuffer.data as Float32Array;\r\n\t\tconst indices = indexBuffer.data as Uint16Array;\r\n\r\n\t\tif( atlas != null ) {\r\n\t\t\tconst count = result.count;\r\n\t\t\tconst characters = result.characters;\r\n\t\t\tfor( let i = 0; i < count; ++i ) {\r\n\t\t\t\tconst character = characters[ i ];\r\n\t\t\t\tthis.writeCharacter(\r\n\t\t\t\t\tvertices, uvs, indices,\r\n\t\t\t\t\ti, character.x, character.y,\r\n\t\t\t\t\tcharacter.character, atlas.width, atlas.height\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\tfor( let i = count, imax = vertices.length >> 3; i < imax; ++i ) {\r\n\t\t\t\tthis.writeCharacterEmpty( vertices, uvs, indices, i );\r\n\t\t\t}\r\n\t\t\tthis.width = result.width;\r\n\t\t\tthis.height = result.height;\r\n\t\t\tthis.clipped = result.clipped;\r\n\t\t} else {\r\n\t\t\tfor( let i = 0, imax = vertices.length >> 3; i < imax; ++i ) {\r\n\t\t\t\tthis.writeCharacterEmpty( vertices, uvs, indices, i );\r\n\t\t\t}\r\n\t\t\tthis.width = 0;\r\n\t\t\tthis.height = 0;\r\n\t\t\tthis.clipped = false;\r\n\t\t}\r\n\r\n\t\tvertexBuffer.update();\r\n\t\tuvBuffer.update();\r\n\t\tindexBuffer.update();\r\n\t}\r\n\r\n\tprotected writeCharacter(\r\n\t\tvertices: Float32Array, uvs: Float32Array, indices: Uint16Array,\r\n\t\tindex: number, x: number, y: number,\r\n\t\tcharacter: DynamicFontAtlasCharacter,\r\n\t\twidth: number, height: number\r\n\t): void {\r\n\t\tconst offsetX = character.x - character.origin.x;\r\n\t\tconst offsetY = 0;\r\n\r\n\t\tconst iv = index << 3;\r\n\t\tvertices[ iv + 0 ] = x + offsetX;\r\n\t\tvertices[ iv + 1 ] = y + offsetY;\r\n\t\tvertices[ iv + 2 ] = x + offsetX + character.width;\r\n\t\tvertices[ iv + 3 ] = y + offsetY;\r\n\t\tvertices[ iv + 4 ] = x + offsetX + character.width;\r\n\t\tvertices[ iv + 5 ] = y + offsetY + character.height;\r\n\t\tvertices[ iv + 6 ] = x + offsetX;\r\n\t\tvertices[ iv + 7 ] = y + offsetY + character.height;\r\n\r\n\t\tconst x0 = character.x / width;\r\n\t\tconst y0 = character.y / height;\r\n\t\tconst x1 = ( character.x + character.width ) / width;\r\n\t\tconst y1 = ( character.y + character.height ) / height;\r\n\t\tuvs[ iv + 0 ] = x0;\r\n\t\tuvs[ iv + 1 ] = y0;\r\n\t\tuvs[ iv + 2 ] = x1;\r\n\t\tuvs[ iv + 3 ] = y0;\r\n\t\tuvs[ iv + 4 ] = x1;\r\n\t\tuvs[ iv + 5 ] = y1;\r\n\t\tuvs[ iv + 6 ] = x0;\r\n\t\tuvs[ iv + 7 ] = y1;\r\n\r\n\t\tconst ii = index * 6;\r\n\t\tconst vo = index << 2;\r\n\t\tindices[ ii + 0 ] = vo + 0;\r\n\t\tindices[ ii + 1 ] = vo + 1;\r\n\t\tindices[ ii + 2 ] = vo + 3;\r\n\t\tindices[ ii + 3 ] = vo + 1;\r\n\t\tindices[ ii + 4 ] = vo + 2;\r\n\t\tindices[ ii + 5 ] = vo + 3;\r\n\t}\r\n\r\n\tprotected writeCharacterEmpty(\r\n\t\tvertices: Float32Array, uvs: Float32Array, indices: Uint16Array,\r\n\t\tindex: number\r\n\t): void {\r\n\t\tconst iv = index << 3;\r\n\t\tvertices[ iv + 0 ] = 0;\r\n\t\tvertices[ iv + 1 ] = 0;\r\n\t\tvertices[ iv + 2 ] = 0;\r\n\t\tvertices[ iv + 3 ] = 0;\r\n\t\tvertices[ iv + 4 ] = 0;\r\n\t\tvertices[ iv + 5 ] = 0;\r\n\t\tvertices[ iv + 6 ] = 0;\r\n\t\tvertices[ iv + 7 ] = 0;\r\n\r\n\t\tuvs[ iv + 0 ] = 0;\r\n\t\tuvs[ iv + 1 ] = 0;\r\n\t\tuvs[ iv + 2 ] = 0;\r\n\t\tuvs[ iv + 3 ] = 0;\r\n\t\tuvs[ iv + 4 ] = 0;\r\n\t\tuvs[ iv + 5 ] = 0;\r\n\t\tuvs[ iv + 6 ] = 0;\r\n\t\tuvs[ iv + 7 ] = 0;\r\n\r\n\t\tconst ii = index * 6;\r\n\t\tconst vo = index << 2;\r\n\t\tindices[ ii + 0 ] = vo + 0;\r\n\t\tindices[ ii + 1 ] = vo + 1;\r\n\t\tindices[ ii + 2 ] = vo + 3;\r\n\t\tindices[ ii + 3 ] = vo + 1;\r\n\t\tindices[ ii + 4 ] = vo + 2;\r\n\t\tindices[ ii + 5 ] = vo + 3;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DFontStyle, DFontVariant, DFontWeight, DThemeFont } from \"./d-font\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\n\r\nexport type DDynamicTextAlign = \"left\" | \"center\" | \"right\";\r\n\r\nexport interface DDynamicTextStyleOptions {\r\n\talign?: DDynamicTextAlign;\r\n\tfontFamily?: string;\r\n\tfontSize?: number;\r\n\tfontStyle?: DFontStyle;\r\n\tfontVariant?: DFontVariant;\r\n\tfontWeight?: DFontWeight;\r\n\tfill?: number;\r\n\tclipping?: boolean;\r\n}\r\n\r\nexport class DDynamicTextStyle {\r\n\tprotected static FONT: DThemeFont | null = null;\r\n\r\n\tprotected _id: number;\r\n\tprotected _idApproved: number;\r\n\tprotected _fontIdId: number;\r\n\tprotected _fontId: string;\r\n\tprotected _fontIdApproved: string;\r\n\tprotected _align: DDynamicTextAlign;\r\n\tprotected _fontFamily: string;\r\n\tprotected _fontSize: number;\r\n\tprotected _fontStyle: DFontStyle;\r\n\tprotected _fontVariant: DFontVariant;\r\n\tprotected _fontWeight: DFontWeight;\r\n\tprotected _fill: number;\r\n\tprotected _fillApproved: number;\r\n\tprotected _clipping: boolean;\r\n\tprotected _onChange: () => void;\r\n\r\n\tconstructor( options: DDynamicTextStyleOptions | undefined, onChange: () => void ) {\r\n\t\tthis._id = 0;\r\n\t\tthis._idApproved = -1;\r\n\r\n\t\tconst font = DDynamicTextStyle.FONT = (\r\n\t\t\tDDynamicTextStyle.FONT || DThemes.getInstance().get( \"DBase\" ) as DThemeFont\r\n\t\t);\r\n\t\tthis._align = (options && options.align) || \"left\";\r\n\t\tthis._fontFamily = (options && options.fontFamily) || font.getFontFamilly();\r\n\t\tthis._fontSize = (options && options.fontSize) || font.getFontSize();\r\n\t\tthis._fontStyle = (options && options.fontStyle) || \"normal\";\r\n\t\tthis._fontVariant = (options && options.fontVariant) || \"normal\";\r\n\t\tthis._fontWeight = (options && options.fontWeight) || \"normal\";\r\n\r\n\t\tthis._fontIdId = -1;\r\n\t\tthis._fontId = \"\";\r\n\t\tthis._fontIdApproved = \"\";\r\n\r\n\t\tthis._fill = (options && options.fill) || font.getColor( 0 );\r\n\t\tthis._fillApproved = 0x000000;\r\n\r\n\t\tthis._clipping = ((options && options.clipping != null) ? options.clipping : true);\r\n\r\n\t\tthis._onChange = onChange;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget idApproved(): number {\r\n\t\treturn this._idApproved;\r\n\t}\r\n\r\n\tget fontId(): string {\r\n\t\tthis.update();\r\n\t\treturn this._fontId;\r\n\t}\r\n\r\n\tget fontIdApproved(): string {\r\n\t\treturn this._fontIdApproved;\r\n\t}\r\n\r\n\tget fill(): number {\r\n\t\treturn this._fill;\r\n\t}\r\n\r\n\tset fill( fill: number ) {\r\n\t\tif( this._fill !== fill ) {\r\n\t\t\tthis._fill = fill;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onChange(): void {\r\n\t\tthis._id += 1;\r\n\t\tthis._onChange();\r\n\t}\r\n\r\n\tget fillApproved(): number {\r\n\t\treturn this._fillApproved;\r\n\t}\r\n\r\n\tapprove(): void {\r\n\t\tthis.update();\r\n\t\tthis._idApproved = this._id;\r\n\t\tthis._fontIdApproved = this._fontId;\r\n\t\tthis._fillApproved = this._fill;\r\n\t}\r\n\r\n\tget fontFamily(): string {\r\n\t\treturn this._fontFamily;\r\n\t}\r\n\r\n\tset fontFamily( fontFamily: string ) {\r\n\t\tif( this._fontFamily !== fontFamily ) {\r\n\t\t\tthis._fontFamily = fontFamily;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tget fontSize(): number {\r\n\t\treturn this._fontSize;\r\n\t}\r\n\r\n\tset fontSize( fontSize: number ) {\r\n\t\tif( this._fontSize !== fontSize ) {\r\n\t\t\tthis._fontSize = fontSize;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tget fontStyle(): DFontStyle {\r\n\t\treturn this._fontStyle;\r\n\t}\r\n\r\n\tset fontStyle( fontStyle: DFontStyle ) {\r\n\t\tif( this._fontStyle !== fontStyle ) {\r\n\t\t\tthis._fontStyle = fontStyle;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tget fontVariant(): DFontVariant {\r\n\t\treturn this._fontVariant;\r\n\t}\r\n\r\n\tset fontVariant( fontVariant: DFontVariant ) {\r\n\t\tif( this._fontVariant !== fontVariant ) {\r\n\t\t\tthis._fontVariant = fontVariant;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tget fontWeight(): DFontWeight {\r\n\t\treturn this._fontWeight;\r\n\t}\r\n\r\n\tset fontWeight( fontWeight: DFontWeight ) {\r\n\t\tif( this._fontWeight !== fontWeight ) {\r\n\t\t\tthis._fontWeight = fontWeight;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected update(): void {\r\n\t\tif( this._fontIdId !== this._id ) {\r\n\t\t\tthis._fontIdId = this._id;\r\n\t\t\tthis._fontId = this.newFontId();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newFontId(): string {\r\n\t\treturn `${this._fontStyle} ${this._fontVariant} ${this._fontWeight} ${this._fontSize}px ${this._fontFamily}`;\r\n\t}\r\n\r\n\tget clipping(): boolean {\r\n\t\treturn this._clipping;\r\n\t}\r\n\r\n\tset clipping( clipping: boolean ) {\r\n\t\tif( this._clipping !== clipping ) {\r\n\t\t\tthis._clipping = clipping;\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Mesh, MeshMaterial, Renderer, Texture } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DDynamicTextGeometry } from \"./d-dynamic-text-geometry\";\r\nimport { DDynamicTextStyle, DDynamicTextStyleOptions } from \"./d-dynamic-text-style\";\r\nimport { DynamicFontAtlas } from \"./util/dynamic-font-atlas\";\r\n\r\nexport class DDynamicText extends Mesh {\r\n\tprotected _style: DDynamicTextStyle;\r\n\tprotected _text: string;\r\n\tprotected _textApproved: string;\r\n\tprotected _isDirty: boolean;\r\n\tprotected _isGeometryDirty: boolean;\r\n\tprotected _atlas: DynamicFontAtlas | null;\r\n\tprotected _atlasRevisionUpdated: number;\r\n\tprotected _width: number;\r\n\tprotected _height: number;\r\n\tprotected _clippingWidth: number | undefined;\r\n\tprotected _clippingWidthDelta: number;\r\n\r\n\treadonly geometry!: DDynamicTextGeometry;\r\n\r\n\tconstructor( text: string, options?: DDynamicTextStyleOptions ) {\r\n\t\tsuper( new DDynamicTextGeometry(), new MeshMaterial( Texture.EMPTY ) );\r\n\r\n\t\tthis._style = new DDynamicTextStyle( options, (): void => {\r\n\t\t\tthis._isDirty = true;\r\n\t\t\tthis._isGeometryDirty = true;\r\n\t\t\tthis._atlas = null;\r\n\t\t\tthis.update_();\r\n\t\t});\r\n\t\tthis._text = text;\r\n\t\tthis._textApproved = \"\";\r\n\t\tthis._isDirty = true;\r\n\t\tthis._isGeometryDirty = true;\r\n\t\tthis._atlas = null;\r\n\t\tthis._atlasRevisionUpdated = 0;\r\n\t\tthis._width = 0;\r\n\t\tthis._height = 0;\r\n\t\tthis._clippingWidthDelta = 0;\r\n\t\tthis.update_();\r\n\t}\r\n\r\n\tprotected update_(): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst style = this._style;\r\n\t\t\tif( this._isDirty ) {\r\n\t\t\t\tthis._isDirty = false;\r\n\r\n\t\t\t\tconst text = this._text;\r\n\t\t\t\tconst textApproved = this._textApproved;\r\n\t\t\t\tthis._textApproved = text;\r\n\t\t\t\tconst fontId = style.fontId;\r\n\t\t\t\tconst fontIdApproved = style.fontIdApproved;\r\n\t\t\t\tconst fontSize = style.fontSize;\r\n\t\t\t\tconst fill = style.fill;\r\n\t\t\t\tconst fillApproved = style.fillApproved;\r\n\t\t\t\tstyle.approve();\r\n\r\n\t\t\t\tconst atlases = layer.getDynamicFontAtlases();\r\n\t\t\t\tif( text !== textApproved || fontId !== fontIdApproved || fill !== fillApproved ) {\r\n\t\t\t\t\tatlases.add( fontId, fontSize, fill, text );\r\n\t\t\t\t\tatlases.remove( fontIdApproved, fillApproved, textApproved );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget text(): string {\r\n\t\treturn this._text;\r\n\t}\r\n\r\n\tset text( text: string ) {\r\n\t\tif( this._text !== text ) {\r\n\t\t\tthis._text = text;\r\n\t\t\tthis._isDirty = true;\r\n\t\t\tthis._isGeometryDirty = true;\r\n\t\t\tthis.update_();\r\n\t\t}\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\tthis.update();\r\n\t\treturn Math.abs( this.scale.x ) * this.geometry.width;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\tthis.update();\r\n\t\tconst geometryWidth = this.geometry.width;\r\n\t\tif( +1e-4 < geometryWidth ) {\r\n\t\t\tconst newScale = width / geometryWidth;\r\n\t\t\tthis.scale.x = ( 0 <= this.scale.x ? +newScale : -newScale );\r\n\t\t}\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\tthis.update();\r\n\t\treturn Math.abs( this.scale.y ) * this.geometry.height;\r\n\t}\r\n\r\n\tset height( height: number ) {\r\n\t\tthis.update();\r\n\t\tconst geometryHeight = this.geometry.height;\r\n\t\tif( +1e-4 < geometryHeight ) {\r\n\t\t\tconst newScale = height / geometryHeight;\r\n\t\t\tthis.scale.y = ( 0 <= this.scale.y ? +newScale : -newScale );\r\n\t\t}\r\n\t}\r\n\r\n\tget clipped(): boolean {\r\n\t\treturn this.geometry.clipped;\r\n\t}\r\n\r\n\tget style(): DDynamicTextStyle {\r\n\t\treturn this._style;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tthis.update_();\r\n\r\n\t\tlet atlas = this._atlas;\r\n\t\tif( atlas == null ) {\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tconst style = this._style;\r\n\t\t\t\tatlas = layer.getDynamicFontAtlases().get( style.fontId, style.fill );\r\n\t\t\t\tif( atlas != null ) {\r\n\t\t\t\t\tthis._atlasRevisionUpdated = atlas.getRevisionUpdate();\r\n\t\t\t\t\tthis._atlas = atlas;\r\n\t\t\t\t\tthis.texture = atlas.texture;\r\n\t\t\t\t\tthis._isGeometryDirty = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst revisionUpdate = atlas.getRevisionUpdate();\r\n\t\t\tif( revisionUpdate !== this._atlasRevisionUpdated ) {\r\n\t\t\t\tthis._atlasRevisionUpdated = revisionUpdate;\r\n\t\t\t\tthis._isGeometryDirty = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst clippingWidth = this._clippingWidth;\r\n\t\tconst newClippingWidth = this.getClippingWidth();\r\n\t\tif( clippingWidth !== newClippingWidth ) {\r\n\t\t\tthis._clippingWidth = newClippingWidth;\r\n\t\t\tthis._isGeometryDirty = true;\r\n\t\t}\r\n\r\n\t\tif( this._isGeometryDirty ) {\r\n\t\t\tthis._isGeometryDirty = false;\r\n\t\t\tthis.geometry.update( this._text, atlas, newClippingWidth );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getClippingWidth(): number | undefined {\r\n\t\tif( this._style.clipping ) {\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent instanceof DBase ) {\r\n\t\t\t\treturn parent.width - parent.padding.getLeft() - parent.padding.getRight() - this._clippingWidthDelta;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tsetClippingWidthDelta( width: number ): void {\r\n\t\tthis._clippingWidthDelta = width;\r\n\t}\r\n\r\n\t_calculateBounds(): void {\r\n\t\tthis.update();\r\n\t\tsuper._calculateBounds();\r\n\t}\r\n\r\n\t_render( renderer?: Renderer ): void {\r\n\t\tthis.update();\r\n\t\t(super._render as any)( renderer );\r\n\t}\r\n}\r\n","import { DisplayObject, Texture } from \"pixi.js\";\r\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\r\nimport { DAlignVertical } from \"./d-align-vertical\";\r\nimport { DAlignWith } from \"./d-align-with\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DThemeImagePiece } from \"./d-image-piece\";\r\n\r\nexport interface DThemeImageBaseSecondary {\r\n\tgetSecondaryImageAlignHorizontal(): DAlignHorizontal;\r\n\tgetSecondaryImageAlignVertical(): DAlignVertical;\r\n\tgetSecondaryImageAlignWith(): DAlignWith;\r\n\tgetSecondaryImageMarginHorizontal(): number;\r\n\tgetSecondaryImageMarginVertial(): number;\r\n\tgetSecondaryImageTintColor( state: DBaseState ): number | null;\r\n\tgetSecondaryImageTintAlpha( state: DBaseState ): number;\r\n\tgetSecondaryImageSource( state: DBaseState ): Texture | DisplayObject | null;\r\n}\r\n\r\nexport class DImageBaseThemeWrapperSecondary implements DThemeImagePiece {\r\n\tprotected _theme: DThemeImageBaseSecondary;\r\n\r\n\tconstructor( theme: DThemeImageBaseSecondary ) {\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tgetImageAlignHorizontal(): DAlignHorizontal {\r\n\t\treturn this._theme.getSecondaryImageAlignHorizontal();\r\n\t}\r\n\r\n\tgetImageAlignVertical(): DAlignVertical {\r\n\t\treturn this._theme.getSecondaryImageAlignVertical();\r\n\t}\r\n\r\n\tgetImageAlignWith(): DAlignWith {\r\n\t\treturn this._theme.getSecondaryImageAlignWith();\r\n\t}\r\n\r\n\tgetImageMarginHorizontal(): number {\r\n\t\treturn this._theme.getSecondaryImageMarginHorizontal();\r\n\t}\r\n\r\n\tgetImageMarginVertial(): number {\r\n\t\treturn this._theme.getSecondaryImageMarginVertial();\r\n\t}\r\n\r\n\tgetImageTintColor( state: DBaseState ): number | null {\r\n\t\treturn this._theme.getSecondaryImageTintColor( state );\r\n\t}\r\n\r\n\tgetImageTintAlpha( state: DBaseState ): number {\r\n\t\treturn this._theme.getSecondaryImageTintAlpha( state );\r\n\t}\r\n\r\n\tgetImageSource( state: DBaseState ): Texture | DisplayObject | null {\r\n\t\treturn this._theme.getSecondaryImageSource( state );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DLinkMenuItemId {\r\n\tOPEN_LINK_IN_NEW_WINDOW,\r\n\tCOPY_LINK_ADDRESS\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DLinkTarget {\r\n\tAUTO,\r\n\tTHIS_WINDOW,\r\n\tNEW_WINDOW\r\n}\r\n","import { DisplayObject, Texture } from \"pixi.js\";\r\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\r\nimport { DAlignVertical } from \"./d-align-vertical\";\r\nimport { DAlignWith } from \"./d-align-with\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DThemeImagePiece } from \"./d-image-piece\";\r\n\r\nexport interface DThemeImageBaseTertiary {\r\n\tgetTertiaryImageAlignHorizontal(): DAlignHorizontal;\r\n\tgetTertiaryImageAlignVertical(): DAlignVertical;\r\n\tgetTertiaryImageAlignWith(): DAlignWith;\r\n\tgetTertiaryImageMarginHorizontal(): number;\r\n\tgetTertiaryImageMarginVertial(): number;\r\n\tgetTertiaryImageTintColor( state: DBaseState ): number | null;\r\n\tgetTertiaryImageTintAlpha( state: DBaseState ): number;\r\n\tgetTertiaryImageSource( state: DBaseState ): Texture | DisplayObject | null;\r\n}\r\n\r\nexport class DImageBaseThemeWrapperTertiary implements DThemeImagePiece {\r\n\tprotected _theme: DThemeImageBaseTertiary;\r\n\r\n\tconstructor( theme: DThemeImageBaseTertiary ) {\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tgetImageAlignHorizontal(): DAlignHorizontal {\r\n\t\treturn this._theme.getTertiaryImageAlignHorizontal();\r\n\t}\r\n\r\n\tgetImageAlignVertical(): DAlignVertical {\r\n\t\treturn this._theme.getTertiaryImageAlignVertical();\r\n\t}\r\n\r\n\tgetImageAlignWith(): DAlignWith {\r\n\t\treturn this._theme.getTertiaryImageAlignWith();\r\n\t}\r\n\r\n\tgetImageMarginHorizontal(): number {\r\n\t\treturn this._theme.getTertiaryImageMarginHorizontal();\r\n\t}\r\n\r\n\tgetImageMarginVertial(): number {\r\n\t\treturn this._theme.getTertiaryImageMarginVertial();\r\n\t}\r\n\r\n\tgetImageTintColor( state: DBaseState ): number | null {\r\n\t\treturn this._theme.getTertiaryImageTintColor( state );\r\n\t}\r\n\r\n\tgetImageTintAlpha( state: DBaseState ): number {\r\n\t\treturn this._theme.getTertiaryImageTintAlpha( state );\r\n\t}\r\n\r\n\tgetImageSource( state: DBaseState ): Texture | DisplayObject | null {\r\n\t\treturn this._theme.getTertiaryImageSource( state );\r\n\t}\r\n}\r\n","import { DisplayObject, Point, Rectangle, Sprite, Texture } from \"pixi.js\";\r\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\r\nimport { DAlignVertical } from \"./d-align-vertical\";\r\nimport { DAlignWith } from \"./d-align-with\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { isFunction } from \"./util/is-function\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\ntype DImagePieceOnChange = () => void;\r\n\r\ntype DImagePieceApplyMask = ( target: DisplayObject ) => void;\r\n\r\nexport interface DImagePieceTintOptions {\r\n\tcolor?: DStateAwareOrValueMightBe<number | null>;\r\n\talpha?: DStateAwareOrValueMightBe<number>;\r\n}\r\n\r\nexport interface DImagePieceAlignOptions {\r\n\twith?: (keyof typeof DAlignWith) | DAlignWith;\r\n\tvertical?: (keyof typeof DAlignVertical) | DAlignVertical;\r\n\thorizontal?: (keyof typeof DAlignHorizontal) | DAlignHorizontal;\r\n}\r\n\r\nexport interface DImagePieceMarginOptions {\r\n\tvertical?: number;\r\n\thorizontal?: number;\r\n}\r\n\r\nexport interface DImagePieceOptions {\r\n\tsource?: DStateAwareOrValueMightBe<Texture | DisplayObject | null>;\r\n\ttint?: DImagePieceTintOptions;\r\n\talign?: DImagePieceAlignOptions;\r\n\tmargin?: DImagePieceMarginOptions;\r\n}\r\n\r\nexport interface DImagePieceAlign {\r\n\twith: DAlignWith;\r\n\tvertical: DAlignVertical;\r\n\thorizontal: DAlignHorizontal;\r\n}\r\n\r\nexport interface DImagePieceMargin {\r\n\tvertical: number;\r\n\thorizontal: number;\r\n}\r\n\r\nexport interface DImagePieceTextAlign {\r\n\tvertical: DAlignVertical;\r\n\thorizontal: DAlignHorizontal;\r\n}\r\n\r\nexport interface DImagePieceParent {\r\n\treadonly state: DBaseState;\r\n\taddChild( displayObject: DisplayObject ): void;\r\n\tremoveChild( displayObject: DisplayObject ): void;\r\n}\r\n\r\nexport interface DThemeImagePiece {\r\n\tgetImageAlignHorizontal(): DAlignHorizontal;\r\n\tgetImageAlignVertical(): DAlignVertical;\r\n\tgetImageAlignWith(): DAlignWith;\r\n\tgetImageMarginHorizontal(): number;\r\n\tgetImageMarginVertial(): number;\r\n\tgetImageTintColor( state: DBaseState ): number | null;\r\n\tgetImageTintAlpha( state: DBaseState ): number;\r\n\tgetImageSource( state: DBaseState ): Texture | DisplayObject | null;\r\n}\r\n\r\nconst toImageAlign = ( theme: DThemeImagePiece, options?: DImagePieceOptions ): DImagePieceAlign => {\r\n\tconst align = options && options.align;\r\n\tif( align ) {\r\n\t\tconst alignWith: DAlignWith = ( align.with != null ?\r\n\t\t\t( isString( align.with ) ? DAlignWith[ align.with ] : align.with ) :\r\n\t\t\ttheme.getImageAlignWith()\r\n\t\t);\r\n\t\tconst alignVertical: DAlignVertical = ( align.vertical != null ?\r\n\t\t\t( isString( align.vertical ) ? DAlignVertical[ align.vertical ] : align.vertical ) :\r\n\t\t\ttheme.getImageAlignVertical()\r\n\t\t);\r\n\t\tconst alignHorizontal: DAlignHorizontal = ( align.horizontal != null ?\r\n\t\t\t( isString( align.horizontal ) ? DAlignHorizontal[ align.horizontal ] : align.horizontal ) :\r\n\t\t\ttheme.getImageAlignHorizontal()\r\n\t\t);\r\n\t\treturn {\r\n\t\t\twith: alignWith,\r\n\t\t\tvertical: alignVertical,\r\n\t\t\thorizontal: alignHorizontal\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\twith: theme.getImageAlignWith(),\r\n\t\tvertical: theme.getImageAlignVertical(),\r\n\t\thorizontal: theme.getImageAlignHorizontal()\r\n\t};\r\n};\r\n\r\nconst toImageMargin = ( theme: DThemeImagePiece, options?: DImagePieceOptions ): DImagePieceMargin => {\r\n\tconst margin = options && options.margin;\r\n\tif( margin ) {\r\n\t\tconst vertical = ( margin.vertical != null ?\r\n\t\t\tmargin.vertical : theme.getImageMarginVertial()\r\n\t\t);\r\n\t\tconst horizontal = ( margin.horizontal != null ?\r\n\t\t\tmargin.horizontal : theme.getImageMarginHorizontal()\r\n\t\t);\r\n\t\treturn {\r\n\t\t\tvertical,\r\n\t\t\thorizontal\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tvertical: theme.getImageMarginVertial(),\r\n\t\thorizontal: theme.getImageMarginHorizontal()\r\n\t};\r\n};\r\n\r\nconst toImageTint = ( theme: DThemeImagePiece, options?: DImagePieceOptions ): DImagePieceTintOptions | undefined => {\r\n\tif( options && options.tint != null ) {\r\n\t\treturn options.tint;\r\n\t}\r\n\treturn undefined;\r\n};\r\n\r\nexport class DImagePiece {\r\n\tprotected _image: DisplayObject | null;\r\n\tprotected _computed: Texture | DisplayObject | null;\r\n\tprotected _source: DStateAwareOrValueMightBe<Texture | DisplayObject | null>;\r\n\tprotected _align: DImagePieceAlign;\r\n\tprotected _margin: DImagePieceMargin;\r\n\tprotected _tint: DImagePieceTintOptions | undefined;\r\n\tprotected _bound: Rectangle;\r\n\tprotected _point: Point;\r\n\tprotected _onChange: DImagePieceOnChange;\r\n\tprotected _applyMask: DImagePieceApplyMask;\r\n\tprotected _parent: DImagePieceParent;\r\n\tprotected _textAlign: DImagePieceTextAlign;\r\n\tprotected _theme: DThemeImagePiece;\r\n\r\n\tconstructor(\r\n\t\tparent: DImagePieceParent,\r\n\t\ttheme: DThemeImagePiece,\r\n\t\toptions: DImagePieceOptions | undefined,\r\n\t\ttextAlign: DImagePieceTextAlign,\r\n\t\tonChange: DImagePieceOnChange,\r\n\t\tapplyMask: DImagePieceApplyMask\r\n\t) {\r\n\t\tthis._image = null;\r\n\t\tthis._align = toImageAlign( theme, options );\r\n\t\tthis._margin = toImageMargin( theme, options );\r\n\t\tthis._tint = toImageTint( theme, options );\r\n\t\tthis._bound = new Rectangle();\r\n\t\tthis._point = new Point();\r\n\t\tthis._source = ( options && options.source );\r\n\t\tthis._computed = null;\r\n\r\n\t\tthis._parent = parent;\r\n\t\tthis._theme = theme;\r\n\t\tthis._textAlign = textAlign;\r\n\t\tthis._onChange = onChange;\r\n\t\tthis._applyMask = applyMask;\r\n\t}\r\n\r\n\tget image(): DisplayObject | null {\r\n\t\treturn this._image;\r\n\t}\r\n\r\n\tget align(): DImagePieceAlign {\r\n\t\treturn this._align;\r\n\t}\r\n\r\n\tget margin(): DImagePieceMargin {\r\n\t\treturn this._margin;\r\n\t}\r\n\r\n\tget bound(): Rectangle {\r\n\t\treturn this._bound;\r\n\t}\r\n\r\n\tget source(): DStateAwareOrValueMightBe<Texture | DisplayObject | null> {\r\n\t\treturn this._source;\r\n\t}\r\n\r\n\tset source( source: DStateAwareOrValueMightBe<Texture | DisplayObject | null> ) {\r\n\t\tif( this._source !== source ) {\r\n\t\t\tthis._source = source;\r\n\t\t\tthis._onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected computeSource(): Texture | DisplayObject | null {\r\n\t\tconst source = this._source;\r\n\t\tif( source !== undefined ) {\r\n\t\t\tif( isFunction( source ) ) {\r\n\t\t\t\tconst result = source( this._parent.state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn source;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._theme.getImageSource( this._parent.state );\r\n\t}\r\n\r\n\tonStateChange( newState: DBaseState, oldState: DBaseState ): void {\r\n\t\tthis.updateTint();\r\n\t}\r\n\r\n\tupdateBound(): void {\r\n\t\tconst bound = this._bound;\r\n\t\tconst image = this._image;\r\n\t\tif( image != null ) {\r\n\t\t\timage.updateTransform();\r\n\t\t\timage.getLocalBounds( bound );\r\n\t\t\tconst bl = bound.left;\r\n\t\t\tconst bt = bound.top;\r\n\t\t\tconst br = bound.right;\r\n\t\t\tconst bb = bound.bottom;\r\n\r\n\t\t\tconst localTransform = image.localTransform;\r\n\t\t\tconst a = localTransform.a;\r\n\t\t\tconst b = localTransform.b;\r\n\t\t\tconst c = localTransform.c;\r\n\t\t\tconst d = localTransform.d;\r\n\r\n\t\t\tconst x0 = a * bl + c * bt;\r\n\t\t\tconst y0 = b * bl + d * bt;\r\n\t\t\tconst x1 = a * br + c * bt;\r\n\t\t\tconst y1 = b * br + d * bt;\r\n\t\t\tconst x2 = a * br + c * bb;\r\n\t\t\tconst y2 = b * br + d * bb;\r\n\t\t\tconst x3 = a * bl + c * bb;\r\n\t\t\tconst y3 = b * bl + d * bb;\r\n\r\n\t\t\tconst xmin = Math.min( x0, x1, x2, x3 );\r\n\t\t\tconst xmax = Math.max( x0, x1, x2, x3 );\r\n\t\t\tconst ymin = Math.min( y0, y1, y2, y3 );\r\n\t\t\tconst ymax = Math.max( y0, y1, y2, y3 );\r\n\r\n\t\t\tbound.x = xmin + localTransform.tx;\r\n\t\t\tbound.y = ymin + localTransform.ty;\r\n\t\t\tbound.width = xmax - xmin;\r\n\t\t\tbound.height = ymax - ymin;\r\n\t\t} else {\r\n\t\t\tbound.x = 0;\r\n\t\t\tbound.y = 0;\r\n\t\t\tbound.width = 0;\r\n\t\t\tbound.height = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected isTintAware( target: DisplayObject | null ): target is DisplayObject & { tint: number } {\r\n\t\treturn ( target != null && \"tint\" in target );\r\n\t}\r\n\r\n\tprotected toTintColor( theme: DThemeImagePiece, state: DBaseState ): number | null {\r\n\t\tconst tint = this._tint;\r\n\t\tif( tint ) {\r\n\t\t\tconst color = tint.color;\r\n\t\t\tif( color !== undefined ) {\r\n\t\t\t\tif( isFunction( color ) ) {\r\n\t\t\t\t\tconst result = color( state );\r\n\t\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn color;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn theme.getImageTintColor( state );\r\n\t}\r\n\r\n\tprotected toTintAlpha( theme: DThemeImagePiece, state: DBaseState ): number {\r\n\t\tconst tint = this._tint;\r\n\t\tif( tint ) {\r\n\t\t\tconst alpha = tint.alpha;\r\n\t\t\tif( alpha !== undefined ) {\r\n\t\t\t\tif( isFunction( alpha ) ) {\r\n\t\t\t\t\tconst result = alpha( state );\r\n\t\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn alpha;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn theme.getImageTintAlpha( state );\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the tint.\r\n\t *\r\n\t * @returns True if the tint is changed.\r\n\t */\r\n\tupdateTint(): boolean {\r\n\t\tconst image = this._image;\r\n\t\tif( image ) {\r\n\t\t\tif( this.isTintAware( image ) ) {\r\n\t\t\t\tconst theme = this._theme;\r\n\t\t\t\tconst state = this._parent.state;\r\n\t\t\t\tconst color = this.toTintColor( theme, state );\r\n\t\t\t\tif( color != null ) {\r\n\t\t\t\t\tlet result = false;\r\n\t\t\t\t\tif( image.tint !== color ) {\r\n\t\t\t\t\t\timage.tint = color;\r\n\t\t\t\t\t\tresult = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst alpha = this.toTintAlpha( theme, state );\r\n\t\t\t\t\tif( image.alpha !== alpha ) {\r\n\t\t\t\t\t\timage.alpha = alpha;\r\n\t\t\t\t\t\tresult = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the computed source.\r\n\t *\r\n\t * @returns True if the computed source is changed\r\n\t */\r\n\tupdateSource(): boolean {\r\n\t\tconst newComputed = this.computeSource();\r\n\t\tconst oldComputed = this._computed;\r\n\t\tif( newComputed !== oldComputed ) {\r\n\t\t\tthis._computed = newComputed;\r\n\r\n\t\t\tconst parent = this._parent;\r\n\t\t\tconst oldImage = this._image;\r\n\t\t\tif( newComputed instanceof Texture ) {\r\n\t\t\t\tif( oldComputed instanceof Texture ) {\r\n\t\t\t\t\toldComputed.off( \"update\", this._onChange );\r\n\t\t\t\t\tif( oldImage instanceof Sprite ) {\r\n\t\t\t\t\t\toldImage.texture = newComputed;\r\n\t\t\t\t\t\tnewComputed.on( \"update\", this._onChange );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif( oldImage != null ) {\r\n\t\t\t\t\t\tparent.removeChild( oldImage );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst newImage = new Sprite( newComputed );\r\n\t\t\t\t\tthis._applyMask( newImage );\r\n\t\t\t\t\tnewComputed.on( \"update\", this._onChange );\r\n\t\t\t\t\tparent.addChild( newImage );\r\n\t\t\t\t\tthis._image = newImage;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( oldComputed instanceof Texture ) {\r\n\t\t\t\t\toldComputed.off( \"update\", this._onChange );\r\n\t\t\t\t\tif( oldImage != null ) {\r\n\t\t\t\t\t\tparent.removeChild( oldImage );\r\n\t\t\t\t\t\toldImage.destroy();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if( oldImage != null ) {\r\n\t\t\t\t\tparent.removeChild( oldImage );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( newComputed != null ) {\r\n\t\t\t\t\tthis._applyMask( newComputed );\r\n\t\t\t\t\tparent.addChild( newComputed );\r\n\t\t\t\t}\r\n\t\t\t\tthis._image = newComputed;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tisRefitable( target: any ): boolean {\r\n\t\treturn ( target != null && target === this._image );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst image = this._image;\r\n\t\tif( image ) {\r\n\t\t\tthis._image = null;\r\n\t\t\tconst computed = this._computed;\r\n\t\t\tif( computed instanceof Texture ) {\r\n\t\t\t\tcomputed.off( \"update\", this._onChange, this );\r\n\t\t\t\timage.destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Graphics, Renderer } from \"pixi.js\";\r\nimport { DBase, DReflowable } from \"./d-base\";\r\n\r\nexport class DBaseOverflowMaskSimple extends Graphics implements DReflowable {\r\n\tconstructor( parent: DBase ) {\r\n\t\tsuper();\r\n\t\t(this as any).parent = parent;\r\n\t}\r\n\r\n\trender( renderer: Renderer ): void {\r\n\t\tthis.updateTransform();\r\n\t\tsuper.render( renderer );\r\n\t}\r\n\r\n\tonReflow( base: DBase, width: number, height: number): void {\r\n\t\tthis.clear();\r\n\t\tthis.beginFill( 0xFFFFFF, 1 );\r\n\t\tthis.drawRect( 0, 0, width, height );\r\n\t\tthis.endFill();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Graphics, Text } from \"pixi.js\";\r\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\r\nimport { DAlignVertical } from \"./d-align-vertical\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase, DBaseOnOptions, DBaseOptions, DRefitable, DThemeBase } from \"./d-base\";\r\nimport { DBaseOverflowMaskSimple } from \"./d-base-overflow-mask-simple\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DDynamicText } from \"./d-dynamic-text\";\r\nimport { DDynamicTextStyleOptions } from \"./d-dynamic-text-style\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { isFunction } from \"./util/is-function\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport interface DTextBaseTextAlignOptions {\r\n\tvertical?: (keyof typeof DAlignVertical) | DAlignVertical;\r\n\thorizontal?: (keyof typeof DAlignHorizontal) | DAlignHorizontal;\r\n}\r\n\r\nexport interface DTextBaseTextOptions<VALUE = unknown> {\r\n\tvalue?: DStateAwareOrValueMightBe<VALUE>;\r\n\tcolor?: DStateAwareOrValueMightBe<number>;\r\n\talpha?: DStateAwareOrValueMightBe<number>;\r\n\tstyle?: DDynamicTextStyleOptions;\r\n\talign?: DTextBaseTextAlignOptions;\r\n\tformatter?: ( value: VALUE, caller: any ) => string;\r\n\tdynamic?: boolean;\r\n}\r\n\r\nexport interface DTextBaseOnOptions<VALUE> extends DBaseOnOptions {\r\n\r\n}\r\n\r\nexport interface DTextBaseOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTextBase = DThemeTextBase\r\n> extends DBaseOptions<THEME> {\r\n\ttext?: DTextBaseTextOptions<VALUE>;\r\n\tmask?: boolean;\r\n\ton?: DTextBaseOnOptions<VALUE>;\r\n}\r\n\r\nexport interface DThemeTextBase extends DThemeBase {\r\n\tgetTextFormatter(): ( value: any, caller: any ) => string;\r\n\tnewTextValue(): any;\r\n\tgetTextValue( state: DBaseState ): any;\r\n\tgetTextAlignVertical(): DAlignVertical;\r\n\tgetTextAlignHorizontal(): DAlignHorizontal;\r\n\tgetTextStyleClipping(): boolean;\r\n\tisOverflowMaskEnabled(): boolean;\r\n\tisTextDynamic(): boolean;\r\n}\r\n\r\n// Option parser\r\nconst isOverflowMaskEnabled = <VALUE, THEME extends DThemeTextBase>(\r\n\ttheme: DThemeTextBase, options?: DTextBaseOptions<VALUE, THEME>\r\n) => {\r\n\tif( options && options.mask != null ) {\r\n\t\treturn options.mask;\r\n\t}\r\n\treturn theme.isOverflowMaskEnabled();\r\n};\r\n\r\nconst toTextValue = <VALUE, THEME extends DThemeTextBase>(\r\n\ttheme: DThemeTextBase,\r\n\toptions: DTextBaseOptions<VALUE, THEME> | undefined\r\n): DStateAwareOrValueMightBe<VALUE> => {\r\n\tif( options && options.text && options.text.value !== undefined ) {\r\n\t\treturn options.text.value;\r\n\t}\r\n\treturn theme.newTextValue();\r\n};\r\n\r\nconst toTextStyle = <VALUE, THEME extends DThemeTextBase>(\r\n\ttheme: DThemeTextBase, options: DTextBaseOptions<VALUE, THEME> | undefined, state: DBaseState\r\n): DDynamicTextStyleOptions => {\r\n\tif( options && options.text && options.text.style != null ) {\r\n\t\tconst style = options.text.style;\r\n\t\tconst fill = style.fill != null ? style.fill : theme.getColor( state );\r\n\t\tconst fontSize = style.fontSize != null ? style.fontSize : theme.getFontSize();\r\n\t\tconst fontFamily = style.fontFamily != null ? style.fontFamily : theme.getFontFamilly();\r\n\t\tconst fontWeight = style.fontWeight != null ? style.fontWeight : theme.getFontWeight();\r\n\t\tconst fontStyle = style.fontStyle != null ? style.fontStyle : theme.getFontStyle();\r\n\t\tconst fontVariant = style.fontVariant != null ? style.fontVariant : theme.getFontVariant();\r\n\t\tconst clipping = style.clipping != null ? style.clipping : theme.getTextStyleClipping();\r\n\t\treturn {\r\n\t\t\tfill,\r\n\t\t\tfontSize,\r\n\t\t\tfontFamily,\r\n\t\t\tfontWeight,\r\n\t\t\tfontStyle,\r\n\t\t\tfontVariant,\r\n\t\t\tclipping\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tfill: theme.getColor( state ),\r\n\t\tfontSize: theme.getFontSize(),\r\n\t\tfontFamily: theme.getFontFamilly(),\r\n\t\tfontWeight: theme.getFontWeight(),\r\n\t\tfontStyle: theme.getFontStyle(),\r\n\t\tfontVariant: theme.getFontVariant(),\r\n\t\tclipping: theme.getTextStyleClipping()\r\n\t};\r\n};\r\n\r\nconst toTextAlign = <VALUE, THEME extends DThemeTextBase>(\r\n\ttheme: DThemeTextBase, options?: DTextBaseOptions<VALUE, THEME>\r\n): { vertical: DAlignVertical, horizontal: DAlignHorizontal } => {\r\n\tif( options && options.text && options.text.align ) {\r\n\t\tconst align = options.text.align;\r\n\t\tconst vertical = ( align.vertical != null ?\r\n\t\t\t( isString( align.vertical ) ? DAlignVertical[ align.vertical ] : align.vertical ) :\r\n\t\t\ttheme.getTextAlignVertical()\r\n\t\t);\r\n\t\tconst horizontal = ( align.horizontal != null ?\r\n\t\t\t( isString( align.horizontal ) ? DAlignHorizontal[ align.horizontal ] : align.horizontal ) :\r\n\t\t\ttheme.getTextAlignHorizontal()\r\n\t\t);\r\n\t\treturn {\r\n\t\t\tvertical,\r\n\t\t\thorizontal\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tvertical: theme.getTextAlignVertical(),\r\n\t\thorizontal: theme.getTextAlignHorizontal()\r\n\t};\r\n};\r\n\r\nconst toTextFormatter = <VALUE, THEME extends DThemeTextBase>(\r\n\ttheme: DThemeTextBase,\r\n\toptions: DTextBaseOptions<VALUE, THEME> | undefined\r\n): ( value: VALUE, caller: any ) => string => {\r\n\tif( options && options.text && options.text.formatter ) {\r\n\t\treturn options.text.formatter;\r\n\t}\r\n\treturn theme.getTextFormatter();\r\n};\r\n\r\nconst toTextDynamic = <VALUE, THEME extends DThemeTextBase>(\r\n\ttheme: DThemeTextBase, options?: DTextBaseOptions<VALUE, THEME>\r\n): boolean => {\r\n\tif( options && options.text && options.text.dynamic != null ) {\r\n\t\treturn options.text.dynamic;\r\n\t}\r\n\treturn theme.isTextDynamic();\r\n};\r\n\r\nexport class DTextBase<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTextBase = DThemeTextBase,\r\n\tOPTIONS extends DTextBaseOptions<VALUE, THEME> = DTextBaseOptions<VALUE, THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected _text!: DDynamicText | Text | null;\r\n\tprotected _textValue!: DStateAwareOrValueMightBe<VALUE>;\r\n\tprotected _textValueComputed!: VALUE;\r\n\tprotected _textColor!: DStateAwareOrValueMightBe<number>;\r\n\tprotected _textAlpha!: DStateAwareOrValueMightBe<number>;\r\n\tprotected _textStyle!: DDynamicTextStyleOptions;\r\n\tprotected _textAlign!: {\r\n\t\tvertical: DAlignVertical,\r\n\t\thorizontal: DAlignHorizontal\r\n\t};\r\n\tprotected _textFormatter!: ( value: VALUE, caller: any ) => string;\r\n\tprotected _isOverflowMaskEnabled!: boolean;\r\n\tprotected _overflowMask!: DBaseOverflowMaskSimple | null;\r\n\tprotected _textDynamic!: boolean;\r\n\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._text = null;\r\n\t\tconst theme = this.theme;\r\n\t\tthis._textValue = toTextValue( theme, options );\r\n\t\tthis._textValueComputed = this.computeTextValue();\r\n\t\tthis._textColor = ( options && options.text && options.text.color );\r\n\t\tthis._textAlpha = ( options && options.text && options.text.alpha );\r\n\t\tthis._textStyle = toTextStyle( theme, options, this.state );\r\n\t\tthis._textAlign = toTextAlign( theme, options );\r\n\t\tthis._textFormatter = toTextFormatter( theme, options );\r\n\t\tthis._textDynamic = toTextDynamic( theme, options );\r\n\t\tthis._isOverflowMaskEnabled = isOverflowMaskEnabled( theme, options );\r\n\t\tthis._overflowMask = null;\r\n\t\tthis.onTextChange();\r\n\t\tthis.createOrUpdateText();\r\n\t}\r\n\r\n\tset text( text: DStateAwareOrValueMightBe<VALUE> ) {\r\n\t\tif( this._textValue !== text ) {\r\n\t\t\tthis._textValue = text;\r\n\t\t\tthis.updateTextValue();\r\n\t\t}\r\n\t}\r\n\r\n\tget text(): DStateAwareOrValueMightBe<VALUE> {\r\n\t\treturn this._textValue;\r\n\t}\r\n\r\n\tprotected onTextChange() {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected computeTextValue(): VALUE {\r\n\t\tconst textValue = this._textValue;\r\n\t\tif( textValue !== undefined ) {\r\n\t\t\tif( isFunction( textValue ) ) {\r\n\t\t\t\tconst result = textValue( this.state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn textValue;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.theme.getTextValue( this.state ) as VALUE;\r\n\t}\r\n\r\n\tprotected createOrUpdateText(): void {\r\n\t\tconst formatted = this._textFormatter( this._textValueComputed, this );\r\n\t\tif( this._text == null ) {\r\n\t\t\tif( 0 < formatted.length ) {\r\n\t\t\t\tconst text = this.createText( formatted );\r\n\t\t\t\tthis._text = text;\r\n\t\t\t\tthis.addChild( text );\r\n\t\t\t\tthis.updateTextPosition( text );\r\n\t\t\t\tif( this._isOverflowMaskEnabled ) {\r\n\t\t\t\t\ttext.mask = this.getOrCreateOverflowMask();\r\n\t\t\t\t}\r\n\t\t\t\tthis.toDirty();\r\n\t\t\t\tDApplications.update( this );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._text.text = formatted;\r\n\t\t\tthis.toDirty();\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected createText( formatted: string ): Text | DDynamicText {\r\n\t\treturn ( this._textDynamic ?\r\n\t\t\tnew DDynamicText( formatted, this._textStyle ) :\r\n\t\t\tnew Text( formatted, this._textStyle )\r\n\t\t);\r\n\t}\r\n\r\n\tprotected getOrCreateOverflowMask(): Graphics {\r\n\t\tif( this._overflowMask == null ) {\r\n\t\t\tthis._overflowMask = new DBaseOverflowMaskSimple( this );\r\n\t\t\tthis.addReflowable( this._overflowMask );\r\n\t\t\tthis.toDirty();\r\n\t\t}\r\n\t\treturn this._overflowMask;\r\n\t}\r\n\r\n\tprotected updateTextPosition( text: DDynamicText | Text ): void {\r\n\t\tconst align = this._textAlign;\r\n\t\tconst padding = this._padding;\r\n\t\tconst toRounded = this.toRounded;\r\n\r\n\t\tswitch( align.horizontal ) {\r\n\t\tcase DAlignHorizontal.LEFT:\r\n\t\t\ttext.x = toRounded( padding.getLeft() );\r\n\t\t\tbreak;\r\n\t\tcase DAlignHorizontal.CENTER:\r\n\t\t\ttext.x = toRounded( ( this.width - text.width ) * 0.5 );\r\n\t\t\tbreak;\r\n\t\tcase DAlignHorizontal.RIGHT:\r\n\t\t\ttext.x = toRounded( this.width - text.width - padding.getRight() );\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tswitch( align.vertical ) {\r\n\t\tcase DAlignVertical.TOP:\r\n\t\t\ttext.y = toRounded( padding.getTop() );\r\n\t\t\tbreak;\r\n\t\tcase DAlignVertical.MIDDLE:\r\n\t\t\ttext.y = toRounded( ( this.height - text.height ) * 0.5 );\r\n\t\t\tbreak;\r\n\t\tcase DAlignVertical.BOTTOM:\r\n\t\t\ttext.y = toRounded( this.height - text.height - padding.getBottom() );\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toRounded( this: unknown, value: number ): number {\r\n\t\treturn Math.round( value );\r\n\t}\r\n\r\n\tprotected getTextColor( theme: THEME, state: DBaseState ): number {\r\n\t\tconst color = this._textColor;\r\n\t\tif( color !== undefined ) {\r\n\t\t\tif( isFunction( color ) ) {\r\n\t\t\t\tconst result = color( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn color;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn theme.getColor( state );\r\n\t}\r\n\r\n\tprotected getTextAlpha( theme: THEME, state: DBaseState ): number {\r\n\t\tconst alpha = this._textAlpha;\r\n\t\tif( alpha !== undefined ) {\r\n\t\t\tif( isFunction( alpha ) ) {\r\n\t\t\t\tconst result = alpha( state );\r\n\t\t\t\tif( result !== undefined ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn theme.getAlpha( state );\r\n\t}\r\n\r\n\tprotected updateTextColor( text: DDynamicText | Text ): void {\r\n\t\tconst theme = this.theme;\r\n\t\tconst state = this.state;\r\n\t\ttext.style.fill = this.getTextColor( theme, state );\r\n\t\ttext.alpha = this.getTextAlpha( theme, state );\r\n\t}\r\n\r\n\tprotected updateTextValue(): void {\r\n\t\tconst newTextValueComputed = this.computeTextValue();\r\n\t\tif( this._textValueComputed !== newTextValueComputed ) {\r\n\t\t\tthis._textValueComputed = newTextValueComputed;\r\n\t\t\tthis.onTextChange();\r\n\t\t\tthis.createOrUpdateText();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateText(): void {\r\n\t\tconst text = this._text;\r\n\t\tif( text != null ) {\r\n\t\t\tthis.updateTextValue();\r\n\t\t\tthis.updateTextPosition( text );\r\n\t\t\tthis.updateTextColor( text );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onReflow(): void {\r\n\t\tsuper.onReflow();\r\n\t\tthis.updateText();\r\n\t}\r\n\r\n\tprotected isRefitable( target: any ): target is DRefitable {\r\n\t\treturn super.isRefitable( target ) ||\r\n\t\t\t(target != null && target === this._text);\r\n\t}\r\n\r\n\tprotected applyTitle(): void {\r\n\t\tconst text = this._text;\r\n\t\tif( this._title.length <= 0 && text && (\"clipped\" in text) && text.clipped ) {\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.view.title = text.text;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsuper.applyTitle();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTextBase\";\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// Text\r\n\t\tconst text = this._text;\r\n\t\tif( text != null ) {\r\n\t\t\tthis._text = null;\r\n\t\t\ttext.destroy();\r\n\t\t}\r\n\r\n\t\t// Overflow mask\r\n\t\tconst overflowMask = this._overflowMask;\r\n\t\tif( overflowMask != null ) {\r\n\t\t\tthis._overflowMask = null;\r\n\t\t\toverflowMask.destroy();\r\n\t\t}\r\n\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, Texture } from \"pixi.js\";\r\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\r\nimport { DAlignVertical } from \"./d-align-vertical\";\r\nimport { DAlignWith } from \"./d-align-with\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DRefitable } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DDynamicText } from \"./d-dynamic-text\";\r\nimport { DImageBaseThemeWrapperSecondary, DThemeImageBaseSecondary } from \"./d-image-base-theme-wrapper-secondary\";\r\nimport { DImageBaseThemeWrapperTertiary, DThemeImageBaseTertiary } from \"./d-image-base-theme-wrapper-tertiary\";\r\nimport { DImagePiece, DImagePieceOptions, DThemeImagePiece } from \"./d-image-piece\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { DTextBase, DTextBaseOnOptions, DTextBaseOptions, DThemeTextBase } from \"./d-text-base\";\r\n\r\nexport interface DImageBaseOnOptions<VALUE> extends DTextBaseOnOptions<VALUE> {\r\n\r\n}\r\n\r\nexport interface DImageBaseOptions<\r\n\tVALUE,\r\n\tTHEME extends DThemeImageBase = DThemeImageBase\r\n> extends DTextBaseOptions<VALUE, THEME> {\r\n\timage?: DImagePieceOptions;\r\n\ton?: DImageBaseOnOptions<VALUE>;\r\n}\r\n\r\nexport interface DThemeImageBase extends DThemeTextBase, DThemeImagePiece {\r\n\tgetSecondaryImageAlignHorizontal(): DAlignHorizontal;\r\n\tgetSecondaryImageAlignVertical(): DAlignVertical;\r\n\tgetSecondaryImageAlignWith(): DAlignWith;\r\n\tgetSecondaryImageMarginHorizontal(): number;\r\n\tgetSecondaryImageMarginVertial(): number;\r\n\tgetSecondaryImageTintColor( state: DBaseState ): number | null;\r\n\tgetSecondaryImageTintAlpha( state: DBaseState ): number;\r\n\tgetSecondaryImageSource?( state: DBaseState ): Texture | DisplayObject | null;\r\n\r\n\tgetTertiaryImageAlignHorizontal(): DAlignHorizontal;\r\n\tgetTertiaryImageAlignVertical(): DAlignVertical;\r\n\tgetTertiaryImageAlignWith(): DAlignWith;\r\n\tgetTertiaryImageMarginHorizontal(): number;\r\n\tgetTertiaryImageMarginVertial(): number;\r\n\tgetTertiaryImageTintColor( state: DBaseState ): number | null;\r\n\tgetTertiaryImageTintAlpha( state: DBaseState ): number;\r\n\tgetTertiaryImageSource?( state: DBaseState ): Texture | DisplayObject | null;\r\n}\r\n\r\nconst hasSecondaryImageSource = ( theme: DThemeImageBase ): theme is DThemeImageBase & DThemeImageBaseSecondary => {\r\n\treturn !! theme.getSecondaryImageSource;\r\n};\r\n\r\nconst hasTertiaryImageSource = ( theme: DThemeImageBase ): theme is DThemeImageBase & DThemeImageBaseTertiary => {\r\n\treturn !! theme.getTertiaryImageSource;\r\n};\r\n\r\nexport class DImageBase<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeImageBase = DThemeImageBase,\r\n\tOPTIONS extends DImageBaseOptions<VALUE, THEME> = DImageBaseOptions<VALUE, THEME>\r\n> extends DTextBase<VALUE, THEME, OPTIONS> {\r\n\tprotected _images!: DImagePiece[];\r\n\tprotected _onChangeBound!: () => void;\r\n\tprotected _applyMaskBound!: ( target: DisplayObject ) => void;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tthis._onChangeBound = (): void => {\r\n\t\t\tthis.toDirty();\r\n\t\t\tDApplications.update( this );\r\n\t\t};\r\n\t\tthis._applyMaskBound = ( target: DisplayObject ): void => {\r\n\t\t\tif( this._isOverflowMaskEnabled ) {\r\n\t\t\t\ttarget.mask = this.getOrCreateOverflowMask();\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis._images = this.newImages( this.theme, options );\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tprotected newImages( theme: THEME, options?: OPTIONS ): DImagePiece[] {\r\n\t\tconst images: DImagePiece[] = [];\r\n\t\timages.push( this.newImage( theme, this.toImageOptions( theme, options && options.image ) ) );\r\n\t\tif( hasSecondaryImageSource( theme ) ) {\r\n\t\t\timages.push( this.newImage( new DImageBaseThemeWrapperSecondary( theme ) ) );\r\n\t\t}\r\n\t\tif( hasTertiaryImageSource( theme ) ) {\r\n\t\t\timages.push( this.newImage( new DImageBaseThemeWrapperTertiary( theme ) ) );\r\n\t\t}\r\n\t\treturn images;\r\n\t}\r\n\r\n\tprotected toImageOptions( theme: THEME, options?: DImagePieceOptions ): DImagePieceOptions | undefined {\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected newImage( theme: DThemeImagePiece, options?: DImagePieceOptions ) {\r\n\t\treturn new DImagePiece(\r\n\t\t\tthis, theme, options,\r\n\t\t\tthis._textAlign, this._onChangeBound, this._applyMaskBound\r\n\t\t);\r\n\t}\r\n\r\n\tget image(): DStateAwareOrValueMightBe<Texture | DisplayObject | null> {\r\n\t\treturn this._images[ 0 ].source;\r\n\t}\r\n\r\n\tset image( imageSource: DStateAwareOrValueMightBe<Texture | DisplayObject | null> ) {\r\n\t\tthis._images[ 0 ].source = imageSource;\r\n\t}\r\n\r\n\tprotected onStateChange( newState: DBaseState, oldState: DBaseState ): void {\r\n\t\tsuper.onStateChange( newState, oldState );\r\n\t\tconst images = this._images;\r\n\t\tfor( let i = 0, imax = images.length; i < imax; ++i ) {\r\n\t\t\timages[ i ].onStateChange( newState, oldState );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateText(): void {\r\n\t\tthis.updateTextValue();\r\n\t\tthis.updateTextAndImage();\r\n\t}\r\n\r\n\tprotected updateTextAndImage(): void {\r\n\t\tconst text = this._text;\r\n\t\tconst images = this._images;\r\n\t\tconst padding = this._padding;\r\n\r\n\t\tconst toRounded = this.toRounded;\r\n\r\n\t\tconst width = this.width;\r\n\t\tconst height = this.height;\r\n\r\n\t\tconst pl = padding.getLeft();\r\n\t\tconst pr = padding.getRight();\r\n\t\tconst pt = padding.getTop();\r\n\t\tconst pb = padding.getBottom();\r\n\r\n\t\tconst noText = text == null;\r\n\r\n\t\tlet textLeftFirst = noText;\r\n\t\tlet textTopFirst = noText;\r\n\r\n\t\tlet textRightLastMargin = 0;\r\n\t\tlet textBottomLastMargin = 0;\r\n\r\n\t\tlet textLeft = 0;\r\n\t\tlet textRight = 0;\r\n\t\tlet textTop = 0;\r\n\t\tlet textBottom = 0;\r\n\r\n\t\tlet paddingLeft = pl;\r\n\t\tlet paddingRight = width - pr;\r\n\t\tlet paddingTop = pt;\r\n\t\tlet paddingBottom = height - pb;\r\n\r\n\t\tlet borderLeft = 0;\r\n\t\tlet borderRight = width;\r\n\t\tlet borderTop = 0;\r\n\t\tlet borderBottom = height;\r\n\r\n\t\tfor( let i = 0, imax = images.length; i < imax; ++i ) {\r\n\t\t\tconst image = images[ i ];\r\n\t\t\timage.updateSource();\r\n\t\t\timage.updateTint();\r\n\t\t\timage.updateBound();\r\n\r\n\t\t\tconst imageImage = image.image;\r\n\t\t\tif( imageImage ) {\r\n\t\t\t\tconst imageBound = image.bound;\r\n\t\t\t\tconst imageBoundWidth = imageBound.width;\r\n\t\t\t\tconst imageBoundHeight = imageBound.height;\r\n\t\t\t\tconst imageMargin = image.margin;\r\n\t\t\t\tconst imageMarginHorizontal = imageMargin.horizontal;\r\n\t\t\t\tconst imageMarginVertical = imageMargin.vertical;\r\n\r\n\t\t\t\t// Text\r\n\t\t\t\tif( image.align.with === DAlignWith.TEXT ) {\r\n\t\t\t\t\tswitch( image.align.horizontal ) {\r\n\t\t\t\t\tcase DAlignHorizontal.LEFT:\r\n\t\t\t\t\t\timageImage.x = textLeft;\r\n\t\t\t\t\t\ttextLeft += imageBoundWidth;\r\n\t\t\t\t\t\tif( textLeftFirst ) {\r\n\t\t\t\t\t\t\ttextLeftFirst = false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttextLeft += imageMarginHorizontal;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignHorizontal.CENTER:\r\n\t\t\t\t\t\t// DO NOTHING\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignHorizontal.RIGHT:\r\n\t\t\t\t\t\ttextRight -= imageBoundWidth;\r\n\t\t\t\t\t\timageImage.x = textRight;\r\n\t\t\t\t\t\ttextRight -= imageMarginHorizontal;\r\n\t\t\t\t\t\ttextRightLastMargin = imageMarginHorizontal;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tswitch( image.align.vertical ) {\r\n\t\t\t\t\tcase DAlignVertical.TOP:\r\n\t\t\t\t\t\timageImage.y = textTop;\r\n\t\t\t\t\t\ttextTop += imageBoundHeight;\r\n\t\t\t\t\t\tif( textTopFirst ) {\r\n\t\t\t\t\t\t\ttextTopFirst = false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttextTop += imageMarginVertical;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignVertical.MIDDLE:\r\n\t\t\t\t\t\t// DO NOTHING\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignVertical.BOTTOM:\r\n\t\t\t\t\t\ttextBottom -= imageBoundHeight;\r\n\t\t\t\t\t\timageImage.y = textBottom;\r\n\t\t\t\t\t\ttextBottom -= imageMarginVertical;\r\n\t\t\t\t\t\ttextBottomLastMargin = imageMarginVertical;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Padding\r\n\t\t\t\tif( image.align.with === DAlignWith.PADDING ) {\r\n\t\t\t\t\tswitch( image.align.horizontal ) {\r\n\t\t\t\t\tcase DAlignHorizontal.LEFT:\r\n\t\t\t\t\t\tpaddingLeft += imageMarginHorizontal;\r\n\t\t\t\t\t\timageImage.x = toRounded( paddingLeft );\r\n\t\t\t\t\t\tpaddingLeft += imageBoundWidth;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignHorizontal.CENTER:\r\n\t\t\t\t\t\t// DO NOTHING\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignHorizontal.RIGHT:\r\n\t\t\t\t\t\tpaddingRight -= imageBoundWidth + imageMarginHorizontal;\r\n\t\t\t\t\t\timageImage.x = toRounded( paddingRight );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tswitch( image.align.vertical ) {\r\n\t\t\t\t\tcase DAlignVertical.TOP:\r\n\t\t\t\t\t\tpaddingTop += imageMarginVertical;\r\n\t\t\t\t\t\timageImage.y = toRounded( paddingTop );\r\n\t\t\t\t\t\tpaddingTop += imageBoundHeight;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignVertical.MIDDLE:\r\n\t\t\t\t\t\t// DO NOTHING\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignVertical.BOTTOM:\r\n\t\t\t\t\t\tpaddingBottom -= imageBoundHeight + imageMarginVertical;\r\n\t\t\t\t\t\timageImage.y = toRounded( paddingBottom );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Border\r\n\t\t\t\tif( image.align.with === DAlignWith.BORDER ) {\r\n\t\t\t\t\tswitch( image.align.horizontal ) {\r\n\t\t\t\t\tcase DAlignHorizontal.LEFT:\r\n\t\t\t\t\t\tborderLeft += imageMarginHorizontal;\r\n\t\t\t\t\t\timageImage.x = toRounded( borderLeft );\r\n\t\t\t\t\t\tborderLeft += imageBoundWidth;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignHorizontal.CENTER:\r\n\t\t\t\t\t\t// DO NOTHING\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignHorizontal.RIGHT:\r\n\t\t\t\t\t\tborderRight -= imageBoundWidth + imageMarginHorizontal;\r\n\t\t\t\t\t\timageImage.x = toRounded( borderRight );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tswitch( image.align.vertical ) {\r\n\t\t\t\t\tcase DAlignVertical.TOP:\r\n\t\t\t\t\t\tborderTop += imageMarginVertical;\r\n\t\t\t\t\t\timageImage.y = toRounded( borderTop );\r\n\t\t\t\t\t\tborderTop += imageBoundHeight;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignVertical.MIDDLE:\r\n\t\t\t\t\t\t// DO NOTHING\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignVertical.BOTTOM:\r\n\t\t\t\t\t\tborderBottom -= imageBoundHeight + imageMarginVertical;\r\n\t\t\t\t\t\timageImage.y = toRounded( borderBottom );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( noText ) {\r\n\t\t\ttextRight += textRightLastMargin;\r\n\t\t\ttextBottom += textBottomLastMargin;\r\n\t\t}\r\n\r\n\t\t// Text\r\n\t\tlet textLeftAdjust = 0;\r\n\t\tlet textCenterAdjust = 0;\r\n\t\tlet textRightAdjust = 0;\r\n\t\tlet textTopAdjust = 0;\r\n\t\tlet textMiddleAdjust = 0;\r\n\t\tlet textBottomAdjust = 0;\r\n\r\n\t\tif( text != null ) {\r\n\t\t\tthis.updateTextColor( text );\r\n\t\t\tif( text instanceof DDynamicText ) {\r\n\t\t\t\ttext.setClippingWidthDelta( textLeft - textRight );\r\n\t\t\t}\r\n\r\n\t\t\tconst textAlign = this._textAlign;\r\n\t\t\tconst textWidth = text.width;\r\n\t\t\tconst textHeight = text.height;\r\n\t\t\tswitch( textAlign.horizontal ) {\r\n\t\t\tcase DAlignHorizontal.LEFT:\r\n\t\t\t\ttextLeftAdjust = pl;\r\n\t\t\t\ttextRightAdjust = textLeftAdjust + textLeft + textWidth - textRight;\r\n\t\t\t\tbreak;\r\n\t\t\tcase DAlignHorizontal.CENTER:\r\n\t\t\t\ttextLeftAdjust = (width - textLeft + textRight - textWidth) * 0.5;\r\n\t\t\t\ttextRightAdjust = textLeftAdjust + textLeft + textWidth - textRight;\r\n\t\t\t\tbreak;\r\n\t\t\tcase DAlignHorizontal.RIGHT:\r\n\t\t\t\ttextRightAdjust = width - pr;\r\n\t\t\t\ttextLeftAdjust = textRightAdjust + textRight - textWidth - textLeft;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\ttext.x = toRounded( textLeftAdjust + textLeft );\r\n\t\t\ttextCenterAdjust = textLeftAdjust + textLeft + textWidth * 0.5;\r\n\r\n\t\t\tswitch( textAlign.vertical ) {\r\n\t\t\tcase DAlignVertical.TOP:\r\n\t\t\t\ttextTopAdjust = pt;\r\n\t\t\t\ttextBottomAdjust = textTopAdjust + textTop + textHeight - textBottom;\r\n\t\t\t\tbreak;\r\n\t\t\tcase DAlignVertical.MIDDLE:\r\n\t\t\t\ttextTopAdjust = (height - textTop + textBottom - textHeight) * 0.5;\r\n\t\t\t\ttextBottomAdjust = textTopAdjust + textTop + textHeight - textBottom;\r\n\t\t\t\tbreak;\r\n\t\t\tcase DAlignVertical.BOTTOM:\r\n\t\t\t\ttextBottomAdjust = height - pb;\r\n\t\t\t\ttextTopAdjust = textBottomAdjust + textBottom - textHeight - textTop;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\ttext.y = toRounded( textTopAdjust + textTop );\r\n\t\t\ttextMiddleAdjust = textTopAdjust + textTop + textHeight * 0.5;\r\n\t\t} else {\r\n\t\t\ttextLeftAdjust = (width - textLeft + textRight) * 0.5;\r\n\t\t\ttextRightAdjust = textLeftAdjust + textLeft - textRight;\r\n\t\t\ttextCenterAdjust = textLeftAdjust + textLeft;\r\n\r\n\t\t\ttextTopAdjust = (height - textTop + textBottom) * 0.5;\r\n\t\t\ttextBottomAdjust = textTopAdjust + textTop - textBottom;\r\n\t\t\ttextMiddleAdjust = textTopAdjust + textTop;\r\n\t\t}\r\n\r\n\t\tconst paddingCenterAdjust = width * 0.5;\r\n\t\tconst paddingMiddleAdjust = height * 0.5;\r\n\r\n\t\tconst borderCenterAdjust = width * 0.5;\r\n\t\tconst borderMiddleAdjust = height * 0.5;\r\n\r\n\t\tfor( let i = 0, imax = images.length; i < imax; ++i ) {\r\n\t\t\tconst image = images[ i ];\r\n\t\t\tconst imageImage = image.image;\r\n\t\t\tif( imageImage ) {\r\n\t\t\t\tconst imageBound = image.bound;\r\n\t\t\t\tconst imageBoundWidth = imageBound.width;\r\n\t\t\t\tconst imageBoundHeight = imageBound.height;\r\n\r\n\t\t\t\t// Text\r\n\t\t\t\tif( image.align.with === DAlignWith.TEXT ) {\r\n\t\t\t\t\tswitch( image.align.horizontal ) {\r\n\t\t\t\t\tcase DAlignHorizontal.LEFT:\r\n\t\t\t\t\t\timageImage.x = toRounded( imageImage.x + textLeftAdjust );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignHorizontal.CENTER:\r\n\t\t\t\t\t\timageImage.x = toRounded( textCenterAdjust - imageBoundWidth * 0.5 );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignHorizontal.RIGHT:\r\n\t\t\t\t\t\timageImage.x = toRounded( imageImage.x + textRightAdjust );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tswitch( image.align.vertical ) {\r\n\t\t\t\t\tcase DAlignVertical.TOP:\r\n\t\t\t\t\t\timageImage.y = toRounded( imageImage.y + textTopAdjust );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignVertical.MIDDLE:\r\n\t\t\t\t\t\timageImage.y = toRounded( textMiddleAdjust - imageBoundHeight * 0.5 );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase DAlignVertical.BOTTOM:\r\n\t\t\t\t\t\timageImage.y = toRounded( imageImage.y + textBottomAdjust );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Padding\r\n\t\t\t\tif( image.align.with === DAlignWith.PADDING ) {\r\n\t\t\t\t\tswitch( image.align.horizontal ) {\r\n\t\t\t\t\tcase DAlignHorizontal.CENTER:\r\n\t\t\t\t\t\timageImage.x = toRounded( paddingCenterAdjust - imageBoundWidth * 0.5 );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tswitch( image.align.vertical ) {\r\n\t\t\t\t\tcase DAlignVertical.MIDDLE:\r\n\t\t\t\t\t\timageImage.y = toRounded( paddingMiddleAdjust - imageBoundHeight * 0.5 );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Border\r\n\t\t\t\tif( image.align.with === DAlignWith.BORDER ) {\r\n\t\t\t\t\tswitch( image.align.horizontal ) {\r\n\t\t\t\t\tcase DAlignHorizontal.CENTER:\r\n\t\t\t\t\t\timageImage.x = toRounded( borderCenterAdjust - imageBoundWidth * 0.5 );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tswitch( image.align.vertical ) {\r\n\t\t\t\t\tcase DAlignVertical.MIDDLE:\r\n\t\t\t\t\t\timageImage.y = toRounded( borderMiddleAdjust - imageBoundHeight * 0.5 );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected isRefitable( target: any ): target is DRefitable {\r\n\t\tif( super.isRefitable( target ) ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tconst images = this._images;\r\n\t\tfor( let i = 0, imax = images.length; i < imax; ++i ) {\r\n\t\t\tif( images[ i ].isRefitable( target ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DImageBase\";\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst images = this._images;\r\n\t\tfor( let i = 0, imax = images.length; i < imax; ++i ) {\r\n\t\t\timages[ i ].destroy();\r\n\t\t}\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\r\n\r\nexport interface DImageOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeImage = DThemeImage\r\n> extends DImageBaseOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeImage extends DThemeImageBase {\r\n\r\n}\r\n\r\nexport class DImage<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeImage = DThemeImage,\r\n\tOPTIONS extends DImageOptions<VALUE, THEME> = DImageOptions<VALUE, THEME>\r\n> extends DImageBase<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DImage\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DBaseStates } from \"./d-base-states\";\r\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\n\r\nexport interface DListItemOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeListItem = DThemeListItem\r\n> extends DImageOptions<string, THEME> {\r\n\tvalue?: VALUE;\r\n}\r\n\r\nexport interface DThemeListItem extends DThemeImage {\r\n\tgetTextValue( state: DBaseState ): string;\r\n\tnewTextValue(): DStateAwareOrValueMightBe<string>;\r\n}\r\n\r\n// Option parser\r\nconst toValue = <VALUE, THEME extends DThemeListItem>( options?: DListItemOptions<VALUE, THEME> ): VALUE | null => {\r\n\treturn ( options != null && options.value != null ?\r\n\t\toptions.value : null );\r\n};\r\n\r\nexport interface DListItemSelection {\r\n\tadd( item: DBase ): void;\r\n}\r\n\r\nexport class DListItem<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeListItem = DThemeListItem,\r\n\tOPTIONS extends DListItemOptions<VALUE, THEME> = DListItemOptions<VALUE, THEME>\r\n> extends DImage<string, THEME, OPTIONS> {\r\n\tprotected _value!: VALUE | null;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.buttonMode = true;\r\n\t\tthis._value = toValue( options );\r\n\t}\r\n\r\n\tget value(): VALUE | null {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\tset value( value: VALUE | null ) {\r\n\t\tthis._value = value;\r\n\t}\r\n\r\n\tprotected hasSelection( target: any ): target is { selection: DListItemSelection } {\r\n\t\treturn ( target && target.selection && target.selection.add );\r\n\t}\r\n\r\n\tprotected getSelection(): DListItemSelection | null {\r\n\t\tlet parent = this.parent as any;\r\n\t\twhile( parent ) {\r\n\t\t\tif( this.hasSelection( parent ) ) {\r\n\t\t\t\treturn parent.selection;\r\n\t\t\t}\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected onSelect( e: KeyboardEvent | interaction.InteractionEvent ): void {\r\n\t\tthis.emit( \"select\", this );\r\n\t\tconst selection = this.getSelection();\r\n\t\tif( selection ) {\r\n\t\t\tselection.add( this );\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tif( this.isActionable() && this.isFocused() && UtilKeyboardEvent.isActivateKey( e ) ) {\r\n\t\t\tthis.onSelect( e );\r\n\t\t}\r\n\r\n\t\treturn super.onKeyDown( e );\r\n\t}\r\n\r\n\tprotected onStateChange( newState: number, oldState: number ) {\r\n\t\tsuper.onStateChange( newState, oldState );\r\n\t\tthis.buttonMode = DBaseStates.isActionable( newState );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DListItem\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DListItem, DListItemOptions, DThemeListItem } from \"./d-list-item\";\r\nimport { Closeable, DMenuContext } from \"./d-menu-context\";\r\n\r\nexport interface DMenuItemOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItem = DThemeMenuItem\r\n> extends DListItemOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeMenuItem extends DThemeListItem {\r\n\r\n}\r\n\r\nexport class DMenuItem<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItem = DThemeMenuItem,\r\n\tOPTIONS extends DMenuItemOptions<VALUE, THEME> = DMenuItemOptions<VALUE, THEME>\r\n> extends DListItem<VALUE, THEME, OPTIONS> {\r\n\tgetContext(): DMenuContext | null {\r\n\t\tlet parent = this.parent as any;\r\n\t\twhile( parent ) {\r\n\t\t\tif( parent.getContext ) {\r\n\t\t\t\treturn parent.getContext();\r\n\t\t\t}\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tgetCloseable(): Closeable | null {\r\n\t\tlet parent = this.parent as any;\r\n\t\twhile( parent ) {\r\n\t\t\tif( parent.getCloseable ) {\r\n\t\t\t\treturn parent.getCloseable();\r\n\t\t\t}\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItem\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Text } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DDynamicText } from \"./d-dynamic-text\";\r\nimport { DMenuItem, DMenuItemOptions, DThemeMenuItem } from \"./d-menu-item\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DMenuItemTextOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText\r\n> extends DMenuItemOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeMenuItemText extends DThemeMenuItem {\r\n\tgetShortcutTextMargin(): number;\r\n}\r\n\r\nexport class DMenuItemText<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText,\r\n\tOPTIONS extends DMenuItemTextOptions<VALUE, THEME> = DMenuItemTextOptions<VALUE, THEME>\r\n> extends DMenuItem<VALUE, THEME, OPTIONS> {\r\n\tprotected _shortcutText!: Text | DDynamicText | null;\r\n\tprotected _shortcutMargin!: number;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.initOnClick( options );\r\n\t\tthis.initOnOver( options );\r\n\t\tthis.initShortcuts( options );\r\n\t}\r\n\r\n\tprotected initOnClick( options?: OPTIONS ): void {\r\n\t\tUtilPointerEvent.onClick( this, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( this.isActionable() ) {\r\n\t\t\t\tthis.onSelect( e );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected initOnOver( options?: OPTIONS ): void {\r\n\t\tthis.on( UtilPointerEvent.over, (): void => {\r\n\t\t\tconst context = this.getContext();\r\n\t\t\tif( context != null ) {\r\n\t\t\t\tconst parent = this.parent;\r\n\t\t\t\tif( parent instanceof DBase ) {\r\n\t\t\t\t\tcontext.trim( this.getCloseable() );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected initShortcuts( options?: OPTIONS ): void {\r\n\t\tconst shortcuts = this._shortcuts;\r\n\t\tthis._shortcutMargin = this.theme.getShortcutTextMargin();\r\n\t\tif( shortcuts != null && 0 < shortcuts.length ) {\r\n\t\t\tconst shortcut = shortcuts[ 0 ];\r\n\t\t\tconst shortcutTextValue = UtilKeyboardEvent.toString( shortcut );\r\n\t\t\tthis._shortcutText = ( this._textDynamic ?\r\n\t\t\t\tnew DDynamicText( shortcutTextValue, this._textStyle ) :\r\n\t\t\t\tnew Text( shortcutTextValue, this._textStyle )\r\n\t\t\t);\r\n\t\t\tthis.appendRenderable( this._shortcutText, true );\r\n\t\t} else {\r\n\t\t\tthis._shortcutText = null;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateShortcutText(): void {\r\n\t\tconst text = this._shortcutText;\r\n\t\tif( text != null ) {\r\n\t\t\tconst toRounded = this.toRounded;\r\n\t\t\ttext.position.set(\r\n\t\t\t\ttoRounded( this.width - this._shortcutMargin - text.width ),\r\n\t\t\t\ttoRounded( ( this.height - text.height ) * 0.5 )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateTextColor( text: DDynamicText | Text ): void {\r\n\t\tsuper.updateTextColor( text );\r\n\r\n\t\tconst shortcutText = this._shortcutText;\r\n\t\tif( shortcutText != null ) {\r\n\t\t\tconst theme = this.theme;\r\n\t\t\tconst state = this.state;\r\n\t\t\tshortcutText.style.fill = theme.getColor( state );\r\n\t\t\tshortcutText.alpha = theme.getAlpha( state );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateText(): void {\r\n\t\tsuper.updateText();\r\n\t\tthis.updateShortcutText();\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemText\";\r\n\t}\r\n\r\n\tprotected onSelect( e: KeyboardEvent | interaction.InteractionEvent ): void {\r\n\t\tsuper.onSelect( e );\r\n\t\tconst closeable = this.getCloseable();\r\n\t\tif( closeable != null ) {\r\n\t\t\tcloseable.emit( \"select\", this.value, this, closeable );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onShortcut( e: KeyboardEvent ) {\r\n\t\tsuper.onShortcut( e );\r\n\t\tthis.onSelect( e );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\nimport { DMenuItemText, DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\r\n\r\nexport interface DMenuItemCheckOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck\r\n> extends DMenuItemTextOptions<VALUE, THEME> {\r\n\tcheck: boolean;\r\n}\r\n\r\nexport interface DThemeMenuItemCheck extends DThemeMenuItemText {\r\n\r\n}\r\n\r\nexport class DMenuItemCheck<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck,\r\n\tOPTIONS extends DMenuItemCheckOptions<VALUE, THEME> = DMenuItemCheckOptions<VALUE, THEME>\r\n> extends DMenuItemText<VALUE, THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tif( options && options.check ) {\r\n\t\t\tthis.setActive( true );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemCheck\";\r\n\t}\r\n\r\n\tprotected onSelect( e: KeyboardEvent | interaction.InteractionEvent ): void {\r\n\t\tthis.setActive( ! this.isActive() );\r\n\t\tsuper.onSelect( e );\r\n\t}\r\n\r\n\tstatic isCompatible<VALUE>( options: DMenuItemOptionsUnion<VALUE> ): options is DMenuItemCheckOptions<VALUE> {\r\n\t\treturn \"check\" in options;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, DisplayObject } from \"pixi.js\";\r\nimport { DMenu, DMenuOptions } from \"./d-menu\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\n\r\nexport type DMenuItemCreator = ( options: DMenuItemOptionsUnion<any>, sticky: boolean ) => DisplayObject | null;\r\n\r\nexport type DMenuMenuCreator = ( options?: DMenuOptions ) => DMenu<any>;\r\n\r\nexport class DMenus {\r\n\tprotected static CREATORS: DMenuItemCreator[] = [];\r\n\tprotected static CREATOR_DEFAULT: DMenuItemCreator | null = null;\r\n\tprotected static MENU_CREATOR?: DMenuMenuCreator;\r\n\r\n\tstatic addItemCreator( creator: DMenuItemCreator ): void {\r\n\t\tthis.CREATORS.push( creator );\r\n\t}\r\n\r\n\tstatic setItemCreatorDefault( creator: DMenuItemCreator ): void {\r\n\t\tthis.CREATOR_DEFAULT = creator;\r\n\t}\r\n\r\n\tstatic setMenuCreator( creator: DMenuMenuCreator ): void {\r\n\t\tthis.MENU_CREATOR = creator;\r\n\t}\r\n\r\n\tstatic newItemOf<VALUE>(\r\n\t\tcreators: DMenuItemCreator[],\r\n\t\tcreatorDefault: DMenuItemCreator | null,\r\n\t\toptions: DMenuItemOptionsUnion<VALUE>,\r\n\t\tsticky: boolean\r\n\t): DisplayObject | null {\r\n\t\tfor( let i = 0, imax = creators.length; i < imax; ++i ) {\r\n\t\t\tconst created = creators[ i ]( options, sticky );\r\n\t\t\tif( created != null ) {\r\n\t\t\t\treturn created;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( creatorDefault ) {\r\n\t\t\treturn creatorDefault( options, sticky );\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic newItem<VALUE>( options: DMenuItemOptionsUnion<VALUE>, sticky: boolean ): DisplayObject | null {\r\n\t\treturn this.newItemOf( this.CREATORS, this.CREATOR_DEFAULT, options, sticky );\r\n\t}\r\n\r\n\tstatic newItemsOf<VALUE>(\r\n\t\tcreator: { newItem( options: DMenuItemOptionsUnion<VALUE>, sticky: boolean ): DisplayObject | null },\r\n\t\tparent: Container,\r\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject | null | undefined>,\r\n\t\tsticky: boolean\r\n\t): void {\r\n\t\tfor( let i = 0, imax = items.length; i < imax; ++i ) {\r\n\t\t\tconst item = items[ i ];\r\n\t\t\tif( item instanceof DisplayObject ) {\r\n\t\t\t\tparent.addChild( item );\r\n\t\t\t} else if( item != null ) {\r\n\t\t\t\tconst created = creator.newItem( item, sticky );\r\n\t\t\t\tif( created != null ) {\r\n\t\t\t\t\tparent.addChild( created );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error( `No matching menu item creator found: ${JSON.stringify( item )}` );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tstatic newItems<VALUE>(\r\n\t\tparent: Container,\r\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject | null | undefined>,\r\n\t\tsticky: boolean\r\n\t): void {\r\n\t\tthis.newItemsOf( this, parent, items, sticky );\r\n\t}\r\n\r\n\tstatic newMenu<VALUE>( options?: DMenuOptions<VALUE> ): DMenu<VALUE> {\r\n\t\tif( this.MENU_CREATOR != null ) {\r\n\t\t\treturn this.MENU_CREATOR( options );\r\n\t\t} else {\r\n\t\t\tthrow new Error( \"Missing DMenu creator.\" );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DLayoutDirection {\r\n\tVERTICAL,\r\n\tHORIZONTAL\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, interaction } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DLinkMenuItemId } from \"./d-link-menu-item-id\";\r\nimport { DLinkTarget } from \"./d-link-target\";\r\nimport { DMenu, DMenuOptions } from \"./d-menu\";\r\nimport { Closeable } from \"./d-menu-context\";\r\nimport { DMenuItem } from \"./d-menu-item\";\r\nimport { DMenus } from \"./d-menus\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilClipboard } from \"./util/util-clipboard\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport type DLinkUrlMaker = () => string | null | Promise<string | null>;\r\nexport type DLinkChecker = () => boolean | Promise<boolean>;\r\n\r\nexport interface DLinkOptions {\r\n\turl?: string | DLinkUrlMaker;\r\n\ttarget?: DLinkTarget;\r\n\tchecker?: DLinkChecker;\r\n\tmenu?: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\r\n}\r\n\r\nexport interface DThemeLink {\r\n\tgetLinkMenuOptions(): DMenuOptions<DLinkMenuItemId>;\r\n}\r\n\r\nexport class DLink {\r\n\tprotected _url?: string | DLinkUrlMaker;\r\n\tprotected _target?: DLinkTarget;\r\n\tprotected _checker?: DLinkChecker;\r\n\tprotected _menu?: DMenu<DLinkMenuItemId>;\r\n\tprotected _menuOptions?: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\r\n\tprotected _theme: DThemeLink;\r\n\r\n\tconstructor( theme: DThemeLink, options?: DLinkOptions ) {\r\n\t\tif( options ) {\r\n\t\t\tthis._url = options.url;\r\n\t\t\tthis._target = options.target;\r\n\t\t\tthis._checker = options.checker;\r\n\t\t\tthis._menuOptions = options.menu;\r\n\t\t}\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tget url(): string | null | Promise<string | null> {\r\n\t\tconst url = this._url;\r\n\t\tif( isString( url ) ) {\r\n\t\t\treturn url;\r\n\t\t} else if( url == null ) {\r\n\t\t\treturn null;\r\n\t\t} else {\r\n\t\t\treturn url();\r\n\t\t}\r\n\t}\r\n\r\n\tget target(): DLinkTarget | undefined {\r\n\t\treturn this._target;\r\n\t}\r\n\r\n\tget menu(): DMenu<DLinkMenuItemId> {\r\n\t\tlet menu = this._menu;\r\n\t\tif( menu == null ) {\r\n\t\t\tconst options = this._menuOptions || this._theme.getLinkMenuOptions();\r\n\t\t\tmenu = this.toMenu( options );\r\n\t\t\tthis._menu = menu;\r\n\t\t\tmenu.on( \"select\", (\r\n\t\t\t\tvalue: DLinkMenuItemId,\r\n\t\t\t\titem: DMenuItem<DLinkMenuItemId>,\r\n\t\t\t\tcloseable: Closeable\r\n\t\t\t): void => {\r\n\t\t\t\tthis.onMenuSelect( value, item, closeable );\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn menu;\r\n\t}\r\n\r\n\tprotected toMenu( options: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId> ): DMenu<DLinkMenuItemId> {\r\n\t\tif( options instanceof DisplayObject ) {\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\treturn this.newMenu( options );\r\n\t}\r\n\r\n\tprotected newMenu( options: DMenuOptions<DLinkMenuItemId> ): DMenu<DLinkMenuItemId> {\r\n\t\treturn DMenus.newMenu( options );\r\n\t}\r\n\r\n\tprotected onMenuSelect(\r\n\t\tvalue: DLinkMenuItemId,\r\n\t\titem: DMenuItem<DLinkMenuItemId>,\r\n\t\tcloseable: Closeable\r\n\t): void {\r\n\t\tswitch( value ) {\r\n\t\tcase DLinkMenuItemId.OPEN_LINK_IN_NEW_WINDOW:\r\n\t\t\tthis.open( true );\r\n\t\t\tbreak;\r\n\t\tcase DLinkMenuItemId.COPY_LINK_ADDRESS:\r\n\t\t\tconst url = this.url;\r\n\t\t\tif( url != null ) {\r\n\t\t\t\tif( isString( url ) ) {\r\n\t\t\t\t\tthis.copy( url );\r\n\t\t\t\t} else {\r\n\t\t\t\t\turl.then(( resolved: string | null ): void => {\r\n\t\t\t\t\t\tif( resolved != null ) {\r\n\t\t\t\t\t\t\tthis.copy( resolved );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tcopy( url: string ): void {\r\n\t\tconst a = document.createElement( \"a\" );\r\n\t\ta.href = url;\r\n\t\tUtilClipboard.copy( a.href );\r\n\t}\r\n\r\n\tapply( target: DBase, onSelect: ( e: interaction.InteractionEvent ) => void ): void {\r\n\t\tconst onClick = ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( target.isActionable() ) {\r\n\t\t\t\tonSelect( e );\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst onLongClick = ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( target.isActionable() ) {\r\n\t\t\t\tconst menu = this.menu;\r\n\t\t\t\tif( menu.isHidden() ) {\r\n\t\t\t\t\tmenu.open( target );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tif( this._target === DLinkTarget.NEW_WINDOW ) {\r\n\t\t\tUtilPointerEvent.onClick( target, onClick );\r\n\t\t} else {\r\n\t\t\tUtilPointerEvent.onLongClick( target, onClick, onLongClick );\r\n\t\t}\r\n\t}\r\n\r\n\topen( inNewWindow: boolean ): void {\r\n\t\tconst url = this.url;\r\n\t\tif( url != null ) {\r\n\t\t\tif( isString( url )  ) {\r\n\t\t\t\tthis.check( url, inNewWindow );\r\n\t\t\t} else {\r\n\t\t\t\turl.then(( resolved: string | null ): void => {\r\n\t\t\t\t\tif( resolved ) {\r\n\t\t\t\t\t\tthis.check( resolved, inNewWindow );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcheck( url: string, inNewWindow: boolean ): void {\r\n\t\tconst checker = this._checker;\r\n\t\tif( checker ) {\r\n\t\t\tconst checked = checker();\r\n\t\t\tif( checked === true ) {\r\n\t\t\t\tthis.exec( url, inNewWindow );\r\n\t\t\t} else if( checked === false ) {\r\n\t\t\t\t// DO NOTHING\r\n\t\t\t} else {\r\n\t\t\t\tchecked.then(( resolved: boolean ): void => {\r\n\t\t\t\t\tif( resolved ) {\r\n\t\t\t\t\t\tthis.exec( url, inNewWindow );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.exec( url, inNewWindow );\r\n\t\t}\r\n\t}\r\n\r\n\texec( url: string, inNewWindow: boolean ): void {\r\n\t\tif( inNewWindow ) {\r\n\t\t\tconst a = document.createElement( \"a\" );\r\n\t\t\ta.href = url;\r\n\t\t\ta.target = \"_blank\";\r\n\t\t\ta.style.display = \"none\";\r\n\t\t\ta.rel = \"noopener noreferrer\";\r\n\t\t\tdocument.body.appendChild( a );\r\n\t\t\ta.click();\r\n\t\t\tsetTimeout((): void => {\r\n\t\t\t\tdocument.body.removeChild( a );\r\n\t\t\t}, 100);\r\n\t\t} else {\r\n\t\t\twindow.location.href = url;\r\n\t\t}\r\n\t}\r\n\r\n\tinNewWindow( e?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent ): boolean {\r\n\t\tif( this._target === DLinkTarget.NEW_WINDOW ) {\r\n\t\t\treturn true;\r\n\t\t} else if( e != null ) {\r\n\t\t\tconst oe = ( e instanceof interaction.InteractionEvent ? e.data.originalEvent : e );\r\n\t\t\treturn (\r\n\t\t\t\t( oe.ctrlKey || oe.shiftKey || oe.altKey || oe.metaKey ) ||\r\n\t\t\t\t( \"button\" in oe && oe.button !== 0 )\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n}\r\n","import { DBaseState } from \"./d-base-state\";\r\n\r\nexport const DMenuItemLinkState = {\r\n\tNEW_WINDOW: DBaseState.CUSTOM\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DLink, DLinkChecker, DLinkOptions, DLinkUrlMaker, DThemeLink } from \"./d-link\";\r\nimport { DLinkMenuItemId } from \"./d-link-menu-item-id\";\r\nimport { DLinkTarget } from \"./d-link-target\";\r\nimport { DMenu, DMenuOptions } from \"./d-menu\";\r\nimport { DMenuItemLinkState } from \"./d-menu-item-link-state\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\nimport { DMenuItemText, DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport type DMenuItemLinkUrlMaker = ( item: DMenuItemLink ) => string | null | Promise<string | null>;\r\nexport type DMenuItemLinkChecker = ( item: DMenuItemLink ) => boolean | Promise<boolean>;\r\n\r\nexport interface DMenuItemLinkOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink\r\n> extends DMenuItemTextOptions<VALUE, THEME> {\r\n\turl?: string | DMenuItemLinkUrlMaker;\r\n\ttarget?: DLinkTarget;\r\n\tchecker?: DMenuItemLinkChecker;\r\n\tmenu?: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\r\n}\r\n\r\nexport interface DThemeMenuItemLink extends DThemeMenuItemText, DThemeLink {\r\n\r\n}\r\n\r\nexport class DMenuItemLink<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink,\r\n\tOPTIONS extends DMenuItemLinkOptions<VALUE, THEME> = DMenuItemLinkOptions<VALUE, THEME>\r\n> extends DMenuItemText<VALUE, THEME, OPTIONS> {\r\n\tprotected _link!: DLink;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected toLinkOptions( options?: OPTIONS ): DLinkOptions | undefined {\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\turl: this.toUrl( options.url ),\r\n\t\t\t\ttarget: options.target,\r\n\t\t\t\tchecker: this.toChecker( options.checker ),\r\n\t\t\t\tmenu: options.menu\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tprotected toUrl( url?: string | DMenuItemLinkUrlMaker ): string | DLinkUrlMaker | undefined {\r\n\t\tif( isString( url ) || url == null ) {\r\n\t\t\treturn url;\r\n\t\t} else {\r\n\t\t\treturn () => {\r\n\t\t\t\treturn url( this );\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toChecker( checker?: DMenuItemLinkChecker ): DLinkChecker | undefined {\r\n\t\tif( checker != null ) {\r\n\t\t\treturn () => {\r\n\t\t\t\treturn checker( this );\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\tif( options && options.target === DLinkTarget.NEW_WINDOW ) {\r\n\t\t\toptions.state = ( options.state || DBaseState.NONE ) || DMenuItemLinkState.NEW_WINDOW;\r\n\t\t}\r\n\t\tthis._link = new DLink( this.theme, this.toLinkOptions( options ) );\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tget url(): string | null | Promise<string | null> {\r\n\t\treturn this._link.url;\r\n\t}\r\n\r\n\tget menu(): DMenu<DLinkMenuItemId> {\r\n\t\treturn this._link.menu;\r\n\t}\r\n\r\n\tprotected initOnClick( options?: OPTIONS ): void {\r\n\t\tthis._link.apply( this, ( e ) => this.onSelect( e ) );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemLink\";\r\n\t}\r\n\r\n\tprotected onSelect( e: KeyboardEvent | interaction.InteractionEvent ): void {\r\n\t\tsuper.onSelect( e );\r\n\t\tthis.open( this._link.inNewWindow( e ) );\r\n\t}\r\n\r\n\topen( inNewWindow: boolean ): void {\r\n\t\tthis._link.open( inNewWindow );\r\n\t}\r\n\r\n\tprotected onShortcut( e: KeyboardEvent ) {\r\n\t\tsuper.onShortcut( e );\r\n\t\tthis.onSelect( e );\r\n\t}\r\n\r\n\tstatic isCompatible<VALUE>( options: DMenuItemOptionsUnion<VALUE> ): options is DMenuItemLinkOptions<VALUE> {\r\n\t\treturn \"url\" in options;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { UtilAttachAlign } from \"./util/util-attach\";\r\n\r\nexport import DMenuAlign = UtilAttachAlign;\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, interaction } from \"pixi.js\";\r\nimport { DMenu, DMenuOptions } from \"./d-menu\";\r\nimport { DMenuAlign } from \"./d-menu-align\";\r\nimport { Closeable } from \"./d-menu-context\";\r\nimport { DMenuItem, DMenuItemOptions, DThemeMenuItem } from \"./d-menu-item\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\nimport { DMenus } from \"./d-menus\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DMenuItemMenuOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu\r\n> extends DMenuItemOptions<VALUE, THEME> {\r\n\tmenu: DMenuOptions<VALUE> | DMenu<VALUE>;\r\n}\r\n\r\nexport interface DThemeMenuItemMenu extends DThemeMenuItem {\r\n\r\n}\r\n\r\nexport class DMenuItemMenu<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu,\r\n\tOPTIONS extends DMenuItemMenuOptions<VALUE, THEME> = DMenuItemMenuOptions<VALUE, THEME>\r\n> extends DMenuItem<VALUE, THEME, OPTIONS> {\r\n\tprotected _menu!: DMenu<VALUE>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tUtilPointerEvent.onClick( this, (): void => {\r\n\t\t\tif( this.isActionable() ) {\r\n\t\t\t\tthis.open();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.initHover( options );\r\n\r\n\t\tconst menu = this.toMenu( options );\r\n\t\tthis._menu = menu;\r\n\t\tmenu.on( \"select\", ( value: VALUE, item: DMenuItem<VALUE>, closeable: Closeable ): void => {\r\n\t\t\tthis.onMenuSelect( value, item, closeable );\r\n\t\t});\r\n\t}\r\n\r\n\tprotected initHover( options: OPTIONS ): void {\r\n\t\tthis.on( UtilPointerEvent.over, (): void => {\r\n\t\t\tif( this.isActionable() ) {\r\n\t\t\t\tthis.open();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected toMenu( options: OPTIONS ): DMenu<VALUE> {\r\n\t\tconst menu = options.menu;\r\n\t\tif( menu instanceof DisplayObject ) {\r\n\t\t\treturn menu;\r\n\t\t}\r\n\t\treturn this.newMenu( menu );\r\n\t}\r\n\r\n\tprotected newMenu( options: DMenuOptions<VALUE> ): DMenu<VALUE> {\r\n\t\treturn DMenus.newMenu( options );\r\n\t}\r\n\r\n\tget menu(): DMenu<VALUE> {\r\n\t\treturn this._menu;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemMenu\";\r\n\t}\r\n\r\n\topen(): void {\r\n\t\tconst menu = this._menu;\r\n\t\tif( menu.isHidden() ) {\r\n\t\t\tthis.onOpen( menu );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onOpen( menu: DMenu<VALUE> ): void {\r\n\t\tconst context = this.getContext();\r\n\t\tif( context != null ) {\r\n\t\t\tmenu.open( this, this.getCloseable(), context );\r\n\t\t}\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tthis._menu.close();\r\n\t}\r\n\r\n\ttoggle(): void {\r\n\t\tconst menu = this._menu;\r\n\t\tif( menu.isHidden() ) {\r\n\t\t\tthis.onOpen( menu );\r\n\t\t} else {\r\n\t\t\tmenu.close();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onSelect( e: KeyboardEvent | interaction.InteractionEvent ): void {\r\n\t\tthis.open();\r\n\t\tsuper.onSelect( e );\r\n\t}\r\n\r\n\tprotected onMenuSelect( value: VALUE, item: DMenuItem<VALUE>, closeable: Closeable ): void {\r\n\t\tconst next = this.getCloseable();\r\n\t\tif( next != null ) {\r\n\t\t\tnext.emit( \"select\", value, item, closeable );\r\n\t\t}\r\n\t}\r\n\r\n\tstatic isCompatible<VALUE>( options: DMenuItemOptionsUnion<VALUE> ): options is DMenuItemMenuOptions<VALUE> {\r\n\t\treturn \"menu\" in options;\r\n\t}\r\n\r\n\tstatic toSubMenuOptions<VALUE>( options: DMenuItemMenuOptions<VALUE>, sticky: boolean ): DMenuItemMenuOptions<VALUE> {\r\n\t\tconst menu = options.menu;\r\n\t\tif( ! (menu instanceof DisplayObject) ) {\r\n\t\t\tif( menu.sticky == null ) {\r\n\t\t\t\tmenu.sticky = sticky;\r\n\t\t\t}\r\n\t\t\tif( menu.align == null ) {\r\n\t\t\t\tmenu.align = DMenuAlign.RIGHT;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Graphics } from \"pixi.js\";\r\nimport { DBase, DReflowable } from \"./d-base\";\r\n\r\nexport class DListItemSeparatorReflowable extends Graphics implements DReflowable {\r\n\tconstructor( base: DBase ) {\r\n\t\tsuper();\r\n\t\tbase.appendRenderable( this, true );\r\n\t\tbase.addReflowable( this );\r\n\t}\r\n\r\n\tonReflow( base: DBase, width: number, height: number ): void {\r\n\t\tconst state = base.state;\r\n\t\tconst border = base.border;\r\n\t\tconst borderWidth = border.getWidth( state );\r\n\t\tconst borderColor = border.getColor( state );\r\n\t\tif( borderColor != null ) {\r\n\t\t\tconst borderAlpha = border.getAlpha( state );\r\n\t\t\tconst borderAlign = border.getAlign( state );\r\n\t\t\tconst padding = base.padding;\r\n\t\t\tconst middle = height * 0.5;\r\n\t\t\tthis.clear();\r\n\t\t\tthis.lineStyle( borderWidth, borderColor, borderAlpha, borderAlign );\r\n\t\t\tthis.moveTo( padding.getLeft(), middle );\r\n\t\t\tthis.lineTo( width - padding.getRight(), middle );\r\n\t\t\tthis.visible = true;\r\n\t\t} else {\r\n\t\t\tthis.clear();\r\n\t\t\tthis.visible = false;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DListItem, DListItemOptions, DThemeListItem } from \"./d-list-item\";\r\nimport { DListItemSeparatorReflowable } from \"./d-list-item-separator-reflowable\";\r\n\r\nexport interface DListItemSeparatorOptions<VALUE, THEME extends DThemeListItemSeparator>\r\n\textends DListItemOptions<VALUE, THEME> {\r\n\tseparator?: true;\r\n}\r\n\r\nexport interface DThemeListItemSeparator extends DThemeListItem {\r\n\r\n}\r\n\r\nexport class DListItemSeparator<\r\n\tVALUE,\r\n\tTHEME extends DThemeListItemSeparator = DThemeListItemSeparator,\r\n\tOPTIONS extends DListItemSeparatorOptions<VALUE, THEME> = DListItemSeparatorOptions<VALUE, THEME>\r\n> extends DListItem<VALUE, THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.interactive = false;\r\n\t\tthis.buttonMode = false;\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t}\r\n\r\n\tprotected initReflowable(): void {\r\n\t\tnew DListItemSeparatorReflowable( this );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DListItemSeparator\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DListItemSeparator, DListItemSeparatorOptions, DThemeListItemSeparator } from \"./d-list-item-separator\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\n\r\nexport interface DMenuItemSeparatorOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator\r\n> extends DListItemSeparatorOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeMenuItemSeparator extends DThemeListItemSeparator {\r\n\r\n}\r\n\r\nexport class DMenuItemSeparator<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator,\r\n\tOPTIONS extends DMenuItemSeparatorOptions<VALUE, THEME> = DMenuItemSeparatorOptions<VALUE, THEME>\r\n> extends DListItemSeparator<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemSeparator\";\r\n\t}\r\n\r\n\tstatic isCompatible<VALUE>( options: DMenuItemOptionsUnion<VALUE> ): options is DMenuItemSeparatorOptions<VALUE> {\r\n\t\treturn \"separator\" in options;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\n\r\nexport interface DLayoutSpaceOptions<THEME extends DThemeLayoutSpace = DThemeLayoutSpace> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeLayoutSpace extends DThemeBase {\r\n\r\n}\r\n\r\nexport class DLayoutSpace<\r\n\tTHEME extends DThemeLayoutSpace = DThemeLayoutSpace,\r\n\tOPTIONS extends DLayoutSpaceOptions<THEME> = DLayoutSpaceOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis.visible = false;\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DLayoutSpace\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DLayoutSpace, DLayoutSpaceOptions, DThemeLayoutSpace } from \"./d-layout-space\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\n\r\nexport interface DMenuItemSpaceOptions<\r\n\tTHEME extends DThemeMenuItemSpace = DThemeMenuItemSpace\r\n> extends DLayoutSpaceOptions<THEME> {\r\n\tspace: true;\r\n}\r\n\r\nexport interface DThemeMenuItemSpace extends DThemeLayoutSpace {\r\n\r\n}\r\n\r\nexport class DMenuItemSpace<\r\n\tTHEME extends DThemeMenuItemSpace = DThemeMenuItemSpace,\r\n\tOPTIONS extends DMenuItemSpaceOptions<THEME> = DMenuItemSpaceOptions<THEME>\r\n> extends DLayoutSpace<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemSpace\";\r\n\t}\r\n\r\n\tstatic isCompatible<VALUE>( options: DMenuItemOptionsUnion<VALUE> ): options is DMenuItemSpaceOptions {\r\n\t\treturn \"space\" in options;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DMenuItemCheck } from \"../d-menu-item-check\";\r\nimport { DMenuItemLink } from \"../d-menu-item-link\";\r\nimport { DMenuItemMenu } from \"../d-menu-item-menu\";\r\nimport { DMenuItemOptionsUnion } from \"../d-menu-item-options-union\";\r\nimport { DMenuItemSeparator } from \"../d-menu-item-separator\";\r\nimport { DMenuItemSpace } from \"../d-menu-item-space\";\r\nimport { DMenuItemText } from \"../d-menu-item-text\";\r\nimport { DMenus } from \"../d-menus\";\r\n\r\nexport const loadMenuItem = () => {\r\n\tDMenus.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemCheck.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemCheck( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenus.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemLink.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemLink( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenus.addItemCreator(( options: DMenuItemOptionsUnion<any>, sticky: boolean ): DisplayObject | null => {\r\n\t\tif( DMenuItemMenu.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemMenu( DMenuItemMenu.toSubMenuOptions( options, sticky ) );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenus.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemSeparator.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemSeparator( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenus.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemSpace.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemSpace( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenus.setItemCreatorDefault(( options: any ): DisplayObject | null => {\r\n\t\treturn new DMenuItemText( options );\r\n\t});\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DBase, DBaseCornerOptions, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DCornerMask } from \"./d-corner-mask\";\r\nimport { DLayoutClearType } from \"./d-layout-clear-type\";\r\nimport { DLayoutDirection } from \"./d-layout-direction\";\r\nimport { DLayoutSpace, DLayoutSpaceOptions } from \"./d-layout-space\";\r\nimport { isNumber } from \"./util/is-number\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport interface DLayoutMargin {\r\n\thorizontal: number;\r\n\tvertical: number;\r\n}\r\n\r\nexport interface DLayoutMarginOptions {\r\n\thorizontal?: number;\r\n\tvertical?: number;\r\n}\r\n\r\nexport interface DLayoutCornerOptions extends DBaseCornerOptions {\r\n\tadjust?: boolean;\r\n}\r\n\r\nexport interface DLayoutOptions<THEME extends DThemeLayout> extends DBaseOptions<THEME> {\r\n\tmargin?: number | DLayoutMarginOptions;\r\n\tcorner?: number | DLayoutCornerOptions;\r\n\trow?: number;\r\n\tcolumn?: number;\r\n\tdirection?: (keyof typeof DLayoutDirection) | DLayoutDirection;\r\n\treverse?: boolean;\r\n}\r\n\r\nexport interface DThemeLayout extends DThemeBase {\r\n\tgetMargin(): number;\r\n\tgetDirection(): DLayoutDirection;\r\n\tgetCornerAdjust(): boolean;\r\n\tgetMultiplicity(): number;\r\n\tgetReverse(): boolean;\r\n}\r\n\r\nconst isVisible = ( child: DisplayObject ): child is DBase => {\r\n\treturn child instanceof DBase && (child.visible || child instanceof DLayoutSpace);\r\n};\r\n\r\nconst toMultiplicity = ( theme: DThemeLayout, options?: DLayoutOptions<DThemeLayout> ): number => {\r\n\tif( options ) {\r\n\t\tif( options.row != null ) {\r\n\t\t\treturn options.row;\r\n\t\t}\r\n\t\tif( options.column != null ) {\r\n\t\t\treturn options.column;\r\n\t\t}\r\n\t}\r\n\treturn theme.getMultiplicity();\r\n};\r\n\r\nconst toMargin = ( theme: DThemeLayout, options?: DLayoutOptions<DThemeLayout> ): DLayoutMargin => {\r\n\tif( options && options.margin != null ) {\r\n\t\tconst margin = options.margin;\r\n\t\tif( isNumber( margin ) ) {\r\n\t\t\treturn {\r\n\t\t\t\thorizontal: margin,\r\n\t\t\t\tvertical: margin\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconst themeMargin = theme.getMargin();\r\n\t\t\treturn {\r\n\t\t\t\thorizontal: ( margin.horizontal != null ? margin.horizontal : themeMargin ),\r\n\t\t\t\tvertical: ( margin.vertical != null ? margin.vertical : themeMargin )\r\n\t\t\t};\r\n\t\t}\r\n\t} else {\r\n\t\tconst themeMargin = theme.getMargin();\r\n\t\treturn {\r\n\t\t\thorizontal: themeMargin,\r\n\t\t\tvertical: themeMargin\r\n\t\t};\r\n\t}\r\n};\r\n\r\nconst toDirection = ( theme: DThemeLayout, options?: DLayoutOptions<DThemeLayout> ): DLayoutDirection => {\r\n\tif( options && options.direction != null ) {\r\n\t\tconst direction = options.direction;\r\n\t\tif( isString( direction ) ) {\r\n\t\t\treturn DLayoutDirection[ direction ];\r\n\t\t} else {\r\n\t\t\treturn direction;\r\n\t\t}\r\n\t}\r\n\treturn theme.getDirection();\r\n};\r\n\r\nconst toCornerAdjust = ( theme: DThemeLayout, options?: DLayoutOptions<DThemeLayout> ): boolean => {\r\n\tif( options && options.corner != null && ! isNumber( options.corner ) && options.corner.adjust != null ) {\r\n\t\treturn options.corner.adjust;\r\n\t}\r\n\treturn theme.getCornerAdjust();\r\n};\r\n\r\nconst toReverse = ( theme: DThemeLayout, options?: DLayoutOptions<DThemeLayout> ): boolean => {\r\n\tif( options && options.reverse != null ) {\r\n\t\treturn options.reverse;\r\n\t}\r\n\treturn theme.getReverse();\r\n};\r\n\r\nexport abstract class DLayout<\r\n\tTHEME extends DThemeLayout,\r\n\tOPTIONS extends DLayoutOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tstatic CORNER_ADJUST_WORK: Float32Array | null = null;\r\n\r\n\tprotected _margin!: DLayoutMargin;\r\n\tprotected _cornerAdjust!: boolean;\r\n\tprotected _multiplicity!: number;\r\n\tprotected _direction!: DLayoutDirection;\r\n\tprotected _reverse!: boolean;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t\tconst theme = this.theme;\r\n\t\tthis._margin = toMargin( theme, options );\r\n\t\tthis._direction = toDirection( theme, options );\r\n\t\tthis._cornerAdjust = toCornerAdjust( theme, options );\r\n\t\tthis._multiplicity = toMultiplicity( theme, options );\r\n\t\tthis._reverse = toReverse( theme, options );\r\n\t}\r\n\r\n\tprotected getWeightTotal() {\r\n\t\tconst children = this.children;\r\n\t\tlet result = 0;\r\n\t\tconst multiplicity = this._multiplicity;\r\n\t\tconst reverse = this._reverse;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ) {\r\n\t\t\tlet weight = -1;\r\n\t\t\tlet j = 0;\r\n\t\t\tfor( ; j < multiplicity && i + j < imax; ++j ) {\r\n\t\t\t\tconst child = children[ reverse ? imax - 1 - (i + j) : i + j ];\r\n\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\tconst clearType = child.getClearType();\r\n\t\t\t\t\tif( j !== 0 && (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tweight = Math.max( weight, child.weight );\r\n\t\t\t\t\t\tif( clearType && DLayoutClearType.AFTER ) {\r\n\t\t\t\t\t\t\tj += 1;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti += 1;\r\n\t\t\t\t\tj -= 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\ti += j;\r\n\t\t\tif( 0 <= weight ) {\r\n\t\t\t\tresult += weight;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getSpaceLeft( baseSize: number, margin: number ) {\r\n\t\tconst children = this.children;\r\n\t\tconst multiplicity = this._multiplicity;\r\n\t\tconst reverse = this._reverse;\r\n\t\tif( this._direction === DLayoutDirection.VERTICAL ) {\r\n\t\t\tlet result = baseSize;\r\n\t\t\tlet marginNext = 0;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ) {\r\n\t\t\t\tlet height = 0;\r\n\t\t\t\tlet weight = -1;\r\n\t\t\t\tlet j = 0;\r\n\t\t\t\tfor( ; j < multiplicity && i + j < imax; ++j ) {\r\n\t\t\t\t\tconst child = children[ reverse ? imax - 1 - (i + j) : i + j ];\r\n\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\t\t\t\t\t\tif( j !== 0 && (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tweight = Math.max( weight, child.weight );\r\n\t\t\t\t\t\t\tif( weight < 0 ) {\r\n\t\t\t\t\t\t\t\theight = Math.max( height, child.height + marginNext );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\theight = marginNext;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif( clearType & DLayoutClearType.AFTER ) {\r\n\t\t\t\t\t\t\t\tj += 1;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ti += 1;\r\n\t\t\t\t\t\tj -= 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ti += j;\r\n\t\t\t\tresult -= height;\r\n\t\t\t\tmarginNext = margin;\r\n\t\t\t}\r\n\t\t\treturn Math.max( 0, result );\r\n\t\t} else {\r\n\t\t\tlet result = baseSize;\r\n\t\t\tlet marginNext = 0;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ) {\r\n\t\t\t\tlet width = 0;\r\n\t\t\t\tlet weight = -1;\r\n\t\t\t\tlet j = 0;\r\n\t\t\t\tfor( ; j < multiplicity && i + j < imax; ++j ) {\r\n\t\t\t\t\tconst child = children[ reverse ? imax - 1 - (i + j) : i + j ];\r\n\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\t\t\t\t\t\tif( j !== 0 && (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tweight = Math.max( weight, child.weight );\r\n\t\t\t\t\t\t\tif( weight < 0 ) {\r\n\t\t\t\t\t\t\t\twidth = Math.max( width, child.width + marginNext );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\twidth = marginNext;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif( clearType & DLayoutClearType.AFTER ) {\r\n\t\t\t\t\t\t\t\tj += 1;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ti += 1;\r\n\t\t\t\t\t\tj -= 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ti += j;\r\n\t\t\t\tresult -= width;\r\n\t\t\t\tmarginNext = margin;\r\n\t\t\t}\r\n\t\t\treturn Math.max( 0, result );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onRefit(): void {\r\n\t\tconst children = this.children;\r\n\t\tconst padding = this._padding;\r\n\t\tconst paddingTop = padding.getTop();\r\n\t\tconst paddingBottom = padding.getBottom();\r\n\t\tconst paddingLeft = padding.getLeft();\r\n\t\tconst paddingRight = padding.getRight();\r\n\t\tconst margin = this._margin;\r\n\t\tconst marginVertical = margin.vertical;\r\n\t\tconst marginHorizontal = margin.horizontal;\r\n\t\tconst weightTotal = this.getWeightTotal();\r\n\t\tconst multiplicity = this._multiplicity;\r\n\t\tconst reverse = this._reverse;\r\n\r\n\t\tlet cornerAdjustWork = null;\r\n\t\tif( this._cornerAdjust ) {\r\n\t\t\tconst requiredSize = 4 + ( children.length << 1 );\r\n\t\t\tif( DLayout.CORNER_ADJUST_WORK == null || DLayout.CORNER_ADJUST_WORK.length < requiredSize ) {\r\n\t\t\t\tDLayout.CORNER_ADJUST_WORK = new Float32Array( requiredSize );\r\n\t\t\t}\r\n\t\t\tcornerAdjustWork = DLayout.CORNER_ADJUST_WORK;\r\n\t\t\tcornerAdjustWork[ 0 ] = -2;\r\n\t\t\tcornerAdjustWork[ 1 ] = -2;\r\n\t\t\tcornerAdjustWork[ requiredSize - 2 ] = -3;\r\n\t\t\tcornerAdjustWork[ requiredSize - 1 ] = -3;\r\n\t\t}\r\n\r\n\t\tif( this._direction === DLayoutDirection.VERTICAL ) {\r\n\t\t\tlet irow = 0;\r\n\t\t\tlet y = paddingTop - marginVertical;\r\n\t\t\tif( 0 < weightTotal ) {\r\n\t\t\t\tconst weightTotalInverse = 1 / weightTotal;\r\n\t\t\t\tconst baseSize = this.height - paddingTop - paddingBottom;\r\n\t\t\t\tconst spaceLeft = this.getSpaceLeft( baseSize, marginVertical );\r\n\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ) {\r\n\t\t\t\t\tlet x = paddingLeft - marginHorizontal;\r\n\t\t\t\t\tlet height = 0;\r\n\t\t\t\t\tlet j = 0;\r\n\t\t\t\t\tfor( ; j < multiplicity && i + j < imax; ++j ) {\r\n\t\t\t\t\t\tconst child = children[ reverse ? imax - 1 - (i + j) : i + j ];\r\n\t\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\t\t\t\t\t\t\tif( j !== 0 && (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tchild.position.set( marginHorizontal + x, marginVertical + y );\r\n\t\t\t\t\t\t\t\tconst weight = child.weight;\r\n\t\t\t\t\t\t\t\tif( 0 <= weight ) {\r\n\t\t\t\t\t\t\t\t\tchild.height = spaceLeft * ( weight * weightTotalInverse );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tx += marginHorizontal + child.width;\r\n\t\t\t\t\t\t\t\theight = Math.max( height, child.height );\r\n\t\t\t\t\t\t\t\tif( clearType & DLayoutClearType.AFTER ) {\r\n\t\t\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = j;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = irow;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tj += 1;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = j;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = irow;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = j - 1;\r\n\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = irow;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ti += 1;\r\n\t\t\t\t\t\t\tj -= 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ty += marginVertical + height;\r\n\t\t\t\t\ti += j;\r\n\t\t\t\t\tirow += 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst child = children[ reverse ? imax - 1 - i : i ];\r\n\t\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\t\tconst i1 = 2 + ( i << 1 );\r\n\t\t\t\t\t\t\tconst icolumn1 = cornerAdjustWork[ i1 + 0 ];\r\n\t\t\t\t\t\t\tconst irow1 = cornerAdjustWork[ i1 + 1 ];\r\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\r\n\t\t\t\t\t\t\tlet icolumn0 = -2;\r\n\t\t\t\t\t\t\tif( ! (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\t\tconst i0 = this.findRowIndexPrevious( i1, irow1, cornerAdjustWork );\r\n\t\t\t\t\t\t\t\tif( ! this.hasClearTypeAfter( children, i0 ) ) {\r\n\t\t\t\t\t\t\t\t\ticolumn0 = cornerAdjustWork[ i0 ];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet icolumn2 = -2;\r\n\t\t\t\t\t\t\tif( ! (clearType & DLayoutClearType.AFTER) ) {\r\n\t\t\t\t\t\t\t\tconst i2 = this.findRowIndexNext( i1, irow1, cornerAdjustWork );\r\n\t\t\t\t\t\t\t\tif( ! this.hasClearTypeBefore( children, i2 ) ) {\r\n\t\t\t\t\t\t\t\t\ticolumn2 = cornerAdjustWork[ i2 ];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst ncolumn = this.countColumn( i1, irow1, cornerAdjustWork );\r\n\t\t\t\t\t\t\tchild.corner.mask = this.toCornerMaskColumn( icolumn0, icolumn1, icolumn2, ncolumn );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ) {\r\n\t\t\t\t\tlet x = paddingLeft - marginHorizontal;\r\n\t\t\t\t\tlet height = 0;\r\n\t\t\t\t\tlet j = 0;\r\n\t\t\t\t\tfor( ; j < multiplicity && i + j < imax; ++j ) {\r\n\t\t\t\t\t\tconst child = children[ reverse ? imax - 1 - (i + j) : i + j ];\r\n\t\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\t\t\t\t\t\t\tif( j !== 0 && (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tchild.position.set( marginHorizontal + x, marginVertical + y );\r\n\t\t\t\t\t\t\t\tconst weight = child.weight;\r\n\t\t\t\t\t\t\t\tif( 0 <= weight ) {\r\n\t\t\t\t\t\t\t\t\tchild.height = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tx += marginHorizontal + child.width;\r\n\t\t\t\t\t\t\t\theight = Math.max( height, child.height );\r\n\t\t\t\t\t\t\t\tif( clearType & DLayoutClearType.AFTER ) {\r\n\t\t\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = j;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = irow;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tj += 1;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = j;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = irow;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = j - 1;\r\n\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = irow;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ti += 1;\r\n\t\t\t\t\t\t\tj -= 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\ty += marginVertical + height;\r\n\t\t\t\t\ti += j;\r\n\t\t\t\t\tirow += 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst child = children[ reverse ? imax - 1 - i : i ];\r\n\t\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\t\tconst i1 = 2 + ( i << 1 );\r\n\t\t\t\t\t\t\tconst icolumn1 = cornerAdjustWork[ i1 + 0 ];\r\n\t\t\t\t\t\t\tconst irow1 = cornerAdjustWork[ i1 + 1 ];\r\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\r\n\t\t\t\t\t\t\tlet icolumn0 = -2;\r\n\t\t\t\t\t\t\tif( ! (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\t\tconst i0 = this.findRowIndexPrevious( i1, irow1, cornerAdjustWork );\r\n\t\t\t\t\t\t\t\tif( ! this.hasClearTypeAfter( children, i0 ) ) {\r\n\t\t\t\t\t\t\t\t\ticolumn0 = cornerAdjustWork[ i0 ];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet icolumn2 = -2;\r\n\t\t\t\t\t\t\tif( ! (clearType & DLayoutClearType.AFTER) ) {\r\n\t\t\t\t\t\t\t\tconst i2 = this.findRowIndexNext( i1, irow1, cornerAdjustWork );\r\n\t\t\t\t\t\t\t\tif( ! this.hasClearTypeBefore( children, i2 ) ) {\r\n\t\t\t\t\t\t\t\t\ticolumn2 = cornerAdjustWork[ i2 ];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst ncolumn = this.countColumn( i1, irow1, cornerAdjustWork );\r\n\t\t\t\t\t\t\tchild.corner.mask = this.toCornerMaskColumn( icolumn0, icolumn1, icolumn2, ncolumn );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet icolumn = 0;\r\n\t\t\tlet x = paddingLeft - marginHorizontal;\r\n\t\t\tif( 0 < weightTotal ) {\r\n\t\t\t\tconst weightTotalInverse = 1 / weightTotal;\r\n\t\t\t\tconst baseSize = this.width - paddingLeft - paddingRight;\r\n\t\t\t\tconst spaceLeft = this.getSpaceLeft( baseSize, marginHorizontal );\r\n\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ) {\r\n\t\t\t\t\tlet y = paddingTop - marginVertical;\r\n\t\t\t\t\tlet width = 0;\r\n\t\t\t\t\tlet j = 0;\r\n\t\t\t\t\tfor( ; j < multiplicity && i + j < imax; ++j ) {\r\n\t\t\t\t\t\tconst child = children[ reverse ? imax - 1 - (i + j) : i + j ];\r\n\t\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\t\t\t\t\t\t\tif( j !== 0 && (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tchild.position.set( marginHorizontal + x, marginVertical + y );\r\n\t\t\t\t\t\t\t\tconst weight = child.weight;\r\n\t\t\t\t\t\t\t\tif( 0 <= weight ) {\r\n\t\t\t\t\t\t\t\t\tchild.width = spaceLeft * ( weight * weightTotalInverse );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\twidth = Math.max( width, child.width );\r\n\t\t\t\t\t\t\t\ty += marginVertical + child.height;\r\n\t\t\t\t\t\t\t\tif( clearType & DLayoutClearType.AFTER ) {\r\n\t\t\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = icolumn;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = j;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tj += 1;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = icolumn;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = j;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = icolumn;\r\n\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = j - 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ti += 1;\r\n\t\t\t\t\t\t\tj -= 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tx += marginHorizontal + width;\r\n\t\t\t\t\ti += j;\r\n\t\t\t\t\ticolumn += 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst child = children[ reverse ? imax - 1 - i : i ];\r\n\t\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\t\tconst i1 = 2 + ( i << 1 );\r\n\t\t\t\t\t\t\tconst icolumn1 = cornerAdjustWork[ i1 + 0 ];\r\n\t\t\t\t\t\t\tconst irow1 = cornerAdjustWork[ i1 + 1 ];\r\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\r\n\t\t\t\t\t\t\tlet irow0 = -2;\r\n\t\t\t\t\t\t\tif( ! (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\t\tconst i0 = this.findColumnIndexPrevious( i1, icolumn1, cornerAdjustWork );\r\n\t\t\t\t\t\t\t\tif( ! this.hasClearTypeAfter( children, i0 ) ) {\r\n\t\t\t\t\t\t\t\t\tirow0 = cornerAdjustWork[ i0 + 1 ];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet irow2 = -2;\r\n\t\t\t\t\t\t\tif( ! (clearType & DLayoutClearType.AFTER) ) {\r\n\t\t\t\t\t\t\t\tconst i2 = this.findColumnIndexNext( i1, icolumn1, cornerAdjustWork );\r\n\t\t\t\t\t\t\t\tif( ! this.hasClearTypeBefore( children, i2 ) ) {\r\n\t\t\t\t\t\t\t\t\tirow2 = cornerAdjustWork[ i2 + 1 ];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst nrow = this.countRow( i1, icolumn1, cornerAdjustWork );\r\n\t\t\t\t\t\t\tchild.corner.mask = this.toCornerMaskRow( irow0, irow1, irow2, nrow );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ) {\r\n\t\t\t\t\tlet y = paddingTop - marginVertical;\r\n\t\t\t\t\tlet width = 0;\r\n\t\t\t\t\tlet j = 0;\r\n\t\t\t\t\tfor( ; j < multiplicity && i + j < imax; ++j ) {\r\n\t\t\t\t\t\tconst child = children[ reverse ? imax - 1 - (i + j) : i + j ];\r\n\t\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\t\t\t\t\t\t\tif( j !== 0 && (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tchild.position.set( marginHorizontal + x, marginVertical + y );\r\n\t\t\t\t\t\t\t\tconst weight = child.weight;\r\n\t\t\t\t\t\t\t\tif( 0 <= weight ) {\r\n\t\t\t\t\t\t\t\t\tchild.width = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\twidth = Math.max( width, child.width );\r\n\t\t\t\t\t\t\t\ty += marginVertical + child.height;\r\n\t\t\t\t\t\t\t\tif( clearType & DLayoutClearType.AFTER ) {\r\n\t\t\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = icolumn;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = j;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tj += 1;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = icolumn;\r\n\t\t\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = j;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\t\t\t\tconst k = (i + j + 1) << 1;\r\n\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 0 ] = icolumn;\r\n\t\t\t\t\t\t\t\tcornerAdjustWork[ k + 1 ] = j - 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ti += 1;\r\n\t\t\t\t\t\t\tj -= 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tx += marginHorizontal + width;\r\n\t\t\t\t\ti += j;\r\n\t\t\t\t\ticolumn += 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( cornerAdjustWork != null ) {\r\n\t\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst child = children[ reverse ? imax - 1 - i : i ];\r\n\t\t\t\t\t\tif( isVisible( child ) ) {\r\n\t\t\t\t\t\t\tconst i1 = 2 + ( i << 1 );\r\n\t\t\t\t\t\t\tconst icolumn1 = cornerAdjustWork[ i1 + 0 ];\r\n\t\t\t\t\t\t\tconst irow1 = cornerAdjustWork[ i1 + 1 ];\r\n\t\t\t\t\t\t\tconst clearType = child.getClearType();\r\n\r\n\t\t\t\t\t\t\tlet irow0 = -2;\r\n\t\t\t\t\t\t\tif( ! (clearType & DLayoutClearType.BEFORE) ) {\r\n\t\t\t\t\t\t\t\tconst i0 = this.findColumnIndexPrevious( i1, icolumn1, cornerAdjustWork );\r\n\t\t\t\t\t\t\t\tif( ! this.hasClearTypeAfter( children, i0 ) ) {\r\n\t\t\t\t\t\t\t\t\tirow0 = cornerAdjustWork[ i0 + 1 ];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tlet irow2 = -2;\r\n\t\t\t\t\t\t\tif( ! (clearType & DLayoutClearType.AFTER) ) {\r\n\t\t\t\t\t\t\t\tconst i2 = this.findColumnIndexNext( i1, icolumn1, cornerAdjustWork );\r\n\t\t\t\t\t\t\t\tif( ! this.hasClearTypeBefore( children, i2 ) ) {\r\n\t\t\t\t\t\t\t\t\tirow2 = cornerAdjustWork[ i2 + 1 ];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst nrow = this.countRow( i1, icolumn1, cornerAdjustWork );\r\n\t\t\t\t\t\t\tchild.corner.mask = this.toCornerMaskRow( irow0, irow1, irow2, nrow );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.onRefit();\r\n\t}\r\n\r\n\tprotected hasClearTypeBefore( children: DisplayObject[], index: number ): boolean {\r\n\t\treturn this.hasClearType( children, index, DLayoutClearType.BEFORE );\r\n\t}\r\n\r\n\tprotected hasClearTypeAfter( children: DisplayObject[], index: number ): boolean {\r\n\t\treturn this.hasClearType( children, index, DLayoutClearType.AFTER );\r\n\t}\r\n\r\n\tprotected hasClearType( children: DisplayObject[], index: number, clearType: DLayoutClearType ): boolean {\r\n\t\tif( 2 <= index ) {\r\n\t\t\tconst i = (index - 2) >> 1;\r\n\t\t\tif( 0 <= i && i < children.length ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\t\treturn !!( child.getClearType() & clearType );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected findColumnIndexPrevious( istart: number, icolumn: number, cornerAdjustWork: Float32Array ): number {\r\n\t\tfor( let i = istart - 2; 0 <= i; i -= 2 ) {\r\n\t\t\tif( cornerAdjustWork[ i ] !== icolumn ) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tprotected findColumnIndexNext( istart: number, icolumn: number, cornerAdjustWork: Float32Array ): number {\r\n\t\tfor( let i = istart + 2, imax = cornerAdjustWork.length; i < imax; i += 2 ) {\r\n\t\t\tconst icolumn2 = cornerAdjustWork[ i ];\r\n\t\t\tif( icolumn2 !== icolumn ) {\r\n\t\t\t\tfor( let j = i + 2; j < imax; j += 2 ) {\r\n\t\t\t\t\tif( cornerAdjustWork[ j ] !== icolumn2 ) {\r\n\t\t\t\t\t\treturn j - 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn cornerAdjustWork.length - 2;\r\n\t}\r\n\r\n\tprotected countRow( istart: number, icolumn: number, cornerAdjustWork: Float32Array ): number {\r\n\t\tfor( let i = istart + 2, imax = cornerAdjustWork.length; i < imax; i += 2 ) {\r\n\t\t\tconst icolumn2 = cornerAdjustWork[ i ];\r\n\t\t\tif( icolumn2 !== icolumn ) {\r\n\t\t\t\treturn cornerAdjustWork[ i - 2 + 1 ] + 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tprotected findRowIndexPrevious( istart: number, irow: number, cornerAdjustWork: Float32Array ): number {\r\n\t\tfor( let i = istart - 2; 0 <= i; i -= 2 ) {\r\n\t\t\tif( cornerAdjustWork[ i + 1 ] !== irow ) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tprotected findRowIndexNext( istart: number, irow: number, cornerAdjustWork: Float32Array ): number {\r\n\t\tfor( let i = istart + 2, imax = cornerAdjustWork.length; i < imax; i += 2 ) {\r\n\t\t\tconst irow2 = cornerAdjustWork[ i + 1 ];\r\n\t\t\tif( irow2 !== irow ) {\r\n\t\t\t\tfor( let j = i + 2; j < imax; j += 2 ) {\r\n\t\t\t\t\tif( cornerAdjustWork[ j + 1 ] !== irow2 ) {\r\n\t\t\t\t\t\treturn j - 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn cornerAdjustWork.length - 2;\r\n\t}\r\n\r\n\tprotected countColumn( istart: number, irow: number, cornerAdjustWork: Float32Array ): number {\r\n\t\tfor( let i = istart + 2, imax = cornerAdjustWork.length; i < imax; i += 2 ) {\r\n\t\t\tconst irow2 = cornerAdjustWork[ i + 1 ];\r\n\t\t\tif( irow2 !== irow ) {\r\n\t\t\t\treturn cornerAdjustWork[ i - 2 + 0 ] + 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tprotected toCornerMaskColumn( i0: number, i1: number, i2: number, n: number ): DCornerMask {\r\n\t\tlet result = DCornerMask.NONE;\r\n\t\tif( i0 + 1 < i1 && i1 === 0 ) {\r\n\t\t\tresult |= DCornerMask.TOP_LEFT;\r\n\t\t}\r\n\t\tif( i2 + 1 < i1 && i1 === 0 ) {\r\n\t\t\tresult |= DCornerMask.BOTTOM_LEFT;\r\n\t\t}\r\n\t\tif( i0 < i1 && i1 + 1 === n ) {\r\n\t\t\tresult |= DCornerMask.TOP_RIGHT;\r\n\t\t}\r\n\t\tif( i2 < i1 && i1 + 1 === n ) {\r\n\t\t\tresult |= DCornerMask.BOTTOM_RIGHT;\r\n\t\t}\r\n\t\treturn DCornerMask.ALL & (~result);\r\n\t}\r\n\r\n\tprotected toCornerMaskRow( i0: number, i1: number, i2: number, n: number ): DCornerMask {\r\n\t\tlet result = DCornerMask.NONE;\r\n\t\tif( i0 + 1 < i1 && i1 === 0 ) {\r\n\t\t\tresult |= DCornerMask.TOP_LEFT;\r\n\t\t}\r\n\t\tif( i2 + 1 < i1 && i1 === 0 ) {\r\n\t\t\tresult |= DCornerMask.TOP_RIGHT;\r\n\t\t}\r\n\t\tif( i0 < i1 && i1 + 1 === n ) {\r\n\t\t\tresult |= DCornerMask.BOTTOM_LEFT;\r\n\t\t}\r\n\t\tif( i2 < i1 && i1 + 1 === n ) {\r\n\t\t\tresult |= DCornerMask.BOTTOM_RIGHT;\r\n\t\t}\r\n\t\treturn DCornerMask.ALL & (~result);\r\n\t}\r\n\r\n\taddSpace( options?: DLayoutSpaceOptions ) {\r\n\t\treturn this.addChild( new DLayoutSpace( options ) );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DLayout\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedSnapTargetValue } from \"../d-diagram-serialized\";\r\n\r\nexport enum ESnapperTargetValueType {\r\n\tHORIZONTAL = 0,\r\n\tVERTICAL = 1\r\n}\r\n\r\nexport class ESnapperTargetValue {\r\n\ttype: ESnapperTargetValueType;\r\n\tposition: number;\r\n\r\n\tconstructor( type: ESnapperTargetValueType, position: number ) {\r\n\t\tthis.type = type;\r\n\t\tthis.position = position;\r\n\t}\r\n\r\n\tserialize(): DDiagramSerializedSnapTargetValue {\r\n\t\treturn [ this.type, this.position ];\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DLayout, DLayoutOptions, DThemeLayout } from \"./d-layout\";\r\n\r\nexport interface DLayoutVerticalOptions<THEME extends DThemeLayoutVertical> extends DLayoutOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeLayoutVertical extends DThemeLayout {\r\n\r\n}\r\n\r\nexport class DLayoutVertical<\r\n\tTHEME extends DThemeLayoutVertical = DThemeLayoutVertical,\r\n\tOPTIONS extends DLayoutVerticalOptions<THEME> = DLayoutVerticalOptions<THEME>\r\n> extends DLayout<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DLayoutVertical\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DLayoutVertical, DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\r\n\r\nexport interface DMenuItemExpandableBodyOptions<\r\n\tTHEME extends DThemeMenuItemExpandableBody = DThemeMenuItemExpandableBody\r\n> extends DLayoutVerticalOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeMenuItemExpandableBody extends DThemeLayoutVertical {\r\n\r\n}\r\n\r\nexport class DMenuItemExpandableBody<\r\n\tTHEME extends DThemeMenuItemExpandableBody = DThemeMenuItemExpandableBody,\r\n\tOPTIONS extends DMenuItemExpandableBodyOptions<THEME> = DMenuItemExpandableBodyOptions<THEME>\r\n> extends DLayoutVertical<THEME, OPTIONS> {\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemExpandableBody\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DListItem, DListItemOptions, DListItemSelection, DThemeListItem } from \"./d-list-item\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DMenuItemExpandableHeaderOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemExpandableHeader = DThemeMenuItemExpandableHeader\r\n> extends DListItemOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeMenuItemExpandableHeader extends DThemeListItem {\r\n\r\n}\r\n\r\nexport class DMenuItemExpandableHeader<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemExpandableHeader = DThemeMenuItemExpandableHeader,\r\n\tOPTIONS extends DMenuItemExpandableHeaderOptions<VALUE, THEME> = DMenuItemExpandableHeaderOptions<VALUE, THEME>\r\n> extends DListItem<VALUE, THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.on( UtilPointerEvent.down, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( this.isActionable() ) {\r\n\t\t\t\tthis.onSelect( e );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected getSelection(): DListItemSelection | null {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemExpandableHeader\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, DisplayObject } from \"pixi.js\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\nimport { DMenuItemCreator, DMenus } from \"./d-menus\";\r\n\r\nexport class DMenuItemExpandables {\r\n\tprotected static CREATORS: DMenuItemCreator[] = [];\r\n\tprotected static CREATOR_DEFAULT: DMenuItemCreator | null = null;\r\n\r\n\tstatic addItemCreator( creator: DMenuItemCreator ): void {\r\n\t\tthis.CREATORS.push( creator );\r\n\t}\r\n\r\n\tstatic setItemCreatorDefault( creator: DMenuItemCreator ): void {\r\n\t\tthis.CREATOR_DEFAULT = creator;\r\n\t}\r\n\r\n\tstatic newItem<VALUE>( options: DMenuItemOptionsUnion<VALUE>, sticky: boolean ): DisplayObject | null {\r\n\t\treturn DMenus.newItemOf( this.CREATORS, this.CREATOR_DEFAULT, options, sticky ) ||\r\n\t\t\tDMenus.newItem( options, sticky );\r\n\t}\r\n\r\n\tstatic newItems<VALUE>(\r\n\t\tparent: Container,\r\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>,\r\n\t\tsticky: boolean\r\n\t): void {\r\n\t\tDMenus.newItemsOf( this, parent, items, sticky );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, DisplayObject } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DBaseStates } from \"./d-base-states\";\r\nimport { DLayoutVertical, DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DMenuItemExpandableBody, DMenuItemExpandableBodyOptions } from \"./d-menu-item-expandable-body\";\r\nimport { DMenuItemExpandableHeader, DMenuItemExpandableHeaderOptions } from \"./d-menu-item-expandable-header\";\r\nimport { DMenuItemExpandables } from \"./d-menu-item-expandables\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\n\r\nexport interface DMenuItemExpandableOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemExpandable = DThemeMenuItemExpandable,\r\n> extends DLayoutVerticalOptions<THEME> {\r\n\theader: DisplayObject | DMenuItemExpandableHeaderOptions<VALUE>;\r\n\tbody?: Container | DMenuItemExpandableBodyOptions;\r\n\titems?: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>;\r\n\tsticky?: boolean;\r\n}\r\n\r\nexport interface DThemeMenuItemExpandable extends DThemeLayoutVertical {\r\n\r\n}\r\n\r\nexport class DMenuItemExpandable<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemExpandable = DThemeMenuItemExpandable,\r\n\tOPTIONS extends DMenuItemExpandableOptions<VALUE, THEME> = DMenuItemExpandableOptions<VALUE, THEME>\r\n> extends DLayoutVertical<THEME, OPTIONS> {\r\n\tprotected _header!: DisplayObject;\r\n\tprotected _body!: DisplayObject;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\t// Header\r\n\t\tconst theme = this.theme;\r\n\t\tconst header = this.toHeader( theme, options );\r\n\t\tthis._header = header;\r\n\t\theader.on( \"select\", (): void => {\r\n\t\t\tthis.toggle();\r\n\t\t});\r\n\t\tthis.addChild( header );\r\n\r\n\t\t// Body\r\n\t\tconst body = this.toBody( theme, options );\r\n\t\tthis._body = body;\r\n\t\tconst sticky = ( options && options.sticky != null ? options.sticky : false );\r\n\t\tthis.newItems( body, sticky, theme, options );\r\n\t\tthis.addChild( body );\r\n\r\n\t\t//\r\n\t\tif( this.isActive() ) {\r\n\t\t\tthis.onActivated();\r\n\t\t} else {\r\n\t\t\tthis.onDeactivated();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newItems( body: Container, sticky: boolean, theme: THEME, options: OPTIONS | undefined ): void {\r\n\t\tif( options != null && options.items != null ) {\r\n\t\t\tDMenuItemExpandables.newItems( body, options.items, sticky );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toHeader( theme: THEME, options?: OPTIONS ): DisplayObject {\r\n\t\tif( options ) {\r\n\t\t\tif( options.header instanceof DisplayObject ) {\r\n\t\t\t\treturn options.header;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.newHeader( theme, options.header );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.newHeader( theme );\r\n\t}\r\n\r\n\tprotected newHeader( theme: THEME, options?: DMenuItemExpandableHeaderOptions<VALUE> ): DisplayObject {\r\n\t\treturn new DMenuItemExpandableHeader<VALUE>( options );\r\n\t}\r\n\r\n\tprotected toBody( theme: THEME,  options?: OPTIONS ): Container {\r\n\t\tif( options && options.body ) {\r\n\t\t\tif( options.body instanceof DisplayObject ) {\r\n\t\t\t\treturn options.body;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.newBody( theme, options.body );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.newBody( theme );\r\n\t}\r\n\r\n\tprotected newBody( theme: THEME, options?: DMenuItemExpandableBodyOptions ): Container {\r\n\t\treturn new DMenuItemExpandableBody( options );\r\n\t}\r\n\r\n\topen(): void {\r\n\t\tthis.setActive( true );\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tthis.setActive( false );\r\n\t}\r\n\r\n\ttoggle(): void {\r\n\t\tthis.setActive( ! this.isActive() );\r\n\t}\r\n\r\n\tprotected onActivated(): void {\r\n\t\tconst body = this._body;\r\n\t\tif( body instanceof DBase ) {\r\n\t\t\tbody.show();\r\n\t\t} else {\r\n\t\t\tbody.visible = true;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onDeactivated(): void {\r\n\t\tconst body = this._body;\r\n\t\tif( body instanceof DBase ) {\r\n\t\t\tbody.hide();\r\n\t\t} else {\r\n\t\t\tbody.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onStateChange( newState: DBaseState, oldState: DBaseState ): void {\r\n\t\tsuper.onStateChange( newState, oldState );\r\n\r\n\t\tif( DBaseStates.isActive( newState ) ) {\r\n\t\t\tif( ! DBaseStates.isActive( oldState ) ) {\r\n\t\t\t\tthis.onActivated();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( DBaseStates.isActive( oldState ) ) {\r\n\t\t\t\tthis.onDeactivated();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemExpandable\";\r\n\t}\r\n\r\n\tstatic isCompatible<VALUE>( options: DMenuItemOptionsUnion<VALUE> ): options is DMenuItemExpandableOptions<VALUE> {\r\n\t\treturn \"header\" in options;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemCheck, DMenuItemCheckOptions, DThemeMenuItemCheck } from \"./d-menu-item-check\";\r\n\r\nexport class DMenuItemExpandableItemCheck<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck,\r\n\tOPTIONS extends DMenuItemCheckOptions<VALUE, THEME> = DMenuItemCheckOptions<VALUE, THEME>\r\n> extends DMenuItemCheck<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemExpandableItemCheck\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemLink, DMenuItemLinkOptions, DThemeMenuItemLink } from \"./d-menu-item-link\";\r\n\r\nexport class DMenuItemExpandableItemLink<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink,\r\n\tOPTIONS extends DMenuItemLinkOptions<VALUE, THEME> = DMenuItemLinkOptions<VALUE, THEME>\r\n> extends DMenuItemLink<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemExpandableItemLink\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemSeparator, DMenuItemSeparatorOptions, DThemeMenuItemSeparator } from \"./d-menu-item-separator\";\r\n\r\nexport class DMenuItemExpandableItemSeparator<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator,\r\n\tOPTIONS extends DMenuItemSeparatorOptions<VALUE, THEME> = DMenuItemSeparatorOptions<VALUE, THEME>\r\n> extends DMenuItemSeparator<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemExpandableItemSeparator\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemSpace, DMenuItemSpaceOptions, DThemeMenuItemSpace } from \"./d-menu-item-space\";\r\n\r\nexport class DMenuItemExpandableItemSpace<\r\n\tTHEME extends DThemeMenuItemSpace = DThemeMenuItemSpace,\r\n\tOPTIONS extends DMenuItemSpaceOptions<THEME> = DMenuItemSpaceOptions<THEME>\r\n> extends DMenuItemSpace<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemExpandableItemSpace\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemText, DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\r\n\r\nexport class DMenuItemExpandableItemText<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText,\r\n\tOPTIONS extends DMenuItemTextOptions<VALUE, THEME> = DMenuItemTextOptions<VALUE, THEME>\r\n> extends DMenuItemText<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemExpandableItemText\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DMenuItemCheck } from \"../d-menu-item-check\";\r\nimport { DMenuItemExpandable } from \"../d-menu-item-expandable\";\r\nimport { DMenuItemExpandableItemCheck } from \"../d-menu-item-expandable-item-check\";\r\nimport { DMenuItemExpandableItemLink } from \"../d-menu-item-expandable-item-link\";\r\nimport { DMenuItemExpandableItemSeparator } from \"../d-menu-item-expandable-item-separator\";\r\nimport { DMenuItemExpandableItemSpace } from \"../d-menu-item-expandable-item-space\";\r\nimport { DMenuItemExpandableItemText } from \"../d-menu-item-expandable-item-text\";\r\nimport { DMenuItemExpandables } from \"../d-menu-item-expandables\";\r\nimport { DMenuItemLink } from \"../d-menu-item-link\";\r\nimport { DMenuItemOptionsUnion } from \"../d-menu-item-options-union\";\r\nimport { DMenuItemSeparator } from \"../d-menu-item-separator\";\r\nimport { DMenuItemSpace } from \"../d-menu-item-space\";\r\nimport { DMenus } from \"../d-menus\";\r\n\r\nexport const loadMenuItemExpandable = () => {\r\n\tDMenus.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemExpandable.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemExpandable( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuItemExpandables.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemCheck.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemExpandableItemCheck( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuItemExpandables.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemLink.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemExpandableItemLink( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuItemExpandables.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemSeparator.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemExpandableItemSeparator( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuItemExpandables.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemSpace.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuItemExpandableItemSpace( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuItemExpandables.setItemCreatorDefault(( options: any ): DisplayObject | null => {\r\n\t\treturn new DMenuItemExpandableItemText( options );\r\n\t});\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemCheck, DMenuItemCheckOptions, DThemeMenuItemCheck } from \"./d-menu-item-check\";\r\n\r\nexport class DMenuSidedItemCheck<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck,\r\n\tOPTIONS extends DMenuItemCheckOptions<VALUE, THEME> = DMenuItemCheckOptions<VALUE, THEME>\r\n> extends DMenuItemCheck<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemCheck\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DListItemSelection } from \"./d-list-item\";\r\nimport { DMenuItemLink, DMenuItemLinkOptions, DThemeMenuItemLink } from \"./d-menu-item-link\";\r\n\r\nexport class DMenuSidedItemLink<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink,\r\n\tOPTIONS extends DMenuItemLinkOptions<VALUE, THEME> = DMenuItemLinkOptions<VALUE, THEME>\r\n> extends DMenuItemLink<VALUE, THEME, OPTIONS> {\r\n\tprotected getSelection(): DListItemSelection | null {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemLink\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenu } from \"./d-menu\";\r\nimport { Closeable } from \"./d-menu-context\";\r\nimport { DMenuItem } from \"./d-menu-item\";\r\nimport { DMenuItemMenu, DMenuItemMenuOptions, DThemeMenuItemMenu } from \"./d-menu-item-menu\";\r\n\r\nexport class DMenuSidedItemMenu<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu,\r\n\tOPTIONS extends DMenuItemMenuOptions<VALUE, THEME> = DMenuItemMenuOptions<VALUE, THEME>\r\n> extends DMenuItemMenu<VALUE, THEME, OPTIONS> {\r\n\tprotected initHover( options: OPTIONS ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected onMenuSelect( value: VALUE, item: DMenuItem<VALUE>, closeable: Closeable ): void {\r\n\t\tsuper.onMenuSelect( value, item, closeable );\r\n\t\tconst selection = this.getSelection();\r\n\t\tif( selection ) {\r\n\t\t\tselection.add( item );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onOpen( menu: DMenu<VALUE> ): void {\r\n\t\tmenu.open( this, this );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemMenu\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemSeparator, DMenuItemSeparatorOptions, DThemeMenuItemSeparator } from \"./d-menu-item-separator\";\r\n\r\nexport class DMenuSidedItemSeparator<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator,\r\n\tOPTIONS extends DMenuItemSeparatorOptions<VALUE, THEME> = DMenuItemSeparatorOptions<VALUE, THEME>\r\n> extends DMenuItemSeparator<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemSeparator\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemSpace, DMenuItemSpaceOptions, DThemeMenuItemSpace } from \"./d-menu-item-space\";\r\n\r\nexport class DMenuSidedItemSpace<\r\n\tTHEME extends DThemeMenuItemSpace = DThemeMenuItemSpace,\r\n\tOPTIONS extends DMenuItemSpaceOptions<THEME> = DMenuItemSpaceOptions<THEME>\r\n> extends DMenuItemSpace<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemSpace\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemText, DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\r\n\r\nexport class DMenuSidedItemText<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText,\r\n\tOPTIONS extends DMenuItemTextOptions<VALUE, THEME> = DMenuItemTextOptions<VALUE, THEME>\r\n> extends DMenuItemText<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemText\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, DisplayObject } from \"pixi.js\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\nimport { DMenuItemCreator, DMenus } from \"./d-menus\";\r\n\r\nexport class DMenuSideds {\r\n\tprotected static CREATORS: DMenuItemCreator[] = [];\r\n\tprotected static CREATOR_DEFAULT: DMenuItemCreator | null = null;\r\n\r\n\tstatic addItemCreator( creator: DMenuItemCreator ): void {\r\n\t\tthis.CREATORS.push( creator );\r\n\t}\r\n\r\n\tstatic setItemCreatorDefault( creator: DMenuItemCreator ): void {\r\n\t\tthis.CREATOR_DEFAULT = creator;\r\n\t}\r\n\r\n\tstatic newItem<VALUE>( options: DMenuItemOptionsUnion<VALUE>, sticky: boolean ): DisplayObject | null {\r\n\t\treturn DMenus.newItemOf( this.CREATORS, this.CREATOR_DEFAULT, options, sticky ) ||\r\n\t\t\tDMenus.newItem( options, sticky );\r\n\t}\r\n\r\n\tstatic newItems<VALUE>(\r\n\t\tparent: Container,\r\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>,\r\n\t\tsticky: boolean\r\n\t): void {\r\n\t\tDMenus.newItemsOf( this, parent, items, sticky );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DMenuItemCheck } from \"../d-menu-item-check\";\r\nimport { DMenuItemLink } from \"../d-menu-item-link\";\r\nimport { DMenuItemMenu } from \"../d-menu-item-menu\";\r\nimport { DMenuItemOptionsUnion } from \"../d-menu-item-options-union\";\r\nimport { DMenuItemSeparator } from \"../d-menu-item-separator\";\r\nimport { DMenuItemSpace } from \"../d-menu-item-space\";\r\nimport { DMenuSidedItemCheck } from \"../d-menu-sided-item-check\";\r\nimport { DMenuSidedItemLink } from \"../d-menu-sided-item-link\";\r\nimport { DMenuSidedItemMenu } from \"../d-menu-sided-item-menu\";\r\nimport { DMenuSidedItemSeparator } from \"../d-menu-sided-item-separator\";\r\nimport { DMenuSidedItemSpace } from \"../d-menu-sided-item-space\";\r\nimport { DMenuSidedItemText } from \"../d-menu-sided-item-text\";\r\nimport { DMenuSideds } from \"../d-menu-sideds\";\r\n\r\nexport const loadMenuSidedItem = () => {\r\n\tDMenuSideds.setItemCreatorDefault(( options: any ): DisplayObject | null => {\r\n\t\treturn new DMenuSidedItemText( options );\r\n\t});\r\n\r\n\tDMenuSideds.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemSpace.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemSpace( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSideds.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemSeparator.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemSeparator( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSideds.addItemCreator(( options: DMenuItemOptionsUnion<any>, sticky: boolean ): DisplayObject | null => {\r\n\t\tif( DMenuItemMenu.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemMenu( DMenuItemMenu.toSubMenuOptions( options, sticky ) );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSideds.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemLink.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemLink( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSideds.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemCheck.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemCheck( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, DisplayObject } from \"pixi.js\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\nimport { DMenuSideds } from \"./d-menu-sideds\";\r\nimport { DMenuItemCreator, DMenus } from \"./d-menus\";\r\n\r\nexport class DMenuSidedItemExpandables {\r\n\tprotected static CREATORS: DMenuItemCreator[] = [];\r\n\tprotected static CREATOR_DEFAULT: DMenuItemCreator | null = null;\r\n\r\n\tstatic addItemCreator( creator: DMenuItemCreator ): void {\r\n\t\tthis.CREATORS.push( creator );\r\n\t}\r\n\r\n\tstatic setItemCreatorDefault( creator: DMenuItemCreator ): void {\r\n\t\tthis.CREATOR_DEFAULT = creator;\r\n\t}\r\n\r\n\tstatic newItem<VALUE>( options: DMenuItemOptionsUnion<VALUE>, sticky: boolean ): DisplayObject | null {\r\n\t\treturn DMenus.newItemOf( this.CREATORS, this.CREATOR_DEFAULT, options, sticky ) ||\r\n\t\t\tDMenuSideds.newItem( options, sticky );\r\n\t}\r\n\r\n\tstatic newItems<VALUE>(\r\n\t\tparent: Container,\r\n\t\titems: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>,\r\n\t\tsticky: boolean\r\n\t): void {\r\n\t\tDMenus.newItemsOf( this, parent, items, sticky );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container } from \"pixi.js\";\r\nimport { DMenuItemExpandable, DMenuItemExpandableOptions, DThemeMenuItemExpandable } from \"./d-menu-item-expandable\";\r\nimport { DMenuSidedItemExpandables } from \"./d-menu-sided-item-expandables\";\r\n\r\nexport class DMenuSidedItemExpandable<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemExpandable = DThemeMenuItemExpandable,\r\n\tOPTIONS extends DMenuItemExpandableOptions<VALUE, THEME> = DMenuItemExpandableOptions<VALUE, THEME>\r\n> extends DMenuItemExpandable<VALUE, THEME, OPTIONS> {\r\n\tprotected newItems( body: Container, sticky: boolean, theme: THEME, options: OPTIONS | undefined ): void {\r\n\t\tif( options != null && options.items != null ) {\r\n\t\t\tDMenuSidedItemExpandables.newItems( body, options.items, sticky );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemExpandable\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemCheckOptions, DThemeMenuItemCheck } from \"./d-menu-item-check\";\r\nimport { DMenuItemExpandableItemCheck } from \"./d-menu-item-expandable-item-check\";\r\n\r\nexport class DMenuSidedItemExpandableItemCheck<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemCheck = DThemeMenuItemCheck,\r\n\tOPTIONS extends DMenuItemCheckOptions<VALUE, THEME> = DMenuItemCheckOptions<VALUE, THEME>\r\n> extends DMenuItemExpandableItemCheck<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemExpandableItemCheck\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemLink, DMenuItemLinkOptions, DThemeMenuItemLink } from \"./d-menu-item-link\";\r\n\r\nexport class DMenuSidedItemExpandableItemLink<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemLink = DThemeMenuItemLink,\r\n\tOPTIONS extends DMenuItemLinkOptions<VALUE, THEME> = DMenuItemLinkOptions<VALUE, THEME>\r\n> extends DMenuItemLink<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemExpandableItemLink\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemMenu, DMenuItemMenuOptions, DThemeMenuItemMenu } from \"./d-menu-item-menu\";\r\n\r\nexport class DMenuItemExpandableItemMenu<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu,\r\n\tOPTIONS extends DMenuItemMenuOptions<VALUE, THEME> = DMenuItemMenuOptions<VALUE, THEME>\r\n> extends DMenuItemMenu<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuItemExpandableItemMenu\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenu } from \"./d-menu\";\r\nimport { DMenuItemExpandableItemMenu } from \"./d-menu-item-expandable-item-menu\";\r\nimport { DMenuItemMenuOptions, DThemeMenuItemMenu } from \"./d-menu-item-menu\";\r\n\r\nexport class DMenuSidedItemExpandableItemMenu<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemMenu = DThemeMenuItemMenu,\r\n\tOPTIONS extends DMenuItemMenuOptions<VALUE, THEME> = DMenuItemMenuOptions<VALUE, THEME>\r\n> extends DMenuItemExpandableItemMenu<VALUE, THEME, OPTIONS> {\r\n\tprotected onOpen( menu: DMenu<VALUE> ): void {\r\n\t\tmenu.open( this, this );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemExpandableItemMenu\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemExpandableItemSeparator } from \"./d-menu-item-expandable-item-separator\";\r\nimport { DMenuItemSeparatorOptions, DThemeMenuItemSeparator } from \"./d-menu-item-separator\";\r\n\r\nexport class DMenuSidedItemExpandableItemSeparator<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemSeparator = DThemeMenuItemSeparator,\r\n\tOPTIONS extends DMenuItemSeparatorOptions<VALUE, THEME> = DMenuItemSeparatorOptions<VALUE, THEME>\r\n> extends DMenuItemExpandableItemSeparator<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemSeparator\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemExpandableItemSpace } from \"./d-menu-item-expandable-item-space\";\r\nimport { DMenuItemSpaceOptions, DThemeMenuItemSpace } from \"./d-menu-item-space\";\r\n\r\nexport class DMenuSidedItemExpandableItemSpace<\r\n\tTHEME extends DThemeMenuItemSpace = DThemeMenuItemSpace,\r\n\tOPTIONS extends DMenuItemSpaceOptions<THEME> = DMenuItemSpaceOptions<THEME>\r\n> extends DMenuItemExpandableItemSpace<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemExpandableItemSpace\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMenuItemExpandableItemText } from \"./d-menu-item-expandable-item-text\";\r\nimport { DMenuItemTextOptions, DThemeMenuItemText } from \"./d-menu-item-text\";\r\n\r\nexport class DMenuSidedItemExpandableItemText<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuItemText = DThemeMenuItemText,\r\n\tOPTIONS extends DMenuItemTextOptions<VALUE, THEME> = DMenuItemTextOptions<VALUE, THEME>\r\n> extends DMenuItemExpandableItemText<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedItemExpandableItemText\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DMenuItemCheck } from \"../d-menu-item-check\";\r\nimport { DMenuItemExpandable } from \"../d-menu-item-expandable\";\r\nimport { DMenuItemLink } from \"../d-menu-item-link\";\r\nimport { DMenuItemMenu } from \"../d-menu-item-menu\";\r\nimport { DMenuItemOptionsUnion } from \"../d-menu-item-options-union\";\r\nimport { DMenuItemSeparator } from \"../d-menu-item-separator\";\r\nimport { DMenuItemSpace } from \"../d-menu-item-space\";\r\nimport { DMenuSidedItemExpandable } from \"../d-menu-sided-item-expandable\";\r\nimport { DMenuSidedItemExpandableItemCheck } from \"../d-menu-sided-item-expandable-item-check\";\r\nimport { DMenuSidedItemExpandableItemLink } from \"../d-menu-sided-item-expandable-item-link\";\r\nimport { DMenuSidedItemExpandableItemMenu } from \"../d-menu-sided-item-expandable-item-menu\";\r\nimport { DMenuSidedItemExpandableItemSeparator } from \"../d-menu-sided-item-expandable-item-separator\";\r\nimport { DMenuSidedItemExpandableItemSpace } from \"../d-menu-sided-item-expandable-item-space\";\r\nimport { DMenuSidedItemExpandableItemText } from \"../d-menu-sided-item-expandable-item-text\";\r\nimport { DMenuSidedItemExpandables } from \"../d-menu-sided-item-expandables\";\r\nimport { DMenuSideds } from \"../d-menu-sideds\";\r\n\r\nexport const loadMenuSidedItemExpandable = () => {\r\n\tDMenuSideds.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemExpandable.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemExpandable( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSidedItemExpandables.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemCheck.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemExpandableItemCheck( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSidedItemExpandables.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemLink.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemExpandableItemLink( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSidedItemExpandables.addItemCreator((\r\n\t\toptions: DMenuItemOptionsUnion<any>, sticky: boolean\r\n\t): DisplayObject | null => {\r\n\t\tif( DMenuItemMenu.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemExpandableItemMenu( DMenuItemMenu.toSubMenuOptions( options, sticky ) );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSidedItemExpandables.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemSeparator.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemExpandableItemSeparator( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSidedItemExpandables.addItemCreator(( options: DMenuItemOptionsUnion<any> ): DisplayObject | null => {\r\n\t\tif( DMenuItemSpace.isCompatible( options ) ) {\r\n\t\t\treturn new DMenuSidedItemExpandableItemSpace( options );\r\n\t\t}\r\n\t\treturn null;\r\n\t});\r\n\r\n\tDMenuSidedItemExpandables.setItemCreatorDefault(( options: any ): DisplayObject | null => {\r\n\t\treturn new DMenuSidedItemExpandableItemText( options );\r\n\t});\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { loadMenuItem } from \"./load-menu-item\";\r\nimport { loadMenuItemExpandable } from \"./load-menu-item-expandable\";\r\nimport { loadMenuSidedItem } from \"./load-menu-sided-item\";\r\nimport { loadMenuSidedItemExpandable } from \"./load-menu-sided-item-expandable\";\r\n\r\nexport const loadMenuItemAll = () => {\r\n\tloadMenuItem();\r\n\tloadMenuItemExpandable();\r\n\tloadMenuSidedItem();\r\n\tloadMenuSidedItemExpandable();\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { loadShapeAll } from \"../shape/load/load-shape-all\";\r\nimport { loadMenuItemAll } from \"./load-menu-item-all\";\r\n\r\nexport const loadAll = () => {\r\n\tloadMenuItemAll();\r\n\tloadShapeAll();\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DynamicSDFFontGenerator } from \"../../util/dynamic-sdf-font-generator\";\r\nimport { EShapeImageElements } from \"../e-shape-image-elements\";\r\nimport { EShapeImageSdf } from \"./e-shape-image-sdf\";\r\n\r\nexport const createImageSdf = ( dataUrl: string, convertToSdf: boolean ): Promise<EShapeImageSdf> => {\r\n\tif( convertToSdf ) {\r\n\t\treturn EShapeImageElements.toImageElement( dataUrl )\r\n\t\t.then(( imageElement: HTMLImageElement ): Promise<EShapeImageSdf> => {\r\n\t\t\tconst generator = DynamicSDFFontGenerator.getInstance().init();\r\n\t\t\tgenerator.updateTexture( imageElement );\r\n\t\t\tgenerator.render();\r\n\r\n\t\t\tconst canvas = document.createElement( \"canvas\" );\r\n\t\t\tgenerator.read( canvas );\r\n\r\n\t\t\treturn createImageSdf( canvas.toDataURL(), false );\r\n\t\t});\r\n\t} else {\r\n\t\treturn EShapeImageElements.toImageElement( dataUrl )\r\n\t\t.then(( imageElement: HTMLImageElement ): EShapeImageSdf => {\r\n\t\t\treturn new EShapeImageSdf( imageElement );\r\n\t\t});\r\n\t}\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeFill, EShapeFillLike } from \"../e-shape-fill\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\n\r\nexport class EShapeGroupFillViewer implements EShapeFill {\r\n\tconstructor() {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\treturn 0xffffff;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeFillLike> ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tset( enable: boolean, color: number, alpha: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tclone(): EShapeGroupFillViewer {\r\n\t\treturn new EShapeGroupFillViewer();\r\n\t}\r\n\r\n\ttoObject(): EShapeFillLike {\r\n\t\treturn {\r\n\t\t\tenable: true,\r\n\t\t\tcolor: 0xffffff,\r\n\t\t\talpha: 1.0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ) {\r\n\t\t//\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeStroke, EShapeStrokeLike } from \"../e-shape-stroke\";\r\nimport { EShapeStrokeSide } from \"../e-shape-stroke-side\";\r\n\r\nexport class EShapeGroupStrokeViewer implements EShapeStroke {\r\n\tconstructor() {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\treturn 0xffffff;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget align(): number {\r\n\t\treturn 0.0;\r\n\t}\r\n\r\n\tset align( width: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget side(): EShapeStrokeSide {\r\n\t\treturn EShapeStrokeSide.NONE;\r\n\t}\r\n\r\n\tset side( side: EShapeStrokeSide ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeStrokeLike> ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tset( enable?: boolean, color?: number, alpha?: number, width?: number, side?: EShapeStrokeSide ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tclone(): EShapeGroupStrokeViewer {\r\n\t\treturn new EShapeGroupStrokeViewer();\r\n\t}\r\n\r\n\ttoObject(): EShapeStrokeLike {\r\n\t\treturn {\r\n\t\t\tenable: false,\r\n\t\t\tcolor: 0xffffff,\r\n\t\t\talpha: 1.0,\r\n\t\t\twidth: 1.0,\r\n\t\t\talign: 0.0,\r\n\t\t\tside: EShapeStrokeSide.NONE\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t//\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextAlign, EShapeTextAlignLike } from \"../e-shape-text-align\";\r\nimport { EShapeTextAlignHorizontal } from \"../e-shape-text-align-horizontal\";\r\nimport { EShapeTextAlignVertical } from \"../e-shape-text-align-vertical\";\r\n\r\nexport class EShapeGroupTextAlignViewer implements EShapeTextAlign {\r\n\tconstructor() {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget horizontal(): EShapeTextAlignHorizontal {\r\n\t\treturn EShapeTextAlignHorizontal.CENTER;\r\n\t}\r\n\r\n\tset horizontal( horizontal: EShapeTextAlignHorizontal ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget vertical(): EShapeTextAlignVertical {\r\n\t\treturn EShapeTextAlignVertical.MIDDLE;\r\n\t}\r\n\r\n\tset vertical( vertical: EShapeTextAlignVertical ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextAlignLike> ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tset( horizontal?: EShapeTextAlignHorizontal, vertical?: EShapeTextAlignVertical ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\ttoObject(): EShapeTextAlignLike {\r\n\t\treturn {\r\n\t\t\thorizontal: EShapeTextAlignHorizontal.CENTER,\r\n\t\t\tvertical: EShapeTextAlignVertical.MIDDLE\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"../e-shape-text-offset\";\r\n\r\nexport class EShapeGroupTextOffsetViewer implements EShapeTextOffset {\r\n\tconstructor() {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget horizontal(): number {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset horizontal( horizontal: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget vertical(): number {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset vertical( vertical: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextOffsetLike> ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tset( horizontal?: number, vertical?: number ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOffsetLike {\r\n\t\treturn {\r\n\t\t\thorizontal: 0,\r\n\t\t\tvertical: 0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOutline, EShapeTextOutlineLike } from \"../e-shape-text-outline\";\r\n\r\nexport class EShapeGroupTextOutlineViewer implements EShapeTextOutline {\r\n\tconstructor() {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\treturn 0xffffff;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset width( width: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextOutlineLike> ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tset( enable?: boolean, color?: number, alpha?: number, width?: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tclone(): EShapeGroupTextOutlineViewer {\r\n\t\treturn new EShapeGroupTextOutlineViewer();\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOutlineLike {\r\n\t\treturn {\r\n\t\t\tenable: false,\r\n\t\t\tcolor: 0xffffff,\r\n\t\t\talpha: 1.0,\r\n\t\t\twidth: 1.0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t//\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"../e-shape-text-offset\";\r\n\r\nexport class EShapeGroupTextPaddingViewer implements EShapeTextOffset {\r\n\tconstructor() {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget horizontal(): number {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset horizontal( horizontal: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget vertical(): number {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset vertical( vertical: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextOffsetLike> ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tset( horizontal?: number, vertical?: number ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOffsetLike {\r\n\t\treturn {\r\n\t\t\thorizontal: 0,\r\n\t\t\tvertical: 0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeTextOffset, EShapeTextOffsetLike } from \"../e-shape-text-offset\";\r\n\r\nexport class EShapeGroupTextSpacingViewer implements EShapeTextOffset {\r\n\tconstructor() {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget horizontal(): number {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset horizontal( horizontal: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget vertical(): number {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset vertical( vertical: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopy( target?: Partial<EShapeTextOffsetLike> ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tset( horizontal?: number, vertical?: number ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\ttoObject(): EShapeTextOffsetLike {\r\n\t\treturn {\r\n\t\t\thorizontal: 0,\r\n\t\t\tvertical: 0\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DeepPartial } from \"../../util/deep-partial\";\r\nimport { EShapeResourceManagerDeserialization } from \"../e-shape-resource-manager-deserialization\";\r\nimport { EShapeResourceManagerSerialization } from \"../e-shape-resource-manager-serialization\";\r\nimport { EShapeText, EShapeTextLike, EShapeTextStyle, EShapeTextWeight } from \"../e-shape-text\";\r\nimport { EShapeTextDirection } from \"../e-shape-text-direction\";\r\nimport { EShapeGroupTextAlignViewer } from \"./e-shape-group-text-align-viewer\";\r\nimport { EShapeGroupTextOffsetViewer } from \"./e-shape-group-text-offset-viewer\";\r\nimport { EShapeGroupTextOutlineViewer } from \"./e-shape-group-text-outline-viewer\";\r\nimport { EShapeGroupTextPaddingViewer } from \"./e-shape-group-text-padding-viewer\";\r\nimport { EShapeGroupTextSpacingViewer } from \"./e-shape-group-text-spacing-viewer\";\r\n\r\nexport class EShapeGroupTextViewer implements EShapeText {\r\n\talign: EShapeGroupTextAlignViewer;\r\n\toffset: EShapeGroupTextOffsetViewer;\r\n\toutline: EShapeGroupTextOutlineViewer;\r\n\tspacing: EShapeGroupTextSpacingViewer;\r\n\tpadding: EShapeGroupTextPaddingViewer;\r\n\r\n\tconstructor() {\r\n\t\tthis.align = new EShapeGroupTextAlignViewer();\r\n\t\tthis.offset = new EShapeGroupTextOffsetViewer();\r\n\t\tthis.outline = new EShapeGroupTextOutlineViewer();\r\n\t\tthis.spacing = new EShapeGroupTextSpacingViewer();\r\n\t\tthis.padding = new EShapeGroupTextPaddingViewer();\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget value(): string {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tset value( value: string ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget color(): number {\r\n\t\treturn 0x000000;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget alpha(): number {\r\n\t\treturn 1.0;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget family(): string {\r\n\t\treturn \"auto\";\r\n\t}\r\n\r\n\tset family( family: string ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget size(): number {\r\n\t\treturn 24;\r\n\t}\r\n\r\n\tset size( size: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget weight(): EShapeTextWeight {\r\n\t\treturn EShapeTextWeight.NORMAL;\r\n\t}\r\n\r\n\tset weight( weight: EShapeTextWeight ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget style(): EShapeTextStyle {\r\n\t\treturn EShapeTextStyle.NORMAL;\r\n\t}\r\n\r\n\tset style( style: EShapeTextStyle ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget direction(): number {\r\n\t\treturn EShapeTextDirection.LEFT_TO_RIGHT;\r\n\t}\r\n\r\n\tset direction( direction: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget clipping(): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tset clipping( clipping: boolean ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tcopy( target?: DeepPartial<EShapeTextLike> ): this {\r\n\t\treturn this;\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue?: string, color?: number, alpha?: number,\r\n\t\tfamily?: string, size?: number, weight?: EShapeTextWeight,\r\n\t\tstyle?: EShapeTextStyle, direction?: EShapeTextDirection,\r\n\t\tclipping?: boolean\r\n\t): this {\r\n\t\treturn this;\r\n\t}\r\n\r\n\ttoObject(): EShapeTextLike {\r\n\t\treturn {\r\n\t\t\tvalue: \"\",\r\n\t\t\tcolor: 0x000000,\r\n\t\t\talpha: 1.0,\r\n\t\t\tfamily: \"auto\",\r\n\t\t\tsize: 24,\r\n\t\t\tweight: EShapeTextWeight.NORMAL,\r\n\t\t\talign: this.align.toObject(),\r\n\t\t\toffset: this.offset.toObject(),\r\n\t\t\tstyle: EShapeTextStyle.NORMAL,\r\n\t\t\toutline: this.outline.toObject(),\r\n\t\t\tspacing: this.spacing.toObject(),\r\n\t\t\tdirection: EShapeTextDirection.LEFT_TO_RIGHT,\r\n\t\t\tpadding: this.padding.toObject(),\r\n\t\t\tclipping: false\r\n\t\t};\r\n\t}\r\n\r\n\tserialize( manager: EShapeResourceManagerSerialization ): number {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tdeserialize( target: number, manager: EShapeResourceManagerDeserialization ): void {\r\n\t\t//\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\n\r\nexport class EShapeBufferUnit {\r\n\ttexture: Texture;\r\n\tindexOffset: number;\r\n\r\n\tconstructor( texture: Texture, indexOffset: number ) {\r\n\t\tthis.texture = texture;\r\n\t\tthis.indexOffset = indexOffset;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { BaseTexture, Texture } from \"pixi.js\";\r\nimport { EShapeBufferUnit } from \"./e-shape-buffer-unit\";\r\n\r\nexport class EShapeBufferUnitBuilder {\r\n\tindex: number;\r\n\tbaseTexture: BaseTexture | null;\r\n\tunits: EShapeBufferUnit[];\r\n\r\n\tconstructor() {\r\n\t\tthis.index = 0;\r\n\t\tthis.baseTexture = null;\r\n\t\tthis.units = [];\r\n\t}\r\n\r\n\tbegin(): void {\r\n\t\tthis.index = 0;\r\n\t\tthis.baseTexture = null;\r\n\t}\r\n\r\n\tpush( texture: Texture, indexOffset: number ): void {\r\n\t\tif( this.index < this.units.length ) {\r\n\t\t\tconst unit = this.units[ this.index ];\r\n\t\t\tunit.texture = texture;\r\n\t\t\tunit.indexOffset = indexOffset;\r\n\t\t} else {\r\n\t\t\tthis.units.push( new EShapeBufferUnit( texture, indexOffset ) );\r\n\t\t}\r\n\t\tthis.index += 1;\r\n\t}\r\n\r\n\tend(): void {\r\n\t\tif( this.units.length !== this.index ) {\r\n\t\t\tthis.units.length = this.index;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis.units.length = 0;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Buffer, DRAW_MODES, Geometry, Renderer, Shader, Texture } from \"pixi.js\";\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeBufferUnitBuilder } from \"./e-shape-buffer-unit-builder\";\r\nimport { EShapeRendererIterator } from \"./e-shape-renderer-iterator\";\r\nimport { EShapeType } from \"./e-shape-type\";\r\nimport { EShapeUploaded } from \"./e-shape-uploaded\";\r\nimport { EShapeUploadeds } from \"./e-shape-uploadeds\";\r\n\r\nexport class EShapeBuffer {\r\n\tvertices: Float32Array;\r\n\tprotected _vertexCapacity: number;\r\n\tprotected _vertexCount: number;\r\n\tprotected _vertexBuffer: Buffer | null;\r\n\r\n\tclippings: Float32Array;\r\n\tprotected _clippingBuffer: Buffer | null;\r\n\r\n\tsteps: Float32Array;\r\n\tprotected _stepBuffer: Buffer | null;\r\n\r\n\tcolorFills: Float32Array;\r\n\tprotected _colorFillBuffer: Buffer | null;\r\n\r\n\tcolorStrokes: Float32Array;\r\n\tprotected _colorStrokeBuffer: Buffer | null;\r\n\r\n\tuvs: Float32Array;\r\n\tprotected _uvBuffer: Buffer | null;\r\n\r\n\tindices: Uint16Array | Uint32Array;\r\n\tprotected _indexCapacity: number;\r\n\tprotected _indexCount: number;\r\n\tindexCountRequested: number;\r\n\tprotected _indexBuffer: Buffer | null;\r\n\r\n\tprotected _renderer: Renderer;\r\n\tprotected _geometry: Geometry | null;\r\n\r\n\tprotected _builder: EShapeBufferUnitBuilder;\r\n\r\n\tconstructor( ntriangles: number, renderer: Renderer ) {\r\n\t\tconst nindices = ntriangles * 3;\r\n\t\tconst nvertices = nindices;\r\n\r\n\t\tthis.vertices = new Float32Array( nvertices * 2 );\r\n\t\tthis._vertexCapacity = nvertices;\r\n\t\tthis._vertexCount = 0;\r\n\t\tthis._vertexBuffer = null;\r\n\r\n\t\tthis.clippings = new Float32Array( nvertices * 3 );\r\n\t\tthis._clippingBuffer = null;\r\n\r\n\t\tthis.steps = new Float32Array( nvertices * 6 );\r\n\t\tthis._stepBuffer = null;\r\n\r\n\t\tthis.colorFills = new Float32Array( nvertices * 4 );\r\n\t\tthis._colorFillBuffer = null;\r\n\r\n\t\tthis.colorStrokes = new Float32Array( nvertices * 4 );\r\n\t\tthis._colorStrokeBuffer = null;\r\n\r\n\t\tthis.uvs = new Float32Array( nvertices * 2 );\r\n\t\tthis._uvBuffer = null;\r\n\r\n\t\tconst isIndicesShort = ( nvertices <= 65535 );\r\n\t\tthis.indices = ( isIndicesShort ? new Uint16Array( nindices ) : new Uint32Array( nindices ) );\r\n\t\tthis._indexCapacity = ntriangles;\r\n\t\tthis._indexCount = 0;\r\n\t\tthis.indexCountRequested = 0;\r\n\t\tthis._indexBuffer = null;\r\n\r\n\t\tthis._renderer = renderer;\r\n\r\n\t\tthis._builder = new EShapeBufferUnitBuilder();\r\n\r\n\t\tthis._geometry = null;\r\n\t}\r\n\r\n\tupdateVertices(): void {\r\n\t\tconst vertexBuffer = this._vertexBuffer;\r\n\t\tif( vertexBuffer ) {\r\n\t\t\tvertexBuffer.update();\r\n\t\t}\r\n\t}\r\n\r\n\tupdateClippings(): void {\r\n\t\tconst clippingBuffer = this._clippingBuffer;\r\n\t\tif( clippingBuffer ) {\r\n\t\t\tclippingBuffer.update();\r\n\t\t}\r\n\t}\r\n\r\n\tupdateSteps(): void {\r\n\t\tconst stepBuffer = this._stepBuffer;\r\n\t\tif( stepBuffer ) {\r\n\t\t\tstepBuffer.update();\r\n\t\t}\r\n\t}\r\n\r\n\tupdateColorFills(): void {\r\n\t\tconst colorFillBuffer = this._colorFillBuffer;\r\n\t\tif( colorFillBuffer ) {\r\n\t\t\tcolorFillBuffer.update();\r\n\t\t}\r\n\t}\r\n\r\n\tupdateColorStrokes(): void {\r\n\t\tconst colorStrokeBuffer = this._colorStrokeBuffer;\r\n\t\tif( colorStrokeBuffer ) {\r\n\t\t\tcolorStrokeBuffer.update();\r\n\t\t}\r\n\t}\r\n\r\n\tupdateUvs(): void {\r\n\t\tconst uvBuffer = this._uvBuffer;\r\n\t\tif( uvBuffer ) {\r\n\t\t\tuvBuffer.update();\r\n\t\t}\r\n\t}\r\n\r\n\tupdateIndices(): void {\r\n\t\tconst indexBuffer = this._indexBuffer;\r\n\t\tif( indexBuffer ) {\r\n\t\t\tindexBuffer.update();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getGeometry(): Geometry {\r\n\t\tlet result = this._geometry;\r\n\t\tif( result == null ) {\r\n\t\t\tthis._vertexBuffer = new Buffer( this.vertices, false, false );\r\n\t\t\tthis._clippingBuffer = new Buffer( this.clippings, false, false );\r\n\t\t\tthis._stepBuffer = new Buffer( this.steps, false, false );\r\n\t\t\tthis._colorFillBuffer = new Buffer( this.colorFills, false, false );\r\n\t\t\tthis._colorStrokeBuffer = new Buffer( this.colorStrokes, false, false );\r\n\t\t\tthis._uvBuffer = new Buffer( this.uvs, false, false );\r\n\t\t\tthis._indexBuffer = new Buffer( this.indices, false, true );\r\n\r\n\t\t\tthis._geometry = result = new Geometry()\r\n\t\t\t\t.addIndex( this._indexBuffer )\r\n\t\t\t\t.addAttribute( \"aPosition\", this._vertexBuffer, 2 )\r\n\t\t\t\t.addAttribute( \"aClipping\", this._clippingBuffer, 3 )\r\n\t\t\t\t.addAttribute( \"aStep\", this._stepBuffer, 2 )\r\n\t\t\t\t.addAttribute( \"aAntialias\", this._stepBuffer, 4 )\r\n\t\t\t\t.addAttribute( \"aColorFill\", this._colorFillBuffer, 4 )\r\n\t\t\t\t.addAttribute( \"aColorStroke\", this._colorStrokeBuffer, 4 )\r\n\t\t\t\t.addAttribute( \"aUv\", this._uvBuffer, 2 );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tupload(): void {\r\n\t\tthis._renderer.geometry.bind( this.getGeometry() );\r\n\t}\r\n\r\n\trender( shader: Shader ): void {\r\n\t\tconst renderer = this._renderer;\r\n\t\trenderer.geometry.bind( this.getGeometry() );\r\n\r\n\t\tconst units = this._builder.units;\r\n\t\tconst unitCount = units.length;\r\n\t\tif( 0 < unitCount ) {\r\n\t\t\tconst type = DRAW_MODES.TRIANGLES;\r\n\r\n\t\t\tlet unit0 = null;\r\n\t\t\tlet unit1 = units[ 0 ];\r\n\t\t\tlet ioffset0 = 0;\r\n\t\t\tlet ioffset1 = unit1.indexOffset * 3;\r\n\t\t\tlet vcount = 0;\r\n\t\t\tlet texture = Texture.WHITE;\r\n\t\t\tfor( let i = 0, imax = unitCount - 1; i < imax; ++i ) {\r\n\t\t\t\tunit0 = unit1;\r\n\t\t\t\tunit1 = units[ i + 1 ];\r\n\t\t\t\tioffset0 = ioffset1;\r\n\t\t\t\tioffset1 = unit1.indexOffset * 3;\r\n\t\t\t\tvcount = ioffset1 - ioffset0;\r\n\t\t\t\ttexture = unit0.texture || Texture.WHITE;\r\n\t\t\t\tif( 0 < vcount && texture.valid ) {\r\n\t\t\t\t\tshader.uniforms.sampler = renderer.texture.bind( texture );\r\n\t\t\t\t\trenderer.geometry.draw( type, vcount, ioffset0 );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvcount = this._indexCount * 3 - ioffset1;\r\n\t\t\ttexture = unit1.texture || Texture.WHITE;\r\n\t\t\tif( 0 < vcount && texture.valid ) {\r\n\t\t\t\tshader.uniforms.sampler = renderer.texture.bind( texture );\r\n\t\t\t\trenderer.geometry.draw( type, vcount, ioffset1 );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tisCompatible( shape: EShape, uploaded: EShapeUploaded, vindex: number, iindex: number ): boolean {\r\n\t\treturn (\r\n\t\t\tuploaded.getBuffer() === this &&\r\n\t\t\tuploaded.getVertexOffset() === vindex &&\r\n\t\t\tuploaded.getIndexOffset() === iindex &&\r\n\t\t\tuploaded.isCompatible( shape )\r\n\t\t);\r\n\t}\r\n\r\n\tupdate( iterator: EShapeRendererIterator, antialiasWeight: number, noMoreThanOne: boolean ): boolean {\r\n\t\tconst builder = this._builder;\r\n\t\tbuilder.begin();\r\n\r\n\t\tlet vindex = 0;\r\n\t\tlet iindex = 0;\r\n\t\tlet shape = iterator.get();\r\n\t\tfor( ; shape != null; shape = iterator.next() ) {\r\n\t\t\tconst uploaded = shape.uploaded;\r\n\t\t\tif( uploaded == null || ! this.isCompatible( shape, uploaded, vindex, iindex ) ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tuploaded.update( shape );\r\n\t\t\tuploaded.buildUnit( builder );\r\n\r\n\t\t\tvindex += uploaded.getVertexCount();\r\n\t\t\tiindex += uploaded.getIndexCount();\r\n\r\n\t\t\tif( noMoreThanOne ) {\r\n\t\t\t\titerator.next();\r\n\t\t\t\tbuilder.end();\r\n\t\t\t\tthis._vertexCount = vindex;\r\n\t\t\t\tthis._indexCount = iindex;\r\n\t\t\t\treturn 0 < builder.units.length;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor( ; shape != null; shape = iterator.next() ) {\r\n\t\t\tconst creater = EShapeUploadeds[ shape.type ] || EShapeUploadeds[ EShapeType.GROUP ];\r\n\t\t\tif( creater == null ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tconst uploaded = creater( this, shape, vindex, iindex, antialiasWeight );\r\n\t\t\tif( uploaded == null ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tuploaded.buildUnit( builder );\r\n\t\t\tvindex += uploaded.getVertexCount();\r\n\t\t\tiindex += uploaded.getIndexCount();\r\n\r\n\t\t\tif( noMoreThanOne ) {\r\n\t\t\t\titerator.next();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbuilder.end();\r\n\t\tthis._vertexCount = vindex;\r\n\t\tthis._indexCount = iindex;\r\n\t\treturn 0 < builder.units.length;\r\n\t}\r\n\r\n\tcheck( vindex: number, ioffset: number, vcount: number, icount: number ): boolean {\r\n\t\tthis.indexCountRequested = icount;\r\n\t\treturn vindex + vcount <= this._vertexCapacity && ioffset + icount <= this._indexCapacity;\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst geometry = this._geometry;\r\n\t\tif( geometry ) {\r\n\t\t\tgeometry.destroy();\r\n\t\t}\r\n\t\tthis._builder.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"./e-shape\";\r\n\r\nconst DUMMY_SHAPES: EShape[] = [];\r\n\r\nexport class EShapeRendererIteratorDatum {\r\n\tprotected index: number;\r\n\tprotected shapes: EShape[];\r\n\r\n\tconstructor() {\r\n\t\tthis.index = 0;\r\n\t\tthis.shapes = DUMMY_SHAPES;\r\n\t}\r\n\r\n\treset( shapes: EShape[] ) {\r\n\t\tthis.index = -1;\r\n\t\tthis.shapes = shapes;\r\n\t}\r\n\r\n\tnext(): EShape | null {\r\n\t\tconst index = this.index = this.index + 1;\r\n\t\tconst shapes = this.shapes;\r\n\t\tif( index < shapes.length ) {\r\n\t\t\treturn shapes[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeRendererIteratorDatum } from \"./e-shape-renderer-iterator-datum\";\r\n\r\nexport class EShapeRendererIterator {\r\n\tprotected _index: number;\r\n\tprotected _data: EShapeRendererIteratorDatum[];\r\n\tprotected _datum: EShapeRendererIteratorDatum;\r\n\tprotected _current: EShape | null;\r\n\r\n\tconstructor() {\r\n\t\tthis._index = -1;\r\n\t\tthis._datum = new EShapeRendererIteratorDatum();\r\n\t\tthis._data = [ this._datum ];\r\n\t\tthis._current = null;\r\n\t}\r\n\r\n\treset( shapes: EShape[] ): EShape | null {\r\n\t\tthis._index = 0;\r\n\t\tconst current = this._datum = this._data[ 0 ];\r\n\t\tcurrent.reset( shapes );\r\n\t\tthis._current = null;\r\n\t\treturn this.next();\r\n\t}\r\n\r\n\tget(): EShape | null {\r\n\t\treturn this._current;\r\n\t}\r\n\r\n\tnext(): EShape | null {\r\n\t\tconst datum = this._datum;\r\n\t\tconst shape = datum.next();\r\n\t\tif( shape != null ) {\r\n\t\t\tthis._current = shape;\r\n\t\t\tconst children = shape.children;\r\n\t\t\tif( 0 < children.length ) {\r\n\t\t\t\tconst datumIndex = this._index = this._index + 1;\r\n\t\t\t\tconst data = this._data;\r\n\t\t\t\tif( datumIndex < data.length ) {\r\n\t\t\t\t\tconst newDatum = data[ datumIndex ];\r\n\t\t\t\t\tnewDatum.reset( children );\r\n\t\t\t\t\tthis._datum = newDatum;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst newDatum = new EShapeRendererIteratorDatum();\r\n\t\t\t\t\tdata.push( newDatum );\r\n\t\t\t\t\tnewDatum.reset( children );\r\n\t\t\t\t\tthis._datum = newDatum;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn shape;\r\n\t\t} else {\r\n\t\t\tconst datumIndex = this._index = this._index - 1;\r\n\t\t\tconst data = this._data;\r\n\t\t\tif( 0 <= datumIndex ) {\r\n\t\t\t\tthis._datum = data[ datumIndex ];\r\n\t\t\t\tthis._current = null;\r\n\t\t\t\treturn this.next();\r\n\t\t\t} else {\r\n\t\t\t\tthis._current = null;\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { BaseTexture, BLEND_MODES, ObjectRenderer, Renderer, Shader, Texture, utils } from \"pixi.js\";\r\nimport { DynamicAtlas } from \"../util/dynamic-atlas\";\r\nimport { DynamicAtlasItemImage } from \"../util/dynamic-atlas-item-image\";\r\nimport { DynamicSDFFontAtlases } from \"../util/dynamic-sdf-font-atlases\";\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeBuffer } from \"./e-shape-buffer\";\r\nimport { EShapeContainer } from \"./e-shape-container\";\r\nimport { EShapeRendererIterator } from \"./e-shape-renderer-iterator\";\r\n\r\nconst VERTEX_SHADER = `\r\nattribute vec2 aPosition;\r\nattribute vec3 aClipping;\r\nattribute vec2 aStep;\r\nattribute vec4 aAntialias;\r\nattribute vec4 aColorFill;\r\nattribute vec4 aColorStroke;\r\nattribute vec2 aUv;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mediump float pixelScale;\r\nuniform mediump float antialiasWeight;\r\n\r\nvarying mediump vec3 vClipping;\r\nvarying mediump vec2 vStep;\r\nvarying mediump vec4 vAntialias;\r\nvarying mediump vec4 vColorFill;\r\nvarying mediump vec4 vColorStroke;\r\nvarying mediump vec2 vUv;\r\n\r\nvec2 toInverse( in vec2 v ) {\r\n\treturn vec2( -v.y, v.x );\r\n}\r\n\r\nvec2 toTransformedPosition( in vec2 v ) {\r\n\treturn (projectionMatrix * translationMatrix * vec3(v, 1.0)).xy;\r\n}\r\n\r\nvec4 toAntialias01( in vec4 antialias, in float scale ) {\r\n\t// Taylor series of 1 / ( 1 - a ) = 1 + a + a^2 + ....\r\n\treturn 1.0 + min( vec4( 1.0 ), antialias * scale );\r\n}\r\n\r\nvec4 toAntialias2( in vec2 step, in vec4 antialias, in float scale ) {\r\n\tfloat x = min( 0.4, step.x * scale );\r\n\tfloat y = 0.5 - antialias.x;\r\n\tfloat z = 0.5 - antialias.x - step.y;\r\n\treturn vec4( y, z, y - max( 0.01, y - x ), z - max( 0.01, z - x ) );\r\n}\r\n\r\nvec2 toPosition3456( in float type, in vec2 p, in vec2 pprev, in vec2 pnext, in float strokeWidth, out float shift ) {\r\n\tvec2 d0 = p - pprev;\r\n\tvec2 d1 = pnext - p;\r\n\tfloat l0 = dot( d0, d0 );\r\n\tfloat l1 = dot( d1, d1 );\r\n\tvec2 nd0 = normalize( toInverse( d0 ) );\r\n\tvec2 nd1 = normalize( toInverse( d1 ) );\r\n\tvec2 n0 = 0.00001 < l0 ? nd0 : nd1;\r\n\tvec2 n1 = 0.00001 < l1 ? nd1 : nd0;\r\n\tvec2 n0i = toInverse( n0 );\r\n\tvec2 n1i = toInverse( n1 );\r\n\tfloat direction = sign( 4.5 - type );\r\n\r\n\t// Offset\r\n\tfloat cross = dot( n0i, n1 );\r\n\tfloat crossInverse = ( 0.00001 < abs( cross ) ? 1.0 / cross : 0.0 );\r\n\tfloat b = dot(n1 - n0, n0) * crossInverse;\r\n\tfloat offsetSize = direction * strokeWidth * 0.5;\r\n\tvec2 offset = n1 + n1i * b;\r\n\r\n\t// Miter\r\n\tvec2 pmiter = p + offsetSize * offset;\r\n\tfloat miterAngle0 = dot( n0i, pmiter - pprev );\r\n\tfloat miterAngle1 = dot( n1i, pmiter - pnext );\r\n\tfloat miterLength = dot( offset, offset );\r\n\tfloat miterSide = direction * cross;\r\n\r\n\t// Bevel\r\n\tvec2 n = ( type == 4.0 || type == 6.0 ? n1 : n0 );\r\n\tvec2 pbevel = p + offsetSize * n;\r\n\r\n\t//\r\n\tvec2 presult = (\r\n\t\t0.0 <= miterAngle0 || miterAngle1 < 0.0 || miterSide < 0.0 ?\r\n\t\tpbevel : pmiter\r\n\t);\r\n\t/*\r\n\tvec2 presult = (\r\n\t\tmiterAngle0 < 0.0 && 0.0 <= miterAngle1 && miterLength < 50.0 ?\r\n\t\tpmiter : pbevel\r\n\t);\r\n\t*/\r\n\tvec2 ni = ( type == 4.0 || type == 6.0 ? n1i : n0i );\r\n\tshift = dot( ni, p - presult );\r\n\treturn toTransformedPosition( presult );\r\n}\r\n\r\nvec2 toStep3456( in float type ) {\r\n\treturn ( type < 4.5 ? vec2( 1.0, 0.0 ) : vec2( 0.0, 1.0 ) );\r\n}\r\n\r\nvec4 toAntialias3456( in float strokeWidth, in float scale ) {\r\n\tfloat a = antialiasWeight / max( 0.0001, strokeWidth );\r\n\treturn toAntialias01( vec4( a, a, a, a ), scale );\r\n}\r\n\r\nfloat toDotAndDashScale( in float scale, in float strokeWidthScale ) {\r\n\treturn (\r\n\t\tscale == 4.0 || scale == 5.0 || scale == 6.0 || scale == 7.0 ?\r\n\t\tstrokeWidthScale : 1.0\r\n\t);\r\n}\r\n\r\nvec4 toColorStroke3456( in float shift, in float scale ) {\r\n\tfloat x = aColorFill.x + shift;\r\n\tfloat y = scale * aColorFill.y;\r\n\tfloat z = scale * aColorFill.z;\r\n\tfloat w = aColorFill.w;\r\n\treturn vec4( x, y, z, w );\r\n}\r\n\r\nfloat toStrokeWidthScale( in float scale ) {\r\n\treturn (\r\n\t\tscale == 3.0 || scale == 7.0 ?\r\n\t\tpixelScale : (\r\n\t\t\tscale == 1.0 || scale == 5.0 ?\r\n\t\t\tmin( 1.0, pixelScale ) : (\r\n\t\t\t\tscale == 2.0 || scale == 6.0 ?\r\n\t\t\t\tmax( 1.0, pixelScale ) : 1.0\r\n\t\t\t)\r\n\t\t)\r\n\t);\r\n}\r\n\r\nvoid main(void) {\r\n\tvec2 p012 = toTransformedPosition( aPosition );\r\n\r\n\tfloat type = aClipping.z;\r\n\r\n\t// type === 0 or 1\r\n\tvec4 a01 = toAntialias01( aAntialias, pixelScale );\r\n\r\n\t// type === 2\r\n\tvec4 a2 = toAntialias2( aStep, aAntialias, pixelScale );\r\n\r\n\t// type === 3, 4, 5 or 6\r\n\tfloat shift3456 = 0.0;\r\n\tfloat strokeWidthScale = toStrokeWidthScale( aStep.y );\r\n\tfloat strokeWidth = strokeWidthScale * aStep.x;\r\n\tvec2 p3456 = toPosition3456( type, aPosition, aAntialias.xy, aAntialias.zw, strokeWidth, shift3456 );\r\n\tvec2 step3456 = toStep3456( type );\r\n\tvec4 a3456 = toAntialias3456( strokeWidth, pixelScale );\r\n\tvec4 colorStroke3456 = toColorStroke3456( shift3456, toDotAndDashScale( aStep.y, strokeWidthScale ) );\r\n\r\n\t//\r\n\tgl_Position = vec4( ( 2.5 < type ? p3456 : p012 ), 0.0, 1.0 );\r\n\tvAntialias = ( 1.5 < type ? ( 2.5 < type ? a3456 : a2 ) : a01 );\r\n\tvClipping = aClipping;\r\n\tvStep = ( 2.5 < type ? step3456 : aStep );\r\n\tvColorFill = ( 2.5 < type ? aColorStroke : aColorFill );\r\n\tvColorStroke = ( 2.5 < type ? colorStroke3456 : aColorStroke );\r\n\tvUv = aUv;\r\n}`;\r\n\r\nconst FRAGMENT_SHADER_NO_AA = `\r\nvarying mediump vec3 vClipping;\r\nvarying mediump vec2 vStep;\r\nvarying mediump vec4 vAntialias;\r\nvarying mediump vec4 vColorFill;\r\nvarying mediump vec4 vColorStroke;\r\nvarying mediump vec2 vUv;\r\n\r\nuniform sampler2D sampler;\r\nuniform mediump float pixelScale;\r\n\r\nvoid main(void) {\r\n\tvec4 texture = texture2D(sampler, vUv);\r\n\tfloat type = vClipping.z;\r\n\tvec2 v0 = vStep;\r\n\tvec2 v1 = vClipping.xy;\r\n\tvec2 v2 = v0 * vAntialias.xy;\r\n\tvec2 v3 = v1 * vAntialias.zw;\r\n\tvec2 d01 = ( v0.x < v0.y ? vec2( v0.y, v2.y ) : vec2( v0.x, v2.x ) );\r\n\tvec2 d02 = ( v1.x < v1.y ? vec2( v1.y, v3.y ) : vec2( v1.x, v3.x ) );\r\n\tvec4 d0 = vec4( d01.x, d02.x, d01.y, d02.y );\r\n\tvec4 d1 = vec4( dot( v0, v0 ), dot( v1, v1 ), dot( v2, v2 ), dot( v3, v3 ) );\r\n\tvec4 d = ( type == 1.0 ? d1 : d0 );\r\n\tvec2 s = step( vec2( 1.0 ), d.xy );\r\n\tvec4 color01 = texture * (vColorStroke * (s.x - s.y) + vColorFill * (1.0 - s.x));\r\n\r\n\tfloat l = vColorStroke.x;\r\n\tfloat lp0 = vColorStroke.y;\r\n\tfloat lp1 = vColorStroke.z;\r\n\tfloat lt = vColorStroke.w;\r\n\tfloat lm = mod( l, lp0 + lp1 );\r\n\tfloat ls0 = step( 0.0, lm );\r\n\tfloat ls1 = step( lp0, lm );\r\n\tfloat ls2 = ( 0.0 <= lt ? 1.0 - step( lt, l ) : 1.0 );\r\n\tvec4 color3456 = color01 * ( ls0 - ls1 ) * ls2;\r\n\r\n\tvec2 a0 = vAntialias.xy;\r\n\tvec2 a1 = vAntialias.zw;\r\n\tvec2 a2 = vec2( texture.a );\r\n\tvec2 a = smoothstep( a0 - a1, a0 + a1, a2 );\r\n\tvec4 color2 = a.x * vColorFill + ( a.y - a.x ) * vColorStroke;\r\n\tgl_FragColor = ( type == 2.0 ? color2 : (2.5 < type ? color3456 : color01) );\r\n}`;\r\n\r\nconst FRAGMENT_SHADER = `\r\nvarying mediump vec3 vClipping;\r\nvarying mediump vec2 vStep;\r\nvarying mediump vec4 vAntialias;\r\nvarying mediump vec4 vColorFill;\r\nvarying mediump vec4 vColorStroke;\r\nvarying mediump vec2 vUv;\r\n\r\nuniform sampler2D sampler;\r\nuniform mediump float pixelScale;\r\n\r\nvoid main(void) {\r\n\tvec4 texture = texture2D(sampler, vUv);\r\n\tfloat type = vClipping.z;\r\n\tvec2 v0 = vStep;\r\n\tvec2 v1 = vClipping.xy;\r\n\tvec2 v2 = v0 * vAntialias.xy;\r\n\tvec2 v3 = v1 * vAntialias.zw;\r\n\tvec2 d01 = ( v0.x < v0.y ? vec2( v0.y, v2.y ) : vec2( v0.x, v2.x ) );\r\n\tvec2 d02 = ( v1.x < v1.y ? vec2( v1.y, v3.y ) : vec2( v1.x, v3.x ) );\r\n\tvec4 d0 = vec4( d01.x, d02.x, d01.y, d02.y );\r\n\tvec4 d1 = vec4( dot( v0, v0 ), dot( v1, v1 ), dot( v2, v2 ), dot( v3, v3 ) );\r\n\tvec4 d = ( type == 1.0 ? d1 : d0 );\r\n\tvec2 s = smoothstep( 1.0 - (d.zw - d.xy), vec2( 1.0 ), d.xy );\r\n\tvec4 color01 = texture * (vColorStroke * (s.x - s.y) + vColorFill * (1.0 - s.x));\r\n\r\n\tfloat l = vColorStroke.x;\r\n\tfloat lp0 = vColorStroke.y;\r\n\tfloat lp1 = vColorStroke.z;\r\n\tfloat lt = vColorStroke.w;\r\n\tfloat ld = 0.5 * pixelScale;\r\n\tfloat lm = mod( l, lp0 + lp1 );\r\n\tfloat ls0 = smoothstep( 0.0, 0.0 + ld, lm );\r\n\tfloat ls1 = smoothstep( lp0, lp0 + ld, lm );\r\n\tfloat ls2 = ( 0.0 <= lt ? 1.0 - smoothstep( lt - ld, lt, l ) : 1.0 );\r\n\tvec4 color3456 = color01 * ( ls0 - ls1 ) * ls2;\r\n\r\n\tvec2 a0 = vAntialias.xy;\r\n\tvec2 a1 = vAntialias.zw;\r\n\tvec2 a2 = vec2( texture.a );\r\n\tvec2 a = smoothstep( a0 - a1, a0 + a1, a2 );\r\n\tvec4 color2 = a.x * vColorFill + ( a.y - a.x ) * vColorStroke;\r\n\tgl_FragColor = ( type == 2.0 ? color2 : (2.5 < type ? color3456 : color01) );\r\n}`;\r\n\r\nexport class EShapeRenderer extends ObjectRenderer {\r\n\tstatic SHADER: Shader | null = null;\r\n\r\n\tprotected _shader: Shader | null;\r\n\tprotected _iterator: EShapeRendererIterator;\r\n\tprotected _bufferSizeMax: number;\r\n\r\n\tconstructor( renderer: Renderer ) {\r\n\t\tsuper( renderer );\r\n\t\tEShapeRenderer.SHADER = EShapeRenderer.SHADER || Shader.from( VERTEX_SHADER, FRAGMENT_SHADER );\r\n\t\tthis._shader = EShapeRenderer.SHADER;\r\n\t\tthis._iterator = new EShapeRendererIterator();\r\n\t\tthis._bufferSizeMax = this.getBufferSizeMax( renderer );\r\n\t}\r\n\r\n\tprotected getBufferSizeMax( renderer: Renderer ): number {\r\n\t\tconst context = renderer.context;\r\n\t\tconst extensions = context.extensions as any;\r\n\t\tif( 1 < context.webGLVersion || !! extensions.uint32ElementIndex ) {\r\n\t\t\treturn 1431655765; // 2^32 / 3\r\n\t\t}\r\n\t\treturn 21845; // 2^16 / 3\r\n\t}\r\n\r\n\tupdateAtlas(\r\n\t\tshape: EShape,\r\n\t\tatlas: DynamicAtlas, fontAtlases: DynamicSDFFontAtlases,\r\n\t\tdefaultTexture: Texture, baseTexture: BaseTexture\r\n\t): void {\r\n\t\t// Texture\r\n\t\t// Do not access the shape.image.src here.\r\n\t\t// It slows down the rendering speed significantly.\r\n\t\tconst imageSrc = shape.imageSrc;\r\n\t\tif( imageSrc != null ) {\r\n\t\t\tconst textureItem = atlas.get( imageSrc );\r\n\t\t\tif( textureItem != null ) {\r\n\t\t\t\tshape.texture = textureItem.texture;\r\n\t\t\t} else {\r\n\t\t\t\tconst newTextureItem = new DynamicAtlasItemImage( shape.image!, baseTexture );\r\n\t\t\t\tshape.texture = newTextureItem.texture;\r\n\t\t\t\tatlas.set( newTextureItem.id, newTextureItem );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tshape.texture = defaultTexture;\r\n\t\t}\r\n\r\n\t\t// Font texture atlas\r\n\t\tconst text = shape.text;\r\n\t\tconst textValue = text.value;\r\n\t\tif( 0 < textValue.length ) {\r\n\t\t\tfontAtlases.add( text.family, textValue );\r\n\t\t}\r\n\t}\r\n\r\n\tupdateAtlases(\r\n\t\tshapes: EShape[],\r\n\t\tatlas: DynamicAtlas, fontAtlases: DynamicSDFFontAtlases,\r\n\t\tdefaultTexture: Texture, baseTexture: BaseTexture\r\n\t): void {\r\n\t\tfor( let i = 0, imax = shapes.length; i < imax; ++i ) {\r\n\t\t\tconst shape = shapes[ i ];\r\n\t\t\tthis.updateAtlas( shape, atlas, fontAtlases, defaultTexture, baseTexture );\r\n\t\t\tconst children = shape.children;\r\n\t\t\tfor( let j = 0, jmax = children.length; j < jmax; ++j ) {\r\n\t\t\t\tconst child = children[ j ];\r\n\t\t\t\tthis.updateAtlas( child, atlas, fontAtlases, defaultTexture, baseTexture );\r\n\t\t\t\tthis.updateAtlases( child.children, atlas, fontAtlases, defaultTexture, baseTexture );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateFontAtlas(\r\n\t\tshape: EShape,\r\n\t\tatlas: DynamicAtlas, fontAtlases: DynamicSDFFontAtlases,\r\n\t\tdefaultTexture: Texture\r\n\t): void {\r\n\t\tconst text = shape.text;\r\n\t\tconst fontAtlas = fontAtlases.get( text.family );\r\n\t\tif( fontAtlas != null ) {\r\n\t\t\tconst textureItem = atlas.get( fontAtlas.id );\r\n\t\t\tif( textureItem != null ) {\r\n\t\t\t\ttext.atlas = fontAtlas;\r\n\t\t\t\ttext.texture = textureItem.texture;\r\n\t\t\t} else {\r\n\t\t\t\ttext.atlas = undefined;\r\n\t\t\t\ttext.texture = defaultTexture;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttext.atlas = undefined;\r\n\t\t\ttext.texture = defaultTexture;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateFontAtlases(\r\n\t\tshapes: EShape[],\r\n\t\tatlas: DynamicAtlas, fontAtlases: DynamicSDFFontAtlases,\r\n\t\tdefaultTexture: Texture\r\n\t): void {\r\n\t\tfor( let i = 0, imax = shapes.length; i < imax; ++i ) {\r\n\t\t\tconst shape = shapes[ i ];\r\n\t\t\tthis.updateFontAtlas( shape, atlas, fontAtlases, defaultTexture );\r\n\t\t\tconst children = shape.children;\r\n\t\t\tfor( let j = 0, jmax = children.length; j < jmax; ++j ) {\r\n\t\t\t\tconst child = children[ j ];\r\n\t\t\t\tthis.updateFontAtlas( child, atlas, fontAtlases, defaultTexture );\r\n\t\t\t\tthis.updateFontAtlases( child.children, atlas, fontAtlases, defaultTexture );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trender_( container: EShapeContainer, shapes: EShape[], isDirty: boolean ): void {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst shader = this._shader;\r\n\r\n\t\tif( shader != null && 0 < shapes.length ) {\r\n\t\t\tconst resolution = renderer.resolution;\r\n\t\t\tconst buffers = container.getBuffers();\r\n\t\t\tconst antialiasWeight = container.getAntialiasWeight( resolution );\r\n\r\n\t\t\t// Update textures\r\n\t\t\tif( isDirty ) {\r\n\t\t\t\t// Atlases\r\n\t\t\t\tconst atlas = container.getAtlas( resolution );\r\n\t\t\t\tconst fontAtlases = container.getFontAtlases();\r\n\t\t\t\tatlas.begin();\r\n\t\t\t\tfontAtlases.begin();\r\n\t\t\t\tconst defaultTexture = atlas.getDefaultTexture();\r\n\t\t\t\tconst baseTexture: BaseTexture = atlas.getBaseTexture();\r\n\t\t\t\tthis.updateAtlases( shapes, atlas, fontAtlases, defaultTexture, baseTexture );\r\n\t\t\t\tfontAtlases.end();\r\n\t\t\t\tfontAtlases.update( atlas );\r\n\t\t\t\tthis.updateFontAtlases( shapes, atlas, fontAtlases, defaultTexture );\r\n\t\t\t\tatlas.end();\r\n\t\t\t\tatlas.repack();\r\n\r\n\t\t\t\t// Update buffers\r\n\t\t\t\tthis.updateBuffers( shapes, buffers, renderer, antialiasWeight );\r\n\t\t\t}\r\n\r\n\t\t\t// Render buffers\r\n\t\t\tshader.uniforms.pixelScale = container.toPixelScale( resolution );\r\n\t\t\tshader.uniforms.antialiasWeight = antialiasWeight;\r\n\t\t\tshader.uniforms.translationMatrix = container.worldTransform.toArray( true );\r\n\t\t\trenderer.shader.bind( shader, false );\r\n\t\t\trenderer.state!.setBlendMode(utils.correctBlendMode(BLEND_MODES.NORMAL, true));\r\n\t\t\tconst buffersLength = buffers.length;\r\n\t\t\tif( 1 < buffersLength ) {\r\n\t\t\t\tfor( let i = 0; i < buffersLength; ++i ) {\r\n\t\t\t\t\tbuffers[ i ].upload();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor( let i = 0; i < buffersLength; ++i ) {\r\n\t\t\t\tbuffers[ i ].render( shader );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateBuffers(\r\n\t\tshapes: EShape[], buffers: EShapeBuffer[],\r\n\t\trenderer: Renderer, antialiasWeight: number\r\n\t): void {\r\n\t\tconst iterator = this._iterator;\r\n\t\titerator.reset( shapes );\r\n\r\n\t\tlet ib = 0;\r\n\t\tlet bufferSize = 0;\r\n\t\tconst bufferSizeBase = 5000;\r\n\t\tconst bufferSizeMax = this._bufferSizeMax;\r\n\t\twhile( iterator.get() != null ) {\r\n\t\t\tlet buffer: EShapeBuffer | null = null;\r\n\t\t\tlet noMoreThanOne = false;\r\n\t\t\tif( 0 < bufferSize ) {\r\n\t\t\t\tbuffer = new EShapeBuffer( bufferSize, renderer );\r\n\t\t\t\tbuffers.splice( ib, 0, buffer );\r\n\t\t\t\tnoMoreThanOne = true;\r\n\t\t\t} else if( ib < buffers.length ) {\r\n\t\t\t\tbuffer = buffers[ ib ];\r\n\t\t\t\tnoMoreThanOne = false;\r\n\t\t\t} else {\r\n\t\t\t\tbuffer = new EShapeBuffer( bufferSizeBase, renderer );\r\n\t\t\t\tbuffers.push( buffer );\r\n\t\t\t\tnoMoreThanOne = false;\r\n\t\t\t}\r\n\t\t\tif( buffer.update( iterator, antialiasWeight, noMoreThanOne ) ) {\r\n\t\t\t\tbufferSize = 0;\r\n\t\t\t\tib += 1;\r\n\t\t\t} else {\r\n\t\t\t\tbufferSize = buffer.indexCountRequested;\r\n\t\t\t\tif( bufferSize <= bufferSizeMax ) {\r\n\t\t\t\t\tbufferSize = Math.ceil( bufferSize / bufferSizeBase ) * bufferSizeBase;\r\n\t\t\t\t\tbufferSize = Math.min( bufferSize, bufferSizeMax );\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// No way to render\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( ib < buffers.length ) {\r\n\t\t\tfor( let jb = ib, ibmax = buffers.length; jb < ibmax; ++jb ) {\r\n\t\t\t\tbuffers[ jb ].destroy();\r\n\t\t\t}\r\n\t\t\tbuffers.length = ib;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, IPoint, Point, Renderer } from \"pixi.js\";\r\nimport { DynamicAtlas } from \"../util/dynamic-atlas\";\r\nimport { DynamicSDFFontAtlases } from \"../util/dynamic-sdf-font-atlases\";\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeBuffer } from \"./e-shape-buffer\";\r\nimport { EShapeRenderer } from \"./e-shape-renderer\";\r\n\r\nexport class EShapeContainer extends DisplayObject {\r\n\tprotected _shapeRenderer: EShapeRenderer | null = null;\r\n\r\n\treadonly children: EShape[];\r\n\tprotected _childrenId: number;\r\n\tprotected _childrenIdRendered: number;\r\n\r\n\tprotected _atlas: DynamicAtlas | null;\r\n\tprotected _fontAtlases: DynamicSDFFontAtlases;\r\n\r\n\tprotected _pixelScale: number;\r\n\tprotected _pixelScaleId: number;\r\n\r\n\tprotected _work: Point;\r\n\r\n\tprotected _buffers: EShapeBuffer[];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.children = [];\r\n\r\n\t\tthis._childrenId = 0;\r\n\t\tthis._childrenIdRendered = -1;\r\n\r\n\t\tthis._atlas = null;\r\n\t\tthis._fontAtlases = new DynamicSDFFontAtlases();\r\n\r\n\t\tthis._pixelScale = 1;\r\n\t\tthis._pixelScaleId = NaN;\r\n\r\n\t\tthis._work = new Point();\r\n\r\n\t\tthis._buffers = [];\r\n\t}\r\n\r\n\tcalculateBounds(): void {\r\n\t\tthis._bounds.clear();\r\n\t}\r\n\r\n\tonChildTransformChange(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\ttoDirty(): number {\r\n\t\treturn this._childrenId += 1;\r\n\t}\r\n\r\n\tisDirty(): boolean {\r\n\t\treturn this._childrenIdRendered < this._childrenId;\r\n\t}\r\n\r\n\trender( renderer: Renderer ): void {\r\n\t\tif( !this.visible || this.worldAlpha <= 0 || !this.renderable ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst childrenId = this._childrenId;\r\n\t\tconst childrenIdRendered = this._childrenIdRendered;\r\n\t\tthis._childrenIdRendered = childrenId;\r\n\t\tconst isChildrenDirty = childrenIdRendered < childrenId;\r\n\t\tconst children = this.children;\r\n\r\n\t\tlet shapeRenderer: EShapeRenderer | null = this._shapeRenderer;\r\n\t\tif( shapeRenderer == null ) {\r\n\t\t\tshapeRenderer = this._shapeRenderer = new EShapeRenderer( renderer );\r\n\t\t}\r\n\t\trenderer.batch.setObjectRenderer( shapeRenderer );\r\n\r\n\t\tconst mask = this.mask;\r\n\t\tif( mask ) {\r\n\t\t\trenderer.mask.push( this, mask );\r\n\t\t\tshapeRenderer.render_( this, children, isChildrenDirty );\r\n\t\t\trenderer.mask.pop( this );\r\n\t\t} else {\r\n\t\t\tshapeRenderer.render_( this, children, isChildrenDirty );\r\n\t\t}\r\n\t}\r\n\r\n\tcontainsPoint( point: Point ): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetFontAtlases(): DynamicSDFFontAtlases {\r\n\t\treturn this._fontAtlases;\r\n\t}\r\n\r\n\tgetAtlas( resolution: number ): DynamicAtlas {\r\n\t\tlet atlas = this._atlas;\r\n\t\tif( atlas == null ) {\r\n\t\t\tatlas = new DynamicAtlas( resolution );\r\n\t\t\tthis._atlas = atlas;\r\n\t\t}\r\n\t\treturn atlas;\r\n\t}\r\n\r\n\tgetBuffers(): EShapeBuffer[] {\r\n\t\treturn this._buffers;\r\n\t}\r\n\r\n\ttoPixelScale( resolution: number ): number {\r\n\t\tthis.updateTransform();\r\n\t\tconst transform = this.transform;\r\n\t\tconst worldID = (transform as any)._worldID;\r\n\t\tif( worldID !== this._pixelScaleId ) {\r\n\t\t\tthis._pixelScaleId = worldID;\r\n\t\t\tconst worldTransform = transform.worldTransform;\r\n\t\t\tconst a = worldTransform.a;\r\n\t\t\tconst b = worldTransform.b;\r\n\t\t\tconst scale = Math.sqrt( a * a + b * b );\r\n\t\t\tthis._pixelScale = 1 / ( resolution * scale );\r\n\t\t}\r\n\t\treturn this._pixelScale;\r\n\t}\r\n\r\n\tgetPixelScale(): number {\r\n\t\treturn this._pixelScale;\r\n\t}\r\n\r\n\tgetAntialiasWeight( resolution: number ): number {\r\n\t\treturn 1.25 / resolution;\r\n\t}\r\n\r\n\thitTest( global: IPoint, handler?: ( shape: EShape ) => boolean ): EShape | null {\r\n\t\tconst work = this._work;\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child.visible ) {\r\n\t\t\t\tconst childLocal = child.toLocal( global, undefined, work );\r\n\t\t\t\tconst childResult = child.contains( childLocal );\r\n\t\t\t\tif( childResult != null ) {\r\n\t\t\t\t\tif( handler == null || handler( childResult ) ) {\r\n\t\t\t\t\t\treturn childResult;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\thitTestBBox( global: IPoint, handler?: ( shape: EShape ) => boolean ): EShape | null {\r\n\t\tconst work = this._work;\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child.visible ) {\r\n\t\t\t\tconst childLocal = child.toLocal( global, undefined, work );\r\n\t\t\t\tif( child.containsBBox( childLocal ) ) {\r\n\t\t\t\t\tif( handler == null || handler( child ) ) {\r\n\t\t\t\t\t\treturn child;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// Buffer\r\n\t\tconst buffers = this._buffers;\r\n\t\tif( buffers != null ) {\r\n\t\t\tfor( let i = 0, imax = buffers.length; i < imax; ++i ) {\r\n\t\t\t\tbuffers[ i ].destroy();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._buffers.length = 0;\r\n\r\n\t\t// Shapes\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\tchildren[ i ].destroy();\r\n\t\t}\r\n\t\tchildren.length = 0;\r\n\r\n\t\t//\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeContainer } from \"./e-shape-container\";\r\nimport { EShapeType } from \"./e-shape-type\";\r\nimport { EShapeBase } from \"./variant/e-shape-base\";\r\n\r\nexport class EShapeSearch {\r\n\tstatic COMPARATOR_INDEX = ( a: EShape, b: EShape ): number => {\r\n\t\treturn a.index - b.index;\r\n\t}\r\n\r\n\tstatic toIndices( shapes: EShape[] ): number[] {\r\n\t\tconst result = [];\r\n\t\tfor( let i = 0, imax = shapes.length; i < imax; ++i ) {\r\n\t\t\tresult.push( shapes[ i ].index );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toDepth( shape: EShape ): number {\r\n\t\tlet result = 0;\r\n\t\tlet parent = shape.parent;\r\n\t\twhile( parent instanceof EShapeBase ) {\r\n\t\t\tresult += 1;\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toSharedParent( first: EShape, shape: EShape ): EShape | EShapeContainer {\r\n\t\tconst depthA = this.toDepth( first );\r\n\t\tconst depthB = this.toDepth( shape );\r\n\t\tif( depthA < depthB ) {\r\n\t\t\tlet parent = first.parent;\r\n\t\t\twhile( parent instanceof EShapeBase ) {\r\n\t\t\t\tif( this.isParent( shape, parent ) ) {\r\n\t\t\t\t\treturn parent;\r\n\t\t\t\t}\r\n\t\t\t\tparent = parent.parent;\r\n\t\t\t}\r\n\t\t\treturn parent!;\r\n\t\t} else {\r\n\t\t\tlet parent = shape.parent;\r\n\t\t\twhile( parent instanceof EShapeBase ) {\r\n\t\t\t\tif( this.isParent( first, parent ) ) {\r\n\t\t\t\t\treturn parent;\r\n\t\t\t\t}\r\n\t\t\t\tparent = parent.parent;\r\n\t\t\t}\r\n\t\t\treturn parent!;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toOfParent( shape: EShape, parent: EShape | EShapeContainer ) {\r\n\t\tlet shapeParent = shape.parent;\r\n\t\twhile( shapeParent !== parent && shapeParent instanceof EShapeBase ) {\r\n\t\t\tshape = shapeParent;\r\n\t\t\tshapeParent = shapeParent.parent;\r\n\t\t}\r\n\t\treturn shape;\r\n\t}\r\n\r\n\tstatic isParent( shape: EShape, target: EShape | null ): boolean {\r\n\t\tlet parent = shape.parent;\r\n\t\twhile( parent instanceof EShapeBase ) {\r\n\t\t\tif( parent === target ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tparent = parent.parent;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tstatic toSelected( shape: EShape ): EShape | null {\r\n\t\tlet target: EShape | EShapeContainer | null = shape;\r\n\t\twhile( target instanceof EShapeBase ) {\r\n\t\t\tif( target.selected ) {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t\ttarget = target.parent;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic findChildById( shape: { children: EShape[] }, id: string, recursively?: boolean ): EShape | null {\r\n\t\tconst children = shape.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child.id === id ) {\r\n\t\t\t\treturn child;\r\n\t\t\t}\r\n\t\t\tif( recursively === true ) {\r\n\t\t\t\tconst result = EShapeSearch.findChildById( child, id, recursively );\r\n\t\t\t\tif( result != null ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic findChildByType( shape: { children: EShape[] }, type: EShapeType, recursively?: boolean ): EShape | null {\r\n\t\tconst children = shape.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child.type === type ) {\r\n\t\t\t\treturn child;\r\n\t\t\t}\r\n\t\t\tif( recursively === true ) {\r\n\t\t\t\tconst result = EShapeSearch.findChildByType( child, type, recursively );\r\n\t\t\t\tif( result != null ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic findChild(\r\n\t\tshape: { children: EShape[] }, matcher: ( shape: EShape ) => boolean, recursively?: boolean\r\n\t): EShape | null {\r\n\t\tconst children = shape.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( matcher( child ) ) {\r\n\t\t\t\treturn child;\r\n\t\t\t}\r\n\t\t\tif( recursively === true ) {\r\n\t\t\t\tconst result = EShapeSearch.findChild( child, matcher, recursively );\r\n\t\t\t\tif( result != null ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic findChildrenByType(\r\n\t\tshape: { children: EShape[] }, type: EShapeType, recursively?: boolean, result?: EShape[]\r\n\t): EShape[] {\r\n\t\tresult = result || [];\r\n\t\tconst children = shape.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child.type === type ) {\r\n\t\t\t\tresult.push( child );\r\n\t\t\t}\r\n\t\t\tif( recursively === true ) {\r\n\t\t\t\tEShapeSearch.findChildrenByType( child, type, recursively, result );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic findChildren(\r\n\t\tshape: { children: EShape[] }, matcher: ( shape: EShape ) => boolean, recursively?: boolean, result?: EShape[]\r\n\t): EShape[] {\r\n\t\tresult = result || [];\r\n\t\tconst children = shape.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( matcher( child ) ) {\r\n\t\t\t\tresult.push( child );\r\n\t\t\t}\r\n\t\t\tif( recursively === true ) {\r\n\t\t\t\tEShapeSearch.findChildren( child, matcher, recursively, result );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeContainer } from \"./e-shape-container\";\r\nimport { EShapeSearch } from \"./e-shape-search\";\r\n\r\nexport class EShapeDeleter {\r\n\tstatic delete(\r\n\t\tparent: EShape | EShapeContainer, shapes?: EShape[], generateListOfDetachedShapes?: boolean\r\n\t): EShape[] | null {\r\n\t\tconst children = parent.children;\r\n\t\tconst length = children.length;\r\n\r\n\t\t// Update indices\r\n\t\tfor( let i = 0; i < length; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child.selected ) {\r\n\t\t\t\tchild.index = length + i;\r\n\t\t\t} else {\r\n\t\t\t\tchild.index = i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Sort\r\n\t\tchildren.sort( EShapeSearch.COMPARATOR_INDEX );\r\n\r\n\t\t// Detach\r\n\t\tif( generateListOfDetachedShapes === true ) {\r\n\t\t\tfor( let i = length - 1; 0 <= i; --i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child.selected ) {\r\n\t\t\t\t\tchild.index -= length;\r\n\t\t\t\t\tchild.parent = null;\r\n\t\t\t\t\tchild.selected = false;\r\n\t\t\t\t\tchild.uploaded = undefined;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst size = children.length - (i + 1);\r\n\t\t\t\t\tif( 0 < size ) {\r\n\t\t\t\t\t\tconst result = children.splice( i + 1, size );\r\n\t\t\t\t\t\tif( shapes != null ) {\r\n\t\t\t\t\t\t\tshapes.length = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tparent.onChildTransformChange();\r\n\t\t\t\t\t\tparent.toDirty();\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif( shapes != null ) {\r\n\t\t\t\t\t\t\tshapes.length = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( 0 < children.length ) {\r\n\t\t\t\tconst result = children.splice( 0, children.length );\r\n\t\t\t\tif( shapes != null ) {\r\n\t\t\t\t\tshapes.length = 0;\r\n\t\t\t\t}\r\n\t\t\t\tparent.onChildTransformChange();\r\n\t\t\t\tparent.toDirty();\r\n\t\t\t\treturn result;\r\n\t\t\t} else {\r\n\t\t\t\tif( shapes != null ) {\r\n\t\t\t\t\tshapes.length = 0;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor( let i = length - 1; 0 <= i; --i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child.selected ) {\r\n\t\t\t\t\tchild.parent = null;\r\n\t\t\t\t\tchild.selected = false;\r\n\t\t\t\t\tchild.uploaded = undefined;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchildren.length = i + 1;\r\n\t\t\t\t\tif( shapes != null ) {\r\n\t\t\t\t\t\tshapes.length = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparent.onChildTransformChange();\r\n\t\t\t\t\tparent.toDirty();\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( 0 < children.length ) {\r\n\t\t\t\tchildren.length = 0;\r\n\t\t\t\tif( shapes != null ) {\r\n\t\t\t\t\tshapes.length = 0;\r\n\t\t\t\t}\r\n\t\t\t\tparent.onChildTransformChange();\r\n\t\t\t\tparent.toDirty();\r\n\t\t\t} else {\r\n\t\t\t\tif( shapes != null ) {\r\n\t\t\t\t\tshapes.length = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class EShapeResourceManagerSerialization {\r\n\tprotected resources: string[];\r\n\tprotected resourceToIndex: Map<string, number>;\r\n\r\n\tconstructor() {\r\n\t\tthis.resources = [];\r\n\t\tthis.resourceToIndex = new Map<string, number>();\r\n\t}\r\n\r\n\tadd( resource: string ): number {\r\n\t\tconst resources = this.resources;\r\n\t\tconst resourceToIndex = this.resourceToIndex;\r\n\t\tconst result = resourceToIndex.get( resource );\r\n\t\tif( result != null ) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tconst index = resources.length;\r\n\t\tresources.push( resource );\r\n\t\tresourceToIndex.set( resource, index );\r\n\t\treturn index;\r\n\t}\r\n\r\n\tserialize(): string[] {\r\n\t\treturn this.resources;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShape } from \"./e-shape\";\r\nimport { EShapeRuntime } from \"./e-shape-runtime\";\r\n\r\nexport const EShapeRuntimes: {\r\n\t[ type: number ]: (new ( shape: EShape ) => EShapeRuntime) | undefined\r\n} = {};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DDiagramSerializedSnapGrid } from \"../d-diagram-serialized\";\r\nimport { ESnapperResult } from \"./e-snapper-result\";\r\n\r\nexport class ESnapperGrid extends utils.EventEmitter {\r\n\tprotected _isEnabled: boolean;\r\n\tprotected _size: number;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._isEnabled = true;\r\n\t\tthis._size = 10;\r\n\t}\r\n\r\n\ttoggle(): boolean {\r\n\t\tthis._isEnabled = ! this._isEnabled;\r\n\t\tthis.emit( \"change\", this );\r\n\t\treturn this._isEnabled;\r\n\t}\r\n\r\n\tenable(): void {\r\n\t\tif( this._isEnabled !== true ) {\r\n\t\t\tthis._isEnabled = true;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tdisable(): void {\r\n\t\tif( this._isEnabled !== false ) {\r\n\t\t\tthis._isEnabled = false;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tisEnabled(): boolean {\r\n\t\treturn this._isEnabled;\r\n\t}\r\n\r\n\tget size(): number {\r\n\t\treturn this._size;\r\n\t}\r\n\r\n\tset size( size: number ) {\r\n\t\tif( this._size !== size ) {\r\n\t\t\tthis._size = size;\r\n\t\t\tthis.emit( \"change\", size, this );\r\n\t\t}\r\n\t}\r\n\r\n\tsnap( value: number, result: ESnapperResult ): void {\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tconst size = this._size;\r\n\t\t\tresult.set( value, Math.round( value / size ) * size );\r\n\t\t}\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis._isEnabled = true;\r\n\t\tthis._size = 10;\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\tserialize(): DDiagramSerializedSnapGrid {\r\n\t\treturn [\r\n\t\t\t(this._isEnabled ? 1 : 0),\r\n\t\t\tthis._size\r\n\t\t];\r\n\t}\r\n\r\n\tdeserialize( serialized: DDiagramSerializedSnapGrid ): void {\r\n\t\tif( serialized[ 0 ] !== 0 ) {\r\n\t\t\tthis.enable();\r\n\t\t} else {\r\n\t\t\tthis.disable();\r\n\t\t}\r\n\r\n\t\tthis.size = serialized[ 1 ];\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class ESnapperResult {\r\n\tdistance: number;\r\n\tresult: number;\r\n\tthreshold: number;\r\n\r\n\tconstructor() {\r\n\t\tthis.distance = NaN;\r\n\t\tthis.result = 0;\r\n\t\tthis.threshold = 10;\r\n\t}\r\n\r\n\treset( value: number, scale: number ): void {\r\n\t\tthis.distance = NaN;\r\n\t\tthis.result = value;\r\n\t\tthis.threshold = ( 0.0001 < scale ? 10 / scale : 10 );\r\n\t}\r\n\r\n\tset( value: number, snapped: number ): void {\r\n\t\tconst newDistance = Math.abs( snapped - value );\r\n\t\tif( newDistance <= this.threshold ) {\r\n\t\t\tconst oldDistance = this.distance;\r\n\t\t\tif( oldDistance !== oldDistance || newDistance < oldDistance ) {\r\n\t\t\t\tthis.distance = newDistance;\r\n\t\t\t\tthis.result = snapped;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, IPoint, Matrix, Point, Rectangle, utils } from \"pixi.js\";\r\nimport { DDiagramSerializedSnap } from \"../d-diagram-serialized\";\r\nimport { isNaN } from \"../util/is-nan\";\r\nimport { ESnapperGrid } from \"./e-snapper-grid\";\r\nimport { ESnapperResult } from \"./e-snapper-result\";\r\nimport { ESnapperResultScale } from \"./e-snapper-result-scale\";\r\nimport { ESnapperTarget } from \"./e-snapper-target\";\r\n\r\nconst EPSILON = 0.00001;\r\n\r\nexport interface ESnapperModifier extends DisplayObject {\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport enum ESnapperModifierAnchor {\r\n\tNONE,\r\n\tTOP_LEFT,\r\n\tTOP_CENTER,\r\n\tTOP_RIGHT,\r\n\tMIDDLE_LEFT,\r\n\tMIDDLE_RIGHT,\r\n\tBOTTOM_LEFT,\r\n\tBOTTOM_CENTER,\r\n\tBOTTOM_RIGHT,\r\n\tROTATION\r\n}\r\n\r\nexport interface ESnapperParentCanvas {\r\n\tscale: {\r\n\t\tx: number,\r\n\t\ty: number\r\n\t};\r\n\twidth: number;\r\n\theight: number;\r\n}\r\n\r\nexport interface ESnapperParent {\r\n\tcanvas: ESnapperParentCanvas | null;\r\n}\r\n\r\nexport class ESnapper extends utils.EventEmitter {\r\n\tprotected _points: Point[];\r\n\tprotected _normals: Point[];\r\n\tprotected _lengths: number[];\r\n\r\n\tprotected _workScale: Point;\r\n\tprotected _workScaleResult: ESnapperResultScale;\r\n\r\n\tprotected _workTranslate: Point;\r\n\r\n\tprotected _workSnap: Point;\r\n\tprotected _workSnapRectangle: Rectangle;\r\n\tprotected _workSnapResultX: ESnapperResult;\r\n\tprotected _workSnapResultY: ESnapperResult;\r\n\r\n\tprotected _parent: ESnapperParent;\r\n\r\n\tprotected _isEnabled: boolean;\r\n\r\n\tgrid: ESnapperGrid;\r\n\r\n\ttarget: ESnapperTarget;\r\n\r\n\tconstructor( parent: ESnapperParent ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._points = [\r\n\t\t\tnew Point(), // Top left\r\n\t\t\tnew Point(), // Top right\r\n\t\t\tnew Point(), // Bottom left\r\n\t\t\tnew Point(), // Bottom right\r\n\t\t\tnew Point()  // Center\r\n\t\t];\r\n\r\n\t\tthis._normals = [\r\n\t\t\tnew Point(),\r\n\t\t\tnew Point()\r\n\t\t];\r\n\r\n\t\tthis._lengths = [\r\n\t\t\t1,\r\n\t\t\t1\r\n\t\t];\r\n\r\n\t\tthis._workScale = new Point();\r\n\t\tthis._workSnapResultX = new ESnapperResult();\r\n\t\tthis._workSnapResultY = new ESnapperResult();\r\n\t\tthis._workScaleResult = {\r\n\t\t\tdistance: 0,\r\n\t\t\tscale: new Point()\r\n\t\t};\r\n\r\n\t\tthis._workTranslate = new Point();\r\n\r\n\t\tthis._workSnapRectangle = new Rectangle();\r\n\t\tthis._workSnap = new Point();\r\n\r\n\t\t// Grid\r\n\t\tthis.grid = new ESnapperGrid();\r\n\r\n\t\t// Target\r\n\t\tthis.target = new ESnapperTarget();\r\n\r\n\t\t//\r\n\t\tthis._parent = parent;\r\n\t\tthis._isEnabled = true;\r\n\t}\r\n\r\n\tisEnabled(): boolean {\r\n\t\treturn this._isEnabled;\r\n\t}\r\n\r\n\ttoggle(): boolean {\r\n\t\tthis._isEnabled = ! this._isEnabled;\r\n\t\tthis.emit( \"change\", this );\r\n\t\treturn this._isEnabled;\r\n\t}\r\n\r\n\tenable(): void {\r\n\t\tif( this._isEnabled !== true ) {\r\n\t\t\tthis._isEnabled = true;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tdisable(): void {\r\n\t\tif( this._isEnabled !== false ) {\r\n\t\t\tthis._isEnabled = false;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected prepare( modifier: ESnapperModifier ): void {\r\n\t\tmodifier.updateTransform();\r\n\t\tconst localTransform = modifier.transform.localTransform;\r\n\t\tconst sx = modifier.width;\r\n\t\tconst sy = modifier.height;\r\n\r\n\t\tconst points = this._points;\r\n\t\tpoints[ 0 ].set( 0, 0 );\r\n\t\tpoints[ 1 ].set( sx, 0 );\r\n\t\tpoints[ 2 ].set( sx, sy );\r\n\t\tpoints[ 3 ].set( 0, sy );\r\n\t\tpoints[ 4 ].set( sx * 0.5, sy * 0.5 );\r\n\r\n\t\tlocalTransform.apply( points[ 0 ], points[ 0 ] );\r\n\t\tlocalTransform.apply( points[ 1 ], points[ 1 ] );\r\n\t\tlocalTransform.apply( points[ 2 ], points[ 2 ] );\r\n\t\tlocalTransform.apply( points[ 3 ], points[ 3 ] );\r\n\t\tlocalTransform.apply( points[ 4 ], points[ 4 ] );\r\n\t}\r\n\r\n\tprepareForTranslate( modifier: ESnapperModifier ): void {\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tthis.prepare( modifier );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected snap( point: IPoint, result: IPoint ): IPoint {\r\n\t\tconst px = point.x;\r\n\t\tconst py = point.y;\r\n\t\tconst canvas = this._parent.canvas;\r\n\t\tconst x = this._workSnapResultX;\r\n\t\tconst y = this._workSnapResultY;\r\n\r\n\t\t// Canvas\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst scale = Math.max( canvas.scale.x, canvas.scale.y );\r\n\t\t\tx.reset( px, scale );\r\n\t\t\ty.reset( py, scale );\r\n\t\t\tx.set( px, 0 );\r\n\t\t\tx.set( px, canvas.width );\r\n\t\t\ty.set( py, 0 );\r\n\t\t\ty.set( py, canvas.height );\r\n\t\t} else {\r\n\t\t\tx.reset( px, 1 );\r\n\t\t\ty.reset( py, 1 );\r\n\t\t}\r\n\r\n\t\t// Target\r\n\t\tthis.target.snap( px, py, x, y );\r\n\r\n\t\t// Grid\r\n\t\tthis.grid.snap( px, x );\r\n\t\tthis.grid.snap( py, y );\r\n\r\n\t\t//\r\n\t\tresult.x = ( isNaN( x.distance ) ? NaN : x.result );\r\n\t\tresult.y = ( isNaN( y.distance ) ? NaN : y.result );\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttoSnapped( point: IPoint, result: IPoint ): IPoint {\r\n\t\tconst px = point.x;\r\n\t\tconst py = point.y;\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tthis.snap( point, result );\r\n\t\t\tconst x = result.x;\r\n\t\t\tconst y = result.y;\r\n\t\t\tresult.set(\r\n\t\t\t\tisNaN( x ) ? px : x,\r\n\t\t\t\tisNaN( y ) ? py : y\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tresult.set( px, py );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttoTranslationSnapped( delta: IPoint, result: IPoint ): IPoint {\r\n\t\tconst dx = delta.x;\r\n\t\tconst dy = delta.y;\r\n\t\tlet x = NaN;\r\n\t\tlet y = NaN;\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tconst workTranslate = this._workTranslate;\r\n\t\t\tconst points = this._points;\r\n\t\t\tfor( let i = 0, imax = points.length; i < imax; ++i ) {\r\n\t\t\t\tconst point = points[ i ];\r\n\t\t\t\tworkTranslate.set( point.x + dx, point.y + dy );\r\n\t\t\t\tthis.snap( workTranslate, workTranslate );\r\n\r\n\t\t\t\t// X\r\n\t\t\t\tif( ! isNaN( workTranslate.x ) ) {\r\n\t\t\t\t\tconst newDx = workTranslate.x - point.x;\r\n\t\t\t\t\tif( isNaN( x ) || Math.abs( newDx - dx ) < Math.abs( x - dx ) ) {\r\n\t\t\t\t\t\tx = newDx;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Y\r\n\t\t\t\tif( ! isNaN( workTranslate.y ) ) {\r\n\t\t\t\t\tconst newDy = workTranslate.y - point.y;\r\n\t\t\t\t\tif( isNaN( y ) || Math.abs( newDy - dy ) < Math.abs( y - dy ) ) {\r\n\t\t\t\t\t\ty = newDy;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tresult.x = ( isNaN( x ) ? dx : x );\r\n\t\tresult.y = ( isNaN( y ) ? dy : y );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprepareForRotate( modifier: ESnapperModifier ): void {\r\n\t\t//\r\n\t}\r\n\r\n\tprotected getGridSizeRotation(): number {\r\n\t\treturn 5;\r\n\t}\r\n\r\n\tprotected toRadian( value: number ): number {\r\n\t\treturn value / 180 * Math.PI;\r\n\t}\r\n\r\n\tprotected toDegree( value: number ): number {\r\n\t\treturn value / Math.PI * 180;\r\n\t}\r\n\r\n\ttoRotationSnapped( baseRotation: number, deltaRotation: number ): number {\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tconst gridSize = this.getGridSizeRotation();\r\n\t\t\tconst newRotation = baseRotation + deltaRotation;\r\n\t\t\tconst newRotationDegree = Math.round( this.toDegree( newRotation ) );\r\n\t\t\tconst newRotationDegreeResidual = newRotationDegree % 90;\r\n\t\t\tif( Math.abs( newRotationDegreeResidual ) <= gridSize ) {\r\n\t\t\t\treturn this.toRadian( newRotationDegree - newRotationDegreeResidual ) - baseRotation;\r\n\t\t\t} else {\r\n\t\t\t\tif( 90 - gridSize <= newRotationDegreeResidual ) {\r\n\t\t\t\t\treturn this.toRadian( newRotationDegree + (90 - newRotationDegreeResidual) ) - baseRotation;\r\n\t\t\t\t} else if( newRotationDegreeResidual <= -90 + gridSize ) {\r\n\t\t\t\t\treturn this.toRadian( newRotationDegree - (90 + newRotationDegreeResidual) ) - baseRotation;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn deltaRotation;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn deltaRotation;\r\n\t}\r\n\r\n\tprotected calcNormalizedVector( p0: IPoint, p1: IPoint, result: Point ): number {\r\n\t\tconst dx = p1.x - p0.x;\r\n\t\tconst dy = p1.y - p0.y;\r\n\t\tconst l = Math.sqrt( dx * dx + dy * dy );\r\n\t\tif( EPSILON < l ) {\r\n\t\t\tconst d = 1 / l;\r\n\t\t\tresult.x = dx * d;\r\n\t\t\tresult.y = dy * d;\r\n\t\t} else {\r\n\t\t\tresult.x = 1;\r\n\t\t\tresult.y = 0;\r\n\t\t}\r\n\t\treturn l;\r\n\t}\r\n\r\n\tprepareForScale( modifier: ESnapperModifier, anchor: ESnapperModifierAnchor ): void {\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tthis.prepare( modifier );\r\n\r\n\t\t\tconst points = this._points;\r\n\t\t\tconst normals = this._normals;\r\n\t\t\tconst lengths = this._lengths;\r\n\t\t\tswitch( anchor ) {\r\n\t\t\tcase ESnapperModifierAnchor.TOP_LEFT:\r\n\t\t\t\tlengths[ 0 ] = this.calcNormalizedVector( points[ 1 ], points[ 0 ], normals[ 0 ] );\r\n\t\t\t\tlengths[ 1 ] = this.calcNormalizedVector( points[ 3 ], points[ 0 ], normals[ 1 ] );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.TOP_CENTER:\r\n\t\t\t\tlengths[ 0 ] = this.calcNormalizedVector( points[ 3 ], points[ 0 ], normals[ 0 ] );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.TOP_RIGHT:\r\n\t\t\t\tlengths[ 0 ] = this.calcNormalizedVector( points[ 0 ], points[ 1 ], normals[ 0 ] );\r\n\t\t\t\tlengths[ 1 ] = this.calcNormalizedVector( points[ 2 ], points[ 1 ], normals[ 1 ] );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.MIDDLE_LEFT:\r\n\t\t\t\tlengths[ 0 ] = this.calcNormalizedVector( points[ 1 ], points[ 0 ], normals[ 0 ] );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.NONE:\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.MIDDLE_RIGHT:\r\n\t\t\t\tlengths[ 0 ] = this.calcNormalizedVector( points[ 0 ], points[ 1 ], normals[ 0 ] );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.BOTTOM_LEFT:\r\n\t\t\t\tlengths[ 0 ] = this.calcNormalizedVector( points[ 2 ], points[ 3 ], normals[ 0 ] );\r\n\t\t\t\tlengths[ 1 ] = this.calcNormalizedVector( points[ 0 ], points[ 3 ], normals[ 1 ] );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.BOTTOM_CENTER:\r\n\t\t\t\tlengths[ 0 ] = this.calcNormalizedVector( points[ 0 ], points[ 3 ], normals[ 0 ] );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.BOTTOM_RIGHT:\r\n\t\t\t\tlengths[ 0 ] = this.calcNormalizedVector( points[ 3 ], points[ 2 ], normals[ 0 ] );\r\n\t\t\t\tlengths[ 1 ] = this.calcNormalizedVector( points[ 1 ], points[ 2 ], normals[ 1 ] );\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setScaleSnappedResult(\r\n\t\tdistance: number,\r\n\t\tlength: number,\r\n\t\tmove: number,\r\n\t\taxis: boolean, // true => x axis, false y axis\r\n\t\tresult: ESnapperResultScale\r\n\t): void {\r\n\t\tif( EPSILON < length ) {\r\n\t\t\tif( isNaN( result.distance ) || distance < result.distance ) {\r\n\t\t\t\tresult.distance = distance;\r\n\t\t\t\tconst newScale = 1 + move / length;\r\n\t\t\t\tif( axis ) {\r\n\t\t\t\t\tresult.scale.x = newScale;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult.scale.y = newScale;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected calcScaleSnapped1D(\r\n\t\ttransform: Matrix,\r\n\t\tpoint: Point,\r\n\t\tnormal: IPoint,\r\n\t\tlength: number,\r\n\t\taxis: boolean,\r\n\t\tresult: ESnapperResultScale\r\n\t): void {\r\n\t\tconst work = this._workScale;\r\n\t\ttransform.apply( point, work );\r\n\t\tconst tx = work.x;\r\n\t\tconst ty = work.y;\r\n\t\tthis.snap( work, work );\r\n\t\tconst x = work.x;\r\n\t\tconst y = work.y;\r\n\r\n\t\t// X coordinate\r\n\t\tif( ! isNaN( x ) ) {\r\n\t\t\tconst nx = Math.abs( normal.x );\r\n\t\t\tif( EPSILON < nx ) {\r\n\t\t\t\tconst dx = (x - tx) / normal.x;\r\n\t\t\t\tconst distance = Math.abs( dx );\r\n\t\t\t\tconst mx = (x - point.x) / normal.x;\r\n\t\t\t\tthis.setScaleSnappedResult( distance, length, mx, axis, result );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Y coordinate\r\n\t\tif( ! isNaN( y ) ) {\r\n\t\t\tconst ny = Math.abs( normal.y );\r\n\t\t\tif( EPSILON < ny ) {\r\n\t\t\t\tconst dy = (y - ty) / normal.y;\r\n\t\t\t\tconst distance = Math.abs( dy );\r\n\t\t\t\tconst my = (y - point.y) / normal.y;\r\n\t\t\t\tthis.setScaleSnappedResult( distance, length, my, axis, result );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected calcScaleSnappedX(\r\n\t\ttransform: Matrix,\r\n\t\tpoint: Point,\r\n\t\tnormal: IPoint,\r\n\t\tlength: number,\r\n\t\tresult: ESnapperResultScale\r\n\t): void {\r\n\t\tthis.calcScaleSnapped1D( transform, point, normal, length, true, result );\r\n\t}\r\n\r\n\tprotected calcScaleSnappedY(\r\n\t\ttransform: Matrix,\r\n\t\tpoint: Point,\r\n\t\tnormal: IPoint,\r\n\t\tlength: number,\r\n\t\tresult: ESnapperResultScale\r\n\t): void {\r\n\t\tthis.calcScaleSnapped1D( transform, point, normal, length, false, result );\r\n\t}\r\n\r\n\tcalcScaleSnapped2D(\r\n\t\ttransform: Matrix, point: Point, normals: IPoint[],\r\n\t\tlengths: number[], result: ESnapperResultScale\r\n\t): void {\r\n\t\tconst work = this._workScale;\r\n\t\ttransform.apply( point, work );\r\n\t\tconst tx = work.x;\r\n\t\tconst ty = work.y;\r\n\r\n\t\tthis.snap( work, work );\r\n\t\tlet x = work.x;\r\n\t\tlet y = work.y;\r\n\t\tif( isNaN( x ) ) {\r\n\t\t\tif( isNaN( y ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tx = tx;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( isNaN( y ) ) {\r\n\t\t\t\ty = ty;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// (x, y) = (tx, ty) + normalA * a + normalB * b\r\n\t\t// dx = x - tx\r\n\t\t// dy = y - ty\r\n\t\t// V = ( a, b )^T\r\n\t\t// D = ( dx, dy )^T\r\n\t\t// A = | normalA.x normalB.x |\r\n\t\t//     | normalA.y normalB.y |\r\n\t\t// A V = D\r\n\t\t// det A = normalA.x * normalB.y - normalB.x * normalA.y\r\n\t\t// A^-1 = |  normalB.y -normalB.x | / det A\r\n\t\t//        | -normalA.y  normalA.x |\r\n\t\tconst detA = normals[ 0 ].x * normals[ 1 ].y - normals[ 1 ].x * normals[ 0 ].y;\r\n\t\tif( EPSILON < Math.abs( detA ) ) {\r\n\t\t\tconst dx = x - tx;\r\n\t\t\tconst dy = y - ty;\r\n\t\t\tconst distance = Math.abs( dx * dx + dy * dy );\r\n\t\t\tif( isNaN( result.distance ) || distance < result.distance ) {\r\n\t\t\t\tresult.distance = distance;\r\n\t\t\t\tconst mdx = x - point.x;\r\n\t\t\t\tconst mdy = y - point.y;\r\n\t\t\t\tconst mx = ( +normals[ 1 ].y * mdx - normals[ 1 ].x * mdy ) / detA;\r\n\t\t\t\tconst my = ( -normals[ 0 ].y * mdx + normals[ 0 ].x * mdy ) / detA;\r\n\t\t\t\tresult.scale.set(\r\n\t\t\t\t\t1 + mx / lengths[ 0 ],\r\n\t\t\t\t\t1 + my / lengths[ 1 ]\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected calcScaleSnappedXY(\r\n\t\ttransform: Matrix,\r\n\t\tpointO: Point,\r\n\t\tpointX: Point,\r\n\t\tpointY: Point,\r\n\t\tnormals: IPoint[],\r\n\t\tlengths: number[],\r\n\t\tresult: ESnapperResultScale\r\n\t): void {\r\n\t\tthis.calcScaleSnapped2D( transform, pointO, normals, lengths, result );\r\n\t\tthis.calcScaleSnappedX( transform, pointY, normals[ 0 ], lengths[ 0 ], result );\r\n\t\tthis.calcScaleSnappedY( transform, pointX, normals[ 1 ], lengths[ 1 ], result );\r\n\t}\r\n\r\n\ttoScaleSnapped(\r\n\t\ttransform: Matrix, anchor: ESnapperModifierAnchor, keepRatio: boolean, scale: IPoint\r\n\t): boolean {\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tconst points = this._points;\r\n\t\t\tconst normals = this._normals;\r\n\t\t\tconst lengths = this._lengths;\r\n\t\t\tconst work = this._workScaleResult;\r\n\t\t\twork.distance = NaN;\r\n\t\t\twork.scale.set( scale.x, scale.y );\r\n\r\n\t\t\tswitch( anchor ) {\r\n\t\t\tcase ESnapperModifierAnchor.TOP_LEFT:\r\n\t\t\t\tthis.calcScaleSnappedXY( transform, points[ 0 ], points[ 1 ], points[ 3 ], normals, lengths, work );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.TOP_CENTER:\r\n\t\t\t\tthis.calcScaleSnappedY( transform, points[ 0 ], normals[ 0 ], lengths[ 0 ], work );\r\n\t\t\t\tthis.calcScaleSnappedY( transform, points[ 1 ], normals[ 0 ], lengths[ 0 ], work );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.TOP_RIGHT:\r\n\t\t\t\tthis.calcScaleSnappedXY( transform, points[ 1 ], points[ 0 ], points[ 2 ], normals, lengths, work );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.MIDDLE_LEFT:\r\n\t\t\t\tthis.calcScaleSnappedX( transform, points[ 0 ], normals[ 0 ], lengths[ 0 ], work );\r\n\t\t\t\tthis.calcScaleSnappedX( transform, points[ 3 ], normals[ 0 ], lengths[ 0 ], work );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.NONE:\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.MIDDLE_RIGHT:\r\n\t\t\t\tthis.calcScaleSnappedX( transform, points[ 1 ], normals[ 0 ], lengths[ 0 ], work );\r\n\t\t\t\tthis.calcScaleSnappedX( transform, points[ 2 ], normals[ 0 ], lengths[ 0 ], work );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.BOTTOM_LEFT:\r\n\t\t\t\tthis.calcScaleSnappedXY( transform, points[ 3 ], points[ 2 ], points[ 0 ], normals, lengths, work );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.BOTTOM_CENTER:\r\n\t\t\t\tthis.calcScaleSnappedY( transform, points[ 2 ], normals[ 0 ], lengths[ 0 ], work );\r\n\t\t\t\tthis.calcScaleSnappedY( transform, points[ 3 ], normals[ 0 ], lengths[ 0 ], work );\r\n\t\t\t\tbreak;\r\n\t\t\tcase ESnapperModifierAnchor.BOTTOM_RIGHT:\r\n\t\t\t\tthis.calcScaleSnappedXY( transform, points[ 2 ], points[ 3 ], points[ 1 ], normals, lengths, work );\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif( ! isNaN( work.distance ) ) {\r\n\t\t\t\tscale.copyFrom( work.scale );\r\n\t\t\t\tif( keepRatio ) {\r\n\t\t\t\t\tswitch( anchor ) {\r\n\t\t\t\t\tcase ESnapperModifierAnchor.TOP_LEFT:\r\n\t\t\t\t\tcase ESnapperModifierAnchor.TOP_RIGHT:\r\n\t\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_LEFT:\r\n\t\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_RIGHT:\r\n\t\t\t\t\t\tscale.x = scale.y = Math.max( scale.x, scale.y );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase ESnapperModifierAnchor.TOP_CENTER:\r\n\t\t\t\t\tcase ESnapperModifierAnchor.BOTTOM_CENTER:\r\n\t\t\t\t\t\tscale.x = scale.y;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase ESnapperModifierAnchor.MIDDLE_LEFT:\r\n\t\t\t\t\tcase ESnapperModifierAnchor.MIDDLE_RIGHT:\r\n\t\t\t\t\t\tscale.y = scale.x;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase ESnapperModifierAnchor.NONE:\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis.enable();\r\n\t\tthis.target.reset();\r\n\t\tthis.grid.reset();\r\n\t}\r\n\r\n\tserialize(): DDiagramSerializedSnap {\r\n\t\treturn [\r\n\t\t\t(this._isEnabled ? 1 : 0),\r\n\t\t\tthis.target.serialize(),\r\n\t\t\tthis.grid.serialize()\r\n\t\t];\r\n\t}\r\n\r\n\tdeserialize( serialized: DDiagramSerializedSnap ): void {\r\n\t\tif( serialized[ 0 ] !== 0 ) {\r\n\t\t\tthis.enable();\r\n\t\t} else {\r\n\t\t\tthis.disable();\r\n\t\t}\r\n\t\tthis.target.deserialize( serialized[ 1 ] );\r\n\t\tthis.grid.deserialize( serialized[ 2 ] );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DDiagramSerializedSnapTarget, DDiagramSerializedSnapTargetValue } from \"../d-diagram-serialized\";\r\nimport { ESnapperResult } from \"./e-snapper-result\";\r\nimport { ESnapperTargetValue, ESnapperTargetValueType } from \"./e-snapper-target-value\";\r\n\r\nexport class ESnapperTarget extends utils.EventEmitter {\r\n\tvalues: ESnapperTargetValue[];\r\n\tprotected _isVisible: boolean;\r\n\tprotected _isEnabled: boolean;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.values = [];\r\n\t\tthis._isVisible = true;\r\n\t\tthis._isEnabled = true;\r\n\t}\r\n\r\n\tisEnabled(): boolean {\r\n\t\treturn this._isEnabled;\r\n\t}\r\n\r\n\ttoggle(): boolean {\r\n\t\tthis._isEnabled = ! this._isEnabled;\r\n\t\tthis.emit( \"change\", this );\r\n\t\treturn this._isEnabled;\r\n\t}\r\n\r\n\tenable(): void {\r\n\t\tif( this._isEnabled !== true ) {\r\n\t\t\tthis._isEnabled = true;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tdisable(): void {\r\n\t\tif( this._isEnabled !== false ) {\r\n\t\t\tthis._isEnabled = false;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tadd( target: ESnapperTargetValue, index?: number ): void {\r\n\t\tif( index != null ) {\r\n\t\t\tthis.values.splice( index, 0, target );\r\n\t\t} else {\r\n\t\t\tthis.values.push( target );\r\n\t\t}\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\tremove( index: number ): void {\r\n\t\tconst values = this.values;\r\n\t\tif( 0 <= index && index < values.length ) {\r\n\t\t\tvalues.splice( index, 1 );\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this.values.length;\r\n\t}\r\n\r\n\treplace( index: number, value: ESnapperTargetValue ): ESnapperTargetValue | null {\r\n\t\tconst values = this.values;\r\n\t\tif( 0 <= index && index < values.length ) {\r\n\t\t\tconst result = values[ index ];\r\n\t\t\tvalues[ index ] = value;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tswap( indexA: number, indexB: number ): void {\r\n\t\tif( indexA !== indexB ) {\r\n\t\t\tconst values = this.values;\r\n\t\t\tconst valueA = values[ indexA ];\r\n\t\t\tvalues[ indexA ] = values[ indexB ];\r\n\t\t\tvalues[ indexB ] = valueA;\r\n\t\t}\r\n\t}\r\n\r\n\tget visible(): boolean {\r\n\t\treturn this._isVisible;\r\n\t}\r\n\r\n\tset visible( visible: boolean ) {\r\n\t\tif( this._isVisible !== visible ) {\r\n\t\t\tthis._isVisible = visible;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tsnap( px: number, py: number, x: ESnapperResult, y: ESnapperResult ): void {\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tconst values = this.values;\r\n\t\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\t\tconst value = values[ i ];\r\n\t\t\t\tif( value.type === ESnapperTargetValueType.VERTICAL ) {\r\n\t\t\t\t\tx.set( px, value.position );\r\n\t\t\t\t} else {\r\n\t\t\t\t\ty.set( py, value.position );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis._isEnabled = true;\r\n\t\tthis._isVisible = true;\r\n\t\tthis.values.length = 0;\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\tserialize(): DDiagramSerializedSnapTarget {\r\n\t\tconst targets: DDiagramSerializedSnapTargetValue[] = [];\r\n\t\tconst values = this.values;\r\n\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\ttargets.push( values[ i ].serialize() );\r\n\t\t}\r\n\t\treturn [\r\n\t\t\t(this._isEnabled ? 1 : 0),\r\n\t\t\t(this._isVisible ? 1 : 0),\r\n\t\t\ttargets\r\n\t\t];\r\n\t}\r\n\r\n\tdeserialize( serialized: DDiagramSerializedSnapTarget ): void {\r\n\t\t// Availability\r\n\t\tthis._isEnabled = ( serialized[ 0 ] !== 0 );\r\n\r\n\t\t// Visibility\r\n\t\tthis._isVisible = ( serialized[ 1 ] !== 0 );\r\n\r\n\t\t// Values\r\n\t\tconst sources = serialized[ 2 ];\r\n\t\tconst values = this.values;\r\n\t\tvalues.length = 0;\r\n\t\tfor( let i = 0, imax = sources.length; i < imax; ++i ) {\r\n\t\t\tconst source = sources[ i ];\r\n\t\t\tvalues.push( new ESnapperTargetValue( source[ 0 ], source[ 1 ] ) );\r\n\t\t}\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DCommandFlag {\r\n\tNONE = 0,\r\n\r\n\t/**\r\n\t * Commands with a `UNSTORABLE` flag will not be queued to the `done` queue.\r\n\t */\r\n\tUNSTORABLE = 1,\r\n\r\n\t/**\r\n\t * Commands with a `CLEAR` flag clears the command queue.\r\n\t */\r\n\tCLEAR = 2\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DAnimation, DAnimationOnEnd, DAnimationOnTime, DAnimationOptions } from \"./d-animation\";\r\n\r\nexport class DAnimationEmpty<TARGET = unknown> extends utils.EventEmitter implements DAnimation<TARGET> {\r\n\tprotected _reverse: boolean;\r\n\tprotected _onTime: DAnimationOnTime<TARGET> | undefined;\r\n\tprotected _onStart: DAnimationOnEnd<TARGET> | undefined;\r\n\tprotected _onEnd: DAnimationOnEnd<TARGET> | undefined;\r\n\tprotected _target: TARGET | null;\r\n\tprotected _isStarted: boolean;\r\n\r\n\tconstructor( options?: DAnimationOptions<TARGET> ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._target = (options && options.target != null ? options.target : null);\r\n\t\tthis._reverse = false;\r\n\t\tthis._isStarted = false;\r\n\t\tthis._onTime = options && options.onTime;\r\n\t\tthis._onStart = options && options.onStart;\r\n\t\tthis._onEnd = options && options.onEnd;\r\n\t}\r\n\r\n\tget target(): TARGET | null {\r\n\t\treturn this._target;\r\n\t}\r\n\r\n\tset target( target: TARGET | null ) {\r\n\t\tthis._target = target;\r\n\t}\r\n\r\n\tget duration(): number {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tset duration( duration: number ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tstart( reverse: boolean = false ): void {\r\n\t\tthis.stop();\r\n\t\tthis._isStarted = true;\r\n\t\tthis._reverse = reverse;\r\n\r\n\t\t// onStart\r\n\t\tthis.onStart( reverse );\r\n\t\tif( ! this._isStarted ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// onTime\r\n\t\tthis.onTime( reverse ? 1 : 0, reverse, 0 );\r\n\t\tif( ! this._isStarted ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.onTime( reverse ? 0 : 1, reverse, 0 );\r\n\t\tif( this._isStarted ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// OnEnd\r\n\t\tthis.onEnd( reverse );\r\n\t}\r\n\r\n\tprotected onStart( isReverse: boolean ): void {\r\n\t\tconst onStart = this._onStart;\r\n\t\tif( onStart != null ) {\r\n\t\t\tonStart( isReverse, this );\r\n\t\t}\r\n\t\tthis.emit( \"start\", isReverse, this );\r\n\t}\r\n\r\n\tprotected onTime( time: number, isReverse: boolean, elapsedTime: number ): void {\r\n\t\tconst onTime = this._onTime;\r\n\t\tif( onTime != null ) {\r\n\t\t\tonTime( time, isReverse, elapsedTime, this );\r\n\t\t}\r\n\t\tthis.emit( \"time\", time, isReverse, elapsedTime, this );\r\n\t}\r\n\r\n\tprotected onEnd( isReverse: boolean ): void {\r\n\t\tconst onEnd = this._onEnd;\r\n\t\tif( onEnd != null ) {\r\n\t\t\tonEnd( isReverse, this );\r\n\t\t}\r\n\t\tthis.emit( \"end\", isReverse, this );\r\n\t}\r\n\r\n\tisStarted(): boolean {\r\n\t\treturn this._isStarted;\r\n\t}\r\n\r\n\tisReverse(): boolean {\r\n\t\treturn this._reverse;\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tthis._isStarted = false;\r\n\t}\r\n\r\n\tend(): void {\r\n\t\tconst isStarted = this._isStarted;\r\n\t\tif( isStarted ) {\r\n\t\t\tthis._isStarted = false;\r\n\r\n\t\t\t// OnTime\r\n\t\t\tconst reverse = this._reverse;\r\n\t\t\tconst time = ( reverse ? 0 : 1 );\r\n\t\t\tthis.onTime( time, reverse, 0 );\r\n\r\n\t\t\t// OnEnd\r\n\t\t\tthis.onEnd( reverse );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DAnimationOptions } from \"./d-animation\";\r\nimport { DAnimationBase } from \"./d-animation-base\";\r\nimport { DApplicationLayerLike } from \"./d-application-layer-like\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase } from \"./d-base\";\r\n\r\nexport interface DAnimationFadeInShiftOptions {\r\n\tx?: number | null;\r\n\ty?: number | null;\r\n}\r\n\r\nexport interface DAnimationFadeInOptions<TARGET> extends DAnimationOptions<TARGET> {\r\n\tshift?: DAnimationFadeInShiftOptions;\r\n}\r\n\r\nexport class DAnimationFadeIn<TARGET extends DBase = DBase> extends DAnimationBase<TARGET> {\r\n\tprotected _shiftX: number;\r\n\tprotected _shiftY: number;\r\n\r\n\tprotected _storedX: number = 0;\r\n\tprotected _storedY: number = 0;\r\n\tprotected _storedAlpha: number = 0;\r\n\tprotected _storedTime: number = 0;\r\n\tprotected _storedTarget: TARGET | null = null;\r\n\r\n\tprotected _layer: DApplicationLayerLike | null = null;\r\n\r\n\tprotected _onPrerenderBound: () => void;\r\n\tprotected _onPostrenderBound: () => void;\r\n\r\n\tconstructor( options?: DAnimationFadeInOptions<TARGET> ) {\r\n\t\tsuper( options );\r\n\r\n\t\t// Shifts\r\n\t\tif( options != null && options.shift != null ) {\r\n\t\t\tconst shift = options.shift;\r\n\t\t\tthis._shiftX = (shift.x != null ? shift.x : 0);\r\n\t\t\tthis._shiftY = (shift.y != null ? shift.y : 15);\r\n\t\t} else {\r\n\t\t\tthis._shiftX = 0;\r\n\t\t\tthis._shiftY = 15;\r\n\t\t}\r\n\r\n\t\tthis._onPrerenderBound = () => {\r\n\t\t\tthis.onPrerender();\r\n\t\t};\r\n\r\n\t\tthis._onPostrenderBound = () => {\r\n\t\t\tthis.onPostrender();\r\n\t\t};\r\n\t}\r\n\r\n\tstop(): void {\r\n\t\tthis._storedTime = 0;\r\n\t\tthis.removeEventListeners();\r\n\t\tsuper.stop();\r\n\t}\r\n\r\n\tprotected addEventListeners( target: TARGET ): void {\r\n\t\tconst layer = DApplications.getLayer( target );\r\n\t\tif( layer ) {\r\n\t\t\tthis._layer = layer;\r\n\t\t\tconst renderer = layer.renderer;\r\n\t\t\trenderer.on( \"prerender\", this._onPrerenderBound );\r\n\t\t\trenderer.on( \"postrender\", this._onPostrenderBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected removeEventListeners(): void {\r\n\t\tconst layer = this._layer;\r\n\t\tif( layer ) {\r\n\t\t\tthis._layer = null;\r\n\t\t\tconst renderer = layer.renderer;\r\n\t\t\trenderer.off( \"prerender\", this._onPrerenderBound );\r\n\t\t\trenderer.off( \"postrender\", this._onPostrenderBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onStart( isReverse: boolean ): void {\r\n\t\tconst target = this._storedTarget = this._target;\r\n\t\tif( target != null ) {\r\n\t\t\tthis._storedTime = 0;\r\n\t\t\tthis.removeEventListeners();\r\n\t\t\tthis.addEventListeners( target );\r\n\t\t\tif( ! isReverse ) {\r\n\t\t\t\ttarget.visible = true;\r\n\t\t\t}\r\n\t\t\tsuper.onStart( isReverse );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onTime( time: number, isReverse: boolean, elapsedTime: number ): void {\r\n\t\tconst target = this._storedTarget;\r\n\t\tif( target != null ) {\r\n\t\t\tconst layer = this._layer;\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.disallowUpdate();\r\n\t\t\t\tthis._storedTime = time;\r\n\t\t\t\tsuper.onTime( time, isReverse, elapsedTime );\r\n\t\t\t\tlayer.allowUpdate();\r\n\t\t\t\tlayer.render();\r\n\t\t\t} else {\r\n\t\t\t\tthis._storedTime = time;\r\n\t\t\t\tsuper.onTime( time, isReverse, elapsedTime );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onEnd( isReverse: boolean ): void {\r\n\t\tconst target = this._storedTarget;\r\n\t\tif( target != null ) {\r\n\t\t\tthis.removeEventListeners();\r\n\t\t\tif( isReverse ) {\r\n\t\t\t\ttarget.visible = false;\r\n\t\t\t}\r\n\t\t\tsuper.onEnd( isReverse );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onPrerender(): void {\r\n\t\tconst target = this._storedTarget;\r\n\t\tif( target != null ) {\r\n\t\t\tconst storedTime = this._storedTime;\r\n\r\n\t\t\t// Position\r\n\t\t\tconst position = target.unsafe.position;\r\n\t\t\tthis._storedX = position.x;\r\n\t\t\tthis._storedY = position.y;\r\n\t\t\tposition.set(\r\n\t\t\t\tposition.x - this._shiftX * ( 1 - storedTime ),\r\n\t\t\t\tposition.y - this._shiftY * ( 1 - storedTime )\r\n\t\t\t);\r\n\r\n\t\t\t// Alpha\r\n\t\t\tthis._storedAlpha = target.alpha;\r\n\t\t\ttarget.alpha = storedTime;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onPostrender(): void {\r\n\t\tconst target = this._storedTarget;\r\n\t\tif( target != null ) {\r\n\t\t\t// Position\r\n\t\t\tconst position = target.unsafe.position;\r\n\t\t\tposition.set(\r\n\t\t\t\tthis._storedX,\r\n\t\t\t\tthis._storedY\r\n\t\t\t);\r\n\r\n\t\t\t// Alpha\r\n\t\t\ttarget.alpha = this._storedAlpha;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DThemeBase } from \"./d-base\";\r\nimport { DPadding } from \"./d-padding\";\r\n\r\nexport class DApplicationPadding implements DPadding {\r\n\tleft: number;\r\n\ttop: number;\r\n\tright: number;\r\n\tbottom: number;\r\n\r\n\tconstructor( top: number, right: number, bottom: number, left: number ) {\r\n\t\tthis.left = left;\r\n\t\tthis.top = top;\r\n\t\tthis.right = right;\r\n\t\tthis.bottom = bottom;\r\n\t}\r\n\r\n\tgetTheme(): DThemeBase {\r\n\t\tthrow new Error( \"Not supported\" );\r\n\t}\r\n\r\n\tsetTheme( theme: DThemeBase ): void {\r\n\t\tthrow new Error( \"Not supported\" );\r\n\t}\r\n\r\n\tgetTop(): number {\r\n\t\treturn this.left;\r\n\t}\r\n\r\n\tgetRight(): number {\r\n\t\treturn this.right;\r\n\t}\r\n\r\n\tgetBottom(): number {\r\n\t\treturn this.bottom;\r\n\t}\r\n\r\n\tgetLeft(): number {\r\n\t\treturn this.left;\r\n\t}\r\n\r\n\tset( padding: number ): void;\r\n\tset( topAndBottom: number, leftAndRight: number ): void;\r\n\tset( top: number, leftAndRight: number, bottom: number ): void;\r\n\tset( top: number, right?: number, bottom?: number, left?: number ): void {\r\n\t\tif( right == null ) {\r\n\t\t\tthis.top = top;\r\n\t\t\tthis.right = top;\r\n\t\t\tthis.bottom = top;\r\n\t\t\tthis.left = top;\r\n\t\t} else if( bottom == null ) {\r\n\t\t\tthis.top = top;\r\n\t\t\tthis.right = right;\r\n\t\t\tthis.bottom = top;\r\n\t\t\tthis.left = right;\r\n\t\t} else if( left == null ) {\r\n\t\t\tthis.top = top;\r\n\t\t\tthis.right = right;\r\n\t\t\tthis.bottom = bottom;\r\n\t\t\tthis.left = right;\r\n\t\t} else {\r\n\t\t\tthis.top = top;\r\n\t\t\tthis.right = right;\r\n\t\t\tthis.bottom = bottom;\r\n\t\t\tthis.left = left;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DApplicationPadding } from \"./d-application-padding\";\r\nimport { DPadding, DPaddingLike } from \"./d-padding\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\n/**\r\n * PixiJS options\r\n */\r\ninterface PixiApplicationOptions {\r\n\twidth: number;\r\n\theight: number;\r\n\tautoStart: boolean;\r\n\tbackgroundColor: number;\r\n\ttransparent: boolean;\r\n\tresolution: number;\r\n\tantialias: boolean;\r\n}\r\n\r\ninterface DApplicationLayerBackgroundOptions {\r\n\tcolor?: number | null;\r\n}\r\n\r\ninterface DApplicationLayerOptionsOptions {\r\n\troot: HTMLElement;\r\n\tpadding?: number | DPaddingLike;\r\n\twidth?: number;\r\n\theight?: number;\r\n\tbackground?: DApplicationLayerBackgroundOptions;\r\n\tresolution: number;\r\n\tantialias?: boolean;\r\n\r\n\t/**\r\n\t * Sets to true if a layer is a overlay layer.\r\n\t */\r\n\toverlay: boolean;\r\n}\r\n\r\n/**\r\n * DApplicationLayer options\r\n */\r\nexport class DApplicationLayerOptions {\r\n\tprivate _root: HTMLElement;\r\n\tprivate _pixi: PixiApplicationOptions;\r\n\tprivate _padding: DPadding;\r\n\tprivate _overlay: boolean;\r\n\r\n\tconstructor( options: DApplicationLayerOptionsOptions ) {\r\n\t\t// Root\r\n\t\tconst root = this._root = options.root;\r\n\r\n\t\t// Overlay mode or not\r\n\t\tthis._overlay = options.overlay;\r\n\r\n\t\t// Padding\r\n\t\tconst padding = options && options.padding;\r\n\t\tif( isNumber( padding ) ) {\r\n\t\t\tthis._padding = new DApplicationPadding( padding, padding, padding, padding );\r\n\t\t} else if( padding != null ) {\r\n\t\t\tthis._padding = new DApplicationPadding(\r\n\t\t\t\tpadding.top || 0,\r\n\t\t\t\tpadding.right || 0,\r\n\t\t\t\tpadding.bottom || 0,\r\n\t\t\t\tpadding.left || 0\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tthis._padding = new DApplicationPadding( 6, 6, 6, 6 );\r\n\t\t}\r\n\r\n\t\t// Width & height\r\n\t\tlet width = 100;\r\n\t\tlet height = 100;\r\n\t\tif( options ) {\r\n\t\t\tif( options.width != null ) {\r\n\t\t\t\twidth = options.width;\r\n\t\t\t\tif( options.height != null ) {\r\n\t\t\t\t\theight = options.height;\r\n\t\t\t\t} else {\r\n\t\t\t\t\theight = root.getBoundingClientRect().height;\r\n\t\t\t\t}\r\n\t\t\t} else if( options.height != null ) {\r\n\t\t\t\twidth = root.getBoundingClientRect().width;\r\n\t\t\t\theight = options.height;\r\n\t\t\t} else {\r\n\t\t\t\tconst bbox = root.getBoundingClientRect();\r\n\t\t\t\twidth = bbox.width;\r\n\t\t\t\theight = bbox.height;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst bbox = root.getBoundingClientRect();\r\n\t\t\twidth = bbox.width;\r\n\t\t\theight = bbox.height;\r\n\t\t}\r\n\r\n\t\t// Background color\r\n\t\tconst background = options && options.background;\r\n\t\tlet backgroundColor = 0;\r\n\t\tlet transparent = true;\r\n\t\tif( background != null ) {\r\n\t\t\tconst color = background.color;\r\n\t\t\tif( color != null ) {\r\n\t\t\t\tbackgroundColor = color;\r\n\t\t\t\ttransparent = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Resolution\r\n\t\tconst resolution = options.resolution;\r\n\r\n\t\t// Antialias\r\n\t\tconst antialias = ( options && options.antialias != null ? options.antialias : false );\r\n\r\n\t\t// Pixi\r\n\t\tthis._pixi = {\r\n\t\t\twidth,\r\n\t\t\theight,\r\n\t\t\tautoStart: false,\r\n\t\t\tbackgroundColor,\r\n\t\t\ttransparent,\r\n\t\t\tresolution,\r\n\t\t\tantialias\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a root element.\r\n\t * `HTMLCanvasElement` and other DOM elements are created in this element.\r\n\t * The default root element is `document.body`.\r\n\t */\r\n\tgetRootElement(): HTMLElement {\r\n\t\treturn this._root;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a root element and updates the canvas width and height\r\n\t * if `updateWidthAndHeight` is not false.\r\n\t *\r\n\t * @param root new root element\r\n\t * @param updateWidthAndHeight false to preserve the canvas width / height\r\n\t */\r\n\tsetRootElement( root: HTMLElement, updateWidthAndHeight?: boolean ): this {\r\n\t\tif( this._root !== root ) {\r\n\t\t\tthis._root = root;\r\n\t\t\tif( updateWidthAndHeight !== false ) {\r\n\t\t\t\tconst bbox = root.getBoundingClientRect();\r\n\t\t\t\tconst pixi = this._pixi;\r\n\t\t\t\tpixi.width = bbox.width;\r\n\t\t\t\tpixi.height = bbox.height;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a canvas width.\r\n\t */\r\n\tgetWidth(): number {\r\n\t\treturn this._pixi.width;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a canvas width.\r\n\t *\r\n\t * @param width new canvas width\r\n\t */\r\n\tsetWidth( width: number ): this {\r\n\t\tthis._pixi.width = width;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a canvas height.\r\n\t */\r\n\tgetHeight(): number {\r\n\t\treturn this._pixi.height;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a canvas height.\r\n\t *\r\n\t * @param height new canvas height\r\n\t */\r\n\tsetHeight( height: number ): this {\r\n\t\tthis._pixi.height = height;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns padding sizes.\r\n\t * The default padding size is 6.\r\n\t */\r\n\tgetPadding(): DPadding {\r\n\t\treturn this._padding;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets padding sizes.\r\n\t *\r\n\t * @param left new left padding\r\n\t * @param top new top padding\r\n\t * @param right new right padding\r\n\t * @param bottom new bottom padding\r\n\t * @asse getPadding\r\n\t */\r\n\tsetPadding( left: number, top: number, right: number, bottom: number ): this {\r\n\t\tconst padding = this._padding;\r\n\t\tpadding.left = left;\r\n\t\tpadding.top = top;\r\n\t\tpadding.right = right;\r\n\t\tpadding.bottom = bottom;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a background color.\r\n\t */\r\n\tgetBackgroundColor(): number {\r\n\t\treturn this._pixi.backgroundColor;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a background color.\r\n\t *\r\n\t * @param color new background color\r\n\t */\r\n\tsetBackgroundColor( color: number ): this {\r\n\t\tthis._pixi.backgroundColor = color;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an antialias setting.\r\n\t * The default antialias setting is false.\r\n\t */\r\n\tgetAntialias(): boolean {\r\n\t\treturn this._pixi.antialias;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets an antialias setting.\r\n\t *\r\n\t * @param antialias new antialias setting\r\n\t */\r\n\tsetAntialias( antialias: boolean ): this {\r\n\t\tthis._pixi.antialias = antialias;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if a layer is supposed to be an overlay layer.\r\n\t */\r\n\tisOverlay(): boolean {\r\n\t\treturn this._overlay;\r\n\t}\r\n\r\n\tgetPixiApplicationOptions(): PixiApplicationOptions {\r\n\t\treturn this._pixi;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport {\r\n\tDControllerFocus, DFocusable, DFocusableContainer, DFocusableMightBe\r\n} from \"./d-controller-focus\";\r\n\r\nconst isFocusable = ( target: any ): target is DFocusable => {\r\n\treturn ( target != null && (\"setState\" in target) );\r\n};\r\n\r\nconst isFocusableContainer = ( target: any ): target is DFocusableContainer => {\r\n\treturn ( target != null && \"children\" in target );\r\n};\r\n\r\nexport class DControllerDefaultFocus implements DControllerFocus {\r\n\tprivate _focused: DFocusable | null = null;\r\n\r\n\tsetFocused( focusable: DFocusable | null, isFocused: boolean, select: boolean ): DFocusable | null {\r\n\t\tif( isFocused ) {\r\n\t\t\tconst previous = this._focused;\r\n\t\t\tif( previous !== focusable ) {\r\n\t\t\t\tif( previous != null ) {\r\n\t\t\t\t\tprevious.setState( DBaseState.FOCUSED, false );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._focused = focusable;\r\n\t\t\t\tif( focusable != null && this.isFocusable( focusable ) ) {\r\n\t\t\t\t\tfocusable.setState( DBaseState.FOCUSED, true );\r\n\t\t\t\t}\r\n\t\t\t\treturn previous;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( focusable != null && this._focused === focusable ) {\r\n\t\t\t\tthis._focused = null;\r\n\t\t\t\tfocusable.setState( DBaseState.FOCUSED, false );\r\n\t\t\t\treturn focusable;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetFocused(): DFocusable | null {\r\n\t\treturn this._focused;\r\n\t}\r\n\r\n\tfindFocusableParent( mightBeFocusable: DFocusableMightBe | null ): DFocusable | null {\r\n\t\tlet current: DFocusableMightBe | DFocusableContainer | null = mightBeFocusable;\r\n\t\twhile( current != null ) {\r\n\t\t\tif( this.isFocusable( current ) ) {\r\n\t\t\t\treturn current;\r\n\t\t\t} else {\r\n\t\t\t\tcurrent = current.parent;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected isFocusable( target: unknown ): target is DFocusable {\r\n\t\treturn (\r\n\t\t\tisFocusable( target ) &&\r\n\t\t\t! target.hasState( DBaseState.DISABLED | DBaseState.UNFOCUSABLE ) &&\r\n\t\t\ttarget.visible\r\n\t\t);\r\n\t}\r\n\r\n\tprotected isFocusRoot( target: unknown ): target is DFocusable {\r\n\t\treturn (\r\n\t\t\tisFocusable( target ) &&\r\n\t\t\ttarget.hasState( DBaseState.FOCUS_ROOT ) &&\r\n\t\t\ttarget.visible\r\n\t\t);\r\n\t}\r\n\r\n\tfindFocusable(\r\n\t\ttarget: DFocusableMightBe, includesTarget: boolean, includesTargetChildren: boolean, direction: boolean\r\n\t): DFocusable | null {\r\n\t\tif( direction ) {\r\n\t\t\tconst result = this.findFocusableNext( target, includesTarget, includesTargetChildren );\r\n\t\t\tif( result != null ) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tconst parent = target.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tconst children = parent.children;\r\n\t\t\t\tconst index = children.indexOf( target );\r\n\t\t\t\tif( 0 <= index ) {\r\n\t\t\t\t\t// Siblings\r\n\t\t\t\t\tfor( let i = index + 1, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst found = this.findFocusableNext( children[ i ], true, true );\r\n\t\t\t\t\t\tif( found != null ) {\r\n\t\t\t\t\t\t\treturn found;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( this.isFocusRoot( parent ) ) {\r\n\t\t\t\t\t\tfor( let i = 0, imax = index + 1; i < imax; ++i ) {\r\n\t\t\t\t\t\t\tconst found = this.findFocusableNext( children[ i ], true, true );\r\n\t\t\t\t\t\t\tif( found != null ) {\r\n\t\t\t\t\t\t\t\treturn found;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Parent\r\n\t\t\t\t\treturn this.findFocusable( parent, false, false, true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst result = this.findFocusablePrevious( target, includesTarget, includesTargetChildren );\r\n\t\t\tif( result != null ) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tconst parent = target.parent;\r\n\t\t\tif( parent != null ) {\r\n\t\t\t\tconst children = parent.children;\r\n\t\t\t\tconst index = children.indexOf( target );\r\n\t\t\t\tif( 0 <= index ) {\r\n\t\t\t\t\t// Siblings\r\n\t\t\t\t\tfor( let i = index - 1; 0 <= i; --i ) {\r\n\t\t\t\t\t\tconst found = this.findFocusablePrevious( children[ i ], true, true );\r\n\t\t\t\t\t\tif( found != null ) {\r\n\t\t\t\t\t\t\treturn found;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( this.isFocusRoot( parent ) ) {\r\n\t\t\t\t\t\tfor( let i = children.length - 1; index <= i; --i ) {\r\n\t\t\t\t\t\t\tconst found = this.findFocusablePrevious( children[ i ], true, true );\r\n\t\t\t\t\t\t\tif( found != null ) {\r\n\t\t\t\t\t\t\t\treturn found;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn parent;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Parent\r\n\t\t\t\t\treturn this.findFocusable( parent, true, false, false );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected findFocusableNext(\r\n\t\ttarget: DFocusableMightBe, includesTarget: boolean, includesTargetChildren: boolean\r\n\t): DFocusable | null {\r\n\t\t// Target itself\r\n\t\tif( includesTarget ) {\r\n\t\t\tif( this.isFocusable( target ) ) {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Target children\r\n\t\tif( includesTargetChildren && isFocusableContainer( target ) && target.visible ) {\r\n\t\t\tconst children = target.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst found = this.findFocusableNext( children[ i ], true, true );\r\n\t\t\t\tif( found != null ) {\r\n\t\t\t\t\treturn found;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Siblings\r\n\t\tif( this.isFocusRoot( target ) ) {\r\n\t\t\treturn target;\r\n\t\t}\r\n\r\n\t\t// Found nothing\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected findFocusablePrevious(\r\n\t\ttarget: DFocusableMightBe, includesTarget: boolean, includesTargetChildren: boolean\r\n\t): DFocusable | null {\r\n\t\t// Target children\r\n\t\tif( includesTargetChildren && isFocusableContainer( target ) && target.visible ) {\r\n\t\t\tconst children = target.children;\r\n\t\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\t\tconst found = this.findFocusablePrevious( children[ i ], true, true );\r\n\t\t\t\tif( found != null ) {\r\n\t\t\t\t\treturn found;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Target itself\r\n\t\tif( includesTarget ) {\r\n\t\t\tif( this.isFocusable( target ) ) {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Siblings\r\n\t\tif( this.isFocusRoot( target ) ) {\r\n\t\t\treturn target;\r\n\t\t}\r\n\r\n\t\t// Found nothing\r\n\t\treturn null;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCommand } from \"./d-command\";\r\nimport { DCommandFlag } from \"./d-command-flag\";\r\n\r\nexport class DCommandClear implements DCommand {\r\n\texecute(): Promise<unknown> | boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tredo(): Promise<unknown> | boolean {\r\n\t\tthrow new Error(\"Method not implemented.\");\r\n\t}\r\n\r\n\tundo(): Promise<unknown> | boolean {\r\n\t\tthrow new Error(\"Method not implemented.\");\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tgetFlag(): DCommandFlag {\r\n\t\treturn DCommandFlag.UNSTORABLE | DCommandFlag.CLEAR;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DDialogCloseOn {\r\n\tNONE = 0,\r\n\tESC = 1,\r\n\tCLICK_OUTSIDE = 2\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCommand } from \"./d-command\";\r\nimport { DCommandFlag } from \"./d-command-flag\";\r\n\r\nexport class DCommandRedo implements DCommand {\r\n\texecute(): Promise<void> | boolean {\r\n\t\tthrow new Error( \"Not supported\" );\r\n\t}\r\n\r\n\tredo(): Promise<void> | boolean {\r\n\t\tthrow new Error( \"Not supported\" );\r\n\t}\r\n\r\n\tundo(): Promise<void> | boolean {\r\n\t\tthrow new Error( \"Not supported\" );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tgetFlag(): DCommandFlag {\r\n\t\treturn DCommandFlag.UNSTORABLE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCommand } from \"./d-command\";\r\nimport { DCommandFlag } from \"./d-command-flag\";\r\n\r\nexport class DCommandUndo implements DCommand {\r\n\texecute(): Promise<void> | boolean {\r\n\t\tthrow new Error( \"Not supported\" );\r\n\t}\r\n\r\n\tredo(): Promise<void> | boolean {\r\n\t\tthrow new Error( \"Not supported\" );\r\n\t}\r\n\r\n\tundo(): Promise<void> | boolean {\r\n\t\tthrow new Error( \"Not supported\" );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tgetFlag(): DCommandFlag {\r\n\t\treturn DCommandFlag.UNSTORABLE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DCommand } from \"./d-command\";\r\nimport { DCommandClear } from \"./d-command-clear\";\r\nimport { DCommandFlag } from \"./d-command-flag\";\r\nimport { DCommandRedo } from \"./d-command-redo\";\r\nimport { DCommandUndo } from \"./d-command-undo\";\r\nimport { DControllerCommand } from \"./d-controller-command\";\r\n\r\nconst isCommandStorable = ( command: DCommand ): boolean => {\r\n\treturn ( command.getFlag() & DCommandFlag.UNSTORABLE ) === 0;\r\n};\r\n\r\nconst isCommandClear = ( command: DCommand ): boolean => {\r\n\treturn ( command.getFlag() & DCommandFlag.CLEAR ) !== 0;\r\n};\r\n\r\nexport class DControllerDefaultCommand extends utils.EventEmitter implements DControllerCommand {\r\n\tprotected _position: number;\r\n\tprotected _done: DCommand[];\r\n\tprotected _waiting: DCommand[];\r\n\tprotected _executing: Promise<void> | null;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis._position = 0;\r\n\t\tthis._done = [];\r\n\t\tthis._waiting = [];\r\n\t\tthis._executing = null;\r\n\t}\r\n\r\n\tlast(): DCommand | null {\r\n\t\tconst done = this._done;\r\n\t\tconst waiting = this._waiting;\r\n\r\n\t\tif( waiting.length <= 0 ) {\r\n\t\t\tif( 0 < done.length ) {\r\n\t\t\t\treturn done[ done.length - 1 ];\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn waiting[ waiting.length - 1 ];\r\n\t\t}\r\n\t}\r\n\r\n\tpush( command: DCommand ): void {\r\n\t\tconst waiting = this._waiting;\r\n\t\twaiting.push( command );\r\n\t\tthis.next();\r\n\t}\r\n\r\n\tnext() {\r\n\t\tif( this._executing == null ) {\r\n\t\t\tconst waiting = this._waiting;\r\n\t\t\tif( 0 < waiting.length ) {\r\n\t\t\t\tconst command = waiting.shift();\r\n\t\t\t\tif( command != null ) {\r\n\t\t\t\t\tif( command instanceof DCommandUndo ) {\r\n\t\t\t\t\t\tconst done = this._done;\r\n\t\t\t\t\t\tif( this._position < done.length ) {\r\n\t\t\t\t\t\t\tconst current = done[ done.length - 1 - this._position ];\r\n\t\t\t\t\t\t\tthis._position += 1;\r\n\t\t\t\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\t\t\t\tconst result = current.undo();\r\n\t\t\t\t\t\t\tif( result === true ) {\r\n\t\t\t\t\t\t\t\tthis.onSuccess( command );\r\n\t\t\t\t\t\t\t} else if( result === false ) {\r\n\t\t\t\t\t\t\t\tthis.onFail( command );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis._executing = result.then(() => {\r\n\t\t\t\t\t\t\t\t\tthis.onSuccess( command );\r\n\t\t\t\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t\t\t\tthis.onFail( command );\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if( command instanceof DCommandRedo ) {\r\n\t\t\t\t\t\tconst done = this._done;\r\n\t\t\t\t\t\tif( 0 < this._position ) {\r\n\t\t\t\t\t\t\tconst current = done[ done.length - this._position ];\r\n\t\t\t\t\t\t\tthis._position -= 1;\r\n\t\t\t\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\t\t\t\tconst result = current.redo();\r\n\t\t\t\t\t\t\tif( result === true ) {\r\n\t\t\t\t\t\t\t\tthis.onSuccess( command );\r\n\t\t\t\t\t\t\t} else if( result === false ) {\r\n\t\t\t\t\t\t\t\tthis.onFail( command );\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis._executing = result.then(() => {\r\n\t\t\t\t\t\t\t\t\tthis.onSuccess( command );\r\n\t\t\t\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t\t\t\tthis.onFail( command );\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst isClear = isCommandClear( command );\r\n\t\t\t\t\t\tconst isStorable = isCommandStorable( command );\r\n\t\t\t\t\t\tif( isClear || isStorable ) {\r\n\t\t\t\t\t\t\tconst size = ( isClear ? this._done.length : this._position );\r\n\t\t\t\t\t\t\tif( 0 < size ) {\r\n\t\t\t\t\t\t\t\tthis.remove( size );\r\n\t\t\t\t\t\t\t\tthis._position = 0;\r\n\t\t\t\t\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.cleanup();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst result = command.execute();\r\n\t\t\t\t\t\tif( result === true ) {\r\n\t\t\t\t\t\t\tthis.onSuccess( command );\r\n\t\t\t\t\t\t} else if( result === false ) {\r\n\t\t\t\t\t\t\tthis.onFail( command );\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._executing = result.then(() => {\r\n\t\t\t\t\t\t\t\tthis.onSuccess( command );\r\n\t\t\t\t\t\t\t}, () => {\r\n\t\t\t\t\t\t\t\tthis.onFail( command );\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected cleanup(): void {\r\n\t\tconst done = this._done;\r\n\t\tconst size = done.length - 100;\r\n\t\tif( 0 < size ) {\r\n\t\t\tfor( let i = 0; i < size; ++i ) {\r\n\t\t\t\tdone[ i ].destroy();\r\n\t\t\t\tdone.shift();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected remove( size: number ): boolean {\r\n\t\tconst done = this._done;\r\n\t\tif( 0 < size ) {\r\n\t\t\tconst ifrom = Math.max( 0, done.length - size );\r\n\t\t\tsize = done.length - ifrom;\r\n\t\t\tif( 0 < size ) {\r\n\t\t\t\tfor( let i = ifrom, imax = done.length; i < imax; ++i ) {\r\n\t\t\t\t\tdone[ i ].destroy();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdone.splice( ifrom, done.length - ifrom );\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected onSuccess( command: DCommand ) {\r\n\t\tthis._executing = null;\r\n\t\tif( isCommandStorable( command ) ) {\r\n\t\t\tthis._done.push( command );\r\n\t\t\tthis.emit( \"dirty\", this );\r\n\t\t} else if( command instanceof DCommandUndo || command instanceof DCommandRedo ) {\r\n\t\t\tthis.emit( \"dirty\", this );\r\n\t\t}\r\n\t\tthis.emit( \"change\", this );\r\n\t\tthis.next();\r\n\t}\r\n\r\n\tprotected onFail( command: DCommand ) {\r\n\t\tthis._executing = null;\r\n\t\tconst waiting = this._waiting;\r\n\t\tcommand.destroy();\r\n\t\tfor( let i = 0, imax = waiting.length; i < imax; ++i ) {\r\n\t\t\twaiting[ i ].destroy();\r\n\t\t}\r\n\t\twaiting.length = 0;\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._done.length;\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tthis.push( new DCommandClear() );\r\n\t}\r\n\r\n\tredo(): void {\r\n\t\tif( this.isRedoable() ) {\r\n\t\t\tthis._waiting.push( new DCommandRedo() );\r\n\t\t\tthis.next();\r\n\t\t}\r\n\t}\r\n\r\n\tundo(): void {\r\n\t\tif( this.isUndoable() ) {\r\n\t\t\tthis._waiting.push( new DCommandUndo() );\r\n\t\t\tthis.next();\r\n\t\t}\r\n\t}\r\n\r\n\tisRedoable(): boolean {\r\n\t\treturn ( 0 < this._position && this._executing == null );\r\n\t}\r\n\r\n\tisUndoable(): boolean {\r\n\t\treturn ( this._position < this._done.length && this._executing == null );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, utils } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DControllerFocus, DFocusable, DFocusableContainer } from \"./d-controller-focus\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\n\r\nexport class DControllerKeyboard extends utils.EventEmitter {\r\n\tinit( element: HTMLElement, stage: Container, focusController: DControllerFocus ) {\r\n\t\telement.addEventListener( \"keydown\", ( e: KeyboardEvent ): void => {\r\n\t\t\tthis.emit( \"keydown\", e );\r\n\r\n\t\t\tconst focused = focusController.getFocused();\r\n\t\t\tif( focused != null ) {\r\n\t\t\t\tlet current: DFocusable | DFocusableContainer | null = focused;\r\n\t\t\t\twhile( current != null ) {\r\n\t\t\t\t\tif( this.hasOnKeyDown( current ) ) {\r\n\t\t\t\t\t\tif( current.onKeyDown( e ) ) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrent = current.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif( UtilKeyboardEvent.isFocusKey( e ) ) {\r\n\t\t\t\tconst direction = UtilKeyboardEvent.getFocusDirection( e );\r\n\t\t\t\tconst next = ( focused != null ?\r\n\t\t\t\t\tfocusController.findFocusable(\r\n\t\t\t\t\t\tfocused, false, focused.hasState( DBaseState.FOCUS_ROOT ) || direction, direction\r\n\t\t\t\t\t) :\r\n\t\t\t\t\tfocusController.findFocusable( stage, false, true, direction )\r\n\t\t\t\t);\r\n\t\t\t\tif( next != null ) {\r\n\t\t\t\t\tfocusController.setFocused( next, true, true );\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\telement.addEventListener( \"keyup\", ( e: KeyboardEvent ): void => {\r\n\t\t\tthis.emit( \"keyup\", e );\r\n\r\n\t\t\tconst focused = focusController.getFocused();\r\n\t\t\tif( focused != null ) {\r\n\t\t\t\tlet current: DFocusable | DFocusableContainer | null = focused;\r\n\t\t\t\twhile( current != null ) {\r\n\t\t\t\t\tif( this.hasOnKeyUp( current ) ) {\r\n\t\t\t\t\t\tif( current.onKeyUp( e ) ) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrent = current.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected hasOnKeyDown( target: any ): target is { onKeyDown( e: KeyboardEvent ): boolean; } {\r\n\t\treturn \"onKeyDown\" in target;\r\n\t}\r\n\r\n\tprotected hasOnKeyUp( target: any ): target is { onKeyUp( e: KeyboardEvent ): boolean; } {\r\n\t\treturn \"onKeyUp\" in target;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DControllerCommand } from \"./d-controller-command\";\r\nimport { DControllerDefaultCommand } from \"./d-controller-default-command\";\r\nimport { DControllerDocument } from \"./d-controller-document\";\r\nimport { DControllerKeyboard } from \"./d-controller-keyboard\";\r\nimport { DDocument } from \"./d-document\";\r\n\r\nexport class DControllers {\r\n\tprotected static KEYBOARD: DControllerKeyboard | null;\r\n\tprotected static COMMAND: DControllerCommand | null;\r\n\tprotected static DOCUMENT: DControllerDocument<any> | null;\r\n\r\n\t// Keyboard\r\n\tstatic getKeyboardController(): DControllerKeyboard {\r\n\t\tif( this.KEYBOARD == null ) {\r\n\t\t\tthis.KEYBOARD = new DControllerKeyboard();\r\n\t\t}\r\n\t\treturn this.KEYBOARD;\r\n\t}\r\n\r\n\tstatic setKeyboardController( instance: DControllerKeyboard ): DControllerKeyboard | null {\r\n\t\tconst result = this.KEYBOARD;\r\n\t\tthis.KEYBOARD = instance;\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// Command\r\n\tstatic getCommandController(): DControllerCommand {\r\n\t\tif( this.COMMAND == null ) {\r\n\t\t\tthis.COMMAND = new DControllerDefaultCommand();\r\n\t\t}\r\n\t\treturn this.COMMAND;\r\n\t}\r\n\r\n\tstatic setCommandController( instance: DControllerCommand ): DControllerCommand | null {\r\n\t\tconst result = this.COMMAND;\r\n\t\tthis.COMMAND = instance;\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// Document\r\n\tstatic getDocumentController<DOCUMENT extends DDocument>(): DControllerDocument<DOCUMENT> {\r\n\t\tif( this.DOCUMENT == null ) {\r\n\t\t\tthrow new Error( \"Not supported\" );\r\n\t\t}\r\n\t\treturn this.DOCUMENT;\r\n\t}\r\n\r\n\tstatic setDocumentController<DOCUMENT extends DDocument>(\r\n\t\tinstance: DControllerDocument<DOCUMENT>\r\n\t): DControllerDocument<DOCUMENT> | null {\r\n\t\tconst result = this.DOCUMENT;\r\n\t\tthis.DOCUMENT = instance;\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Application, interaction, Point } from \"pixi.js\";\r\nimport { DApplicationLayerLike } from \"./d-application-layer-like\";\r\nimport { DApplicationLayerOptions } from \"./d-application-layer-options\";\r\nimport { DApplicationLike } from \"./d-application-like\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DControllerDefaultFocus } from \"./d-controller-default-focus\";\r\nimport { DControllerFocus, DFocusable, DFocusableContainer } from \"./d-controller-focus\";\r\nimport { DControllers } from \"./d-controllers\";\r\nimport { DPadding } from \"./d-padding\";\r\nimport { DynamicFontAtlases } from \"./util/dynamic-font-atlases\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\nimport { UtilWheelEvent, UtilWheelEventDeltas } from \"./util/util-wheel-event\";\r\n\r\ninterface DblClickable {\r\n\tonDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean;\r\n}\r\n\r\nconst isDblClickable = ( target: any ): target is DblClickable => {\r\n\treturn target != null && target.onDblClick != null;\r\n};\r\n\r\ninterface Wheelable {\r\n\tonWheel( e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point ): boolean;\r\n}\r\n\r\nconst isWheelable = ( target: any ): target is Wheelable => {\r\n\treturn target != null && target.onWheel != null;\r\n};\r\n\r\nexport class DApplicationLayer extends Application implements DApplicationLayerLike {\r\n\tprotected _options: DApplicationLayerOptions;\r\n\tprotected _renderId: number | null = null;\r\n\tprotected _renderBound: () => void;\r\n\tprotected _isUpdateAllowed: boolean;\r\n\tprotected _refitLimit: number;\r\n\tprotected _reflowLimit: number;\r\n\tprotected _focus?: DControllerFocus;\r\n\tprotected _elementContainer: HTMLDivElement;\r\n\tprotected _dynamicFontAtlases: DynamicFontAtlases | null = null;\r\n\tprotected _isVisible: boolean;\r\n\r\n\treadonly application: DApplicationLike;\r\n\r\n\tconstructor( application: DApplicationLike, options: DApplicationLayerOptions ) {\r\n\t\tsuper( options.getPixiApplicationOptions() );\r\n\r\n\t\tthis.application = application;\r\n\t\tconst stageAny = this.stage as any;\r\n\t\tstageAny.layer = this;\r\n\t\tstageAny.application = application;\r\n\r\n\t\tthis._options = options;\r\n\t\tthis._isUpdateAllowed = true;\r\n\t\tthis._refitLimit = 5;\r\n\t\tthis._reflowLimit = 5;\r\n\t\tthis._isVisible = true;\r\n\r\n\t\tthis._renderBound = (): void => {\r\n\t\t\tif( this._renderId != null ) {\r\n\t\t\t\tthis.render();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Canvas initialization\r\n\t\tconst rootElement = options.getRootElement();\r\n\t\tconst elementContainer = document.createElement( \"div\" );\r\n\t\telementContainer.setAttribute( \"style\",\r\n\t\t\t\"position: absolute; top: 0; left: 0; width: 0; height: 0;\" +\r\n\t\t\t\"margin: 0; padding: 0; outline: none;\"\r\n\t\t);\r\n\t\tthis._elementContainer = elementContainer;\r\n\t\tconst children = rootElement.children;\r\n\t\tif( options.isOverlay() ) {\r\n\t\t\tif( 3 <= children.length ) {\r\n\t\t\t\tconst thirdChild = children[ 2 ];\r\n\t\t\t\trootElement.insertBefore( this.view, thirdChild );\r\n\t\t\t\trootElement.insertBefore( elementContainer, thirdChild );\r\n\t\t\t} else {\r\n\t\t\t\trootElement.appendChild( this.view );\r\n\t\t\t\trootElement.appendChild( elementContainer );\r\n\t\t\t}\r\n\r\n\t\t\tconst oldOnChildrenChange = stageAny.onChildrenChange;\r\n\t\t\tstageAny.onChildrenChange = () => {\r\n\t\t\t\tthis.updateVisibility();\r\n\t\t\t\toldOnChildrenChange.call( stageAny );\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tif( 0 < children.length ) {\r\n\t\t\t\tconst firstChild = children[ 0 ];\r\n\t\t\t\trootElement.insertBefore( this.view, firstChild );\r\n\t\t\t\trootElement.insertBefore( elementContainer, firstChild );\r\n\t\t\t} else {\r\n\t\t\t\trootElement.appendChild( this.view );\r\n\t\t\t\trootElement.appendChild( elementContainer );\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst rootElementStyle = rootElement.style;\r\n\t\tif( rootElement !== document.body ) {\r\n\t\t\tconst rootElementStylePosition = window.getComputedStyle( rootElement ).position;\r\n\t\t\tif( rootElementStylePosition === \"static\" ) {\r\n\t\t\t\trootElementStyle.position = \"relative\";\r\n\t\t\t}\r\n\t\t}\r\n\t\trootElementStyle.margin = \"0\";\r\n\t\trootElementStyle.padding = \"0\";\r\n\t\trootElementStyle.overflow = \"hidden\";\r\n\t\tconst viewStyle = this.view.style;\r\n\t\tviewStyle.position = \"absolute\";\r\n\t\tviewStyle.top = \"0\";\r\n\t\tviewStyle.left = \"0\";\r\n\t\tviewStyle.width = \"100%\";\r\n\t\tviewStyle.height = \"100%\";\r\n\t\tviewStyle.display = \"block\";\r\n\t\tviewStyle.outline = \"none\";\r\n\r\n\t\t// Focus handling\r\n\t\tlet hasFocus = false;\r\n\t\tconst focusController = this.getFocusController();\r\n\t\tconst onBlurBound = (): void => {\r\n\t\t\tif( ! hasFocus ) {\r\n\t\t\t\tfocusController.setFocused( null, true, false );\r\n\t\t\t}\r\n\t\t};\r\n\t\trootElement.addEventListener( \"focus\", ( e ): void => {\r\n\t\t\thasFocus = true;\r\n\t\t}, true );\r\n\t\trootElement.addEventListener( \"blur\", ( e ): void => {\r\n\t\t\thasFocus = false;\r\n\t\t\tsetTimeout( onBlurBound, 0 );\r\n\t\t}, true );\r\n\t\tthis.view.setAttribute( \"tabindex\", \"0\" );\r\n\r\n\t\tDControllers.getKeyboardController().init( this.view, this.stage, focusController );\r\n\r\n\t\tconst interactionManager: interaction.InteractionManager = this.renderer.plugins.interaction;\r\n\t\tinteractionManager.on( UtilPointerEvent.down, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( e.target == null ) {\r\n\t\t\t\tfocusController.setFocused( null, true, false );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Resize handling\r\n\t\tconst onResize = (): void => {\r\n\t\t\tconst bbox = options.getRootElement().getBoundingClientRect();\r\n\t\t\tthis.renderer.resize( bbox.width, bbox.height );\r\n\t\t\tthis.resizeChildren( bbox.width, bbox.height, options.getPadding() );\r\n\t\t\tthis.update();\r\n\t\t};\r\n\t\twindow.addEventListener( \"resize\", onResize );\r\n\t\twindow.addEventListener( \"orientationchange\", onResize );\r\n\r\n\t\t// Mouse wheel handling\r\n\t\tconst wheelGlobal = new Point();\r\n\t\tconst wheelEventUtil = UtilWheelEvent.getInstance();\r\n\t\twheelEventUtil.on( this.view, ( e: WheelEvent | Event ): void => {\r\n\t\t\tconst wheelEvent = e as WheelEvent;\r\n\t\t\tUtilPointerEvent.toGlobal( wheelEvent, interactionManager, wheelGlobal );\r\n\t\t\tlet current = interactionManager.hitTest( wheelGlobal );\r\n\t\t\tconst deltas = wheelEventUtil.normalize( e );\r\n\t\t\tif( deltas != null ) {\r\n\t\t\t\twhile( current != null ) {\r\n\t\t\t\t\tif( isWheelable( current ) ) {\r\n\t\t\t\t\t\tif( current.onWheel( wheelEvent, deltas, wheelGlobal ) ) {\r\n\t\t\t\t\t\t\twheelEvent.preventDefault();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrent = current.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Double click handling\r\n\t\tUtilPointerEvent.onDblClick( this.view, ( e: MouseEvent | TouchEvent ) => {\r\n\t\t\tconst focused = focusController.getFocused();\r\n\t\t\tif( focused != null ) {\r\n\t\t\t\tlet current: DFocusable | DFocusableContainer | null = focused;\r\n\t\t\t\twhile( current != null ) {\r\n\t\t\t\t\tif( isDblClickable( current ) ) {\r\n\t\t\t\t\t\tif( current.onDblClick( e, interactionManager ) ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcurrent = current.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//\r\n\t\tthis.stage.interactive = true;\r\n\t}\r\n\r\n\tdisallowUpdate(): void {\r\n\t\tthis._isUpdateAllowed = false;\r\n\t}\r\n\r\n\tallowUpdate(): void {\r\n\t\tthis._isUpdateAllowed = true;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tif( this._isUpdateAllowed && this._renderId == null ) {\r\n\t\t\tthis._renderId = requestAnimationFrame( this._renderBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateVisibility(): void {\r\n\t\tif( this._options.isOverlay() ) {\r\n\t\t\tif( 0 < this.stage.children.length ) {\r\n\t\t\t\tif( ! this._isVisible ) {\r\n\t\t\t\t\tthis._isVisible = true;\r\n\t\t\t\t\tthis.view.style.display = \"block\";\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( this._isVisible ) {\r\n\t\t\t\t\tthis._isVisible = false;\r\n\t\t\t\t\tthis.view.style.display = \"none\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trender(): void {\r\n\t\tthis.refit();\r\n\t\tthis.reflow();\r\n\r\n\t\t// Please note why the following line is here.\r\n\t\t//\r\n\t\t// Before this line, the update method does not enque a rendering task\r\n\t\t// because `this._renderId` is not null. As a result, this prevents\r\n\t\t// an unintentional rendering loop caused by the refit or the reflow.\r\n\t\t//\r\n\t\t// After this line, the update method enques a rendering task.\r\n\t\t// Namely, in the DisplayObject#render(Renderer) method, allowed to enque\r\n\t\t// a rendering task. For instance, please refer to the DDiagramShape#update().\r\n\t\tthis._renderId = null;\r\n\r\n\t\t// Render\r\n\t\tsuper.render();\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this.screen.width;\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this.screen.height;\r\n\t}\r\n\r\n\tget padding(): DPadding {\r\n\t\treturn this._options.getPadding();\r\n\t}\r\n\r\n\tprotected resizeChildren( width: number, height: number, padding: DPadding ): void {\r\n\t\tconst children = this.stage.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\tchild.onParentResize( width, height, padding );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trefit(): void {\r\n\t\tconst children = this.stage.children;\r\n\t\tfor( let ilimit = 0, limit = this._refitLimit; ilimit < limit; ++ilimit ) {\r\n\t\t\tlet isChildrenDirty = false;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\t\tchild.refit();\r\n\t\t\t\t\tisChildrenDirty = isChildrenDirty || child.isChildrenDirty();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If DBases are changed during the `refit` process, need to refit again.\r\n\t\t\tif( ! isChildrenDirty ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treflow(): void {\r\n\t\tconst children = this.stage.children;\r\n\t\tfor( let ilimit = 0, limit = this._refitLimit; ilimit < limit; ++ilimit ) {\r\n\t\t\tlet isDirty = false;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\t\tchild.reflow();\r\n\t\t\t\t\tisDirty = isDirty || child.isDirty() || child.hasDirty();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If DBases are changed during the `reflow` process, need to reflow again.\r\n\t\t\tif( ! isDirty ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetFocusController(): DControllerFocus {\r\n\t\tif( this._focus == null ) {\r\n\t\t\tthis._focus = new DControllerDefaultFocus();\r\n\t\t}\r\n\t\treturn this._focus;\r\n\t}\r\n\r\n\tgetElementContainer(): HTMLElement {\r\n\t\treturn this._elementContainer;\r\n\t}\r\n\r\n\tgetDynamicFontAtlases(): DynamicFontAtlases {\r\n\t\tif( this._dynamicFontAtlases == null ) {\r\n\t\t\tthis._dynamicFontAtlases = new DynamicFontAtlases( this );\r\n\t\t}\r\n\t\treturn this._dynamicFontAtlases;\r\n\t}\r\n}\r\n","import { Container, Renderer } from \"pixi.js\";\r\nimport { DApplicationLayer } from \"./d-application-layer\";\r\nimport { DApplicationLayerOptions } from \"./d-application-layer-options\";\r\nimport { DApplicationLike } from \"./d-application-like\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DPaddingLike } from \"./d-padding\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport interface DApplicationBackgroundOptions {\r\n\tcolor?: number;\r\n}\r\n\r\nexport interface DApplicationOptions {\r\n\t/**\r\n\t * A root element selector or a root element.\r\n\t * `HTMLCanvasElement` and other DOM elements are created in this element.\r\n\t * The default root element is `document.body`.\r\n\t */\r\n\troot?: string | HTMLElement;\r\n\r\n\t/**\r\n\t * Padding settings.\r\n\t */\r\n\tpadding?: number | DPaddingLike;\r\n\r\n\t/**\r\n\t * A canvas width.\r\n\t */\r\n\twidth?: number;\r\n\r\n\t/**\r\n\t * A canvas height.\r\n\t */\r\n\theight?: number;\r\n\r\n\t/**\r\n\t * A background setting.\r\n\t */\r\n\tbackground?: DApplicationBackgroundOptions;\r\n\r\n\t/**\r\n\t * An antialias setting.\r\n\t */\r\n\tantialias?: boolean;\r\n\r\n\t/**\r\n\t * A resolution.\r\n\t * The default value is `devicePixelRatio`.\r\n\t */\r\n\tresolution?: number;\r\n\r\n\t/**\r\n\t * An overlay layer setting.\r\n\t * The overlay layer is used by modal UI elements including DDialog\r\n\t * to provide the better interoperability with DOM-based UI elements\r\n\t * and WebGL-based UI elements.\r\n\t * However, an extra layer requires extra memory.\r\n\t * Set to true to enable the overlay layer.\r\n\t * The default value is false.\r\n\t */\r\n\toverlay?: boolean;\r\n}\r\n\r\nexport class DApplication implements DApplicationLike {\r\n\tprotected _options?: DApplicationOptions;\r\n\tprotected _root: HTMLElement;\r\n\tprotected _base: DApplicationLayer;\r\n\tprotected _overlay?: DApplicationLayer;\r\n\tprotected _resolution: number;\r\n\tprotected _isOverlayEnabled: boolean;\r\n\r\n\tconstructor( options?: DApplicationOptions ) {\r\n\t\tDApplications.add( this );\r\n\r\n\t\t// Root\r\n\t\tthis._root = this.toRootElement( options );\r\n\r\n\t\t// Resolution\r\n\t\tconst resolution = ( options && options.resolution != null ?\r\n\t\t\toptions.resolution : (window.devicePixelRatio || 1)\r\n\t\t);\r\n\t\tthis._resolution = resolution;\r\n\r\n\t\t// Remove the accessibility plugin\r\n\t\tdelete (Renderer as any).__plugins.accessibility;\r\n\r\n\t\t// Options\r\n\t\tthis._options = options;\r\n\r\n\t\t// Base layer\r\n\t\tconst base = this._base = this.newLayerBase( options );\r\n\r\n\t\t// Overlay layer\r\n\t\tthis._isOverlayEnabled = !! ( options && options.overlay );\r\n\t\tif( ! this._isOverlayEnabled ) {\r\n\t\t\tthis._overlay = base;\r\n\t\t}\r\n\t}\r\n\r\n\tget stage(): Container {\r\n\t\treturn this._base.stage;\r\n\t}\r\n\r\n\tgetRootElement(): HTMLElement {\r\n\t\treturn this._root;\r\n\t}\r\n\r\n\tgetResolution(): number {\r\n\t\treturn this._resolution;\r\n\t}\r\n\r\n\tprotected toRootElement( options?: DApplicationOptions ): HTMLElement {\r\n\t\tconst root = options && options.root;\r\n\t\tif( root != null ) {\r\n\t\t\tif( isString( root ) ) {\r\n\t\t\t\tconst found = document.querySelector<HTMLElement>( root );\r\n\t\t\t\tif( found ) {\r\n\t\t\t\t\treturn found;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn root;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn document.body;\r\n\t}\r\n\r\n\tprotected toLayerBaseOptions( options?: DApplicationOptions ): DApplicationLayerOptions {\r\n\t\tconst root = this._root;\r\n\t\tconst resolution = this._resolution;\r\n\t\tif( options ) {\r\n\t\t\treturn new DApplicationLayerOptions({\r\n\t\t\t\troot,\r\n\t\t\t\tpadding: options.padding,\r\n\t\t\t\twidth: options.width,\r\n\t\t\t\theight: options.height,\r\n\t\t\t\tbackground: options.background,\r\n\t\t\t\tresolution,\r\n\t\t\t\tantialias: options.antialias,\r\n\t\t\t\toverlay: false\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn new DApplicationLayerOptions({\r\n\t\t\troot,\r\n\t\t\tresolution,\r\n\t\t\toverlay: false\r\n\t\t});\r\n\t}\r\n\r\n\tprotected newLayerBase( options?: DApplicationOptions ): DApplicationLayer {\r\n\t\treturn new DApplicationLayer( this, this.toLayerBaseOptions( options ) );\r\n\t}\r\n\r\n\tgetLayerBase(): DApplicationLayer {\r\n\t\treturn  this._base;\r\n\t}\r\n\r\n\tprotected toLayerOverlayOptions( options?: DApplicationOptions ): DApplicationLayerOptions {\r\n\t\tconst root = this._root;\r\n\t\tconst resolution = this._resolution;\r\n\t\tif( options ) {\r\n\t\t\treturn new DApplicationLayerOptions({\r\n\t\t\t\troot,\r\n\t\t\t\tpadding: options.padding,\r\n\t\t\t\twidth: options.width,\r\n\t\t\t\theight: options.height,\r\n\t\t\t\tbackground: {\r\n\t\t\t\t\tcolor: null\r\n\t\t\t\t},\r\n\t\t\t\tresolution,\r\n\t\t\t\tantialias: options.antialias,\r\n\t\t\t\toverlay: true\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn new DApplicationLayerOptions({\r\n\t\t\troot,\r\n\t\t\tresolution,\r\n\t\t\toverlay: true\r\n\t\t});\r\n\t}\r\n\r\n\tprotected newLayerOverlay( options?: DApplicationOptions ): DApplicationLayer {\r\n\t\treturn new DApplicationLayer( this, this.toLayerOverlayOptions( options ) );\r\n\t}\r\n\r\n\tgetLayerOverlay(): DApplicationLayer {\r\n\t\tif( this._isOverlayEnabled ) {\r\n\t\t\tif( this._overlay == null ) {\r\n\t\t\t\tthis._overlay = this.newLayerOverlay( this._options );\r\n\t\t\t}\r\n\t\t\treturn this._overlay;\r\n\t\t} else {\r\n\t\t\treturn this._base;\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tif( this._isOverlayEnabled ) {\r\n\t\t\tconst base = this._base;\r\n\t\t\tbase.update();\r\n\r\n\t\t\tconst overlay = this._overlay;\r\n\t\t\tif( overlay ) {\r\n\t\t\t\toverlay.update();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn this._base.update();\r\n\t\t}\r\n\t}\r\n\r\n\trender(): void {\r\n\t\tif( this._isOverlayEnabled ) {\r\n\t\t\tconst base = this._base;\r\n\t\t\tbase.render();\r\n\r\n\t\t\tconst overlay = this._overlay;\r\n\t\t\tif( overlay ) {\r\n\t\t\t\toverlay.render();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn this._base.render();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\n\r\nexport interface DBoardOptions<THEME extends DThemeBoard = DThemeBoard> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeBoard extends DThemeBase {\r\n\r\n}\r\n\r\nexport class DBoard<\r\n\tTHEME extends DThemeBoard = DThemeBoard,\r\n\tOPTIONS extends DBoardOptions<THEME> = DBoardOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DBoard\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBaseStates } from \"./d-base-states\";\r\nimport { DButtonGroup } from \"./d-button-group\";\r\nimport { DImageBase, DImageBaseOnOptions, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\n/**\r\n * Mappings of event names and handlers.\r\n */\r\nexport interface DButtonBaseOnOptions<VALUE> extends DImageBaseOnOptions<VALUE> {\r\n\t/**\r\n\t * Called when the button is activated.\r\n\t *\r\n\t * @param self an activated button\r\n\t */\r\n\tactive?: ( self: any ) => void;\r\n\r\n\t/**\r\n\t * Called when the button is inactivated.\r\n\t *\r\n\t * @param self an inactivated button\r\n\t */\r\n\tinactive?: ( self: any ) => void;\r\n}\r\n\r\n/**\r\n * Base button options.\r\n */\r\nexport interface DButtonBaseOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonBase = DThemeButtonBase\r\n> extends DImageBaseOptions<VALUE, THEME> {\r\n\t/**\r\n\t * True to turn a toggle mode on.\r\n\t */\r\n\ttoggle?: boolean;\r\n\r\n\t/**\r\n\t * A button group.\r\n\t */\r\n\tgroup?: DButtonGroup;\r\n\r\n\t/**\r\n\t * Mappings of event names and handlers.\r\n\t */\r\n\ton?: DButtonBaseOnOptions<VALUE>;\r\n}\r\n\r\n/**\r\n * A base button theme.\r\n */\r\nexport interface DThemeButtonBase extends DThemeImageBase {\r\n\t/**\r\n\t * Returns true to turn a toggle mode on.\r\n\t */\r\n\tisToggle(): boolean;\r\n}\r\n\r\n// Option parser\r\nconst isToggle = <VALUE, THEME extends DThemeButtonBase>(\r\n\ttheme: DThemeButtonBase, options: DButtonBaseOptions<VALUE, THEME> | undefined\r\n): boolean => {\r\n\tif( options != null && options.toggle != null ) {\r\n\t\treturn options.toggle;\r\n\t}\r\n\treturn theme.isToggle();\r\n};\r\n\r\nexport class DButtonBase<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonBase = DThemeButtonBase,\r\n\tOPTIONS extends DButtonBaseOptions<VALUE, THEME> = DButtonBaseOptions<VALUE, THEME>\r\n> extends DImageBase<VALUE, THEME, OPTIONS> {\r\n\tprotected _isToggle!: boolean;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.buttonMode = true;\r\n\t\tthis._isToggle = isToggle( this.theme, options );\r\n\r\n\t\t// Event handlers\r\n\t\tthis.initOnClick( options );\r\n\t\tif( ! this._isToggle ) {\r\n\t\t\tthis.initOnPress( options );\r\n\t\t}\r\n\r\n\t\t// Group\r\n\t\tconst group = options && options.group;\r\n\t\tif( group ) {\r\n\t\t\tgroup.add( this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onShortcut( e: KeyboardEvent ): void {\r\n\t\tsuper.onShortcut( e );\r\n\t\tthis.onClick( e );\r\n\t}\r\n\r\n\tisToggle(): boolean {\r\n\t\treturn this._isToggle;\r\n\t}\r\n\r\n\tprotected initOnClick( options?: OPTIONS ): void {\r\n\t\tUtilPointerEvent.onClick( this, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tthis.onClick( e );\r\n\t\t});\r\n\t}\r\n\r\n\tprotected initOnPress( options?: OPTIONS ): void {\r\n\t\tlet interactionManager: interaction.InteractionManager | null = null;\r\n\r\n\t\tconst onUp = (): void => {\r\n\t\t\tthis.setPressed( false );\r\n\t\t\tif( interactionManager != null ) {\r\n\t\t\t\tinteractionManager.off( UtilPointerEvent.up, onUp );\r\n\t\t\t\tinteractionManager = null;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.on( UtilPointerEvent.down, (): void => {\r\n\t\t\tthis.setPressed( true );\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tinteractionManager = layer.renderer.plugins.interaction;\r\n\t\t\t\tinteractionManager.on( UtilPointerEvent.up, onUp );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected onStateChange( newState: number, oldState: number ): void {\r\n\t\tsuper.onStateChange( newState, oldState );\r\n\t\tthis.buttonMode = DBaseStates.isActionable( newState );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DButton\";\r\n\t}\r\n\r\n\tonClick( e?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent ): void {\r\n\t\tif( this.isActionable() ) {\r\n\t\t\tif( this.isToggle() ) {\r\n\t\t\t\tthis.onToggleStart();\r\n\t\t\t\tthis.onToggleEnd();\r\n\t\t\t} else {\r\n\t\t\t\tthis.onActivate( e );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onActivate( e?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent ): void {\r\n\t\tthis.emit( \"active\", this );\r\n\t}\r\n\r\n\ttoggle(): void {\r\n\t\tif( this.isActionable() ) {\r\n\t\t\tif( this.isToggle() ) {\r\n\t\t\t\tthis.onToggleStart();\r\n\t\t\t\tthis.onToggleEnd();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onToggleStart(): void {\r\n\t\tthis.setActive( ! this.isActive() );\r\n\t}\r\n\r\n\tprotected onToggleEnd(): void {\r\n\t\tthis.emit( this.isActive() ? \"active\" : \"inactive\", this );\r\n\t}\r\n\r\n\tprotected onActivateKeyDown( e: KeyboardEvent ): void {\r\n\t\tif( this.isActionable() ) {\r\n\t\t\tif( this.isToggle() ) {\r\n\t\t\t\tthis.onToggleStart();\r\n\t\t\t} else {\r\n\t\t\t\tthis.setPressed( true );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onActivateKeyUp( e: KeyboardEvent ): void {\r\n\t\tif( this.isActionable() ) {\r\n\t\t\tif( this.isToggle() ) {\r\n\t\t\t\tthis.onToggleEnd();\r\n\t\t\t} else {\r\n\t\t\t\tif( this.isPressed() ) {\r\n\t\t\t\t\tthis.onActivate( e );\r\n\t\t\t\t}\r\n\t\t\t\tthis.setPressed( false );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tif( UtilKeyboardEvent.isActivateKey( e ) ) {\r\n\t\t\tthis.onActivateKeyDown( e );\r\n\t\t}\r\n\r\n\t\treturn super.onKeyDown( e );\r\n\t}\r\n\r\n\tonKeyUp( e: KeyboardEvent ): boolean {\r\n\t\tif( UtilKeyboardEvent.isActivateKey( e ) ) {\r\n\t\t\tthis.onActivateKeyUp( e );\r\n\t\t}\r\n\r\n\t\treturn super.onKeyUp( e );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// Group\r\n\t\tconst options = this._options;\r\n\t\tif( options != null && options.group != null ) {\r\n\t\t\toptions.group.remove( this );\r\n\t\t}\r\n\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonBase, DButtonBaseOnOptions, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\r\n\r\nexport interface DButtonOnOptions<VALUE> extends DButtonBaseOnOptions<VALUE> {\r\n\r\n}\r\n\r\nexport interface DButtonOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButton = DThemeButton\r\n> extends DButtonBaseOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeButton extends DThemeButtonBase {\r\n\r\n}\r\n\r\nexport class DButton<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButton = DThemeButton,\r\n\tOPTIONS extends DButtonOptions<VALUE, THEME> = DButtonOptions<VALUE, THEME>\r\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DButton\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\n\r\nexport interface DButtonAmbientOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonAmbient = DThemeButtonAmbient\r\n> extends DButtonOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeButtonAmbient extends DThemeButton {\r\n\r\n}\r\n\r\nexport class DButtonAmbient<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonAmbient = DThemeButtonAmbient,\r\n\tOPTIONS extends DButtonAmbientOptions<VALUE, THEME> = DButtonAmbientOptions<VALUE, THEME>\r\n> extends DButton<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonAmbient\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonBase, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\r\n\r\nexport interface DButtonCheckOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonCheck = DThemeButtonCheck\r\n> extends DButtonBaseOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeButtonCheck extends DThemeButtonBase {\r\n\r\n}\r\n\r\nexport class DButtonCheck<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonCheck = DThemeButtonCheck,\r\n\tOPTIONS extends DButtonCheckOptions<VALUE, THEME> = DButtonCheckOptions<VALUE, THEME>\r\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonCheck\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonCheck, DButtonCheckOptions, DThemeButtonCheck } from \"./d-button-check\";\r\n\r\nexport interface DButtonCheckRightOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonCheckRight = DThemeButtonCheckRight\r\n> extends DButtonCheckOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeButtonCheckRight extends DThemeButtonCheck {\r\n\r\n}\r\n\r\nexport class DButtonCheckRight<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonCheck = DThemeButtonCheck,\r\n\tOPTIONS extends DButtonCheckOptions<VALUE, THEME> = DButtonCheckOptions<VALUE, THEME>\r\n> extends DButtonCheck<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonCheckRight\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton } from \"./d-button\";\r\n\r\nexport class DButtonPrimary extends DButton {\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonPrimary\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Point } from \"pixi.js\";\r\nimport { DAnimation } from \"./d-animation\";\r\nimport { DAnimationFadeIn } from \"./d-animation-fade-in\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DFocusable } from \"./d-controller-focus\";\r\nimport { DDialogCloseOn } from \"./d-dialog-close-on\";\r\nimport { UtilClickOutside } from \"./util/util-click-outside\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\nimport { UtilOverlay } from \"./util/util-overlay\";\r\n\r\nexport interface DDialogOptions<THEME extends DThemeDialog = DThemeDialog> extends DBaseOptions<THEME> {\r\n\tcloseOn?: DDialogCloseOn;\r\n\tanimation?: DAnimation<DBase>;\r\n}\r\n\r\nexport interface DThemeDialog extends DThemeBase {\r\n\tcloseOn(): DDialogCloseOn;\r\n}\r\n\r\n/**\r\n * A base class for dialogs.\r\n *\r\n * If multiple application instances are there, better to set\r\n * the constructor option `parent` to an `application.stage`\r\n * so that the dialog picks a right application.\r\n *\r\n * By default, the dialog assumes the last created application is\r\n * the one it belongs to at the time when it is created.\r\n */\r\nexport class DDialog<\r\n\tTHEME extends DThemeDialog = DThemeDialog,\r\n\tOPTIONS extends DDialogOptions<THEME> = DDialogOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected _animation!: DAnimation<DBase>;\r\n\tprotected _closeOn!: DDialogCloseOn;\r\n\tprotected _focusable!: DFocusable | null;\r\n\tprotected _isOpened!: boolean;\r\n\tprotected _overlay!: UtilOverlay;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.visible = false;\r\n\t\tthis.setState( DBaseState.FOCUS_ROOT, true );\r\n\t\tthis._focusable = null;\r\n\t\tthis._isOpened = false;\r\n\r\n\t\t// Animation\r\n\t\tconst animation = this._animation = ( options && options.animation ?\r\n\t\t\toptions.animation : new DAnimationFadeIn() );\r\n\t\tanimation.target = this;\r\n\t\tanimation.on( \"end\", ( isReverse: boolean ): void => {\r\n\t\t\tthis.onAnimationEnd( isReverse );\r\n\t\t});\r\n\r\n\t\t// Close-on\r\n\t\tconst closeOn = this._closeOn = ( options && options.closeOn != null ?\r\n\t\t\toptions.closeOn : this.theme.closeOn()\r\n\t\t);\r\n\t\tif( closeOn & DDialogCloseOn.CLICK_OUTSIDE ) {\r\n\t\t\tUtilClickOutside.apply( this, (): void => {\r\n\t\t\t\tthis.onCloseOn();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._overlay = new UtilOverlay();\r\n\t}\r\n\r\n\tprotected onAnimationEnd( isReverse: boolean ) {\r\n\t\tif( isReverse ) {\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent ) {\r\n\t\t\t\tparent.removeChild( this );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\t\tthis._focusable = focusController.getFocused();\r\n\t\t\t\tconst firstFocusable = focusController.findFocusable( this, false, true, true );\r\n\t\t\t\tfocusController.setFocused( firstFocusable || this, true, true );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\topen(): void {\r\n\t\tif( ! this._isOpened ) {\r\n\t\t\tconst layer = this._overlay.pick( this );\r\n\t\t\tthis._isOpened = true;\r\n\t\t\tlayer.stage.addChild( this );\r\n\t\t\tthis.onOpen();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onOpen(): void {\r\n\t\tthis.emit( \"open\", this );\r\n\r\n\t\t// Animation\r\n\t\tthis._animation.start();\r\n\t}\r\n\r\n\tisOpened(): boolean {\r\n\t\treturn this._isOpened;\r\n\t}\r\n\r\n\tclose() {\r\n\t\tif( this._isOpened ) {\r\n\t\t\tthis._isOpened = false;\r\n\t\t\tthis.onClose();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onClose(): void {\r\n\t\t// Focus\r\n\t\tconst focusable = this._focusable;\r\n\t\tif( focusable != null ) {\r\n\t\t\tthis._focusable = null;\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.getFocusController().setFocused( focusable, true, false );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Animation\r\n\t\tthis._animation.start( true );\r\n\r\n\t\tthis.emit( \"close\", this );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialog\";\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tconst closeOn = this._closeOn;\r\n\t\tif( closeOn & DDialogCloseOn.ESC ) {\r\n\t\t\tif( UtilKeyboardEvent.isCancelKey( e ) ) {\r\n\t\t\t\tthis.onCloseOn();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn super.onKeyDown( e );\r\n\t}\r\n\r\n\tprotected onCloseOn(): void {\r\n\t\tthis.close();\r\n\t}\r\n\r\n\tprotected containsGlobalPoint( point: Point ): boolean {\r\n\t\treturn true;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DHtmlElementWhen {\r\n\tFOCUSED,\r\n\tALWAYS\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DLayout, DLayoutOptions, DThemeLayout } from \"./d-layout\";\r\n\r\nexport interface DLayoutHorizontalOptions<THEME extends DThemeLayoutHorizontal> extends DLayoutOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeLayoutHorizontal extends DThemeLayout {\r\n\r\n}\r\n\r\nexport class DLayoutHorizontal<\r\n\tTHEME extends DThemeLayoutHorizontal = DThemeLayoutHorizontal,\r\n\tOPTIONS extends DLayoutHorizontalOptions<THEME> = DLayoutHorizontalOptions<THEME>\r\n> extends DLayout<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DLayoutHorizontal\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton } from \"./d-button\";\r\nimport { DButtonPrimary } from \"./d-button-primary\";\r\nimport { DCoordinatePosition, DCoordinateSize } from \"./d-coordinate\";\r\nimport { DDialog, DDialogOptions, DThemeDialog } from \"./d-dialog\";\r\nimport { DLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DLayoutSpace } from \"./d-layout-space\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\n\r\nexport interface DDialogCommandOptions<\r\n\tTHEME extends DThemeDialogCommand = DThemeDialogCommand\r\n> extends DDialogOptions<THEME> {\r\n\tok?: string;\r\n\tcancel?: string;\r\n}\r\n\r\nexport interface DThemeDialogCommand extends DThemeDialog {\r\n\tgetOk(): string | null;\r\n\tgetCancel(): string | null;\r\n\tgetLayoutX(): DCoordinatePosition;\r\n\tgetLayoutY(): DCoordinatePosition;\r\n\tgetLayoutWidth(): DCoordinateSize;\r\n\tgetLayoutHeight(): DCoordinateSize;\r\n}\r\n\r\nexport class DDialogCommand<\r\n\tTHEME extends DThemeDialogCommand = DThemeDialogCommand,\r\n\tOPTIONS extends DDialogCommandOptions<THEME> = DDialogCommandOptions<THEME>\r\n> extends DDialog<THEME, OPTIONS> {\r\n\tprotected _promise: Promise<void> | null = null;\r\n\tprotected _resolve: (() => void) | null = null;\r\n\tprotected _reject: (() => void) | null = null;\r\n\tprotected _buttonLayout?: DLayoutHorizontal;\r\n\tprotected _buttonOk?: DButton;\r\n\tprotected _buttonCancel?: DButton;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tconst theme = this.theme;\r\n\t\tconst layout = new DLayoutVertical({\r\n\t\t\tparent: this,\r\n\t\t\tx: theme.getLayoutX(),\r\n\t\t\ty: theme.getLayoutY(),\r\n\t\t\twidth: theme.getLayoutWidth(),\r\n\t\t\theight: theme.getLayoutHeight()\r\n\t\t});\r\n\r\n\t\tthis.onInit( layout, options );\r\n\r\n\t\t// Buttons\r\n\t\tconst ok = ( options && options.ok || theme.getOk() );\r\n\t\tconst cancel = ( options && options.cancel || theme.getCancel() );\r\n\t\tif( ok != null || cancel != null ) {\r\n\t\t\tconst buttonLayout = new DLayoutHorizontal({\r\n\t\t\t\tparent: layout,\r\n\t\t\t\twidth: \"padding\", height: \"auto\",\r\n\t\t\t\tpadding: {\r\n\t\t\t\t\ttop: this.padding.getTop()\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis._buttonLayout = buttonLayout;\r\n\t\t\tnew DLayoutSpace({\r\n\t\t\t\tparent: buttonLayout,\r\n\t\t\t\tweight: 1\r\n\t\t\t});\r\n\t\t\tif( ok != null && cancel != null ) {\r\n\t\t\t\tthis._buttonCancel = new DButtonPrimary({\r\n\t\t\t\t\tparent: buttonLayout,\r\n\t\t\t\t\ttext: {\r\n\t\t\t\t\t\tvalue: cancel\r\n\t\t\t\t\t},\r\n\t\t\t\t\ton: {\r\n\t\t\t\t\t\tactive: (): void => {\r\n\t\t\t\t\t\t\tthis.onCancel();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis._buttonOk = new DButton({\r\n\t\t\t\t\tparent: buttonLayout,\r\n\t\t\t\t\ttext: {\r\n\t\t\t\t\t\tvalue: ok\r\n\t\t\t\t\t},\r\n\t\t\t\t\ton: {\r\n\t\t\t\t\t\tactive: (): void => {\r\n\t\t\t\t\t\t\tthis.onOk();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if( ok != null ) {\r\n\t\t\t\tthis._buttonOk = new DButtonPrimary({\r\n\t\t\t\t\tparent: buttonLayout,\r\n\t\t\t\t\ttext: {\r\n\t\t\t\t\t\tvalue: ok\r\n\t\t\t\t\t},\r\n\t\t\t\t\ton: {\r\n\t\t\t\t\t\tactive: (): void => {\r\n\t\t\t\t\t\t\tthis.onOk();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if( cancel != null ) {\r\n\t\t\t\tthis._buttonCancel = new DButtonPrimary({\r\n\t\t\t\t\tparent: buttonLayout,\r\n\t\t\t\t\ttext: {\r\n\t\t\t\t\t\tvalue: cancel\r\n\t\t\t\t\t},\r\n\t\t\t\t\ton: {\r\n\t\t\t\t\t\tactive: (): void => {\r\n\t\t\t\t\t\t\tthis.onCancel();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tnew DLayoutSpace({\r\n\t\t\t\tparent: buttonLayout,\r\n\t\t\t\tweight: 1\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onInit( layout: DLayoutVertical, options?: OPTIONS ) {\r\n\t\t// OVERRIDE THIS\r\n\t}\r\n\r\n\topen(): Promise<void> {\r\n\t\tsuper.open();\r\n\t\treturn this._promise!;\r\n\t}\r\n\r\n\tprotected onOpen() {\r\n\t\tsuper.onOpen();\r\n\r\n\t\tif( this._promise == null ) {\r\n\t\t\tthis._promise = new Promise(( resolve, reject ): void => {\r\n\t\t\t\tthis._resolve = resolve;\r\n\t\t\t\tthis._reject = reject;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onClose() {\r\n\t\tsuper.onClose();\r\n\r\n\t\tconst reject = this._reject;\r\n\t\tthis._promise = null;\r\n\t\tthis._resolve = null;\r\n\t\tthis._reject = null;\r\n\r\n\t\tif( reject != null ) {\r\n\t\t\treject();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onOk() {\r\n\t\tconst resolve = this._resolve;\r\n\t\tthis._promise = null;\r\n\t\tthis._resolve = null;\r\n\t\tthis._reject = null;\r\n\r\n\t\tthis.close();\r\n\r\n\t\tif( resolve != null ) {\r\n\t\t\tresolve();\r\n\t\t}\r\n\r\n\t\tthis.emit( \"ok\", this );\r\n\t}\r\n\r\n\tprotected onCancel() {\r\n\t\tconst reject = this._reject;\r\n\t\tthis._promise = null;\r\n\t\tthis._resolve = null;\r\n\t\tthis._reject = null;\r\n\r\n\t\tthis.close();\r\n\r\n\t\tif( reject != null ) {\r\n\t\t\treject();\r\n\t\t}\r\n\r\n\t\tthis.emit( \"cancel\", this );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogCommand\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point, Rectangle, Renderer, Text } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DDynamicText } from \"./d-dynamic-text\";\r\nimport { DHtmlElementWhen } from \"./d-html-element-when\";\r\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\r\nimport { DPadding } from \"./d-padding\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport type DHtmlElementElementCreator<T> = ( parent: HTMLElement ) => T;\r\n\r\nexport type DHtmlElementStyle<THEME extends DThemeHtmlElement> = (\r\n\ttarget: HTMLElement,\r\n\tstate: DBaseState, theme: THEME, padding: DPadding,\r\n\telementRect: Rectangle, clipperRect: Rectangle\r\n) => void;\r\n\r\nexport type DHtmlElementStyleBefore<THEME extends DThemeHtmlElement> =\r\n\t( target: HTMLElement, theme: THEME ) => void;\r\n\r\nexport type DHtmlElementStyleAfter<THEME extends DThemeHtmlElement> =\r\n\t( target: HTMLElement, theme: THEME ) => void;\r\n\r\nexport interface DHtmlElementElementOptions<ELEMENT, THEME extends DThemeHtmlElement> {\r\n\tcreator?: DHtmlElementElementCreator<ELEMENT>;\r\n\tstyle?: DHtmlElementStyle<THEME>;\r\n}\r\n\r\nexport interface DHtmlElementClipperOptions<THEME extends DThemeHtmlElement> {\r\n\tcreator?: DHtmlElementElementCreator<HTMLDivElement>;\r\n\tstyle?: DHtmlElementStyle<THEME>;\r\n}\r\n\r\nexport interface DHtmlElementBeforeOptions<THEME extends DThemeHtmlElement> {\r\n\tcreator?: DHtmlElementElementCreator<HTMLDivElement>;\r\n\tstyle?: DHtmlElementStyleBefore<THEME>;\r\n}\r\n\r\nexport interface DHtmlElementAfterOptions<THEME extends DThemeHtmlElement> {\r\n\tcreator?: DHtmlElementElementCreator<HTMLDivElement>;\r\n\tstyle?: DHtmlElementStyleAfter<THEME>;\r\n}\r\n\r\nexport interface DHtmlElementOptions<\r\n\tVALUE = unknown,\r\n\tELEMENT extends HTMLElement = HTMLElement,\r\n\tTHEME extends DThemeHtmlElement<ELEMENT> = DThemeHtmlElement<ELEMENT>\r\n> extends DImageBaseOptions<VALUE, THEME> {\r\n\telement?: DHtmlElementElementOptions<ELEMENT, THEME>;\r\n\tclipper?: DHtmlElementClipperOptions<THEME>;\r\n\tbefore?: DHtmlElementBeforeOptions<THEME>;\r\n\tafter?: DHtmlElementAfterOptions<THEME>;\r\n\twhen?: DHtmlElementWhen | (keyof typeof DHtmlElementWhen);\r\n\tselect?: boolean;\r\n}\r\n\r\nexport interface DThemeHtmlElement<\r\n\tELEMENT extends HTMLElement = HTMLElement\r\n> extends DThemeImageBase {\r\n\tgetElementCreator(): DHtmlElementElementCreator<ELEMENT> | null;\r\n\tsetElementStyle(\r\n\t\ttarget: ELEMENT, state: DBaseState, padding: DPadding,\r\n\t\telementRect: Rectangle, clipperRect: Rectangle\r\n\t): void;\r\n\tgetClipperCreator(): DHtmlElementElementCreator<HTMLDivElement> | null;\r\n\tsetClipperStyle(\r\n\t\ttarget: HTMLDivElement, state: DBaseState, padding: DPadding,\r\n\t\telementRect: Rectangle, clipperRect: Rectangle\r\n\t): void;\r\n\tgetBeforeCreator(): DHtmlElementElementCreator<HTMLDivElement> | null;\r\n\tsetBeforeStyle( target: HTMLDivElement ): void;\r\n\tgetAfterCreator(): DHtmlElementElementCreator<HTMLDivElement> | null;\r\n\tsetAfterStyle( target: HTMLDivElement ): void;\r\n\tgetWhen(): DHtmlElementWhen;\r\n\tgetSelect(): boolean;\r\n}\r\n\r\nexport class DHtmlElement<\r\n\tVALUE = unknown,\r\n\tELEMENT extends HTMLElement = HTMLElement,\r\n\tTHEME extends DThemeHtmlElement<ELEMENT> = DThemeHtmlElement<ELEMENT>,\r\n\tOPTIONS extends DHtmlElementOptions<VALUE, ELEMENT, THEME> = DHtmlElementOptions<VALUE, ELEMENT, THEME>\r\n> extends DImageBase<VALUE, THEME, OPTIONS> {\r\n\tprotected _workPoint!: Point | null;\r\n\r\n\tprotected _clipper!: HTMLDivElement | null;\r\n\tprotected _clipperCreator!: DHtmlElementElementCreator<HTMLDivElement> | null;\r\n\tprotected _clipperStyle!: DHtmlElementStyle<THEME> | undefined;\r\n\tprotected _clipperRect!: Rectangle | null;\r\n\r\n\tprotected _element!: ELEMENT | null;\r\n\tprotected _elementCreator!: DHtmlElementElementCreator<ELEMENT> | null;\r\n\tprotected _elementStyle!: DHtmlElementStyle<THEME> | undefined;\r\n\tprotected _elementRect!: Rectangle | null;\r\n\tprotected _isElementShown!: boolean;\r\n\tprotected _onElementFocusedBound!: ( e: FocusEvent ) => void;\r\n\r\n\tprotected _before!: HTMLDivElement | null;\r\n\tprotected _beforeCreator!: DHtmlElementElementCreator<HTMLDivElement> | null;\r\n\tprotected _beforeStyle!: DHtmlElementStyleBefore<THEME> | undefined;\r\n\tprotected _onBeforeFocusedBound!: ( e: FocusEvent ) => void;\r\n\r\n\tprotected _after!: HTMLDivElement | null;\r\n\tprotected _afterCreator!: DHtmlElementElementCreator<HTMLDivElement> | null;\r\n\tprotected _afterStyle!: DHtmlElementStyleAfter<THEME> | undefined;\r\n\tprotected _onAfterFocusedBound!: ( e: FocusEvent ) => void;\r\n\r\n\tprotected _isStarted!: boolean;\r\n\tprotected _select!: boolean;\r\n\tprotected _doSelectBound!: () => void;\r\n\tprotected _when!: DHtmlElementWhen;\r\n\tprotected _isStartRequested!: boolean;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._workPoint = null;\r\n\r\n\t\tconst theme = this.theme;\r\n\t\tconst clipper = options && options.clipper;\r\n\t\tconst clipperCreator = (clipper && clipper.creator) || theme.getClipperCreator();\r\n\t\tthis._clipper = null;\r\n\t\tthis._clipperCreator = clipperCreator;\r\n\t\tthis._clipperRect = null;\r\n\r\n\t\tconst element = options && options.element;\r\n\t\tconst elementCreator = (element && element.creator) || theme.getElementCreator();\r\n\t\tthis._element = null;\r\n\t\tthis._elementCreator = elementCreator;\r\n\t\tthis._elementStyle = element && element.style;\r\n\t\tthis._elementRect = null;\r\n\t\tthis._isElementShown = false;\r\n\t\tthis._onElementFocusedBound = ( e: FocusEvent ): void => {\r\n\t\t\tthis.onElementFocused( e );\r\n\t\t};\r\n\r\n\t\tconst before = options && options.before;\r\n\t\tthis._before = null;\r\n\t\tthis._beforeCreator = (before && before.creator) || theme.getBeforeCreator();\r\n\t\tthis._beforeStyle = before && before.style;\r\n\t\tthis._onBeforeFocusedBound = ( e: FocusEvent ): void => {\r\n\t\t\tthis.onBeforeFocused( e );\r\n\t\t};\r\n\r\n\t\tconst after = options && options.after;\r\n\t\tthis._after = null;\r\n\t\tthis._afterCreator = (after && after.creator) || theme.getAfterCreator();\r\n\t\tthis._afterStyle = after && after.style;\r\n\t\tthis._onAfterFocusedBound = ( e: FocusEvent ): void => {\r\n\t\t\tthis.onAfterFocused( e );\r\n\t\t};\r\n\r\n\t\tthis._isStarted = false;\r\n\t\tthis._select = ( options && options.select != null ?\r\n\t\t\toptions.select : theme.getSelect()\r\n\t\t);\r\n\t\tthis._doSelectBound = () => {\r\n\t\t\tthis.doSelect();\r\n\t\t};\r\n\t\tconst when = ( options && options.when != null ?\r\n\t\t\t( isString( options.when ) ? DHtmlElementWhen[ options.when ] : options.when ) :\r\n\t\t\ttheme.getWhen()\r\n\t\t);\r\n\t\tthis._when = when;\r\n\t\tthis._isStartRequested = ( when === DHtmlElementWhen.ALWAYS );\r\n\t}\r\n\r\n\tget element(): ELEMENT | null {\r\n\t\treturn this._element;\r\n\t}\r\n\r\n\tprotected onDownThis( e: interaction.InteractionEvent ): void {\r\n\t\tconst wasStarted = this._isStarted;\r\n\t\tsuper.onDownThis( e );\r\n\t\tif( ! wasStarted && this._isStarted ) {\r\n\t\t\te.data.originalEvent.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onFocused(): void {\r\n\t\tsuper.onFocused();\r\n\t\tif( this._when === DHtmlElementWhen.FOCUSED ) {\r\n\t\t\tthis.start();\r\n\t\t} else {\r\n\t\t\tconst element = this._element;\r\n\t\t\tif( element ) {\r\n\t\t\t\telement.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onBlured(): void {\r\n\t\tsuper.onBlured();\r\n\t\tif( this._when === DHtmlElementWhen.FOCUSED ) {\r\n\t\t\tthis.onEndByBlured();\r\n\t\t\tthis.cancel();\r\n\t\t} else {\r\n\t\t\tconst element = this._element;\r\n\t\t\tif( element ) {\r\n\t\t\t\telement.blur();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected isStartable(): boolean {\r\n\t\tif( this._when === DHtmlElementWhen.FOCUSED ) {\r\n\t\t\treturn this.isActionable();\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tstart(): void {\r\n\t\tif( ! this._isStarted && this.isStartable() ) {\r\n\t\t\tthis._isStarted = true;\r\n\t\t\tthis.doStart();\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t}\r\n\r\n\trender( renderer: Renderer ): void {\r\n\t\tif( this._isStartRequested ) {\r\n\t\t\tthis._isStartRequested = false;\r\n\t\t\tthis.doStart();\r\n\t\t}\r\n\t\tif( this._isStarted ) {\r\n\t\t\tthis._isStarted = false;\r\n\t\t}\r\n\t\tsuper.render( renderer );\r\n\t\tif( this._isElementShown ) {\r\n\t\t\tthis.updateElement( renderer );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected doStart( renderer?: Renderer ): void {\r\n\t\tif( ! this._isElementShown ) {\r\n\t\t\tthis._isElementShown = true;\r\n\r\n\t\t\tthis.onStart();\r\n\r\n\t\t\tconst clipper = this.getClipper();\r\n\t\t\tif( clipper ) {\r\n\t\t\t\tconst before = this.getBefore( clipper );\r\n\t\t\t\tconst element = this.getElement( clipper );\r\n\t\t\t\tconst after = this.getAfter( clipper );\r\n\t\t\t\tif( element ) {\r\n\t\t\t\t\tlet resolution = 1;\r\n\t\t\t\t\tif( renderer == null ) {\r\n\t\t\t\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\t\t\t\tif( layer ) {\r\n\t\t\t\t\t\t\tresolution = layer.renderer.resolution;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresolution = renderer.resolution;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst elementRect = this.getElementRect( resolution );\r\n\t\t\t\t\tconst clipperRect = this.getClipperRect( elementRect, resolution );\r\n\t\t\t\t\tconst theme = this.theme;\r\n\t\t\t\t\tconst state = this.state;\r\n\t\t\t\t\tconst padding = this._padding;\r\n\t\t\t\t\tthis.setClipperStyle( clipper, state, theme, padding, elementRect, clipperRect );\r\n\t\t\t\t\tthis.setElementStyle( element, state, theme, padding, elementRect, clipperRect );\r\n\t\t\t\t\tif( before ) {\r\n\t\t\t\t\t\tthis.setBeforeStyle( before, theme );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( after ) {\r\n\t\t\t\t\t\tthis.setAfterStyle( after, theme );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.onElementAttached( element, before, after );\r\n\r\n\t\t\t\t\t// Show HTML elements\r\n\t\t\t\t\tclipper.style.display = \"\";\r\n\t\t\t\t\tif( this.isFocused() ) {\r\n\t\t\t\t\t\telement.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tclipper.scrollTop = 0;\r\n\t\t\t\t\tclipper.scrollLeft = 0;\r\n\r\n\t\t\t\t\t// Select the element if required.\r\n\t\t\t\t\tif( this._select ) {\r\n\t\t\t\t\t\tsetTimeout( this._doSelectBound, 0 );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected doSelect(): void {\r\n\t\tconst element = this._element;\r\n\t\tif( element ) {\r\n\t\t\tif( element instanceof HTMLInputElement || element instanceof HTMLTextAreaElement ) {\r\n\t\t\t\t// The following does not work on mobile devices.\r\n\t\t\t\t// I think selecting texts on a tap is annoying.\r\n\t\t\t\t// Though I leave this untouched.\r\n\t\t\t\telement.select();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected createText( formatted: string ): Text | DDynamicText {\r\n\t\tconst result = super.createText( formatted );\r\n\t\tif( this._isElementShown ) {\r\n\t\t\tthis.onStart();\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Please note that this method does not update transforms.\r\n\t *\r\n\t * @param elementRect\r\n\t * @param resolution\r\n\t */\r\n\tprotected getClipperRect( elementRect: Rectangle, resolution: number ): Rectangle {\r\n\t\tconst point = this._workPoint = ( this._workPoint || new Point( 0, 0 ) );\r\n\t\tconst rect = this._clipperRect = ( this._clipperRect || new Rectangle() );\r\n\r\n\t\tlet x0 = elementRect.x;\r\n\t\tlet y0 = elementRect.y;\r\n\t\tlet x1 = x0 + elementRect.width;\r\n\t\tlet y1 = y0 + elementRect.height;\r\n\r\n\t\tlet current = this.parent;\r\n\t\twhile( current instanceof DBase ) {\r\n\t\t\tcurrent.getClippingRect( this, rect );\r\n\r\n\t\t\tpoint.set( rect.x, rect.y );\r\n\t\t\tcurrent.toGlobal( point, point, false );\r\n\t\t\tconst x = ( (point.x * resolution) | 0 ) / resolution;\r\n\t\t\tconst y = ( (point.y * resolution) | 0 ) / resolution;\r\n\r\n\t\t\tpoint.set( rect.x + rect.width, rect.y + rect.height );\r\n\t\t\tcurrent.toGlobal( point, point, true );\r\n\t\t\tconst w = point.x - x;\r\n\t\t\tconst h = point.y - y;\r\n\r\n\t\t\tx0 = Math.min( Math.max( x0, x ), x + w );\r\n\t\t\ty0 = Math.min( Math.max( y0, y ), y + h );\r\n\r\n\t\t\tx1 = Math.min( Math.max( x1, x ), x + w );\r\n\t\t\ty1 = Math.min( Math.max( y1, y ), y + h );\r\n\r\n\t\t\tcurrent = current.parent;\r\n\t\t}\r\n\r\n\t\trect.x = x0;\r\n\t\trect.y = y0;\r\n\t\trect.width = x1 - x0;\r\n\t\trect.height = y1 - y0;\r\n\t\treturn rect;\r\n\t}\r\n\r\n\t/**\r\n\t * Please note that this method does not update transforms.\r\n\t *\r\n\t * @param resolution\r\n\t */\r\n\tprotected getElementRect( resolution: number ): Rectangle {\r\n\t\tconst point = this._workPoint = ( this._workPoint || new Point( 0, 0 ) );\r\n\t\tconst rect = this._elementRect = ( this._elementRect != null ? this._elementRect : new Rectangle() );\r\n\r\n\t\tpoint.set( 0, 0 );\r\n\t\tthis.toGlobal( point, point, false );\r\n\t\trect.x = point.x;\r\n\t\trect.y = point.y;\r\n\r\n\t\tpoint.set( this.width, this.height );\r\n\t\tthis.toGlobal( point, point, true );\r\n\t\trect.width = point.x - rect.x;\r\n\t\trect.height = point.y - rect.y;\r\n\r\n\t\t// Rounds pixels as Pixi.js does\r\n\t\trect.x = ( (rect.x * resolution) | 0 ) / resolution;\r\n\t\trect.y = ( (rect.y * resolution) | 0 ) / resolution;\r\n\r\n\t\treturn rect;\r\n\t}\r\n\r\n\tcancel(): void {\r\n\t\tif( this._isElementShown ) {\r\n\t\t\tthis._isElementShown = false;\r\n\r\n\t\t\tthis.onCancel();\r\n\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tconst view = layer.view;\r\n\t\t\t\tif( this._when === DHtmlElementWhen.FOCUSED && document.activeElement === this._element ) {\r\n\t\t\t\t\tview.focus();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\r\n\t\t\t\tif( this.containsPoint( interactionManager.mouse.global ) && ! this.isHovered() ) {\r\n\t\t\t\t\tthis.setHovered( true );\r\n\t\t\t\t\tview.style.cursor = this.cursor;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayer.update();\r\n\t\t\t}\r\n\r\n\t\t\tconst element = this._element;\r\n\t\t\tif( element != null ) {\r\n\t\t\t\tthis.onElementDetached( element, this._before, this._after );\r\n\t\t\t}\r\n\r\n\t\t\tconst clipper = this._clipper;\r\n\t\t\tif( clipper != null ) {\r\n\t\t\t\tclipper.style.display = \"none\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onStart(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected onCancel(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected onElementAttached(\r\n\t\telement: ELEMENT, before: HTMLDivElement | null, after: HTMLDivElement | null\r\n\t): void {\r\n\t\tif( before ) {\r\n\t\t\tbefore.addEventListener( \"focus\", this._onBeforeFocusedBound );\r\n\t\t}\r\n\t\tif( after ) {\r\n\t\t\tafter.addEventListener( \"focus\", this._onAfterFocusedBound );\r\n\t\t}\r\n\t\telement.addEventListener( \"focus\", this._onElementFocusedBound, true );\r\n\t}\r\n\r\n\tprotected onElementDetached(\r\n\t\telement: ELEMENT, before: HTMLDivElement | null, after: HTMLDivElement | null\r\n\t): void {\r\n\t\tif( before ) {\r\n\t\t\tbefore.removeEventListener( \"focus\", this._onBeforeFocusedBound );\r\n\t\t}\r\n\t\tif( after ) {\r\n\t\t\tafter.removeEventListener( \"focus\", this._onAfterFocusedBound );\r\n\t\t}\r\n\t\telement.removeEventListener( \"focus\", this._onElementFocusedBound, true );\r\n\t}\r\n\r\n\tprotected getElement( clipper: HTMLDivElement ): ELEMENT | null {\r\n\t\tlet result = this._element;\r\n\t\tif( result == null ) {\r\n\t\t\tconst creator = this._elementCreator;\r\n\t\t\tif( creator ) {\r\n\t\t\t\tresult = creator( clipper );\r\n\t\t\t\tthis._element = result;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getClipper(): HTMLDivElement | null {\r\n\t\tlet result = this._clipper;\r\n\t\tif( result == null ) {\r\n\t\t\tconst creator = this._clipperCreator;\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( creator && layer ) {\r\n\t\t\t\tresult = creator( layer.getElementContainer() );\r\n\t\t\t\tthis._clipper = result;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getBefore( clipper: HTMLDivElement ): HTMLDivElement | null {\r\n\t\tlet result = this._before;\r\n\t\tif( result == null ) {\r\n\t\t\tconst creator = this._beforeCreator;\r\n\t\t\tif( creator ) {\r\n\t\t\t\tresult = creator( clipper );\r\n\t\t\t\tthis._before = result;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getAfter( clipper: HTMLDivElement ): HTMLDivElement | null {\r\n\t\tlet result = this._after;\r\n\t\tif( result == null ) {\r\n\t\t\tconst creator = this._afterCreator;\r\n\t\t\tif( creator ) {\r\n\t\t\t\tresult = creator( clipper );\r\n\t\t\t\tthis._after = result;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected setElementStyle(\r\n\t\ttarget: ELEMENT,\r\n\t\tstate: DBaseState, theme: THEME, padding: DPadding,\r\n\t\telementRect: Rectangle, clipperRect: Rectangle\r\n\t): void {\r\n\t\tconst style = this._elementStyle;\r\n\t\tif( style ) {\r\n\t\t\treturn style( target, state, theme, padding, elementRect, clipperRect );\r\n\t\t} else {\r\n\t\t\treturn this.theme.setElementStyle( target, state, padding, elementRect, clipperRect );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setClipperStyle(\r\n\t\ttarget: HTMLDivElement,\r\n\t\tstate: DBaseState, theme: THEME, padding: DPadding,\r\n\t\telementRect: Rectangle, clipperRect: Rectangle\r\n\t): void {\r\n\t\tconst style = this._clipperStyle;\r\n\t\tif( style ) {\r\n\t\t\treturn style( target, state, theme, padding, elementRect, clipperRect );\r\n\t\t} else {\r\n\t\t\treturn this.theme.setClipperStyle( target, state, padding, elementRect, clipperRect );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setBeforeStyle( target: HTMLDivElement, theme: THEME ): void {\r\n\t\tconst style = this._beforeStyle;\r\n\t\tif( style ) {\r\n\t\t\treturn style( target, theme );\r\n\t\t} else {\r\n\t\t\treturn this.theme.setBeforeStyle( target );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setAfterStyle( target: HTMLDivElement, theme: THEME ): void {\r\n\t\tconst style = this._afterStyle;\r\n\t\tif( style ) {\r\n\t\t\treturn style( target, theme );\r\n\t\t} else {\r\n\t\t\treturn this.theme.setAfterStyle( target );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onBeforeFocused( e: FocusEvent ): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\tconst focusable = focusController.findFocusable( this, false, false, false );\r\n\t\t\tlayer.view.focus();\r\n\t\t\tfocusController.setFocused( focusable, true, true );\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onAfterFocused( e: FocusEvent ): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\tconst focusable = focusController.findFocusable( this, false, false, true );\r\n\t\t\tlayer.view.focus();\r\n\t\t\tfocusController.setFocused( focusable, true, true );\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onElementFocused( e: FocusEvent ): void {\r\n\t\tif( this._when === DHtmlElementWhen.ALWAYS ) {\r\n\t\t\tif( ! this.isFocused() ) {\r\n\t\t\t\tthis.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onEndByBlured(): void {\r\n\t\tthis.onEnd();\r\n\t}\r\n\r\n\tprotected onEnd(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tend(): void {\r\n\t\tthis.onEnd();\r\n\t\tthis.cancel();\r\n\t}\r\n\r\n\tselect(): this {\r\n\t\tif( this._isElementShown && this._select ) {\r\n\t\t\tthis.doSelect();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprotected updateElement( renderer: Renderer ) {\r\n\t\tif( this._isElementShown ) {\r\n\t\t\tif( this.worldVisible ) {\r\n\t\t\t\tconst element = this._element;\r\n\t\t\t\tconst clipper = this._clipper;\r\n\t\t\t\tif( element && clipper ) {\r\n\t\t\t\t\tconst resolution = renderer.resolution;\r\n\t\t\t\t\tconst elementRect = this.getElementRect( resolution );\r\n\t\t\t\t\tconst clipperRect = this.getClipperRect( elementRect, resolution );\r\n\t\t\t\t\tconst theme = this.theme;\r\n\t\t\t\t\tconst state = this.state;\r\n\t\t\t\t\tconst padding = this._padding;\r\n\t\t\t\t\tthis.setClipperStyle( clipper, state, theme, padding, elementRect, clipperRect );\r\n\t\t\t\t\tthis.setElementStyle( element, state, theme, padding, elementRect, clipperRect );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.cancel();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DHtmlElement\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DPickerDatetimeMask {\r\n\tNONE = 0,\r\n\tDATE = 1,\r\n\tHOURS = 2,\r\n\tMINUTES = 4,\r\n\tSECONDS = 8,\r\n\tALL = DATE | HOURS | MINUTES | SECONDS\r\n}\r\n","import { interaction } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DHtmlElement, DHtmlElementOptions, DThemeHtmlElement } from \"./d-html-element\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\n\r\nexport interface DInputEditingOptions<VALUE = unknown> {\r\n\tformatter?: ( value: VALUE ) => string;\r\n\tunformatter?: ( text: string ) => VALUE;\r\n\tvalidator?: ( value: VALUE ) => string | null;\r\n}\r\n\r\nexport interface DInputOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeInput = DThemeInput\r\n> extends DHtmlElementOptions<VALUE, HTMLInputElement, THEME> {\r\n\tdescription?: string;\r\n\tediting?: DInputEditingOptions<VALUE>;\r\n}\r\n\r\nexport interface DThemeInput extends DThemeHtmlElement<HTMLInputElement> {\r\n\tgetEditingFormatter(): ( value: any, caller: any ) => string;\r\n\tgetEditingUnformatter(): ( text: string, caller: any ) => any;\r\n\tgetEditingValidator(): ( value: any, caller: any ) => unknown;\r\n}\r\n\r\nexport abstract class DInput<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeInput = DThemeInput,\r\n\tOPTIONS extends DInputOptions<VALUE, THEME> = DInputOptions<VALUE, THEME>\r\n> extends DHtmlElement<VALUE, HTMLInputElement, THEME, OPTIONS> {\r\n\tprotected _description!: string;\r\n\r\n\tprotected _onInputKeyDownBound!: ( e: KeyboardEvent ) => void;\r\n\tprotected _onInputChangeBound!: ( e: Event ) => void;\r\n\tprotected _onInputInputBound!: ( e: Event ) => void;\r\n\r\n\tprotected _editingFormatter!: ( value: VALUE, caller: any ) => string;\r\n\tprotected _editingUnformatter!: ( text: string, caller: any ) => VALUE;\r\n\tprotected _editingValidator!: ( value: VALUE, caller: any ) => unknown;\r\n\tprotected _editingValidationResult!: unknown;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tthis._editingValidationResult = null;\r\n\t\tthis._editingValidator = ( options && options.editing && options.editing.validator ) ||\r\n\t\t\tthis.theme.getEditingValidator();\r\n\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._description = ( options && options.description ) || \"\";\r\n\r\n\t\tthis._editingFormatter = ( options && options.editing && options.editing.formatter ) ||\r\n\t\t\t( options && options.text && options.text.formatter ) ||\r\n\t\t\tthis.theme.getEditingFormatter();\r\n\t\tthis._editingUnformatter = ( options && options.editing && options.editing.unformatter ) ||\r\n\t\t\tthis.theme.getEditingUnformatter();\r\n\r\n\t\tthis._onInputKeyDownBound = ( e: KeyboardEvent ): void => {\r\n\t\t\tthis.onInputKeyDown( e );\r\n\t\t};\r\n\t\tthis._onInputChangeBound = (): void => {\r\n\t\t\tthis.onInputChange();\r\n\t\t};\r\n\t\tthis._onInputInputBound = ( e: Event ): void => {\r\n\t\t\tthis.onInputInput( e );\r\n\t\t};\r\n\t}\r\n\r\n\tget value(): VALUE {\r\n\t\treturn this._textValueComputed;\r\n\t}\r\n\r\n\tset value( value: VALUE ) {\r\n\t\tthis.text = value;\r\n\t}\r\n\r\n\tprotected onTextChange(): void {\r\n\t\tsuper.onTextChange();\r\n\t\tthis.validate();\r\n\t}\r\n\r\n\tvalidate(): unknown {\r\n\t\tconst result = this._editingValidator( this._textValueComputed, this );\r\n\t\tif( this._editingValidationResult !== result ) {\r\n\t\t\tthis._editingValidationResult = result;\r\n\t\t\tthis.setInvalid( result != null );\r\n\t\t\tif( this.isHovered() ) {\r\n\t\t\t\tthis.applyTitle();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected applyTitle(): void {\r\n\t\tconst editingValidationResult = this._editingValidationResult;\r\n\t\tif( isString( editingValidationResult ) ) {\r\n\t\t\tconst layer = DApplications.getLayer( this );\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.view.title = editingValidationResult;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsuper.applyTitle();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onStart(): void {\r\n\t\tsuper.onStart();\r\n\r\n\t\tconst text = this._text;\r\n\t\tif( text != null ) {\r\n\t\t\ttext.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onCancel(): void {\r\n\t\tsuper.onCancel();\r\n\r\n\t\tconst text = this._text;\r\n\t\tif( text != null ) {\r\n\t\t\ttext.visible = true;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onEnd(): void {\r\n\t\tsuper.onEnd();\r\n\t\tthis.onInputChange();\r\n\t}\r\n\r\n\tprotected onElementAttached(\r\n\t\telement: HTMLInputElement, before: HTMLDivElement | null, after: HTMLDivElement | null\r\n\t): void {\r\n\t\tsuper.onElementAttached( element, before, after );\r\n\t\telement.type = this.getInputType();\r\n\t\telement.value = this._editingFormatter( this._textValueComputed, this );\r\n\t\telement.addEventListener( \"keydown\", this._onInputKeyDownBound );\r\n\t\telement.addEventListener( \"change\", this._onInputChangeBound );\r\n\t\telement.addEventListener( \"input\", this._onInputInputBound );\r\n\t}\r\n\r\n\tprotected onElementDetached(\r\n\t\telement: HTMLInputElement, before: HTMLDivElement | null, after: HTMLDivElement | null\r\n\t): void {\r\n\t\tsuper.onElementDetached( element, before, after );\r\n\t\telement.removeEventListener( \"keydown\", this._onInputKeyDownBound );\r\n\t\telement.removeEventListener( \"change\", this._onInputChangeBound );\r\n\t\telement.removeEventListener( \"input\", this._onInputInputBound );\r\n\t}\r\n\r\n\tprotected onInputKeyDown( e: KeyboardEvent ) {\r\n\t\tif( UtilKeyboardEvent.isOkKey( e ) ) {\r\n\t\t\tthis.end();\r\n\t\t\tthis.emit( \"enter\", this );\r\n\t\t} else if( UtilKeyboardEvent.isCancelKey( e ) ) {\r\n\t\t\tthis.cancel();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onInputChange() {\r\n\t\tif( this._isElementShown ) {\r\n\t\t\tconst element = this._element;\r\n\t\t\tif( element != null ) {\r\n\t\t\t\tconst newValue = this.toValue( element.value );\r\n\t\t\t\tconst oldValue = this._textValueComputed;\r\n\t\t\t\tif( oldValue !== newValue ) {\r\n\t\t\t\t\tthis.text = newValue;\r\n\t\t\t\t\tthis.emit( \"change\", newValue, oldValue, this );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onInputInput( e: Event ) {\r\n\t\tif( e.target instanceof HTMLInputElement ) {\r\n\t\t\tthis.emit( \"input\", this.toValue( e.target.value ), this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onDownThis( e: interaction.InteractionEvent ): void {\r\n\t\tif( this.isFocused() ) {\r\n\t\t\tthis.start();\r\n\t\t}\r\n\t\tsuper.onDownThis( e );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DInput\";\r\n\t}\r\n\r\n\tprotected abstract toValue( valueAsString: string ): VALUE;\r\n\tprotected abstract getInputType(): string;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DInput, DInputOptions, DThemeInput } from \"./d-input\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\n\r\nexport interface DInputNumberOptions<\r\n\tTHEME extends DThemeInputNumber = DThemeInputNumber\r\n> extends DInputOptions<number, THEME> {\r\n\tstep?: number | null;\r\n\tmin?: number | null;\r\n\tmax?: number | null;\r\n}\r\n\r\nexport interface DThemeInputNumber extends DThemeInput {\r\n\tgetEditingFormatter(): ( value: number, caller: any ) => string;\r\n\tgetEditingUnformatter(): ( text: string, caller: any ) => number;\r\n\tgetEditingValidator(): ( value: number, caller: any ) => unknown;\r\n\tgetTextValue( state: DBaseState ): number;\r\n\tnewTextValue(): DStateAwareOrValueMightBe<number>;\r\n\tgetStep(): number | null;\r\n\tgetMin(): number | null;\r\n\tgetMax(): number | null;\r\n}\r\n\r\n// Option parser\r\nconst toStep = <THEME extends DThemeInputNumber>(\r\n\ttheme: THEME, options?: DInputNumberOptions<THEME>\r\n): number | null => {\r\n\tif( options != null ) {\r\n\t\treturn ( options.step != null ? options.step : theme.getStep() );\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nconst toMin = <THEME extends DThemeInputNumber>(\r\n\ttheme: THEME, options?: DInputNumberOptions<THEME>\r\n): number | null => {\r\n\tif( options != null ) {\r\n\t\treturn ( options.min != null ? options.min : theme.getMin() );\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nconst toMax = <THEME extends DThemeInputNumber>(\r\n\ttheme: THEME, options?: DInputNumberOptions<THEME>\r\n): number | null => {\r\n\tif( options != null ) {\r\n\t\treturn ( options.max != null ? options.max : theme.getMax() );\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nexport abstract class DInputNumber<\r\n\tTHEME extends DThemeInputNumber = DThemeInputNumber,\r\n\tOPTIONS extends DInputNumberOptions<THEME> = DInputNumberOptions<THEME>\r\n> extends DInput<number, THEME, OPTIONS> {\r\n\tprotected _step!: number | null;\r\n\tprotected _min!: number | null;\r\n\tprotected _max!: number | null;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tconst theme = this.theme;\r\n\t\tthis._step = toStep( theme, options );\r\n\t\tthis._min = toMin( theme, options );\r\n\t\tthis._max = toMax( theme, options );\r\n\t}\r\n\r\n\tget step(): number | null {\r\n\t\treturn this._step;\r\n\t}\r\n\r\n\tset step( step: number | null ) {\r\n\t\tif( this._step !== step ) {\r\n\t\t\tthis._step = step;\r\n\t\t\tthis.updateInputStep();\r\n\t\t}\r\n\t}\r\n\r\n\tget min(): number | null {\r\n\t\treturn this._min;\r\n\t}\r\n\r\n\tset min( min: number | null ) {\r\n\t\tif( this._min !== min ) {\r\n\t\t\tthis._min = min;\r\n\t\t\tthis.updateInputMin();\r\n\t\t}\r\n\t}\r\n\r\n\tget max(): number | null {\r\n\t\treturn this._max;\r\n\t}\r\n\r\n\tset max( max: number | null ) {\r\n\t\tif( this._max !== max ) {\r\n\t\t\tthis._max = max;\r\n\t\t\tthis.updateInputMax();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toValue( valueAsString: string ): number {\r\n\t\tconst result = this._editingUnformatter( valueAsString, this );\r\n\t\tif( result === result /* NaN Check */ ) {\r\n\t\t\tif( this._min != null && result < this._min ) {\r\n\t\t\t\treturn this._min;\r\n\t\t\t}\r\n\t\t\tif( this._max != null && this._max < result ) {\r\n\t\t\t\treturn this._max;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn this.value;\r\n\t}\r\n\r\n\tprotected updateInputStep(): void {\r\n\t\tif( this._isElementShown ) {\r\n\t\t\tconst element = this._element;\r\n\t\t\tif( element ) {\r\n\t\t\t\tthis.initInputStep( element );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateInputMin(): void {\r\n\t\tif( this._isElementShown ) {\r\n\t\t\tconst element = this._element;\r\n\t\t\tif( element ) {\r\n\t\t\t\tthis.initInputMin( element );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateInputMax(): void {\r\n\t\tif( this._isElementShown ) {\r\n\t\t\tconst element = this._element;\r\n\t\t\tif( element ) {\r\n\t\t\t\tthis.initInputMax( element );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected initInputStep( input: HTMLInputElement ): void {\r\n\t\tif( this._step != null ) {\r\n\t\t\tinput.step = String( this._step );\r\n\t\t} else {\r\n\t\t\tinput.removeAttribute( \"step\" );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected initInputMin( input: HTMLInputElement ): void {\r\n\t\tif( this._min != null ) {\r\n\t\t\tinput.min = `${this._min}`;\r\n\t\t} else {\r\n\t\t\tinput.removeAttribute( \"min\" );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected initInputMax( input: HTMLInputElement ): void {\r\n\t\tif( this._max != null ) {\r\n\t\t\tinput.max = `${this._max}`;\r\n\t\t} else {\r\n\t\t\tinput.removeAttribute( \"max\" );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onElementAttached(\r\n\t\telement: HTMLInputElement, before: HTMLDivElement | null, after: HTMLDivElement | null\r\n\t): void {\r\n\t\tsuper.onElementAttached( element, before, after );\r\n\t\tthis.initInputStep( element );\r\n\t\tthis.initInputMin( element );\r\n\t\tthis.initInputMax( element );\r\n\t}\r\n\r\n\tprotected getInputType(): string {\r\n\t\treturn \"number\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DInputNumber, DInputNumberOptions, DThemeInputNumber } from \"./d-input-number\";\r\n\r\nexport interface DInputRealOptions<\r\n\tTHEME extends DThemeInputReal = DThemeInputReal\r\n> extends DInputNumberOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeInputReal extends DThemeInputNumber {\r\n\r\n}\r\n\r\nexport class DInputReal<\r\n\tTHEME extends DThemeInputReal = DThemeInputReal,\r\n\tOPTIONS extends DInputRealOptions<THEME> = DInputRealOptions<THEME>\r\n> extends DInputNumber<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DInputReal\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DTextBase, DTextBaseOptions, DThemeTextBase } from \"./d-text-base\";\r\n\r\nexport interface DTextOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeText = DThemeText\r\n> extends DTextBaseOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeText extends DThemeTextBase {\r\n\r\n}\r\n\r\nexport class DText<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeText = DThemeText,\r\n\tOPTIONS extends DTextOptions<VALUE, THEME> = DTextOptions<VALUE, THEME>\r\n> extends DTextBase<VALUE, THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DText\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DText, DTextOptions, DThemeText } from \"./d-text\";\r\n\r\nexport interface DInputLabelOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeText = DThemeText\r\n> extends DTextOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeInputLabel extends DThemeText {\r\n\r\n}\r\n\r\nexport class DInputLabel<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeInputLabel = DThemeInputLabel,\r\n\tOPTIONS extends DInputLabelOptions<VALUE, THEME> = DInputLabelOptions<VALUE, THEME>\r\n> extends DText<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DInputLabel\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DInputLabel, DInputLabelOptions } from \"./d-input-label\";\r\nimport { DLayoutOptions } from \"./d-layout\";\r\nimport { DLayoutHorizontal, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DLayoutSpace, DLayoutSpaceOptions } from \"./d-layout-space\";\r\n\r\ninterface InputOptions {\r\n\tweight?: number;\r\n}\r\n\r\ninterface Input extends DisplayObject {\r\n\treadonly height: number;\r\n}\r\n\r\nexport interface DInputAndLabelOptions<\r\n\tINPUT_OPTIONS extends InputOptions = InputOptions,\r\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel\r\n> extends DLayoutOptions<THEME> {\r\n\tinput?: INPUT_OPTIONS;\r\n\tlabel?: DInputLabelOptions;\r\n\tspace?: DLayoutSpaceOptions;\r\n}\r\n\r\nexport interface DThemeInputAndLabel extends DThemeLayoutHorizontal {\r\n\r\n}\r\n\r\nexport abstract class DInputAndLabel<\r\n\tINPUT extends Input,\r\n\tINPUT_OPTIONS extends InputOptions,\r\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel,\r\n\tOPTIONS extends DInputAndLabelOptions<INPUT_OPTIONS, THEME> = DInputAndLabelOptions<INPUT_OPTIONS, THEME>\r\n> extends DLayoutHorizontal<THEME, OPTIONS> {\r\n\tprotected _input: INPUT;\r\n\tprotected _label: DInputLabel;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis.addChild( this._label = new DInputLabel( options != null ? options.label : undefined ) );\r\n\t\tthis.addChild( this._input = this.createInput( options != null ? options.input : undefined ) );\r\n\t\tif( options != null && options.space != null ) {\r\n\t\t\tthis.addChild( new DLayoutSpace( options.space ) );\r\n\t\t}\r\n\t}\r\n\r\n\tget input() {\r\n\t\treturn this._input;\r\n\t}\r\n\r\n\tget label() {\r\n\t\treturn this._label;\r\n\t}\r\n\r\n\tprotected abstract createInput( options?: INPUT_OPTIONS | { weight: number } ): INPUT;\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DInputAndLabel\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DInputAndLabel, DInputAndLabelOptions, DThemeInputAndLabel } from \"./d-input-and-label\";\r\nimport { DInputReal, DInputRealOptions, DThemeInputReal } from \"./d-input-real\";\r\n\r\nexport interface DInputRealAndLabelOptions<\r\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel\r\n> extends DInputAndLabelOptions<DInputRealOptions, THEME> {}\r\n\r\nexport class DInputRealAndLabel<\r\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel,\r\n\tOPTIONS extends DInputRealAndLabelOptions<THEME> = DInputRealAndLabelOptions<THEME>\r\n> extends DInputAndLabel<DInputReal, DInputRealOptions, THEME, OPTIONS> {\r\n\tprotected createInput( options?: DInputRealOptions<DThemeInputReal> ): DInputReal {\r\n\t\treturn new DInputReal( options );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DInput, DInputOptions, DThemeInput } from \"./d-input\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\n\r\nexport interface DInputTextOptions<\r\n\tTHEME extends DThemeInputText = DThemeInputText\r\n> extends DInputOptions<string, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeInputText extends DThemeInput {\r\n\tgetEditingFormatter(): ( value: string, caller: any ) => string;\r\n\tgetEditingUnformatter(): ( text: string, caller: any ) => string;\r\n\tgetEditingValidator(): ( value: string, caller: any ) => unknown;\r\n\tgetTextFormatter(): ( value: string, caller: any ) => string;\r\n\tgetTextValue( state: DBaseState ): string;\r\n\tnewTextValue(): DStateAwareOrValueMightBe<string>;\r\n}\r\n\r\nexport class DInputText<\r\n\tTHEME extends DThemeInputText = DThemeInputText,\r\n\tOPTIONS extends DInputTextOptions<THEME> = DInputTextOptions<THEME>\r\n> extends DInput<string, THEME, OPTIONS> {\r\n\tprotected toValue( valueAsString: string ): string {\r\n\t\treturn this._editingUnformatter( valueAsString, this );\r\n\t}\r\n\r\n\tprotected getInputType(): string {\r\n\t\treturn \"text\";\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DInputText\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DInputAndLabel, DInputAndLabelOptions, DThemeInputAndLabel } from \"./d-input-and-label\";\r\nimport { DInputText, DInputTextOptions, DThemeInputText } from \"./d-input-text\";\r\n\r\nexport interface DInputTextAndLabelOptions<\r\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel\r\n> extends DInputAndLabelOptions<DInputTextOptions, THEME> {}\r\n\r\nexport class DInputTextAndLabel<\r\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel,\r\n\tOPTIONS extends DInputTextAndLabelOptions<THEME> = DInputTextAndLabelOptions<THEME>\r\n> extends DInputAndLabel<DInputText, DInputTextOptions, THEME, OPTIONS> {\r\n\tprotected createInput( options?: DInputTextOptions<DThemeInputText> ): DInputText {\r\n\t\treturn new DInputText( options );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DColorAndAlpha } from \"./d-color\";\r\n\r\nexport class DPickerColorAndAlpha implements DColorAndAlpha {\r\n\tprotected _colorAndAlpha: DColorAndAlpha;\r\n\tprotected _onColorChange: ( color: number ) => void;\r\n\tprotected _onAlphaChange: ( alpha: number ) => void;\r\n\r\n\tconstructor(\r\n\t\tcolorAndAlpha: DColorAndAlpha,\r\n\t\tonColorChange: ( color: number ) => void,\r\n\t\tonAlphaChange: ( alpha: number ) => void\r\n\t) {\r\n\t\tthis._colorAndAlpha = colorAndAlpha;\r\n\t\tthis._onColorChange = onColorChange;\r\n\t\tthis._onAlphaChange = onAlphaChange;\r\n\t}\r\n\r\n\tget color() {\r\n\t\treturn this._colorAndAlpha.color;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tif( this._colorAndAlpha.color !== color ) {\r\n\t\t\tconst callback = this._onColorChange;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback( color );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha() {\r\n\t\treturn this._colorAndAlpha.alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tif( this._colorAndAlpha.alpha !== alpha ) {\r\n\t\t\tconst callback = this._onAlphaChange;\r\n\t\t\tif( callback != null ) {\r\n\t\t\t\tcallback( alpha );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DColorAndAlpha } from \"./d-color\";\r\n\r\nexport class DPickerColorRecent extends utils.EventEmitter {\r\n\tprotected _recents: DColorAndAlpha[];\r\n\tprotected _capacity: number;\r\n\r\n\tconstructor( recents: DColorAndAlpha[], capacity: number ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._recents = recents;\r\n\t\tthis._capacity = capacity;\r\n\t}\r\n\r\n\tget( index: number ): DColorAndAlpha | null {\r\n\t\tconst recents = this._recents;\r\n\t\tif( 0 <= index && index < recents.length ) {\r\n\t\t\treturn recents[ recents.length - 1 - index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tset( index: number, colorAndAlpha: DColorAndAlpha ): DColorAndAlpha | null {\r\n\t\tconst recents = this._recents;\r\n\t\tif( 0 <= index && index < recents.length ) {\r\n\t\t\tconst result = recents[ recents.length - 1 - index ];\r\n\t\t\trecents[ recents.length - 1 - index ] = {\r\n\t\t\t\tcolor: colorAndAlpha.color,\r\n\t\t\t\talpha: colorAndAlpha.alpha\r\n\t\t\t};\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcontains( colorAndAlpha: DColorAndAlpha ): boolean {\r\n\t\tconst recents = this._recents;\r\n\t\tfor( let i = 0, imax = recents.length; i < imax; ++i ) {\r\n\t\t\tconst recent = recents[ i ];\r\n\t\t\tif( recent.color === colorAndAlpha.color && recent.alpha === colorAndAlpha.alpha ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tadd( colorAndAlpha: DColorAndAlpha ): this {\r\n\t\tconst recents = this._recents;\r\n\t\trecents.push({\r\n\t\t\tcolor: colorAndAlpha.color,\r\n\t\t\talpha: colorAndAlpha.alpha\r\n\t\t});\r\n\t\tif( this._capacity < recents.length ) {\r\n\t\t\trecents.shift();\r\n\t\t}\r\n\t\tthis.emit( \"change\", this );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpop(): DColorAndAlpha | null {\r\n\t\tconst recents = this._recents;\r\n\t\tconst result = recents.shift();\r\n\t\tif( result != null ) {\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._recents.length;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, interaction, Point, Sprite, Texture } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DColorAndAlpha } from \"./d-color\";\r\nimport { DInputRealAndLabel } from \"./d-input-real-and-label\";\r\nimport { DInputTextAndLabel } from \"./d-input-text-and-label\";\r\nimport { DPickerColorAndAlpha } from \"./d-picker-color-and-alpha\";\r\nimport { DPickerColorRecent } from \"./d-picker-color-recent\";\r\nimport { UtilHsv } from \"./util/util-hsv\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\nimport { UtilRgb } from \"./util/util-rgb\";\r\n\r\nexport interface DPickerColorOptions<THEME extends DThemePickerColor = DThemePickerColor> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerColor extends DThemeBase {\r\n\tgetMainWidth(): number;\r\n\tgetMainHeight(): number;\r\n\tgetMainTexture(): Texture;\r\n\tgetMainPointerTexture(): Texture;\r\n\tgetMainPointerColor(): number;\r\n\tgetMainPointerAlpha(): number;\r\n\r\n\tgetBaseHeight(): number;\r\n\tgetBaseMargin(): number;\r\n\tgetBaseTexture(): Texture;\r\n\tgetBasePointerTexture(): Texture;\r\n\tgetBasePointerColor(): number;\r\n\tgetBasePointerAlpha(): number;\r\n\r\n\tgetAlphaHeight(): number;\r\n\tgetAlphaMargin(): number;\r\n\tgetAlphaTexture(): Texture;\r\n\tgetAlphaCheckerboardTexture(): Texture;\r\n\tgetAlphaPointerTexture(): Texture;\r\n\tgetAlphaPointerColor(): number;\r\n\tgetAlphaPointerAlpha(): number;\r\n\r\n\tgetRecentMargin(): number;\r\n\tgetRecentColorMargin(): number;\r\n\tgetRecentColorWidth(): number;\r\n\tgetRecentColorHeight(): number;\r\n\tgetRecentColorCount(): number;\r\n\tgetRecentCheckerboardTexture(): Texture;\r\n\tgetRecents(): DColorAndAlpha[];\r\n\r\n\tgetInputMargin(): number;\r\n\tgetInputLabelWidth(): number;\r\n\r\n\tgetSampleWidth(): number;\r\n\tgetSampleHeight(): number;\r\n\tgetSampleCheckerboardTexture(): Texture;\r\n}\r\n\r\nexport class DPickerColor<\r\n\tTHEME extends DThemePickerColor = DThemePickerColor,\r\n\tOPTIONS extends DPickerColorOptions<THEME> = DPickerColorOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected static RECENT_COLORS: DPickerColorRecent | null = null;\r\n\r\n\tprotected _mainBaseSprite!: Sprite;\r\n\tprotected _mainSprite!: Sprite;\r\n\tprotected _mainPointerSprite!: Sprite;\r\n\tprotected _pointerPoint!: Point;\r\n\tprotected _onMainMoveBound!: ( e: InteractionEvent ) => void;\r\n\tprotected _onMainUpBound!: ( e: InteractionEvent ) => void;\r\n\r\n\tprotected _baseSprite!: Sprite;\r\n\tprotected _basePointerSprite!: Sprite;\r\n\tprotected _onBaseMoveBound!: ( e: InteractionEvent ) => void;\r\n\tprotected _onBaseUpBound!: ( e: InteractionEvent ) => void;\r\n\r\n\tprotected _alphaCheckerboardSprite!: Sprite;\r\n\tprotected _alphaSprite!: Sprite;\r\n\tprotected _alphaPointerSprite!: Sprite;\r\n\tprotected _onAlphaMoveBound!: ( e: InteractionEvent ) => void;\r\n\tprotected _onAlphaUpBound!: ( e: InteractionEvent ) => void;\r\n\r\n\tprotected _recentColorSprites!: Sprite[];\r\n\tprotected _recent!: DPickerColorRecent;\r\n\r\n\tprotected _inputAndLabelColor!: DInputTextAndLabel;\r\n\tprotected _inputAndLabelAlpha!: DInputRealAndLabel;\r\n\r\n\tprotected _sampleCurrentCheckerboardSprite!: Sprite;\r\n\tprotected _sampleCurrentSprite!: Sprite;\r\n\tprotected _sampleNewCheckerboardSprite!: Sprite;\r\n\tprotected _sampleNewSprite!: Sprite;\r\n\r\n\tprotected _current!: DColorAndAlpha;\r\n\tprotected _currentPicker!: DPickerColorAndAlpha;\r\n\tprotected _base!: number;\r\n\tprotected _new!: DColorAndAlpha;\r\n\tprotected _newPicker!: DPickerColorAndAlpha;\r\n\r\n\tget current(): DColorAndAlpha {\r\n\t\treturn this._currentPicker;\r\n\t}\r\n\r\n\tget new(): DColorAndAlpha {\r\n\t\treturn this._newPicker;\r\n\t}\r\n\r\n\tget recent(): DPickerColorRecent {\r\n\t\treturn this._recent;\r\n\t}\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\r\n\t\tthis._base = 0xff0000;\r\n\t\tthis._new = { color: 0xffffff, alpha: 1 };\r\n\t\tthis._newPicker = new DPickerColorAndAlpha( this._new, ( color ) => {\r\n\t\t\tthis.setColorNew( color );\r\n\t\t}, ( alpha: number ) => {\r\n\t\t\tthis.setAlphaNew( alpha );\r\n\t\t});\r\n\t\tthis._current = { color: 0xffffff, alpha: 1 };\r\n\t\tthis._currentPicker = new DPickerColorAndAlpha( this._current, ( color ) => {\r\n\t\t\tthis.setColorCurrent( color );\r\n\t\t}, ( alpha: number ) => {\r\n\t\t\tthis.setAlphaCurrent( alpha );\r\n\t\t});\r\n\r\n\t\tconst theme = this.theme;\r\n\t\tconst padding = this._padding;\r\n\t\tconst paddingTop = padding.getTop();\r\n\t\tconst paddingRight = padding.getRight();\r\n\t\tconst paddingBottom = padding.getBottom();\r\n\t\tconst paddingLeft = padding.getLeft();\r\n\t\tthis._pointerPoint = new Point();\r\n\r\n\t\t// Main\r\n\t\tconst mainWidth = theme.getMainWidth();\r\n\t\tconst mainHeight = theme.getMainHeight();\r\n\t\tconst mainBaseSprite = this._mainBaseSprite = new Sprite( Texture.WHITE );\r\n\t\tmainBaseSprite.x = paddingLeft;\r\n\t\tmainBaseSprite.y = paddingTop;\r\n\t\tmainBaseSprite.width = mainWidth;\r\n\t\tmainBaseSprite.height = mainHeight;\r\n\t\tmainBaseSprite.interactive = true;\r\n\t\tthis.addChild( mainBaseSprite );\r\n\r\n\t\tconst mainSprite = this._mainSprite = new Sprite( theme.getMainTexture() );\r\n\t\tmainSprite.x = paddingLeft;\r\n\t\tmainSprite.y = paddingTop;\r\n\t\tmainSprite.tint = this._base;\r\n\t\tmainSprite.interactive = false;\r\n\t\tthis.addChild( mainSprite );\r\n\r\n\t\t// Main event handling\r\n\t\tthis._onMainMoveBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onMainMove( e );\r\n\t\t};\r\n\t\tthis._onMainUpBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onMainUp( e );\r\n\t\t};\r\n\t\tmainBaseSprite.on( UtilPointerEvent.down, ( e: InteractionEvent ) => {\r\n\t\t\tthis.onMainDown( e );\r\n\t\t});\r\n\r\n\t\t// Base color picker\r\n\t\tconst baseSprite = this._baseSprite = new Sprite( theme.getBaseTexture() );\r\n\t\tbaseSprite.x = paddingLeft;\r\n\t\tbaseSprite.y = mainBaseSprite.y + mainBaseSprite.height + theme.getBaseMargin();\r\n\t\tbaseSprite.interactive = true;\r\n\t\tthis.addChild( baseSprite );\r\n\r\n\t\t// Base event\r\n\t\tthis._onBaseMoveBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onBaseMove( e );\r\n\t\t};\r\n\t\tthis._onBaseUpBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onBaseUp( e );\r\n\t\t};\r\n\t\tbaseSprite.on( UtilPointerEvent.down, ( e: InteractionEvent ) => {\r\n\t\t\tthis.onBaseDown( e );\r\n\t\t});\r\n\r\n\t\t// Alpha picker\r\n\t\tconst alphaCheckerboardSprite = this._alphaCheckerboardSprite =\r\n\t\t\tnew Sprite( theme.getAlphaCheckerboardTexture() );\r\n\t\talphaCheckerboardSprite.x = padding.getLeft();\r\n\t\talphaCheckerboardSprite.y = baseSprite.y + theme.getBaseHeight() + theme.getBaseMargin();\r\n\t\talphaCheckerboardSprite.interactive = false;\r\n\t\tthis.addChild( alphaCheckerboardSprite );\r\n\r\n\t\tconst alphaSprite = new Sprite( theme.getAlphaTexture() );\r\n\t\talphaSprite.tint = this._new.color;\r\n\t\talphaSprite.interactive = true;\r\n\t\talphaCheckerboardSprite.addChild( alphaSprite );\r\n\r\n\t\t// Alpha event\r\n\t\tthis._onAlphaMoveBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onAlphaMove( e );\r\n\t\t};\r\n\t\tthis._onAlphaUpBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onAlphaUp( e );\r\n\t\t};\r\n\t\talphaSprite.on( UtilPointerEvent.down, ( e: InteractionEvent ) => {\r\n\t\t\tthis.onAlphaDown( e );\r\n\t\t});\r\n\r\n\t\t// Pointers\r\n\t\tconst mainPointerSprite = this._mainPointerSprite = new Sprite( theme.getMainPointerTexture() );\r\n\t\tmainPointerSprite.x = paddingLeft;\r\n\t\tmainPointerSprite.y = paddingTop;\r\n\t\tmainPointerSprite.anchor.x = 0.5;\r\n\t\tmainPointerSprite.anchor.y = 0.5;\r\n\t\tmainPointerSprite.tint = theme.getMainPointerColor();\r\n\t\tmainPointerSprite.alpha = theme.getMainPointerAlpha();\r\n\t\tmainPointerSprite.interactive = false;\r\n\t\tthis.addChild( mainPointerSprite );\r\n\r\n\t\tconst alphaPointerSprite = this._alphaPointerSprite = new Sprite( theme.getAlphaPointerTexture() );\r\n\t\talphaPointerSprite.x = mainWidth;\r\n\t\talphaPointerSprite.y = alphaCheckerboardSprite.height * 0.5;\r\n\t\talphaPointerSprite.tint = theme.getAlphaPointerColor();\r\n\t\talphaPointerSprite.alpha = theme.getAlphaPointerAlpha();\r\n\t\talphaPointerSprite.anchor.set( 0.5, 0.5 );\r\n\t\talphaPointerSprite.interactive = false;\r\n\t\talphaCheckerboardSprite.addChild( alphaPointerSprite );\r\n\r\n\t\tconst basePointerSprite = this._basePointerSprite = new Sprite( theme.getBasePointerTexture() );\r\n\t\tbasePointerSprite.x = 0;\r\n\t\tbasePointerSprite.y = baseSprite.height * 0.5;\r\n\t\tbasePointerSprite.tint = theme.getBasePointerColor();\r\n\t\tbasePointerSprite.alpha = theme.getBasePointerAlpha();\r\n\t\tbasePointerSprite.anchor.set( 0.5, 0.5 );\r\n\t\tbasePointerSprite.interactive = false;\r\n\t\tbaseSprite.addChild( basePointerSprite );\r\n\r\n\t\t// Recently used\r\n\t\tthis._recentColorSprites = [];\r\n\t\tconst recentColorSprites = this._recentColorSprites;\r\n\t\tconst recentColorCount = theme.getRecentColorCount();\r\n\t\tconst recentColorWidth = theme.getRecentColorWidth();\r\n\t\tconst recentColorHeight = theme.getRecentColorHeight();\r\n\t\tconst recentColorWidthHalf = recentColorWidth * 0.5;\r\n\t\tconst recentColorHeightHalf = recentColorHeight * 0.5;\r\n\t\tconst recentColorMargin = theme.getRecentColorMargin();\r\n\t\tconst recentColorY = alphaCheckerboardSprite.y + theme.getAlphaHeight() + theme.getRecentMargin();\r\n\t\tconst recentCheckerboardTexture = theme.getRecentCheckerboardTexture();\r\n\t\tif( DPickerColor.RECENT_COLORS == null ) {\r\n\t\t\tDPickerColor.RECENT_COLORS = new DPickerColorRecent(\r\n\t\t\t\ttheme.getRecents().slice( 0 ),\r\n\t\t\t\trecentColorCount\r\n\t\t\t);\r\n\t\t}\r\n\t\tconst recent = this._recent = DPickerColor.RECENT_COLORS;\r\n\t\trecent.on( \"change\", () => {\r\n\t\t\tthis.onRecentChange();\r\n\t\t});\r\n\t\tconst onRecentClick = ( e: InteractionEvent ) => {\r\n\t\t\tconst checkerboardSprite = e.currentTarget;\r\n\t\t\tif( checkerboardSprite instanceof Container ) {\r\n\t\t\t\tconst sprite = checkerboardSprite.children[ 0 ];\r\n\t\t\t\tif( sprite instanceof Sprite ) {\r\n\t\t\t\t\tthis.setColorNew( sprite.tint );\r\n\t\t\t\t\tthis.setAlphaNew( sprite.alpha );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tfor( let i = 0; i < recentColorCount; ++i ) {\r\n\t\t\tconst x = paddingLeft + i * (recentColorWidth + recentColorMargin);\r\n\r\n\t\t\tconst checkerboardSprite = new Sprite( recentCheckerboardTexture );\r\n\t\t\tcheckerboardSprite.x = x + recentColorWidthHalf;\r\n\t\t\tcheckerboardSprite.y = recentColorY + recentColorHeightHalf;\r\n\t\t\tcheckerboardSprite.anchor.x = 0.5;\r\n\t\t\tcheckerboardSprite.anchor.y = 0.5;\r\n\t\t\tcheckerboardSprite.buttonMode = true;\r\n\t\t\tcheckerboardSprite.interactive = true;\r\n\t\t\tUtilPointerEvent.onClick( checkerboardSprite, onRecentClick );\r\n\t\t\tthis.addChild( checkerboardSprite );\r\n\r\n\t\t\tconst sprite = new Sprite( Texture.WHITE );\r\n\t\t\tconst recentColorAndAlpha = recent.get( i );\r\n\t\t\tif( recentColorAndAlpha != null ) {\r\n\t\t\t\tsprite.tint = recentColorAndAlpha.color;\r\n\t\t\t\tsprite.alpha = recentColorAndAlpha.alpha;\r\n\t\t\t} else {\r\n\t\t\t\tsprite.tint = 0xffffff;\r\n\t\t\t\tsprite.alpha = 0;\r\n\t\t\t}\r\n\t\t\tsprite.width = recentColorWidth;\r\n\t\t\tsprite.height = recentColorHeight;\r\n\t\t\tsprite.anchor.x = 0.5;\r\n\t\t\tsprite.anchor.y = 0.5;\r\n\t\t\tsprite.interactive = false;\r\n\t\t\tcheckerboardSprite.addChild( sprite );\r\n\t\t\trecentColorSprites.push( sprite );\r\n\t\t}\r\n\r\n\t\t// Input color\r\n\t\tconst inputMargin = theme.getInputMargin();\r\n\t\tconst inputY = recentColorY + recentColorHeight + inputMargin;\r\n\t\tconst inputWidth = mainWidth * 0.5;\r\n\t\tconst inputAndLabelColor = this._inputAndLabelColor = new DInputTextAndLabel({\r\n\t\t\tparent: this,\r\n\t\t\tx: paddingLeft,\r\n\t\t\ty: inputY,\r\n\t\t\twidth: inputWidth,\r\n\t\t\tlabel: {\r\n\t\t\t\twidth: theme.getInputLabelWidth(),\r\n\t\t\t\ttext: {\r\n\t\t\t\t\tvalue: \"#\"\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinput: {\r\n\t\t\t\tweight: 1,\r\n\t\t\t\ttext: {\r\n\t\t\t\t\tvalue: \"FFFFFF\"\r\n\t\t\t\t},\r\n\t\t\t\ton: {\r\n\t\t\t\t\tinput: ( code: string ): void => {\r\n\t\t\t\t\t\tconst color = UtilRgb.fromCode( code );\r\n\t\t\t\t\t\tif( color != null ) {\r\n\t\t\t\t\t\t\tthis.setColorNew( color );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst inputAndLabelAlpha = this._inputAndLabelAlpha = new DInputRealAndLabel({\r\n\t\t\tparent: this,\r\n\t\t\tx: paddingLeft,\r\n\t\t\ty: inputY + inputAndLabelColor.height + inputMargin,\r\n\t\t\twidth: inputWidth,\r\n\t\t\tlabel: {\r\n\t\t\t\twidth: theme.getInputLabelWidth(),\r\n\t\t\t\ttext: {\r\n\t\t\t\t\tvalue: \"A\"\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinput: {\r\n\t\t\t\tweight: 1,\r\n\t\t\t\ttext: {\r\n\t\t\t\t\tvalue: 1\r\n\t\t\t\t},\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 1,\r\n\t\t\t\ton: {\r\n\t\t\t\t\tinput: ( value: number ) => {\r\n\t\t\t\t\t\tthis.setAlphaNew( value );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Samples\r\n\t\tconst sampleWidth = theme.getSampleWidth();\r\n\t\tconst sampleHeight = theme.getSampleHeight();\r\n\t\tconst sampleX = paddingLeft + mainWidth * 0.75 - sampleWidth;\r\n\t\tconst sampleY = inputY + (inputAndLabelColor.height + inputMargin + inputAndLabelAlpha.height - sampleHeight) * 0.5;\r\n\r\n\t\tconst sampleCurrentCheckerboardSprite = this._sampleCurrentCheckerboardSprite =\r\n\t\t\tnew Sprite( theme.getSampleCheckerboardTexture() );\r\n\t\tsampleCurrentCheckerboardSprite.x = sampleX;\r\n\t\tsampleCurrentCheckerboardSprite.y = sampleY;\r\n\t\tsampleCurrentCheckerboardSprite.width = sampleWidth;\r\n\t\tsampleCurrentCheckerboardSprite.height = sampleHeight;\r\n\t\tsampleCurrentCheckerboardSprite.interactive = false;\r\n\t\tthis.addChild( sampleCurrentCheckerboardSprite );\r\n\r\n\t\tconst current = this._current;\r\n\t\tconst sampleCurrentSprite = this._sampleCurrentSprite = new Sprite( Texture.WHITE );\r\n\t\tsampleCurrentSprite.x = sampleX;\r\n\t\tsampleCurrentSprite.y = sampleY;\r\n\t\tsampleCurrentSprite.tint = current.color;\r\n\t\tsampleCurrentSprite.alpha = current.alpha;\r\n\t\tsampleCurrentSprite.width = sampleWidth;\r\n\t\tsampleCurrentSprite.height = sampleHeight;\r\n\t\tsampleCurrentSprite.interactive = true;\r\n\t\tsampleCurrentSprite.buttonMode = true;\r\n\t\tUtilPointerEvent.onClick( sampleCurrentSprite, (): void => {\r\n\t\t\tthis.setColorNew( current.color );\r\n\t\t\tthis.setAlphaNew( current.alpha );\r\n\t\t});\r\n\t\tthis.addChild( sampleCurrentSprite );\r\n\r\n\t\tconst sampleNewCheckerboardSprite = this._sampleNewCheckerboardSprite =\r\n\t\t\tnew Sprite( theme.getSampleCheckerboardTexture() );\r\n\t\tsampleNewCheckerboardSprite.x = sampleX + sampleWidth;\r\n\t\tsampleNewCheckerboardSprite.y = sampleY;\r\n\t\tsampleNewCheckerboardSprite.width = sampleWidth;\r\n\t\tsampleNewCheckerboardSprite.height = sampleHeight;\r\n\t\tsampleNewCheckerboardSprite.interactive = false;\r\n\t\tthis.addChild( sampleNewCheckerboardSprite );\r\n\r\n\t\tconst sampleNewSprite = this._sampleNewSprite = new Sprite( Texture.WHITE );\r\n\t\tsampleNewSprite.x = sampleX + sampleWidth;\r\n\t\tsampleNewSprite.y = sampleY;\r\n\t\tsampleNewSprite.tint = this._new.color;\r\n\t\tsampleNewSprite.alpha = this._new.alpha;\r\n\t\tsampleNewSprite.width = sampleWidth;\r\n\t\tsampleNewSprite.height = sampleHeight;\r\n\t\tsampleNewSprite.interactive = false;\r\n\t\tthis.addChild( sampleNewSprite );\r\n\r\n\t\t// Width\r\n\t\tif( options == null || options.width == null ) {\r\n\t\t\tthis.width = paddingLeft + mainWidth + paddingRight;\r\n\t\t}\r\n\r\n\t\t// Height\r\n\t\tif( options == null || options.height == null ) {\r\n\t\t\tthis.height = inputY + inputAndLabelColor.height + inputMargin + inputAndLabelAlpha.height + paddingBottom;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onMainDown( e: InteractionEvent ): void {\r\n\t\tthis.onMainPick( e.data.global );\r\n\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst stage = layer.stage;\r\n\t\t\tstage.on( UtilPointerEvent.move, this._onMainMoveBound );\r\n\t\t\tstage.on( UtilPointerEvent.up, this._onMainUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onMainMove( e: InteractionEvent ): void {\r\n\t\tthis.onMainPick( e.data.global );\r\n\t}\r\n\r\n\tprotected onMainUp( e: InteractionEvent ): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst stage = layer.stage;\r\n\t\t\tstage.off( UtilPointerEvent.move, this._onMainMoveBound );\r\n\t\t\tstage.off( UtilPointerEvent.up, this._onMainUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toMainHex( b: number, w0: number, w1: number, shift: number ) {\r\n\t\treturn Math.max( 0, Math.min( 255, w0 * 255 + w1 * (( b >> shift ) & 0xff) ) ) << shift;\r\n\t}\r\n\r\n\tprotected toMainColor( base: number, tx: number, ty: number, width: number, height: number ): number {\r\n\t\tconst hw = width * 0.5;\r\n\t\tconst ux = Math.max( 0, Math.min( 1, ((tx - hw) * ( 1 - ty / height ) + hw) / width ) );\r\n\t\tconst uy = Math.max( 0, Math.min( 1, ty / height ) );\r\n\t\tconst w1 = Math.abs( 0.5 * uy  - ux );\r\n\t\tconst w0 = 1 - w1 - uy;\r\n\t\tconst r = this.toMainHex( base, w0, w1, 16 );\r\n\t\tconst g = this.toMainHex( base, w0, w1, 8 );\r\n\t\tconst b = this.toMainHex( base, w0, w1, 0 );\r\n\t\treturn r | g | b;\r\n\t}\r\n\r\n\tprotected onMainPick( global: Point ) {\r\n\t\tconst point = this._pointerPoint;\r\n\t\tconst padding = this._padding;\r\n\t\tconst paddingLeft = padding.getLeft();\r\n\t\tconst paddingTop = padding.getTop();\r\n\t\tconst theme = this.theme;\r\n\t\tconst mainWidth = theme.getMainWidth();\r\n\t\tconst mainHeight = theme.getMainHeight();\r\n\t\tthis.toLocal( global, undefined, point );\r\n\t\tconst x = Math.max( 0, Math.min( mainWidth, point.x - paddingLeft ) );\r\n\t\tconst y = Math.max( 0, Math.min( mainHeight, point.y - paddingTop ) );\r\n\t\tconst mainPointerSprite = this._mainPointerSprite;\r\n\t\tmainPointerSprite.position.set( paddingLeft + x, paddingTop + y );\r\n\t\tthis.onColorNew( this.toMainColor(\r\n\t\t\tthis._base, x, y, mainWidth, mainHeight ) );\r\n\t}\r\n\r\n\tprotected setColorCurrent( color: number ) {\r\n\t\tthis._sampleCurrentSprite.tint = this._current.color = color;\r\n\t}\r\n\r\n\tprotected setAlphaCurrent( alpha: number ) {\r\n\t\tthis._sampleCurrentSprite.alpha = this._current.alpha = alpha;\r\n\t}\r\n\r\n\tprotected setColorNew( color: number ) {\r\n\t\tconst theme = this.theme;\r\n\t\tconst mainWidth = theme.getMainWidth();\r\n\t\tconst mainHeight = theme.getMainHeight();\r\n\t\tconst padding = this._padding;\r\n\r\n\t\t// Base color\r\n\t\tconst hsv = UtilHsv.fromRgb( color );\r\n\t\tthis._mainSprite.tint = this._base = UtilHsv.toRgb( hsv[ 0 ], 255, 255 );\r\n\r\n\t\t// Move the base pointer\r\n\t\tconst basePointerSprite = this._basePointerSprite;\r\n\t\tbasePointerSprite.x = Math.max( 0, Math.min( 1, hsv[ 0 ] / 360 ) ) * mainWidth;\r\n\r\n\t\t// Move the main pointer\r\n\t\tconst ns = Math.max( 0, Math.min( 1, hsv[ 1 ] / 255 ) );\r\n\t\tconst nv = Math.max( 0, Math.min( 1, 1 - hsv[ 2 ] / 255 ) );\r\n\t\tconst mainPointerSprite = this._mainPointerSprite;\r\n\t\tmainPointerSprite.tint = (nv < 0.45 ? theme.getMainPointerColor() : 0xffffff);\r\n\t\tmainPointerSprite.position.set(\r\n\t\t\tpadding.getLeft() + ns * mainWidth,\r\n\t\t\tpadding.getTop() + nv * mainHeight\r\n\t\t);\r\n\r\n\t\t// New color\r\n\t\tthis.onColorNew( color );\r\n\t}\r\n\r\n\tprotected onColorNew( color: number ) {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tlayer.disallowUpdate();\r\n\t\t}\r\n\t\tthis._sampleNewSprite.tint = this._new.color = color;\r\n\t\tthis._inputAndLabelColor.input.value = UtilRgb.toCode( color );\r\n\t\tthis.emit( \"newcolorchange\", color, this );\r\n\t\tif( layer ) {\r\n\t\t\tlayer.allowUpdate();\r\n\t\t\tlayer.update();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onBaseDown( e: InteractionEvent ): void {\r\n\t\tthis.onBasePick( e.data.global );\r\n\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst stage = layer.stage;\r\n\t\t\tstage.on( UtilPointerEvent.move, this._onBaseMoveBound );\r\n\t\t\tstage.on( UtilPointerEvent.up, this._onBaseUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onBaseMove( e: InteractionEvent ): void {\r\n\t\tthis.onBasePick( e.data.global );\r\n\t}\r\n\r\n\tprotected onBaseUp( e: InteractionEvent ): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst stage = layer.stage;\r\n\t\t\tstage.off( UtilPointerEvent.move, this._onBaseMoveBound );\r\n\t\t\tstage.off( UtilPointerEvent.up, this._onBaseUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toBaseHex( t: number, shift: number ) {\r\n\t\treturn Math.max( 0, Math.min( 255, t * 6 * 255 ) ) << shift;\r\n\t}\r\n\r\n\tprotected toBaseColor( t: number ): number {\r\n\t\tif( t <= 0.167 ) {\r\n\t\t\treturn 0xff0000 + this.toBaseHex( t, 8 );\r\n\t\t} else if( t <= 0.333 ) {\r\n\t\t\tt = 0.333 - t;\r\n\t\t\treturn 0x00ff00 + this.toBaseHex( t, 16 );\r\n\t\t} else if( t <= 0.5 ) {\r\n\t\t\tt -= 0.333;\r\n\t\t\treturn 0x00ff00 + this.toBaseHex( t, 0 );\r\n\t\t} else if( t < 0.667 ) {\r\n\t\t\tt = 0.667 - t;\r\n\t\t\treturn 0x0000ff + this.toBaseHex( t, 8 );\r\n\t\t} else if( t < 0.883 ) {\r\n\t\t\tt -= 0.667;\r\n\t\t\treturn 0x0000ff + this.toBaseHex( t, 16 );\r\n\t\t} else {\r\n\t\t\tt = 0.883 - t;\r\n\t\t\treturn 0xff0000 + this.toBaseHex( t, 0 );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onBasePick( global: Point ) {\r\n\t\tconst point = this._pointerPoint;\r\n\t\tconst padding = this._padding;\r\n\t\tconst theme = this.theme;\r\n\t\tconst mainWidth = theme.getMainWidth();\r\n\t\tthis.toLocal( global, undefined, point );\r\n\t\tconst x = Math.max( 0, Math.min( mainWidth, point.x - padding.getLeft() ) );\r\n\t\tconst basePointerSprite = this._basePointerSprite;\r\n\t\tbasePointerSprite.x = x;\r\n\t\tthis.onColorBase( this.toBaseColor( x / mainWidth ) );\r\n\t}\r\n\r\n\tprotected setColorBase( h: number ) {\r\n\t\tconst theme = this.theme;\r\n\t\tconst mainWidth = theme.getMainWidth();\r\n\t\tconst basePointerSprite = this._basePointerSprite;\r\n\t\tbasePointerSprite.x = Math.max( 0, Math.min( 1, h / 360 ) ) * mainWidth;\r\n\t\tthis.onColorBase( UtilHsv.toRgb( h, 255, 255 ) );\r\n\t}\r\n\r\n\tprotected onColorBase( color: number ) {\r\n\t\tthis._mainSprite.tint = this._base = color;\r\n\r\n\t\tconst mainPointerSprite = this._mainPointerSprite;\r\n\t\tconst theme = this.theme;\r\n\t\tconst mainWidth = theme.getMainWidth();\r\n\t\tconst mainHeight = theme.getMainHeight();\r\n\t\tconst padding = this._padding;\r\n\t\tthis.onColorNew( this.toMainColor(\r\n\t\t\tthis._base,\r\n\t\t\tmainPointerSprite.x - padding.getLeft(),\r\n\t\t\tmainPointerSprite.y - padding.getTop(),\r\n\t\t\tmainWidth,\r\n\t\t\tmainHeight\r\n\t\t));\r\n\t}\r\n\r\n\tprotected onAlphaDown( e: InteractionEvent ): void {\r\n\t\tthis.onAlphaPick( e.data.global );\r\n\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst stage = layer.stage;\r\n\t\t\tstage.on( UtilPointerEvent.move, this._onAlphaMoveBound );\r\n\t\t\tstage.on( UtilPointerEvent.up, this._onAlphaUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onAlphaMove( e: InteractionEvent ): void {\r\n\t\tthis.onAlphaPick( e.data.global );\r\n\t}\r\n\r\n\tprotected onAlphaUp( e: InteractionEvent ): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst stage = layer.stage;\r\n\t\t\tstage.off( UtilPointerEvent.move, this._onAlphaMoveBound );\r\n\t\t\tstage.off( UtilPointerEvent.up, this._onAlphaUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onAlphaPick( global: Point ) {\r\n\t\tconst point = this._pointerPoint;\r\n\t\tconst padding = this._padding;\r\n\t\tconst theme = this.theme;\r\n\t\tconst mainWidth = theme.getMainWidth();\r\n\t\tthis.toLocal( global, undefined, point );\r\n\t\tconst x = Math.max( 0, Math.min( mainWidth, point.x - padding.getLeft() ) );\r\n\t\tthis._alphaPointerSprite.x = x;\r\n\t\tthis.onAlphaNew( x / mainWidth );\r\n\t}\r\n\r\n\tprotected setAlphaNew( alpha: number ): void {\r\n\t\tconst theme = this.theme;\r\n\t\tconst mainWidth = theme.getMainWidth();\r\n\t\tthis._alphaPointerSprite.x = Math.max( 0, Math.min( 1, alpha ) ) * mainWidth;\r\n\t\tthis.onAlphaNew( alpha );\r\n\t}\r\n\r\n\tprotected onAlphaNew( alpha: number ): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tlayer.disallowUpdate();\r\n\t\t}\r\n\t\tthis._sampleNewSprite.alpha = this._new.alpha = alpha;\r\n\t\tthis._inputAndLabelAlpha.input.value = Number( alpha.toFixed( 2 ) );\r\n\t\tthis.emit( \"newalphachange\", alpha, this );\r\n\t\tif( layer ) {\r\n\t\t\tlayer.allowUpdate();\r\n\t\t\tlayer.update();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onRecentChange(): void {\r\n\t\tconst sprites = this._recentColorSprites;\r\n\t\tconst recent = this._recent;\r\n\t\tfor( let i = 0, imax = sprites.length; i < imax; ++i ) {\r\n\t\t\tconst sprite = sprites[ i ];\r\n\t\t\tconst colorAndAlpha = recent.get( i );\r\n\t\t\tif( colorAndAlpha != null ) {\r\n\t\t\t\tsprite.tint = colorAndAlpha.color;\r\n\t\t\t\tsprite.alpha = colorAndAlpha.alpha;\r\n\t\t\t} else {\r\n\t\t\t\tsprite.tint = 0xffffff;\r\n\t\t\t\tsprite.alpha = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerColor\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\ntype Callback = ( target: DPickerColorGradientPoint ) => void;\r\n\r\nexport interface DPickerColorGradientPointLike {\r\n\tcolor: number;\r\n\talpha: number;\r\n\tposition: number;\r\n}\r\n\r\nexport class DPickerColorGradientPoint implements DPickerColorGradientPointLike {\r\n\tprotected _color: number;\r\n\tprotected _alpha: number;\r\n\tprotected _position: number;\r\n\tprotected _callback: Callback;\r\n\tprotected _selected: boolean;\r\n\r\n\tconstructor( color: number, alpha: number, position: number, selected: boolean, callback: Callback ) {\r\n\t\tthis._color = color;\r\n\t\tthis._alpha = alpha;\r\n\t\tthis._position = position;\r\n\t\tthis._callback = callback;\r\n\t\tthis._selected = selected;\r\n\t}\r\n\r\n\tset( color: number, alpha: number, position: number, selected: boolean ) {\r\n\t\tif( this._color !== color || this._alpha !== alpha || this._position !== position || this._selected !== selected ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tthis._position = position;\r\n\t\t\tthis._selected = selected;\r\n\t\t\tthis._callback( this );\r\n\t\t}\r\n\t}\r\n\r\n\tget color() {\r\n\t\treturn this._color;\r\n\t}\r\n\r\n\tset color( color: number ) {\r\n\t\tif( this._color !== color ) {\r\n\t\t\tthis._color = color;\r\n\t\t\tthis._callback( this );\r\n\t\t}\r\n\t}\r\n\r\n\tget alpha() {\r\n\t\treturn this._alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: number ) {\r\n\t\tif( this._alpha !== alpha ) {\r\n\t\t\tthis._alpha = alpha;\r\n\t\t\tthis._callback( this );\r\n\t\t}\r\n\t}\r\n\r\n\tget position() {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tset position( position: number ) {\r\n\t\tif( this._position !== position ) {\r\n\t\t\tthis._position = position;\r\n\t\t\tthis._callback( this );\r\n\t\t}\r\n\t}\r\n\r\n\tget selected() {\r\n\t\treturn this._selected;\r\n\t}\r\n\r\n\tset selected( selected: boolean ) {\r\n\t\tif( this._selected !== selected ) {\r\n\t\t\tthis._selected = selected;\r\n\t\t\tthis._callback( this );\r\n\t\t}\r\n\t}\r\n\r\n\ttoObject(): DPickerColorGradientPointLike {\r\n\t\treturn {\r\n\t\t\tcolor: this._color,\r\n\t\t\talpha: this._alpha,\r\n\t\t\tposition: this._position\r\n\t\t};\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DPickerColorGradientPoint, DPickerColorGradientPointLike } from \"./d-picker-color-gradient-point\";\r\n\r\nconst POINT_SORTER = ( a: DPickerColorGradientPoint, b: DPickerColorGradientPoint ): number => {\r\n\treturn a.position - b.position;\r\n};\r\n\r\nexport interface DPickerColorGradientDataLike {\r\n\tpoints: DPickerColorGradientPointLike[];\r\n\tdirection: number;\r\n}\r\n\r\nexport class DPickerColorGradientData extends utils.EventEmitter {\r\n\tprotected _points: DPickerColorGradientPoint[];\r\n\tprotected _direction: number;\r\n\tprotected _selected: DPickerColorGradientPoint | null;\r\n\r\n\tprotected _onChangeBound: ( target: DPickerColorGradientPoint ) => void;\r\n\tprotected _workColor: number[];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis._onChangeBound = ( target: DPickerColorGradientPoint ): void => {\r\n\t\t\tthis.onChange( target );\r\n\t\t};\r\n\r\n\t\tconst first = new DPickerColorGradientPoint( 0xffffff, 1, 0, false, this._onChangeBound );\r\n\t\tconst second = new DPickerColorGradientPoint( 0x808080, 1, 1, true, this._onChangeBound );\r\n\t\tthis._points = [ first, second ];\r\n\t\tthis._direction = -90;\r\n\t\tthis._selected = second;\r\n\t\tthis._workColor = [ 0, 0, 0 ];\r\n\t}\r\n\r\n\tprotected onChange( target: DPickerColorGradientPoint ): void {\r\n\t\tconst isSelectionChanged = ( target.selected && this._selected !== target );\r\n\t\tif( isSelectionChanged ) {\r\n\t\t\tconst selected = this._selected;\r\n\t\t\tif( selected != null ) {\r\n\t\t\t\t(selected as any)._selected = false;\r\n\t\t\t}\r\n\t\t\tthis._selected = target;\r\n\t\t}\r\n\t\tthis._points.sort( POINT_SORTER );\r\n\t\tif( isSelectionChanged ) {\r\n\t\t\tthis.emit( \"selectionchange\", this._selected, this );\r\n\t\t}\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\tget points(): DPickerColorGradientPoint[] {\r\n\t\treturn this._points;\r\n\t}\r\n\r\n\tget direction(): number {\r\n\t\treturn this._direction;\r\n\t}\r\n\r\n\tset direction( direction: number ) {\r\n\t\tif( this._direction !== direction ) {\r\n\t\t\tthis._direction = direction;\r\n\t\t\tthis.emit( \"directionchange\", direction, this );\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tget selected(): DPickerColorGradientPoint | null {\r\n\t\treturn this._selected;\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._points.length;\r\n\t}\r\n\r\n\tget( index: number ): DPickerColorGradientPoint | null {\r\n\t\tconst points = this._points;\r\n\t\tif( 0 <= index && index < points.length ) {\r\n\t\t\treturn points[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\taddAt( position: number ): DPickerColorGradientPoint {\r\n\t\tconst points = this._points;\r\n\t\tlet previous: DPickerColorGradientPoint | null = null;\r\n\t\tfor( let i = 0, imax = points.length; i < imax; ++i ) {\r\n\t\t\tconst point = points[ i ];\r\n\t\t\tif( position <= point.position ) {\r\n\t\t\t\tif( previous != null ) {\r\n\t\t\t\t\tconst span = point.position - previous.position;\r\n\t\t\t\t\tif( 0.001 < span ) {\r\n\t\t\t\t\t\tconst rgb0 = utils.hex2rgb( point.color, this._workColor );\r\n\t\t\t\t\t\tconst r0 = rgb0[ 0 ];\r\n\t\t\t\t\t\tconst g0 = rgb0[ 1 ];\r\n\t\t\t\t\t\tconst b0 = rgb0[ 2 ];\r\n\r\n\t\t\t\t\t\tconst rgb1 = utils.hex2rgb( previous.color, this._workColor );\r\n\t\t\t\t\t\tconst r1 = rgb1[ 0 ];\r\n\t\t\t\t\t\tconst g1 = rgb1[ 1 ];\r\n\t\t\t\t\t\tconst b1 = rgb1[ 2 ];\r\n\r\n\t\t\t\t\t\tconst ratio = (position - previous.position) / span;\r\n\t\t\t\t\t\tconst r = r0 * ratio + r1 * (1 - ratio);\r\n\t\t\t\t\t\tconst g = g0 * ratio + g1 * (1 - ratio);\r\n\t\t\t\t\t\tconst b = b0 * ratio + b1 * (1 - ratio);\r\n\r\n\t\t\t\t\t\tconst rgb = this._workColor;\r\n\t\t\t\t\t\trgb[ 0 ] = r;\r\n\t\t\t\t\t\trgb[ 1 ] = g;\r\n\t\t\t\t\t\trgb[ 2 ] = b;\r\n\r\n\t\t\t\t\t\tconst color = utils.rgb2hex( rgb );\r\n\t\t\t\t\t\tconst alpha = point.alpha * ratio + previous.alpha * (1 - ratio);\r\n\t\t\t\t\t\treturn this.add( color, alpha, position, true );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn this.add( point.color, point.alpha, position, true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprevious = point;\r\n\t\t}\r\n\t\tif( previous != null ) {\r\n\t\t\treturn this.add( previous.color, previous.alpha, position, true );\r\n\t\t} else {\r\n\t\t\treturn this.add( 0xffffff, 1.0, position, true );\r\n\t\t}\r\n\t}\r\n\r\n\tadd( color: number, alpha: number, position: number, selected: boolean ): DPickerColorGradientPoint {\r\n\t\tconst result = new DPickerColorGradientPoint( color, alpha, position, selected, this._onChangeBound );\r\n\t\tthis._points.push( result );\r\n\t\tthis._onChangeBound( result );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tremove( point: DPickerColorGradientPoint ): boolean {\r\n\t\tconst points = this._points;\r\n\t\tif( 2 < points.length ) {\r\n\t\t\tfor( let i = 0, imax = points.length; i < imax; ++i ) {\r\n\t\t\t\tif( points[ i ] === point ) {\r\n\t\t\t\t\tpoints.splice( i, 1 );\r\n\t\t\t\t\tconst isSelectionChanged = ( this._selected === point );\r\n\t\t\t\t\tif( isSelectionChanged ) {\r\n\t\t\t\t\t\tif( i + 1 < imax ) {\r\n\t\t\t\t\t\t\tthis._selected = points[ i ];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._selected = points[ i - 1 ];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( isSelectionChanged ) {\r\n\t\t\t\t\t\tthis.emit( \"selectionchange\", this._selected, this );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tconst oldDirection = this._direction;\r\n\t\tthis._direction = -90;\r\n\r\n\t\tconst points = this._points;\r\n\t\tconst oldSelected = this._selected;\r\n\t\tconst index = ( oldSelected ? points.indexOf( oldSelected ) : -1 );\r\n\t\tpoints.length = 0;\r\n\t\tpoints.push( new DPickerColorGradientPoint( 0xffffff, 0, 0, false, this._onChangeBound ) );\r\n\t\tpoints.push( new DPickerColorGradientPoint( 0xffffff, 0, 1, false, this._onChangeBound ) );\r\n\r\n\t\tif( 0 <= index && index < points.length ) {\r\n\t\t\tconst point = points[ index ];\r\n\t\t\t(point as any)._selected = true;\r\n\t\t\tthis._selected = point;\r\n\t\t} else if( 0 < points.length ) {\r\n\t\t\tconst point = points[ points.length - 1 ];\r\n\t\t\t(point as any)._selected = true;\r\n\t\t\tthis._selected = point;\r\n\t\t} else {\r\n\t\t\tthis._selected = null;\r\n\t\t}\r\n\t\tif( oldSelected !== this._selected ) {\r\n\t\t\tthis.emit( \"selectionchange\", this._selected, this );\r\n\t\t}\r\n\r\n\t\tif( oldDirection !== this._direction ) {\r\n\t\t\tthis.emit( \"directionchange\", this._direction, this );\r\n\t\t}\r\n\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\ttoObject(): DPickerColorGradientDataLike {\r\n\t\tconst pointsCopy = [];\r\n\t\tconst points = this._points;\r\n\t\tfor( let i = 0, imax = points.length; i < imax; ++i ) {\r\n\t\t\tpointsCopy.push( points[ i ].toObject() );\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tpoints: pointsCopy,\r\n\t\t\tdirection: this._direction\r\n\t\t};\r\n\t}\r\n\r\n\tfromObject( data: DPickerColorGradientDataLike ): void {\r\n\t\tconst oldDirection = this._direction;\r\n\t\tthis._direction = data.direction;\r\n\r\n\t\tconst points = this._points;\r\n\t\tconst oldSelected = this._selected;\r\n\t\tconst index = ( oldSelected ? points.indexOf( oldSelected ) : -1 );\r\n\t\tpoints.length = 0;\r\n\t\tfor( let i = 0, imax = data.points.length; i < imax; ++i ) {\r\n\t\t\tconst pointLike = data.points[ i ];\r\n\t\t\tconst point = new DPickerColorGradientPoint(\r\n\t\t\t\tpointLike.color, pointLike.alpha, pointLike.position,\r\n\t\t\t\tfalse, this._onChangeBound\r\n\t\t\t);\r\n\t\t\tpoints.push( point );\r\n\t\t}\r\n\t\tpoints.sort( POINT_SORTER );\r\n\r\n\t\tif( 0 <= index && index < points.length ) {\r\n\t\t\tconst point = points[ index ];\r\n\t\t\t(point as any)._selected = true;\r\n\t\t\tthis._selected = point;\r\n\t\t} else if( 0 < points.length ) {\r\n\t\t\tconst point = points[ points.length - 1 ];\r\n\t\t\t(point as any)._selected = true;\r\n\t\t\tthis._selected = point;\r\n\t\t} else {\r\n\t\t\tthis._selected = null;\r\n\t\t}\r\n\t\tif( oldSelected !== this._selected ) {\r\n\t\t\tthis.emit( \"selectionchange\", this._selected, this );\r\n\t\t}\r\n\r\n\t\tif( oldDirection !== this._direction ) {\r\n\t\t\tthis.emit( \"directionchange\", this._direction, this );\r\n\t\t}\r\n\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Buffer, Geometry, Mesh, Point, Rectangle, Shader, Texture, TextureUvs, utils } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DPickerColorGradientDataLike } from \"./d-picker-color-gradient-data\";\r\n\r\nconst VERTEX_SHADER = `\r\nattribute vec2 aPosition;\r\nattribute vec2 aUv;\r\nattribute vec4 aColor;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\n\r\nvarying vec2 vUv;\r\nvarying vec4 vColor;\r\n\r\nvoid main(void) {\r\n\tvec3 position = vec3(aPosition.x, aPosition.y, 1.0);\r\n\tgl_Position = vec4((projectionMatrix * translationMatrix * position).xy, 0.0, 1.0);\r\n\tvUv = aUv;\r\n\tvColor = aColor;\r\n}\r\n`;\r\n\r\nconst FRAGMENT_SHADER = `\r\nvarying vec2 vUv;\r\nvarying vec4 vColor;\r\n\r\nuniform sampler2D uSampler;\r\n\r\nvoid main(void) {\r\n\tvec4 texture = texture2D(uSampler, vUv);\r\n\tfloat cy = step( 1.0, mod( gl_FragCoord.y / 10.0, 2.0 ) );\r\n\tfloat cx = step( 1.0, mod( gl_FragCoord.x / 10.0 + cy, 2.0 ) );\r\n\tfloat c = mix( 0.75, 0.65, cx );\r\n\tgl_FragColor = texture * vec4( mix( vec3( c ), vColor.xyz, vColor.a ), 1.0 );\r\n}`;\r\n\r\ntype Parts = Array<{ data: DPickerColorGradientDataLike | null, rect: Rectangle }>;\r\n\r\nexport class DPickerColorGradientDataView extends Mesh {\r\n\tprotected _nPointsPerData: number;\r\n\tprotected _vertices: Float32Array;\r\n\tprotected _uvs: Float32Array;\r\n\tprotected _colors: Float32Array;\r\n\tprotected _indices: Uint16Array;\r\n\tprotected _lastHitIndex: number;\r\n\r\n\tprotected _workColor: number[];\r\n\tprotected _workPoint: Point;\r\n\r\n\tprotected _parts: Parts;\r\n\r\n\tprotected constructor(\r\n\t\tnPointsPerData: number,\r\n\t\tvertices: Float32Array, uvs: Float32Array, colors: Float32Array, indices: Uint16Array,\r\n\t\tparts: Parts, geometry: Geometry, shader: Shader\r\n\t) {\r\n\t\tsuper( geometry, shader );\r\n\r\n\t\tthis.interactive = true;\r\n\t\tthis.interactiveChildren = false;\r\n\t\tthis.cursor = \"pointer\";\r\n\r\n\t\tthis._nPointsPerData = nPointsPerData;\r\n\t\tthis._vertices = vertices;\r\n\t\tthis._uvs = uvs;\r\n\t\tthis._colors = colors;\r\n\t\tthis._indices = indices;\r\n\t\tthis._lastHitIndex = -1;\r\n\t\tthis._workColor = [ 0, 0, 0 ];\r\n\t\tthis._workPoint = new Point();\r\n\t\tthis._parts = parts;\r\n\r\n\t\tshader.uniforms.uSampler.on( \"update\", (): void => {\r\n\t\t\tthis.update();\r\n\t\t\tDApplications.update( this );\r\n\t\t});\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tgetRectangle( index: number ): Rectangle | null {\r\n\t\tconst parts = this._parts;\r\n\t\tif( 0 <= index && index < parts.length ) {\r\n\t\t\treturn parts[ index ].rect;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tsetRectangle( index: number, x: number, y: number, width: number, height: number ): void {\r\n\t\tconst parts = this._parts;\r\n\t\tif( 0 <= index && index < parts.length ) {\r\n\t\t\tconst rect = parts[ index ].rect;\r\n\t\t\trect.x = x;\r\n\t\t\trect.y = y;\r\n\t\t\trect.width = width;\r\n\t\t\trect.height = height;\r\n\t\t}\r\n\t}\r\n\r\n\tgetData( index: number ): DPickerColorGradientDataLike | null {\r\n\t\tconst parts = this._parts;\r\n\t\tif( 0 <= index && index < parts.length ) {\r\n\t\t\treturn parts[ index ].data;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tsetData( index: number, data: DPickerColorGradientDataLike | null ): void {\r\n\t\tconst parts = this._parts;\r\n\t\tif( 0 <= index && index < parts.length ) {\r\n\t\t\tparts[ index ].data = data;\r\n\t\t}\r\n\t}\r\n\r\n\tgetLastHitIndex(): number {\r\n\t\treturn this._lastHitIndex;\r\n\t}\r\n\r\n\tprivate setColors( ic: number, colors: Float32Array, rgb: number[], alpha: number ) {\r\n\t\tcolors[ ic + 0 ] = rgb[ 0 ];\r\n\t\tcolors[ ic + 1 ] = rgb[ 1 ];\r\n\t\tcolors[ ic + 2 ] = rgb[ 2 ];\r\n\t\tcolors[ ic + 3 ] = alpha;\r\n\t\tcolors[ ic + 4 ] = rgb[ 0 ];\r\n\t\tcolors[ ic + 5 ] = rgb[ 1 ];\r\n\t\tcolors[ ic + 6 ] = rgb[ 2 ];\r\n\t\tcolors[ ic + 7 ] = alpha;\r\n\t}\r\n\r\n\tprivate setColorsHex( ic: number, colors: Float32Array, color: number, alpha: number ) {\r\n\t\tconst rgb = utils.hex2rgb( color, this._workColor );\r\n\t\tthis.setColors( ic, colors, rgb, alpha );\r\n\t}\r\n\r\n\tprivate setColorsWhite( ic: number, colors: Float32Array ) {\r\n\t\tconst rgb = this._workColor;\r\n\t\trgb[ 0 ] = 1;\r\n\t\trgb[ 1 ] = 1;\r\n\t\trgb[ 2 ] = 1;\r\n\t\tthis.setColors( ic, colors, rgb, 0 );\r\n\t}\r\n\r\n\tprivate setColorsPoint( ic: number, data: DPickerColorGradientDataLike, index: number, colors: Float32Array ) {\r\n\t\tconst point = data.points[ index ];\r\n\t\tif( point != null ) {\r\n\t\t\tthis.setColorsHex( ic, colors, point.color, point.alpha );\r\n\t\t} else {\r\n\t\t\tthis.setColorsWhite( ic, colors );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setVertices( iv: number, vertices: Float32Array, position: number, rect: Rectangle ) {\r\n\t\tconst y = rect.y + rect.height * position;\r\n\t\tvertices[ iv + 0 ] = rect.x;\r\n\t\tvertices[ iv + 1 ] = y;\r\n\t\tvertices[ iv + 2 ] = rect.x + rect.width;\r\n\t\tvertices[ iv + 3 ] = y;\r\n\t}\r\n\r\n\tprotected setUvs( iv: number, uvs: Float32Array, position: number, textureUvs: TextureUvs ) {\r\n\t\tconst x0 = textureUvs.x0 + (textureUvs.x3 - textureUvs.x0) * position;\r\n\t\tconst y0 = textureUvs.y0 + (textureUvs.y3 - textureUvs.y0) * position;\r\n\t\tconst x1 = textureUvs.x1 + (textureUvs.x2 - textureUvs.x1) * position;\r\n\t\tconst y1 = textureUvs.y1 + (textureUvs.y2 - textureUvs.y1) * position;\r\n\t\tuvs[ iv + 0 ] = x0;\r\n\t\tuvs[ iv + 1 ] = y0;\r\n\t\tuvs[ iv + 2 ] = x1;\r\n\t\tuvs[ iv + 3 ] = y1;\r\n\t}\r\n\r\n\tprivate newIndices( ii: number, iv: number, size: number, indices: Uint16Array ): Uint16Array {\r\n\t\tfor( let i = 0; i < size; ++i ) {\r\n\t\t\tindices[ ii + 0 ] = iv + 0;\r\n\t\t\tindices[ ii + 1 ] = iv + 1;\r\n\t\t\tindices[ ii + 2 ] = iv + 2;\r\n\r\n\t\t\tindices[ ii + 3 ] = iv + 2;\r\n\t\t\tindices[ ii + 4 ] = iv + 1;\r\n\t\t\tindices[ ii + 5 ] = iv + 3;\r\n\r\n\t\t\tii += 6;\r\n\t\t\tiv += 2;\r\n\t\t}\r\n\t\treturn indices;\r\n\t}\r\n\r\n\tprotected _calculateBounds() {\r\n\t\tconst rect = this._parts[ 0 ].rect;\r\n\t\tconst bounds = this._bounds;\r\n\t\tconst work = this._workPoint;\r\n\t\twork.set( rect.x, rect.y );\r\n\t\tbounds.addPoint( work );\r\n\t\twork.set( rect.x + rect.width, rect.y + rect.height );\r\n\t\tbounds.addPoint( work );\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst vertices = this._vertices;\r\n\t\tconst uvs = this._uvs;\r\n\t\tconst colors = this._colors;\r\n\t\tconst indices = this._indices;\r\n\r\n\t\tconst texture = this.shader.uniforms.uSampler;\r\n\t\tif( texture._uvs == null ) {\r\n\t\t\ttexture.updateUvs();\r\n\t\t}\r\n\t\tconst textureUvs: TextureUvs = texture._uvs;\r\n\r\n\t\tlet iv = 0;\r\n\t\tlet nv = 0;\r\n\t\tlet ic = 0;\r\n\t\tlet ii = 0;\r\n\r\n\t\tconst parts = this._parts;\r\n\t\tfor( let i = 0, imax = parts.length; i < imax; ++i ) {\r\n\t\t\tconst data = parts[ i ].data;\r\n\t\t\tconst rect = parts[ i ].rect;\r\n\t\t\tif( data == null ) {\r\n\t\t\t\tthis.setVertices( iv, vertices, 0, rect );\r\n\t\t\t\tthis.setUvs( iv, uvs, 0, textureUvs );\r\n\t\t\t\tthis.setColorsWhite( ic, colors );\r\n\t\t\t\tthis.setVertices( iv + 4, vertices, 1, rect );\r\n\t\t\t\tthis.setUvs( iv, uvs, 1, textureUvs );\r\n\t\t\t\tthis.setColorsWhite( ic + 8, colors );\r\n\t\t\t\tthis.newIndices( ii, nv, 1, indices );\r\n\t\t\t\tiv += 4 * 2;\r\n\t\t\t\tic += 4 * 4;\r\n\t\t\t\tnv += 4;\r\n\t\t\t\tii += 6;\r\n\t\t\t} else {\r\n\t\t\t\tthis.setVertices( iv, vertices, 0, rect );\r\n\t\t\t\tthis.setUvs( iv, uvs, 0, textureUvs );\r\n\t\t\t\tthis.setColorsPoint( ic, data, 0, colors );\r\n\t\t\t\tiv += 2 * 2;\r\n\t\t\t\tic += 2 * 4;\r\n\t\t\t\tconst pointSize = data.points.length;\r\n\t\t\t\tfor( let j = 0, jmax = Math.min( pointSize, this._nPointsPerData ); j < jmax; ++j ) {\r\n\t\t\t\t\tconst point = data.points[ j ];\r\n\t\t\t\t\tthis.setVertices( iv, vertices, point.position, rect );\r\n\t\t\t\t\tthis.setUvs( iv, uvs, point.position, textureUvs );\r\n\t\t\t\t\tthis.setColorsHex( ic, colors, point.color, point.alpha );\r\n\t\t\t\t\tiv += 2 * 2;\r\n\t\t\t\t\tic += 2 * 4;\r\n\t\t\t\t}\r\n\t\t\t\tthis.setVertices( iv, vertices, 1, rect );\r\n\t\t\t\tthis.setUvs( iv, uvs, 1, textureUvs );\r\n\t\t\t\tthis.setColorsPoint( ic, data, pointSize - 1, colors );\r\n\t\t\t\tiv += 2 * 2;\r\n\t\t\t\tic += 2 * 4;\r\n\r\n\t\t\t\tthis.newIndices( ii, nv, pointSize + 1, indices );\r\n\t\t\t\tii += (pointSize + 1) * 6;\r\n\t\t\t\tnv += (pointSize + 2) * 2;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.size = ii;\r\n\r\n\t\tconst geometry = this.geometry;\r\n\t\tgeometry.getBuffer( \"aPosition\" ).update();\r\n\t\tgeometry.getBuffer( \"aUv\" ).update();\r\n\t\tgeometry.getBuffer( \"aColor\" ).update();\r\n\t\tgeometry.getIndex().update();\r\n\t}\r\n\r\n\tcontainsPoint( point: Point ): boolean {\r\n\t\tconst local = this.toLocal( point, undefined, this._workPoint );\r\n\t\tconst parts = this._parts;\r\n\t\tfor( let i = 0, imax = parts.length; i < imax; ++i ) {\r\n\t\t\tconst rect = parts[ i ].rect;\r\n\t\t\tif( rect.contains( local.x, local.y ) ) {\r\n\t\t\t\tthis._lastHitIndex = i;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tstatic from( size: number, nPointsPerData: number, texture: Texture = Texture.WHITE ) {\r\n\t\tconst vertices = new Float32Array( size * ( nPointsPerData + 2 ) * 2 * 2 );\r\n\t\tconst uvs = new Float32Array( size * ( nPointsPerData + 2 ) * 2 * 2 );\r\n\t\tconst colors = new Float32Array( size * ( nPointsPerData + 2 ) * 2 * 4 );\r\n\t\tconst indices = new Uint16Array( size * ( nPointsPerData + 1 ) * 6 );\r\n\r\n\t\tconst parts: Parts = [];\r\n\t\tfor( let i = 0; i < size; ++i ) {\r\n\t\t\tparts.push({\r\n\t\t\t\tdata: null,\r\n\t\t\t\trect: new Rectangle()\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst geometry = new Geometry()\r\n\t\t\t.addIndex( new Buffer( indices, false, true ) )\r\n\t\t\t.addAttribute( \"aPosition\", new Buffer( vertices, false, false ), 2 )\r\n\t\t\t.addAttribute( \"aUv\", new Buffer( uvs, false, false ), 2 )\r\n\t\t\t.addAttribute( \"aColor\", new Buffer( colors, false, false ), 4 );\r\n\t\tconst shader = Shader.from( VERTEX_SHADER, FRAGMENT_SHADER, { uSampler: texture } );\r\n\r\n\t\treturn new DPickerColorGradientDataView(\r\n\t\t\tnPointsPerData,\r\n\t\t\tvertices, uvs, colors, indices,\r\n\t\t\tparts, geometry, shader\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DPickerColorGradientDataLike } from \"./d-picker-color-gradient-data\";\r\n\r\nconst isEqual = ( a: DPickerColorGradientDataLike, b: DPickerColorGradientDataLike ) => {\r\n\tif( a.direction !== b.direction ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tconst ap = a.points;\r\n\tconst bp = b.points;\r\n\tif( ap.length !== bp.length ) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfor( let j = 0, jmax = ap.length; j < jmax; ++j ) {\r\n\t\tconst apj = ap[ j ];\r\n\t\tconst bpj = bp[ j ];\r\n\t\tif( apj.color !== bpj.color || apj.alpha !== bpj.alpha || apj.position !== bpj.position ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\nexport class DPickerColorGradientRecent extends utils.EventEmitter {\r\n\tprotected _recents: DPickerColorGradientDataLike[];\r\n\tprotected _capacity: number;\r\n\r\n\tconstructor( recents: DPickerColorGradientDataLike[], capacity: number ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._recents = recents;\r\n\t\tthis._capacity = capacity;\r\n\t}\r\n\r\n\tgetCapacity(): number {\r\n\t\treturn this._capacity;\r\n\t}\r\n\r\n\tget( index: number ): DPickerColorGradientDataLike | null {\r\n\t\tconst recents = this._recents;\r\n\t\tif( 0 <= index && index < recents.length ) {\r\n\t\t\treturn recents[ recents.length - 1 - index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tset( index: number, points: DPickerColorGradientDataLike ): DPickerColorGradientDataLike | null {\r\n\t\tconst recents = this._recents;\r\n\t\tif( 0 <= index && index < recents.length ) {\r\n\t\t\tconst result = recents[ recents.length - 1 - index ];\r\n\t\t\trecents[ recents.length - 1 - index ] = points;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcontains( points: DPickerColorGradientDataLike ): boolean {\r\n\t\tconst recents = this._recents;\r\n\t\tfor( let i = 0, imax = recents.length; i < imax; ++i ) {\r\n\t\t\tif( isEqual( recents[ i ], points ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tadd( points: DPickerColorGradientDataLike ): this {\r\n\t\tconst recents = this._recents;\r\n\t\trecents.push( points );\r\n\t\tif( this._capacity < recents.length ) {\r\n\t\t\trecents.shift();\r\n\t\t}\r\n\t\tthis.emit( \"change\", this );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpop(): DPickerColorGradientDataLike | null {\r\n\t\tconst recents = this._recents;\r\n\t\tconst result = recents.shift();\r\n\t\tif( result != null ) {\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._recents.length;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point, Sprite, Texture } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DAlignWith } from \"./d-align-with\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DInputReal } from \"./d-input-real\";\r\nimport { DPickerColor } from \"./d-picker-color\";\r\nimport { DPickerColorGradientData, DPickerColorGradientDataLike } from \"./d-picker-color-gradient-data\";\r\nimport { DPickerColorGradientDataView } from \"./d-picker-color-gradient-data-view\";\r\nimport { DPickerColorGradientPoint } from \"./d-picker-color-gradient-point\";\r\nimport { DPickerColorGradientRecent } from \"./d-picker-color-gradient-recent\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DPickerColorGradientOptions<\r\n\tTHEME extends DThemePickerColorGradient = DThemePickerColorGradient\r\n> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerColorGradient extends DThemeBase {\r\n\tgetGradientPointsWidth(): number;\r\n\tgetGradientPointsMargin(): number;\r\n\r\n\tgetGradientAnchorTexture(): Texture;\r\n\tgetGradientAnchorOutlinedTexture(): Texture;\r\n\tgetGradientAnchorOutlineTexture(): Texture;\r\n\r\n\tgetGradientDirectionMargin(): number;\r\n\tgetGradientDirectionTexture(): Texture;\r\n\r\n\tgetGradientRecentColumn(): number;\r\n\tgetGradientRecentWidth(): number;\r\n\tgetGradientRecentMargin(): number;\r\n\tgetGradientRecentCount(): number;\r\n\tgetGradientRecents(): DPickerColorGradientDataLike[];\r\n}\r\n\r\nexport class DPickerColorGradient<\r\n\tTHEME extends DThemePickerColorGradient = DThemePickerColorGradient,\r\n\tOPTIONS extends DPickerColorGradientOptions<THEME> = DPickerColorGradientOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected static RECENT_COLOR_GRADIENT: DPickerColorGradientRecent | null = null;\r\n\r\n\tprotected _picker!: DPickerColor;\r\n\tprotected _view!: DPickerColorGradientDataView;\r\n\tprotected _anchors!: Sprite[];\r\n\tprotected _recent!: DPickerColorGradientRecent;\r\n\r\n\tprotected _onAnchorDownBound!: ( e: InteractionEvent ) => void;\r\n\tprotected _onAnchorMoveBound!: ( e: InteractionEvent ) => void;\r\n\tprotected _onAnchorUpBound!: ( e: InteractionEvent ) => void;\r\n\r\n\tprotected _data!: DPickerColorGradientData;\r\n\tprotected _work!: Point;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\r\n\t\tconst theme = this.theme;\r\n\t\tconst padding = this._padding;\r\n\t\tconst paddingTop = padding.getTop();\r\n\t\tconst paddingRight = padding.getRight();\r\n\t\tconst paddingBottom = padding.getBottom();\r\n\t\tconst paddingLeft = padding.getLeft();\r\n\t\tthis._work = new Point();\r\n\r\n\t\t// Picker\r\n\t\tconst gradientPointsWidth = theme.getGradientPointsWidth();\r\n\t\tconst gradientPointsMargin = theme.getGradientPointsMargin();\r\n\t\tconst picker = this._picker = new DPickerColor({\r\n\t\t\tx: paddingLeft + gradientPointsWidth + gradientPointsMargin,\r\n\t\t\ty: paddingTop\r\n\t\t});\r\n\t\tpicker.on( \"newcolorchange\", ( color: number ): void => {\r\n\t\t\tthis.onAnchorColorChange( color );\r\n\t\t});\r\n\t\tpicker.on( \"newalphachange\", ( alpha: number ): void => {\r\n\t\t\tthis.onAnchorAlphaChange( alpha );\r\n\t\t});\r\n\t\tthis.addChild( picker );\r\n\r\n\t\t// Points view\r\n\t\tconst view = this._view = DPickerColorGradientDataView.from( 17, 10 );\r\n\t\tview.setRectangle( 0, paddingLeft, paddingTop, gradientPointsWidth, picker.height );\r\n\t\tthis.addChild( view );\r\n\t\tview.on( UtilPointerEvent.down, ( e: InteractionEvent ): void => {\r\n\t\t\tif( view.getLastHitIndex() === 0 ) {\r\n\t\t\t\tthis.onViewDown( e );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Anchor\r\n\t\tthis._onAnchorDownBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onAnchorDown( e );\r\n\t\t};\r\n\t\tthis._onAnchorMoveBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onAnchorMove( e );\r\n\t\t};\r\n\t\tthis._onAnchorUpBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onAnchorUp( e );\r\n\t\t};\r\n\t\tthis._anchors = [];\r\n\r\n\t\t//\r\n\t\tconst inputLabelWidth = picker.theme.getInputLabelWidth();\r\n\t\tconst inputWidth = picker.theme.getMainWidth() * 0.5;\r\n\t\tconst inputMargin = 5;\r\n\t\tconst inputDirectionMargin = theme.getGradientDirectionMargin();\r\n\t\tconst inputDirectionTexture = theme.getGradientDirectionTexture();\r\n\t\tconst inputLeft = picker.x + picker.width + inputDirectionMargin;\r\n\t\tconst inputDirection = new DInputReal({\r\n\t\t\tparent: this,\r\n\t\t\tx: inputLeft + inputLabelWidth + inputMargin,\r\n\t\t\ty: paddingTop,\r\n\t\t\twidth: inputWidth - inputLabelWidth - inputMargin,\r\n\t\t\tstep: 1,\r\n\t\t\timage: {\r\n\t\t\t\tsource: inputDirectionTexture,\r\n\t\t\t\talign: {\r\n\t\t\t\t\twith: DAlignWith.BORDER\r\n\t\t\t\t},\r\n\t\t\t\tmargin: {\r\n\t\t\t\t\thorizontal: -inputDirectionTexture.width - inputMargin\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\ton: {\r\n\t\t\t\tchange: ( value: number ) => {\r\n\t\t\t\t\t(this._data as any)._direction = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Recent gradients\r\n\t\tconst recentColumn = theme.getGradientRecentColumn();\r\n\t\tconst recentWidth = theme.getGradientRecentWidth();\r\n\t\tconst recentMargin = theme.getGradientRecentMargin();\r\n\t\tconst recentWidthAndMargin = recentWidth + recentMargin;\r\n\t\tconst x0 = inputLeft;\r\n\t\tconst y0 = inputDirection.y + inputDirection.height + inputDirectionMargin;\r\n\t\tif( DPickerColorGradient.RECENT_COLOR_GRADIENT == null ) {\r\n\t\t\tDPickerColorGradient.RECENT_COLOR_GRADIENT = new DPickerColorGradientRecent(\r\n\t\t\t\ttheme.getGradientRecents(),\r\n\t\t\t\ttheme.getGradientRecentCount()\r\n\t\t\t);\r\n\t\t}\r\n\t\tthis._recent = DPickerColorGradient.RECENT_COLOR_GRADIENT;\r\n\t\tconst recent = this._recent;\r\n\t\tfor( let i = 0, imax = recent.getCapacity(); i < imax; ++i ) {\r\n\t\t\tconst ix = i % recentColumn;\r\n\t\t\tconst x = x0 + ix * recentWidthAndMargin;\r\n\t\t\tconst iy = (i / recentColumn) | 0;\r\n\t\t\tconst y = y0 + iy * recentWidthAndMargin;\r\n\t\t\tview.setRectangle( 1 + i, x, y, recentWidth, recentWidth );\r\n\t\t}\r\n\t\trecent.on( \"change\", (): void => {\r\n\t\t\tthis.onRecentUpdate();\r\n\t\t});\r\n\t\tUtilPointerEvent.onClick( view, ( e: InteractionEvent ): void => {\r\n\t\t\tconst lastHitIndex = view.getLastHitIndex();\r\n\t\t\tif( 1 <= lastHitIndex ) {\r\n\t\t\t\tthis.onRecentClick( view.getData( lastHitIndex ) );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Points\r\n\t\tconst data = this._data = new DPickerColorGradientData();\r\n\t\tdata.on( \"change\", (): void => {\r\n\t\t\tthis.updateAnchors();\r\n\t\t\tview.update();\r\n\t\t});\r\n\t\tdata.on( \"selectionchange\", ( point: DPickerColorGradientPoint ): void => {\r\n\t\t\tthis.onAnchorSelect( point );\r\n\t\t});\r\n\t\tdata.on( \"directionchange\", ( value: number ): void => {\r\n\t\t\tinputDirection.value = value;\r\n\t\t});\r\n\t\tview.setData( 0, data );\r\n\t\tview.update();\r\n\t\tinputDirection.value = data.direction;\r\n\t\tthis.updateAnchors();\r\n\t\tconst selected = data.selected;\r\n\t\tif( selected != null ) {\r\n\t\t\tthis.onAnchorSelect( selected );\r\n\t\t}\r\n\r\n\t\t// Width\r\n\t\tif( options == null || options.width == null ) {\r\n\t\t\tthis.width = paddingLeft + gradientPointsWidth + gradientPointsMargin +\r\n\t\t\t\tpicker.width + inputDirectionMargin + (recentColumn - 1) * recentMargin +\r\n\t\t\t\trecentColumn * recentWidth + paddingRight;\r\n\t\t}\r\n\r\n\t\t// Height\r\n\t\tif( options == null || options.height == null ) {\r\n\t\t\tthis.height = paddingTop + picker.height + paddingBottom;\r\n\t\t}\r\n\t}\r\n\r\n\tget data(): DPickerColorGradientData {\r\n\t\treturn this._data;\r\n\t}\r\n\r\n\tget recent() {\r\n\t\treturn this._recent;\r\n\t}\r\n\r\n\tprotected onRecentClick( recentData: DPickerColorGradientDataLike | null ) {\r\n\t\tconst data = this._data;\r\n\t\tif( recentData != null ) {\r\n\t\t\tdata.fromObject( recentData );\r\n\t\t} else {\r\n\t\t\tdata.reset();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onRecentUpdate() {\r\n\t\tconst recent = this._recent;\r\n\t\tconst view = this._view;\r\n\t\tfor( let i = 0, imax = recent.size(); i < imax; ++i ) {\r\n\t\t\tview.setData( 1 + i, recent.get( i ) );\r\n\t\t}\r\n\t\tview.update();\r\n\t\tDApplications.update( this );\r\n\t}\r\n\r\n\tprotected toAnchorPosition( e: InteractionEvent ) {\r\n\t\tconst local = this.toLocal( e.data.global, undefined, this._work );\r\n\t\treturn Math.max( 0, Math.min( 1, (local.y - this.padding.getTop()) / this._picker.height ) );\r\n\t}\r\n\r\n\tprotected onViewDown( e: InteractionEvent ) {\r\n\t\tthis._data.addAt( this.toAnchorPosition( e ) );\r\n\t\tthis.onAnchorDragStart();\r\n\t}\r\n\r\n\tprotected onAnchorDown( e: InteractionEvent ) {\r\n\t\tconst target = e.target;\r\n\t\tif( target instanceof Sprite ) {\r\n\t\t\tconst data = this._data;\r\n\t\t\tconst index = this._anchors.indexOf( target );\r\n\t\t\tif( 0 <= index && index < data.points.length ) {\r\n\t\t\t\tdata.points[ index ].selected = true;\r\n\t\t\t\tthis.onAnchorDragStart();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onAnchorSelect( point: DPickerColorGradientPoint ) {\r\n\t\tconst picker = this._picker;\r\n\t\tpicker.current.color = point.color;\r\n\t\tpicker.current.alpha = point.alpha;\r\n\t\tpicker.new.color = point.color;\r\n\t\tpicker.new.alpha = point.alpha;\r\n\t}\r\n\r\n\tprotected onAnchorColorChange( color: number ) {\r\n\t\tconst points = this._data;\r\n\t\tif( points != null ) {\r\n\t\t\tconst selected = points.selected;\r\n\t\t\tif( selected != null ) {\r\n\t\t\t\tselected.color = color;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onAnchorAlphaChange( alpha: number ) {\r\n\t\tconst points = this._data;\r\n\t\tif( points != null ) {\r\n\t\t\tconst selected = points.selected;\r\n\t\t\tif( selected != null ) {\r\n\t\t\t\tselected.alpha = alpha;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onAnchorDragStart() {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst stage = layer.stage;\r\n\t\t\tstage.on( UtilPointerEvent.move, this._onAnchorMoveBound );\r\n\t\t\tstage.on( UtilPointerEvent.up, this._onAnchorUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onAnchorMove( e: InteractionEvent ): void {\r\n\t\tconst points = this._data;\r\n\t\tif( points != null ) {\r\n\t\t\tconst selected = points.selected;\r\n\t\t\tif( selected != null ) {\r\n\t\t\t\tselected.position = this.toAnchorPosition( e );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onAnchorUp( e: InteractionEvent ): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst stage = layer.stage;\r\n\t\t\tstage.off( UtilPointerEvent.move, this._onAnchorMoveBound );\r\n\t\t\tstage.off( UtilPointerEvent.up, this._onAnchorUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateAnchors() {\r\n\t\tconst theme = this.theme;\r\n\t\tconst anchorTexture = theme.getGradientAnchorTexture();\r\n\t\tconst anchorOutlinedTexture = theme.getGradientAnchorOutlinedTexture();\r\n\t\tconst gradientPointsWidth = theme.getGradientPointsWidth();\r\n\r\n\t\tconst data = this._data;\r\n\t\tconst pointSize = data.points.length;\r\n\r\n\t\tconst anchors = this._anchors;\r\n\t\tconst anchorSize = anchors.length;\r\n\t\tfor( let i = anchorSize; i < pointSize; ++i ) {\r\n\t\t\tconst newAnchor = new Sprite( anchorTexture );\r\n\t\t\tnewAnchor.anchor.set( 0.5, 0.5 );\r\n\t\t\tnewAnchor.cursor = \"pointer\";\r\n\t\t\tnewAnchor.interactive = true;\r\n\t\t\tnewAnchor.on( UtilPointerEvent.down, this._onAnchorDownBound );\r\n\t\t\tanchors.push( newAnchor );\r\n\t\t\tthis.addChild( newAnchor );\r\n\t\t}\r\n\r\n\t\tfor( let i = anchorSize - 1; pointSize <= i; --i ) {\r\n\t\t\tconst oldAnchor = anchors[ i ];\r\n\t\t\toldAnchor.off( UtilPointerEvent.down, this._onAnchorDownBound );\r\n\t\t\toldAnchor.destroy();\r\n\t\t}\r\n\t\tanchors.length = pointSize;\r\n\r\n\t\tconst y = this.padding.getTop();\r\n\t\tconst right = this.padding.getLeft() + gradientPointsWidth;\r\n\t\tconst height = this._picker.height;\r\n\t\tfor( let i = 0; i < pointSize; ++i ) {\r\n\t\t\tconst point = data.points[ i ];\r\n\t\t\tconst anchor = anchors[ i ];\r\n\t\t\tanchor.tint = point.color;\r\n\t\t\tanchor.position.set(\r\n\t\t\t\tright,\r\n\t\t\t\ty + height * point.position\r\n\t\t\t);\r\n\t\t\tanchor.texture = (point.selected ? anchorOutlinedTexture : anchorTexture);\r\n\t\t}\r\n\r\n\t\tDApplications.update( this );\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tif( UtilKeyboardEvent.isDeleteKey( e ) ) {\r\n\t\t\tconst points = this._data;\r\n\t\t\tif( points != null ) {\r\n\t\t\t\tconst selected = points.selected;\r\n\t\t\t\tif( selected != null ) {\r\n\t\t\t\t\tpoints.remove( selected );\r\n\t\t\t\t\tsuper.onKeyDown( e );\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn super.onKeyDown( e );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerColorGradient\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DPickerColorGradient, DPickerColorGradientOptions } from \"./d-picker-color-gradient\";\r\nimport { DPickerColorGradientData } from \"./d-picker-color-gradient-data\";\r\nimport { DPickerColorGradientRecent } from \"./d-picker-color-gradient-recent\";\r\n\r\nexport interface DDialogColorGradientOptions<\r\n\tTHEME extends DThemeDialogColorGradient = DThemeDialogColorGradient\r\n> extends DDialogCommandOptions<THEME> {\r\n\tpicker?: DPickerColorGradientOptions;\r\n}\r\n\r\nexport interface DThemeDialogColorGradient extends DThemeDialogCommand {\r\n\r\n}\r\n\r\nexport class DDialogColorGradient<\r\n\tTHEME extends DThemeDialogColorGradient = DThemeDialogColorGradient,\r\n\tOPTIONS extends DDialogColorGradientOptions<THEME> = DDialogColorGradientOptions<THEME>\r\n> extends DDialogCommand<THEME, OPTIONS> {\r\n\tprotected _picker!: DPickerColorGradient;\r\n\r\n\tprotected onInit( layout: DLayoutVertical, options?: OPTIONS ) {\r\n\t\tsuper.onInit( layout, options );\r\n\r\n\t\tconst picker = new DPickerColorGradient( options && options.picker );\r\n\t\tthis._picker = picker;\r\n\t\tlayout.addChild( picker );\r\n\r\n\t\tthis.on( \"ok\", (): void => {\r\n\t\t\tconst data = picker.data;\r\n\t\t\tconst recent = picker.recent;\r\n\t\t\tif( ! recent.contains( data ) ) {\r\n\t\t\t\trecent.add( data.toObject() );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tget data(): DPickerColorGradientData {\r\n\t\treturn this._picker.data;\r\n\t}\r\n\r\n\tget recent(): DPickerColorGradientRecent {\r\n\t\treturn this._picker.recent;\r\n\t}\r\n\r\n\tget picker(): DPickerColorGradient {\r\n\t\treturn this._picker;\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tthis._picker.onKeyDown( e );\r\n\t\treturn super.onKeyDown( e );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogColorGradient\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOnOptions, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DDialogColorGradient, DDialogColorGradientOptions } from \"./d-dialog-color-gradient\";\r\nimport { DPickerColorGradientData, DPickerColorGradientDataLike } from \"./d-picker-color-gradient-data\";\r\nimport { DPickerColorGradientDataView } from \"./d-picker-color-gradient-data-view\";\r\n\r\nexport interface DButtonColorGradientOnOptions extends DButtonOnOptions<DPickerColorGradientData> {\r\n\t/**\r\n\t * Triggered when a selection is changed.\r\n\t *\r\n\t * @param newValue a newly selected value\r\n\t * @param oldValue a previously selected value\r\n\t * @param self a button\r\n\t */\r\n\tchange?: ( newValue: DPickerColorGradientDataLike, oldValue: DPickerColorGradientDataLike, self: any ) => void;\r\n}\r\n\r\nexport interface DButtonColorGradientOptions<\r\n\tTHEME extends DThemeButtonColorGradient = DThemeButtonColorGradient\r\n> extends DButtonOptions<DPickerColorGradientData, THEME> {\r\n\tdialog?: DDialogColorGradientOptions;\r\n\ton?: DButtonColorGradientOnOptions;\r\n}\r\n\r\nexport interface DThemeButtonColorGradient extends DThemeButton {\r\n\tgetViewBaseTexture(): Texture | null;\r\n\tgetTextFormatter(): ( value: DPickerColorGradientData, caller: DButtonColorGradient ) => string;\r\n\tgetTextValue( state: DBaseState ): DPickerColorGradientData;\r\n\tnewTextValue(): DPickerColorGradientData;\r\n}\r\n\r\nexport class DButtonColorGradient<\r\n\tTHEME extends DThemeButtonColorGradient = DThemeButtonColorGradient,\r\n\tOPTIONS extends DButtonColorGradientOptions<THEME> = DButtonColorGradientOptions<THEME>\r\n> extends DButton<DPickerColorGradientData, THEME, OPTIONS> {\r\n\tprotected static DIALOG?: DDialogColorGradient;\r\n\tprotected _dialog?: DDialogColorGradient;\r\n\tprotected _dialogOptions?: DDialogColorGradientOptions;\r\n\tprotected _view?: DPickerColorGradientDataView;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tconst data = this._textValueComputed;\r\n\t\tthis._dialogOptions = options && options.dialog;\r\n\r\n\t\tif( options == null || options.image == null || options.image.source === undefined ) {\r\n\t\t\tconst texture = this.theme.getViewBaseTexture();\r\n\t\t\tif( texture instanceof Texture ) {\r\n\t\t\t\tconst view = this._view = DPickerColorGradientDataView.from( 1, 10, texture );\r\n\t\t\t\tview.setRectangle( 0, 0, 0, texture.width, texture.height );\r\n\t\t\t\tview.setData( 0, data );\r\n\t\t\t\tview.update();\r\n\t\t\t\tthis.image = view;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst dialog = this.dialog;\r\n\t\t\tdialog.data.fromObject( data );\r\n\t\t\tdialog.open().then((): void => {\r\n\t\t\t\tconst newValue = dialog.data;\r\n\t\t\t\tconst oldValue = data.toObject();\r\n\t\t\t\tdata.fromObject( newValue );\r\n\t\t\t\tconst view = this._view;\r\n\t\t\t\tif( view != null ) {\r\n\t\t\t\t\tview.update();\r\n\t\t\t\t}\r\n\t\t\t\tthis.onTextChange();\r\n\t\t\t\tthis.createOrUpdateText();\r\n\t\t\t\tDApplications.update( this );\r\n\t\t\t\tthis.emit( \"change\", newValue, oldValue, this );\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tget dialog(): DDialogColorGradient {\r\n\t\tlet dialog = this._dialog;\r\n\t\tif( dialog == null ) {\r\n\t\t\tconst dialogOptions = this._dialogOptions;\r\n\t\t\tif( dialogOptions != null ) {\r\n\t\t\t\tdialog = new DDialogColorGradient( this._dialogOptions );\r\n\t\t\t} else {\r\n\t\t\t\tif( DButtonColorGradient.DIALOG == null ) {\r\n\t\t\t\t\tDButtonColorGradient.DIALOG = new DDialogColorGradient();\r\n\t\t\t\t}\r\n\t\t\t\tdialog = DButtonColorGradient.DIALOG;\r\n\t\t\t}\r\n\t\t\tthis._dialog = dialog;\r\n\t\t}\r\n\t\treturn dialog;\r\n\t}\r\n\r\n\tget value(): DPickerColorGradientData {\r\n\t\treturn this._textValueComputed;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonColorGradient\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DColorAndAlpha } from \"./d-color\";\r\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DPickerColor, DPickerColorOptions } from \"./d-picker-color\";\r\nimport { DPickerColorRecent } from \"./d-picker-color-recent\";\r\n\r\nexport interface DDialogColorOptions<\r\n\tTHEME extends DThemeDialogColor = DThemeDialogColor\r\n> extends DDialogCommandOptions<THEME> {\r\n\tpicker?: DPickerColorOptions;\r\n}\r\n\r\nexport interface DThemeDialogColor extends DThemeDialogCommand {\r\n\r\n}\r\n\r\nexport class DDialogColor<\r\n\tTHEME extends DThemeDialogColor = DThemeDialogColor,\r\n\tOPTIONS extends DDialogColorOptions<THEME> = DDialogColorOptions<THEME>\r\n> extends DDialogCommand<THEME, OPTIONS> {\r\n\tprotected _picker!: DPickerColor;\r\n\r\n\tprotected onInit( layout: DLayoutVertical, options?: OPTIONS ) {\r\n\t\tsuper.onInit( layout, options );\r\n\r\n\t\tconst picker = new DPickerColor( options && options.picker );\r\n\t\tthis._picker = picker;\r\n\t\tlayout.addChild( picker );\r\n\r\n\t\tthis.on( \"ok\", (): void => {\r\n\t\t\tconst recent = picker.recent;\r\n\t\t\tif( ! recent.contains( picker.new ) ) {\r\n\t\t\t\trecent.add( picker.new );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tget current(): DColorAndAlpha {\r\n\t\treturn this._picker.current;\r\n\t}\r\n\r\n\tget new(): DColorAndAlpha {\r\n\t\treturn this._picker.new;\r\n\t}\r\n\r\n\tget recent(): DPickerColorRecent {\r\n\t\treturn this._picker.recent;\r\n\t}\r\n\r\n\tget picker(): DPickerColor {\r\n\t\treturn this._picker;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogColor\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOnOptions, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DColorAndAlpha } from \"./d-color\";\r\nimport { DDialogColor, DDialogColorOptions } from \"./d-dialog-color\";\r\nimport { DImagePieceOptions, DImagePieceTintOptions } from \"./d-image-piece\";\r\nimport { DPickerColorAndAlpha } from \"./d-picker-color-and-alpha\";\r\n\r\n/**\r\n * Mappings of event names and handlers.\r\n */\r\nexport interface DButtonColorOnOptions extends DButtonOnOptions<DColorAndAlpha> {\r\n\t/**\r\n\t * Triggered when a selection is changed.\r\n\t *\r\n\t * @param newValue a newly selected value\r\n\t * @param oldValue a previously selected value\r\n\t * @param self a button\r\n\t */\r\n\tchange?: ( newValue: DColorAndAlpha, oldValue: DColorAndAlpha, self: any ) => void;\r\n}\r\n\r\nexport interface DButtonColorOptions<\r\n\tTHEME extends DThemeButtonColor = DThemeButtonColor\r\n> extends DButtonOptions<DColorAndAlpha, THEME> {\r\n\t/**\r\n\t * A dialog to pick a color.\r\n\t */\r\n\tdialog?: DDialogColorOptions;\r\n\r\n\ton?: DButtonColorOnOptions;\r\n}\r\n\r\nexport interface DThemeButtonColor extends DThemeButton {\r\n\tgetTextFormatter(): ( value: DColorAndAlpha, caller: DButtonColor ) => string;\r\n\tgetTextValue( state: DBaseState ): DColorAndAlpha;\r\n\tnewTextValue(): DColorAndAlpha;\r\n}\r\n\r\nexport class DButtonColor<\r\n\tTHEME extends DThemeButtonColor = DThemeButtonColor,\r\n\tOPTIONS extends DButtonColorOptions<THEME> = DButtonColorOptions<THEME>\r\n> extends DButton<DColorAndAlpha, THEME, OPTIONS> {\r\n\tprotected static DIALOG?: DDialogColor;\r\n\tprotected _dialog?: DDialogColor;\r\n\tprotected _value!: DPickerColorAndAlpha;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tconst colorAndAlpha = this._textValueComputed;\r\n\t\tthis._value = new DPickerColorAndAlpha( colorAndAlpha, ( color: number ): void => {\r\n\t\t\tcolorAndAlpha.color = color;\r\n\t\t\tthis.onColorChange();\r\n\t\t}, ( alpha: number ): void => {\r\n\t\t\tcolorAndAlpha.alpha = alpha;\r\n\t\t\tthis.updateTextForcibly();\r\n\t\t});\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst dialog = this.dialog;\r\n\t\t\tdialog.current.color = colorAndAlpha.color;\r\n\t\t\tdialog.current.alpha = colorAndAlpha.alpha;\r\n\t\t\tdialog.new.color = colorAndAlpha.color;\r\n\t\t\tdialog.new.alpha = colorAndAlpha.alpha;\r\n\t\t\tdialog.open().then((): void => {\r\n\t\t\t\tconst dialogNew = dialog.new;\r\n\t\t\t\tconst dialogCurrent = dialog.current;\r\n\t\t\t\tcolorAndAlpha.color = dialogNew.color;\r\n\t\t\t\tcolorAndAlpha.alpha = dialogNew.alpha;\r\n\t\t\t\tthis.onColorChange();\r\n\t\t\t\tthis.emit( \"change\", dialogNew, dialogCurrent, this );\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprotected toImageTintOptions( tint?: DImagePieceTintOptions ): DImagePieceTintOptions {\r\n\t\tconst color = () => this._textValueComputed.color;\r\n\t\tif( tint ) {\r\n\t\t\treturn {\r\n\t\t\t\tcolor: tint.color || color,\r\n\t\t\t\talpha: tint.alpha\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tcolor\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toImageOptions( theme: THEME, options?: DImagePieceOptions ): DImagePieceOptions | undefined {\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\tsource: options.source,\r\n\t\t\t\ttint: this.toImageTintOptions( options.tint ),\r\n\t\t\t\talign: options.align,\r\n\t\t\t\tmargin: options.margin\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttint: this.toImageTintOptions()\r\n\t\t};\r\n\t}\r\n\r\n\tprotected onColorChange(): void {\r\n\t\tif( this._images[ 0 ].updateTint() ) {\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t\tthis.updateTextForcibly();\r\n\t}\r\n\r\n\tprotected updateTextForcibly(): void {\r\n\t\tthis.onTextChange();\r\n\t\tthis.createOrUpdateText();\r\n\t}\r\n\r\n\tget dialog(): DDialogColor {\r\n\t\tlet dialog = this._dialog;\r\n\t\tif( dialog == null ) {\r\n\t\t\tconst options = this._options;\r\n\t\t\tconst dialogOptions = options && options.dialog;\r\n\t\t\tif( dialogOptions != null ) {\r\n\t\t\t\tdialog = new DDialogColor( dialogOptions );\r\n\t\t\t} else {\r\n\t\t\t\tif( DButtonColor.DIALOG == null ) {\r\n\t\t\t\t\tDButtonColor.DIALOG = new DDialogColor();\r\n\t\t\t\t}\r\n\t\t\t\tdialog = DButtonColor.DIALOG;\r\n\t\t\t}\r\n\t\t\tthis._dialog = dialog;\r\n\t\t}\r\n\t\treturn dialog;\r\n\t}\r\n\r\n\tget value(): DColorAndAlpha {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonColor\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton } from \"./d-button\";\r\n\r\nexport class DButtonDanger extends DButton {\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonDanger\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\r\n\r\nexport interface DPickerDatetimeButtonBackOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePickerDatetimeButtonBack = DThemePickerDatetimeButtonBack\r\n> extends DButtonAmbientOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerDatetimeButtonBack extends DThemeButtonAmbient {\r\n\r\n}\r\n\r\nexport class DPickerDatetimeButtonBack<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePickerDatetimeButtonBack = DThemePickerDatetimeButtonBack,\r\n\tOPTIONS extends DPickerDatetimeButtonBackOptions<VALUE, THEME> = DPickerDatetimeButtonBackOptions<VALUE, THEME>\r\n> extends DButtonAmbient<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerDatetimeButtonBack\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\r\n\r\nexport interface DPickerDatetimeButtonDateOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePickerDatetimeButtonDate = DThemePickerDatetimeButtonDate\r\n> extends DButtonAmbientOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerDatetimeButtonDate extends DThemeButtonAmbient {\r\n\r\n}\r\n\r\nexport class DPickerDatetimeButtonDate<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePickerDatetimeButtonDate = DThemePickerDatetimeButtonDate,\r\n\tOPTIONS extends DPickerDatetimeButtonDateOptions<VALUE, THEME> = DPickerDatetimeButtonDateOptions<VALUE, THEME>\r\n> extends DButtonAmbient<VALUE, THEME, OPTIONS> {\r\n\tprotected onToggleStart(): void {\r\n\t\tif( ! this.isActive() ) {\r\n\t\t\tthis.setActive( true );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onToggleEnd(): void {\r\n\t\tthis.emit( this.isActive() ? \"active\" : \"inactive\", this );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerDatetimeButtonDate\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\r\n\r\nexport interface DPickerDatetimeButtonNextOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePickerDatetimeButtonNext = DThemePickerDatetimeButtonNext\r\n> extends DButtonAmbientOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerDatetimeButtonNext extends DThemeButtonAmbient {\r\n\r\n}\r\n\r\nexport class DPickerDatetimeButtonNext<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePickerDatetimeButtonNext = DThemePickerDatetimeButtonNext,\r\n\tOPTIONS extends DPickerDatetimeButtonNextOptions<VALUE, THEME> = DPickerDatetimeButtonNextOptions<VALUE, THEME>\r\n> extends DButtonAmbient<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerDatetimeButtonNext\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DText, DTextOptions, DThemeText } from \"./d-text\";\r\n\r\nexport interface DPickerDatetimeLabelOptions<\r\n\tTHEME extends DThemePickerDatetimeLabel = DThemePickerDatetimeLabel\r\n> extends DTextOptions<Date, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerDatetimeLabel extends DThemeText {\r\n\r\n}\r\n\r\nexport class DPickerDatetimeLabel<\r\n\tTHEME extends DThemePickerDatetimeLabel = DThemePickerDatetimeLabel,\r\n\tOPTIONS extends DPickerDatetimeLabelOptions<THEME> = DPickerDatetimeLabelOptions<THEME>\r\n> extends DText<Date, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerDatetimeLabel\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DText, DTextOptions, DThemeText } from \"./d-text\";\r\n\r\nexport interface DPickerDatetimeLabelDateOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePickerDatetimeLabelDate = DThemePickerDatetimeLabelDate\r\n> extends DTextOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerDatetimeLabelDate extends DThemeText {\r\n\r\n}\r\n\r\nexport class DPickerDatetimeLabelDate<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePickerDatetimeLabelDate = DThemePickerDatetimeLabelDate,\r\n\tOPTIONS extends DPickerDatetimeLabelDateOptions<VALUE, THEME> = DPickerDatetimeLabelDateOptions<VALUE, THEME>\r\n> extends DText<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerDatetimeLabelDate\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\n\r\nexport interface DPickerDatetimeSpaceOptions<\r\n\tTHEME extends DThemePickerDatetimeSpace = DThemePickerDatetimeSpace\r\n> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerDatetimeSpace extends DThemeBase {\r\n\r\n}\r\n\r\nexport class DPickerDatetimeSpace<\r\n\tTHEME extends DThemePickerDatetimeSpace = DThemePickerDatetimeSpace,\r\n\tOPTIONS extends DPickerDatetimeSpaceOptions<THEME> = DPickerDatetimeSpaceOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t\tthis.renderable = false;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerDatetimeSpace\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DInputNumber, DInputNumberOptions, DThemeInputNumber } from \"./d-input-number\";\r\n\r\nexport interface DInputIntegerOptions<\r\n\tTHEME extends DThemeInputInteger = DThemeInputInteger\r\n> extends DInputNumberOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeInputInteger extends DThemeInputNumber {\r\n}\r\n\r\nexport class DInputInteger<\r\n\tTHEME extends DThemeInputInteger = DThemeInputInteger,\r\n\tOPTIONS extends DInputIntegerOptions<THEME> = DInputIntegerOptions<THEME>\r\n> extends DInputNumber<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DInputInteger\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport type DPickerTimeBoundDate = Date | null;\r\n\r\nexport interface DPickerTimeBoundOptions {\r\n\tdate?: DPickerTimeBoundDate;\r\n\tinclusive?: boolean;\r\n}\r\n\r\nexport class DPickerTimeBound {\r\n\tprotected _date: DPickerTimeBoundDate;\r\n\tprotected _inclusive: boolean;\r\n\tprotected _onChange: () => void;\r\n\r\n\tconstructor( options: DPickerTimeBoundOptions | undefined, onChange: () => void ) {\r\n\t\tthis._date = ( options && options.date !== undefined ? options.date : null );\r\n\t\tthis._inclusive = ( options && options.inclusive !== undefined ? options.inclusive : false );\r\n\t\tthis._onChange = onChange;\r\n\t}\r\n\r\n\tget date(): DPickerTimeBoundDate {\r\n\t\treturn this._date;\r\n\t}\r\n\r\n\tset date( date: DPickerTimeBoundDate ) {\r\n\t\tif( this._date !== date ) {\r\n\t\t\tthis._date = date;\r\n\t\t\tthis._onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tget inclusive(): boolean {\r\n\t\treturn this._inclusive;\r\n\t}\r\n\r\n\tset inclusive( inclusive: boolean ) {\r\n\t\tif( this._inclusive !== inclusive ) {\r\n\t\t\tthis._inclusive = inclusive;\r\n\t\t\tthis._onChange();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, utils } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\n\r\nexport enum DListSelectionMode {\r\n\tNONE,\r\n\tSINGLE,\r\n\tMULTIPLE\r\n}\r\n\r\nexport interface DListSelectionOnOptions {\r\n\t[ name: string ]: Function;\r\n}\r\n\r\nexport interface DListSelectionOptions {\r\n\tmode?: DListSelectionMode;\r\n\ton?: DListSelectionOnOptions;\r\n}\r\n\r\nexport class DListSelection extends utils.EventEmitter {\r\n\tprotected _content: Container;\r\n\tprotected _isDirty: boolean;\r\n\tprotected _indices: number[];\r\n\tprotected _mode: DListSelectionMode;\r\n\r\n\tconstructor( content: Container, options?: DListSelectionOptions ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._content = content;\r\n\t\tthis._isDirty = false;\r\n\t\tthis._indices = [];\r\n\t\tthis._mode = ( options && options.mode != null ? options.mode : DListSelectionMode.SINGLE );\r\n\r\n\t\t// Events\r\n\t\tconst on = options && options.on;\r\n\t\tif( on ) {\r\n\t\t\tfor( const name in on ) {\r\n\t\t\t\tthis.on( name, on[ name ] );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoDirty() {\r\n\t\tthis._isDirty = true;\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tif( this._isDirty ) {\r\n\t\t\tthis._isDirty = false;\r\n\t\t\tconst indices = this._indices;\r\n\t\t\tindices.length = 0;\r\n\t\t\tconst content = this._content;\r\n\t\t\tconst children = content.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\t\tif( child.isActive() ) {\r\n\t\t\t\t\t\tindices.push( i );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsize() {\r\n\t\tthis.update();\r\n\t\treturn this._indices.length;\r\n\t}\r\n\r\n\tisEmpty(): boolean {\r\n\t\treturn this.size() <= 0;\r\n\t}\r\n\r\n\tfirst<T>(): T | null {\r\n\t\treturn this.get( 0 );\r\n\t}\r\n\r\n\tget<T>( index: number ): T | null {\r\n\t\tthis.update();\r\n\t\tconst indices = this._indices;\r\n\t\tif( 0 <= index && index < indices.length ) {\r\n\t\t\tconst content = this._content;\r\n\t\t\tconst child = content.children[ indices[ index ] ];\r\n\t\t\tif( child != null ) {\r\n\t\t\t\treturn child as any;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tgetIndex( index: number ): number | null {\r\n\t\tthis.update();\r\n\t\tconst indices = this._indices;\r\n\t\tif( 0 <= index && index < indices.length ) {\r\n\t\t\treturn indices[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tthis.update();\r\n\t\tconst indices = this._indices;\r\n\t\tif( 0 < indices.length ) {\r\n\t\t\tconst content = this._content;\r\n\t\t\tconst children = content.children;\r\n\t\t\tfor( let i = 0, imax = indices.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ indices[ i ] ];\r\n\t\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\t\tchild.setActive( false );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tindices.length = 0;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tadd<T extends DBase<any, any>>( target: T ) {\r\n\t\tconst mode = this._mode;\r\n\t\tconst content = this._content;\r\n\t\tif( mode === DListSelectionMode.SINGLE ) {\r\n\t\t\tif( ! target.isActive() ) {\r\n\t\t\t\tthis.update();\r\n\r\n\t\t\t\t// Remove the existing\r\n\t\t\t\tconst indices = this._indices;\r\n\t\t\t\tconst children = content.children;\r\n\t\t\t\tfor( let i = 0, imax = indices.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst child = children[ indices[ i ] ];\r\n\t\t\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\t\t\tchild.setActive( false );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tindices.length = 0;\r\n\r\n\t\t\t\t// Add a new child\r\n\t\t\t\tindices.push( content.getChildIndex( target ) );\r\n\t\t\t\ttarget.setActive( true );\r\n\r\n\t\t\t\t// Event\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t}\r\n\t\t} else if( mode === DListSelectionMode.MULTIPLE ) {\r\n\t\t\tif( ! target.isActive() ) {\r\n\t\t\t\tif( this._isDirty ) {\r\n\t\t\t\t\ttarget.setActive( true );\r\n\t\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Find an insertion position\r\n\t\t\t\t\tconst indices = this._indices;\r\n\t\t\t\t\tconst targetIndex = content.getChildIndex( target );\r\n\t\t\t\t\tfor( let i = 0, imax = indices.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst index = indices[ i ];\r\n\t\t\t\t\t\tif( targetIndex === index ) {\r\n\t\t\t\t\t\t\ttarget.setActive( true );\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t} else if( targetIndex < index ) {\r\n\t\t\t\t\t\t\tindices.splice( i, 0, targetIndex );\r\n\t\t\t\t\t\t\ttarget.setActive( true );\r\n\t\t\t\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Push\r\n\t\t\t\t\tindices.push( targetIndex );\r\n\t\t\t\t\ttarget.setActive( true );\r\n\t\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tremove<T extends DBase<any, any>>( target: T ) {\r\n\t\tif( ! target.isActive() ) {\r\n\t\t\tif( this._isDirty ) {\r\n\t\t\t\ttarget.setActive( false );\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t} else {\r\n\t\t\t\tconst indices = this._indices;\r\n\t\t\t\tconst content = this._content;\r\n\t\t\t\tconst targetIndex = content.getChildIndex( target );\r\n\t\t\t\tfor( let i = 0, imax = indices.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst index = indices[ i ];\r\n\t\t\t\t\tif( targetIndex === index ) {\r\n\t\t\t\t\t\tindices.splice( i, 1 );\r\n\t\t\t\t\t\ttarget.setActive( false );\r\n\t\t\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerTimeBound } from \"./d-picker-time-bound\";\r\nimport { DPickerTimeBoundConstant } from \"./d-picker-time-bound-constant\";\r\n\r\nexport interface DPickerTimeBoundHoursParent {\r\n\tlower: DPickerTimeBound;\r\n\tupper: DPickerTimeBound;\r\n\tmask: DPickerDatetimeMask;\r\n\tconstant: DPickerTimeBoundConstant;\r\n}\r\n\r\nexport class DPickerTimeBoundHours {\r\n\tprotected _parent: DPickerTimeBoundHoursParent;\r\n\r\n\tconstructor( parent: DPickerTimeBoundHoursParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tmin( date: Date ): number {\r\n\t\tconst parent = this._parent;\r\n\t\tconst lower = parent.lower;\r\n\t\tconst lowerDate = lower.date;\r\n\t\tconst constant = parent.constant;\r\n\t\tif( lowerDate != null ) {\r\n\t\t\tconst mask = parent.mask;\r\n\t\t\tif( mask & DPickerDatetimeMask.DATE ) {\r\n\t\t\t\tif( lowerDate.getFullYear() < date.getFullYear() ) {\r\n\t\t\t\t\treturn constant.hour.min;\r\n\t\t\t\t}\r\n\t\t\t\tif( lowerDate.getMonth() < date.getMonth() ) {\r\n\t\t\t\t\treturn constant.hour.min;\r\n\t\t\t\t}\r\n\t\t\t\tif( lowerDate.getDate() < date.getDate() ) {\r\n\t\t\t\t\treturn constant.hour.min;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst lowerDateHours = lowerDate.getHours();\r\n\t\t\tif( lower.inclusive ) {\r\n\t\t\t\treturn lowerDateHours;\r\n\t\t\t} else {\r\n\t\t\t\tif( mask & DPickerDatetimeMask.SECONDS ) {\r\n\t\t\t\t\tif( lowerDate.getSeconds() < constant.second.max ) {\r\n\t\t\t\t\t\treturn lowerDateHours;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif( mask & DPickerDatetimeMask.MINUTES ) {\r\n\t\t\t\t\tif( lowerDate.getMinutes() < constant.minute.max ) {\r\n\t\t\t\t\t\treturn lowerDateHours;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn lowerDateHours + 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn constant.hour.min;\r\n\t}\r\n\r\n\tmax( date: Date ): number {\r\n\t\tconst parent = this._parent;\r\n\t\tconst upper = parent.upper;\r\n\t\tconst upperDate = upper.date;\r\n\t\tconst constant = parent.constant;\r\n\t\tif( upperDate != null ) {\r\n\t\t\tconst mask = parent.mask;\r\n\t\t\tif( mask & DPickerDatetimeMask.DATE ) {\r\n\t\t\t\tif( date.getFullYear() < upperDate.getFullYear() ) {\r\n\t\t\t\t\treturn constant.hour.max;\r\n\t\t\t\t}\r\n\t\t\t\tif( date.getMonth() < upperDate.getMonth() ) {\r\n\t\t\t\t\treturn constant.hour.max;\r\n\t\t\t\t}\r\n\t\t\t\tif( date.getDate() < upperDate.getDate() ) {\r\n\t\t\t\t\treturn constant.hour.max;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst upperDateHours = upperDate.getHours();\r\n\t\t\tif( upper.inclusive ) {\r\n\t\t\t\treturn upperDateHours;\r\n\t\t\t} else {\r\n\t\t\t\tif( mask & DPickerDatetimeMask.SECONDS ) {\r\n\t\t\t\t\tif( constant.second.min < upperDate.getSeconds() ) {\r\n\t\t\t\t\t\treturn upperDateHours;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif( mask & DPickerDatetimeMask.MINUTES ) {\r\n\t\t\t\t\tif( constant.minute.min < upperDate.getMinutes() ) {\r\n\t\t\t\t\t\treturn upperDateHours;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn upperDateHours - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn constant.hour.max;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerTimeBound } from \"./d-picker-time-bound\";\r\nimport { DPickerTimeBoundConstant } from \"./d-picker-time-bound-constant\";\r\n\r\nexport interface DPickerTimeBoundMinutesParent {\r\n\tlower: DPickerTimeBound;\r\n\tupper: DPickerTimeBound;\r\n\tmask: DPickerDatetimeMask;\r\n\tconstant: DPickerTimeBoundConstant;\r\n}\r\n\r\nexport class DPickerTimeBoundMinutes {\r\n\tprotected _parent: DPickerTimeBoundMinutesParent;\r\n\r\n\tconstructor( parent: DPickerTimeBoundMinutesParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tmin( date: Date ): number {\r\n\t\tconst parent = this._parent;\r\n\t\tconst lower = parent.lower;\r\n\t\tconst lowerDate = lower.date;\r\n\t\tconst constant = parent.constant;\r\n\t\tif( lowerDate != null ) {\r\n\t\t\tconst mask = parent.mask;\r\n\t\t\tif( mask & DPickerDatetimeMask.DATE ) {\r\n\t\t\t\tif( lowerDate.getFullYear() < date.getFullYear() ) {\r\n\t\t\t\t\treturn constant.minute.min;\r\n\t\t\t\t}\r\n\t\t\t\tif( lowerDate.getMonth() < date.getMonth() ) {\r\n\t\t\t\t\treturn constant.minute.min;\r\n\t\t\t\t}\r\n\t\t\t\tif( lowerDate.getDate() < date.getDate() ) {\r\n\t\t\t\t\treturn constant.minute.min;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( mask & DPickerDatetimeMask.HOURS ) {\r\n\t\t\t\tif( lowerDate.getHours() < date.getHours() ) {\r\n\t\t\t\t\treturn constant.minute.min;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst lowerDateMinutes = lowerDate.getMinutes();\r\n\t\t\tif( lower.inclusive ) {\r\n\t\t\t\treturn lowerDateMinutes;\r\n\t\t\t} else {\r\n\t\t\t\tif( mask & DPickerDatetimeMask.SECONDS ) {\r\n\t\t\t\t\tif( lowerDate.getSeconds() < constant.second.max ) {\r\n\t\t\t\t\t\treturn lowerDateMinutes;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn lowerDateMinutes + 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn constant.minute.min;\r\n\t}\r\n\r\n\tmax( date: Date ): number {\r\n\t\tconst parent = this._parent;\r\n\t\tconst upper = parent.upper;\r\n\t\tconst upperDate = upper.date;\r\n\t\tconst constant = parent.constant;\r\n\t\tif( upperDate != null ) {\r\n\t\t\tconst mask = parent.mask;\r\n\t\t\tif( mask & DPickerDatetimeMask.DATE ) {\r\n\t\t\t\tif( date.getFullYear() < upperDate.getFullYear() ) {\r\n\t\t\t\t\treturn constant.minute.max;\r\n\t\t\t\t}\r\n\t\t\t\tif( date.getMonth() < upperDate.getMonth() ) {\r\n\t\t\t\t\treturn constant.minute.max;\r\n\t\t\t\t}\r\n\t\t\t\tif( date.getDate() < upperDate.getDate() ) {\r\n\t\t\t\t\treturn constant.minute.max;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( mask & DPickerDatetimeMask.HOURS ) {\r\n\t\t\t\tif( date.getHours() < upperDate.getHours() ) {\r\n\t\t\t\t\treturn constant.minute.max;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst upperDateMinutes = upperDate.getMinutes();\r\n\t\t\tif( upper.inclusive ) {\r\n\t\t\t\treturn upperDateMinutes;\r\n\t\t\t} else {\r\n\t\t\t\tif( mask & DPickerDatetimeMask.SECONDS ) {\r\n\t\t\t\t\tif( constant.second.min < upperDate.getSeconds() ) {\r\n\t\t\t\t\t\treturn upperDateMinutes;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn upperDateMinutes - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn constant.minute.max;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerTimeBound } from \"./d-picker-time-bound\";\r\nimport { DPickerTimeBoundConstant } from \"./d-picker-time-bound-constant\";\r\n\r\nexport interface DPickerTimeBoundSecondsParent {\r\n\tlower: DPickerTimeBound;\r\n\tupper: DPickerTimeBound;\r\n\tmask: DPickerDatetimeMask;\r\n\tconstant: DPickerTimeBoundConstant;\r\n}\r\n\r\nexport class DPickerTimeBoundSeconds {\r\n\tprotected _parent: DPickerTimeBoundSecondsParent;\r\n\r\n\tconstructor( parent: DPickerTimeBoundSecondsParent ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tmin( date: Date ): number {\r\n\t\tconst parent = this._parent;\r\n\t\tconst lower = parent.lower;\r\n\t\tconst lowerDate = lower.date;\r\n\t\tconst constant = parent.constant;\r\n\t\tif( lowerDate != null ) {\r\n\t\t\tconst mask = parent.mask;\r\n\t\t\tif( mask & DPickerDatetimeMask.DATE ) {\r\n\t\t\t\tif( lowerDate.getFullYear() < date.getFullYear() ) {\r\n\t\t\t\t\treturn constant.second.min;\r\n\t\t\t\t}\r\n\t\t\t\tif( lowerDate.getMonth() < date.getMonth() ) {\r\n\t\t\t\t\treturn constant.second.min;\r\n\t\t\t\t}\r\n\t\t\t\tif( lowerDate.getDate() < date.getDate() ) {\r\n\t\t\t\t\treturn constant.second.min;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( mask & DPickerDatetimeMask.HOURS ) {\r\n\t\t\t\tif( lowerDate.getHours() < date.getHours() ) {\r\n\t\t\t\t\treturn constant.second.min;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( mask & DPickerDatetimeMask.MINUTES ) {\r\n\t\t\t\tif( lowerDate.getMinutes() < date.getMinutes() ) {\r\n\t\t\t\t\treturn constant.second.min;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn lowerDate.getSeconds() + ( lower.inclusive ? 0 : 1 );\r\n\t\t}\r\n\t\treturn constant.second.min;\r\n\t}\r\n\r\n\tmax( date: Date ): number {\r\n\t\tconst parent = this._parent;\r\n\t\tconst upper = parent.upper;\r\n\t\tconst upperDate = upper.date;\r\n\t\tconst constant = parent.constant;\r\n\t\tif( upperDate != null ) {\r\n\t\t\tconst mask = parent.mask;\r\n\t\t\tif( mask & DPickerDatetimeMask.DATE ) {\r\n\t\t\t\tif( date.getFullYear() < upperDate.getFullYear() ) {\r\n\t\t\t\t\treturn constant.second.max;\r\n\t\t\t\t}\r\n\t\t\t\tif( date.getMonth() < upperDate.getMonth() ) {\r\n\t\t\t\t\treturn constant.second.max;\r\n\t\t\t\t}\r\n\t\t\t\tif( date.getDate() < upperDate.getDate() ) {\r\n\t\t\t\t\treturn constant.second.max;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( mask & DPickerDatetimeMask.HOURS ) {\r\n\t\t\t\tif( date.getHours() < upperDate.getHours() ) {\r\n\t\t\t\t\treturn constant.second.max;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( mask & DPickerDatetimeMask.MINUTES ) {\r\n\t\t\t\tif( date.getMinutes() < upperDate.getMinutes() ) {\r\n\t\t\t\t\treturn constant.second.max;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn upperDate.getSeconds() - ( upper.inclusive ? 0 : 1 );\r\n\t\t}\r\n\t\treturn constant.second.max;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerTimeBound, DPickerTimeBoundOptions } from \"./d-picker-time-bound\";\r\nimport { DPickerTimeBoundConstant } from \"./d-picker-time-bound-constant\";\r\nimport { DPickerTimeBoundHours } from \"./d-picker-time-bound-hours\";\r\nimport { DPickerTimeBoundMinutes } from \"./d-picker-time-bound-minutes\";\r\nimport { DPickerTimeBoundSeconds } from \"./d-picker-time-bound-seconds\";\r\n\r\nexport interface DPickerTimeBoundsOptions {\r\n\tlower?: DPickerTimeBoundOptions;\r\n\tupper?: DPickerTimeBoundOptions;\r\n}\r\n\r\nexport class DPickerTimeBounds {\r\n\tlower: DPickerTimeBound;\r\n\tupper: DPickerTimeBound;\r\n\tmask: DPickerDatetimeMask;\r\n\thours: DPickerTimeBoundHours;\r\n\tminutes: DPickerTimeBoundMinutes;\r\n\tseconds: DPickerTimeBoundSeconds;\r\n\tconstant: DPickerTimeBoundConstant;\r\n\r\n\tconstructor( options: DPickerTimeBoundsOptions | undefined, onChange: () => void ) {\r\n\t\tthis.constant = this.newConstant();\r\n\t\tthis.lower = new DPickerTimeBound( options && options.lower, onChange );\r\n\t\tthis.upper = new DPickerTimeBound( options && options.upper, onChange );\r\n\t\tthis.mask = DPickerDatetimeMask.ALL;\r\n\t\tthis.hours = new DPickerTimeBoundHours( this );\r\n\t\tthis.minutes = new DPickerTimeBoundMinutes( this );\r\n\t\tthis.seconds = new DPickerTimeBoundSeconds( this );\r\n\t}\r\n\r\n\tnewConstant(): DPickerTimeBoundConstant {\r\n\t\treturn {\r\n\t\t\tsecond: {\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 59\r\n\t\t\t},\r\n\r\n\t\t\tminute: {\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 59\r\n\t\t\t},\r\n\r\n\t\t\thour: {\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tmax: 23\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tadjust( date: Date ): boolean {\r\n\t\tconst result = this.test( date );\r\n\t\tif( result < 0 ) {\r\n\t\t\tconst lower = this.lower;\r\n\t\t\tconst lowerDate = lower.date;\r\n\t\t\tif( lowerDate ) {\r\n\t\t\t\tdate.setTime( lowerDate.getTime() );\r\n\t\t\t\tif( ! lower.inclusive ) {\r\n\t\t\t\t\tconst mask = this.mask;\r\n\t\t\t\t\tif( mask & DPickerDatetimeMask.SECONDS ) {\r\n\t\t\t\t\t\tdate.setSeconds( lowerDate.getSeconds() + 1 );\r\n\t\t\t\t\t} else if( mask & DPickerDatetimeMask.MINUTES ) {\r\n\t\t\t\t\t\tdate.setMinutes( lowerDate.getMinutes() + 1 );\r\n\t\t\t\t\t} else if( mask & DPickerDatetimeMask.HOURS ) {\r\n\t\t\t\t\t\tdate.setHours( lowerDate.getHours() + 1 );\r\n\t\t\t\t\t} else if( mask & DPickerDatetimeMask.DATE ) {\r\n\t\t\t\t\t\tdate.setDate( lowerDate.getDate() + 1 );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if( 0 < result ) {\r\n\t\t\tconst upper = this.upper;\r\n\t\t\tconst upperDate = upper.date;\r\n\t\t\tif( upperDate ) {\r\n\t\t\t\tdate.setTime( upperDate.getTime() );\r\n\t\t\t\tif( ! upper.inclusive ) {\r\n\t\t\t\t\tconst mask = this.mask;\r\n\t\t\t\t\tif( mask & DPickerDatetimeMask.SECONDS ) {\r\n\t\t\t\t\t\tdate.setSeconds( upperDate.getSeconds() - 1 );\r\n\t\t\t\t\t} else if( mask & DPickerDatetimeMask.MINUTES ) {\r\n\t\t\t\t\t\tdate.setMinutes( upperDate.getMinutes() - 1 );\r\n\t\t\t\t\t} else if( mask & DPickerDatetimeMask.HOURS ) {\r\n\t\t\t\t\t\tdate.setHours( upperDate.getHours() - 1 );\r\n\t\t\t\t\t} else if( mask & DPickerDatetimeMask.DATE ) {\r\n\t\t\t\t\t\tdate.setDate( upperDate.getDate() - 1 );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcompare( a: Date, b: Date ): number {\r\n\t\tconst mask = this.mask;\r\n\t\tif( mask & DPickerDatetimeMask.DATE ) {\r\n\t\t\tconst ay = a.getFullYear();\r\n\t\t\tconst by = b.getFullYear();\r\n\t\t\tif( ay !== by ) {\r\n\t\t\t\treturn ( ay < by ? -1 : +1 );\r\n\t\t\t}\r\n\r\n\t\t\tconst am = a.getMonth();\r\n\t\t\tconst bm = b.getMonth();\r\n\t\t\tif( am !== bm ) {\r\n\t\t\t\treturn ( am < bm ? -1 : +1 );\r\n\t\t\t}\r\n\r\n\t\t\tconst ad = a.getDate();\r\n\t\t\tconst bd = b.getDate();\r\n\t\t\tif( ad !== bd ) {\r\n\t\t\t\treturn ( ad < bd ? -1 : +1 );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( mask & DPickerDatetimeMask.HOURS ) {\r\n\t\t\tconst ah = a.getHours();\r\n\t\t\tconst bh = b.getHours();\r\n\t\t\tif( ah !== bh ) {\r\n\t\t\t\treturn ( ah < bh ? -1 : +1 );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( mask & DPickerDatetimeMask.MINUTES ) {\r\n\t\t\tconst am = a.getMinutes();\r\n\t\t\tconst bm = b.getMinutes();\r\n\t\t\tif( am !== bm ) {\r\n\t\t\t\treturn ( am < bm ? -1 : +1 );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( mask & DPickerDatetimeMask.SECONDS ) {\r\n\t\t\tconst ad = a.getSeconds();\r\n\t\t\tconst bd = b.getSeconds();\r\n\t\t\tif( ad !== bd ) {\r\n\t\t\t\treturn ( ad < bd ? -1 : +1 );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\ttest( date: Date ): number {\r\n\t\t// Lower bound\r\n\t\tconst lower = this.lower;\r\n\t\tconst lowerDate = lower.date;\r\n\t\tif( lowerDate != null ) {\r\n\t\t\tconst result = this.compare( lowerDate, date );\r\n\t\t\tif( lower.inclusive ) {\r\n\t\t\t\treturn ( result <= 0 ? 0 : -1 );\r\n\t\t\t} else {\r\n\t\t\t\treturn ( result < 0 ? 0 : -1 );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Upper bound\r\n\t\tconst upper = this.upper;\r\n\t\tconst upperDate = upper.date;\r\n\t\tif( upperDate != null ) {\r\n\t\t\tconst result = this.compare( date, upperDate );\r\n\t\t\tif( upper.inclusive ) {\r\n\t\t\t\treturn ( result <= 0 ? 0 : +1 );\r\n\t\t\t} else {\r\n\t\t\t\treturn ( result < 0 ? 0 : +1 );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tcontains( date: Date ): boolean {\r\n\t\treturn this.test( date ) === 0;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DCoordinateSize } from \"./d-coordinate\";\r\nimport { DInputInteger, DInputIntegerOptions } from \"./d-input-integer\";\r\nimport { DLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerTimeBoundDate, DPickerTimeBoundOptions } from \"./d-picker-time-bound\";\r\nimport { DPickerTimeBounds, DPickerTimeBoundsOptions } from \"./d-picker-time-bounds\";\r\nimport { DText } from \"./d-text\";\r\n\r\nexport interface DPickerTimeOptions<THEME extends DThemePickerTime = DThemePickerTime> extends DBaseOptions<THEME> {\r\n\tmargin?: number;\r\n\thours?: DInputIntegerOptions;\r\n\tminutes?: DInputIntegerOptions;\r\n\tseconds?: DInputIntegerOptions;\r\n\tmask?: DPickerDatetimeMask;\r\n\tbounds?: DPickerTimeBoundsOptions;\r\n}\r\n\r\nexport interface DThemePickerTime extends DThemeBase {\r\n\tgetMargin(): number;\r\n\tgetHoursOptions(): DInputIntegerOptions;\r\n\tgetMinutesOptions(): DInputIntegerOptions;\r\n\tgetSecondsOptions(): DInputIntegerOptions;\r\n\tgetMask(): DPickerDatetimeMask;\r\n\tgetLowerBound(): DPickerTimeBoundDate;\r\n\tisLowerBoundInclusive(): boolean;\r\n\tgetUpperBound(): DPickerTimeBoundDate;\r\n\tisUpperBoundInclusive(): boolean;\r\n}\r\n\r\nconst toBoundOptions = (\r\n\toptions: DPickerTimeBoundOptions | undefined,\r\n\tdate: DPickerTimeBoundDate,\r\n\tinclusive: boolean\r\n): DPickerTimeBoundOptions => {\r\n\tif( options ) {\r\n\t\treturn {\r\n\t\t\tdate: ( options.date !== undefined ? options.date : date ),\r\n\t\t\tinclusive: ( options.inclusive !== undefined ? options.inclusive : inclusive )\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tdate,\r\n\t\tinclusive\r\n\t};\r\n};\r\n\r\nconst toBoundsOptions = (\r\n\ttheme: DThemePickerTime,\r\n\toptions: DPickerTimeBoundsOptions | undefined\r\n): DPickerTimeBoundsOptions => {\r\n\tif( options ) {\r\n\t\treturn {\r\n\t\t\tlower: toBoundOptions(\r\n\t\t\t\toptions.lower,\r\n\t\t\t\ttheme.getLowerBound(),\r\n\t\t\t\ttheme.isLowerBoundInclusive()\r\n\t\t\t),\r\n\t\t\tupper: toBoundOptions(\r\n\t\t\t\toptions.upper,\r\n\t\t\t\ttheme.getUpperBound(),\r\n\t\t\t\ttheme.isUpperBoundInclusive()\r\n\t\t\t)\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tlower: {\r\n\t\t\tdate: theme.getLowerBound(),\r\n\t\t\tinclusive: theme.isLowerBoundInclusive()\r\n\t\t},\r\n\t\tupper: {\r\n\t\t\tdate: theme.getUpperBound(),\r\n\t\t\tinclusive: theme.isUpperBoundInclusive()\r\n\t\t}\r\n\t};\r\n};\r\n\r\nexport class DPickerTime<\r\n\tTHEME extends DThemePickerTime = DThemePickerTime,\r\n\tOPTIONS extends DPickerTimeOptions<THEME> = DPickerTimeOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected _dateBounds!: DPickerTimeBounds;\r\n\tprotected _dateCurrent!: Date;\r\n\tprotected _dateNew!: Date;\r\n\tprotected _inputHours!: DInputInteger | null;\r\n\tprotected _inputMinutes!: DInputInteger | null;\r\n\tprotected _inputSeconds!: DInputInteger | null;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis.onNewChanged();\r\n\t}\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\r\n\t\tconst theme = this.theme;\r\n\t\tthis._dateCurrent = new Date();\r\n\t\tconst dateCurrentTime = this._dateCurrent.getTime();\r\n\t\tthis._dateNew = new Date( dateCurrentTime );\r\n\t\tthis._dateBounds = new DPickerTimeBounds(\r\n\t\t\ttoBoundsOptions( theme, options && options.bounds ),\r\n\t\t\t(): void => { this.onNewChanged(); }\r\n\t\t);\r\n\t\tconst margin = ( options && options.margin != null ?\r\n\t\t\toptions.margin : theme.getMargin() );\r\n\t\tnew DLayoutVertical({\r\n\t\t\tparent: this,\r\n\t\t\tx: \"padding\", y: \"padding\",\r\n\t\t\twidth: \"auto\", height: \"auto\",\r\n\t\t\tmargin,\r\n\t\t\tchildren: this.newChildren( theme, options, margin )\r\n\t\t});\r\n\t}\r\n\r\n\tget current(): Date {\r\n\t\treturn this._dateCurrent;\r\n\t}\r\n\r\n\tset current( dateCurrent: Date ) {\r\n\t\tif( this._dateCurrent.getTime() !== dateCurrent.getTime() ) {\r\n\t\t\tthis._dateCurrent = dateCurrent;\r\n\t\t}\r\n\t}\r\n\r\n\tget new(): Date {\r\n\t\treturn this._dateNew;\r\n\t}\r\n\r\n\tset new( dateNew: Date ) {\r\n\t\tif( this._dateNew.getTime() !== dateNew.getTime() ) {\r\n\t\t\tthis._dateNew = dateNew;\r\n\t\t\tthis.onNewChanged();\r\n\t\t}\r\n\t}\r\n\r\n\tget bounds(): DPickerTimeBounds {\r\n\t\treturn this._dateBounds;\r\n\t}\r\n\r\n\thasHours(): boolean {\r\n\t\treturn this._inputHours != null;\r\n\t}\r\n\r\n\thasMinutes(): boolean {\r\n\t\treturn this._inputMinutes != null;\r\n\t}\r\n\r\n\thasSeconds(): boolean {\r\n\t\treturn this._inputSeconds != null;\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tconst currentTime = this._dateCurrent.getTime();\r\n\t\tthis._dateNew.setTime( currentTime );\r\n\t\tthis.onReset();\r\n\t}\r\n\r\n\tprotected onReset(): void {\r\n\t\tthis.onNewChanged();\r\n\t}\r\n\r\n\tprotected onNewChanged(): void {\r\n\t\tconst dateNew = this._dateNew;\r\n\t\tconst dateBounds = this._dateBounds;\r\n\t\tdateBounds.adjust( this._dateNew );\r\n\r\n\t\tconst inputHours = this._inputHours;\r\n\t\tif( inputHours ) {\r\n\t\t\tconst hours = dateBounds.hours;\r\n\t\t\tinputHours.value = dateNew.getHours();\r\n\t\t\tinputHours.min = hours.min( dateNew );\r\n\t\t\tinputHours.max = hours.max( dateNew );\r\n\t\t}\r\n\r\n\t\tconst inputMinutes = this._inputMinutes;\r\n\t\tif( inputMinutes ) {\r\n\t\t\tconst minutes = dateBounds.minutes;\r\n\t\t\tinputMinutes.value = dateNew.getMinutes();\r\n\t\t\tinputMinutes.min = minutes.min( dateNew );\r\n\t\t\tinputMinutes.max = minutes.max( dateNew );\r\n\t\t}\r\n\r\n\t\tconst inputSeconds = this._inputSeconds;\r\n\t\tif( inputSeconds ) {\r\n\t\t\tconst seconds = dateBounds.seconds;\r\n\t\t\tinputSeconds.value = dateNew.getSeconds();\r\n\t\t\tinputSeconds.min = seconds.min( dateNew );\r\n\t\t\tinputSeconds.max = seconds.max( dateNew );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newChildren( theme: THEME, options: OPTIONS | undefined, margin: number ): Array<DisplayObject | null> {\r\n\t\tconst mask = ( (options && options.mask != null) ? options.mask : theme.getMask() );\r\n\t\tthis._dateBounds.mask = mask;\r\n\t\tthis._inputHours = ( (mask & DPickerDatetimeMask.HOURS) ? this.newInputHours( theme, options ) : null );\r\n\t\tthis._inputMinutes = ( (mask & DPickerDatetimeMask.MINUTES) ? this.newInputMinutes( theme, options ) : null );\r\n\t\tthis._inputSeconds = ( (mask & DPickerDatetimeMask.SECONDS) ? this.newInputSeconds( theme, options ) : null );\r\n\t\treturn [\r\n\t\t\tthis.newTimeLayout(\r\n\t\t\t\tthis._inputHours,\r\n\t\t\t\tthis._inputMinutes,\r\n\t\t\t\tthis._inputSeconds,\r\n\t\t\t\tmargin\r\n\t\t\t)\r\n\t\t];\r\n\t}\r\n\r\n\tprotected newTimeLayout(\r\n\t\thours: DInputInteger | null,\r\n\t\tminutes: DInputInteger | null,\r\n\t\tseconds: DInputInteger | null,\r\n\t\tmargin: number\r\n\t): DLayoutHorizontal | null {\r\n\t\tconst children = this.newTimeLayoutChildren( hours, minutes, seconds );\r\n\t\tif( 0 < children.length ) {\r\n\t\t\treturn new DLayoutHorizontal({\r\n\t\t\t\twidth: this.getTimeLayoutWidth(),\r\n\t\t\t\theight: this.getTimeLayoutHeight(),\r\n\t\t\t\tmargin,\r\n\t\t\t\tchildren\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected getTimeLayoutWidth(): DCoordinateSize {\r\n\t\treturn \"auto\";\r\n\t}\r\n\r\n\tprotected getTimeLayoutHeight(): DCoordinateSize {\r\n\t\treturn \"auto\";\r\n\t}\r\n\r\n\tprotected newTimeLayoutChildren(\r\n\t\thours: DInputInteger | null,\r\n\t\tminutes: DInputInteger | null,\r\n\t\tseconds: DInputInteger | null\r\n\t): Array<DisplayObject | null> {\r\n\t\tconst result = [];\r\n\t\tif( hours != null ) {\r\n\t\t\tresult.push( hours );\r\n\t\t}\r\n\t\tif( minutes != null ) {\r\n\t\t\tif( 0 < result.length ) {\r\n\t\t\t\tresult.push( this.newMinuteSeparator() );\r\n\t\t\t}\r\n\t\t\tresult.push( minutes );\r\n\t\t}\r\n\t\tif( seconds != null ) {\r\n\t\t\tif( 0 < result.length ) {\r\n\t\t\t\tresult.push( this.newSecondSeparator() );\r\n\t\t\t}\r\n\t\t\tresult.push( seconds );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected newMinuteSeparator(): DText | null {\r\n\t\treturn new DText({\r\n\t\t\twidth: \"auto\",\r\n\t\t\ttext: {\r\n\t\t\t\tvalue: this.getMinuteSeparator()\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetMinuteSeparator(): string {\r\n\t\treturn \":\";\r\n\t}\r\n\r\n\tprotected newSecondSeparator(): DText | null {\r\n\t\treturn new DText({\r\n\t\t\twidth: \"auto\",\r\n\t\t\ttext: {\r\n\t\t\t\tvalue: this.getSecondSeparator()\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetSecondSeparator(): string {\r\n\t\treturn \":\";\r\n\t}\r\n\r\n\tprotected adjustInputOptions( theme: THEME, options: DInputIntegerOptions, max: number ): DInputIntegerOptions {\r\n\t\tif( options.step == null ) {\r\n\t\t\toptions.step = 1;\r\n\t\t}\r\n\t\tif( options.min == null ) {\r\n\t\t\toptions.min = 0;\r\n\t\t}\r\n\t\tif( options.max == null ) {\r\n\t\t\toptions.max = max;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected newInputHours( theme: THEME, options?: OPTIONS ): DInputInteger | null {\r\n\t\tconst inputOptions = ( options && options.hours ) || theme.getHoursOptions();\r\n\t\tconst max = this._dateBounds.constant.hour.max;\r\n\t\tconst input = new DInputInteger( this.adjustInputOptions( theme, inputOptions, max ) );\r\n\t\tinput.on( \"change\", ( value: number ): void => {\r\n\t\t\tthis.onHoursChanged( value );\r\n\t\t});\r\n\t\treturn input;\r\n\t}\r\n\r\n\tprotected onHoursChanged( value: number ): void {\r\n\t\tconst dateNew = this._dateNew;\r\n\t\tdateNew.setHours( value );\r\n\t\tthis.onNewChanged();\r\n\t}\r\n\r\n\tprotected newInputMinutes( theme: THEME, options?: OPTIONS ): DInputInteger | null {\r\n\t\tconst inputOptions = ( options && options.minutes ) || theme.getMinutesOptions();\r\n\t\tconst max = this._dateBounds.constant.minute.max;\r\n\t\tconst input = new DInputInteger( this.adjustInputOptions( theme, inputOptions, max ) );\r\n\t\tinput.on( \"change\", ( value: number ): void => {\r\n\t\t\tthis.onMinutesChanged( value );\r\n\t\t});\r\n\t\treturn input;\r\n\t}\r\n\r\n\tprotected onMinutesChanged( value: number ): void {\r\n\t\tconst dateNew = this._dateNew;\r\n\t\tdateNew.setMinutes( value );\r\n\t\tthis.onNewChanged();\r\n\t}\r\n\r\n\tprotected newInputSeconds( theme: THEME, options?: OPTIONS ): DInputInteger | null {\r\n\t\tconst inputOptions = ( options && options.seconds ) || theme.getSecondsOptions();\r\n\t\tconst max = this._dateBounds.constant.second.max;\r\n\t\tconst input = new DInputInteger( this.adjustInputOptions( theme, inputOptions, max ) );\r\n\t\tinput.on( \"change\", ( value: number ): void => {\r\n\t\t\tthis.onSecondsChanged( value );\r\n\t\t});\r\n\t\treturn input;\r\n\t}\r\n\r\n\tprotected onSecondsChanged( value: number ): void {\r\n\t\tthis._dateNew.setSeconds( value );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerTime\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DCoordinateSize } from \"./d-coordinate\";\r\nimport { DInputIntegerOptions } from \"./d-input-integer\";\r\nimport { DLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DPickerDatetimeButtonBack, DPickerDatetimeButtonBackOptions } from \"./d-picker-datetime-button-back\";\r\nimport { DPickerDatetimeButtonDate } from \"./d-picker-datetime-button-date\";\r\nimport { DPickerDatetimeButtonNext, DPickerDatetimeButtonNextOptions } from \"./d-picker-datetime-button-next\";\r\nimport { DPickerDatetimeLabel, DPickerDatetimeLabelOptions } from \"./d-picker-datetime-label\";\r\nimport { DPickerDatetimeLabelDate } from \"./d-picker-datetime-label-date\";\r\nimport { DPickerDatetimeSpace } from \"./d-picker-datetime-space\";\r\nimport { DPickerTime, DPickerTimeOptions, DThemePickerTime } from \"./d-picker-time\";\r\n\r\nexport type DPickerDatetimeLabelFormatter = ( date: Date ) => string;\r\nexport type DPickerDatetimeDateDecorator = ( date: Date, button: DPickerDatetimeButtonDate ) => void;\r\nexport type DPickerDatetimeDayLabels = [ string, string, string, string, string, string, string ];\r\n\r\nexport interface DPickerDatetimeDayOptions {\r\n\tstart?: number;\r\n\tlabels?: DPickerDatetimeDayLabels;\r\n}\r\n\r\nexport interface DPickerDatetimeDateOptions {\r\n\tdecorator?: DPickerDatetimeDateDecorator;\r\n}\r\n\r\nexport interface DPickerDatetimeOptions<\r\n\tTHEME extends DThemePickerDatetime = DThemePickerDatetime\r\n> extends DPickerTimeOptions<THEME> {\r\n\tback?: DPickerDatetimeButtonBackOptions | null;\r\n\tnext?: DPickerDatetimeButtonNextOptions | null;\r\n\tday?: DPickerDatetimeDayOptions;\r\n\tlabel?: DPickerDatetimeLabelOptions;\r\n\tdate?: DPickerDatetimeDateOptions;\r\n}\r\n\r\nexport interface DThemePickerDatetime extends DThemePickerTime {\r\n\tgetDayLabels(): DPickerDatetimeDayLabels;\r\n\tgetDayStart(): number;\r\n\tgetLabelFormatter(): DPickerDatetimeLabelFormatter;\r\n\tgetDateDecorator(): DPickerDatetimeDateDecorator;\r\n\tgetBackButtonOptions(): DPickerDatetimeButtonBackOptions | null;\r\n\tgetNextButtonOptions(): DPickerDatetimeButtonNextOptions | null;\r\n}\r\n\r\nexport class DPickerDatetime<\r\n\tTHEME extends DThemePickerDatetime = DThemePickerDatetime,\r\n\tOPTIONS extends DPickerDatetimeOptions<THEME> = DPickerDatetimeOptions<THEME>\r\n> extends DPickerTime<THEME, OPTIONS> {\r\n\tprotected _datePage!: Date;\r\n\tprotected _dateButtons!: Array<DPickerDatetimeSpace | DPickerDatetimeButtonDate>;\r\n\tprotected _dateDecorator!: DPickerDatetimeDateDecorator;\r\n\tprotected _label!: DPickerDatetimeLabel;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis._datePage = new Date( this._dateCurrent.getTime() );\r\n\t}\r\n\r\n\tprotected newChildren( theme: THEME, options: OPTIONS | undefined, margin: number ): Array<DisplayObject | null> {\r\n\t\tthis._dateButtons = this.newDateButtons( theme, options );\r\n\t\tthis._dateDecorator = ( options && options.date && options.date.decorator ) ||\r\n\t\t\ttheme.getDateDecorator();\r\n\t\tthis._label = this.newLabel( theme, options );\r\n\t\tconst result = super.newChildren( theme, options, margin );\r\n\t\tresult.unshift(\r\n\t\t\tnew DLayoutHorizontal({\r\n\t\t\t\twidth: \"100%\", height: \"auto\",\r\n\t\t\t\tchildren: [\r\n\t\t\t\t\tthis.newBackButton( theme, options ),\r\n\t\t\t\t\tthis._label,\r\n\t\t\t\t\tthis.newNextButton( theme, options )\r\n\t\t\t\t]\r\n\t\t\t}),\r\n\t\t\tnew DLayoutHorizontal({\r\n\t\t\t\twidth: \"auto\", height: \"auto\",\r\n\t\t\t\tmargin,\r\n\t\t\t\tchildren: this.newDateLabels( theme, options )\r\n\t\t\t}),\r\n\t\t\tnew DLayoutVertical({\r\n\t\t\t\twidth: \"auto\", height: \"auto\",\r\n\t\t\t\tmargin,\r\n\t\t\t\tcolumn: 7,\r\n\t\t\t\tchildren: this._dateButtons\r\n\t\t\t})\r\n\t\t);\r\n\t\treturn result;\r\n\t}\r\n\r\n\tget page(): Date {\r\n\t\treturn this._datePage;\r\n\t}\r\n\r\n\tset page( datePage: Date ) {\r\n\t\tif( this._datePage.getTime() !== datePage.getTime() ) {\r\n\t\t\tthis._datePage = datePage;\r\n\t\t\tthis.onPageChanged();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onReset(): void {\r\n\t\tthis._datePage.setTime( this._dateCurrent.getTime() );\r\n\t\tsuper.onReset();\r\n\t}\r\n\r\n\tnext(): void {\r\n\t\tconst work = this._datePage;\r\n\t\twork.setFullYear( work.getFullYear(), work.getMonth() + 1, 1 );\r\n\t\twork.setHours( 0, 0, 0, 0 );\r\n\t\tthis.onPageChanged();\r\n\t}\r\n\r\n\tback(): void {\r\n\t\tconst work = this._datePage;\r\n\t\twork.setFullYear( work.getFullYear(), work.getMonth() - 1, 1 );\r\n\t\twork.setHours( 0, 0, 0, 0 );\r\n\t\tthis.onPageChanged();\r\n\t}\r\n\r\n\tonNewChanged(): void {\r\n\t\tthis._dateBounds.adjust( this._datePage );\r\n\t\tsuper.onNewChanged();\r\n\t\tthis.onPageChanged();\r\n\t}\r\n\r\n\tprotected onPageChanged(): void {\r\n\t\tconst buttons = this._dateButtons;\r\n\t\tconst bounds = this._dateBounds;\r\n\t\tconst datePage = this._datePage;\r\n\t\tconst dateNew = this._dateNew;\r\n\r\n\t\tconst tmp = new Date( datePage.getTime() );\r\n\t\ttmp.setDate( 1 );\r\n\t\ttmp.setHours( 0, 0, 0, 0 );\r\n\r\n\t\t// Spaces\r\n\t\tconst theme = this.theme;\r\n\t\tconst spaceCount = ( tmp.getDay() - theme.getDayStart() + 7 ) % 7;\r\n\t\tfor( let i = 0; i < spaceCount; ++i ) {\r\n\t\t\tbuttons[ i ].show();\r\n\t\t}\r\n\t\tfor( let i = spaceCount; i < 7; ++i ) {\r\n\t\t\tbuttons[ i ].hide();\r\n\t\t}\r\n\r\n\t\t// Date buttons\r\n\t\tconst dateDecorator = this._dateDecorator;\r\n\t\ttmp.setFullYear( tmp.getFullYear(), tmp.getMonth() + 1, 0 );\r\n\t\tconst dateCount = tmp.getDate();\r\n\t\tconst dateNewDate = ( dateNew.getFullYear() === tmp.getFullYear() &&\r\n\t\t\tdateNew.getMonth() === tmp.getMonth() ? dateNew.getDate() : 0 );\r\n\t\tfor( let i = 0; i < dateCount; ++i ) {\r\n\t\t\ttmp.setDate( i + 1 );\r\n\r\n\t\t\tconst button = buttons[ i + 7 ];\r\n\t\t\tbutton.setActive( dateNewDate === i + 1 );\r\n\t\t\tbutton.setDisabled( ! bounds.contains( tmp ) );\r\n\t\t\tbutton.show();\r\n\r\n\t\t\tdateDecorator( tmp, button as DPickerDatetimeButtonDate );\r\n\t\t}\r\n\t\tfor( let i = dateCount; i < 31; ++i ) {\r\n\t\t\tconst button = buttons[ i + 7 ];\r\n\t\t\tbutton.setActive( false );\r\n\t\t\tbutton.hide();\r\n\t\t}\r\n\r\n\t\t// Label\r\n\t\ttmp.setTime( datePage.getTime() );\r\n\t\tthis._label.text = tmp;\r\n\t}\r\n\r\n\tprotected adjustInputOptions( theme: THEME, options: DInputIntegerOptions, max: number ): DInputIntegerOptions {\r\n\t\tif( options.weight == null ) {\r\n\t\t\toptions.weight = 1;\r\n\t\t}\r\n\t\treturn super.adjustInputOptions( theme, options, max );\r\n\t}\r\n\r\n\tprotected getTimeLayoutWidth(): DCoordinateSize {\r\n\t\treturn \"100%\";\r\n\t}\r\n\r\n\tprotected toLabelOptions( theme: THEME, options?: DPickerDatetimeOptions ): DPickerDatetimeLabelOptions {\r\n\t\tconst result = (options && options.label) || {};\r\n\t\tif( result.weight === undefined ) {\r\n\t\t\tresult.weight = 1;\r\n\t\t}\r\n\r\n\t\tif( result.padding === undefined ) {\r\n\t\t\tresult.padding = 0;\r\n\t\t}\r\n\r\n\t\tconst labelText = result.text = result.text || {};\r\n\t\tconst labelTextAlign = labelText.align = labelText.align || {};\r\n\t\tif( labelTextAlign.horizontal === undefined ) {\r\n\t\t\tlabelTextAlign.horizontal = \"CENTER\";\r\n\t\t}\r\n\r\n\t\tif( labelText.formatter === undefined ) {\r\n\t\t\tlabelText.formatter = theme.getLabelFormatter();\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected newLabel( theme: THEME, options?: DPickerDatetimeOptions ): DPickerDatetimeLabel {\r\n\t\treturn new DPickerDatetimeLabel( this.toLabelOptions( theme, options ) );\r\n\t}\r\n\r\n\tprotected newBackButton( theme: THEME, options?: OPTIONS ): DPickerDatetimeButtonBack | null {\r\n\t\tconst buttonOptions = ( options && options.back !== undefined ?\r\n\t\t\toptions.back : theme.getBackButtonOptions() );\r\n\t\tif( buttonOptions != null ) {\r\n\t\t\tconst button = new DPickerDatetimeButtonBack( buttonOptions );\r\n\t\t\tbutton.on( \"active\", (): void => {\r\n\t\t\t\tthis.back();\r\n\t\t\t});\r\n\t\t\treturn button;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected newNextButton( theme: THEME, options?: OPTIONS ): DPickerDatetimeButtonNext | null {\r\n\t\tconst buttonOptions = ( options && options.next !== undefined ?\r\n\t\t\toptions.next : theme.getNextButtonOptions() );\r\n\t\tif( buttonOptions != null ) {\r\n\t\t\tconst button = new DPickerDatetimeButtonNext( buttonOptions );\r\n\t\t\tbutton.on( \"active\", (): void => {\r\n\t\t\t\tthis.next();\r\n\t\t\t});\r\n\t\t\treturn button;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected newDateLabels( theme: THEME, options: OPTIONS | undefined ): DPickerDatetimeLabelDate[] {\r\n\t\tconst dateLabels = theme.getDayLabels();\r\n\t\tconst dayStart = theme.getDayStart();\r\n\t\tconst result: DPickerDatetimeLabelDate[] = [];\r\n\t\tfor( let i = 0; i < 7; ++i ) {\r\n\t\t\tconst label = dateLabels[ (dayStart + i) % 7 ];\r\n\t\t\tresult.push(\r\n\t\t\t\tthis.newDateLabel( theme, options, label )\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected newDateLabel( theme: THEME, options: OPTIONS | undefined, label: string ): DPickerDatetimeLabelDate {\r\n\t\treturn new DPickerDatetimeLabelDate({\r\n\t\t\ttext: {\r\n\t\t\t\tvalue: label\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected newDateButtons(\r\n\t\ttheme: THEME, options: OPTIONS | undefined\r\n\t): Array<DPickerDatetimeSpace | DPickerDatetimeButtonDate> {\r\n\t\tconst result: Array<DPickerDatetimeSpace | DPickerDatetimeButtonDate> = [];\r\n\t\tfor( let i = 0; i < 7; ++i ) {\r\n\t\t\tresult.push(\r\n\t\t\t\tthis.newSpace( theme, options )\r\n\t\t\t);\r\n\t\t}\r\n\t\tfor( let i = 1; i <= 31; ++i ) {\r\n\t\t\tresult.push(\r\n\t\t\t\tthis.newDateButton( theme, options, i )\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected newSpace( theme: THEME, options: OPTIONS | undefined ): DPickerDatetimeSpace {\r\n\t\treturn new DPickerDatetimeSpace();\r\n\t}\r\n\r\n\tprotected newDateButton( theme: THEME, options: OPTIONS | undefined, date: number ): DPickerDatetimeButtonDate {\r\n\t\treturn new DPickerDatetimeButtonDate({\r\n\t\t\ttext: {\r\n\t\t\t\tvalue: String( date )\r\n\t\t\t},\r\n\t\t\ton: {\r\n\t\t\t\tactive: (): void => {\r\n\t\t\t\t\tthis.onDateButtonClicked( date );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected onDateButtonClicked( date: number ): void {\r\n\t\tconst dateNew = this._dateNew;\r\n\t\tif( dateNew.getDate() !== date ) {\r\n\t\t\tconst datePage = this._datePage;\r\n\t\t\tdateNew.setFullYear( datePage.getFullYear() );\r\n\t\t\tdateNew.setMonth( datePage.getMonth() );\r\n\t\t\tdateNew.setDate( date );\r\n\t\t\tthis.onNewChanged();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerDatetime\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DPickerDatetime, DPickerDatetimeOptions, DThemePickerDatetime } from \"./d-picker-datetime\";\r\n\r\nexport interface DPickerDateOptions<\r\n\tTHEME extends DThemePickerDate = DThemePickerDate\r\n> extends DPickerDatetimeOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerDate extends DThemePickerDatetime {\r\n\r\n}\r\n\r\nexport class DPickerDate<\r\n\tTHEME extends DThemePickerDate = DThemePickerDate,\r\n\tOPTIONS extends DPickerDateOptions<THEME> = DPickerDateOptions<THEME>\r\n> extends DPickerDatetime<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DPickerDate\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DPickerDate, DPickerDateOptions } from \"./d-picker-date\";\r\n\r\nexport interface DDialogDateOptions<\r\n\tTHEME extends DThemeDialogDate = DThemeDialogDate\r\n> extends DDialogCommandOptions<THEME> {\r\n\tpicker?: DPickerDateOptions;\r\n}\r\n\r\nexport interface DThemeDialogDate extends DThemeDialogCommand {\r\n\r\n}\r\n\r\nexport class DDialogDate<\r\n\tTHEME extends DThemeDialogDate = DThemeDialogDate,\r\n\tOPTIONS extends DDialogDateOptions<THEME> = DDialogDateOptions<THEME>\r\n> extends DDialogCommand<THEME, OPTIONS> {\r\n\tprotected _picker!: DPickerDate;\r\n\r\n\tprotected onInit( layout: DLayoutVertical, options?: OPTIONS ) {\r\n\t\tsuper.onInit( layout, options );\r\n\r\n\t\tconst picker = new DPickerDate( options && options.picker );\r\n\t\tthis._picker = picker;\r\n\t\tlayout.addChild( picker );\r\n\t}\r\n\r\n\tget current(): Date {\r\n\t\treturn this._picker.current;\r\n\t}\r\n\r\n\tset current( dateCurrent: Date ) {\r\n\t\tthis._picker.current = dateCurrent;\r\n\t}\r\n\r\n\tget new(): Date {\r\n\t\treturn this._picker.new;\r\n\t}\r\n\r\n\tset new( dateNew: Date ) {\r\n\t\tthis._picker.new = dateNew;\r\n\t}\r\n\r\n\tget page(): Date {\r\n\t\treturn this._picker.new;\r\n\t}\r\n\r\n\tset page( datePage: Date ) {\r\n\t\tthis._picker.page = datePage;\r\n\t}\r\n\r\n\tget picker(): DPickerDate {\r\n\t\treturn this._picker;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogDate\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogDate } from \"./d-dialog-date\";\r\n\r\nexport class DDialogDates {\r\n\tprotected static INSTANCE?: DDialogDate;\r\n\tstatic getInstance(): DDialogDate {\r\n\t\tif( DDialogDates.INSTANCE == null ) {\r\n\t\t\tDDialogDates.INSTANCE = new DDialogDate();\r\n\t\t}\r\n\t\treturn DDialogDates.INSTANCE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOnOptions, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DDialogDate, DDialogDateOptions } from \"./d-dialog-date\";\r\nimport { DDialogDates } from \"./d-dialog-dates\";\r\n\r\nexport interface DButtonDateOnOptions extends DButtonOnOptions<Date> {\r\n\t/**\r\n\t * Triggered when a selection is changed.\r\n\t *\r\n\t * @param newValue a newly selected value\r\n\t * @param oldValue a previously selected value\r\n\t * @param self a button\r\n\t */\r\n\tchange?: ( newValue: Date, oldValue: Date, self: any ) => void;\r\n}\r\n\r\nexport interface DButtonDateOptions<\r\n\tTHEME extends DThemeButtonDate = DThemeButtonDate\r\n> extends DButtonOptions<Date, THEME> {\r\n\tdialog?: DDialogDateOptions;\r\n\ton?: DButtonDateOnOptions;\r\n}\r\n\r\nexport interface DThemeButtonDate extends DThemeButton {\r\n\tgetTextFormatter(): ( value: Date, caller: DButtonDate ) => string;\r\n\tgetTextValue( state: DBaseState ): Date;\r\n\tnewTextValue(): Date;\r\n}\r\n\r\nexport class DButtonDate<\r\n\tTHEME extends DThemeButtonDate = DThemeButtonDate,\r\n\tOPTIONS extends DButtonDateOptions<THEME> = DButtonDateOptions<THEME>\r\n> extends DButton<Date, THEME, OPTIONS> {\r\n\tprotected _dialog?: DDialogDate;\r\n\tprotected _dialogOptions?: DDialogDateOptions;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._dialogOptions = options && options.dialog;\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst currentTime = this._textValueComputed.getTime();\r\n\t\t\tconst dialog = this.dialog;\r\n\t\t\tdialog.current = new Date( currentTime );\r\n\t\t\tdialog.new = new Date( currentTime );\r\n\t\t\tdialog.page = new Date( currentTime );\r\n\t\t\tdialog.open().then((): void => {\r\n\t\t\t\tconst dateNew = dialog.new;\r\n\t\t\t\tconst dateCurrent = dialog.current;\r\n\t\t\t\tthis.text = new Date( dateNew.getTime() );\r\n\t\t\t\tthis.emit( \"change\", dateNew, dateCurrent, this );\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tget dialog(): DDialogDate {\r\n\t\tlet dialog = this._dialog;\r\n\t\tif( dialog == null ) {\r\n\t\t\tconst dialogOptions = this._dialogOptions;\r\n\t\t\tif( dialogOptions != null ) {\r\n\t\t\t\tdialog = new DDialogDate( this._dialogOptions );\r\n\t\t\t} else {\r\n\t\t\t\tdialog = DDialogDates.getInstance();\r\n\t\t\t}\r\n\t\t\tthis._dialog = dialog;\r\n\t\t}\r\n\t\treturn dialog;\r\n\t}\r\n\r\n\tget value(): Date {\r\n\t\treturn this._textValueComputed;\r\n\t}\r\n\r\n\tset value( value: Date ) {\r\n\t\tif( this._textValueComputed.getTime() !== value.getTime() ) {\r\n\t\t\tthis.text = value;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonDate\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DPickerDatetime, DPickerDatetimeOptions } from \"./d-picker-datetime\";\r\n\r\nexport interface DDialogDatetimeOptions<\r\n\tTHEME extends DThemeDialogDatetime = DThemeDialogDatetime\r\n> extends DDialogCommandOptions<THEME> {\r\n\tpicker?: DPickerDatetimeOptions;\r\n}\r\n\r\nexport interface DThemeDialogDatetime extends DThemeDialogCommand {\r\n\r\n}\r\n\r\nexport class DDialogDatetime<\r\n\tTHEME extends DThemeDialogDatetime = DThemeDialogDatetime,\r\n\tOPTIONS extends DDialogDatetimeOptions<THEME> = DDialogDatetimeOptions<THEME>\r\n> extends DDialogCommand<THEME, OPTIONS> {\r\n\tprotected _picker!: DPickerDatetime;\r\n\r\n\tprotected onInit( layout: DLayoutVertical, options?: OPTIONS ) {\r\n\t\tsuper.onInit( layout, options );\r\n\r\n\t\tconst picker = new DPickerDatetime( options && options.picker );\r\n\t\tthis._picker = picker;\r\n\t\tlayout.addChild( picker );\r\n\t}\r\n\r\n\tget current(): Date {\r\n\t\treturn this._picker.current;\r\n\t}\r\n\r\n\tset current( dateCurrent: Date ) {\r\n\t\tthis._picker.current = dateCurrent;\r\n\t}\r\n\r\n\tget new(): Date {\r\n\t\treturn this._picker.new;\r\n\t}\r\n\r\n\tset new( dateNew: Date ) {\r\n\t\tthis._picker.new = dateNew;\r\n\t}\r\n\r\n\tget page(): Date {\r\n\t\treturn this._picker.new;\r\n\t}\r\n\r\n\tset page( datePage: Date ) {\r\n\t\tthis._picker.page = datePage;\r\n\t}\r\n\r\n\tget picker(): DPickerDatetime {\r\n\t\treturn this._picker;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogDatetime\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogDatetime } from \"./d-dialog-datetime\";\r\n\r\nexport class DDialogDatetimes {\r\n\tprotected static INSTANCE?: DDialogDatetime;\r\n\tstatic getInstance(): DDialogDatetime {\r\n\t\tif( DDialogDatetimes.INSTANCE == null ) {\r\n\t\t\tDDialogDatetimes.INSTANCE = new DDialogDatetime();\r\n\t\t}\r\n\t\treturn DDialogDatetimes.INSTANCE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { toPadded } from \"./util/to-padded\";\r\n\r\nexport class DPickerDates {\r\n\tstatic format( date: Date ): string {\r\n\t\tconst y = toPadded( String( date.getFullYear() ), 4, \"0\" );\r\n\t\tconst M = toPadded( String( date.getMonth() + 1 ), 2, \"0\");\r\n\t\tconst S = toPadded( String( date.getDate() ), 2, \"0\" );\r\n\t\treturn `${y}/${M}/${S}`;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DThemePickerTime } from \"./d-picker-time\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\nimport { toPadded } from \"./util/to-padded\";\r\n\r\nexport class DPickerTimes {\r\n\tstatic format( date: Date, mask: DPickerDatetimeMask ): string {\r\n\t\tlet result = \"\";\r\n\t\tif( mask & DPickerDatetimeMask.HOURS ) {\r\n\t\t\tresult += toPadded( String( date.getHours() ), 2, \"0\" );\r\n\t\t}\r\n\t\tif( mask & DPickerDatetimeMask.MINUTES ) {\r\n\t\t\tif( 0 < result.length ) {\r\n\t\t\t\tresult += \":\";\r\n\t\t\t}\r\n\t\t\tresult += toPadded( String( date.getMinutes() ), 2, \"0\" );\r\n\t\t}\r\n\t\tif( mask & DPickerDatetimeMask.SECONDS ) {\r\n\t\t\tif( 0 < result.length ) {\r\n\t\t\t\tresult += \":\";\r\n\t\t\t}\r\n\t\t\tresult += toPadded( String( date.getSeconds() ), 2, \"0\" );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toMask( options?: { mask?: DPickerDatetimeMask } ): DPickerDatetimeMask {\r\n\t\treturn ( options && options.mask != null ? options.mask :\r\n\t\t\t(DThemes.getInstance().get( \"DPickerTime\" ) as DThemePickerTime).getMask() );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DPickerDates } from \"./d-picker-dates\";\r\nimport { DThemePickerDatetime } from \"./d-picker-datetime\";\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerTimes } from \"./d-picker-times\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\n\r\nexport class DPickerDatetimes {\r\n\tstatic format( date: Date, mask: DPickerDatetimeMask ): string {\r\n\t\tconst hms = DPickerTimes.format( date, mask );\r\n\t\tif( 0 < hms.length ) {\r\n\t\t\treturn `${DPickerDates.format( date )} ${hms}`;\r\n\t\t} else {\r\n\t\t\treturn `${DPickerDates.format( date )}`;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic toMask( options?: { mask?: DPickerDatetimeMask } ): DPickerDatetimeMask {\r\n\t\treturn ( options && options.mask != null ? options.mask :\r\n\t\t\t(DThemes.getInstance().get( \"DPickerDatetime\" ) as DThemePickerDatetime).getMask() );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOnOptions, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DDialogDatetime, DDialogDatetimeOptions } from \"./d-dialog-datetime\";\r\nimport { DDialogDatetimes } from \"./d-dialog-datetimes\";\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerDatetimes } from \"./d-picker-datetimes\";\r\n\r\n/**\r\n * Mappings of event names and handlers.\r\n */\r\nexport interface DButtonDatetimeOnOptions extends DButtonOnOptions<Date> {\r\n\t/**\r\n\t * Triggered when a selection is changed.\r\n\t *\r\n\t * @param self a button\r\n\t */\r\n\tchange?: ( newValue: Date, oldValue: Date, self: any ) => void;\r\n}\r\n\r\nexport interface DButtonDatetimeOptions<\r\n\tTHEME extends DThemeButtonDatetime = DThemeButtonDatetime\r\n> extends DButtonOptions<Date, THEME> {\r\n\tdialog?: DDialogDatetimeOptions;\r\n\ton?: DButtonDatetimeOnOptions;\r\n}\r\n\r\nexport interface DThemeButtonDatetime extends DThemeButton {\r\n\tgetTextFormatter(): ( value: Date, caller: DButtonDatetime ) => string;\r\n\tgetTextValue( state: DBaseState ): Date;\r\n\tnewTextValue(): Date;\r\n}\r\n\r\nexport class DButtonDatetime<\r\n\tTHEME extends DThemeButtonDatetime = DThemeButtonDatetime,\r\n\tOPTIONS extends DButtonDatetimeOptions<THEME> = DButtonDatetimeOptions<THEME>\r\n> extends DButton<Date, THEME, OPTIONS> {\r\n\tprotected _dialog?: DDialogDatetime;\r\n\tprotected _dialogOptions?: DDialogDatetimeOptions;\r\n\tprotected _datetimeMask!: DPickerDatetimeMask;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tthis._dialogOptions = options && options.dialog;\r\n\t\tthis._datetimeMask = DPickerDatetimes.toMask( options && options.dialog && options.dialog.picker );\r\n\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst currentTime = this._textValueComputed.getTime();\r\n\t\t\tconst dialog = this.dialog;\r\n\t\t\tdialog.current = new Date( currentTime );\r\n\t\t\tdialog.new = new Date( currentTime );\r\n\t\t\tdialog.page = new Date( currentTime );\r\n\t\t\tdialog.open().then((): void => {\r\n\t\t\t\tconst dateNew = dialog.new;\r\n\t\t\t\tconst dateCurrent = dialog.current;\r\n\t\t\t\tthis.text = new Date( dateNew.getTime() );\r\n\t\t\t\tthis.emit( \"change\", dateNew, dateCurrent, this );\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tgetDatetimeMask(): DPickerDatetimeMask {\r\n\t\treturn this._datetimeMask;\r\n\t}\r\n\r\n\tget dialog(): DDialogDatetime {\r\n\t\tlet dialog = this._dialog;\r\n\t\tif( dialog == null ) {\r\n\t\t\tconst dialogOptions = this._dialogOptions;\r\n\t\t\tif( dialogOptions != null ) {\r\n\t\t\t\tdialog = new DDialogDatetime( this._dialogOptions );\r\n\t\t\t} else {\r\n\t\t\t\tdialog = DDialogDatetimes.getInstance();\r\n\t\t\t}\r\n\t\t\tthis._dialog = dialog;\r\n\t\t}\r\n\t\treturn dialog;\r\n\t}\r\n\r\n\tget value(): Date {\r\n\t\treturn this._textValueComputed;\r\n\t}\r\n\r\n\tset value( value: Date ) {\r\n\t\tif( this._textValueComputed.getTime() !== value.getTime() ) {\r\n\t\t\tthis.text = value;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonDatetime\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton, DButtonOnOptions, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilFileAs, UtilFileOnOptions, UtilFileOpener } from \"./util/util-file-opener\";\r\n\r\nexport import DButtonFileAs = UtilFileAs;\r\n\r\n/**\r\n * Mappings of event names and handlers.\r\n */\r\nexport interface DButtonFileOnOptions<VALUE> extends DButtonOnOptions<VALUE>, UtilFileOnOptions<any> {\r\n\r\n}\r\n\r\nexport interface DButtonFileOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonFile = DThemeButtonFile\r\n> extends DButtonOptions<VALUE, THEME> {\r\n\t/**\r\n\t * An output format.\r\n\t */\r\n\tas?: (keyof typeof UtilFileAs) | UtilFileAs;\r\n\r\n\t/**\r\n\t * A checker called before opening a file.\r\n\t * If the checker returns false or the returned promise object is rejected,\r\n\t * files will not be opened.\r\n\t */\r\n\tchecker?: () => Promise<unknown> | boolean;\r\n\r\n\ton?: DButtonFileOnOptions<VALUE>;\r\n}\r\n\r\nexport interface DThemeButtonFile extends DThemeButton {\r\n\r\n}\r\n\r\nexport class DButtonFile<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonFile = DThemeButtonFile,\r\n\tOPTIONS extends DButtonFileOptions<VALUE, THEME> = DButtonFileOptions<VALUE, THEME>\r\n> extends DButton<VALUE, THEME, OPTIONS> {\r\n\tprotected _checker!: (() => Promise<unknown> | boolean) | undefined;\r\n\tprotected _opener!: UtilFileOpener;\r\n\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._checker = ( options != null && options.checker != null ? options.checker : undefined );\r\n\t\tconst as: DButtonFileAs = ( options != null && options.as != null ?\r\n\t\t\t( isString( options.as ) ? DButtonFileAs[ options.as ] : options.as ) :\r\n\t\t\tDButtonFileAs.TEXT\r\n\t\t);\r\n\t\tconst opener = new UtilFileOpener( as, this );\r\n\t\tthis._opener = opener;\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst result = this.onOpening();\r\n\t\t\tif( result === true ) {\r\n\t\t\t\topener.open();\r\n\t\t\t} else if( result === false ) {\r\n\t\t\t\t// DO NOTHING\r\n\t\t\t} else {\r\n\t\t\t\tresult.then((): void => {\r\n\t\t\t\t\topener.open();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tonOpening(): boolean | Promise<unknown> {\r\n\t\tconst checker = this._checker;\r\n\t\tif( checker != null ) {\r\n\t\t\treturn checker();\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\topen(): void {\r\n\t\tthis._opener.open();\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonFile\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButtonBase } from \"./d-button-base\";\r\n\r\ntype BUTTON = DButtonBase<any, any, any>;\r\n\r\nexport interface DButtonGroupOptions {\r\n\ton?: { [name: string]: Function };\r\n}\r\n\r\nexport class DButtonGroup extends utils.EventEmitter {\r\n\tprotected _buttons: BUTTON[];\r\n\tprotected _active: BUTTON | null;\r\n\tprotected _stateOn: DBaseState;\r\n\tprotected _stateOff: DBaseState;\r\n\tprotected _onActiveBound: ( button: BUTTON ) => void;\r\n\r\n\tconstructor( options?: DButtonGroupOptions ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._buttons = [];\r\n\t\tthis._active = null;\r\n\t\tthis._stateOn = DBaseState.NONE;\r\n\t\tthis._stateOff = DBaseState.NONE;\r\n\t\tthis._onActiveBound = ( button: BUTTON ): void => {\r\n\t\t\tthis.onActive( button );\r\n\t\t};\r\n\r\n\t\t// Events\r\n\t\tif( options != null ) {\r\n\t\t\tconst on = options.on;\r\n\t\t\tif( on != null ) {\r\n\t\t\t\tfor( const name in on ) {\r\n\t\t\t\t\tthis.on( name, on[ name ] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Done\r\n\t\tthis.emit( \"init\", this );\r\n\t}\r\n\r\n\tadd( button: BUTTON ): void {\r\n\t\tconst buttons = this._buttons;\r\n\t\tconst index = buttons.indexOf( button );\r\n\t\tif( index < 0 ) {\r\n\t\t\tthis._buttons.push( button );\r\n\t\t\tbutton.setState( this._stateOn, true );\r\n\t\t\tbutton.setState( this._stateOff, false );\r\n\t\t\tbutton.on( \"active\", this._onActiveBound );\r\n\t\t\tif( button.isActive() ) {\r\n\t\t\t\tthis.onActive( button );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget active() {\r\n\t\treturn this._active;\r\n\t}\r\n\r\n\tprotected onActive( active: BUTTON ): void {\r\n\t\tif( active.isToggle() ) {\r\n\t\t\tthis._active = active;\r\n\t\t\tconst buttons = this._buttons;\r\n\t\t\tfor( let i = 0, imax = buttons.length; i < imax; ++i ) {\r\n\t\t\t\tconst button = buttons[ i ];\r\n\t\t\t\tif( button !== active && button.isToggle() && button.isActive() ) {\r\n\t\t\t\t\tbutton.toggle();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tremove( button: BUTTON ): void {\r\n\t\tconst buttons = this._buttons;\r\n\t\tconst index = buttons.indexOf( button );\r\n\t\tif( 0 <= index ) {\r\n\t\t\tbuttons.splice( index, 1 );\r\n\t\t\tbutton.off( \"active\", this._onActiveBound );\r\n\t\t}\r\n\t}\r\n\r\n\tcontains( button: BUTTON ): boolean {\r\n\t\tconst buttons = this._buttons;\r\n\t\tconst index = buttons.indexOf( button );\r\n\t\treturn ( 0 <= index );\r\n\t}\r\n\r\n\tsetHovered( isHovered: boolean ) {\r\n\t\treturn this.setState( DBaseState.HOVERED, isHovered );\r\n\t}\r\n\r\n\tsetActive( isActive: boolean ) {\r\n\t\treturn this.setState( DBaseState.ACTIVE, isActive );\r\n\t}\r\n\r\n\tsetReadOnly( isReadOnly: boolean ) {\r\n\t\treturn this.setState( DBaseState.READ_ONLY, isReadOnly );\r\n\t}\r\n\r\n\tsetDisabled( isDisabled: boolean ) {\r\n\t\treturn this.setState( DBaseState.DISABLED, isDisabled );\r\n\t}\r\n\r\n\tsetDragging( isDragging: boolean ) {\r\n\t\treturn this.setState( DBaseState.DRAGGING, isDragging );\r\n\t}\r\n\r\n\tisHovered(): boolean {\r\n\t\treturn this.hasState( DBaseState.HOVERED );\r\n\t}\r\n\r\n\tisActive(): boolean {\r\n\t\treturn this.hasState( DBaseState.ACTIVE );\r\n\t}\r\n\r\n\tisReadOnly(): boolean {\r\n\t\treturn this.hasState( DBaseState.READ_ONLY );\r\n\t}\r\n\r\n\tisDisabled(): boolean {\r\n\t\treturn this.hasState( DBaseState.DISABLED );\r\n\t}\r\n\r\n\tisDragging(): boolean {\r\n\t\treturn this.hasState( DBaseState.DRAGGING );\r\n\t}\r\n\r\n\tisFocused(): boolean {\r\n\t\treturn this.hasState( DBaseState.FOCUSED );\r\n\t}\r\n\r\n\tisUnfocusable(): boolean {\r\n\t\treturn this.hasState( DBaseState.UNFOCUSABLE );\r\n\t}\r\n\r\n\tsetState( state: DBaseState, isOn: boolean ) {\r\n\t\tif( isOn ) {\r\n\t\t\tthis._stateOn |= state;\r\n\t\t\tthis._stateOff &= ~state;\r\n\t\t} else {\r\n\t\t\tthis._stateOff |= state;\r\n\t\t\tthis._stateOn &= ~state;\r\n\t\t}\r\n\r\n\t\tconst buttons = this._buttons;\r\n\t\tfor( let i = 0, imax = buttons.length; i < imax; ++i ) {\r\n\t\t\tconst button = buttons[ i ];\r\n\t\t\tbutton.setState( state, isOn );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\thasState( state: DBaseState ): boolean {\r\n\t\tconst buttons = this._buttons;\r\n\t\tfor( let i = 0, imax = buttons.length; i < imax; ++i ) {\r\n\t\t\tif( buttons[ i ].hasState( state ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tthis._buttons.length = 0;\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis.clear();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DButtonBase, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\r\nimport { DLink, DLinkOptions, DThemeLink } from \"./d-link\";\r\n\r\nexport interface DButtonLinkOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonLink = DThemeButtonLink\r\n> extends DButtonBaseOptions<VALUE, THEME>, DLinkOptions {\r\n\r\n}\r\n\r\nexport interface DThemeButtonLink extends DThemeButtonBase, DThemeLink {\r\n\r\n}\r\n\r\nexport class DButtonLink<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonLink = DThemeButtonLink,\r\n\tOPTIONS extends DButtonLinkOptions<VALUE, THEME> = DButtonLinkOptions<VALUE, THEME>\r\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\r\n\tprotected _link!: DLink;\r\n\r\n\tprotected initOnClick( options?: OPTIONS ): void {\r\n\t\tconst link = new DLink( this.theme, options );\r\n\t\tthis._link = link;\r\n\t\tlink.apply( this, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tthis.onClick( e );\r\n\t\t});\r\n\t}\r\n\r\n\tprotected onActivate( e?: interaction.InteractionEvent | KeyboardEvent | MouseEvent | TouchEvent ): void {\r\n\t\tsuper.onActivate( e );\r\n\t\tthis.open( this._link.inNewWindow( e ) );\r\n\t}\r\n\r\n\topen( inNewWindow: boolean ): void {\r\n\t\tthis._link.open( inNewWindow );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonLink\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonBase, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\r\n\r\nexport interface DButtonRadioOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonRadio = DThemeButtonRadio\r\n> extends DButtonBaseOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeButtonRadio extends DThemeButtonBase {\r\n\r\n}\r\n\r\nexport class DButtonRadio<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonRadio = DThemeButtonRadio,\r\n\tOPTIONS extends DButtonRadioOptions<VALUE, THEME> = DButtonRadioOptions<VALUE, THEME>\r\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonRadio\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonRadio, DButtonRadioOptions, DThemeButtonRadio } from \"./d-button-radio\";\r\n\r\nexport interface DButtonRadioRightOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonRadioRight = DThemeButtonRadioRight\r\n> extends DButtonRadioOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeButtonRadioRight extends DThemeButtonRadio {\r\n\r\n}\r\n\r\nexport class DButtonRadioRight<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButtonRadioRight = DThemeButtonRadioRight,\r\n\tOPTIONS extends DButtonRadioRightOptions<VALUE, THEME> = DButtonRadioRightOptions<VALUE, THEME>\r\n> extends DButtonRadio<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonRadioRight\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DControllers } from \"./d-controllers\";\r\n\r\nexport class DButtonRedo<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButton = DThemeButton,\r\n\tOPTIONS extends DButtonOptions<VALUE, THEME> = DButtonOptions<VALUE, THEME>\r\n> extends DButton<VALUE, THEME, OPTIONS> {\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\r\n\t\tconst commandController = DControllers.getCommandController();\r\n\t\tthis.setState( DBaseState.DISABLED, ! commandController.isRedoable() );\r\n\t\tcommandController.on( \"change\", () => {\r\n\t\t\tthis.setState( DBaseState.DISABLED, ! commandController.isRedoable() );\r\n\t\t});\r\n\r\n\t\tthis.on( \"active\", () => {\r\n\t\t\tcommandController.redo();\r\n\t\t});\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton } from \"./d-button\";\r\n\r\nexport class DButtonSecondary extends DButton {\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonSecondary\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DChartAxisPosition {\r\n\tTOP,\r\n\tBOTTOM,\r\n\tLEFT,\r\n\tRIGHT\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport enum DChartAxisTickPosition {\r\n\tINSIDE,\r\n\tOUTSIDE\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\n\r\nexport interface DContentOptions extends DBaseOptions<DThemeContent> {\r\n\r\n}\r\n\r\nexport interface DThemeContent extends DThemeBase {\r\n\r\n}\r\n\r\nexport class DContent extends DBase<DThemeContent, DContentOptions> {\r\n\tprotected init( options?: DContentOptions ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t}\r\n\r\n\tprotected initReflowable(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DContent\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DScrollBarThumb, DScrollBarThumbOptions } from \"./d-scroll-bar-thumb\";\r\n\r\nexport interface DScrollBarOptions extends DBaseOptions<DThemeScrollBar> {\r\n\tthumb?: DScrollBarThumbOptions;\r\n}\r\n\r\nexport interface DThemeScrollBar extends DThemeBase {\r\n\r\n}\r\n\r\nexport abstract class DScrollBar extends DBase<DThemeScrollBar, DScrollBarOptions> {\r\n\tprotected _start!: number;\r\n\tprotected _end!: number;\r\n\tprotected _thumb!: DScrollBarThumb;\r\n\r\n\tprotected init( options?: DScrollBarOptions ): void {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._start = 0;\r\n\t\tthis._end = 1;\r\n\t\tconst thumb = this._thumb = this.createThumb( options != null ? options.thumb : undefined );\r\n\t\tthis.addChild( thumb );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t}\r\n\r\n\tget thumb(): DScrollBarThumb {\r\n\t\treturn this._thumb;\r\n\t}\r\n\r\n\tprotected abstract createThumb( options?: DScrollBarThumbOptions ): DScrollBarThumb;\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DScrollBar\";\r\n\t}\r\n\r\n\tsetRegion( start: number, end: number, size: number ): void {\r\n\t\tif( size < 1 ) {\r\n\t\t\tstart = 0;\r\n\t\t\tend = 1;\r\n\t\t} else {\r\n\t\t\tstart = Math.max( 0, Math.min( 1, start / size ) );\r\n\t\t\tend = Math.max( start, Math.min( 1, end / size ) );\r\n\t\t}\r\n\t\tif( this._start !== start || this._end !== end ) {\r\n\t\t\tthis._start = start;\r\n\t\t\tthis._end = end;\r\n\t\t\tthis.onRegionChange();\r\n\t\t}\r\n\t}\r\n\r\n\tisRegionVisible(): boolean {\r\n\t\treturn 0 < this._start || this._end < 1;\r\n\t}\r\n\r\n\tonResize( newWidth: number, newHeight: number, oldWidth: number, oldHeight: number ): void {\r\n\t\tsuper.onResize( newWidth, newHeight, oldWidth, oldHeight );\r\n\t\tthis.onRegionChange();\r\n\t}\r\n\r\n\tonRegionChange(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tgetRegionStart(): number {\r\n\t\treturn this._start;\r\n\t}\r\n\r\n\tgetRegionEnd(): number {\r\n\t\treturn this._end;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Point } from \"pixi.js\";\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { UtilDrag } from \"./util/util-drag\";\r\n\r\nexport interface DScrollBarThumbOptions extends DBaseOptions<DThemeScrollBarThumb> {\r\n\r\n}\r\n\r\nexport interface DThemeScrollBarThumb extends DThemeBase {\r\n\tgetMinimumSize(): number;\r\n}\r\n\r\nexport abstract class DScrollBarThumb extends DBase<DThemeScrollBarThumb, DScrollBarThumbOptions> {\r\n\tprotected _dragUtil!: UtilDrag;\r\n\r\n\tprotected init( options?: DScrollBarThumbOptions ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\r\n\t\tconst position = new Point();\r\n\t\tthis._dragUtil = new UtilDrag({\r\n\t\t\ttarget: this,\r\n\t\t\teasing: false,\r\n\t\t\ton: {\r\n\t\t\t\tstart: (): void => {\r\n\t\t\t\t\tposition.copyFrom( this.position );\r\n\t\t\t\t},\r\n\t\t\t\tmove: ( dx: number, dy: number ): void => {\r\n\t\t\t\t\tposition.set( position.x + dx, position.y + dy );\r\n\t\t\t\t\tthis.onDragMove( position.x, position.y );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetMinimumSize(): number {\r\n\t\treturn this.theme.getMinimumSize();\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DScrollBarThumb\";\r\n\t}\r\n\r\n\tprotected abstract onDragMove( dx: number, dy: number ): void;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Graphics } from \"pixi.js\";\r\nimport { DBase, DReflowable } from \"./d-base\";\r\nimport { DScrollBarThumb } from \"./d-scroll-bar-thumb\";\r\n\r\nexport class DScrollBarThumbReflowableHorizontal extends Graphics implements DReflowable {\r\n\tconstructor( base: DScrollBarThumb ) {\r\n\t\tsuper();\r\n\t\tbase.appendRenderable( this, true );\r\n\t\tbase.addReflowable( this );\r\n\t}\r\n\r\n\tonReflow( base: DBase, width: number, height: number ): void {\r\n\t\tconst state = base.state;\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tconst background = base.background;\r\n\t\tconst backgroundColor = background.getColor( state );\r\n\t\tconst backgroundAlpha = background.getAlpha( state );\r\n\t\tif( backgroundColor != null ) {\r\n\t\t\tconst size = 1;\r\n\t\t\tthis.beginFill( backgroundColor, backgroundAlpha );\r\n\t\t\tthis.lineStyle( 0, 0, 0, 0 );\r\n\t\t\tthis.drawRect( 0, height * 0.5 - size, width, size * 2 );\r\n\t\t\tthis.endFill();\r\n\t\t\tthis.visible = true;\r\n\t\t} else {\r\n\t\t\tthis.visible = false;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DScrollBarThumb } from \"./d-scroll-bar-thumb\";\r\nimport { DScrollBarThumbReflowableHorizontal } from \"./d-scroll-bar-thumb-reflowable-horizontal\";\r\n\r\nexport class DScrollBarThumbHorizontal extends DScrollBarThumb {\r\n\tprotected onDragMove( dx: number, dy: number ) {\r\n\t\tthis.emit( \"regionmove\", dx, this );\r\n\t}\r\n\r\n\tprotected initReflowable(): void {\r\n\t\tnew DScrollBarThumbReflowableHorizontal( this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DScrollBar, DScrollBarOptions } from \"./d-scroll-bar\";\r\nimport { DScrollBarThumb, DScrollBarThumbOptions } from \"./d-scroll-bar-thumb\";\r\nimport { DScrollBarThumbHorizontal } from \"./d-scroll-bar-thumb-horizontal\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport class DScrollBarHorizontal extends DScrollBar {\r\n\tprotected init( options?: DScrollBarOptions ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.on( UtilPointerEvent.down, ( e: InteractionEvent ) => {\r\n\t\t\tif( e.target === this ) {\r\n\t\t\t\tconst width = this.width;\r\n\t\t\t\tif( 0 < width ) {\r\n\t\t\t\t\tconst size = this._end - this._start;\r\n\t\t\t\t\tconst position = e.data.getLocalPosition( this );\r\n\t\t\t\t\tconst newStart = Math.min( 1 - size, Math.max( 0, position.x / width - size * 0.5 ) );\r\n\t\t\t\t\tif( this._start !== newStart ) {\r\n\t\t\t\t\t\tthis.emit( \"regionmove\", newStart, this );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._thumb.on( \"regionmove\", ( x: number ) => {\r\n\t\t\tconst width = this.width;\r\n\t\t\tif( 0 < width ) {\r\n\t\t\t\tconst size = this._end - this._start;\r\n\t\t\t\tconst newStart = Math.min( 1 - size, Math.max( 0, x / width ) );\r\n\t\t\t\tif( this._start !== newStart ) {\r\n\t\t\t\t\tthis.emit( \"regionmove\", newStart, this );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected createThumb( options?: DScrollBarThumbOptions ): DScrollBarThumb {\r\n\t\treturn new DScrollBarThumbHorizontal( options );\r\n\t}\r\n\r\n\tonRegionChange(): void {\r\n\t\tconst thumb = this._thumb;\r\n\t\tconst width = this.width;\r\n\t\tconst height = this.height;\r\n\t\tconst thumbMinimumSize = Math.min( width * 0.5, thumb.getMinimumSize() );\r\n\t\tconst space = width - thumbMinimumSize;\r\n\t\tconst barStart = space * this._start;\r\n\t\tconst barSize = space * this._end + thumbMinimumSize - barStart;\r\n\r\n\t\tthumb.position.set( barStart, 0 );\r\n\t\tthumb.resize( barSize, height );\r\n\r\n\t\tsuper.onRegionChange();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Graphics } from \"pixi.js\";\r\nimport { DBase, DReflowable } from \"./d-base\";\r\n\r\nexport class DScrollBarThumbReflowableVertical extends Graphics implements DReflowable {\r\n\tconstructor( base: DBase ) {\r\n\t\tsuper();\r\n\t\tbase.appendRenderable( this, true );\r\n\t\tbase.addReflowable( this );\r\n\t}\r\n\r\n\tonReflow( base: DBase, width: number, height: number ): void {\r\n\t\tconst state = base.state;\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tconst background = base.background;\r\n\t\tconst backgroundColor = background.getColor( state );\r\n\t\tconst backgroundAlpha = background.getAlpha( state );\r\n\t\tif( backgroundColor != null ) {\r\n\t\t\tconst size = 1;\r\n\t\t\tthis.beginFill( backgroundColor, backgroundAlpha );\r\n\t\t\tthis.lineStyle( 0, 0, 0, 0 );\r\n\t\t\tthis.drawRect( width * 0.5 - size, 0, size * 2, height );\r\n\t\t\tthis.endFill();\r\n\t\t\tthis.visible = true;\r\n\t\t} else {\r\n\t\t\tthis.visible = false;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DScrollBarThumb } from \"./d-scroll-bar-thumb\";\r\nimport { DScrollBarThumbReflowableVertical } from \"./d-scroll-bar-thumb-reflowable-vertical\";\r\n\r\nexport class DScrollBarThumbVertocal extends DScrollBarThumb {\r\n\tprotected onDragMove( dx: number, dy: number ) {\r\n\t\tthis.emit( \"regionmove\", dy, this );\r\n\t}\r\n\r\n\tprotected initReflowable(): void {\r\n\t\tnew DScrollBarThumbReflowableVertical( this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DScrollBar, DScrollBarOptions } from \"./d-scroll-bar\";\r\nimport { DScrollBarThumb, DScrollBarThumbOptions } from \"./d-scroll-bar-thumb\";\r\nimport { DScrollBarThumbVertocal } from \"./d-scroll-bar-thumb-vertical\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport class DScrollBarVertical extends DScrollBar {\r\n\tprotected init( options?: DScrollBarOptions ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.on( UtilPointerEvent.down, ( e: InteractionEvent ): void => {\r\n\t\t\tif( e.target === this ) {\r\n\t\t\t\tconst height = this.height;\r\n\t\t\t\tif( 0 < height ) {\r\n\t\t\t\t\tconst size = this._end - this._start;\r\n\t\t\t\t\tconst position = e.data.getLocalPosition( this );\r\n\t\t\t\t\tconst newStart = Math.min( 1 - size, Math.max( 0, position.y / height - size * 0.5 ) );\r\n\t\t\t\t\tif( this._start !== newStart ) {\r\n\t\t\t\t\t\tthis.emit( \"regionmove\", newStart, this );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._thumb.on( \"regionmove\", ( y: number ): void => {\r\n\t\t\tconst height = this.height;\r\n\t\t\tif( 0 < height ) {\r\n\t\t\t\tconst size = this._end - this._start;\r\n\t\t\t\tconst newStart = Math.min( 1 - size, Math.max( 0, y / height ) );\r\n\t\t\t\tif( this._start !== newStart ) {\r\n\t\t\t\t\tthis.emit( \"regionmove\", newStart, this );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected createThumb( options?: DScrollBarThumbOptions ): DScrollBarThumb {\r\n\t\treturn new DScrollBarThumbVertocal( options );\r\n\t}\r\n\r\n\tonRegionChange(): void {\r\n\t\tconst thumb = this._thumb;\r\n\t\tconst width = this.width;\r\n\t\tconst height = this.height;\r\n\t\tconst thumbMinimumSize = Math.min( height * 0.5, thumb.getMinimumSize() );\r\n\t\tconst space = height - thumbMinimumSize;\r\n\t\tconst barStart = space * this._start;\r\n\t\tconst barSize = space * this._end + thumbMinimumSize - barStart;\r\n\r\n\t\tthumb.position.set( 0, barStart );\r\n\t\tthumb.resize( width, barSize );\r\n\r\n\t\tsuper.onRegionChange();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Point } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseOverflowMask } from \"./d-base-overflow-mask\";\r\nimport { DContent, DContentOptions } from \"./d-content\";\r\nimport { DDragMode } from \"./d-drag-mode\";\r\nimport { DScrollBar, DScrollBarOptions } from \"./d-scroll-bar\";\r\nimport { DScrollBarHorizontal } from \"./d-scroll-bar-horizontal\";\r\nimport { DScrollBarVertical } from \"./d-scroll-bar-vertical\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilDrag } from \"./util/util-drag\";\r\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\r\n\r\nexport interface DPaneDragOptions {\r\n\tmode?: (keyof typeof DDragMode) | DDragMode;\r\n}\r\n\r\nexport interface DPaneBarOptions {\r\n\tvertical?: DScrollBarOptions;\r\n\thorizontal?: DScrollBarOptions;\r\n}\r\n\r\nexport interface DPaneOptions<\r\n\tTHEME extends DThemePane = DThemePane,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\r\n> extends DBaseOptions<THEME> {\r\n\tmask?: boolean;\r\n\tcontent?: CONTENT_OPTIONS | DBase;\r\n\tbar?: DPaneBarOptions;\r\n\tdrag?: DPaneDragOptions;\r\n}\r\n\r\nexport interface DThemePane extends DThemeBase {\r\n\tisOverflowMaskEnabled(): boolean;\r\n\tgetWheelSpeed(): number;\r\n\tgetDragMode(): DDragMode;\r\n}\r\n\r\n// Option parsers\r\nconst isOverflowMaskEnabled = <\r\n\tTHEME extends DThemePane,\r\n\tCONTENT_OPTIONS extends DBaseOptions\r\n>( theme: THEME, options?: DPaneOptions<THEME, CONTENT_OPTIONS> ): boolean => {\r\n\tif( options && options.mask != null ) {\r\n\t\treturn options.mask;\r\n\t}\r\n\treturn theme.isOverflowMaskEnabled();\r\n};\r\n\r\nconst toBarOptionsVertical = ( options?: DPaneOptions ): DScrollBarOptions | undefined => {\r\n\treturn options && options.bar && options.bar.vertical;\r\n};\r\n\r\nconst toBarOptionsHorizontal = ( options?: DPaneOptions ): DScrollBarOptions | undefined => {\r\n\treturn options && options.bar && options.bar.horizontal;\r\n};\r\n\r\n// Class\r\nexport class DPane<\r\n\tTHEME extends DThemePane = DThemePane,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\r\n\tOPTIONS extends DPaneOptions<THEME, CONTENT_OPTIONS> = DPaneOptions<THEME, CONTENT_OPTIONS>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected static WORK_ON_FOCUSED = new Point();\r\n\tprotected _content!: DBase;\r\n\tprotected _overflowMask!: DBaseOverflowMask | null;\r\n\tprotected _verticalBar?: DScrollBarVertical;\r\n\tprotected _horizontalBar?: DScrollBarHorizontal;\r\n\tprotected _dragUtil?: UtilDrag;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._overflowMask = null;\r\n\r\n\t\t// Content\r\n\t\tconst theme = this.theme;\r\n\t\tconst content = this._content = this.toContent( options );\r\n\t\tif( isOverflowMaskEnabled( theme, options ) ) {\r\n\t\t\tthis.mask = this.getOrCreateOverflowMask();\r\n\t\t}\r\n\t\tthis.addChild( content );\r\n\r\n\t\t// Scroll bar\r\n\t\tthis.initScrollBar( content, theme, options );\r\n\r\n\t\t// Drag\r\n\t\tthis.initDrag( content, theme, options );\r\n\t}\r\n\r\n\tprotected initDrag( content: DBase, theme: THEME, options?: OPTIONS ): void {\r\n\t\tconst dragMode = ( options && options.drag && options.drag.mode != null ?\r\n\t\t\t( isString( options.drag.mode ) ? DDragMode[ options.drag.mode ] : options.drag.mode ) :\r\n\t\t\ttheme.getDragMode()\r\n\t\t);\r\n\t\t// Edge does not fire the wheel event when scrolling using the 2-fingure scroll gesture on a touchpad.\r\n\t\t// Instead, it fires touch events. This is why the dragging is enabled regardless of the `UtilPointerEvent.touchable`.\r\n\t\t// https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/7134034/\r\n\t\tif( dragMode === DDragMode.ON || dragMode === DDragMode.TOUCH ) {\r\n\t\t\tconst position = new Point();\r\n\t\t\tthis._dragUtil = new UtilDrag({\r\n\t\t\t\ttarget: this,\r\n\t\t\t\ttouch: dragMode === DDragMode.TOUCH,\r\n\t\t\t\ton: {\r\n\t\t\t\t\tstart: (): void => {\r\n\t\t\t\t\t\tposition.copyFrom( content.position );\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmove: ( dx: number, dy: number ): void => {\r\n\t\t\t\t\t\tposition.set( position.x + dx, position.y + dy );\r\n\t\t\t\t\t\tcontent.position.set(\r\n\t\t\t\t\t\t\tthis.toContentX( content, position.x ),\r\n\t\t\t\t\t\t\tthis.toContentY( content, position.y )\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onRegionMoveX( content: DBase, start: number ) {\r\n\t\tconst dragUtil = this._dragUtil;\r\n\t\tif( dragUtil != null ) {\r\n\t\t\tdragUtil.stop();\r\n\t\t}\r\n\t\tcontent.x = - content.width * start;\r\n\t}\r\n\r\n\tprotected onRegionMoveY( content: DBase, start: number ) {\r\n\t\tconst dragUtil = this._dragUtil;\r\n\t\tif( dragUtil != null ) {\r\n\t\t\tdragUtil.stop();\r\n\t\t}\r\n\t\tcontent.y = - content.height * start;\r\n\t}\r\n\r\n\tprotected initScrollBar( content: DBase, theme: THEME, options?: OPTIONS ): void {\r\n\t\t// Vertical bar\r\n\t\tconst verticalBar = this._verticalBar = new DScrollBarVertical( toBarOptionsVertical( options ) );\r\n\t\tverticalBar.on( \"regionmove\", ( start: number ): void => {\r\n\t\t\tthis.onRegionMoveY( content, start );\r\n\t\t});\r\n\t\tthis.addChild( verticalBar );\r\n\r\n\t\t// Horizontal bar\r\n\t\tconst horizontalBar = this._horizontalBar = new DScrollBarHorizontal( toBarOptionsHorizontal( options ) );\r\n\t\thorizontalBar.on( \"regionmove\", ( start: number ): void => {\r\n\t\t\tthis.onRegionMoveX( content, start );\r\n\t\t});\r\n\t\tthis.addChild( horizontalBar );\r\n\r\n\t\t//\r\n\t\tcontent.on( \"move\", (): void => {\r\n\t\t\tthis.onContentChanged();\r\n\t\t});\r\n\t\tcontent.on( \"resize\", (): void => {\r\n\t\t\tthis.onContentChanged();\r\n\t\t});\r\n\t\tthis.updateScrollBar();\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPane\";\r\n\t}\r\n\r\n\tget content(): DBase {\r\n\t\treturn this._content;\r\n\t}\r\n\r\n\tprotected toContent( options?: OPTIONS ): DBase {\r\n\t\tif( options && options.content ) {\r\n\t\t\tconst content = options.content;\r\n\t\t\tif( content instanceof DBase ) {\r\n\t\t\t\treturn content;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.newContent( content );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.newContent();\r\n\t}\r\n\r\n\tprotected newContent( options?: CONTENT_OPTIONS ): DBase {\r\n\t\treturn new DContent( options );\r\n\t}\r\n\r\n\tprotected getOrCreateOverflowMask(): DBaseOverflowMask {\r\n\t\tif( this._overflowMask == null ) {\r\n\t\t\tthis._overflowMask = new DBaseOverflowMask( this );\r\n\t\t\tthis.addReflowable( this._overflowMask );\r\n\t\t\tthis.toDirty();\r\n\t\t}\r\n\t\treturn this._overflowMask;\r\n\t}\r\n\r\n\tonWheel( e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point ): boolean {\r\n\t\tconst content = this._content;\r\n\t\tconst x = this.getWheelContentX( content, deltas.deltaX * deltas.lowest );\r\n\t\tconst y = this.getWheelContentY( content, deltas.deltaY * deltas.lowest );\r\n\t\tif( content.x !== x || content.y !== y ) {\r\n\t\t\tconst dragUtil = this._dragUtil;\r\n\t\t\tif( dragUtil != null ) {\r\n\t\t\t\tdragUtil.stop();\r\n\t\t\t}\r\n\t\t\tcontent.position.set( x, y );\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected getWheelContentX( content: DBase, delta: number ): number {\r\n\t\tif( 0 < delta || delta < 0 ) {\r\n\t\t\tconst speed = this.theme.getWheelSpeed();\r\n\t\t\treturn this.toContentX( content, content.x - delta * speed );\r\n\t\t}\r\n\t\treturn content.x;\r\n\t}\r\n\r\n\tprotected getWheelContentY( content: DBase, delta: number ): number {\r\n\t\tif( 0 < delta || delta < 0 ) {\r\n\t\t\tconst speed = this.theme.getWheelSpeed();\r\n\t\t\treturn this.toContentY( content, content.y + delta * speed );\r\n\t\t}\r\n\t\treturn content.y;\r\n\t}\r\n\r\n\tprotected toContentX( content: DBase, x: number ): number {\r\n\t\treturn Math.min( 0, Math.max( this.width - content.width, x ) );\r\n\t}\r\n\r\n\tprotected toContentY( content: DBase, y: number ): number {\r\n\t\treturn Math.min( 0, Math.max( this.height - content.height, y ) );\r\n\t}\r\n\r\n\tprotected isRefitable( target: any ): target is DBase<any, any> {\r\n\t\treturn super.isRefitable( target ) && ! ( target instanceof DScrollBar );\r\n\t}\r\n\r\n\tonResize( newWidth: number, newHeight: number, oldWidth: number, oldHeight: number ): void {\r\n\t\tsuper.onResize( newWidth, newHeight, oldWidth, oldHeight );\r\n\t\tthis.updateScrollBar();\r\n\t}\r\n\r\n\tprotected onContentChanged(): void {\r\n\t\tthis.updateScrollBar();\r\n\t}\r\n\r\n\tprotected updateScrollBar(): void {\r\n\t\tconst verticalBar = this._verticalBar;\r\n\t\tconst horizontalBar = this._horizontalBar;\r\n\t\tif( verticalBar != null && horizontalBar != null ) {\r\n\t\t\tthis.updateScrollBarRegions( verticalBar, horizontalBar );\r\n\t\t\tthis.updateScrollBarVisibilities( verticalBar, horizontalBar );\r\n\t\t\tthis.updateScrollBarPositions( verticalBar, horizontalBar );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getScrollBarOffsetHorizontalStart( size: number ): number {\r\n\t\treturn size * 0.5;\r\n\t}\r\n\r\n\tprotected getScrollBarOffsetHorizontalEnd( size: number ): number {\r\n\t\treturn size * 0.5;\r\n\t}\r\n\r\n\tprotected getScrollBarOffsetVerticalStart( size: number ): number {\r\n\t\treturn size * 0.5;\r\n\t}\r\n\r\n\tprotected getScrollBarOffsetVerticalEnd( size: number ): number {\r\n\t\treturn size * 0.5;\r\n\t}\r\n\r\n\tprotected updateScrollBarPositions( verticalBar: DScrollBarVertical, horizontalBar: DScrollBarHorizontal ): void {\r\n\t\tconst width = this.width;\r\n\t\tconst height = this.height;\r\n\r\n\t\tconst verticalBarWidth = verticalBar.width;\r\n\t\tconst verticalBarOffsetStart = this.getScrollBarOffsetVerticalStart( verticalBarWidth );\r\n\t\tconst verticalBarOffsetEnd = this.getScrollBarOffsetVerticalEnd( verticalBarWidth );\r\n\t\tverticalBar.position.set( width - verticalBarWidth, verticalBarOffsetStart );\r\n\t\tverticalBar.height = height - verticalBarOffsetStart - verticalBarOffsetEnd;\r\n\r\n\t\tconst horizontalBarHeight = horizontalBar.height;\r\n\t\tconst horizontalBarOffsetStart = this.getScrollBarOffsetHorizontalStart( horizontalBarHeight );\r\n\t\tconst horizontalBarOffsetEnd = this.getScrollBarOffsetHorizontalEnd( horizontalBarHeight );\r\n\t\thorizontalBar.position.set( horizontalBarOffsetStart, height - horizontalBarHeight );\r\n\t\thorizontalBar.width = width - horizontalBarOffsetStart - horizontalBarOffsetEnd;\r\n\t}\r\n\r\n\tprotected updateScrollBarRegions( verticalBar: DScrollBarVertical, horizontalBar: DScrollBarHorizontal ): void {\r\n\t\tconst content = this._content;\r\n\t\tconst x = -content.x;\r\n\t\tconst y = -content.y;\r\n\t\thorizontalBar.setRegion( x, x + this.width, content.width );\r\n\t\tverticalBar.setRegion( y, y + this.height, content.height );\r\n\t}\r\n\r\n\tprotected updateScrollBarVisibilities( verticalBar: DScrollBarVertical, horizontalBar: DScrollBarHorizontal ): void {\r\n\t\tconst isChangedHorizontal = this.updateScrollBarVisibility( horizontalBar );\r\n\t\tconst isChangedVertical = this.updateScrollBarVisibility( verticalBar );\r\n\t\tif( isChangedHorizontal || isChangedVertical ) {\r\n\t\t\t// Update the overflow mask\r\n\t\t\tconst overflowMask = this._overflowMask;\r\n\t\t\tif( overflowMask != null ) {\r\n\t\t\t\tif( horizontalBar.visible || verticalBar.visible ) {\r\n\t\t\t\t\tconst content = this._content;\r\n\t\t\t\t\tif( content.mask !== overflowMask ) {\r\n\t\t\t\t\t\tcontent.mask = overflowMask;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst content = this._content;\r\n\t\t\t\t\tif( content.mask ) {\r\n\t\t\t\t\t\t(content as any).mask = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Rerender\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateScrollBarVisibility( bar: DScrollBar ): boolean {\r\n\t\tconst isRegionVisible = bar.isRegionVisible();\r\n\t\tif( bar.visible !== isRegionVisible ) {\r\n\t\t\tbar.visible = isRegionVisible;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected onChildFocused( focused: DBase ): void {\r\n\t\tconst work = DPane.WORK_ON_FOCUSED;\r\n\t\tconst content = this.content;\r\n\t\tconst contentX = content.x;\r\n\t\tconst contentY = content.y;\r\n\t\tconst contentWidth = content.width;\r\n\t\tconst contentHeight = content.height;\r\n\r\n\t\twork.set( 0, 0 );\r\n\t\tfocused.toGlobal( work, work, false );\r\n\t\tcontent.toLocal( work, undefined, work, false );\r\n\t\tconst x0 = contentX + Math.min( contentWidth, Math.max( 0, work.x ) );\r\n\t\tconst y0 = contentY + Math.min( contentHeight, Math.max( 0, work.y ) );\r\n\r\n\t\twork.set( focused.width, focused.height );\r\n\t\tfocused.toGlobal( work, work, true );\r\n\t\tcontent.toLocal( work, undefined, work, true );\r\n\t\tconst x1 = contentX + Math.min( contentWidth, Math.max( 0, work.x ) );\r\n\t\tconst y1 = contentY + Math.min( contentHeight, Math.max( 0, work.y ) );\r\n\r\n\t\tconst width = this.width;\r\n\t\tlet newX: number | null = null;\r\n\t\tif( x0 < 0 ) {\r\n\t\t\tif( x1 <= width ) {\r\n\t\t\t\tnewX = contentX - Math.max( x0, x1 - width );\r\n\t\t\t\tnewX = Math.max( width - contentWidth, Math.min( 0, newX ) );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( width < x1 ) {\r\n\t\t\t\tnewX = contentX - Math.min( x0, x1 - width );\r\n\t\t\t\tnewX = Math.max( width - contentWidth, Math.min( 0, newX ) );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst height = this.height;\r\n\t\tlet newY: number | null = null;\r\n\t\tif( y0 < 0 ) {\r\n\t\t\tif( y1 <= height ) {\r\n\t\t\t\tnewY = contentY - Math.max( y0, y1 - height );\r\n\t\t\t\tnewY = Math.max( height - contentHeight, Math.min( 0, newY ) );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( height < y1 ) {\r\n\t\t\t\tnewY = contentY - Math.min( y0, y1 - height );\r\n\t\t\t\tnewY = Math.max( height - contentHeight, Math.min( 0, newY ) );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( newX != null ) {\r\n\t\t\tif( newY != null ) {\r\n\t\t\t\tcontent.position.set( newX, newY );\r\n\t\t\t} else {\r\n\t\t\t\tcontent.position.x = newX;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( newY != null ) {\r\n\t\t\t\tcontent.position.y = newY;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.onChildFocused( focused );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// Overflow mask\r\n\t\tconst overflowMask = this._overflowMask;\r\n\t\tif( overflowMask != null ) {\r\n\t\t\tthis._overflowMask = null;\r\n\t\t\toverflowMask.destroy();\r\n\t\t}\r\n\t\t(this as any).mask = null;\r\n\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, interaction } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DBase, DBaseOptions } from \"./d-base\";\r\nimport { DContentOptions } from \"./d-content\";\r\nimport { DListSelection, DListSelectionOptions } from \"./d-list-selection\";\r\nimport { DPane, DPaneOptions, DThemePane } from \"./d-pane\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DListOptions<\r\n\tTHEME extends DThemeList = DThemeList,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\r\n> extends DPaneOptions<THEME, CONTENT_OPTIONS> {\r\n\tselection?: DListSelectionOptions | DListSelection;\r\n}\r\n\r\nexport interface DThemeList extends DThemePane {\r\n\r\n}\r\n\r\nexport class DList<\r\n\tTHEME extends DThemeList = DThemeList,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\r\n\tOPTIONS extends DListOptions<THEME, CONTENT_OPTIONS> = DListOptions<THEME, CONTENT_OPTIONS>\r\n> extends DPane<THEME, CONTENT_OPTIONS, OPTIONS> {\r\n\tprotected _selection!: DListSelection;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tconst selection = options && options.selection;\r\n\t\tthis._selection = ( selection instanceof DListSelection ?\r\n\t\t\tselection : this.newSelection( selection )\r\n\t\t);\r\n\r\n\t\tUtilPointerEvent.onClick( this, ( e: InteractionEvent ): void => {\r\n\t\t\tconst child: DisplayObject | null = this.findItem( e.target );\r\n\t\t\tif( child instanceof DBase && child.isActionable() ) {\r\n\t\t\t\tthis.selection.add( child );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected newSelection( options?: DListSelectionOptions ): DListSelection {\r\n\t\treturn new DListSelection( this._content, options );\r\n\t}\r\n\r\n\tprotected onChildrenDirty(): void {\r\n\t\tconst selection = this._selection;\r\n\t\tif( selection != null ) {\r\n\t\t\tselection.toDirty();\r\n\t\t}\r\n\t\tsuper.onChildrenDirty();\r\n\t}\r\n\r\n\tget selection(): DListSelection {\r\n\t\treturn this._selection;\r\n\t}\r\n\r\n\tprotected findItem( target: DisplayObject | null ): DisplayObject | null {\r\n\t\tconst content = this.content;\r\n\t\tlet current = target;\r\n\t\twhile( current != null ) {\r\n\t\t\tif( current.parent === content ) {\r\n\t\t\t\treturn current;\r\n\t\t\t}\r\n\t\t\tcurrent = current.parent;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tonRefit(): void {\r\n\t\tsuper.onRefit();\r\n\t\tthis.updateChildPosition();\r\n\t\tthis.updateChildVisibility();\r\n\t}\r\n\r\n\tprotected updateChildPosition(): void {\r\n\t\tconst content = this.content;\r\n\t\tconst items = content.children;\r\n\t\tlet y = 0;\r\n\t\tfor( let i = 0, imax = items.length; i < imax; ++i ) {\r\n\t\t\tconst item = items[ i ];\r\n\t\t\tif( item instanceof DBase ) {\r\n\t\t\t\titem.y = y;\r\n\t\t\t\ty += item.height;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst scrollLimit = Math.min( 0, -y + this.height );\r\n\t\tif( content.y < scrollLimit ) {\r\n\t\t\tcontent.y = scrollLimit;\r\n\t\t}\r\n\t\tcontent.height = y;\r\n\t}\r\n\r\n\tprotected updateChildVisibility(): void {\r\n\t\tconst content = this.content;\r\n\t\tconst items = content.children;\r\n\t\tconst from = -content.y;\r\n\t\tconst to = from + this.height;\r\n\t\tfor( let i = 0, imax = items.length; i < imax; ++i ) {\r\n\t\t\tconst item = items[ i ];\r\n\t\t\tif( item instanceof DBase ) {\r\n\t\t\t\tconst itemY = item.y;\r\n\t\t\t\titem.visible = ( from <= itemY + item.height && itemY <= to );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onContentChanged(): void {\r\n\t\tsuper.onContentChanged();\r\n\t\tthis.updateChildVisibility();\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DList\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseOptions } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DContentOptions } from \"./d-content\";\r\nimport { DList, DListOptions, DThemeList } from \"./d-list\";\r\n\r\nexport interface DDialogSelectListOptions<\r\n\tTHEME extends DThemeDialogSelecList = DThemeDialogSelecList,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\r\n> extends DListOptions<THEME, CONTENT_OPTIONS> {\r\n\r\n}\r\n\r\nexport interface DThemeDialogSelecList extends DThemeList {\r\n\r\n}\r\n\r\nexport class DDialogSelectList<\r\n\tTHEME extends DThemeDialogSelecList = DThemeDialogSelecList,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\r\n\tOPTIONS extends DDialogSelectListOptions<THEME, CONTENT_OPTIONS> = DDialogSelectListOptions<THEME, CONTENT_OPTIONS>\r\n> extends DList<THEME, CONTENT_OPTIONS, OPTIONS> {\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogSelectList\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DListItem, DListItemOptions, DThemeListItem } from \"./d-list-item\";\r\n\r\nexport interface DDialogSelectListItemOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeDialogSelecListItem = DThemeDialogSelecListItem\r\n> extends DListItemOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeDialogSelecListItem extends DThemeListItem {\r\n\r\n}\r\n\r\nexport class DDialogSelectListItem<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeDialogSelecListItem = DThemeDialogSelecListItem,\r\n\tOPTIONS extends DDialogSelectListItemOptions<VALUE, THEME> = DDialogSelectListItemOptions<VALUE, THEME>\r\n> extends DListItem<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogSelectListItem\";\r\n\t}\r\n}\r\n","import { utils } from \"pixi.js\";\r\n\r\nexport class DDialogSelectSearh<SEARCH_RESULT> extends utils.EventEmitter {\r\n\tprotected _search: ( word: string ) => Promise<SEARCH_RESULT[]>;\r\n\tprotected _id: number;\r\n\tprotected _idCompleted: number;\r\n\tprotected _result: SEARCH_RESULT[] | null;\r\n\r\n\tconstructor( search?: ( word: string ) => Promise<SEARCH_RESULT[]> ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._search = search || (( _: string ) => Promise.resolve([]));\r\n\t\tthis._id = 0;\r\n\t\tthis._idCompleted = 0;\r\n\t\tthis._result = null;\r\n\t}\r\n\r\n\tcreate( args: [ string ] ): void {\r\n\t\tconst id = ++this._id;\r\n\t\tthis._search( args[ 0 ] ).then(( searchResult: SEARCH_RESULT[] ) => {\r\n\t\t\tif( this._id === id ) {\r\n\t\t\t\tthis._idCompleted = id;\r\n\t\t\t\tthis._result = searchResult;\r\n\t\t\t\tthis.emit( \"success\", this, searchResult );\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t}\r\n\t\t}, () => {\r\n\t\t\tif( this._id === id ) {\r\n\t\t\t\tthis._idCompleted = id;\r\n\t\t\t\tthis._result = null;\r\n\t\t\t\tthis.emit( \"fail\", this );\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\tisDone(): boolean {\r\n\t\treturn this._id === this._idCompleted;\r\n\t}\r\n\r\n\tgetResult(): SEARCH_RESULT[] | null {\r\n\t\treturn this._result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DText, DTextOptions, DThemeText } from \"./d-text\";\r\n\r\nexport interface DNoteOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeNote = DThemeNote\r\n> extends DTextOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeNote extends DThemeText {\r\n\r\n}\r\n\r\nexport class DNote<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeNote = DThemeNote,\r\n\tOPTIONS extends DNoteOptions<VALUE, THEME> = DNoteOptions<VALUE, THEME>\r\n> extends DText<VALUE, THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.visible = false;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DNote\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"./d-base\";\r\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\r\nimport { DDialogSelectList } from \"./d-dialog-select-list\";\r\nimport { DDialogSelectListItem } from \"./d-dialog-select-list-item\";\r\nimport { DDialogSelectSearh } from \"./d-dialog-select-search\";\r\nimport { DInputText } from \"./d-input-text\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DListItem } from \"./d-list-item\";\r\nimport { DListSelection } from \"./d-list-selection\";\r\nimport { DNote, DNoteOptions } from \"./d-note\";\r\nimport { UtilTransition } from \"./util/util-transition\";\r\n\r\nexport interface DDialogSelectSearch<SEARCH_RESULT> {\r\n\tcreate( args: [ string ] ): void;\r\n\ton( event: \"success\", handler: ( e: unknown, searchResults: SEARCH_RESULT[] ) => void ): void;\r\n\ton( event: \"change\", handler: () => void ): void;\r\n\tisDone(): boolean;\r\n\tgetResult(): SEARCH_RESULT[] | null;\r\n}\r\n\r\nexport type DDialogSelectSearchFunction<SEARCH_RESULT> = ( word: string ) => Promise<SEARCH_RESULT[]>;\r\n\r\nexport interface DDialogSelectController<SEARCH_RESULT> {\r\n\tsearch: DDialogSelectSearch<SEARCH_RESULT> | DDialogSelectSearchFunction<SEARCH_RESULT>;\r\n}\r\n\r\nexport interface DDialogSelectNoteOptions {\r\n\tnoItems?: DNoteOptions;\r\n\tsearching?: DNoteOptions;\r\n}\r\n\r\nexport type DDialogSelectItemTextFormatter<SEARCH_RESULT> = ( result: SEARCH_RESULT, caller: any ) => string;\r\n\r\nexport interface DDialogSelectItemTextOptions<SEARCH_RESULT> {\r\n\tformatter?: DDialogSelectItemTextFormatter<SEARCH_RESULT>;\r\n}\r\n\r\nexport interface DDialogSelectItemOptions<SEARCH_RESULT> {\r\n\ttext?: DDialogSelectItemTextOptions<SEARCH_RESULT>;\r\n}\r\n\r\nexport interface DDialogSelectOptions<\r\n\tSEARCH_RESULT,\r\n\tTHEME extends DThemeDialogSelect = DThemeDialogSelect\r\n> extends DDialogCommandOptions<THEME> {\r\n\tcontroller?: DDialogSelectController<SEARCH_RESULT>;\r\n\titem?: DDialogSelectItemOptions<SEARCH_RESULT>;\r\n\tnote?: DDialogSelectNoteOptions;\r\n}\r\n\r\nexport interface DThemeDialogSelect extends DThemeDialogCommand {\r\n\tgetItemTextFormatter(): DDialogSelectItemTextFormatter<any>;\r\n\tgetNoteNoItemsText(): string;\r\n\tgetNoteSearchingText(): string;\r\n}\r\n\r\n// Helper\r\nconst toItemTextFormatter = <SEARCH_RESULT>(\r\n\ttheme: DThemeDialogSelect, options?: DDialogSelectOptions<SEARCH_RESULT, any>\r\n): DDialogSelectItemTextFormatter<SEARCH_RESULT> => {\r\n\tif( options ) {\r\n\t\tconst item = options.item;\r\n\t\tif( item ) {\r\n\t\t\tconst text = item.text;\r\n\t\t\tif( text ) {\r\n\t\t\t\treturn text.formatter || theme.getItemTextFormatter();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn theme.getItemTextFormatter();\r\n};\r\n\r\nconst toNoteOptions = ( options: DNoteOptions | undefined, parent: DBase, text: string ): DNoteOptions => {\r\n\tif( options != null ) {\r\n\t\tif( options.parent == null ) {\r\n\t\t\toptions.parent = parent;\r\n\t\t}\r\n\t\tif( options.text == null ) {\r\n\t\t\toptions.text = {\r\n\t\t\t\tvalue: text\r\n\t\t\t};\r\n\t\t} else if( options.text.value == null ) {\r\n\t\t\toptions.text.value = text;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\treturn {\r\n\t\tparent,\r\n\t\ttext: {\r\n\t\t\tvalue: text\r\n\t\t}\r\n\t};\r\n};\r\n\r\nconst toNoteNoItemsOptions = (\r\n\ttheme: DThemeDialogSelect, options: DDialogSelectOptions<any> | undefined, parent: DBase\r\n): DNoteOptions => {\r\n\tconst note = options && options.note;\r\n\treturn toNoteOptions(\r\n\t\tnote && note.noItems,\r\n\t\tparent,\r\n\t\ttheme.getNoteNoItemsText()\r\n\t);\r\n};\r\n\r\nconst toNoteSearchingOptions = (\r\n\ttheme: DThemeDialogSelect, options: DDialogSelectOptions<any> | undefined, parent: DBase\r\n): DNoteOptions => {\r\n\tconst note = options && options.note;\r\n\treturn toNoteOptions(\r\n\t\tnote && note.noItems,\r\n\t\tparent,\r\n\t\ttheme.getNoteSearchingText()\r\n\t);\r\n};\r\n\r\nconst toSearch = <SEARCH_RESULT>(\r\n\tcontroller?: DDialogSelectController<SEARCH_RESULT>\r\n): DDialogSelectSearch<SEARCH_RESULT> => {\r\n\tif( controller ) {\r\n\t\tconst search = controller.search;\r\n\t\tif( \"create\" in search ) {\r\n\t\t\treturn search;\r\n\t\t} else {\r\n\t\t\treturn new DDialogSelectSearh( search );\r\n\t\t}\r\n\t} else {\r\n\t\treturn new DDialogSelectSearh();\r\n\t}\r\n};\r\n\r\nexport class DDialogSelect<\r\n\tSEARCH_RESULT extends unknown = unknown,\r\n\tTHEME extends DThemeDialogSelect = DThemeDialogSelect,\r\n\tOPTIONS extends DDialogSelectOptions<SEARCH_RESULT, THEME> = DDialogSelectOptions<SEARCH_RESULT, THEME>\r\n> extends DDialogCommand<THEME, OPTIONS> {\r\n\tprotected _value!: SEARCH_RESULT | null;\r\n\tprotected _input!: DInputText;\r\n\tprotected _list!: DDialogSelectList;\r\n\tprotected _noteNoItems!: DNote;\r\n\tprotected _noteSearching!: DNote;\r\n\tprotected _itemTextFormatter!: DDialogSelectItemTextFormatter<SEARCH_RESULT>;\r\n\tprotected _search!: DDialogSelectSearch<SEARCH_RESULT>;\r\n\r\n\tprotected onInit( layout: DLayoutVertical, options?: OPTIONS ) {\r\n\t\tthis._value = null;\r\n\t\tconst theme = this.theme;\r\n\t\tthis._itemTextFormatter = toItemTextFormatter( theme, options );\r\n\r\n\t\t// Search box\r\n\t\tthis._input = new DInputText({\r\n\t\t\tparent: layout,\r\n\t\t\twidth: \"padding\"\r\n\t\t});\r\n\r\n\t\t// List\r\n\t\tconst list = this._list = new DDialogSelectList({\r\n\t\t\tparent: layout,\r\n\t\t\twidth: \"padding\",\r\n\t\t\tselection: {\r\n\t\t\t\ton: {\r\n\t\t\t\t\tchange: ( selection: DListSelection ): void => {\r\n\t\t\t\t\t\tconst item: DListItem<SEARCH_RESULT> | null = selection.first();\r\n\t\t\t\t\t\tif( item != null ) {\r\n\t\t\t\t\t\t\tthis._value = item.value;\r\n\t\t\t\t\t\t\tthis.onOk();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Text No Items\r\n\t\tconst noteNoItems = new DNote( toNoteNoItemsOptions( theme, options, list ) );\r\n\t\tthis._noteNoItems = noteNoItems;\r\n\r\n\t\t// Text Searching\r\n\t\tconst noteSearching = new DNote( toNoteSearchingOptions( theme, options, list ) );\r\n\t\tthis._noteSearching = noteSearching;\r\n\r\n\t\t// Controller binding\r\n\t\tconst search = toSearch( options && options.controller );\r\n\t\tthis._search = search;\r\n\t\tthis._input.on( \"input\", ( value: string ): void => {\r\n\t\t\tsearch.create([ value ]);\r\n\t\t});\r\n\r\n\t\tsearch.on( \"success\", ( e: unknown, results: SEARCH_RESULT[] ): void => {\r\n\t\t\tthis.onSearched( results );\r\n\t\t});\r\n\r\n\t\t// Visibility\r\n\t\tconst transition = new UtilTransition();\r\n\t\tsearch.on( \"change\", (): void => {\r\n\t\t\tif( search.isDone() ) {\r\n\t\t\t\tconst result = search.getResult();\r\n\t\t\t\tif( result != null && 0 < result.length ) {\r\n\t\t\t\t\ttransition.hide();\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttransition.show( noteNoItems );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttransition.show( noteSearching );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected onSearched( results: SEARCH_RESULT[] ): void {\r\n\t\tconst list = this._list;\r\n\t\tconst itemTextFormatter = this._itemTextFormatter;\r\n\t\tconst content = list.content;\r\n\t\tconst children = content.children;\r\n\r\n\t\t// Update the existing children\r\n\t\tconst childrenLength = children.length;\r\n\t\tconst searchResultsLength = results.length;\r\n\t\tconst minLength = Math.min( childrenLength, searchResultsLength );\r\n\t\tfor( let i = 0, imax = minLength; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tconst result = results[ i ];\r\n\t\t\tif( child instanceof DListItem ) {\r\n\t\t\t\tchild.text = itemTextFormatter( result, this );\r\n\t\t\t\tchild.value = result;\r\n\t\t\t} else {\r\n\t\t\t\tcontent.removeChildAt( i );\r\n\t\t\t\tchild.destroy();\r\n\t\t\t\tconst newChild = this.newItem( result, itemTextFormatter( result, this ) );\r\n\t\t\t\tcontent.addChildAt( newChild, i );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Insert new children\r\n\t\tfor( let i = minLength, imax = searchResultsLength; i < imax; ++i ) {\r\n\t\t\tconst result = results[ i ];\r\n\t\t\tconst newChild = this.newItem( result, itemTextFormatter( result, this ) );\r\n\t\t\tcontent.addChild( newChild );\r\n\t\t}\r\n\r\n\t\t// Remove unused children\r\n\t\tfor( let i = childrenLength - 1; minLength <= i; --i ) {\r\n\t\t\tchildren[ i ].destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newItem( result: SEARCH_RESULT, label: string ): DDialogSelectListItem<SEARCH_RESULT> {\r\n\t\treturn new DDialogSelectListItem<SEARCH_RESULT>({\r\n\t\t\tvalue: result,\r\n\t\t\ttext: {\r\n\t\t\t\tvalue: label\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tget value() {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogSelect\";\r\n\t}\r\n\r\n\tprotected onOpen() {\r\n\t\tsuper.onOpen();\r\n\t\tthis._list.selection.clear();\r\n\t\tthis._search.create([ this._input.value ]);\r\n\t}\r\n\tprotected onOk() {\r\n\t\tthis.emit( \"select\", this._value, this );\r\n\t\tsuper.onOk();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._input.destroy();\r\n\t\tthis._noteNoItems.destroy();\r\n\t\tthis._noteSearching.destroy();\r\n\t\tthis._list.destroy();\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOnOptions, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DDialogSelect, DDialogSelectOptions } from \"./d-dialog-select\";\r\n\r\n/**\r\n * A dialog to select values.\r\n */\r\nexport interface DButtonSelectDialog<VALUE> {\r\n\treadonly value: VALUE | null;\r\n\topen(): Promise<void>;\r\n}\r\n\r\n/**\r\n * A function to retrieve a selected value from a dialog.\r\n */\r\nexport type DButtonSelectGetter<VALUE, DIALOG> = ( dialog: DIALOG ) => VALUE | null;\r\n\r\n/**\r\n * A function to set a selecte value to a dialog.\r\n * Called before opening a dialog.\r\n */\r\nexport type DButtonSelectSetter<VALUE, DIALOG> = ( dialog: DIALOG, value: VALUE | null ) => void;\r\n\r\n/**\r\n * Mappings of event names and handlers.\r\n */\r\nexport interface DButtonSelectOnOptions<VALUE> extends DButtonOnOptions<VALUE> {\r\n\t/**\r\n\t * Triggered when a selection is changed.\r\n\t *\r\n\t * @param newValue a newly selected value\r\n\t * @param oldValue a previously selected value\r\n\t * @param self a button\r\n\t */\r\n\tchange?: ( newValue: VALUE | null, oldValue: VALUE | null, self: any ) => void;\r\n}\r\n\r\nexport interface DButtonSelectOptions<\r\n\tVALUE extends unknown = unknown,\r\n\tDIALOG_VALUE extends unknown = unknown,\r\n\tDIALOG extends DButtonSelectDialog<DIALOG_VALUE> = DButtonSelectDialog<DIALOG_VALUE>,\r\n\tTHEME extends DThemeButtonSelect = DThemeButtonSelect\r\n> extends DButtonOptions<VALUE | null, THEME> {\r\n\t/**\r\n\t * A function to retrieve a selected value from a dialog.\r\n\t */\r\n\tgetter?: DButtonSelectGetter<VALUE, DIALOG>;\r\n\r\n\t/**\r\n\t * A function to set a selected value to a dialog.\r\n\t * Called before opening a dialog.\r\n\t */\r\n\tsetter?: DButtonSelectSetter<VALUE, DIALOG>;\r\n\r\n\t/**\r\n\t * A dialog to select values.\r\n\t */\r\n\tdialog?: DDialogSelectOptions<DIALOG_VALUE> | DIALOG;\r\n\r\n\ton?: DButtonSelectOnOptions<VALUE>;\r\n}\r\n\r\nexport interface DThemeButtonSelect extends DThemeButton {\r\n\tgetTextFormatter(): ( value: unknown | null, caller: DButtonSelect ) => string;\r\n\tgetTextValue( state: DBaseState ): unknown | null;\r\n\tnewTextValue(): unknown | null;\r\n}\r\n\r\nconst defaultGetter = ( dialog: DButtonSelectDialog<any> ): any => {\r\n\t// Assumes the dialog.value is VALUE.\r\n\treturn dialog.value;\r\n};\r\n\r\nconst defaultSetter = (): void => {\r\n\t// DO NOTHING\r\n};\r\n\r\nexport class DButtonSelect<\r\n\tVALUE extends unknown = unknown,\r\n\tDIALOG_VALUE extends unknown = unknown,\r\n\tDIALOG extends DButtonSelectDialog<DIALOG_VALUE> = DButtonSelectDialog<DIALOG_VALUE>,\r\n\tTHEME extends DThemeButtonSelect = DThemeButtonSelect,\r\n\tOPTIONS extends DButtonSelectOptions<VALUE, DIALOG_VALUE, DIALOG, THEME>\r\n\t\t= DButtonSelectOptions<VALUE, DIALOG_VALUE, DIALOG, THEME>\r\n> extends DButton<VALUE | null, THEME, OPTIONS> {\r\n\tprotected _dialog?: DIALOG;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( this.toOptions( options ) );\r\n\r\n\t\tconst getter: DButtonSelectGetter<VALUE, DIALOG> = (options && options.getter) || defaultGetter;\r\n\t\tconst setter: DButtonSelectSetter<VALUE, DIALOG> = (options && options.setter) || defaultSetter;\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst dialog = this.dialog;\r\n\t\t\tsetter( dialog, this._textValueComputed );\r\n\t\t\tdialog.open().then((): void => {\r\n\t\t\t\tconst newValue = getter( dialog );\r\n\t\t\t\tconst oldValue = this._textValueComputed;\r\n\t\t\t\tif( newValue !== oldValue ) {\r\n\t\t\t\t\tthis.text = newValue;\r\n\t\t\t\t\tthis.emit( \"change\", newValue, oldValue, this );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tget dialog(): DIALOG {\r\n\t\tlet dialog = this._dialog;\r\n\t\tif( dialog == null ) {\r\n\t\t\tconst options = this._options;\r\n\t\t\tconst dialogOptions = options && options.dialog;\r\n\t\t\tif( dialogOptions && (\"open\" in dialogOptions) ) {\r\n\t\t\t\tdialog = dialogOptions;\r\n\t\t\t} else {\r\n\t\t\t\t// Assumes DIALOG === DDialogSelect<DIALOG_VALUE>.\r\n\t\t\t\tdialog = new DDialogSelect<DIALOG_VALUE>( dialogOptions ) as unknown as DIALOG;\r\n\t\t\t}\r\n\t\t\tthis._dialog = dialog;\r\n\t\t}\r\n\t\treturn dialog;\r\n\t}\r\n\r\n\tprotected toOptions( options?: OPTIONS ): OPTIONS | undefined {\r\n\t\tif( options ) {\r\n\t\t\t// Try to copy text.formatter to dialog.item.text.formatter at first\r\n\t\t\tconst formatter = options.text?.formatter;\r\n\t\t\tif( formatter !== undefined ) {\r\n\t\t\t\tlet dialog = options.dialog;\r\n\t\t\t\tif( ! (dialog && \"open\" in dialog) ) {\r\n\t\t\t\t\tdialog = dialog || {};\r\n\t\t\t\t\tconst item = dialog.item = dialog.item || {};\r\n\t\t\t\t\tconst text = item.text = item.text || {};\r\n\t\t\t\t\tif( text.formatter === undefined ) {\r\n\t\t\t\t\t\t// Assumes formatter is ( value: DIALOG_VALUE | null, caller: any ) => string.\r\n\t\t\t\t\t\ttext.formatter = formatter as any;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// Try to copy dialog.item.text.formatter to text.formatter\r\n\t\t\t\tconst dialog = options.dialog;\r\n\t\t\t\tif( ! (dialog && \"open\" in dialog) ) {\r\n\t\t\t\t\tconst dialogFormatter = dialog?.item?.text?.formatter;\r\n\t\t\t\t\tif( dialogFormatter !== undefined ) {\r\n\t\t\t\t\t\tconst text = options.text = options.text || {};\r\n\t\t\t\t\t\tif( text.formatter === undefined ) {\r\n\t\t\t\t\t\t\t// Assumes dialogFormatter is ( value: VALUE | null, caller: any ) => string.\r\n\t\t\t\t\t\t\ttext.formatter = dialogFormatter as any;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tget value(): VALUE | null {\r\n\t\treturn this._textValueComputed;\r\n\t}\r\n\r\n\tset value( value: VALUE | null ) {\r\n\t\tthis.text = value;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonSelect\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DPickerTime, DPickerTimeOptions } from \"./d-picker-time\";\r\n\r\nexport interface DDialogTimeOptions<\r\n\tTHEME extends DThemeDialogTime = DThemeDialogTime\r\n> extends DDialogCommandOptions<THEME> {\r\n\tpicker?: DPickerTimeOptions;\r\n}\r\n\r\nexport interface DThemeDialogTime extends DThemeDialogCommand {\r\n\r\n}\r\n\r\nexport class DDialogTime<\r\n\tTHEME extends DThemeDialogTime = DThemeDialogTime,\r\n\tOPTIONS extends DDialogTimeOptions<THEME> = DDialogTimeOptions<THEME>\r\n> extends DDialogCommand<THEME, OPTIONS> {\r\n\tprotected _picker!: DPickerTime;\r\n\r\n\tprotected onInit( layout: DLayoutVertical, options?: OPTIONS ) {\r\n\t\tsuper.onInit( layout, options );\r\n\r\n\t\tconst picker = new DPickerTime( options && options.picker );\r\n\t\tthis._picker = picker;\r\n\t\tlayout.addChild( picker );\r\n\t}\r\n\r\n\tget current(): Date {\r\n\t\treturn this._picker.current;\r\n\t}\r\n\r\n\tset current( dateCurrent: Date ) {\r\n\t\tthis._picker.current = dateCurrent;\r\n\t}\r\n\r\n\tget new(): Date {\r\n\t\treturn this._picker.new;\r\n\t}\r\n\r\n\tset new( dateNew: Date ) {\r\n\t\tthis._picker.new = dateNew;\r\n\t}\r\n\r\n\tget picker(): DPickerTime {\r\n\t\treturn this._picker;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogTime\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogTime } from \"./d-dialog-time\";\r\n\r\nexport class DDialogTimes {\r\n\tprotected static INSTANCE?: DDialogTime;\r\n\tstatic getInstance(): DDialogTime {\r\n\t\tif( DDialogTimes.INSTANCE == null ) {\r\n\t\t\tDDialogTimes.INSTANCE = new DDialogTime();\r\n\t\t}\r\n\t\treturn DDialogTimes.INSTANCE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOnOptions, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DDialogTime, DDialogTimeOptions } from \"./d-dialog-time\";\r\nimport { DDialogTimes } from \"./d-dialog-times\";\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerTimes } from \"./d-picker-times\";\r\n\r\n/**\r\n * Mappings of event names and handlers.\r\n */\r\nexport interface DButtonTimeOnOptions extends DButtonOnOptions<Date> {\r\n\t/**\r\n\t * Triggered when a selection is changed.\r\n\t *\r\n\t * @param self a button\r\n\t */\r\n\tchange?: ( newValue: Date, oldValue: Date, self: any ) => void;\r\n}\r\n\r\nexport interface DButtonTimeOptions<\r\n\tTHEME extends DThemeButtonTime = DThemeButtonTime\r\n> extends DButtonOptions<Date, THEME> {\r\n\tdialog?: DDialogTimeOptions;\r\n\ton?: DButtonTimeOnOptions;\r\n}\r\n\r\nexport interface DThemeButtonTime extends DThemeButton {\r\n\tgetTextFormatter(): ( value: Date, caller: DButtonTime ) => string;\r\n\tgetTextValue( state: DBaseState ): Date;\r\n\tnewTextValue(): Date;\r\n}\r\n\r\nexport class DButtonTime<\r\n\tTHEME extends DThemeButtonTime = DThemeButtonTime,\r\n\tOPTIONS extends DButtonTimeOptions<THEME> = DButtonTimeOptions<THEME>\r\n> extends DButton<Date, THEME, OPTIONS> {\r\n\tprotected _dialog?: DDialogTime;\r\n\tprotected _dialogOptions?: DDialogTimeOptions;\r\n\tprotected _datetimeMask!: DPickerDatetimeMask;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tthis._dialogOptions = options && options.dialog;\r\n\t\tthis._datetimeMask = DPickerTimes.toMask( options && options.dialog && options.dialog.picker );\r\n\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst currentTime = this._textValueComputed.getTime();\r\n\t\t\tconst dialog = this.dialog;\r\n\t\t\tdialog.current = new Date( currentTime );\r\n\t\t\tdialog.new = new Date( currentTime );\r\n\t\t\tdialog.open().then((): void => {\r\n\t\t\t\tconst dateNew = dialog.new;\r\n\t\t\t\tconst dateCurrent = dialog.current;\r\n\t\t\t\tthis.text = new Date( dateNew.getTime() );\r\n\t\t\t\tthis.emit( \"change\", dateNew, dateCurrent, this );\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tgetDatetimeMask(): DPickerDatetimeMask {\r\n\t\treturn this._datetimeMask;\r\n\t}\r\n\r\n\tget dialog(): DDialogTime {\r\n\t\tlet dialog = this._dialog;\r\n\t\tif( dialog == null ) {\r\n\t\t\tconst dialogOptions = this._dialogOptions;\r\n\t\t\tif( dialogOptions != null ) {\r\n\t\t\t\tdialog = new DDialogTime( this._dialogOptions );\r\n\t\t\t} else {\r\n\t\t\t\tdialog = DDialogTimes.getInstance();\r\n\t\t\t}\r\n\t\t\tthis._dialog = dialog;\r\n\t\t}\r\n\t\treturn dialog;\r\n\t}\r\n\r\n\tget value(): Date {\r\n\t\treturn this._textValueComputed;\r\n\t}\r\n\r\n\tset value( value: Date ) {\r\n\t\tif( this._textValueComputed.getTime() !== value.getTime() ) {\r\n\t\t\tthis.text = value;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DButtonTime\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DControllers } from \"./d-controllers\";\r\n\r\nexport class DButtonUndo<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeButton = DThemeButton,\r\n\tOPTIONS extends DButtonOptions<VALUE, THEME> = DButtonOptions<VALUE, THEME>\r\n> extends DButton<VALUE, THEME, OPTIONS> {\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\r\n\t\tconst commandController = DControllers.getCommandController();\r\n\t\tthis.setState( DBaseState.DISABLED, ! commandController.isUndoable() );\r\n\t\tcommandController.on( \"change\", () => {\r\n\t\t\tthis.setState( DBaseState.DISABLED, ! commandController.isUndoable() );\r\n\t\t});\r\n\r\n\t\tthis.on( \"active\", () => {\r\n\t\t\tcommandController.undo();\r\n\t\t});\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase,  DBaseOptions, DThemeBase } from \"./d-base\";\r\n\r\nexport interface DCanvasOptions<THEME extends DThemeCanvas = DThemeCanvas> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeCanvas extends DThemeBase {\r\n\r\n}\r\n\r\nexport class DCanvas<\r\n\tTHEME extends DThemeCanvas = DThemeCanvas,\r\n\tOPTIONS extends DCanvasOptions<THEME> = DCanvasOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DCanvas\";\r\n\t}\r\n}\r\n","import { isNumber } from \"../util/is-number\";\r\nimport { isString } from \"../util/is-string\";\r\nimport { EShapePointsStyle } from \"./e-shape-points-style\";\r\n\r\nexport type EShapePointsStyleOption = EShapePointsStyle | keyof typeof EShapePointsStyle |\r\n\tArray<keyof typeof EShapePointsStyle>;\r\n\r\nexport class EShapePointsStyles {\r\n\tstatic from( style: EShapePointsStyleOption ): EShapePointsStyle {\r\n\t\tif( isString( style ) ) {\r\n\t\t\treturn EShapePointsStyle[ style ];\r\n\t\t} else if( isNumber( style ) ) {\r\n\t\t\treturn style;\r\n\t\t} else {\r\n\t\t\tlet result = EShapePointsStyle.NONE;\r\n\t\t\tfor( let i = 0, imax = style.length; i < imax; ++i ) {\r\n\t\t\t\tresult |= EShapePointsStyle[ style[ i ] ];\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\r\nimport { DChartCoordinateTransform } from \"./d-chart-coordinate-transform\";\r\n\r\nexport enum DChartCoordinateDirection {\r\n\tX,\r\n\tY\r\n}\r\n\r\nexport interface DChartCoordinate {\r\n\t/**\r\n\t * Monotonic increasing ID for change detection.\r\n\t */\r\n\treadonly id: number;\r\n\treadonly transform: DChartCoordinateTransform;\r\n\r\n\tbind( container: DChartCoordinateContainerSub, direction: DChartCoordinateDirection ): void;\r\n\tunbind(): void;\r\n\r\n\t/**\r\n\t * Adjusts the transform so that mapped points of the given range fit into the plot area\r\n\t * if the plot area container's localTransform is an identity matrix.\r\n\t *\r\n\t * @param from a lower end of the range\r\n\t * @param to an upper end of the range\r\n\t */\r\n\tfit( from?: number, to?: number ): void;\r\n\r\n\tmark( from?: number, to?: number ): void;\r\n\r\n\tblend( ratio: number ): void;\r\n\r\n\t/**\r\n\t * Transforms the given raw value to the untransformed value.\r\n\t *\r\n\t * @param value a raw value\r\n\t */\r\n\tmap( value: number ): number;\r\n\r\n\t/**\r\n\t * Transforms the given raw values to untransformed values.\r\n\t * Numbers whose indices are ifrom + i * stride + offset and less than iend will be transformed.\r\n\t * Here, i is a non-negative integer.\r\n\t *\r\n\t * @param values raw values to be transformed\r\n\t * @param ifrom an index on raw values at which to begin a transformation\r\n\t * @param iend an index on raw values before which to end a transformation\r\n\t * @param stride a stride of indices\r\n\t * @param offset an offset of indices\r\n\t */\r\n\tmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void;\r\n\r\n\t/**\r\n\t * Transforms the given untransformed value to the raw value.\r\n\t *\r\n\t * @param value an untransformed value\r\n\t */\r\n\tunmap( value: number ): number;\r\n\r\n\t/**\r\n\t * Transforms the given untransformed values to raw values.\r\n\t * Numbers whose indices are ifrom + i * stride + offset and less than iend will be transformed.\r\n\t * Here, i is a non-negative integer.\r\n\t *\r\n\t * @param values untrasformed values to be transformed\r\n\t * @param ifrom an index on raw values at which to begin a transformation\r\n\t * @param iend an index on raw values at which to begin a transformation\r\n\t * @param stride a stride of indices\r\n\t * @param offset an offset of indices\r\n\t */\r\n\tunmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void;\r\n\r\n\t/**\r\n\t * Returns major / minor tick positions.\r\n\t *\r\n\t * @param domainMin minimum domain\r\n\t * @param domainMax maximum domain\r\n\t * @param majorCount Expected major tick count\r\n\t * @param minorCountPerMajor Expected minor tick count per major ticks\r\n\t * @param minorCount Expected total minor tick count\r\n\t * @param majorResult `majorResult.length` must be larger than `majorCount * 3`.\r\n\t * @param minorResult `minorResult.length` must be larger than `minorCount * 3`.\r\n\t */\r\n\tticks(\r\n\t\tdomainMin: number,\r\n\t\tdomainMax: number,\r\n\t\tmajorCount: number,\r\n\t\tminorCountPerMajor: number,\r\n\t\tminorCount: number,\r\n\t\tmajorResult: Float64Array,\r\n\t\tminorResult: Float64Array\r\n\t): void;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {\r\n\tDChartAxisBaseOptions, DChartAxisBaseTickContainerOptions,\r\n\tDChartAxisBaseTickMajorGridlineOptions, DChartAxisBaseTickMajorOptions,\r\n\tDChartAxisBaseTickMajorTextOptions, DThemeChartAxisBase\r\n} from \"./d-chart-axis-base-options\";\r\nimport { DChartAxisPosition } from \"./d-chart-axis-position\";\r\nimport { DChartAxisTickPosition } from \"./d-chart-axis-tick-position\";\r\nimport { EShapePointsStyle } from \"./shape/e-shape-points-style\";\r\nimport { EShapePointsStyleOption, EShapePointsStyles } from \"./shape/e-shape-points-styles\";\r\nimport { EShapeStrokeLike } from \"./shape/e-shape-stroke\";\r\nimport { EShapeStrokeSide } from \"./shape/e-shape-stroke-side\";\r\nimport { EShapeTextLike } from \"./shape/e-shape-text\";\r\nimport { EShapeTextAlignLike } from \"./shape/e-shape-text-align\";\r\nimport { EShapeTextDirection } from \"./shape/e-shape-text-direction\";\r\nimport { EShapeTextOffsetLike } from \"./shape/e-shape-text-offset\";\r\nimport { EShapeTextOutlineLike } from \"./shape/e-shape-text-outline\";\r\nimport { EShapeBar } from \"./shape/variant/e-shape-bar\";\r\nimport { EShapeBarPosition } from \"./shape/variant/e-shape-bar-position\";\r\nimport { DeepPartial } from \"./util/deep-partial\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { NumberFormatter } from \"./util/number-formatter\";\r\nimport { NumberFormatters } from \"./util/number-formatters\";\r\n\r\nexport interface DChartAxisBaseGridline {\r\n\tenable: boolean;\r\n\tstyle: EShapePointsStyle;\r\n\tstroke?: Partial<EShapeStrokeLike>;\r\n\tshapes?: EShapeBar[];\r\n}\r\n\r\nexport interface DChartAxisBaseTickMajor {\r\n\tcount: number;\r\n\tsize: number;\r\n\tposition: EShapeBarPosition;\r\n\tstyle: EShapePointsStyle;\r\n\tstroke?: Partial<EShapeStrokeLike>;\r\n\ttext?: DChartAxisBaseTickMajorTextOptions;\r\n\tformatter: NumberFormatter;\r\n\tshapes?: EShapeBar[];\r\n\r\n\tgridline: DChartAxisBaseGridline;\r\n}\r\n\r\nexport interface DChartAxisBaseTickMinor {\r\n\tcount: number;\r\n\tsize: number;\r\n\tposition: EShapeBarPosition;\r\n\tstyle: EShapePointsStyle;\r\n\tstroke?: Partial<EShapeStrokeLike>;\r\n\tshapes?: EShapeBar[];\r\n}\r\n\r\nexport interface DChartAxisBaseBar {\r\n\tstyle: EShapePointsStyle;\r\n\tstroke?: Partial<EShapeStrokeLike>;\r\n\tshape?: EShapeBar;\r\n}\r\n\r\nexport interface DChartAxisBaseTickContainer {\r\n\tenable: boolean;\r\n\tmajor: DChartAxisBaseTickMajor;\r\n\tminor: DChartAxisBaseTickMinor;\r\n}\r\n\r\nexport class DChartAxisBaseOptionParser {\r\n\tprotected _coordinateIndex: number;\r\n\tprotected _position: DChartAxisPosition;\r\n\tprotected _tick: DChartAxisBaseTickContainer;\r\n\tprotected _label: DeepPartial<EShapeTextLike> | undefined;\r\n\tprotected _padding: number;\r\n\tprotected _bar: DChartAxisBaseBar;\r\n\r\n\tconstructor( theme: DThemeChartAxisBase, options?: DChartAxisBaseOptions ) {\r\n\t\tthis._coordinateIndex = ( options && options.coordinate != null ? options.coordinate : 0 );\r\n\t\tthis._position = this.toPosition( theme, options );\r\n\t\tthis._tick = this.toTickContainer( theme, options );\r\n\t\tthis._label = this.toLabel( theme, options );\r\n\t\tthis._padding = ( options && options.padding != null ? options.padding : theme.getPadding() );\r\n\t\tthis._bar = this.toBar( theme, options );\r\n\t}\r\n\r\n\tget coordinateIndex(): number {\r\n\t\treturn this._coordinateIndex;\r\n\t}\r\n\r\n\tget padding(): number {\r\n\t\treturn this._padding;\r\n\t}\r\n\r\n\tget position(): DChartAxisPosition {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tget bar(): DChartAxisBaseBar {\r\n\t\treturn this._bar;\r\n\t}\r\n\r\n\tget tick(): DChartAxisBaseTickContainer {\r\n\t\treturn this._tick;\r\n\t}\r\n\r\n\tget label(): DeepPartial<EShapeTextLike> | undefined {\r\n\t\treturn this._label;\r\n\t}\r\n\r\n\tprotected toPosition(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: DChartAxisBaseOptions\r\n\t): DChartAxisPosition {\r\n\t\tconst position = options && options.position;\r\n\t\tif( isString( position ) ) {\r\n\t\t\treturn DChartAxisPosition[ position ];\r\n\t\t} else if( position != null ) {\r\n\t\t\treturn position;\r\n\t\t}\r\n\t\treturn theme.getPosition();\r\n\t}\r\n\r\n\tprotected toBar(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: DChartAxisBaseOptions\r\n\t): DChartAxisBaseBar {\r\n\t\treturn {\r\n\t\t\tstyle: options && options.style != null ? options.style : theme.getStyle(),\r\n\t\t\tstroke: this.toBarStroke( theme, options && options.stroke ),\r\n\t\t\tshape: undefined\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toTickContainer(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: DChartAxisBaseOptions\r\n\t): DChartAxisBaseTickContainer {\r\n\t\tconst tick = options && options.tick;\r\n\t\treturn {\r\n\t\t\tenable: ( tick && tick.enable != null ? tick.enable : theme.getTickEnable() ),\r\n\t\t\tmajor: this.toTickMajor( theme, tick ),\r\n\t\t\tminor: this.toMinorTick( theme, tick )\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toTickMajor(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: DChartAxisBaseTickContainerOptions\r\n\t): DChartAxisBaseTickMajor {\r\n\t\tconst major: DChartAxisBaseTickMajorOptions | undefined = options && options.major;\r\n\t\tconst position = ( major && major.position != null ? major.position :\r\n\t\t\t( options && options.position != null ? options.position : theme.getMajorTickPosition() )\r\n\t\t);\r\n\t\tconst optionsStyle = options && options.style;\r\n\t\tconst style = EShapePointsStyles.from( major && major.style != null ? major.style :\r\n\t\t\t( optionsStyle != null ? optionsStyle : theme.getMajorTickStyle() )\r\n\t\t);\r\n\t\tconst optionsStroke = options && options.stroke;\r\n\t\tconst stroke = this.toTickMajorStroke( theme, major && major.stroke, optionsStroke );\r\n\t\treturn {\r\n\t\t\tcount: ( major && major.count != null ? major.count : theme.getMajorTickCount() ),\r\n\t\t\tsize: ( major && major.size != null ? major.size : theme.getMajorTickSize() ),\r\n\t\t\tposition: this.toTickPosition( position ),\r\n\t\t\tstyle,\r\n\t\t\tstroke,\r\n\t\t\ttext: this.toMajorTickText( theme, major && major.text ),\r\n\t\t\tformatter: this.toMajorTickFormatter( theme, major ),\r\n\t\t\tshapes: undefined,\r\n\t\t\tgridline: this.toTickMajorGridline( theme, major && major.gridline, optionsStyle, optionsStroke )\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toTickMajorGridline(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions: DChartAxisBaseTickMajorGridlineOptions | undefined,\r\n\t\toptionsStyle: EShapePointsStyleOption | undefined,\r\n\t\toptionsStroke: Partial<EShapeStrokeLike> | undefined\r\n\t): DChartAxisBaseGridline {\r\n\t\tconst style = EShapePointsStyles.from( options && options.style != null ? options.style :\r\n\t\t\t( optionsStyle != null ? optionsStyle : theme.getMajorTickGridlineStyle() )\r\n\t\t);\r\n\t\treturn {\r\n\t\t\tenable: options && options.enable != null ? options.enable : theme.getMajorTickGridlineEnable(),\r\n\t\t\tstyle,\r\n\t\t\tstroke: this.toTickMajorGridlineStroke( theme, options && options.stroke, optionsStroke ),\r\n\t\t\tshapes: undefined\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toTickPosition(\r\n\t\ttickPosition: DChartAxisTickPosition | keyof typeof DChartAxisTickPosition\r\n\t): EShapeBarPosition {\r\n\t\tconst position = this._position;\r\n\t\tif( tickPosition === DChartAxisTickPosition.OUTSIDE || tickPosition === \"OUTSIDE\" ) {\r\n\t\t\tswitch( position ) {\r\n\t\t\tcase DChartAxisPosition.TOP:\r\n\t\t\t\treturn EShapeBarPosition.BOTTOM;\r\n\t\t\tcase DChartAxisPosition.BOTTOM:\r\n\t\t\t\treturn EShapeBarPosition.TOP;\r\n\t\t\tcase DChartAxisPosition.LEFT:\r\n\t\t\t\treturn EShapeBarPosition.RIGHT;\r\n\t\t\tcase DChartAxisPosition.RIGHT:\r\n\t\t\t\treturn EShapeBarPosition.LEFT;\r\n\t\t\tdefault:\r\n\t\t\t\treturn EShapeBarPosition.TOP;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tswitch( position ) {\r\n\t\t\tcase DChartAxisPosition.TOP:\r\n\t\t\t\treturn EShapeBarPosition.TOP;\r\n\t\t\tcase DChartAxisPosition.BOTTOM:\r\n\t\t\t\treturn EShapeBarPosition.BOTTOM;\r\n\t\t\tcase DChartAxisPosition.LEFT:\r\n\t\t\t\treturn EShapeBarPosition.LEFT;\r\n\t\t\tcase DChartAxisPosition.RIGHT:\r\n\t\t\t\treturn EShapeBarPosition.RIGHT;\r\n\t\t\tdefault:\r\n\t\t\t\treturn EShapeBarPosition.TOP;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toMinorTick(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: DChartAxisBaseTickContainerOptions\r\n\t): DChartAxisBaseTickMinor {\r\n\t\tconst minor: DChartAxisBaseTickMajorOptions | undefined = options && options.major;\r\n\t\tconst position = ( minor && minor.position != null ? minor.position :\r\n\t\t\t( options && options.position != null ? options.position : theme.getMinorTickPosition() )\r\n\t\t);\r\n\t\tconst style = EShapePointsStyles.from( minor && minor.style != null ? minor.style :\r\n\t\t\t( options && options.style != null ? options.style : theme.getMinorTickStyle() )\r\n\t\t);\r\n\t\treturn {\r\n\t\t\tcount: ( minor && minor.count != null ? minor.count : theme.getMinorTickCount() ),\r\n\t\t\tsize: ( minor && minor.size != null ? minor.size : theme.getMinorTickSize() ),\r\n\t\t\tposition: this.toTickPosition( position ),\r\n\t\t\tstyle,\r\n\t\t\tstroke: this.toTickMinorStroke( theme, minor && minor.stroke, options && options.stroke ),\r\n\t\t\tshapes: undefined\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toBarStroke(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeStrokeLike>\r\n\t): EShapeStrokeLike {\r\n\t\treturn this.toStroke(\r\n\t\t\toptions, undefined,\r\n\t\t\ttheme.getStrokeEnable(),\r\n\t\t\ttheme.getStrokeColor(),\r\n\t\t\ttheme.getStrokeAlpha(),\r\n\t\t\ttheme.getStrokeWidth(),\r\n\t\t\ttheme.getStrokeAlign(),\r\n\t\t\ttheme.getStrokeSide()\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toTickMajorStroke(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptionsA?: Partial<EShapeStrokeLike>,\r\n\t\toptionsB?: Partial<EShapeStrokeLike>\r\n\t): EShapeStrokeLike {\r\n\t\treturn this.toStroke(\r\n\t\t\toptionsA, optionsB,\r\n\t\t\ttheme.getMajorTickStrokeEnable(),\r\n\t\t\ttheme.getMajorTickStrokeColor(),\r\n\t\t\ttheme.getMajorTickStrokeAlpha(),\r\n\t\t\ttheme.getMajorTickStrokeWidth(),\r\n\t\t\ttheme.getMajorTickStrokeAlign(),\r\n\t\t\ttheme.getMajorTickStrokeSide()\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toTickMajorGridlineStroke(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptionsA?: Partial<EShapeStrokeLike>,\r\n\t\toptionsB?: Partial<EShapeStrokeLike>\r\n\t): EShapeStrokeLike {\r\n\t\treturn this.toStroke(\r\n\t\t\toptionsA, optionsB,\r\n\t\t\ttheme.getMajorTickGridlineStrokeEnable(),\r\n\t\t\ttheme.getMajorTickGridlineStrokeColor(),\r\n\t\t\ttheme.getMajorTickGridlineStrokeAlpha(),\r\n\t\t\ttheme.getMajorTickGridlineStrokeWidth(),\r\n\t\t\ttheme.getMajorTickGridlineStrokeAlign(),\r\n\t\t\ttheme.getMajorTickGridlineStrokeSide()\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toTickMinorStroke(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptionsA?: Partial<EShapeStrokeLike>,\r\n\t\toptionsB?: Partial<EShapeStrokeLike>\r\n\t): EShapeStrokeLike {\r\n\t\treturn this.toStroke(\r\n\t\t\toptionsA, optionsB,\r\n\t\t\ttheme.getMinorTickStrokeEnable(),\r\n\t\t\ttheme.getMinorTickStrokeColor(),\r\n\t\t\ttheme.getMinorTickStrokeAlpha(),\r\n\t\t\ttheme.getMinorTickStrokeWidth(),\r\n\t\t\ttheme.getMinorTickStrokeAlign(),\r\n\t\t\ttheme.getMinorTickStrokeSide()\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toStroke(\r\n\t\toptionsA: Partial<EShapeStrokeLike> | undefined,\r\n\t\toptionsB: Partial<EShapeStrokeLike> | undefined,\r\n\t\tenable: boolean,\r\n\t\tcolor: number,\r\n\t\talpha: number,\r\n\t\twidth: number,\r\n\t\talign: number,\r\n\t\tside: EShapeStrokeSide\r\n\t): EShapeStrokeLike {\r\n\t\tif( optionsA ) {\r\n\t\t\tif( optionsB ) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tenable: ( optionsA.enable != null ? optionsA.enable :\r\n\t\t\t\t\t\t( optionsB.enable != null ? optionsB.enable : enable )\r\n\t\t\t\t\t),\r\n\t\t\t\t\tcolor: ( optionsA.color != null ? optionsA.color :\r\n\t\t\t\t\t\t( optionsB.color != null ? optionsB.color : color )\r\n\t\t\t\t\t),\r\n\t\t\t\t\talpha: ( optionsA.alpha != null ? optionsA.alpha :\r\n\t\t\t\t\t\t( optionsB.alpha != null ? optionsB.alpha : alpha )\r\n\t\t\t\t\t),\r\n\t\t\t\t\twidth: ( optionsA.width != null ? optionsA.width :\r\n\t\t\t\t\t\t( optionsB.width != null ? optionsB.width : width )\r\n\t\t\t\t\t),\r\n\t\t\t\t\talign: ( optionsA.align != null ? optionsA.align :\r\n\t\t\t\t\t\t( optionsB.align != null ? optionsB.align : align )\r\n\t\t\t\t\t),\r\n\t\t\t\t\tside: ( optionsA.side != null ? optionsA.side :\r\n\t\t\t\t\t\t( optionsB.side != null ? optionsB.side : side )\r\n\t\t\t\t\t)\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tenable: ( optionsA.enable != null ? optionsA.enable : enable ),\r\n\t\t\t\t\tcolor: ( optionsA.color != null ? optionsA.color : color ),\r\n\t\t\t\t\talpha: ( optionsA.alpha != null ? optionsA.alpha : alpha ),\r\n\t\t\t\t\twidth: ( optionsA.width != null ? optionsA.width : width ),\r\n\t\t\t\t\talign: ( optionsA.align != null ? optionsA.align : align ),\r\n\t\t\t\t\tside: ( optionsA.side != null ? optionsA.side : side )\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t} else if( optionsB ) {\r\n\t\t\treturn {\r\n\t\t\t\tenable: ( optionsB.enable != null ? optionsB.enable : enable ),\r\n\t\t\t\tcolor: ( optionsB.color != null ? optionsB.color : color ),\r\n\t\t\t\talpha: ( optionsB.alpha != null ? optionsB.alpha : alpha ),\r\n\t\t\t\twidth: ( optionsB.width != null ? optionsB.width : width ),\r\n\t\t\t\talign: ( optionsB.align != null ? optionsB.align : align ),\r\n\t\t\t\tside: ( optionsB.side != null ? optionsB.side : side )\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tenable,\r\n\t\t\t\tcolor,\r\n\t\t\t\talpha,\r\n\t\t\t\twidth,\r\n\t\t\t\talign,\r\n\t\t\t\tside\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toMajorTickFormatter(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: DChartAxisBaseTickMajorOptions\r\n\t): NumberFormatter {\r\n\t\tconst text = options && options.text;\r\n\t\tif( text ) {\r\n\t\t\tconst format = text.format;\r\n\t\t\tif( format != null ) {\r\n\t\t\t\treturn NumberFormatters.create( format );\r\n\t\t\t} else {\r\n\t\t\t\tconst formatter = text.formatter;\r\n\t\t\t\tif( formatter ) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tformat: formatter\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn NumberFormatters.create(\r\n\t\t\ttheme.getMajorTickTextFormat()\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toMajorTickText(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: DChartAxisBaseTickMajorTextOptions\r\n\t): DChartAxisBaseTickMajorTextOptions | undefined {\r\n\t\toptions = options || {};\r\n\t\treturn {\r\n\t\t\tformat: options.format,\r\n\t\t\tcolor: this.toMajorTickTextColor( theme, options.color ),\r\n\t\t\talpha: options.alpha,\r\n\t\t\tfamily: options.family,\r\n\t\t\tsize: options.size,\r\n\t\t\tweight: options.weight,\r\n\t\t\talign: this.toMajorTickTextAlign( theme, options.align ),\r\n\t\t\toffset: this.toMajorTickTextOffset( theme, options.offset ),\r\n\t\t\tstyle: options.style,\r\n\t\t\toutline: this.toMajorTickTextOutline( theme, options.outline ),\r\n\t\t\tspacing: this.toMajorTickTextSpacing( theme, options.spacing ),\r\n\t\t\tdirection: this.toTickMajorTextDirection( theme, options.direction ),\r\n\t\t\tpadding: this.toMajorTickTextPadding( theme, options.padding ),\r\n\t\t\tclipping: options.clipping\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toMajorTickTextOutline(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextOutlineLike>\r\n\t): Partial<EShapeTextOutlineLike> | undefined {\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\tenable: options.enable,\r\n\t\t\t\tcolor: options.color,\r\n\t\t\t\talpha: options.alpha,\r\n\t\t\t\twidth: options.width\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toMajorTickTextAlign(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextAlignLike>\r\n\t): Partial<EShapeTextAlignLike> | undefined {\r\n\t\tconst position = this._position;\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\thorizontal: ( options.horizontal != null ? options.horizontal :\r\n\t\t\t\t\ttheme.getMajorTickTextAlignHorizontal( position )\r\n\t\t\t\t),\r\n\t\t\t\tvertical: ( options.vertical != null ? options.vertical :\r\n\t\t\t\t\ttheme.getMajorTickTextAlignVertical( position )\r\n\t\t\t\t)\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn {\r\n\t\t\thorizontal: theme.getMajorTickTextAlignHorizontal( position ),\r\n\t\t\tvertical: theme.getMajorTickTextAlignVertical( position )\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toMajorTickTextOffset(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextOffsetLike>\r\n\t): Partial<EShapeTextOffsetLike> | undefined {\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\thorizontal: options.horizontal,\r\n\t\t\t\tvertical: options.vertical\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toMajorTickTextSpacing(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextOffsetLike>\r\n\t): Partial<EShapeTextOffsetLike> | undefined {\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\thorizontal: options.horizontal,\r\n\t\t\t\tvertical: options.vertical\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toMajorTickTextPadding(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextOffsetLike>\r\n\t): Partial<EShapeTextOffsetLike> {\r\n\t\treturn {\r\n\t\t\thorizontal: ( options && options.horizontal != null ?\r\n\t\t\t\toptions.horizontal : theme.getMajorTickTextPaddingHorizontal()\r\n\t\t\t),\r\n\t\t\tvertical: ( options && options.vertical != null ?\r\n\t\t\t\toptions.vertical : theme.getMajorTickTextPaddingVertical()\r\n\t\t\t)\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toTickMajorTextDirection(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: EShapeTextDirection\r\n\t): EShapeTextDirection {\r\n\t\treturn ( options != null ? options : theme.getMajorTickTextDirection() );\r\n\t}\r\n\r\n\tprotected toMajorTickTextColor(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: number\r\n\t): number {\r\n\t\treturn ( options != null ? options : theme.getMajorTickTextColor() );\r\n\t}\r\n\r\n\tprotected toLabel(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: DChartAxisBaseOptions\r\n\t): DeepPartial<EShapeTextLike> | undefined {\r\n\t\tconst label = options && options.label;\r\n\t\tif( label ) {\r\n\t\t\treturn {\r\n\t\t\t\tvalue: label.value,\r\n\t\t\t\tcolor: this.toLabelColor(theme, label.color),\r\n\t\t\t\talpha: label.alpha,\r\n\t\t\t\tfamily: label.family,\r\n\t\t\t\tsize: label.size,\r\n\t\t\t\tweight: label.weight,\r\n\t\t\t\talign: this.toLabelAlign( theme, label.align ),\r\n\t\t\t\toffset: this.toLabelOffset( theme, label.offset ),\r\n\t\t\t\tstyle: label.style,\r\n\t\t\t\toutline: this.toLabelOutline( theme, label.outline ),\r\n\t\t\t\tspacing: this.toLabelSpacing( theme, label.spacing ),\r\n\t\t\t\tdirection: this.toLabelDirection( theme, label.direction ),\r\n\t\t\t\tpadding: this.toLabelPadding( theme, label.padding ),\r\n\t\t\t\tclipping: label.clipping\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toLabelOutline(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextOutlineLike>\r\n\t): Partial<EShapeTextOutlineLike> | undefined {\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\tenable: options.enable,\r\n\t\t\t\tcolor: options.color,\r\n\t\t\t\talpha: options.alpha,\r\n\t\t\t\twidth: options.width\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toLabelAlign(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextAlignLike>\r\n\t): Partial<EShapeTextAlignLike> | undefined {\r\n\t\tconst position = this._position;\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\thorizontal: ( options.horizontal != null ?\r\n\t\t\t\t\toptions.horizontal : theme.getLabelAlignHorizontal( position )\r\n\t\t\t\t),\r\n\t\t\t\tvertical: ( options.vertical != null ?\r\n\t\t\t\t\toptions.vertical : theme.getLabelAlignVertical( position )\r\n\t\t\t\t)\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn {\r\n\t\t\thorizontal: theme.getLabelAlignHorizontal( position ),\r\n\t\t\tvertical: theme.getLabelAlignVertical( position )\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toLabelOffset(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextOffsetLike>\r\n\t): Partial<EShapeTextOffsetLike> | undefined {\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\thorizontal: options.horizontal,\r\n\t\t\t\tvertical: options.vertical\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toLabelSpacing(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextOffsetLike>\r\n\t): Partial<EShapeTextOffsetLike> | undefined {\r\n\t\tif( options ) {\r\n\t\t\treturn {\r\n\t\t\t\thorizontal: options.horizontal,\r\n\t\t\t\tvertical: options.vertical\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toLabelPadding(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: Partial<EShapeTextOffsetLike>\r\n\t): Partial<EShapeTextOffsetLike> {\r\n\t\treturn {\r\n\t\t\thorizontal: ( options && options.horizontal != null ?\r\n\t\t\t\toptions.horizontal : theme.getLabelPaddingHorizontal()\r\n\t\t\t),\r\n\t\t\tvertical: ( options && options.vertical != null ?\r\n\t\t\t\toptions.vertical : theme.getLabelPaddingVertical()\r\n\t\t\t)\r\n\t\t};\r\n\t}\r\n\r\n\tprotected toLabelDirection(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: EShapeTextDirection\r\n\t): EShapeTextDirection {\r\n\t\treturn ( options != null ? options : theme.getLabelDirection() );\r\n\t}\r\n\r\n\tprotected toLabelColor(\r\n\t\ttheme: DThemeChartAxisBase,\r\n\t\toptions?: number\r\n\t): number {\r\n\t\treturn ( options != null ? options : theme.getLabelColor() );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Matrix } from \"pixi.js\";\r\nimport { DChartAxis } from \"./d-chart-axis\";\r\nimport { DChartAxisBaseOptions, DThemeChartAxisBase } from \"./d-chart-axis-base-options\";\r\nimport {\r\n\tDChartAxisBaseBar, DChartAxisBaseOptionParser, DChartAxisBaseTickContainer\r\n} from \"./d-chart-axis-base-options-parser\";\r\nimport { DChartAxisContainer } from \"./d-chart-axis-container\";\r\nimport { DChartAxisPosition } from \"./d-chart-axis-position\";\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\nimport { EShapeDefaults } from \"./shape/e-shape-defaults\";\r\nimport { EShapeTextLike } from \"./shape/e-shape-text\";\r\nimport { EShapeBar } from \"./shape/variant/e-shape-bar\";\r\nimport { EShapeBarPosition } from \"./shape/variant/e-shape-bar-position\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\nimport { DeepPartial } from \"./util/deep-partial\";\r\nimport { isNaN } from \"./util/is-nan\";\r\n\r\nexport class DChartAxisBase implements DChartAxis {\r\n\tprotected _coordinateIndex: number;\r\n\tprotected _padding: number;\r\n\tprotected _position: DChartAxisPosition;\r\n\tprotected _container?: DChartAxisContainer;\r\n\tprotected _bar: DChartAxisBaseBar;\r\n\tprotected _index: number;\r\n\tprotected _tick: DChartAxisBaseTickContainer;\r\n\tprotected _majorTicks: Float64Array;\r\n\tprotected _minorTicks: Float64Array;\r\n\tprotected _label?: DeepPartial<EShapeTextLike>;\r\n\tprotected _theme: DThemeChartAxisBase;\r\n\r\n\tconstructor( options?: DChartAxisBaseOptions ) {\r\n\t\tconst theme = this.toTheme( options );\r\n\t\tthis._theme = theme;\r\n\t\tthis._index = 0;\r\n\r\n\t\tconst parser = new DChartAxisBaseOptionParser( theme, options );\r\n\t\tthis._coordinateIndex = parser.coordinateIndex;\r\n\t\tthis._padding = parser.padding;\r\n\t\tthis._position = parser.position;\r\n\t\tconst tick = parser.tick;\r\n\t\tthis._tick = tick;\r\n\t\tthis._label = parser.label;\r\n\t\tthis._bar = parser.bar;\r\n\t\tthis._majorTicks = new Float64Array( tick.major.count * 3 );\r\n\t\tthis._minorTicks = new Float64Array( (tick.major.count + 1) * tick.minor.count * 3 );\r\n\t}\r\n\r\n\tget position(): DChartAxisPosition {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tprotected updateBar( container: DChartAxisContainer ): void {\r\n\t\tconst bar = this._bar;\r\n\t\tconst barShape = bar.shape;\r\n\t\tif( barShape ) {\r\n\t\t\tconst plotArea = container.plotArea;\r\n\t\t\tconst plotAreaWidth = plotArea.width;\r\n\t\t\tconst plotAreaHeight = plotArea.height;\r\n\t\t\tconst padding = this._padding * this._index;\r\n\t\t\tbarShape.disallowUploadedUpdate();\r\n\t\t\tswitch( this._position ) {\r\n\t\t\tcase DChartAxisPosition.TOP:\r\n\t\t\t\tbarShape.transform.position.set( plotAreaWidth * 0.5, 0 - padding );\r\n\t\t\t\tbarShape.size.set( plotAreaWidth, 0 );\r\n\t\t\t\tbreak;\r\n\t\t\tcase DChartAxisPosition.BOTTOM:\r\n\t\t\t\tbarShape.transform.position.set( plotAreaWidth * 0.5, plotAreaHeight + padding );\r\n\t\t\t\tbarShape.size.set( plotAreaWidth, 0 );\r\n\t\t\t\tbreak;\r\n\t\t\tcase DChartAxisPosition.LEFT:\r\n\t\t\t\tbarShape.transform.position.set( 0 - padding, plotAreaHeight * 0.5 );\r\n\t\t\t\tbarShape.size.set( 0, plotAreaHeight );\r\n\t\t\t\tbreak;\r\n\t\t\tcase DChartAxisPosition.RIGHT:\r\n\t\t\t\tbarShape.transform.position.set( plotAreaWidth + padding, plotAreaHeight * 0.5 );\r\n\t\t\t\tbarShape.size.set( 0, plotAreaHeight );\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tbarShape.allowUploadedUpdate();\r\n\t\t}\r\n\t}\r\n\r\n\tupdateTicksX(\r\n\t\tdomainMin: number, domainMax: number,\r\n\t\tcoordinate: DChartCoordinate,\r\n\t\tmajorShapes: EShapeBar[], minorShapes: EShapeBar[], gridlineShapes: EShapeBar[] | undefined,\r\n\t\tshapePositionY: number,\r\n\t\ttransform: Matrix, plotAreaHeight: number\r\n\t): void {\r\n\t\tconst tick = this._tick;\r\n\t\tconst majorCount = tick.major.count;\r\n\t\tconst majorFormatter = tick.major.formatter;\r\n\t\tconst minorCountPerMajor = tick.minor.count;\r\n\t\tconst minorCount = (majorCount + 1) * minorCountPerMajor;\r\n\t\tconst majorTicks = this._majorTicks;\r\n\t\tconst minorTicks = this._minorTicks;\r\n\t\tcoordinate.ticks(\r\n\t\t\tdomainMin, domainMax,\r\n\t\t\tmajorCount, minorCountPerMajor, minorCount,\r\n\t\t\tmajorTicks, minorTicks\r\n\t\t);\r\n\r\n\t\tconst a = transform.a;\r\n\t\tconst tx = transform.tx;\r\n\t\tfor( let i = 0; i < majorCount; ++i ) {\r\n\t\t\tconst majorShape = majorShapes[ i ];\r\n\t\t\tconst imajorTick = i * 3;\r\n\t\t\tconst majorTickPosition = majorTicks[ imajorTick + 0 ];\r\n\t\t\tif( ! isNaN( majorTickPosition ) ) {\r\n\t\t\t\tconst majorTickProjectedPosition = majorTicks[ imajorTick + 1 ];\r\n\t\t\t\tconst majotTickPositionX = a * majorTickProjectedPosition + tx;\r\n\t\t\t\tconst majorTickStep = majorTicks[ imajorTick + 2 ];\r\n\r\n\t\t\t\tmajorShape.disallowUploadedUpdate();\r\n\t\t\t\tmajorShape.visible = true;\r\n\t\t\t\tmajorShape.transform.position.set( majotTickPositionX, shapePositionY );\r\n\t\t\t\tmajorShape.text.value = majorFormatter.format( majorTickPosition, majorTickStep );\r\n\t\t\t\tmajorShape.allowUploadedUpdate();\r\n\r\n\t\t\t\tif( gridlineShapes ) {\r\n\t\t\t\t\tconst gridlineShape = gridlineShapes[ i ];\r\n\t\t\t\t\tgridlineShape.disallowUploadedUpdate();\r\n\t\t\t\t\tgridlineShape.visible = true;\r\n\t\t\t\t\tgridlineShape.transform.position.set( majotTickPositionX, plotAreaHeight * 0.5 );\r\n\t\t\t\t\tgridlineShape.size.set( 0, plotAreaHeight );\r\n\t\t\t\t\tgridlineShape.allowUploadedUpdate();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmajorShape.visible = false;\r\n\t\t\t\tif( gridlineShapes ) {\r\n\t\t\t\t\tgridlineShapes[ i ].visible = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor( let i = 0; i < minorCount; ++i ) {\r\n\t\t\tconst minorShape = minorShapes[ i ];\r\n\t\t\tconst iminorTick = i * 3;\r\n\t\t\tconst minorTickPosition = minorTicks[ iminorTick + 0 ];\r\n\t\t\tconst minorTickProjectedPosition = minorTicks[ iminorTick + 1 ];\r\n\t\t\tif( ! isNaN( minorTickPosition ) ) {\r\n\t\t\t\tminorShape.disallowUploadedUpdate();\r\n\t\t\t\tminorShape.visible = true;\r\n\t\t\t\tminorShape.transform.position.set(\r\n\t\t\t\t\ta * minorTickProjectedPosition + tx,\r\n\t\t\t\t\tshapePositionY\r\n\t\t\t\t);\r\n\t\t\t\tminorShape.allowUploadedUpdate();\r\n\t\t\t} else {\r\n\t\t\t\tminorShape.visible = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateTicksY(\r\n\t\tdomainMin: number, domainMax: number,\r\n\t\tcoordinate: DChartCoordinate,\r\n\t\tmajorShapes: EShapeBar[], minorShapes: EShapeBar[], gridlineShapes: EShapeBar[] | undefined,\r\n\t\tshapePositionX: number,\r\n\t\ttransform: Matrix, plotAreaWidth: number\r\n\t): void {\r\n\t\tconst tick = this._tick;\r\n\t\tconst majorCount = tick.major.count;\r\n\t\tconst majorFormatter = tick.major.formatter;\r\n\t\tconst minorCountPerMajor = tick.minor.count;\r\n\t\tconst minorCount = (majorCount + 1) * minorCountPerMajor;\r\n\t\tconst majorTicks = this._majorTicks;\r\n\t\tconst minorTicks = this._minorTicks;\r\n\t\tcoordinate.ticks(\r\n\t\t\tdomainMin, domainMax,\r\n\t\t\tmajorCount, minorCountPerMajor, minorCount,\r\n\t\t\tmajorTicks, minorTicks\r\n\t\t);\r\n\r\n\t\tconst d = transform.d;\r\n\t\tconst ty = transform.ty;\r\n\t\tfor( let i = 0; i < majorCount; ++i ) {\r\n\t\t\tconst majorShape = majorShapes[ i ];\r\n\t\t\tconst imajorTick = i * 3;\r\n\t\t\tconst majorTickPosition = majorTicks[ imajorTick + 0 ];\r\n\t\t\tif( ! isNaN( majorTickPosition ) ) {\r\n\t\t\t\tconst majorTickProjectedPosition = majorTicks[ imajorTick + 1 ];\r\n\t\t\t\tconst majotTickPositionY = d * majorTickProjectedPosition + ty;\r\n\t\t\t\tconst majorTickStep = majorTicks[ imajorTick + 2 ];\r\n\r\n\t\t\t\tmajorShape.disallowUploadedUpdate();\r\n\t\t\t\tmajorShape.visible = true;\r\n\t\t\t\tmajorShape.transform.position.set( shapePositionX, majotTickPositionY );\r\n\t\t\t\tmajorShape.text.value = majorFormatter.format( majorTickPosition, majorTickStep );\r\n\t\t\t\tmajorShape.allowUploadedUpdate();\r\n\r\n\t\t\t\tif( gridlineShapes ) {\r\n\t\t\t\t\tconst gridlineShape = gridlineShapes[ i ];\r\n\t\t\t\t\tgridlineShape.disallowUploadedUpdate();\r\n\t\t\t\t\tgridlineShape.visible = true;\r\n\t\t\t\t\tgridlineShape.transform.position.set( plotAreaWidth * 0.5, majotTickPositionY );\r\n\t\t\t\t\tgridlineShape.size.set( plotAreaWidth, 0 );\r\n\t\t\t\t\tgridlineShape.allowUploadedUpdate();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmajorShape.visible = false;\r\n\t\t\t\tif( gridlineShapes ) {\r\n\t\t\t\t\tgridlineShapes[ i ].visible = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor( let i = 0; i < minorCount; ++i ) {\r\n\t\t\tconst minorShape = minorShapes[ i ];\r\n\t\t\tconst iminorTick = i * 3;\r\n\t\t\tconst minorTickPosition = minorTicks[ iminorTick + 0 ];\r\n\t\t\tconst minorTickProjectedPosition = minorTicks[ iminorTick + 1 ];\r\n\t\t\tif( ! isNaN( minorTickPosition ) ) {\r\n\t\t\t\tminorShape.disallowUploadedUpdate();\r\n\t\t\t\tminorShape.visible = true;\r\n\t\t\t\tminorShape.transform.position.set(\r\n\t\t\t\t\tshapePositionX,\r\n\t\t\t\t\td * minorTickProjectedPosition + ty\r\n\t\t\t\t);\r\n\t\t\t\tminorShape.allowUploadedUpdate();\r\n\t\t\t} else {\r\n\t\t\t\tminorShape.visible = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateTicks( container: DChartAxisContainer ): void {\r\n\t\tconst tick = this._tick;\r\n\t\tconst majorShapes = tick.major.shapes;\r\n\t\tconst minorShapes = tick.minor.shapes;\r\n\t\tif( majorShapes && minorShapes ) {\r\n\t\t\tconst plotArea = container.plotArea;\r\n\t\t\tconst bounds = plotArea.getBoundsInContainer();\r\n\t\t\tconst transform = plotArea.container.transform.localTransform;\r\n\t\t\tconst gridlineShapes = tick.major.gridline.shapes;\r\n\r\n\t\t\tconst coordinateIndex = this._coordinateIndex;\r\n\t\t\tconst padding = this._padding * this._index;\r\n\t\t\tlet coordinate: DChartCoordinate | null;\r\n\t\t\tswitch( this._position ) {\r\n\t\t\tcase DChartAxisPosition.TOP:\r\n\t\t\t\tcoordinate = plotArea.coordinate.x.get( coordinateIndex );\r\n\t\t\t\tif( coordinate ) {\r\n\t\t\t\t\tconst domainFrom = coordinate.unmap(\r\n\t\t\t\t\t\tcoordinate.transform.unmap( bounds.x )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst domainTo = coordinate.unmap(\r\n\t\t\t\t\t\tcoordinate.transform.unmap( bounds.x + bounds.width )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst plotAreaHeight = plotArea.height;\r\n\t\t\t\t\tthis.updateTicksX(\r\n\t\t\t\t\t\tdomainFrom, domainTo,\r\n\t\t\t\t\t\tcoordinate,\r\n\t\t\t\t\t\tmajorShapes, minorShapes, gridlineShapes,\r\n\t\t\t\t\t\t0 - padding,\r\n\t\t\t\t\t\ttransform, plotAreaHeight\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase DChartAxisPosition.BOTTOM:\r\n\t\t\t\tcoordinate = plotArea.coordinate.x.get( coordinateIndex );\r\n\t\t\t\tif( coordinate ) {\r\n\t\t\t\t\tconst domainFrom = coordinate.unmap(\r\n\t\t\t\t\t\tcoordinate.transform.unmap( bounds.x )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst domainTo = coordinate.unmap(\r\n\t\t\t\t\t\tcoordinate.transform.unmap( bounds.x + bounds.width )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst plotAreaHeight = plotArea.height;\r\n\t\t\t\t\tthis.updateTicksX(\r\n\t\t\t\t\t\tdomainFrom, domainTo,\r\n\t\t\t\t\t\tcoordinate,\r\n\t\t\t\t\t\tmajorShapes, minorShapes, gridlineShapes,\r\n\t\t\t\t\t\tplotAreaHeight + padding,\r\n\t\t\t\t\t\ttransform, plotAreaHeight\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase DChartAxisPosition.LEFT:\r\n\t\t\t\tcoordinate = plotArea.coordinate.y.get( coordinateIndex );\r\n\t\t\t\tif( coordinate ) {\r\n\t\t\t\t\tconst domainFrom = coordinate.unmap(\r\n\t\t\t\t\t\tcoordinate.transform.unmap( bounds.y )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst domainTo = coordinate.unmap(\r\n\t\t\t\t\t\tcoordinate.transform.unmap( bounds.y + bounds.height )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst plotAreaWidth = plotArea.width;\r\n\t\t\t\t\tthis.updateTicksY(\r\n\t\t\t\t\t\tdomainFrom, domainTo,\r\n\t\t\t\t\t\tcoordinate,\r\n\t\t\t\t\t\tmajorShapes, minorShapes, gridlineShapes,\r\n\t\t\t\t\t\t0 - padding,\r\n\t\t\t\t\t\ttransform, plotAreaWidth\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase DChartAxisPosition.RIGHT:\r\n\t\t\t\tcoordinate = plotArea.coordinate.y.get( coordinateIndex );\r\n\t\t\t\tif( coordinate ) {\r\n\t\t\t\t\tconst domainFrom = coordinate.unmap(\r\n\t\t\t\t\t\tcoordinate.transform.unmap( bounds.y )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst domainTo = coordinate.unmap(\r\n\t\t\t\t\t\tcoordinate.transform.unmap( bounds.y + bounds.height )\r\n\t\t\t\t\t);\r\n\t\t\t\t\tconst plotAreaWidth = plotArea.width;\r\n\t\t\t\t\tthis.updateTicksY(\r\n\t\t\t\t\t\tdomainFrom, domainTo,\r\n\t\t\t\t\t\tcoordinate,\r\n\t\t\t\t\t\tmajorShapes, minorShapes, gridlineShapes,\r\n\t\t\t\t\t\tplotAreaWidth + padding,\r\n\t\t\t\t\t\ttransform, plotAreaWidth\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tbind( container: DChartAxisContainer, index: number ): void {\r\n\t\tthis._container = container;\r\n\t\tthis._index = index;\r\n\t\tconst tickShapeContainer = container.container;\r\n\r\n\t\t// Bar\r\n\t\tconst bar = this._bar;\r\n\t\tlet barShape = bar.shape;\r\n\t\tif( ! barShape ) {\r\n\t\t\tconst position = this._position;\r\n\t\t\tconst barPosition = ( position === DChartAxisPosition.LEFT || position === DChartAxisPosition.RIGHT ?\r\n\t\t\t\tEShapeBarPosition.TOP : EShapeBarPosition.LEFT\r\n\t\t\t);\r\n\t\t\tbarShape = new EShapeBar(\r\n\t\t\t\tbarPosition,\r\n\t\t\t\t-1,\r\n\t\t\t\tEShapeDefaults.STROKE_WIDTH,\r\n\t\t\t\tbar.style\r\n\t\t\t);\r\n\t\t\tbarShape.stroke.copy( bar.stroke );\r\n\t\t\tbarShape.text.copy( this._label );\r\n\t\t\tthis._bar.shape = barShape;\r\n\t\t}\r\n\t\tbarShape.attach( container.container );\r\n\r\n\t\t// Major tick gridline\r\n\t\tconst tick = this._tick;\r\n\t\tconst tickMajor = tick.major;\r\n\t\tconst gridline = tickMajor.gridline;\r\n\t\tlet gridlineShapes = gridline.shapes;\r\n\t\tif( ! gridlineShapes && tick.enable && gridline.enable ) {\r\n\t\t\tgridlineShapes = [];\r\n\t\t\tgridline.shapes = gridlineShapes;\r\n\t\t\tconst position = this._position;\r\n\t\t\tconst gridlinePosition = ( position === DChartAxisPosition.LEFT || position === DChartAxisPosition.RIGHT ?\r\n\t\t\t\tEShapeBarPosition.LEFT : EShapeBarPosition.TOP\r\n\t\t\t);\r\n\t\t\tconst gridlineCount = tickMajor.count;\r\n\t\t\tconst gridlineStyle = gridline.style;\r\n\t\t\tfor( let i = 0; i < gridlineCount; ++i ) {\r\n\t\t\t\tconst gridlineShape = new EShapeBar(\r\n\t\t\t\t\tgridlinePosition,\r\n\t\t\t\t\t-1,\r\n\t\t\t\t\tEShapeDefaults.STROKE_WIDTH,\r\n\t\t\t\t\tgridlineStyle\r\n\t\t\t\t);\r\n\t\t\t\tgridlineShape.stroke.copy( gridline.stroke );\r\n\t\t\t\tgridlineShapes.push( gridlineShape );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( gridlineShapes ) {\r\n\t\t\tfor( let i = 0, imax = gridlineShapes.length; i < imax; ++i ) {\r\n\t\t\t\tgridlineShapes[ i ].attach( tickShapeContainer );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Major ticks\r\n\t\tlet tickMajorShapes = tickMajor.shapes;\r\n\t\tif( ! tickMajorShapes && tick.enable ) {\r\n\t\t\ttickMajorShapes = [];\r\n\t\t\ttickMajor.shapes = tickMajorShapes;\r\n\t\t\tconst tickMajorCount = tickMajor.count;\r\n\t\t\tconst tickMajorSize = tickMajor.size;\r\n\t\t\tconst tickMajorPosition = tickMajor.position;\r\n\t\t\tconst tickMajorStyle = tickMajor.style;\r\n\t\t\tfor( let i = 0; i < tickMajorCount; ++i ) {\r\n\t\t\t\tconst tickMajorShape = new EShapeBar(\r\n\t\t\t\t\ttickMajorPosition,\r\n\t\t\t\t\ttickMajorSize,\r\n\t\t\t\t\tEShapeDefaults.STROKE_WIDTH,\r\n\t\t\t\t\ttickMajorStyle\r\n\t\t\t\t);\r\n\t\t\t\ttickMajorShape.stroke.copy( tickMajor.stroke );\r\n\t\t\t\ttickMajorShape.text.copy( tickMajor.text );\r\n\t\t\t\ttickMajorShape.size.set( 0, 0 );\r\n\t\t\t\ttickMajorShapes.push( tickMajorShape );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( tickMajorShapes ) {\r\n\t\t\tfor( let i = 0, imax = tickMajorShapes.length; i < imax; ++i ) {\r\n\t\t\t\ttickMajorShapes[ i ].attach( tickShapeContainer );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Minor ticks\r\n\t\tconst tickMinor = tick.minor;\r\n\t\tlet tickMinorShapes = tickMinor.shapes;\r\n\t\tif( ! tickMinorShapes && tick.enable ) {\r\n\t\t\ttickMinorShapes = [];\r\n\t\t\ttickMinor.shapes = tickMinorShapes;\r\n\t\t\tconst tickMinorCount = tickMinor.count;\r\n\t\t\tconst tickMinorSize = tickMinor.size;\r\n\t\t\tconst tickMinorPosition = tickMinor.position;\r\n\t\t\tconst tickMinorStyle = tickMinor.style;\r\n\t\t\tfor( let i = 0, imax = ( tickMajor.count + 1 ) * tickMinorCount; i < imax; ++i ) {\r\n\t\t\t\tconst tickMinorShape = new EShapeBar(\r\n\t\t\t\t\ttickMinorPosition,\r\n\t\t\t\t\ttickMinorSize,\r\n\t\t\t\t\tEShapeDefaults.STROKE_WIDTH,\r\n\t\t\t\t\ttickMinorStyle\r\n\t\t\t\t);\r\n\t\t\t\ttickMinorShape.stroke.copy( tickMinor.stroke );\r\n\t\t\t\ttickMinorShape.size.set( 0, 0 );\r\n\t\t\t\ttickMinorShapes.push( tickMinorShape );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( tickMinorShapes ) {\r\n\t\t\tfor( let i = 0, imax = tickMinorShapes.length; i < imax; ++i ) {\r\n\t\t\t\ttickMinorShapes[ i ].attach( tickShapeContainer );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\t// Bar\r\n\t\tconst barShape = this._bar.shape;\r\n\t\tif( barShape ) {\r\n\t\t\tbarShape.detach();\r\n\t\t}\r\n\r\n\t\t// Major ticks\r\n\t\tconst tick = this._tick;\r\n\t\tconst tickMajorShapes = tick.major.shapes;\r\n\t\tif( tickMajorShapes ) {\r\n\t\t\tfor( let i = 0, imax = tickMajorShapes.length; i < imax; ++i ) {\r\n\t\t\t\ttickMajorShapes[ i ].detach();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Major tick gridlines\r\n\t\tconst tickMajorGridlineShapes = tick.major.gridline.shapes;\r\n\t\tif( tickMajorGridlineShapes ) {\r\n\t\t\tfor( let i = 0, imax = tickMajorGridlineShapes.length; i < imax; ++i ) {\r\n\t\t\t\ttickMajorGridlineShapes[ i ].detach();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Minor ticks\r\n\t\tconst tickMinorShapes = tick.minor.shapes;\r\n\t\tif( tickMinorShapes ) {\r\n\t\t\tfor( let i = 0, imax = tickMinorShapes.length; i < imax; ++i ) {\r\n\t\t\t\ttickMinorShapes[ i ].detach();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tthis._container = undefined;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst container = this._container;\r\n\t\tif( container ) {\r\n\t\t\tthis.updateBar( container );\r\n\t\t\tthis.updateTicks( container );\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// Bar\r\n\t\tconst barShape = this._bar.shape;\r\n\t\tif( barShape ) {\r\n\t\t\tbarShape.destroy();\r\n\t\t}\r\n\r\n\t\t// Major ticks\r\n\t\tconst tick = this._tick;\r\n\t\tconst tickMajorShapes = tick.major.shapes;\r\n\t\tif( tickMajorShapes ) {\r\n\t\t\tfor( let i = 0, imax = tickMajorShapes.length; i < imax; ++i ) {\r\n\t\t\t\ttickMajorShapes[ i ].destroy();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Major tick gridlines\r\n\t\tconst tickMajorGridlineShapes = tick.major.gridline.shapes;\r\n\t\tif( tickMajorGridlineShapes ) {\r\n\t\t\tfor( let i = 0, imax = tickMajorGridlineShapes.length; i < imax; ++i ) {\r\n\t\t\t\ttickMajorGridlineShapes[ i ].destroy();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Minor ticks\r\n\t\tconst tickMinorShapes = tick.minor.shapes;\r\n\t\tif( tickMinorShapes ) {\r\n\t\t\tfor( let i = 0, imax = tickMinorShapes.length; i < imax; ++i ) {\r\n\t\t\t\ttickMinorShapes[ i ].destroy();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tthis._container = undefined;\r\n\t}\r\n\r\n\tprotected toTheme( options?: DChartAxisBaseOptions ): DThemeChartAxisBase {\r\n\t\treturn ( options && options.theme ) || this.getThemeDefault();\r\n\t}\r\n\r\n\tprotected getThemeDefault(): DThemeChartAxisBase {\r\n\t\treturn DThemes.getInstance().get( this.getType() );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartAxisBase\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartAxis } from \"./d-chart-axis\";\r\nimport { DChartAxisContainer, DChartAxisContainerOptions } from \"./d-chart-axis-container\";\r\nimport { DChartAxisPosition } from \"./d-chart-axis-position\";\r\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\r\nimport { EShapeContainer } from \"./shape/e-shape-container\";\r\n\r\nexport class DChartAxisContainerImpl implements DChartAxisContainer {\r\n\tprotected _plotArea: DChartPlotArea;\r\n\tprotected _container: EShapeContainer;\r\n\tprotected _list: Map<DChartAxisPosition, DChartAxis[]>;\r\n\r\n\tconstructor( plotArea: DChartPlotArea, options?: DChartAxisContainerOptions ) {\r\n\t\tthis._plotArea = plotArea;\r\n\t\tthis._container = new EShapeContainer();\r\n\r\n\t\tthis._list = new Map<DChartAxisPosition, DChartAxis[]>();\r\n\t\tconst list = options && options.list;\r\n\t\tif( list ) {\r\n\t\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\t\tthis.add( list[ i ] );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget container(): EShapeContainer {\r\n\t\treturn this._container;\r\n\t}\r\n\r\n\tget plotArea(): DChartPlotArea {\r\n\t\treturn this._plotArea;\r\n\t}\r\n\r\n\tadd( axis: DChartAxis ): void {\r\n\t\tconst list = this._list;\r\n\t\tlet axes = list.get( axis.position );\r\n\t\tif( axes == null ) {\r\n\t\t\taxes = [];\r\n\t\t\tlist.set( axis.position, axes );\r\n\t\t}\r\n\t\taxes.push( axis );\r\n\t\taxis.bind( this, axes.length - 1 );\r\n\t}\r\n\r\n\tget( position: DChartAxisPosition, index: number ): DChartAxis | null {\r\n\t\tconst list = this._list;\r\n\t\tconst axes = list.get( position );\r\n\t\tif( axes ) {\r\n\t\t\tif( 0 <= index && index < axes.length ) {\r\n\t\t\t\treturn axes[ index ];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tindexOf( axis: DChartAxis ): number {\r\n\t\tconst list = this._list;\r\n\t\tconst axes = list.get( axis.position );\r\n\t\tif( axes ) {\r\n\t\t\treturn axes.indexOf( axis );\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tclear( position: DChartAxisPosition ): this {\r\n\t\tconst list = this._list;\r\n\t\tconst axes = list.get( position );\r\n\t\tif( axes ) {\r\n\t\t\tfor( let i = 0, imax = axes.length; i < imax; ++i ) {\r\n\t\t\t\taxes[ i ].destroy();\r\n\t\t\t}\r\n\t\t\taxes.length = 0;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsize( position: DChartAxisPosition ): number {\r\n\t\tconst list = this._list;\r\n\t\tconst axes = list.get( position );\r\n\t\tif( axes ) {\r\n\t\t\treturn axes.length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tthis._list.forEach(( axes: DChartAxis[] ): void => {\r\n\t\t\tfor( let i = 0, imax = axes.length; i < imax; ++i ) {\r\n\t\t\t\taxes[ i ].update();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis._list.forEach(( axes: DChartAxis[] ): void => {\r\n\t\t\tfor( let i = 0, imax = axes.length; i < imax; ++i ) {\r\n\t\t\t\taxes[ i ].destroy();\r\n\t\t\t}\r\n\t\t\taxes.length = 0;\r\n\t\t});\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartAxisBase } from \"./d-chart-axis-base\";\r\n\r\n/**\r\n * An X axis.\r\n */\r\nexport class DChartAxisX extends DChartAxisBase {\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartAxisX\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartAxisX } from \"./d-chart-axis-x\";\r\n\r\n/**\r\n * An X axis for datetimes.\r\n */\r\nexport class DChartAxisXDatetime extends DChartAxisX {\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartAxisXDatetime\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartAxisBase } from \"./d-chart-axis-base\";\r\n\r\n/**\r\n * An Y axis.\r\n */\r\nexport class DChartAxisY extends DChartAxisBase {\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartAxisY\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { UtilRgb } from \"./util/util-rgb\";\r\n\r\nconst DCHART_COLOR_SET_1 = [\r\n\t0x10b7e3,\r\n\t0xfe5420,\r\n\t0xf0c312,\r\n\t0x1c5d71\r\n];\r\n\r\nconst DCHART_COLOR_SET_2 = [\r\n\tDCHART_COLOR_SET_1[ 0 ],\r\n\tUtilRgb.brighten( DCHART_COLOR_SET_1[ 0 ], 0.4 ),\r\n\r\n\tDCHART_COLOR_SET_1[ 1 ],\r\n\tUtilRgb.brighten( DCHART_COLOR_SET_1[ 1 ], 0.4 ),\r\n\r\n\tDCHART_COLOR_SET_1[ 2 ],\r\n\tUtilRgb.brighten( DCHART_COLOR_SET_1[ 2 ], 0.4 ),\r\n\r\n\tDCHART_COLOR_SET_1[ 3 ],\r\n\tUtilRgb.brighten( DCHART_COLOR_SET_1[ 3 ], 0.4 )\r\n];\r\n\r\nexport const DChartColorSet1 = ( index: number ): number => {\r\n\treturn DCHART_COLOR_SET_1[ index % DCHART_COLOR_SET_1.length ];\r\n};\r\n\r\nexport const DChartColorSet2 = ( index: number ): number => {\r\n\treturn DCHART_COLOR_SET_2[ index % DCHART_COLOR_SET_2.length ];\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinate, DChartCoordinateDirection } from \"./d-chart-coordinate\";\r\nimport { DChartCoordinateContainer } from \"./d-chart-coordinate-container\";\r\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\nexport class DChartCoordinateContainerSubImpl implements DChartCoordinateContainerSub {\r\n\tprotected _list: DChartCoordinate[];\r\n\tprotected _direction: DChartCoordinateDirection;\r\n\tprotected _container: DChartCoordinateContainer;\r\n\r\n\tconstructor( container: DChartCoordinateContainer, direction: DChartCoordinateDirection ) {\r\n\t\tthis._container = container;\r\n\t\tthis._direction = direction;\r\n\t\tthis._list = [];\r\n\t}\r\n\r\n\tget container(): DChartCoordinateContainer {\r\n\t\treturn this._container;\r\n\t}\r\n\r\n\tadd( coordinate: DChartCoordinate, index?: number ): this {\r\n\t\tconst list = this._list;\r\n\t\tif( index == null ) {\r\n\t\t\tlist.push( coordinate );\r\n\t\t} else if( 0 <= index && index < list.length ) {\r\n\t\t\tlist.splice( index, 0, coordinate );\r\n\t\t} else {\r\n\t\t\tlist.push( coordinate );\r\n\t\t}\r\n\t\tcoordinate.bind( this, this._direction );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tget( index: number ): DChartCoordinate | null {\r\n\t\tconst list = this._list;\r\n\t\tif( 0 <= index && index < list.length ) {\r\n\t\t\treturn list[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tindexOf( coordinate: DChartCoordinate ): number {\r\n\t\treturn this._list.indexOf( coordinate );\r\n\t}\r\n\r\n\tremove( coordinate: DChartCoordinate ): DChartCoordinate | null;\r\n\tremove( index: number ): DChartCoordinate | null;\r\n\tremove( coordinateOrIndex: DChartCoordinate | number ): DChartCoordinate | null {\r\n\t\tconst list = this._list;\r\n\t\tif( isNumber( coordinateOrIndex ) ) {\r\n\t\t\tconst index = coordinateOrIndex;\r\n\t\t\tif( 0 <= index && index < list.length ) {\r\n\t\t\t\tconst removed = list.splice( index, 1 )[ 0 ];\r\n\t\t\t\tremoved.unbind();\r\n\t\t\t\treturn removed;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst coordinate = coordinateOrIndex;\r\n\t\t\tconst index = list.indexOf( coordinate );\r\n\t\t\tif( 0 <= index ) {\r\n\t\t\t\tlist.splice( index, 1 );\r\n\t\t\t\tcoordinate.unbind();\r\n\t\t\t\treturn coordinate;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tclear(): this {\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tlist[ i ].unbind();\r\n\t\t}\r\n\t\tlist.length = 0;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdestroy(): this {\r\n\t\treturn this.clear();\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._list.length;\r\n\t}\r\n\r\n\tfit( from?: number, to?: number ): this {\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tlist[ i ].fit( from, to );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmark( from?: number, to?: number ): this {\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tlist[ i ].mark( from, to );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tblend( ratio: number ): this {\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tlist[ i ].blend( ratio );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DChartSeries } from \"./d-chart-series\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { EShape } from \"./shape/e-shape\";\r\n\r\nexport enum DChartSelectionPoint {\r\n\tPREVIOUS,\r\n\tNEXT,\r\n\tCLOSER,\r\n\tINTERSECTION\r\n}\r\n\r\nexport type DChartSelectionStyle = ( shape: EShape, series: DChartSeries ) => void;\r\n\r\nexport interface DChartSelection extends utils.EventEmitter {\r\n\tbind( container: DChartSeriesContainer ): void;\r\n\tunbind(): void;\r\n\tupdate(): void;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinateDirection } from \"./d-chart-coordinate\";\r\nimport { DChartCoordinateContainer, DChartCoordinateContainerOptions } from \"./d-chart-coordinate-container\";\r\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\r\nimport { DChartCoordinateContainerSubImpl } from \"./d-chart-coordinate-container-sub-impl\";\r\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\r\nimport { isArray } from \"./util/is-array\";\r\n\r\nexport class DChartCoordinateContainerImpl implements DChartCoordinateContainer {\r\n\tprotected _x: DChartCoordinateContainerSub;\r\n\tprotected _y: DChartCoordinateContainerSub;\r\n\tprotected _plotArea: DChartPlotArea;\r\n\r\n\tconstructor( plotArea: DChartPlotArea, options?: DChartCoordinateContainerOptions ) {\r\n\t\tthis._plotArea = plotArea;\r\n\t\tconst x = this._x = new DChartCoordinateContainerSubImpl( this, DChartCoordinateDirection.X );\r\n\t\tconst y = this._y = new DChartCoordinateContainerSubImpl( this, DChartCoordinateDirection.Y );\r\n\t\tif( options ) {\r\n\t\t\tconst cxs = options.x;\r\n\t\t\tif( cxs ) {\r\n\t\t\t\tif( isArray( cxs ) ) {\r\n\t\t\t\t\tfor( let i = 0, imax = cxs.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tx.add( cxs[ i ] );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tx.add( cxs );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst cys = options.y;\r\n\t\t\tif( cys ) {\r\n\t\t\t\tif( isArray( cys ) ) {\r\n\t\t\t\t\tfor( let i = 0, imax = cys.length; i < imax; ++i ) {\r\n\t\t\t\t\t\ty.add( cys[ i ] );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ty.add( cys );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget x(): DChartCoordinateContainerSub {\r\n\t\treturn this._x;\r\n\t}\r\n\r\n\tget y(): DChartCoordinateContainerSub {\r\n\t\treturn this._y;\r\n\t}\r\n\r\n\tget plotArea(): DChartPlotArea {\r\n\t\treturn this._plotArea;\r\n\t}\r\n\r\n\tfit( domainFrom?: number, domainTo?: number, rangeFrom?: number, rangeTo?: number ): this {\r\n\t\tthis._x.fit( domainFrom, domainTo );\r\n\t\tthis._y.fit( rangeFrom, rangeTo );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tmark( domainFrom?: number, domainTo?: number, rangeFrom?: number, rangeTo?: number ): this {\r\n\t\tthis._x.mark( domainFrom, domainTo );\r\n\t\tthis._y.mark( rangeFrom, rangeTo );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tblend( ratio: number ): this {\r\n\t\tthis._x.blend( ratio );\r\n\t\tthis._y.blend( ratio );\r\n\t\treturn this;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\n\r\nexport interface DThemeChartCoordinateLinearTick {\r\n\ttoStepScale( scale: number ): number;\r\n}\r\n\r\nexport class DChartCoordinateLinearTick {\r\n\tprotected _theme: DThemeChartCoordinateLinearTick;\r\n\r\n\tconstructor( theme: DThemeChartCoordinateLinearTick ) {\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tprotected calcStepMajor( domainMin: number, domainMax: number, count: number ): number {\r\n\t\tif( 0 < count ) {\r\n\t\t\tconst span = Math.abs( domainMax - domainMin ) / count;\r\n\t\t\tconst power = Math.floor( Math.log( span ) / Math.LN10 );\r\n\t\t\tconst base = Math.pow( 10, power );\r\n\t\t\treturn this._theme.toStepScale( span / base ) * base;\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tprotected calcStepMinor( step: number, minorCount: number ): number {\r\n\t\tif( 0 <= step ) {\r\n\t\t\treturn step / ( minorCount + 1 );\r\n\t\t} else {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected calcTickMinorPositions(\r\n\t\tstep: number, count: number, majorPosition: number,\r\n\t\trangeMin: number, rangeMax: number,\r\n\t\tiresult: number, result: Float64Array\r\n\t): void {\r\n\t\tfor( let i = 0; i < count; i += 1 ) {\r\n\t\t\tconst minorPosition = majorPosition + (i + 1) * step;\r\n\t\t\tif( rangeMin <= minorPosition && minorPosition <= rangeMax ) {\r\n\t\t\t\tresult[ iresult++ ] = minorPosition;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcalculate(\r\n\t\tdomainFrom: number, domainTo: number,\r\n\t\tmajorCount: number,\r\n\t\tminorCountPerMajor: number,\r\n\t\tminorCount: number,\r\n\t\tmajorResult: Float64Array,\r\n\t\tminorResult: Float64Array,\r\n\t\tcoordinate: DChartCoordinate\r\n\t): void {\r\n\t\tif( majorCount <= 0 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst transform = coordinate.transform;\r\n\r\n\t\tconst domainMin = Math.min( domainFrom, domainTo );\r\n\t\tconst domainMax = Math.max( domainFrom, domainTo );\r\n\r\n\t\tconst majorStep = this.calcStepMajor( domainMin, domainMax, majorCount );\r\n\t\tif( majorStep <= 0 ) {\r\n\t\t\tmajorResult[ 0 ] = domainMin;\r\n\t\t\tmajorResult[ 1 ] = transform.map( coordinate.map( domainMin ) );\r\n\t\t\tmajorResult[ 2 ] = 0;\r\n\t\t\tfor( let i = 1; i < majorCount; ++i ) {\r\n\t\t\t\tconst imajorResult = i * 3;\r\n\t\t\t\tmajorResult[ imajorResult + 0 ] = NaN;\r\n\t\t\t\tmajorResult[ imajorResult + 1 ] = NaN;\r\n\t\t\t\tmajorResult[ imajorResult + 2 ] = NaN;\r\n\t\t\t}\r\n\t\t\tfor( let i = 0; i < minorCount; ++i ) {\r\n\t\t\t\tconst iminorResult = i * 3;\r\n\t\t\t\tminorResult[ iminorResult + 0 ] = NaN;\r\n\t\t\t\tminorResult[ iminorResult + 1 ] = NaN;\r\n\t\t\t\tminorResult[ iminorResult + 2 ] = NaN;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Major tick start position\r\n\t\tconst idomainStart = Math.floor( domainMin / majorStep ) - 1;\r\n\t\tconst idomainEnd = Math.ceil( domainMax / majorStep ) + 1;\r\n\r\n\t\t// Major / minor tick positions\r\n\t\tconst minorStep = this.calcStepMinor( majorStep, minorCountPerMajor );\r\n\t\tlet imajor = 0;\r\n\t\tlet iminor = 0;\r\n\t\tfor( let i = idomainStart; i <= idomainEnd; ++i ) {\r\n\t\t\tconst majorPosition = i * majorStep;\r\n\t\t\tif( imajor < majorCount ) {\r\n\t\t\t\tif( domainMin <= majorPosition && majorPosition <= domainMax ) {\r\n\t\t\t\t\tconst majorProjectedPosition = transform.map( coordinate.map( majorPosition ) );\r\n\t\t\t\t\tconst imajorResult = imajor * 3;\r\n\t\t\t\t\tmajorResult[ imajorResult + 0 ] = majorPosition;\r\n\t\t\t\t\tmajorResult[ imajorResult + 1 ] = majorProjectedPosition;\r\n\t\t\t\t\tmajorResult[ imajorResult + 2 ] = majorStep;\r\n\t\t\t\t\timajor += 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor( let j = 0; j < minorCountPerMajor; j += 1 ) {\r\n\t\t\t\tif( iminor < minorCount ) {\r\n\t\t\t\t\tconst minorPosition = majorPosition + (j + 1) * minorStep;\r\n\t\t\t\t\tif( domainMin <= minorPosition && minorPosition <= domainMax ) {\r\n\t\t\t\t\t\tconst minorProjectedPosition = transform.map( coordinate.map( minorPosition ) );\r\n\t\t\t\t\t\tconst iminorResult = iminor * 3;\r\n\t\t\t\t\t\tminorResult[ iminorResult + 0 ] = minorPosition;\r\n\t\t\t\t\t\tminorResult[ iminorResult + 1 ] = minorProjectedPosition;\r\n\t\t\t\t\t\tminorResult[ iminorResult + 2 ] = minorStep;\r\n\t\t\t\t\t\timinor += 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor( let i = imajor; i < majorCount; ++i ) {\r\n\t\t\tconst imajorResult = i * 3;\r\n\t\t\tmajorResult[ imajorResult + 0 ] = NaN;\r\n\t\t\tmajorResult[ imajorResult + 1 ] = NaN;\r\n\t\t\tmajorResult[ imajorResult + 2 ] = NaN;\r\n\t\t}\r\n\t\tfor( let i = iminor; i < minorCount; ++i ) {\r\n\t\t\tconst iminorResult = i * 3;\r\n\t\t\tminorResult[ iminorResult + 0 ] = NaN;\r\n\t\t\tminorResult[ iminorResult + 1 ] = NaN;\r\n\t\t\tminorResult[ iminorResult + 2 ] = NaN;\r\n\t\t}\r\n\t}\r\n}\r\n","import { DChartCoordinateDirection } from \"./d-chart-coordinate\";\r\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\r\nimport { DChartCoordinateTransform, DThemeChartCoordinateTransform } from \"./d-chart-coordinate-transform\";\r\nimport { DChartCoordinateTransformMark } from \"./d-chart-coordinate-transform-mark\";\r\n\r\nexport class DChartCoordinateTransformImpl implements DChartCoordinateTransform {\r\n\tprotected _theme: DThemeChartCoordinateTransform;\r\n\tprotected _id: number;\r\n\tprotected _translate: number;\r\n\tprotected _scale: number;\r\n\tprotected _itranslate: number;\r\n\tprotected _iscale: number;\r\n\r\n\tconstructor( theme: DThemeChartCoordinateTransform ) {\r\n\t\tthis._theme = theme;\r\n\t\tthis._id = 0;\r\n\t\tthis._translate = 0;\r\n\t\tthis._scale = 1;\r\n\t\tthis._itranslate = 0;\r\n\t\tthis._iscale = 1;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget translate(): number {\r\n\t\treturn this._translate;\r\n\t}\r\n\r\n\tset translate( translate: number ) {\r\n\t\tthis.set( translate );\r\n\t}\r\n\r\n\tget scale(): number {\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\tset scale( scale: number ) {\r\n\t\tthis.set( undefined, scale );\r\n\t}\r\n\r\n\tbind( container: DChartCoordinateContainerSub, direction: DChartCoordinateDirection ): void {\r\n\t\tthis.set( 0, direction === DChartCoordinateDirection.X ? +1 : -1 );\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tset( translate?: number, scale?: number ): void {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( translate != null && this._translate !== translate ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tthis._translate = translate;\r\n\t\t}\r\n\r\n\t\tif( scale != null && this._scale !== scale ) {\r\n\t\t\tisChanged = true;\r\n\t\t\tthis._scale = scale;\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._iscale = ( this._theme.isZero( this._scale ) ? 0 : 1 / this._scale );\r\n\t\t\tthis._itranslate = - this._translate * this._iscale;\r\n\t\t}\r\n\t}\r\n\r\n\tblend( ratio: number, mark: DChartCoordinateTransformMark ): void {\r\n\t\tconst ratioi = 1 - ratio;\r\n\t\tconst newTranslate = mark.newTranslate * ratio + mark.oldTranslate * ratioi;\r\n\t\tconst newScale = mark.newScale * ratio + mark.oldScale * ratioi;\r\n\t\tthis.set( newTranslate, newScale );\r\n\t}\r\n\r\n\tmap( value: number ): number {\r\n\t\treturn this._translate + this._scale * value;\r\n\t}\r\n\r\n\tmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void {\r\n\t\tconst translate = this._translate;\r\n\t\tconst scale = this._scale;\r\n\t\tfor( let i = ifrom + offset; i < iend; i += stride ) {\r\n\t\t\tvalues[ i ] = translate + scale * values[ i ];\r\n\t\t}\r\n\t}\r\n\r\n\tunmap( value: number ): number {\r\n\t\treturn this._itranslate + this._iscale * value;\r\n\t}\r\n\r\n\tunmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void {\r\n\t\tconst itranslate = this._itranslate;\r\n\t\tconst iscale = this._iscale;\r\n\t\tfor( let i = ifrom + offset; i < iend; i += stride ) {\r\n\t\t\tvalues[ i ] = itranslate + iscale * values[ i ];\r\n\t\t}\r\n\t}\r\n}\r\n","export interface DChartCoordinateTransformMark {\r\n\toldTranslate: number;\r\n\toldScale: number;\r\n\tnewTranslate: number;\r\n\tnewScale: number;\r\n\tset( translate?: number, scale?: number ): void;\r\n}\r\n\r\nexport class DChartCoordinateTransformMarkImpl implements DChartCoordinateTransformMark {\r\n\toldTranslate: number;\r\n\toldScale: number;\r\n\tnewTranslate: number;\r\n\tnewScale: number;\r\n\r\n\tconstructor() {\r\n\t\tthis.oldTranslate = 0;\r\n\t\tthis.oldScale = 1;\r\n\t\tthis.newTranslate = 0;\r\n\t\tthis.newScale = 1;\r\n\t}\r\n\r\n\tset( translate?: number | undefined, scale?: number | undefined ): void {\r\n\t\tif( translate != null ) {\r\n\t\t\tthis.newTranslate = translate;\r\n\t\t}\r\n\r\n\t\tif( scale != null ) {\r\n\t\t\tthis.newScale = scale;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartRegion } from \"./d-chart-region\";\r\nimport { isNaN } from \"./util/is-nan\";\r\n\r\nexport class DChartRegionImpl implements DChartRegion {\r\n\tfrom: number;\r\n\tto: number;\r\n\r\n\tconstructor( from: number, to: number ) {\r\n\t\tthis.from = from;\r\n\t\tthis.to = to;\r\n\t}\r\n\r\n\tset( from?: number, to?: number ): this {\r\n\t\tif( from != null ) {\r\n\t\t\tthis.from = from;\r\n\t\t}\r\n\t\tif( to != null ) {\r\n\t\t\tthis.to = to;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tadd( from: number, to: number ): this {\r\n\t\tif( ! isNaN( from ) ) {\r\n\t\t\tthis.from = ( isNaN( this.from ) ?\r\n\t\t\t\tfrom : Math.min( this.from, from )\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif( ! isNaN( to ) ) {\r\n\t\t\tthis.to = ( isNaN( this.to ) ?\r\n\t\t\t\tto : Math.max( this.to, to )\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tclear(): this {\r\n\t\tthis.from = NaN;\r\n\t\tthis.to = NaN;\r\n\t\treturn this;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinate, DChartCoordinateDirection } from \"./d-chart-coordinate\";\r\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\r\nimport { DChartCoordinateLinearTick, DThemeChartCoordinateLinearTick } from \"./d-chart-coordinate-linear-tick\";\r\nimport { DChartCoordinateTransform, DThemeChartCoordinateTransform } from \"./d-chart-coordinate-transform\";\r\nimport { DChartCoordinateTransformImpl } from \"./d-chart-coordinate-transform-impl\";\r\nimport { DChartCoordinateTransformMark, DChartCoordinateTransformMarkImpl } from \"./d-chart-coordinate-transform-mark\";\r\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\r\nimport { DChartRegion } from \"./d-chart-region\";\r\nimport { DChartRegionImpl } from \"./d-chart-region-impl\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\nimport { isNaN } from \"./util/is-nan\";\r\n\r\nexport interface DThemeChartCoordinateLinear extends DThemeChartCoordinateTransform, DThemeChartCoordinateLinearTick {\r\n\r\n}\r\n\r\nexport interface DChartCoordinateLinearOptions {\r\n\ttheme?: DThemeChartCoordinateLinear;\r\n}\r\n\r\nexport class DChartCoordinateLinear implements DChartCoordinate {\r\n\tprotected _id: number;\r\n\tprotected _transform: DChartCoordinateTransform;\r\n\tprotected _container?: DChartCoordinateContainerSub;\r\n\tprotected _direction: DChartCoordinateDirection;\r\n\tprotected _theme: DThemeChartCoordinateLinear;\r\n\tprotected _work: DChartRegionImpl;\r\n\tprotected _tick: DChartCoordinateLinearTick;\r\n\tprotected _mark: DChartCoordinateTransformMarkImpl;\r\n\r\n\tconstructor( options?: DChartCoordinateLinearOptions ) {\r\n\t\tthis._id = 0;\r\n\t\tthis._direction = DChartCoordinateDirection.X;\r\n\t\tconst theme = this.toTheme( options );\r\n\t\tthis._theme = theme;\r\n\t\tthis._transform = new DChartCoordinateTransformImpl( theme );\r\n\t\tthis._tick = new DChartCoordinateLinearTick( theme );\r\n\t\tthis._work = new DChartRegionImpl( NaN, NaN );\r\n\t\tthis._mark = new DChartCoordinateTransformMarkImpl();\r\n\t}\r\n\r\n\tbind( container: DChartCoordinateContainerSub, direction: DChartCoordinateDirection ): void {\r\n\t\tthis._container = container;\r\n\t\tthis._direction = direction;\r\n\t\tthis._transform.bind( container, direction );\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tthis._container = undefined;\r\n\t\tthis._transform.unbind();\r\n\t}\r\n\r\n\tfit( from?: number, to?: number ): void {\r\n\t\tthis.doFit( from, to, this._transform );\r\n\t}\r\n\r\n\tmark( from?: number, to?: number ): void {\r\n\t\tconst mark = this._mark;\r\n\t\tconst transform = this._transform;\r\n\t\tmark.oldTranslate = transform.translate;\r\n\t\tmark.oldScale = transform.scale;\r\n\t\tthis.doFit( from, to, mark );\r\n\t}\r\n\r\n\tblend( ratio: number ): void {\r\n\t\tthis._transform.blend( ratio, this._mark );\r\n\t}\r\n\r\n\tprotected doFit(\r\n\t\tfrom: number | undefined, to: number | undefined,\r\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform\r\n\t): void {\r\n\t\tconst container = this._container;\r\n\t\tif( container ) {\r\n\t\t\tconst plotArea = container.container.plotArea;\r\n\t\t\tconst padding = plotArea.padding;\r\n\t\t\tconst work = this._work;\r\n\t\t\tswitch( this._direction ) {\r\n\t\t\tcase DChartCoordinateDirection.X:\r\n\t\t\t\tthis.doFit_(\r\n\t\t\t\t\tpadding.getLeft(), plotArea.width - padding.getRight(),\r\n\t\t\t\t\tthis.toFitDomain( from, to, plotArea, work ),\r\n\t\t\t\t\tresult\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase DChartCoordinateDirection.Y:\r\n\t\t\t\tthis.doFit_(\r\n\t\t\t\t\tplotArea.height - padding.getBottom(), padding.getTop(),\r\n\t\t\t\t\tthis.toFitRange( from, to, plotArea, work ),\r\n\t\t\t\t\tresult\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toFitDomain(\r\n\t\tfrom: number | undefined, to: number | undefined,\r\n\t\tplotArea: DChartPlotArea,\r\n\t\tresult: DChartRegion\r\n\t): DChartRegion {\r\n\t\tif( from != null && to != null ) {\r\n\t\t\tresult.set( from, to );\r\n\t\t} else {\r\n\t\t\tplotArea.series.getDomain( this, result );\r\n\t\t\tresult.set( from, to );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected toFitRange(\r\n\t\tfrom: number | undefined, to: number | undefined,\r\n\t\tplotArea: DChartPlotArea,\r\n\t\tresult: DChartRegion\r\n\t): DChartRegion {\r\n\t\tif( from != null && to != null ) {\r\n\t\t\tresult.set( from, to );\r\n\t\t} else {\r\n\t\t\tplotArea.series.getRange( this, result );\r\n\t\t\tresult.set( from, to );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected doFit_(\r\n\t\tpixelFrom: number, pixelTo: number,\r\n\t\tregion: DChartRegion,\r\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform\r\n\t): void {\r\n\t\tconst regionFrom = region.from;\r\n\t\tconst regionTo = region.to;\r\n\t\tif( ! (isNaN( regionFrom ) || isNaN( regionTo )) ) {\r\n\t\t\t// Scale\r\n\t\t\tlet newScale = 1;\r\n\t\t\tconst regionSize = ( regionTo - regionFrom );\r\n\t\t\tif( ! this._theme.isZero( regionSize ) ) {\r\n\t\t\t\tconst pixelSize = ( pixelTo - pixelFrom );\r\n\t\t\t\tnewScale = pixelSize / regionSize;\r\n\t\t\t} else {\r\n\t\t\t\tnewScale = ( pixelTo < pixelFrom ? -1 : 1 );\r\n\t\t\t}\r\n\r\n\t\t\t// Translation\r\n\t\t\tconst newTranslation = pixelFrom - regionFrom * newScale;\r\n\r\n\t\t\t// Done\r\n\t\t\tresult.set( newTranslation, newScale );\r\n\t\t}\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget transform(): DChartCoordinateTransform {\r\n\t\treturn this._transform;\r\n\t}\r\n\r\n\tmap( value: number ): number {\r\n\t\treturn value;\r\n\t}\r\n\r\n\tmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tunmap( value: number ): number {\r\n\t\treturn value;\r\n\t}\r\n\r\n\tunmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tticks(\r\n\t\tdomainFrom: number, domainTo: number,\r\n\t\tmajorCount: number,\r\n\t\tminorCountPerMajor: number,\r\n\t\tminorCount: number,\r\n\t\tmajorResult: Float64Array,\r\n\t\tminorResult: Float64Array\r\n\t): void {\r\n\t\tthis._tick.calculate(\r\n\t\t\tdomainFrom, domainTo,\r\n\t\t\tmajorCount,\r\n\t\t\tminorCountPerMajor,\r\n\t\t\tminorCount,\r\n\t\t\tmajorResult,\r\n\t\t\tminorResult,\r\n\t\t\tthis\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toTheme( options?: DChartCoordinateLinearOptions ): DThemeChartCoordinateLinear {\r\n\t\treturn ( options && options.theme ) || this.getThemeDefault();\r\n\t}\r\n\r\n\tprotected getThemeDefault(): DThemeChartCoordinateLinear {\r\n\t\treturn DThemes.getInstance().get( this.getType() );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartCoordinateLinear\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\n\r\nexport interface DThemeChartCoordinateLogTick {\r\n\ttoStepScale( scale: number ): number;\r\n}\r\n\r\nexport class DChartCoordinateLogTick {\r\n\tprotected _theme: DThemeChartCoordinateLogTick;\r\n\r\n\tconstructor( theme: DThemeChartCoordinateLogTick ) {\r\n\t\tthis._theme = theme;\r\n\t}\r\n\r\n\tprotected calcStepMajor( domainMin: number, domainMax: number, count: number ): number {\r\n\t\tif( 0 < count ) {\r\n\t\t\tconst span = Math.abs( domainMax - domainMin ) / count;\r\n\t\t\tconst power = Math.floor( Math.log( span ) / Math.LN10 );\r\n\t\t\tconst base = Math.pow( 10, power );\r\n\t\t\treturn this._theme.toStepScale( span / base ) * base;\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tprotected calcStepMinor( step: number, minorCount: number ): number {\r\n\t\tif( 0 <= step ) {\r\n\t\t\treturn step / ( minorCount + 1 );\r\n\t\t} else {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected calcTickMinorPositions(\r\n\t\tstep: number, count: number, majorPosition: number,\r\n\t\trangeMin: number, rangeMax: number,\r\n\t\tiresult: number, result: Float64Array\r\n\t): void {\r\n\t\tfor( let i = 0; i < count; i += 1 ) {\r\n\t\t\tconst minorPosition = majorPosition + (i + 1) * step;\r\n\t\t\tif( rangeMin <= minorPosition && minorPosition <= rangeMax ) {\r\n\t\t\t\tresult[ iresult++ ] = minorPosition;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcalculate(\r\n\t\tdomainFrom: number, domainTo: number,\r\n\t\tmajorCount: number,\r\n\t\tminorCountPerMajor: number,\r\n\t\tminorCount: number,\r\n\t\tmajorResult: Float64Array,\r\n\t\tminorResult: Float64Array,\r\n\t\tcoordinate: DChartCoordinate\r\n\t): void {\r\n\t\tif( majorCount <= 0 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst transform = coordinate.transform;\r\n\r\n\t\tconst domainFromMapped = coordinate.map( domainFrom );\r\n\t\tconst domainToMapped = coordinate.map( domainTo );\r\n\r\n\t\tconst domainMinMapped = Math.min( domainFromMapped, domainToMapped );\r\n\t\tconst domainMaxMapped = Math.max( domainFromMapped, domainToMapped );\r\n\r\n\t\tconst majorStepMapped = this.calcStepMajor( domainMinMapped, domainMaxMapped, majorCount );\r\n\t\tif( majorStepMapped <= 0 ) {\r\n\t\t\tconst domainMin = Math.min( domainFrom, domainTo );\r\n\t\t\tmajorResult[ 0 ] = domainMin;\r\n\t\t\tmajorResult[ 1 ] = transform.map( coordinate.map( domainMin ) );\r\n\t\t\tmajorResult[ 2 ] = 0;\r\n\t\t\tfor( let i = 1; i < majorCount; ++i ) {\r\n\t\t\t\tconst imajorResult = i * 3;\r\n\t\t\t\tmajorResult[ imajorResult + 0 ] = NaN;\r\n\t\t\t\tmajorResult[ imajorResult + 1 ] = NaN;\r\n\t\t\t\tmajorResult[ imajorResult + 2 ] = NaN;\r\n\t\t\t}\r\n\t\t\tfor( let i = 0; i < minorCount; ++i ) {\r\n\t\t\t\tconst iminorResult = i * 3;\r\n\t\t\t\tminorResult[ iminorResult + 0 ] = NaN;\r\n\t\t\t\tminorResult[ iminorResult + 1 ] = NaN;\r\n\t\t\t\tminorResult[ iminorResult + 2 ] = NaN;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Major tick start position\r\n\t\tconst idomainStartMapped = Math.floor( domainMinMapped / majorStepMapped ) - 1;\r\n\t\tconst idomainEndMapped = Math.ceil( domainMaxMapped / majorStepMapped ) + 1;\r\n\r\n\t\t// Major / minor tick positions\r\n\t\tconst minorStepMapped = this.calcStepMinor( majorStepMapped, minorCountPerMajor );\r\n\t\tlet imajor = 0;\r\n\t\tlet iminor = 0;\r\n\t\tfor( let i = idomainStartMapped; i <= idomainEndMapped; ++i ) {\r\n\t\t\tconst majorPositionMapped = i * majorStepMapped;\r\n\t\t\tif( imajor < majorCount ) {\r\n\t\t\t\tif( domainMinMapped <= majorPositionMapped && majorPositionMapped <= domainMaxMapped ) {\r\n\t\t\t\t\tconst majorPosition = coordinate.unmap( majorPositionMapped );\r\n\t\t\t\t\tconst majorProjectedPosition = transform.map( majorPositionMapped );\r\n\t\t\t\t\tconst majorStep = coordinate.unmap( majorPositionMapped - 1 );\r\n\t\t\t\t\tconst imajorResult = imajor * 3;\r\n\t\t\t\t\tmajorResult[ imajorResult + 0 ] = majorPosition;\r\n\t\t\t\t\tmajorResult[ imajorResult + 1 ] = majorProjectedPosition;\r\n\t\t\t\t\tmajorResult[ imajorResult + 2 ] = majorStep;\r\n\t\t\t\t\timajor += 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor( let j = 0; j < minorCountPerMajor; j += 1 ) {\r\n\t\t\t\tif( iminor < minorCount ) {\r\n\t\t\t\t\tconst minorPositionMapped = majorPositionMapped + (j + 1) * minorStepMapped;\r\n\t\t\t\t\tif( domainMinMapped <= minorPositionMapped && minorPositionMapped <= domainMaxMapped ) {\r\n\t\t\t\t\t\tconst minorPosition = coordinate.unmap( minorPositionMapped );\r\n\t\t\t\t\t\tconst minorProjectedPosition = transform.map( minorPositionMapped );\r\n\t\t\t\t\t\tconst minorStep = coordinate.unmap( minorPositionMapped - 1 );\r\n\t\t\t\t\t\tconst iminorResult = iminor * 3;\r\n\t\t\t\t\t\tminorResult[ iminorResult + 0 ] = minorPosition;\r\n\t\t\t\t\t\tminorResult[ iminorResult + 1 ] = minorProjectedPosition;\r\n\t\t\t\t\t\tminorResult[ iminorResult + 2 ] = minorStep;\r\n\t\t\t\t\t\timinor += 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor( let i = imajor; i < majorCount; ++i ) {\r\n\t\t\tconst imajorResult = i * 3;\r\n\t\t\tmajorResult[ imajorResult + 0 ] = NaN;\r\n\t\t\tmajorResult[ imajorResult + 1 ] = NaN;\r\n\t\t\tmajorResult[ imajorResult + 2 ] = NaN;\r\n\t\t}\r\n\t\tfor( let i = iminor; i < minorCount; ++i ) {\r\n\t\t\tconst iminorResult = i * 3;\r\n\t\t\tminorResult[ iminorResult + 0 ] = NaN;\r\n\t\t\tminorResult[ iminorResult + 1 ] = NaN;\r\n\t\t\tminorResult[ iminorResult + 2 ] = NaN;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinate, DChartCoordinateDirection } from \"./d-chart-coordinate\";\r\nimport { DChartCoordinateContainerSub } from \"./d-chart-coordinate-container-sub\";\r\nimport { DChartCoordinateLogTick, DThemeChartCoordinateLogTick } from \"./d-chart-coordinate-log-tick\";\r\nimport { DChartCoordinateTransform, DThemeChartCoordinateTransform } from \"./d-chart-coordinate-transform\";\r\nimport { DChartCoordinateTransformImpl } from \"./d-chart-coordinate-transform-impl\";\r\nimport { DChartCoordinateTransformMark, DChartCoordinateTransformMarkImpl } from \"./d-chart-coordinate-transform-mark\";\r\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\r\nimport { DChartRegion } from \"./d-chart-region\";\r\nimport { DChartRegionImpl } from \"./d-chart-region-impl\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\nimport { isNaN } from \"./util/is-nan\";\r\n\r\nexport interface DThemeChartCoordinateLog extends DThemeChartCoordinateTransform, DThemeChartCoordinateLogTick {\r\n\r\n}\r\n\r\nexport interface DChartCoordinateLogOptions {\r\n\ttheme?: DThemeChartCoordinateLog;\r\n}\r\n\r\nexport class DChartCoordinateLog implements DChartCoordinate {\r\n\tprotected _id: number;\r\n\tprotected _transform: DChartCoordinateTransform;\r\n\tprotected _container?: DChartCoordinateContainerSub;\r\n\tprotected _direction: DChartCoordinateDirection;\r\n\tprotected _theme: DThemeChartCoordinateLog;\r\n\tprotected _work: DChartRegionImpl;\r\n\tprotected _tick: DChartCoordinateLogTick;\r\n\tprotected _mark: DChartCoordinateTransformMarkImpl;\r\n\r\n\tconstructor( options?: DChartCoordinateLogOptions ) {\r\n\t\tthis._id = 0;\r\n\t\tthis._direction = DChartCoordinateDirection.X;\r\n\t\tconst theme = this.toTheme( options );\r\n\t\tthis._theme = theme;\r\n\t\tthis._transform = new DChartCoordinateTransformImpl( theme );\r\n\t\tthis._tick = new DChartCoordinateLogTick( theme );\r\n\t\tthis._work = new DChartRegionImpl( NaN, NaN );\r\n\t\tthis._mark = new DChartCoordinateTransformMarkImpl();\r\n\t}\r\n\r\n\tbind( container: DChartCoordinateContainerSub, direction: DChartCoordinateDirection ): void {\r\n\t\tthis._container = container;\r\n\t\tthis._direction = direction;\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tthis._container = undefined;\r\n\t}\r\n\r\n\tfit( from?: number, to?: number ): void {\r\n\t\tthis.doFit( from, to, this._transform );\r\n\t}\r\n\r\n\tmark( from?: number, to?: number ): void {\r\n\t\tconst mark = this._mark;\r\n\t\tconst transform = this._transform;\r\n\t\tmark.oldTranslate = transform.translate;\r\n\t\tmark.oldScale = transform.scale;\r\n\t\tthis.doFit( from, to, mark );\r\n\t}\r\n\r\n\tblend( ratio: number ): void {\r\n\t\tthis._transform.blend( ratio, this._mark );\r\n\t}\r\n\r\n\tprotected doFit(\r\n\t\tfrom: number | undefined,\r\n\t\tto: number | undefined,\r\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform\r\n\t): void {\r\n\t\tconst container = this._container;\r\n\t\tif( container ) {\r\n\t\t\tconst plotArea = container.container.plotArea;\r\n\t\t\tconst padding = plotArea.padding;\r\n\t\t\tconst work = this._work;\r\n\t\t\tswitch( this._direction ) {\r\n\t\t\tcase DChartCoordinateDirection.X:\r\n\t\t\t\tthis.doFit_(\r\n\t\t\t\t\tpadding.getLeft(), plotArea.width - padding.getRight(),\r\n\t\t\t\t\tthis.toFitDomain( from, to, plotArea, work ),\r\n\t\t\t\t\tresult\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\tcase DChartCoordinateDirection.Y:\r\n\t\t\t\tthis.doFit_(\r\n\t\t\t\t\tplotArea.height - padding.getBottom(), padding.getTop(),\r\n\t\t\t\t\tthis.toFitRange( from, to, plotArea, work ),\r\n\t\t\t\t\tresult\r\n\t\t\t\t);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toFitDomain(\r\n\t\tfrom: number | undefined, to: number | undefined,\r\n\t\tplotArea: DChartPlotArea,\r\n\t\tresult: DChartRegion\r\n\t): DChartRegion {\r\n\t\tif( from != null && to != null ) {\r\n\t\t\tresult.set( from, to );\r\n\t\t} else {\r\n\t\t\tplotArea.series.getDomain( this, result );\r\n\t\t\tresult.set( from, to );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected toFitRange(\r\n\t\tfrom: number | undefined, to: number | undefined,\r\n\t\tplotArea: DChartPlotArea,\r\n\t\tresult: DChartRegion\r\n\t): DChartRegion {\r\n\t\tif( from != null && to != null ) {\r\n\t\t\tresult.set( from, to );\r\n\t\t} else {\r\n\t\t\tplotArea.series.getRange( this, result );\r\n\t\t\tresult.set( from, to );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected doFit_(\r\n\t\tpixelFrom: number, pixelTo: number, region: DChartRegion,\r\n\t\tresult: DChartCoordinateTransformMark | DChartCoordinateTransform\r\n\t): void {\r\n\t\tconst regionFrom = region.from;\r\n\t\tconst regionTo = region.to;\r\n\t\tif( ! (isNaN( regionFrom ) || isNaN( regionTo )) ) {\r\n\t\t\t// Scale\r\n\t\t\tlet newScale = 1;\r\n\t\t\tconst regionFromMapped = this.map( regionFrom );\r\n\t\t\tconst regionToMapped = this.map( regionTo );\r\n\t\t\tconst regionSizeMapped = ( regionToMapped - regionFromMapped );\r\n\t\t\tif( ! this._theme.isZero( regionSizeMapped ) ) {\r\n\t\t\t\tconst pixelSize = ( pixelTo - pixelFrom );\r\n\t\t\t\tnewScale = pixelSize / regionSizeMapped;\r\n\t\t\t} else {\r\n\t\t\t\tnewScale = ( pixelTo < pixelFrom ? -1 : 1 );\r\n\t\t\t}\r\n\r\n\t\t\t// Translation\r\n\t\t\tconst newTranslation = pixelFrom - regionFromMapped * newScale;\r\n\r\n\t\t\t// Done\r\n\t\t\tresult.set( newTranslation, newScale );\r\n\t\t}\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget transform(): DChartCoordinateTransform {\r\n\t\treturn this._transform;\r\n\t}\r\n\r\n\tmap( value: number ): number {\r\n\t\treturn Math.log( Math.max( 0, value ) ) / Math.LN10;\r\n\t}\r\n\r\n\tmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void {\r\n\t\tconst factor = 1 / Math.LN10;\r\n\t\tfor( let i = ifrom + offset; i < iend; i += stride ) {\r\n\t\t\tconst value = values[ i ];\r\n\t\t\tvalues[ i ] = Math.log( Math.max( 0, value ) ) * factor;\r\n\t\t}\r\n\t}\r\n\r\n\tunmap( value: number ): number {\r\n\t\treturn Math.pow( 10, value );\r\n\t}\r\n\r\n\tunmapAll( values: number[], ifrom: number, iend: number, stride: number, offset: number ): void {\r\n\t\tfor( let i = ifrom + offset; i < iend; i += stride ) {\r\n\t\t\tvalues[ i ] = Math.pow( 10, values[ i ] );\r\n\t\t}\r\n\t}\r\n\r\n\tticks(\r\n\t\tdomainFrom: number, domainTo: number,\r\n\t\tmajorCount: number,\r\n\t\tminorCountPerMajor: number,\r\n\t\tminorCount: number,\r\n\t\tmajorResult: Float64Array,\r\n\t\tminorResult: Float64Array\r\n\t): void {\r\n\t\tthis._tick.calculate(\r\n\t\t\tdomainFrom, domainTo,\r\n\t\t\tmajorCount,\r\n\t\t\tminorCountPerMajor,\r\n\t\t\tminorCount,\r\n\t\t\tmajorResult,\r\n\t\t\tminorResult,\r\n\t\t\tthis\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toTheme( options?: DChartCoordinateLogOptions ): DThemeChartCoordinateLog {\r\n\t\treturn ( options && options.theme ) || this.getThemeDefault();\r\n\t}\r\n\r\n\tprotected getThemeDefault(): DThemeChartCoordinateLog {\r\n\t\treturn DThemes.getInstance().get( this.getType() );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartCoordinateLog\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\n\r\nexport interface DChartLegendItemOptions<THEME extends DThemeChartLegendItem> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeChartLegendItem extends DThemeBase {\r\n}\r\n\r\nexport class DChartLegendItem<\r\n\tTHEME extends DThemeChartLegendItem = DThemeChartLegendItem,\r\n\tOPTIONS extends DChartLegendItemOptions<THEME> = DChartLegendItemOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartLegendItem\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\n\r\nexport interface DChartLegendOptions<THEME extends DThemeChartLegend> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeChartLegend extends DThemeBase {\r\n}\r\n\r\nexport class DChartLegend<\r\n\tTHEME extends DThemeChartLegend = DThemeChartLegend,\r\n\tOPTIONS extends DChartLegendOptions<THEME> = DChartLegendOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartLegend\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\n\r\nexport interface DChartOverviewOptions<THEME extends DThemeChartOverview> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeChartOverview extends DThemeBase {\r\n}\r\n\r\nexport class DChartOverview<\r\n\tTHEME extends DThemeChartOverview = DThemeChartOverview,\r\n\tOPTIONS extends DChartOverviewOptions<THEME> = DChartOverviewOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartOverview\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Rectangle, Transform } from \"pixi.js\";\r\nimport { DBasePoint } from \"./d-base-point\";\r\nimport { DViewTarget } from \"./d-view-to-target\";\r\nimport { EShapeContainer } from \"./shape/e-shape-container\";\r\n\r\nexport class DChartPlotAreaContainer extends EShapeContainer implements DViewTarget {\r\n\tprotected _position: DBasePoint;\r\n\tprotected _scale: DBasePoint;\r\n\tprotected _workRect: Rectangle;\r\n\r\n\tconstructor( onChange: () => void ) {\r\n\t\tsuper();\r\n\t\tconst transform: Transform = this.transform;\r\n\t\tthis._position = new DBasePoint( transform.position, onChange );\r\n\t\tthis._scale = new DBasePoint( transform.scale, onChange );\r\n\t\tthis._workRect = new Rectangle();\r\n\t}\r\n\r\n\tget position(): DBasePoint {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tget scale(): DBasePoint {\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\tgetBounds( skipUpdate?: boolean, rect?: Rectangle ): Rectangle {\r\n\t\t(this as any)._lastBoundsID = -1;\r\n\t\treturn super.getBounds( skipUpdate, rect );\r\n\t}\r\n\r\n\tcalculateBounds(): void {\r\n\t\tconst bounds = this._bounds;\r\n\t\tconst work = this._work;\r\n\t\tconst rect = this._workRect;\r\n\t\tconst worldTransform = this.transform.worldTransform;\r\n\r\n\t\tlet xmin = 0;\r\n\t\tlet xmax = 0;\r\n\t\tlet ymin = 0;\r\n\t\tlet ymax = 0;\r\n\t\tconst children = this.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\tlet isFirst = true;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child.visible ) {\r\n\t\t\t\t\tchild.getBoundsInternal( work, false, rect );\r\n\t\t\t\t\tif( isFirst ) {\r\n\t\t\t\t\t\tisFirst = false;\r\n\t\t\t\t\t\txmin = rect.x;\r\n\t\t\t\t\t\tymin = rect.y;\r\n\t\t\t\t\t\txmax = rect.x + rect.width;\r\n\t\t\t\t\t\tymax = rect.y + rect.height;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\txmin = Math.min( xmin, rect.x );\r\n\t\t\t\t\t\tymin = Math.min( ymin, rect.y );\r\n\t\t\t\t\t\txmax = Math.max( xmax, rect.x + rect.width );\r\n\t\t\t\t\t\tymax = Math.max( ymax, rect.y + rect.height );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbounds.clear();\r\n\r\n\t\twork.set( xmin, ymin );\r\n\t\tworldTransform.apply( work, work );\r\n\t\tbounds.addPoint( work );\r\n\r\n\t\twork.set( xmax, ymax );\r\n\t\tworldTransform.apply( work, work );\r\n\t\tbounds.addPoint( work );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DChartRegionImmutable } from \"./d-chart-region\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { DChartSeriesCoordinateContainer } from \"./d-chart-series-coordinate\";\r\nimport { EShape } from \"./shape/e-shape\";\r\n\r\nexport class DChartSeriesHitResult {\r\n\tshape: EShape | null;\r\n\tx: number;\r\n\ty: number;\r\n\tp0x: number;\r\n\tp0y: number;\r\n\tp1x: number;\r\n\tp1y: number;\r\n\tindex: number;\r\n\tt: number;\r\n\tdistance: number;\r\n\r\n\tconstructor() {\r\n\t\tthis.shape = null;\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t\tthis.p0x = 0;\r\n\t\tthis.p0y = 0;\r\n\t\tthis.p1x = 0;\r\n\t\tthis.p1y = 0;\r\n\t\tthis.index = 0;\r\n\t\tthis.t = 0;\r\n\t\tthis.distance = 0;\r\n\t}\r\n\r\n\tcopyFrom( other: DChartSeriesHitResult ): this {\r\n\t\tthis.shape = other.shape;\r\n\t\tthis.x = other.x;\r\n\t\tthis.y = other.y;\r\n\t\tthis.p0x = other.p0x;\r\n\t\tthis.p0y = other.p0y;\r\n\t\tthis.p1x = other.p1x;\r\n\t\tthis.p1y = other.p1y;\r\n\t\tthis.index = other.index;\r\n\t\tthis.t = other.t;\r\n\t\tthis.distance = other.distance;\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nexport interface DChartSeries {\r\n\treadonly domain: DChartRegionImmutable;\r\n\treadonly range: DChartRegionImmutable;\r\n\treadonly shape: EShape | null;\r\n\treadonly container: DChartSeriesContainer | null;\r\n\treadonly coordinate: DChartSeriesCoordinateContainer;\r\n\treadonly index: number;\r\n\r\n\tbind( container: DChartSeriesContainer, index: number ): void;\r\n\tunbind(): void;\r\n\r\n\ttoDirty(): void;\r\n\r\n\tupdate(): void;\r\n\tdestroy(): void;\r\n\r\n\thitTest( global: IPoint ): boolean;\r\n\tcalcHitPoint( global: IPoint, result: DChartSeriesHitResult ): boolean;\r\n\r\n\tsetState( state: DBaseState, isOn: boolean ): void;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesFill } from \"./d-chart-series-fill\";\r\nimport { DChartSeriesFillComputed, DChartSeriesFillComputedOptions } from \"./d-chart-series-fill-computed\";\r\n\r\nexport class DChartSeriesFillComputedImpl implements DChartSeriesFillComputed {\r\n\tenable: boolean;\r\n\tcolor: number;\r\n\talpha: number;\r\n\r\n\tconstructor( enable: boolean, color: number, alpha: number ) {\r\n\t\tthis.enable = enable;\r\n\t\tthis.color = color;\r\n\t\tthis.alpha = alpha;\r\n\t}\r\n\r\n\tstatic from(\r\n\t\tbase: DChartSeriesFill, index: number,\r\n\t\tfill?: DChartSeriesFillComputedOptions\r\n\t): DChartSeriesFillComputed {\r\n\t\tif( fill ) {\r\n\t\t\treturn new DChartSeriesFillComputedImpl(\r\n\t\t\t\t( fill.enable != null ? fill.enable : base.enable( index ) ),\r\n\t\t\t\t( fill.color != null ? fill.color : base.color( index ) ),\r\n\t\t\t\t( fill.alpha != null ? fill.alpha : base.alpha( index ) )\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn new DChartSeriesFillComputedImpl(\r\n\t\t\t\tbase.enable( index ),\r\n\t\t\t\tbase.color( index ),\r\n\t\t\t\tbase.alpha( index )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { isArray } from \"./util/is-array\";\r\nimport { isFunction } from \"./util/is-function\";\r\n\r\nexport type DChartSeriesScalar<T> = ( index: number ) => T;\r\n\r\nexport class DChartSeriesScalars {\r\n\tstatic from<T>(\r\n\t\tvalue: T | T[] | DChartSeriesScalar<T> | undefined,\r\n\t\tdef: T | T[] | DChartSeriesScalar<T>\r\n\t): DChartSeriesScalar<T> {\r\n\t\tif( isArray( value ) ) {\r\n\t\t\treturn ( index: number ) => value[ index % value.length ];\r\n\t\t} else if( isFunction( value ) ) {\r\n\t\t\treturn value;\r\n\t\t} else if( value != null ) {\r\n\t\t\treturn () => value;\r\n\t\t} else if( isArray( def ) ) {\r\n\t\t\treturn ( index: number ) => def[ index % def.length ];\r\n\t\t} else if( isFunction( def ) ) {\r\n\t\t\treturn def;\r\n\t\t} else {\r\n\t\t\treturn () => def;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartColorSet2 } from \"./d-chart-color-set\";\r\nimport { DChartSeriesFill, DChartSeriesFillOptions } from \"./d-chart-series-fill\";\r\nimport { DChartSeriesScalar, DChartSeriesScalars } from \"./d-chart-series-scalar\";\r\nimport { EShapeDefaults } from \"./shape/e-shape-defaults\";\r\n\r\nexport class DChartSeriesFillImpl implements DChartSeriesFill {\r\n\tenable: DChartSeriesScalar<boolean>;\r\n\tcolor: DChartSeriesScalar<number>;\r\n\talpha: DChartSeriesScalar<number>;\r\n\r\n\tconstructor( options?: DChartSeriesFillOptions ) {\r\n\t\tthis.enable = DChartSeriesScalars.from( options && options.enable, true );\r\n\t\tthis.color = DChartSeriesScalars.from( options && options.color, DChartColorSet2 );\r\n\t\tthis.alpha = DChartSeriesScalars.from( options && options.alpha, EShapeDefaults.FILL_ALPHA );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesPadding } from \"./d-chart-series-padding\";\r\nimport {\r\n\tDChartSeriesPaddingComputed, DChartSeriesPaddingComputedOptions\r\n} from \"./d-chart-series-padding-computed\";\r\n\r\nexport class DChartSeriesPaddingComputedImpl implements DChartSeriesPaddingComputed {\r\n\touter: number;\r\n\tinner: number;\r\n\r\n\tconstructor( outer: number, inner: number ) {\r\n\t\tthis.outer = outer;\r\n\t\tthis.inner = inner;\r\n\t}\r\n\r\n\tstatic from(\r\n\t\tbase: DChartSeriesPadding, index: number,\r\n\t\tpoint: DChartSeriesPaddingComputedOptions | undefined\r\n\t): DChartSeriesPaddingComputed {\r\n\t\tif( point ) {\r\n\t\t\treturn new DChartSeriesPaddingComputedImpl(\r\n\t\t\t\t( point.outer != null ? point.outer : base.outer( index ) ),\r\n\t\t\t\t( point.inner != null ? point.inner : base.inner( index ) )\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn new DChartSeriesPaddingComputedImpl(\r\n\t\t\t\tbase.outer( index ),\r\n\t\t\t\tbase.inner( index )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesPadding, DChartSeriesPaddingOptions } from \"./d-chart-series-padding\";\r\nimport { DChartSeriesScalar, DChartSeriesScalars } from \"./d-chart-series-scalar\";\r\n\r\nexport class DChartSeriesPaddingImpl implements DChartSeriesPadding {\r\n\touter: DChartSeriesScalar<number>;\r\n\tinner: DChartSeriesScalar<number>;\r\n\r\n\tconstructor( options: DChartSeriesPaddingOptions | undefined ) {\r\n\t\tthis.outer = DChartSeriesScalars.from( options && options.outer, 0.2 );\r\n\t\tthis.inner = DChartSeriesScalars.from( options && options.inner, 0.1 );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesPoint } from \"./d-chart-series-point\";\r\nimport { DChartSeriesPointComputed, DChartSeriesPointComputedOptions } from \"./d-chart-series-point-computed\";\r\n\r\nexport class DChartSeriesPointComputedImpl implements DChartSeriesPointComputed {\r\n\tx: number;\r\n\ty: number;\r\n\r\n\tconstructor( x: number, y: number ) {\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\r\n\tstatic from(\r\n\t\tbase: DChartSeriesPoint, index: number,\r\n\t\tpoint: DChartSeriesPointComputedOptions | undefined,\r\n\t\tx: number, y: number\r\n\t): DChartSeriesPointComputed {\r\n\t\tif( point ) {\r\n\t\t\treturn new DChartSeriesPointComputedImpl(\r\n\t\t\t\t( point.x != null ? point.x : ( base.x != null ? base.x( index ) : x ) ),\r\n\t\t\t\t( point.y != null ? point.y : ( base.y != null ? base.y( index ) : y ) )\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn new DChartSeriesPointComputedImpl(\r\n\t\t\t\tbase.x != null ? base.x( index ) : x,\r\n\t\t\t\tbase.y != null ? base.y( index ) : y\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesPoint, DChartSeriesPointOptions } from \"./d-chart-series-point\";\r\nimport { DChartSeriesScalar, DChartSeriesScalars } from \"./d-chart-series-scalar\";\r\n\r\nexport class DChartSeriesPointImpl implements DChartSeriesPoint {\r\n\tx?: DChartSeriesScalar<number>;\r\n\ty?: DChartSeriesScalar<number>;\r\n\r\n\tconstructor( options: DChartSeriesPointOptions | undefined ) {\r\n\t\tif( options ) {\r\n\t\t\tif( options.x != null ) {\r\n\t\t\t\tthis.x = DChartSeriesScalars.from( options.x, 0 );\r\n\t\t\t}\r\n\r\n\t\t\tif( options.y != null ) {\r\n\t\t\t\tthis.y = DChartSeriesScalars.from( options.y, 0 );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesStroke } from \"./d-chart-series-stroke\";\r\nimport { DChartSeriesStrokeComputed, DChartSeriesStrokeComputedOptions } from \"./d-chart-series-stroke-computed\";\r\nimport { EShapePointsStyle } from \"./shape/e-shape-points-style\";\r\nimport { EShapePointsStyles } from \"./shape/e-shape-points-styles\";\r\nimport { EShapeStrokeSide } from \"./shape/e-shape-stroke-side\";\r\n\r\nexport class DChartSeriesStrokeComputedImpl implements DChartSeriesStrokeComputed {\r\n\tenable: boolean;\r\n\tcolor: number;\r\n\talpha: number;\r\n\twidth: number;\r\n\talign: number;\r\n\tside: EShapeStrokeSide;\r\n\tstyle: EShapePointsStyle;\r\n\r\n\tconstructor(\r\n\t\tenable: boolean, color: number, alpha: number, width: number,\r\n\t\talign: number, side: EShapeStrokeSide, style: EShapePointsStyle\r\n\t) {\r\n\t\tthis.enable = enable;\r\n\t\tthis.color = color;\r\n\t\tthis.alpha = alpha;\r\n\t\tthis.width = width;\r\n\t\tthis.align = align;\r\n\t\tthis.side = side;\r\n\t\tthis.style = style;\r\n\t}\r\n\r\n\tstatic from(\r\n\t\tbase: DChartSeriesStroke, index: number,\r\n\t\tstroke?: DChartSeriesStrokeComputedOptions\r\n\t): DChartSeriesStrokeComputed {\r\n\t\tif( stroke ) {\r\n\t\t\treturn new DChartSeriesStrokeComputedImpl(\r\n\t\t\t\t( stroke.enable != null ? stroke.enable : base.enable( index ) ),\r\n\t\t\t\t( stroke.color != null ? stroke.color : base.color( index ) ),\r\n\t\t\t\t( stroke.alpha != null ? stroke.alpha : base.alpha( index ) ),\r\n\t\t\t\t( stroke.width != null ? stroke.width : base.width( index ) ),\r\n\t\t\t\t( stroke.align != null ? stroke.align : base.align( index ) ),\r\n\t\t\t\t( stroke.side != null ? stroke.side : base.side( index ) ),\r\n\t\t\t\tEShapePointsStyles.from( stroke.style != null ? stroke.style : base.style( index ) )\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn new DChartSeriesStrokeComputedImpl(\r\n\t\t\t\tbase.enable( index ),\r\n\t\t\t\tbase.color( index ),\r\n\t\t\t\tbase.alpha( index ),\r\n\t\t\t\tbase.width( index ),\r\n\t\t\t\tbase.align( index ),\r\n\t\t\t\tbase.side( index ),\r\n\t\t\t\tEShapePointsStyles.from( base.style( index ) )\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartColorSet2 } from \"./d-chart-color-set\";\r\nimport { DChartSeriesScalar, DChartSeriesScalars } from \"./d-chart-series-scalar\";\r\nimport { DChartSeriesStroke, DChartSeriesStrokeOptions } from \"./d-chart-series-stroke\";\r\nimport { EShapeDefaults } from \"./shape/e-shape-defaults\";\r\nimport { EShapePointsStyle } from \"./shape/e-shape-points-style\";\r\nimport { EShapePointsStyleOption } from \"./shape/e-shape-points-styles\";\r\nimport { EShapeStrokeSide } from \"./shape/e-shape-stroke-side\";\r\n\r\nexport class DChartSeriesStrokeImpl implements DChartSeriesStroke {\r\n\tenable: DChartSeriesScalar<boolean>;\r\n\tcolor: DChartSeriesScalar<number>;\r\n\talpha: DChartSeriesScalar<number>;\r\n\twidth: DChartSeriesScalar<number>;\r\n\talign: DChartSeriesScalar<number>;\r\n\tside: DChartSeriesScalar<EShapeStrokeSide>;\r\n\tstyle: DChartSeriesScalar<EShapePointsStyleOption>;\r\n\r\n\tconstructor( options?: DChartSeriesStrokeOptions ) {\r\n\t\tthis.enable = DChartSeriesScalars.from( options && options.enable, true );\r\n\t\tthis.color = DChartSeriesScalars.from( options && options.color, DChartColorSet2 );\r\n\t\tthis.alpha = DChartSeriesScalars.from( options && options.alpha, EShapeDefaults.STROKE_ALPHA );\r\n\t\tthis.width = DChartSeriesScalars.from( options && options.width, EShapeDefaults.STROKE_WIDTH );\r\n\t\tthis.align = DChartSeriesScalars.from( options && options.width, EShapeDefaults.STROKE_ALIGN );\r\n\t\tthis.side = DChartSeriesScalars.from( options && options.side, EShapeStrokeSide.ALL );\r\n\t\tthis.style = DChartSeriesScalars.from( options && options.style,\r\n\t\t\tEShapePointsStyle.NON_EXPANDING_WIDTH |\r\n\t\t\tEShapePointsStyle.NON_SHRINKING_WIDTH |\r\n\t\t\tEShapePointsStyle.NON_SCALING_DOT_AND_DASH\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\nimport { DChartPlotArea } from \"./d-chart-plot-area\";\r\nimport { DChartRegion } from \"./d-chart-region\";\r\nimport { DChartRegionImpl } from \"./d-chart-region-impl\";\r\nimport { DChartSelection } from \"./d-chart-selection\";\r\nimport { DChartSeries, DChartSeriesHitResult } from \"./d-chart-series\";\r\nimport { DChartSeriesContainer, DChartSeriesContainerOptions } from \"./d-chart-series-container\";\r\nimport { DChartSeriesFillComputed, DChartSeriesFillComputedOptions } from \"./d-chart-series-fill-computed\";\r\nimport { DChartSeriesFillComputedImpl } from \"./d-chart-series-fill-computed-impl\";\r\nimport { DChartSeriesFillImpl } from \"./d-chart-series-fill-impl\";\r\nimport { DChartSeriesPaddingComputed, DChartSeriesPaddingComputedOptions } from \"./d-chart-series-padding-computed\";\r\nimport { DChartSeriesPaddingComputedImpl } from \"./d-chart-series-padding-computed-impl\";\r\nimport { DChartSeriesPaddingImpl } from \"./d-chart-series-padding-impl\";\r\nimport { DChartSeriesPointComputed, DChartSeriesPointComputedOptions } from \"./d-chart-series-point-computed\";\r\nimport { DChartSeriesPointComputedImpl } from \"./d-chart-series-point-computed-impl\";\r\nimport { DChartSeriesPointImpl } from \"./d-chart-series-point-impl\";\r\nimport { DChartSeriesStrokeComputed, DChartSeriesStrokeComputedOptions } from \"./d-chart-series-stroke-computed\";\r\nimport { DChartSeriesStrokeComputedImpl } from \"./d-chart-series-stroke-computed-impl\";\r\nimport { DChartSeriesStrokeImpl } from \"./d-chart-series-stroke-impl\";\r\n\r\nexport class DChartSeriesContainerImpl implements DChartSeriesContainer {\r\n\tprotected static WORK_CALCHITPOINT: DChartSeriesHitResult = new DChartSeriesHitResult();\r\n\r\n\tprotected _plotArea: DChartPlotArea;\r\n\tprotected _list: DChartSeries[];\r\n\tprotected _domain: DChartRegionImpl;\r\n\tprotected _range: DChartRegionImpl;\r\n\tprotected _selection: DChartSelection | null;\r\n\r\n\tprotected _fill: DChartSeriesFillImpl;\r\n\tprotected _stroke: DChartSeriesStrokeImpl;\r\n\tprotected _size: DChartSeriesPointImpl;\r\n\tprotected _offset: DChartSeriesPointImpl;\r\n\tprotected _padding: DChartSeriesPaddingImpl;\r\n\r\n\tconstructor( plotArea: DChartPlotArea, options?: DChartSeriesContainerOptions ) {\r\n\t\tthis._plotArea = plotArea;\r\n\t\tthis._domain = new DChartRegionImpl( NaN, NaN );\r\n\t\tthis._range = new DChartRegionImpl( NaN, NaN );\r\n\t\tthis._selection = (options && options.selection ) || null;\r\n\r\n\t\tthis._fill = new DChartSeriesFillImpl( options && options.fill );\r\n\t\tthis._stroke = new DChartSeriesStrokeImpl( options && options.stroke );\r\n\t\tthis._size = new DChartSeriesPointImpl( options && options.size );\r\n\t\tthis._offset = new DChartSeriesPointImpl( options && options.offset );\r\n\t\tthis._padding = new DChartSeriesPaddingImpl( options && options.padding );\r\n\r\n\t\tthis._list = [];\r\n\t\tconst list = options && options.list;\r\n\t\tif( list ) {\r\n\t\t\tconst listLength = list.length;\r\n\t\t\tif( 0 < listLength ) {\r\n\t\t\t\tfor( let i = 0; i < listLength; ++i ) {\r\n\t\t\t\t\tthis.add( list[ i ] );\r\n\t\t\t\t}\r\n\t\t\t\tthis.update();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tnewFill(\r\n\t\tindex: number,\r\n\t\toptions: DChartSeriesFillComputedOptions | undefined\r\n\t): DChartSeriesFillComputed {\r\n\t\treturn DChartSeriesFillComputedImpl.from( this._fill, index, options );\r\n\t}\r\n\r\n\tnewStroke(\r\n\t\tindex: number,\r\n\t\toptions: DChartSeriesStrokeComputedOptions | undefined\r\n\t): DChartSeriesStrokeComputed {\r\n\t\treturn DChartSeriesStrokeComputedImpl.from( this._stroke, index, options );\r\n\t}\r\n\r\n\tnewSize(\r\n\t\tindex: number,\r\n\t\toptions: DChartSeriesPointComputedOptions | undefined,\r\n\t\tx: number, y: number\r\n\t): DChartSeriesPointComputed {\r\n\t\treturn DChartSeriesPointComputedImpl.from( this._size, index, options, x, y );\r\n\t}\r\n\r\n\tnewOffset(\r\n\t\tindex: number,\r\n\t\toptions: DChartSeriesPointComputedOptions | undefined,\r\n\t\tx: number, y: number\r\n\t): DChartSeriesPointComputed {\r\n\t\treturn DChartSeriesPointComputedImpl.from( this._offset, index, options, x, y );\r\n\t}\r\n\r\n\tnewPadding(\r\n\t\tindex: number,\r\n\t\toptions: DChartSeriesPaddingComputedOptions | undefined\r\n\t): DChartSeriesPaddingComputed {\r\n\t\treturn DChartSeriesPaddingComputedImpl.from( this._padding, index, options );\r\n\t}\r\n\r\n\tget plotArea(): DChartPlotArea {\r\n\t\treturn this._plotArea;\r\n\t}\r\n\r\n\tget selection(): DChartSelection | null {\r\n\t\treturn this._selection;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tlist[ i ].update();\r\n\t\t}\r\n\t\tconst selection = this._selection;\r\n\t\tif( selection ) {\r\n\t\t\tselection.update();\r\n\t\t}\r\n\t}\r\n\r\n\tadd( series: DChartSeries ): void {\r\n\t\tconst list = this._list;\r\n\t\tseries.bind( this, list.length );\r\n\t\tlist.push( series );\r\n\t}\r\n\r\n\tget( index: number ): DChartSeries | null {\r\n\t\tconst list = this._list;\r\n\t\tif( 0 <= index && index < list.length ) {\r\n\t\t\treturn list[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tindexOf( series: DChartSeries ): number {\r\n\t\treturn this._list.indexOf( series );\r\n\t}\r\n\r\n\tclear(): this {\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tlist[ i ].destroy();\r\n\t\t}\r\n\t\tlist.length = 0;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._list.length;\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis.clear();\r\n\t\tconst selection = this._selection;\r\n\t\tif( selection ) {\r\n\t\t\tselection.unbind();\r\n\t\t}\r\n\t}\r\n\r\n\tgetDomain( coordinate: DChartCoordinate, result: DChartRegion ): DChartRegion {\r\n\t\tresult.clear();\r\n\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tconst series = list[ i ];\r\n\t\t\tif( series.coordinate.x === coordinate ) {\r\n\t\t\t\tconst domain = series.domain;\r\n\t\t\t\tresult.add( domain.from, domain.to );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetRange( coordinate: DChartCoordinate, result: DChartRegion ): DChartRegion {\r\n\t\tresult.clear();\r\n\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tconst series = list[ i ];\r\n\t\t\tif( series.coordinate.y === coordinate ) {\r\n\t\t\t\tconst range = series.range;\r\n\t\t\t\tresult.add( range.from, range.to );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tget domain(): DChartRegion {\r\n\t\tconst result = this._domain;\r\n\t\tresult.clear();\r\n\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tconst domain = list[ i ].domain;\r\n\t\t\tresult.add( domain.from, domain.to );\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tget range(): DChartRegion {\r\n\t\tconst result = this._range;\r\n\t\tresult.clear();\r\n\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = 0, imax = list.length; i < imax; ++i ) {\r\n\t\t\tconst range = list[ i ].range;\r\n\t\t\tresult.add( range.from, range.to );\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\thitTest( global: IPoint ): DChartSeries | null {\r\n\t\tconst list = this._list;\r\n\t\tfor( let i = list.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst series = list[ i ];\r\n\t\t\tif( series.hitTest( global ) ) {\r\n\t\t\t\treturn series;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcalcHitPoint( global: IPoint, result: DChartSeriesHitResult ): DChartSeries | null {\r\n\t\tlet tmp1 = result;\r\n\t\tlet tmp2 = DChartSeriesContainerImpl.WORK_CALCHITPOINT;\r\n\t\tconst list = this._list;\r\n\t\tlet closest: DChartSeries | null = null;\r\n\t\ttmp2.distance = +Infinity;\r\n\t\tfor( let i = list.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst series = list[ i ];\r\n\t\t\tif( series.calcHitPoint( global, tmp1 ) ) {\r\n\t\t\t\tif( tmp1.distance < tmp2.distance ) {\r\n\t\t\t\t\tclosest = series;\r\n\t\t\t\t\tconst tmp = tmp1;\r\n\t\t\t\t\ttmp1 = tmp2;\r\n\t\t\t\t\ttmp2 = tmp;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( closest && tmp2 !== result ) {\r\n\t\t\tresult.copyFrom( tmp2 );\r\n\t\t}\r\n\t\treturn closest;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point, Rectangle, Renderer } from \"pixi.js\";\r\nimport { DAnimationTimings } from \"./d-animation-timings\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseOverflowMask } from \"./d-base-overflow-mask\";\r\nimport { DChart } from \"./d-chart\";\r\nimport { DChartAxisContainer, DChartAxisContainerOptions } from \"./d-chart-axis-container\";\r\nimport { DChartAxisContainerImpl } from \"./d-chart-axis-container-impl\";\r\nimport { DChartCoordinateContainer, DChartCoordinateContainerOptions } from \"./d-chart-coordinate-container\";\r\nimport { DChartCoordinateContainerImpl } from \"./d-chart-coordinate-container-impl\";\r\nimport { DChartPlotAreaContainer } from \"./d-chart-plot-area-container\";\r\nimport { DChartSeriesContainer, DChartSeriesContainerOptions } from \"./d-chart-series-container\";\r\nimport { DChartSeriesContainerImpl } from \"./d-chart-series-container-impl\";\r\nimport { DView, DViewOptions } from \"./d-view\";\r\nimport { DViewImpl } from \"./d-view-impl\";\r\nimport { UtilWheelEventDeltas } from \"./util/util-wheel-event\";\r\n\r\nexport interface DChartPlotAreaOptions<\r\n\tTHEME extends DThemeChartPlotArea = DThemeChartPlotArea\r\n> extends DBaseOptions<THEME> {\r\n\tmask?: boolean;\r\n\tcoordinate?: DChartCoordinateContainerOptions;\r\n\tseries?: DChartSeriesContainerOptions;\r\n\taxis?: DChartAxisContainerOptions;\r\n\tview?: DViewOptions;\r\n}\r\n\r\nexport interface DThemeChartPlotArea extends DThemeBase {\r\n\tisOverflowMaskEnabled(): boolean;\r\n}\r\n\r\nexport class DChartPlotArea<\r\n\tTHEME extends DThemeChartPlotArea = DThemeChartPlotArea,\r\n\tOPTIONS extends DChartPlotAreaOptions<THEME> = DChartPlotAreaOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected _chart: DChart;\r\n\tprotected _container!: DChartPlotAreaContainer;\r\n\tprotected _series!: DChartSeriesContainerImpl;\r\n\tprotected _coordinate!: DChartCoordinateContainer;\r\n\tprotected _axis!: DChartAxisContainerImpl;\r\n\tprotected _view!: DViewImpl;\r\n\tprotected _isViewDirty!: boolean;\r\n\tprotected _isBoundsInContainerDirty!: boolean;\r\n\tprotected _boundsInContainer!: Rectangle;\r\n\tprotected _overflowMask!: DBaseOverflowMask | null;\r\n\tprotected _workPoint!: Point;\r\n\tprotected _blendStartTime: number;\r\n\tprotected _blendDuration: number;\r\n\tprotected _blendTimeout: number | null;\r\n\tprotected _onBlendBound: () => void;\r\n\r\n\tconstructor( chart: DChart, options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis._chart = chart;\r\n\t\tthis._blendStartTime = 0;\r\n\t\tthis._blendDuration = 1000;\r\n\t\tthis._blendTimeout = null;\r\n\t\tthis._onBlendBound = () => {\r\n\t\t\tthis.onBlend();\r\n\t\t};\r\n\t}\r\n\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\r\n\t\tconst container = new DChartPlotAreaContainer( (): void => {\r\n\t\t\tthis._isViewDirty = true;\r\n\t\t\tthis._isBoundsInContainerDirty = true;\r\n\t\t\tDApplications.update( this );\r\n\t\t});\r\n\t\tthis._container = container;\r\n\t\tthis._coordinate = new DChartCoordinateContainerImpl( this, options && options.coordinate );\r\n\t\tconst series = new DChartSeriesContainerImpl( this, options && options.series );\r\n\t\tthis._series = series;\r\n\t\tconst axis = new DChartAxisContainerImpl( this, options && options.axis );\r\n\t\tthis._axis = axis;\r\n\t\tthis._isViewDirty = true;\r\n\t\tthis._isBoundsInContainerDirty = true;\r\n\t\tthis._boundsInContainer = new Rectangle();\r\n\t\tthis._workPoint = new Point();\r\n\r\n\t\tthis.addChild( container );\r\n\t\tthis.addChild( axis.container );\r\n\r\n\t\tthis._view = new DViewImpl( this, () => container, options && options.view );\r\n\r\n\t\tconst selection = series.selection;\r\n\t\tif( selection ) {\r\n\t\t\tselection.bind( series );\r\n\t\t}\r\n\r\n\t\t// Overflow mask\r\n\t\tthis._overflowMask = null;\r\n\t\tif( options && options.mask != null ? options.mask :\r\n\t\t\tthis.theme.isOverflowMaskEnabled() ) {\r\n\t\t\tthis._container.mask = this.getOrCreateOverflowMask();\r\n\t\t}\r\n\t}\r\n\r\n\tonResize( newWidth: number, newHeight: number, oldWidth: number, oldHeight: number ): void {\r\n\t\tthis._isViewDirty = true;\r\n\t\tthis._isBoundsInContainerDirty = true;\r\n\t\tsuper.onResize( newWidth, newHeight, oldWidth, oldHeight );\r\n\t}\r\n\r\n\tprotected getOrCreateOverflowMask(): DBaseOverflowMask {\r\n\t\tif( this._overflowMask == null ) {\r\n\t\t\tthis._overflowMask = new DBaseOverflowMask( this );\r\n\t\t\tthis.addReflowable( this._overflowMask );\r\n\t\t\tthis.toDirty();\r\n\t\t}\r\n\t\treturn this._overflowMask;\r\n\t}\r\n\r\n\tget coordinate(): DChartCoordinateContainer {\r\n\t\treturn this._coordinate;\r\n\t}\r\n\r\n\tget chart(): DChart {\r\n\t\treturn this._chart;\r\n\t}\r\n\r\n\tget series(): DChartSeriesContainer {\r\n\t\treturn this._series;\r\n\t}\r\n\r\n\tget container(): DChartPlotAreaContainer {\r\n\t\treturn this._container;\r\n\t}\r\n\r\n\tget axis(): DChartAxisContainer {\r\n\t\treturn this._axis;\r\n\t}\r\n\r\n\tget view(): DView {\r\n\t\treturn this._view;\r\n\t}\r\n\r\n\tonWheel( e: WheelEvent, deltas: UtilWheelEventDeltas, global: Point ): boolean {\r\n\t\tconst vresult = this._view.onWheel( e, deltas, global );\r\n\t\tconst sresult = super.onWheel( e, deltas, global );\r\n\t\treturn vresult || sresult;\r\n\t}\r\n\r\n\tonDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean {\r\n\t\tconst vresult = this._view.onDblClick( e, interactionManager );\r\n\t\tconst sresult = super.onDblClick( e, interactionManager );\r\n\t\treturn vresult || sresult;\r\n\t}\r\n\r\n\tprotected onDown( e: interaction.InteractionEvent ): void {\r\n\t\tthis._view.onDown( e );\r\n\t\tsuper.onDown( e );\r\n\t}\r\n\r\n\trender( renderer: Renderer ): void {\r\n\t\tif( this._isViewDirty ) {\r\n\t\t\tthis._isViewDirty = false;\r\n\r\n\t\t\tthis._axis.update();\r\n\r\n\t\t\tconst selection = this._series.selection;\r\n\t\t\tif( selection ) {\r\n\t\t\t\tselection.update();\r\n\t\t\t}\r\n\t\t}\r\n\t\tsuper.render( renderer );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis._container.destroy();\r\n\t\tthis._series.destroy();\r\n\t\tthis._axis.destroy();\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartPlotArea\";\r\n\t}\r\n\r\n\tgetBoundsInContainer(): Rectangle {\r\n\t\tconst result = this._boundsInContainer;\r\n\t\tif( this._isBoundsInContainerDirty ) {\r\n\t\t\tthis._isBoundsInContainerDirty = false;\r\n\r\n\t\t\tconst container = this.container;\r\n\t\t\tcontainer.updateTransform();\r\n\t\t\tconst transform = container.transform.localTransform;\r\n\r\n\t\t\tconst work = this._workPoint;\r\n\r\n\t\t\twork.set( 0, 0 );\r\n\t\t\ttransform.applyInverse( work, work );\r\n\t\t\tresult.x = work.x;\r\n\t\t\tresult.y = work.y;\r\n\r\n\t\t\twork.set( this.width, this.height );\r\n\t\t\ttransform.applyInverse( work, work );\r\n\t\t\tresult.width = work.x - result.x;\r\n\t\t\tresult.height = work.y - result.y;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfit( duration?: number, domainFrom?: number, domainTo?: number, rangeFrom?: number, rangeTo?: number ): this {\r\n\t\tconst coordinate = this._coordinate;\r\n\t\tconst axis = this._axis;\r\n\t\tconst series = this._series;\r\n\t\tif( duration != null && duration <= 0 ) {\r\n\t\t\tcoordinate.fit( domainFrom, domainTo, rangeFrom, rangeTo );\r\n\t\t\taxis.update();\r\n\t\t\tseries.update();\r\n\t\t} else {\r\n\t\t\tthis._blendDuration = duration != null ? duration : 200;\r\n\t\t\tthis._blendStartTime = Date.now();\r\n\t\t\tcoordinate.mark( domainFrom, domainTo, rangeFrom, rangeTo );\r\n\t\t\tconst blendTimeout = this._blendTimeout;\r\n\t\t\tif( blendTimeout != null ) {\r\n\t\t\t\twindow.clearTimeout( blendTimeout );\r\n\t\t\t}\r\n\t\t\tthis._blendTimeout = window.setTimeout( this._onBlendBound, 0 );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprotected onBlend(): void {\r\n\t\tconst now = Date.now();\r\n\t\tlet ratio = (now - this._blendStartTime) / this._blendDuration;\r\n\t\tif( ratio < 1 ) {\r\n\t\t\tthis._blendTimeout = window.setTimeout( this._onBlendBound, 0 );\r\n\t\t} else {\r\n\t\t\tthis._blendTimeout = null;\r\n\t\t\tratio = 1;\r\n\t\t}\r\n\t\tthis._coordinate.blend( DAnimationTimings.ELASTIC( ratio ) );\r\n\t\tthis._axis.update();\r\n\t\tthis._series.update();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartRegion } from \"./d-chart-region\";\r\nimport { isNaN } from \"./util/is-nan\";\r\n\r\nexport class DChartRegionImplObservable implements DChartRegion {\r\n\tprotected _from: number;\r\n\tprotected _to: number;\r\n\tprotected _onChange: () => void;\r\n\r\n\tconstructor( from: number, to: number, onChange: () => void ) {\r\n\t\tthis._from = from;\r\n\t\tthis._to = to;\r\n\t\tthis._onChange = onChange;\r\n\t}\r\n\r\n\tget from(): number {\r\n\t\treturn this._from;\r\n\t}\r\n\r\n\tset from( from: number ) {\r\n\t\tthis.set( from, undefined );\r\n\t}\r\n\r\n\tget to(): number {\r\n\t\treturn this._to;\r\n\t}\r\n\r\n\tset to( to: number ) {\r\n\t\tthis.set( undefined, to );\r\n\t}\r\n\r\n\tset( from?: number, to?: number ): this {\r\n\t\tlet isChanged = false;\r\n\r\n\t\tif( from != null && this._from !== from ) {\r\n\t\t\tif( ! isNaN( this._from ) || ! isNaN(from) ) {\r\n\t\t\t\tthis._from = from;\r\n\t\t\t\tisChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( to != null && this._to !== to ) {\r\n\t\t\tif( ! isNaN( this._to ) || ! isNaN(to) ) {\r\n\t\t\t\tthis._to = to;\r\n\t\t\t\tisChanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif( isChanged ) {\r\n\t\t\tthis._onChange();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tadd( from: number, to: number ): this {\r\n\t\tlet newFrom: number | undefined;\r\n\t\tif( ! isNaN( from ) ) {\r\n\t\t\tnewFrom = ( isNaN( this.from ) ?\r\n\t\t\t\tfrom : Math.min( this.from, from )\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tlet newTo: number | undefined;\r\n\t\tif( ! isNaN( to ) ) {\r\n\t\t\tnewTo = ( isNaN( this.to ) ?\r\n\t\t\t\tto : Math.max( this.to, to )\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn this.set( newFrom, newTo );\r\n\t}\r\n\r\n\tclear(): this {\r\n\t\treturn this.set( NaN, NaN );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { DChartSeriesCoordinateContainer, DChartSeriesCoordinateOptions } from \"./d-chart-series-coordinate\";\r\n\r\ninterface DChartSeriesBaseCoordinateContainerParent {\r\n\tcontainer: DChartSeriesContainer | null;\r\n}\r\n\r\nexport class DChartSeriesBaseCoordinateContainer implements DChartSeriesCoordinateContainer {\r\n\tprotected _parent: DChartSeriesBaseCoordinateContainerParent;\r\n\tprotected _coordinateIndexX: number;\r\n\tprotected _coordinateIndexY: number;\r\n\tprotected _coordinateIdUpdatedX: number;\r\n\tprotected _coordinateIdUpdatedY: number;\r\n\tprotected _coordinateTransformIdUpdatedX: number;\r\n\tprotected _coordinateTransformIdUpdatedY: number;\r\n\r\n\tconstructor( parent: DChartSeriesBaseCoordinateContainerParent, options?: DChartSeriesCoordinateOptions ) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._coordinateIndexX = ( options && options.x != null ? options.x : 0 );\r\n\t\tthis._coordinateIndexY = ( options && options.y != null ? options.y : 0 );\r\n\t\tthis._coordinateIdUpdatedX = NaN;\r\n\t\tthis._coordinateIdUpdatedY = NaN;\r\n\t\tthis._coordinateTransformIdUpdatedX = NaN;\r\n\t\tthis._coordinateTransformIdUpdatedY = NaN;\r\n\t}\r\n\r\n\tget x(): DChartCoordinate | null {\r\n\t\tconst container = this._parent.container;\r\n\t\tif( container ) {\r\n\t\t\treturn container.plotArea.coordinate.x.get(\r\n\t\t\t\tthis._coordinateIndexX\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tget y(): DChartCoordinate | null {\r\n\t\tconst container = this._parent.container;\r\n\t\tif( container ) {\r\n\t\t\treturn container.plotArea.coordinate.y.get(\r\n\t\t\t\tthis._coordinateIndexY\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tisDirty( coordinateX: DChartCoordinate, coordinateY: DChartCoordinate ): boolean {\r\n\t\tconst coordinateIdX = coordinateX.id;\r\n\t\tconst coordinateIdY = coordinateY.id;\r\n\t\tconst isCoordinateXChanged = ( coordinateIdX !== this._coordinateIdUpdatedX );\r\n\t\tconst isCoordinateYChanged = ( coordinateIdY !== this._coordinateIdUpdatedY );\r\n\t\tthis._coordinateIdUpdatedX = coordinateIdX;\r\n\t\tthis._coordinateIdUpdatedY = coordinateIdY;\r\n\t\treturn ( isCoordinateXChanged || isCoordinateYChanged );\r\n\t}\r\n\r\n\tisTransformDirty( coordinateX: DChartCoordinate, coordinateY: DChartCoordinate ): boolean {\r\n\t\tconst coordinateTransformIdX = coordinateX.transform.id;\r\n\t\tconst coordinateTransformIdY = coordinateY.transform.id;\r\n\t\tconst isCoordinateTransformXChanged = ( coordinateTransformIdX !== this._coordinateTransformIdUpdatedX );\r\n\t\tconst isCoordinateTransformYChanged = ( coordinateTransformIdY !== this._coordinateTransformIdUpdatedY );\r\n\t\tthis._coordinateTransformIdUpdatedX = coordinateTransformIdX;\r\n\t\tthis._coordinateTransformIdUpdatedY = coordinateTransformIdY;\r\n\t\treturn ( isCoordinateTransformXChanged || isCoordinateTransformYChanged );\r\n\t}\r\n\r\n\treset(): void {\r\n\t\tthis._coordinateIdUpdatedX = NaN;\r\n\t\tthis._coordinateIdUpdatedY = NaN;\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tthis.reset();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint, utils } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBaseOnOptions } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DChartRegionImmutable } from \"./d-chart-region\";\r\nimport { DChartRegionImpl } from \"./d-chart-region-impl\";\r\nimport { DChartSeries, DChartSeriesHitResult } from \"./d-chart-series\";\r\nimport { DChartSeriesBaseCoordinateContainer } from \"./d-chart-series-base-coordinate-container\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { DChartSeriesCoordinateContainer, DChartSeriesCoordinateOptions } from \"./d-chart-series-coordinate\";\r\nimport { EShape } from \"./shape/e-shape\";\r\n\r\n/**\r\n * {@link DChartSeriesBase} options.\r\n */\r\nexport interface DChartSeriesBaseOptions {\r\n\tcoordinate?: DChartSeriesCoordinateOptions;\r\n\ton?: DBaseOnOptions;\r\n}\r\n\r\n/**\r\n * A series represents a polyline.\r\n */\r\nexport abstract class DChartSeriesBase extends utils.EventEmitter implements DChartSeries {\r\n\tprotected _coordinate: DChartSeriesBaseCoordinateContainer;\r\n\r\n\tprotected _container?: DChartSeriesContainer;\r\n\tprotected _index: number;\r\n\r\n\tprotected _domain: DChartRegionImpl;\r\n\tprotected _range: DChartRegionImpl;\r\n\tprotected _regionPointId: number;\r\n\r\n\tprotected _state: DBaseState;\r\n\tprotected _stateLocal: DBaseState;\r\n\r\n\tabstract readonly shape: EShape | null;\r\n\r\n\tconstructor( options?: DChartSeriesBaseOptions ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._coordinate = new DChartSeriesBaseCoordinateContainer( this, options && options.coordinate );\r\n\t\tthis._index = 0;\r\n\t\tthis._domain = new DChartRegionImpl( NaN, NaN );\r\n\t\tthis._range = new DChartRegionImpl( NaN, NaN );\r\n\t\tthis._regionPointId = NaN;\r\n\r\n\t\tthis._state = DBaseState.NONE;\r\n\t\tthis._stateLocal = DBaseState.NONE;\r\n\r\n\t\t// Events\r\n\t\tif( options ) {\r\n\t\t\tconst on = options.on;\r\n\t\t\tif( on != null ) {\r\n\t\t\t\tfor( const name in on ) {\r\n\t\t\t\t\tconst handler = on[ name ];\r\n\t\t\t\t\tif( handler ) {\r\n\t\t\t\t\t\tthis.on( name, handler );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tbind( container: DChartSeriesContainer, index: number ): void {\r\n\t\tthis._container = container;\r\n\t\tthis._coordinate.reset();\r\n\t\tthis._index = index;\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tthis._container = undefined;\r\n\t}\r\n\r\n\tabstract toDirty(): void;\r\n\tabstract update(): void;\r\n\r\n\tget domain(): DChartRegionImmutable {\r\n\t\tthis.updateRegion();\r\n\t\treturn this._domain;\r\n\t}\r\n\r\n\tget range(): DChartRegionImmutable {\r\n\t\tthis.updateRegion();\r\n\t\treturn this._range;\r\n\t}\r\n\r\n\tget container(): DChartSeriesContainer | null {\r\n\t\treturn this._container || null;\r\n\t}\r\n\r\n\tget index(): number {\r\n\t\treturn this._index;\r\n\t}\r\n\r\n\tget coordinate(): DChartSeriesCoordinateContainer {\r\n\t\treturn this._coordinate;\r\n\t}\r\n\r\n\tprotected abstract updateRegion(): void;\r\n\r\n\tdestroy(): void {\r\n\t\tthis._container = undefined;\r\n\t\tthis._coordinate.destroy();\r\n\t}\r\n\r\n\thitTest( global: IPoint ): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcalcHitPoint( global: IPoint, result: DChartSeriesHitResult ): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tsetState( state: DBaseState, isOn: boolean ): void {\r\n\t\tconst oldStateLocal = this._stateLocal;\r\n\t\tconst newStateLocal = ( isOn ? (oldStateLocal | state) : (oldStateLocal & ~state) );\r\n\t\tif( oldStateLocal !== newStateLocal ) {\r\n\t\t\tthis._stateLocal = newStateLocal;\r\n\t\t\tthis.updateState();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateState(): void {\r\n\t\tconst container = this._container;\r\n\t\tconst chart = container && container.plotArea.chart;\r\n\t\tconst stateLocal = this._stateLocal;\r\n\t\tconst newState = ( chart ?\r\n\t\t\tthis.mergeState( stateLocal, chart.state ) :\r\n\t\t\tstateLocal\r\n\t\t);\r\n\t\tconst oldState = this._state;\r\n\t\tif( oldState !== newState ) {\r\n\t\t\tthis._state = newState;\r\n\t\t\tthis.onStateChange( newState, oldState );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn stateLocal | ( stateParent & DBaseState.DISABLED ) |\r\n\t\t\t( stateParent & (DBaseState.FOCUSED | DBaseState.FOCUSED_IN) ? DBaseState.FOCUSED_IN : DBaseState.NONE ) |\r\n\t\t\t( stateParent & (DBaseState.ACTIVE | DBaseState.ACTIVE_IN) ? DBaseState.ACTIVE_IN : DBaseState.NONE );\r\n\t}\r\n\r\n\tprotected onStateChange( newState: number, oldState: number ) {\r\n\t\tthis.toDirty();\r\n\t\tconst container = this._container;\r\n\t\tconst chart = container && container.plotArea.chart;\r\n\t\tDApplications.update( chart );\r\n\t\tthis.emit( \"statechange\", newState, oldState, this );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint, Point } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\nimport { DChartRegion } from \"./d-chart-region\";\r\nimport { DChartSeriesHitResult } from \"./d-chart-series\";\r\nimport { DChartSeriesBase, DChartSeriesBaseOptions } from \"./d-chart-series-base\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { DChartSeriesFillComputed, DChartSeriesFillComputedOptions } from \"./d-chart-series-fill-computed\";\r\nimport { DChartSeriesPaddingComputedOptions } from \"./d-chart-series-padding-computed\";\r\nimport { DChartSeriesPointComputed, DChartSeriesPointComputedOptions } from \"./d-chart-series-point-computed\";\r\nimport { DChartSeriesStrokeComputed, DChartSeriesStrokeComputedOptions } from \"./d-chart-series-stroke-computed\";\r\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\r\nimport { EShapeLineOfCircles } from \"./shape/variant/e-shape-line-of-circles\";\r\nimport { toCeilingIndex } from \"./util/to-ceiling-index\";\r\n\r\n/**\r\n * {@link DChartSeriesLineOfAny} options.\r\n */\r\nexport interface DChartSeriesLineOfAnyOptions extends DChartSeriesBaseOptions {\r\n\tpoints?: Array<number | null>;\r\n\tfill?: DChartSeriesFillComputedOptions;\r\n\tstroke?: DChartSeriesStrokeComputedOptions;\r\n\tsize?: DChartSeriesPointComputedOptions;\r\n\toffset?: DChartSeriesPointComputedOptions;\r\n\tpadding?: DChartSeriesPaddingComputedOptions;\r\n}\r\n\r\nexport interface DChartSeriesLineOfAnyRegion {\r\n\txmin: number;\r\n\txmax: number;\r\n\tymin: number;\r\n\tymax: number;\r\n}\r\n\r\n/**\r\n * A series represents a line of anything.\r\n * Data points must be sorted in ascending order on the X axis.\r\n */\r\nexport abstract class DChartSeriesLineOfAny extends DChartSeriesBase {\r\n\tprotected static WORK: Point = new Point();\r\n\tprotected static WORK_REGION?: DChartSeriesLineOfAnyRegion;\r\n\r\n\tprotected _line: EShapeLineOfAny | null;\r\n\tprotected _options?: DChartSeriesLineOfAnyOptions;\r\n\tprotected _points: Array<number | null>;\r\n\tprotected _pointId: number;\r\n\tprotected _pointIdUpdated: number;\r\n\r\n\tprotected _stroke?: DChartSeriesStrokeComputed;\r\n\tprotected _fill?: DChartSeriesFillComputed;\r\n\tprotected _size?: DChartSeriesPointComputed;\r\n\tprotected _offset?: DChartSeriesPointComputed;\r\n\r\n\tconstructor( options?: DChartSeriesLineOfAnyOptions ) {\r\n\t\tsuper( options );\r\n\t\tthis._line = null;\r\n\t\tthis._options = options;\r\n\t\tthis._points = (options && options.points) || [];\r\n\t\tthis._pointId = 0;\r\n\t\tthis._pointIdUpdated = NaN;\r\n\t}\r\n\r\n\tprotected getSizeDefault(): number {\r\n\t\treturn 10;\r\n\t}\r\n\r\n\tprotected getOffsetDefault(): number {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tbind( container: DChartSeriesContainer, index: number ): void {\r\n\t\tlet line = this._line;\r\n\t\tif( ! line ) {\r\n\t\t\tline = this._line = this.newLineOfAny();\r\n\t\t\tconst options = this._options;\r\n\t\t\tthis.initLine( line, options, container, index );\r\n\t\t}\r\n\t\tline.attach( container.plotArea.container, index );\r\n\t\tthis._pointIdUpdated = NaN;\r\n\t\tsuper.bind( container, index );\r\n\t}\r\n\r\n\tprotected initLine(\r\n\t\tline: EShapeLineOfAny,\r\n\t\toptions: DChartSeriesLineOfAnyOptions | undefined,\r\n\t\tcontainer: DChartSeriesContainer,\r\n\t\tindex: number\r\n\t): void {\r\n\t\tconst fill = container.newFill( index, options && options.fill );\r\n\t\tthis._fill = fill;\r\n\t\tline.fill.copy( fill );\r\n\r\n\t\tconst stroke = container.newStroke( index, options && options.stroke );\r\n\t\tthis._stroke = stroke;\r\n\t\tline.stroke.copy( stroke );\r\n\r\n\t\tconst sizeDefault = this.getSizeDefault();\r\n\t\tconst size = container.newSize( index, options && options.size, sizeDefault, sizeDefault );\r\n\t\tthis._size = size;\r\n\t\tline.points.size.set( size.x, size.y );\r\n\r\n\t\tconst offsetDefault = this.getOffsetDefault();\r\n\t\tconst offset = container.newOffset( index, options && options.offset, offsetDefault, offsetDefault );\r\n\t\tthis._offset = offset;\r\n\t\tline.points.offset.set( offset.x, offset.y );\r\n\t}\r\n\r\n\tprotected abstract newLineOfAny(): EShapeLineOfAny;\r\n\r\n\tunbind(): void {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tline.detach();\r\n\t\t}\r\n\t\tsuper.unbind();\r\n\t}\r\n\r\n\tget shape(): EShapeLineOfAny | null {\r\n\t\treturn this._line;\r\n\t}\r\n\r\n\tget points(): Array<number | null> {\r\n\t\treturn this._points;\r\n\t}\r\n\r\n\tset points( points: Array<number | null> ) {\r\n\t\tthis._points = points;\r\n\t\tthis._pointId += 1;\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._pointId += 1;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tconst coordinate = this._coordinate;\r\n\t\t\tconst coordinateX = coordinate.x;\r\n\t\t\tconst coordinateY = coordinate.y;\r\n\t\t\tif( coordinateX && coordinateY ) {\r\n\t\t\t\tconst pointId = this._pointId;\r\n\t\t\t\tconst isPointChanged = ( pointId !== this._pointIdUpdated );\r\n\t\t\t\tconst isCoordinateChanged = coordinate.isDirty( coordinateX, coordinateY );\r\n\t\t\t\tconst isCoordinateTransformChanged = coordinate.isTransformDirty( coordinateX, coordinateY );\r\n\t\t\t\tif( isPointChanged || isCoordinateChanged || isCoordinateTransformChanged ) {\r\n\t\t\t\t\tthis._pointIdUpdated = pointId;\r\n\t\t\t\t\tthis.updateLine(\r\n\t\t\t\t\t\tline,\r\n\t\t\t\t\t\tcoordinateX,\r\n\t\t\t\t\t\tcoordinateY\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateLine(\r\n\t\tline: EShapeLineOfAny,\r\n\t\txcoordinate: DChartCoordinate,\r\n\t\tycoordinate: DChartCoordinate\r\n\t): void {\r\n\t\tconst values = line.points.values;\r\n\t\tconst valuesLength = values.length;\r\n\t\tlet ivalues = 0;\r\n\t\tconst points = this._points;\r\n\t\tlet xmin = NaN;\r\n\t\tlet xmax = NaN;\r\n\t\tlet ymin = NaN;\r\n\t\tlet ymax = NaN;\r\n\t\tfor( let i = 0, imax = points.length; i < imax; i += 2 ) {\r\n\t\t\tconst x = points[ i ];\r\n\t\t\tconst y = points[ i + 1 ];\r\n\t\t\tif( x != null && y != null ) {\r\n\t\t\t\tif( ivalues < valuesLength ) {\r\n\t\t\t\t\tvalues[ ivalues ] = x;\r\n\t\t\t\t\tvalues[ ivalues + 1 ] = y;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalues.push( x, y );\r\n\t\t\t\t}\r\n\t\t\t\tivalues += 2;\r\n\t\t\t\tif( xmin !== xmin ) {\r\n\t\t\t\t\txmin = x;\r\n\t\t\t\t\txmax = x;\r\n\t\t\t\t\tymin = y;\r\n\t\t\t\t\tymax = y;\r\n\t\t\t\t} else {\r\n\t\t\t\t\txmin = Math.min( xmin, x );\r\n\t\t\t\t\txmax = Math.max( xmax, x );\r\n\t\t\t\t\tymin = Math.min( ymin, y );\r\n\t\t\t\t\tymax = Math.max( ymax, y );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( values.length !== ivalues ) {\r\n\t\t\tvalues.length = ivalues;\r\n\t\t}\r\n\r\n\t\txcoordinate.mapAll( values, 0, ivalues, 2, 0 );\r\n\t\tycoordinate.mapAll( values, 0, ivalues, 2, 1 );\r\n\t\txcoordinate.transform.mapAll( values, 0, ivalues, 2, 0 );\r\n\t\tycoordinate.transform.mapAll( values, 0, ivalues, 2, 1 );\r\n\r\n\t\tif( xmin !== xmin ) {\r\n\t\t\txmin = 0;\r\n\t\t\txmax = 0;\r\n\t\t\tymin = 0;\r\n\t\t\tymax = 0;\r\n\t\t}\r\n\t\tconst region = this.adjustLineRegion(\r\n\t\t\txmin, xmax,\r\n\t\t\tymin, ymax,\r\n\t\t\tDChartSeriesLineOfAny.WORK_REGION || {\r\n\t\t\t\txmin: 0, xmax: 0,\r\n\t\t\t\tymin: 0, ymax: 0\r\n\t\t\t}\r\n\t\t);\r\n\t\txmin = xcoordinate.transform.map( xcoordinate.map( region.xmin ) );\r\n\t\txmax = xcoordinate.transform.map( xcoordinate.map( region.xmax ) );\r\n\t\tymin = ycoordinate.transform.map( ycoordinate.map( region.ymin ) );\r\n\t\tymax = ycoordinate.transform.map( ycoordinate.map( region.ymax ) );\r\n\r\n\t\tconst sx = Math.abs( xmax - xmin );\r\n\t\tconst sy = Math.abs( ymax - ymin );\r\n\t\tconst cx = ( xmin + xmax ) * 0.5;\r\n\t\tconst cy = ( ymin + ymax ) * 0.5;\r\n\t\tfor( let i = 0, imax = values.length; i < imax; i += 2 ) {\r\n\t\t\tvalues[ i + 0 ] -= cx;\r\n\t\t\tvalues[ i + 1 ] -= cy;\r\n\t\t}\r\n\r\n\t\tline.disallowUploadedUpdate();\r\n\t\tthis.applyLine( line, xcoordinate, ycoordinate, sx, sy, cx, cy, values );\r\n\t\tline.allowUploadedUpdate();\r\n\t\tDApplications.update( line );\r\n\t}\r\n\r\n\tprotected adjustLineRegion(\r\n\t\txmin: number, xmax: number,\r\n\t\tymin: number, ymax: number,\r\n\t\tresult: DChartSeriesLineOfAnyRegion\r\n\t): DChartSeriesLineOfAnyRegion {\r\n\t\tresult.xmin = xmin;\r\n\t\tresult.xmax = xmax;\r\n\t\tresult.ymin = ymin;\r\n\t\tresult.ymax = ymax;\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected applyLine(\r\n\t\tline: EShapeLineOfAny,\r\n\t\txcoordinate: DChartCoordinate,\r\n\t\tycoordinate: DChartCoordinate,\r\n\t\tsx: number, sy: number,\r\n\t\tcx: number, cy: number,\r\n\t\tvalues: number[]\r\n\t): void {\r\n\t\tline.points.set( values );\r\n\t\tline.size.set( sx, sy );\r\n\t\tline.transform.position.set( cx, cy );\r\n\t}\r\n\r\n\tprotected updateRegion(): void {\r\n\t\tconst pointId = this._pointId;\r\n\t\tif( this._regionPointId !== pointId ) {\r\n\t\t\tthis._regionPointId = pointId;\r\n\t\t\tconst points = this._points;\r\n\t\t\tconst domain = this._domain;\r\n\t\t\tconst range = this._range;\r\n\t\t\tdomain.clear();\r\n\t\t\trange.clear();\r\n\t\t\tthis.calcRegion( points, domain, range );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected calcRegion( points: Array<number | null>, domain: DChartRegion, range: DChartRegion ): void {\r\n\t\tfor( let i = 0, imax = points.length; i < imax; i += 2 ) {\r\n\t\t\tconst xraw = points[ i ];\r\n\t\t\tif( xraw != null ) {\r\n\t\t\t\tdomain.add( xraw, xraw );\r\n\t\t\t}\r\n\t\t\tconst yraw = points[ i + 1 ];\r\n\t\t\tif( yraw != null ) {\r\n\t\t\t\trange.add( yraw, yraw );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tthis._line = null;\r\n\t\t\tline.detach();\r\n\t\t\tline.destroy();\r\n\t\t}\r\n\r\n\t\tthis._points.length = 0;\r\n\t\tthis._pointId = 0;\r\n\t\tthis._pointIdUpdated = NaN;\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\thitTest( global: IPoint ): boolean {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tconst work = DChartSeriesLineOfAny.WORK;\r\n\t\t\tconst local = line.toLocal( global, undefined, work );\r\n\t\t\treturn line.contains( local ) != null;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcalcHitPoint( global: IPoint, result: DChartSeriesHitResult ): boolean {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tconst work = DChartSeriesLineOfAny.WORK;\r\n\t\t\tconst local = line.toLocal( global, undefined, work );\r\n\t\t\tresult.shape = line;\r\n\t\t\treturn line.calcHitPoint( local, null, this.calcHitPointTestRange, this.calcHitPointHitTester, result );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcalcHitPointTestRange(\r\n\t\tthis: unknown,\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tthreshold: number,\r\n\t\tvalues: number[],\r\n\t\tresult: [ number, number ]\r\n\t): [ number, number ] {\r\n\t\tconst to = toCeilingIndex( values, x + ax + ox, 2, 0 );\r\n\t\tlet from = 0;\r\n\t\tfor( let i = to - 1, iv = i << 1; 0 <= i; i -= 1, iv -= 2 ) {\r\n\t\t\tif( values[ iv ] <= x - ax ) {\r\n\t\t\t\tfrom = i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tresult[ 0 ] = from;\r\n\t\tresult[ 1 ] = from !== to ? to : Math.min( values.length << 1, to + 1 );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcalcHitPointHitTester(\r\n\t\tthis: unknown,\r\n\t\tx: number, y: number,\r\n\t\tax: number, ay: number,\r\n\t\tox: number, oy: number,\r\n\t\tpx: number, py: number,\r\n\t\tindex: number,\r\n\t\tthreshold: number,\r\n\t\tresult: DChartSeriesHitResult\r\n\t): boolean {\r\n\t\tconst shape = result.shape as EShapeLineOfCircles;\r\n\t\tif( shape.containsPointAbs( x, y, ax, ay, ox, oy, px, py ) ) {\r\n\t\t\tconst position = shape.transform.position;\r\n\t\t\tresult.x = result.p0x = result.p1x = position.x + px;\r\n\t\t\tresult.y = result.p0y = result.p1y = position.y + py;\r\n\t\t\tresult.t = threshold;\r\n\t\t\tresult.index = index;\r\n\t\t\tconst dx = x - (px + ox);\r\n\t\t\tconst dy = y - (py + oy);\r\n\t\t\tresult.distance = Math.sqrt( dx * dx + dy * dy );\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\nimport { DChartRegion } from \"./d-chart-region\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport {\r\n\tDChartSeriesLineOfAny, DChartSeriesLineOfAnyOptions, DChartSeriesLineOfAnyRegion\r\n} from \"./d-chart-series-line-of-any\";\r\nimport { DChartSeriesPaddingComputed } from \"./d-chart-series-padding-computed\";\r\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\r\nimport { EShapeLineOfRectangles } from \"./shape/variant/e-shape-line-of-rectangles\";\r\nimport { isArray } from \"./util/is-array\";\r\n\r\n/**\r\n * A series represents bars.\r\n * Data points must be sorted in ascending order on the X axis.\r\n */\r\nexport class DChartSeriesBar extends DChartSeriesLineOfAny {\r\n\tprotected _barCount: number;\r\n\tprotected _barIndex: number;\r\n\tprotected _xcoordinateId: number;\r\n\tprotected _xcoordinateTransformId: number;\r\n\tprotected _padding?: DChartSeriesPaddingComputed;\r\n\r\n\tconstructor( options?: DChartSeriesLineOfAnyOptions ) {\r\n\t\tsuper( options );\r\n\t\tthis._barCount = -1;\r\n\t\tthis._barIndex = -1;\r\n\t\tthis._xcoordinateId = -1;\r\n\t\tthis._xcoordinateTransformId = -1;\r\n\t}\r\n\r\n\tbind( container: DChartSeriesContainer, index: number ): void {\r\n\t\tthis._barCount = -1;\r\n\t\tthis._barIndex = -1;\r\n\t\tthis._xcoordinateId = -1;\r\n\t\tthis._xcoordinateTransformId = -1;\r\n\t\tsuper.bind( container, index );\r\n\t}\r\n\r\n\tprotected initLine(\r\n\t\tline: EShapeLineOfAny,\r\n\t\toptions: DChartSeriesLineOfAnyOptions | undefined,\r\n\t\tcontainer: DChartSeriesContainer,\r\n\t\tindex: number\r\n\t): void {\r\n\t\tsuper.initLine( line, options, container, index );\r\n\t\tthis._padding = container.newPadding( index, options && options.padding );\r\n\t}\r\n\r\n\tprotected newLineOfAny(): EShapeLineOfAny {\r\n\t\treturn new EShapeLineOfRectangles();\r\n\t}\r\n\r\n\tprotected getSizeDefault(): number {\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tprotected adjustLineRegion(\r\n\t\txmin: number, xmax: number,\r\n\t\tymin: number, ymax: number,\r\n\t\tresult: DChartSeriesLineOfAnyRegion\r\n\t): DChartSeriesLineOfAnyRegion {\r\n\t\treturn super.adjustLineRegion(\r\n\t\t\txmin,\r\n\t\t\txmax,\r\n\t\t\tMath.min( 0, ymin ),\r\n\t\t\tMath.max( 0, ymax ),\r\n\t\t\tresult\r\n\t\t);\r\n\t}\r\n\r\n\tprotected updateBarCountAndIndex(): boolean {\r\n\t\tif( this._barIndex < 0 || this._barCount < 0 ) {\r\n\t\t\tlet barIndex = 0;\r\n\t\t\tlet barCount = 0;\r\n\t\t\tconst container = this._container;\r\n\t\t\tif( container ) {\r\n\t\t\t\tfor( let i = 0, imax = container.size(); i < imax; ++i ) {\r\n\t\t\t\t\tconst series = container.get( i );\r\n\t\t\t\t\tif( series === this ) {\r\n\t\t\t\t\t\tbarIndex = barCount;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( series instanceof DChartSeriesBar ) {\r\n\t\t\t\t\t\tbarCount += 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbarCount = Math.max( 1, barCount );\r\n\t\t\tthis._barCount = barCount;\r\n\t\t\tthis._barIndex = barIndex;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected applyLine(\r\n\t\tline: EShapeLineOfAny,\r\n\t\txcoordinate: DChartCoordinate,\r\n\t\tycoordinate: DChartCoordinate,\r\n\t\tsx: number, sy: number,\r\n\t\tcx: number, cy: number,\r\n\t\tvalues: number[]\r\n\t): void {\r\n\t\t// Offset\r\n\t\tconst size = this._size;\r\n\t\tconst offset = this._offset;\r\n\t\tconst padding = this._padding;\r\n\t\tif( size && offset && padding ) {\r\n\t\t\tconst xcoordinateId = xcoordinate.id;\r\n\t\t\tconst xcoordinateTransformId = xcoordinate.transform.id;\r\n\t\t\tif( this.updateBarCountAndIndex() || this._xcoordinateId !== xcoordinateId ||\r\n\t\t\t\tthis._xcoordinateTransformId !== xcoordinateTransformId ) {\r\n\t\t\t\tconst barCount = this._barCount;\r\n\t\t\t\tconst barIndex = this._barIndex;\r\n\t\t\t\tthis._xcoordinateId = xcoordinateId;\r\n\t\t\t\tthis._xcoordinateTransformId = xcoordinateTransformId;\r\n\r\n\t\t\t\tconst x0 = xcoordinate.transform.map( xcoordinate.map( 0 ) );\r\n\t\t\t\tconst x1 = xcoordinate.transform.map( xcoordinate.map( size.x ) );\r\n\t\t\t\tconst totalBandWidth = Math.abs( x1 - x0 ) * ( 1 - padding.outer );\r\n\t\t\t\tif( barCount <= 1 ) {\r\n\t\t\t\t\tline.points.offset.x = offset.x;\r\n\t\t\t\t\tline.points.size.x = totalBandWidth;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst totalBarWidth = totalBandWidth * ( 1 - padding.inner );\r\n\t\t\t\t\tconst totalPaddingInner = totalBandWidth - totalBarWidth;\r\n\t\t\t\t\tconst barWidth = totalBarWidth / barCount;\r\n\t\t\t\t\tconst barPadding = totalPaddingInner / ( barCount - 1 );\r\n\t\t\t\t\tconst barX = barWidth * (barIndex + 0.5) + barIndex * barPadding;\r\n\t\t\t\t\tline.points.offset.x = offset.x + barX - totalBandWidth * 0.5;\r\n\t\t\t\t\tline.points.size.x = barWidth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Sizes & Offsets\r\n\t\tlet sizes = line.points.size.y;\r\n\t\tif( ! isArray( sizes ) ) {\r\n\t\t\tsizes = [];\r\n\t\t}\r\n\t\tconst sizesLength = sizes.length;\r\n\r\n\t\tlet offsets = line.points.offset.y;\r\n\t\tif( ! isArray( offsets ) ) {\r\n\t\t\toffsets = [];\r\n\t\t}\r\n\t\tconst offsetsLength = offsets.length;\r\n\r\n\t\tlet isize = 0;\r\n\t\tconst y0 = ycoordinate.transform.map( ycoordinate.map( 0 ) ) - cy;\r\n\t\tfor( let i = 0, imax = values.length; i < imax; i += 2, isize += 1 ) {\r\n\t\t\tconst distance = values[ i + 1 ] - y0;\r\n\r\n\t\t\tconst s = Math.abs( distance );\r\n\t\t\tif( isize < sizesLength ) {\r\n\t\t\t\tsizes[ isize ] = s;\r\n\t\t\t} else {\r\n\t\t\t\tsizes.push( s );\r\n\t\t\t}\r\n\r\n\t\t\tconst o = -0.5 * distance;\r\n\t\t\tif( isize < offsetsLength ) {\r\n\t\t\t\toffsets[ isize ] = o;\r\n\t\t\t} else {\r\n\t\t\t\toffsets.push( o );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( sizes.length !== isize ) {\r\n\t\t\tsizes.length = isize;\r\n\t\t}\r\n\t\tif( offsets.length !== isize ) {\r\n\t\t\toffsets.length = isize;\r\n\t\t}\r\n\r\n\t\tline.points.size.y = sizes;\r\n\t\tline.points.offset.y = offsets;\r\n\r\n\t\t// Others\r\n\t\tsuper.applyLine( line, xcoordinate, ycoordinate, sx, sy, cx, cy, values );\r\n\t}\r\n\r\n\tprotected calcRegion( points: Array<number | null>, domain: DChartRegion, range: DChartRegion ): void {\r\n\t\tsuper.calcRegion( points, domain, range );\r\n\r\n\t\tconst size = this._size;\r\n\t\tif( size ) {\r\n\t\t\tconst sx = size.x * 0.5;\r\n\t\t\tdomain.set( domain.from - sx, domain.to + sx );\r\n\t\t}\r\n\t\trange.add( 0, 0 );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesLineOfAny } from \"./d-chart-series-line-of-any\";\r\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\r\nimport { EShapeLineOfCircles } from \"./shape/variant/e-shape-line-of-circles\";\r\n\r\n/**\r\n * A series represents a line of circles.\r\n * Data points must be sorted in ascending order on the X axis.\r\n */\r\nexport class DChartSeriesLineOfCircles extends DChartSeriesLineOfAny {\r\n\tprotected newLineOfAny(): EShapeLineOfAny {\r\n\t\treturn new EShapeLineOfCircles();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesLineOfAny } from \"./d-chart-series-line-of-any\";\r\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\r\nimport { EShapeLineOfRectangleRoundeds } from \"./shape/variant/e-shape-line-of-rectangle-roundeds\";\r\n\r\n/**\r\n * A series represents a line of rounded rectangles.\r\n * Data points must be sorted in ascending order on the X axis.\r\n */\r\nexport class DChartSeriesLineOfRectangleRoundeds extends DChartSeriesLineOfAny {\r\n\tprotected newLineOfAny(): EShapeLineOfAny {\r\n\t\treturn new EShapeLineOfRectangleRoundeds();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesLineOfAny } from \"./d-chart-series-line-of-any\";\r\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\r\nimport { EShapeLineOfRectangles } from \"./shape/variant/e-shape-line-of-rectangles\";\r\n\r\n/**\r\n * A series represents a line of rectangles.\r\n * Data points must be sorted in ascending order on the X axis.\r\n */\r\nexport class DChartSeriesLineOfRectangles extends DChartSeriesLineOfAny {\r\n\tprotected newLineOfAny(): EShapeLineOfAny {\r\n\t\treturn new EShapeLineOfRectangles();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2020 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\nimport { DChartSeriesLineOfAny, DChartSeriesLineOfAnyOptions } from \"./d-chart-series-line-of-any\";\r\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\r\nimport { EShapeLineOfTriangles } from \"./shape/variant/e-shape-line-of-triangles\";\r\n\r\n/**\r\n * A series represents a line of triangles.\r\n * Data points must be sorted in ascending order on the X axis.\r\n */\r\nexport class DChartSeriesLineOfTriangles extends DChartSeriesLineOfAny {\r\n\tprotected _sizeId: number;\r\n\r\n\tconstructor( options?: DChartSeriesLineOfAnyOptions ) {\r\n\t\tsuper( options );\r\n\t\tthis._sizeId = 0;\r\n\t}\r\n\r\n\tprotected newLineOfAny(): EShapeLineOfAny {\r\n\t\treturn new EShapeLineOfTriangles();\r\n\t}\r\n\r\n\tprotected applyLine(\r\n\t\tline: EShapeLineOfAny,\r\n\t\txcoordinate: DChartCoordinate,\r\n\t\tycoordinate: DChartCoordinate,\r\n\t\tsx: number, sy: number,\r\n\t\tcx: number, cy: number,\r\n\t\tvalues: number[]\r\n\t): void {\r\n\t\t// Offset\r\n\t\tconst size = this._size;\r\n\t\tconst offset = this._offset;\r\n\t\tif( size && offset && this._sizeId !== size.y ) {\r\n\t\t\tthis._sizeId = size.y;\r\n\t\t\tline.points.offset.y = offset.y - size.y * 0.2;\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tsuper.applyLine( line, xcoordinate, ycoordinate, sx, sy, cx, cy, values );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2020 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DChartSeriesLineOfTriangles } from \"./d-chart-series-line-of-triangles\";\r\nimport { EShapeLineOfAny } from \"./shape/variant/e-shape-line-of-any\";\r\nimport { EShapeLineOfTriangleRoundeds } from \"./shape/variant/e-shape-line-of-triangle-roundeds\";\r\n\r\n/**\r\n * A series represents a line of rounded triangles.\r\n * Data points must be sorted in ascending order on the X axis.\r\n */\r\nexport class DChartSeriesLineOfTriangleRoundeds extends DChartSeriesLineOfTriangles {\r\n\tprotected newLineOfAny(): EShapeLineOfAny {\r\n\t\treturn new EShapeLineOfTriangleRoundeds();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint, Point } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\nimport { DChartSeriesHitResult } from \"./d-chart-series\";\r\nimport { DChartSeriesBase, DChartSeriesBaseOptions } from \"./d-chart-series-base\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { DChartSeriesStrokeComputed, DChartSeriesStrokeComputedOptions } from \"./d-chart-series-stroke-computed\";\r\nimport { EShapeLine } from \"./shape/variant/e-shape-line\";\r\nimport { toCeilingIndex } from \"./util/to-ceiling-index\";\r\n\r\n/**\r\n * {@link DChartSeriesLine} options.\r\n */\r\nexport interface DChartSeriesLineOptions extends DChartSeriesBaseOptions {\r\n\tpoints?: Array<number | null>;\r\n\tstroke?: DChartSeriesStrokeComputedOptions;\r\n}\r\n\r\n/**\r\n * A series represents a polyline.\r\n * Data points must be sorted in ascending order on the X axis.\r\n */\r\nexport class DChartSeriesLine extends DChartSeriesBase {\r\n\tprotected static WORK: Point = new Point();\r\n\tprotected _line: EShapeLine | null;\r\n\tprotected _options?: DChartSeriesLineOptions;\r\n\tprotected _points: Array<number | null>;\r\n\tprotected _pointId: number;\r\n\tprotected _pointIdUpdated: number;\r\n\tprotected _stroke?: DChartSeriesStrokeComputed;\r\n\tprotected _centerX: number;\r\n\tprotected _centerY: number;\r\n\r\n\tconstructor( options?: DChartSeriesLineOptions ) {\r\n\t\tsuper( options );\r\n\t\tthis._line = null;\r\n\t\tthis._options = options;\r\n\t\tthis._points = (options && options.points) || [];\r\n\t\tthis._pointId = 0;\r\n\t\tthis._pointIdUpdated = NaN;\r\n\t\tthis._centerX = 0;\r\n\t\tthis._centerY = 0;\r\n\t}\r\n\r\n\tbind( container: DChartSeriesContainer, index: number ): void {\r\n\t\tlet line = this._line;\r\n\t\tif( ! line ) {\r\n\t\t\tconst stroke = this._stroke = container.newStroke( index, this._options?.stroke );\r\n\t\t\tline = this._line = new EShapeLine([], [], stroke.width, stroke.style);\r\n\t\t\tline.stroke.copy( stroke );\r\n\t\t}\r\n\t\tline.attach( container.plotArea.container, index );\r\n\t\tthis._pointIdUpdated = NaN;\r\n\t\tsuper.bind( container, index );\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tline.detach();\r\n\t\t}\r\n\t\tsuper.unbind();\r\n\t}\r\n\r\n\tget shape(): EShapeLine | null {\r\n\t\treturn this._line;\r\n\t}\r\n\r\n\tget points(): Array<number | null> {\r\n\t\treturn this._points;\r\n\t}\r\n\r\n\tset points( points: Array<number | null> ) {\r\n\t\tthis._points = points;\r\n\t\tthis._pointId += 1;\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._pointId += 1;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tconst coordinate = this._coordinate;\r\n\t\t\tconst coordinateX = coordinate.x;\r\n\t\t\tconst coordinateY = coordinate.y;\r\n\t\t\tif( coordinateX && coordinateY ) {\r\n\t\t\t\tconst pointId = this._pointId;\r\n\t\t\t\tconst isPointChanged = ( pointId !== this._pointIdUpdated );\r\n\t\t\t\tconst isCoordinateChanged = coordinate.isDirty( coordinateX, coordinateY );\r\n\t\t\t\tconst isCoordinateTransformChanged = coordinate.isTransformDirty( coordinateX, coordinateY );\r\n\t\t\t\tif( isPointChanged || isCoordinateChanged || isCoordinateTransformChanged ) {\r\n\t\t\t\t\tthis._pointIdUpdated = pointId;\r\n\t\t\t\t\tthis.updateLine(\r\n\t\t\t\t\t\tline,\r\n\t\t\t\t\t\tcoordinateX,\r\n\t\t\t\t\t\tcoordinateY,\r\n\t\t\t\t\t\tisPointChanged || isCoordinateChanged\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateLine(\r\n\t\tline: EShapeLine,\r\n\t\txcoordinate: DChartCoordinate,\r\n\t\tycoordinate: DChartCoordinate,\r\n\t\tisPointsDirty: boolean\r\n\t): void {\r\n\t\tline.disallowUploadedUpdate();\r\n\t\tif( isPointsDirty ) {\r\n\t\t\tconst values = line.points.values;\r\n\t\t\tconst segments = line.points.segments;\r\n\t\t\tconst valuesLength = values.length;\r\n\t\t\tconst segmentsLength = segments.length;\r\n\t\t\tlet ivalues = 0;\r\n\t\t\tlet isegments = 0;\r\n\t\t\tconst points = this._points;\r\n\t\t\tlet xmin = NaN;\r\n\t\t\tlet xmax = NaN;\r\n\t\t\tlet ymin = NaN;\r\n\t\t\tlet ymax = NaN;\r\n\t\t\tfor( let i = 0, imax = points.length; i < imax; i += 2 ) {\r\n\t\t\t\tconst x = points[ i ];\r\n\t\t\t\tconst y = points[ i + 1 ];\r\n\t\t\t\tif( x != null && y != null ) {\r\n\t\t\t\t\tif( ivalues < valuesLength ) {\r\n\t\t\t\t\t\tvalues[ ivalues ] = x;\r\n\t\t\t\t\t\tvalues[ ivalues + 1 ] = y;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalues.push( x, y );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tivalues += 2;\r\n\t\t\t\t\tif( xmin !== xmin ) {\r\n\t\t\t\t\t\txmin = x;\r\n\t\t\t\t\t\txmax = x;\r\n\t\t\t\t\t\tymin = y;\r\n\t\t\t\t\t\tymax = y;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\txmin = Math.min( xmin, x );\r\n\t\t\t\t\t\txmax = Math.max( xmax, x );\r\n\t\t\t\t\t\tymin = Math.min( ymin, y );\r\n\t\t\t\t\t\tymax = Math.max( ymax, y );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst segment = (i >> 1) - isegments;\r\n\t\t\t\t\tif( isegments < segmentsLength ) {\r\n\t\t\t\t\t\tsegments[ isegments ] = segment;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsegments.push( segment );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tisegments += 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( values.length !== ivalues ) {\r\n\t\t\t\tvalues.length = ivalues;\r\n\t\t\t}\r\n\t\t\tif( segments.length !== isegments ) {\r\n\t\t\t\tsegments.length = isegments;\r\n\t\t\t}\r\n\r\n\t\t\txcoordinate.mapAll( values, 0, ivalues, 2, 0 );\r\n\t\t\tycoordinate.mapAll( values, 0, ivalues, 2, 1 );\r\n\r\n\t\t\tif( xmin !== xmin ) {\r\n\t\t\t\txmin = 0;\r\n\t\t\t\txmax = 0;\r\n\t\t\t\tymin = 0;\r\n\t\t\t\tymax = 0;\r\n\t\t\t}\r\n\r\n\t\t\txmin = xcoordinate.map( xmin );\r\n\t\t\txmax = xcoordinate.map( xmax );\r\n\t\t\tymin = ycoordinate.map( ymin );\r\n\t\t\tymax = ycoordinate.map( ymax );\r\n\r\n\t\t\tconst sx = Math.abs( xmax - xmin );\r\n\t\t\tconst sy = Math.abs( ymax - ymin );\r\n\t\t\tconst cx = ( xmin + xmax ) * 0.5;\r\n\t\t\tconst cy = ( ymin + ymax ) * 0.5;\r\n\t\t\tfor( let i = 0, imax = values.length; i < imax; i += 2 ) {\r\n\t\t\t\tvalues[ i + 0 ] -= cx;\r\n\t\t\t\tvalues[ i + 1 ] -= cy;\r\n\t\t\t}\r\n\r\n\t\t\tline.size.set( sx, sy );\r\n\t\t\tline.points.set( values, segments );\r\n\t\t\tthis._centerX = cx;\r\n\t\t\tthis._centerY = cy;\r\n\t\t}\r\n\r\n\t\tline.transform.position.set(\r\n\t\t\txcoordinate.transform.map( this._centerX ),\r\n\t\t\tycoordinate.transform.map( this._centerY )\r\n\t\t);\r\n\t\tline.transform.scale.set(\r\n\t\t\txcoordinate.transform.scale,\r\n\t\t\tycoordinate.transform.scale\r\n\t\t);\r\n\r\n\t\tline.allowUploadedUpdate();\r\n\t\tDApplications.update( line );\r\n\t}\r\n\r\n\tprotected updateRegion(): void {\r\n\t\tconst pointId = this._pointId;\r\n\t\tif( this._regionPointId !== pointId ) {\r\n\t\t\tthis._regionPointId = pointId;\r\n\r\n\t\t\tconst points = this._points;\r\n\t\t\tconst domain = this._domain;\r\n\t\t\tconst range = this._range;\r\n\t\t\tdomain.clear();\r\n\t\t\trange.clear();\r\n\t\t\tif( points != null ) {\r\n\t\t\t\tfor( let i = 0, imax = points.length; i < imax; i += 2 ) {\r\n\t\t\t\t\tconst xraw = points[ i ];\r\n\t\t\t\t\tif( xraw != null ) {\r\n\t\t\t\t\t\tdomain.add( xraw, xraw );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst yraw = points[ i + 1 ];\r\n\t\t\t\t\tif( yraw != null ) {\r\n\t\t\t\t\t\trange.add( yraw, yraw );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tthis._line = null;\r\n\t\t\tline.detach();\r\n\t\t\tline.destroy();\r\n\t\t}\r\n\r\n\t\tthis._points.length = 0;\r\n\t\tthis._pointId = 0;\r\n\t\tthis._pointIdUpdated = NaN;\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\thitTest( global: IPoint ): boolean {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tconst work = DChartSeriesLine.WORK;\r\n\t\t\tconst local = line.toLocal( global, undefined, work );\r\n\t\t\treturn line.contains( local ) != null;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcalcHitPoint( global: IPoint, result: DChartSeriesHitResult ): boolean {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tconst work = DChartSeriesLine.WORK;\r\n\t\t\tconst local = line.toLocal( global, undefined, work );\r\n\t\t\tresult.shape = line;\r\n\t\t\treturn line.calcHitPoint( local, this.toThreshold, this.calcHitPointTestRange, this.calcHitPointHitTester, result );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected toThreshold( this: unknown, strokeWidth: number, strokeScale: number ): number {\r\n\t\treturn +Infinity;\r\n\t}\r\n\r\n\tcalcHitPointTestRange(\r\n\t\tthis: unknown,\r\n\t\tx: number, y: number,\r\n\t\tthreshold: number,\r\n\t\tvalues: number[],\r\n\t\tresult: [ number, number ]\r\n\t): [ number, number ] {\r\n\t\tconst index = toCeilingIndex( values, x, 2, 0 );\r\n\t\tresult[ 0 ] = Math.max( 0, index - 1 );\r\n\t\tresult[ 1 ] = index;\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcalcHitPointHitTester(\r\n\t\tthis: unknown,\r\n\t\tx: number, y: number,\r\n\t\tp0x: number, p0y: number,\r\n\t\tp1x: number, p1y: number,\r\n\t\tindex: number,\r\n\t\tthreshold: number,\r\n\t\tresult: DChartSeriesHitResult\r\n\t): boolean {\r\n\t\tif( p0x <= x && x < p1x ) {\r\n\t\t\tconst l = p1x - p0x;\r\n\t\t\tif( 0.0001 < Math.abs( l ) ) {\r\n\t\t\t\tconst t = (x - p0x) / l;\r\n\t\t\t\tconst p2x = x;\r\n\t\t\t\tconst p2y = p0y + t * (p1y - p0y);\r\n\t\t\t\tconst distance = Math.abs(p2y - y);\r\n\t\t\t\tif( distance < threshold ) {\r\n\t\t\t\t\tconst position = result.shape!.transform.position;\r\n\t\t\t\t\tconst px = position.x;\r\n\t\t\t\t\tconst py = position.y;\r\n\t\t\t\t\tresult.x = px + p2x;\r\n\t\t\t\t\tresult.y = py + p2y;\r\n\t\t\t\t\tresult.p0x = px + p0x;\r\n\t\t\t\t\tresult.p0y = py + p0y;\r\n\t\t\t\t\tresult.p1x = px + p1x;\r\n\t\t\t\t\tresult.p1y = py + p1y;\r\n\t\t\t\t\tresult.t = t;\r\n\t\t\t\t\tresult.index = index;\r\n\t\t\t\t\tresult.distance = distance;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n","import {\r\n\tDChartSeriesLinearParameters,\r\n\tDChartSeriesLinearParametersOptions\r\n} from \"./d-chart-series-linear-parameters\";\r\n\r\nexport class DChartSeriesExpressionParametersImpl implements DChartSeriesLinearParameters {\r\n\tprotected _id: number;\r\n\tprotected _idUpdated: number;\r\n\tprotected _a: number;\r\n\tprotected _b: number;\r\n\tprotected _x0: number;\r\n\tprotected _y0: number;\r\n\r\n\tconstructor( a: number, b: number, x0: number, y0: number ) {\r\n\t\tthis._id = 0;\r\n\t\tthis._idUpdated = NaN;\r\n\t\tthis._a = a;\r\n\t\tthis._b = b;\r\n\t\tthis._x0 = x0;\r\n\t\tthis._y0 = y0;\r\n\t}\r\n\r\n\tget a(): number {\r\n\t\treturn this._a;\r\n\t}\r\n\r\n\tset a( a: number ) {\r\n\t\tif( this._a !== a ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._a = a;\r\n\t\t}\r\n\t}\r\n\r\n\tget b(): number {\r\n\t\treturn this._b;\r\n\t}\r\n\r\n\tset b( b: number ) {\r\n\t\tif( this._b !== b ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._b = b;\r\n\t\t}\r\n\t}\r\n\r\n\tget x0(): number {\r\n\t\treturn this._x0;\r\n\t}\r\n\r\n\tset x0( x0: number ) {\r\n\t\tif( this._x0 !== x0 ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._x0 = x0;\r\n\t\t}\r\n\t}\r\n\r\n\tget y0(): number {\r\n\t\treturn this._y0;\r\n\t}\r\n\r\n\tset y0( y0: number ) {\r\n\t\tif( this._y0 !== y0 ) {\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._y0 = y0;\r\n\t\t}\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._id += 1;\r\n\t}\r\n\r\n\tisDirty(): boolean {\r\n\t\treturn this._id !== this._idUpdated;\r\n\t}\r\n\r\n\ttoClean(): void {\r\n\t\tthis._idUpdated = this._id;\r\n\t}\r\n\r\n\tstatic from( options?: DChartSeriesLinearParametersOptions ): DChartSeriesExpressionParametersImpl {\r\n\t\tif( options ) {\r\n\t\t\treturn new DChartSeriesExpressionParametersImpl(\r\n\t\t\t\t( options.a != null ? options.a : 1 ),\r\n\t\t\t\t( options.b != null ? options.b : 1 ),\r\n\t\t\t\t( options.x0 != null ? options.x0 : 0 ),\r\n\t\t\t\t( options.y0 != null ? options.y0 : 0 )\r\n\t\t\t);\r\n\t\t}\r\n\t\treturn new DChartSeriesExpressionParametersImpl(\r\n\t\t\t1,\r\n\t\t\t1,\r\n\t\t\t0,\r\n\t\t\t0\r\n\t\t);\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint, Point } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBaseStates } from \"./d-base-states\";\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\nimport { DChartSeriesHitResult } from \"./d-chart-series\";\r\nimport { DChartSeriesBase, DChartSeriesBaseOptions } from \"./d-chart-series-base\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { DChartSeriesLinearParameters, DChartSeriesLinearParametersOptions } from \"./d-chart-series-linear-parameters\";\r\nimport { DChartSeriesExpressionParametersImpl } from \"./d-chart-series-linear-parameters-impl\";\r\nimport { DChartSeriesStrokeComputed, DChartSeriesStrokeComputedOptions } from \"./d-chart-series-stroke-computed\";\r\nimport { EShapeLine } from \"./shape/variant/e-shape-line\";\r\n\r\n/**\r\n * {@link DChartSeriesLinear} options.\r\n */\r\nexport interface DChartSeriesLinearOptions extends DChartSeriesLinearParametersOptions, DChartSeriesBaseOptions {\r\n\tstroke?: DChartSeriesStrokeComputedOptions;\r\n}\r\n\r\n/**\r\n * A series represents a linear equation `a (x - x0) === b (y - y0)`.\r\n */\r\nexport class DChartSeriesLinear extends DChartSeriesBase {\r\n\tprotected static WORK: Point = new Point();\r\n\tprotected _line: EShapeLine | null;\r\n\tprotected _options?: DChartSeriesLinearOptions;\r\n\tprotected _plotAreaSizeXUpdated: number;\r\n\tprotected _plotAreaSizeYUpdated: number;\r\n\tprotected _parameters: DChartSeriesExpressionParametersImpl;\r\n\tprotected _stroke?: DChartSeriesStrokeComputed;\r\n\r\n\tconstructor( options?: DChartSeriesLinearOptions ) {\r\n\t\tsuper( options );\r\n\t\tthis._line = null;\r\n\t\tthis._options = options;\r\n\t\tthis._plotAreaSizeXUpdated = NaN;\r\n\t\tthis._plotAreaSizeYUpdated = NaN;\r\n\t\tthis._parameters = DChartSeriesExpressionParametersImpl.from( options );\r\n\t}\r\n\r\n\tbind( container: DChartSeriesContainer, index: number ): void {\r\n\t\tlet line = this._line;\r\n\t\tif( ! line ) {\r\n\t\t\tconst stroke = this._stroke = container.newStroke( index, this._options?.stroke );\r\n\t\t\tline = this._line = new EShapeLine([], [], stroke.width, stroke.style);\r\n\t\t\tline.stroke.color = stroke.color;\r\n\t\t\tline.stroke.alpha = stroke.alpha;\r\n\t\t}\r\n\t\tline.attach( container.plotArea.container, index );\r\n\t\tthis._parameters.toDirty();\r\n\t\tthis._plotAreaSizeXUpdated = NaN;\r\n\t\tthis._plotAreaSizeYUpdated = NaN;\r\n\t\tsuper.bind( container, index );\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tline.detach();\r\n\t\t}\r\n\t\tsuper.unbind();\r\n\t}\r\n\r\n\tget shape(): EShapeLine | null {\r\n\t\treturn this._line;\r\n\t}\r\n\r\n\tget parameters(): DChartSeriesLinearParameters {\r\n\t\treturn this._parameters;\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._parameters.toDirty();\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst line = this._line;\r\n\t\tconst container = this._container;\r\n\t\tif( line && container ) {\r\n\t\t\tconst plotArea = container.plotArea;\r\n\t\t\tconst coordinate = this._coordinate;\r\n\t\t\tconst coordinateX = coordinate.x;\r\n\t\t\tconst coordinateY = coordinate.y;\r\n\t\t\tif( coordinateX && coordinateY ) {\r\n\t\t\t\tconst plotAreaWidth = plotArea.width;\r\n\t\t\t\tconst plotAreaHeight = plotArea.height;\r\n\r\n\t\t\t\tconst parameters = this._parameters;\r\n\t\t\t\tconst isParametersChanged = parameters.isDirty();\r\n\t\t\t\tconst isCoordinateChanged = coordinate.isDirty( coordinateX, coordinateY );\r\n\t\t\t\tconst isCoordinateTransformChanged = coordinate.isTransformDirty( coordinateX, coordinateY );\r\n\t\t\t\tconst isPlotAreaSizeChagned = ( plotAreaWidth !== this._plotAreaSizeXUpdated ||\r\n\t\t\t\t\tplotAreaHeight !== this._plotAreaSizeYUpdated );\r\n\t\t\t\tif( isParametersChanged || isCoordinateChanged || isCoordinateTransformChanged || isPlotAreaSizeChagned ) {\r\n\t\t\t\t\tparameters.toClean();\r\n\t\t\t\t\tthis._plotAreaSizeXUpdated = plotAreaWidth;\r\n\t\t\t\t\tthis._plotAreaSizeYUpdated = plotAreaHeight;\r\n\t\t\t\t\tthis.updateLine(\r\n\t\t\t\t\t\tline,\r\n\t\t\t\t\t\tcoordinateX,\r\n\t\t\t\t\t\tcoordinateY,\r\n\t\t\t\t\t\tplotAreaWidth,\r\n\t\t\t\t\t\tplotAreaHeight\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateLine(\r\n\t\tline: EShapeLine,\r\n\t\txcoordinate: DChartCoordinate,\r\n\t\tycoordinate: DChartCoordinate,\r\n\t\tplotAreaSizeX: number,\r\n\t\tplotAreaSizeY: number\r\n\t): void {\r\n\t\tconst values = line.points.values;\r\n\t\tconst segments = line.points.segments;\r\n\r\n\t\tconst parameters = this._parameters;\r\n\t\tconst a = parameters.a;\r\n\t\tconst b = parameters.b;\r\n\t\tconst x0 = parameters.x0;\r\n\t\tconst y0 = parameters.y0;\r\n\t\tconst aabs = Math.abs( a );\r\n\t\tconst babs = Math.abs( b );\r\n\r\n\t\tlet p0x = NaN;\r\n\t\tlet p0y = NaN;\r\n\t\tlet p1x = NaN;\r\n\t\tlet p1y = NaN;\r\n\r\n\t\tconst threshold = 0.00001;\r\n\t\tif( babs <= aabs ) {\r\n\t\t\tconst xfrom0 = xcoordinate.unmap(\r\n\t\t\t\txcoordinate.transform.unmap( 0 )\r\n\t\t\t);\r\n\t\t\tconst xto0 = xcoordinate.unmap(\r\n\t\t\t\txcoordinate.transform.unmap( plotAreaSizeX )\r\n\t\t\t);\r\n\t\t\tp0x = Math.min( xfrom0, xto0 );\r\n\t\t\tp1x = Math.max( xfrom0, xto0 );\r\n\r\n\t\t\tif( threshold < aabs ) {\r\n\t\t\t\tconst yfrom = ycoordinate.unmap(\r\n\t\t\t\t\tycoordinate.transform.unmap( 0 )\r\n\t\t\t\t);\r\n\t\t\t\tconst yto = ycoordinate.unmap(\r\n\t\t\t\t\tycoordinate.transform.unmap( plotAreaSizeY )\r\n\t\t\t\t);\r\n\t\t\t\tconst xfrom1 = b * (yfrom - y0) / a + x0;\r\n\t\t\t\tconst xto1 = b * (yto - y0) / a + x0;\r\n\t\t\t\tconst p2x = Math.min( xfrom1, xto1 );\r\n\t\t\t\tconst p3x = Math.max( xfrom1, xto1 );\r\n\r\n\t\t\t\tif( p0x < p2x ) {\r\n\t\t\t\t\tp0x = p2x;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( p3x < p1x ) {\r\n\t\t\t\t\tp1x = p3x;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tp0y = a * (p0x - x0) + b * y0;\r\n\t\t\tp1y = a * (p1x - x0) + b * y0;\r\n\t\t} else {\r\n\t\t\tconst yfrom0 = ycoordinate.unmap(\r\n\t\t\t\tycoordinate.transform.unmap( 0 )\r\n\t\t\t);\r\n\t\t\tconst yto0 = ycoordinate.unmap(\r\n\t\t\t\tycoordinate.transform.unmap( plotAreaSizeY )\r\n\t\t\t);\r\n\t\t\tp0y = Math.min( yfrom0, yto0 );\r\n\t\t\tp1y = Math.max( yfrom0, yto0 );\r\n\r\n\t\t\tif( threshold < babs ) {\r\n\t\t\t\tconst xfrom = xcoordinate.unmap(\r\n\t\t\t\t\txcoordinate.transform.unmap( 0 )\r\n\t\t\t\t);\r\n\t\t\t\tconst xto = xcoordinate.unmap(\r\n\t\t\t\t\txcoordinate.transform.unmap( plotAreaSizeX )\r\n\t\t\t\t);\r\n\t\t\t\tconst yfrom1 = a * (xfrom - x0) / b + y0;\r\n\t\t\t\tconst yto1 = a * (xto - x0) / b + y0;\r\n\t\t\t\tconst p2y = Math.min( yfrom1, yto1 );\r\n\t\t\t\tconst p3y = Math.max( yfrom1, yto1 );\r\n\r\n\t\t\t\tif( p0y < p2y ) {\r\n\t\t\t\t\tp0y = p2y;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif( p3y < p1y ) {\r\n\t\t\t\t\tp1y = p3y;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tp0x = b * (p0y - y0) + a * x0;\r\n\t\t\tp1x = b * (p1y - y0) + a * x0;\r\n\t\t}\r\n\r\n\t\tp0x = xcoordinate.transform.map( xcoordinate.map( p0x ) );\r\n\t\tp0y = ycoordinate.transform.map( ycoordinate.map( p0y ) );\r\n\t\tp1x = xcoordinate.transform.map( xcoordinate.map( p1x ) );\r\n\t\tp1y = ycoordinate.transform.map( ycoordinate.map( p1y ) );\r\n\r\n\t\tconst cx = ( p0x + p1x ) * 0.5;\r\n\t\tconst cy = ( p0y + p1y ) * 0.5;\r\n\t\tconst sx = Math.abs( p1x - p0x );\r\n\t\tconst sy = Math.abs( p1y - p0y );\r\n\r\n\t\tp0x -= cx;\r\n\t\tp0y -= cy;\r\n\t\tp1x -= cx;\r\n\t\tp1y -= cy;\r\n\r\n\t\tif( values.length !== 4 ) {\r\n\t\t\tvalues.length = 0;\r\n\t\t\tvalues.push( p0x, p0y, p1x, p1y );\r\n\t\t} else {\r\n\t\t\tvalues[ 0 ] = p0x;\r\n\t\t\tvalues[ 1 ] = p0y;\r\n\t\t\tvalues[ 2 ] = p1x;\r\n\t\t\tvalues[ 3 ] = p1y;\r\n\t\t}\r\n\t\tif( segments.length !== 0 ) {\r\n\t\t\tsegments.length = 0;\r\n\t\t}\r\n\t\tline.disallowUploadedUpdate();\r\n\t\tline.points.set( values, segments );\r\n\t\tline.size.set( sx, sy );\r\n\t\tline.transform.position.set( cx, cy );\r\n\t\tline.allowUploadedUpdate();\r\n\t\tDApplications.update( line );\r\n\t}\r\n\r\n\tprotected updateRegion(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tthis._line = null;\r\n\t\t\tline.detach();\r\n\t\t\tline.destroy();\r\n\t\t}\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\thitTest( global: IPoint ): boolean {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tconst work = DChartSeriesLinear.WORK;\r\n\t\t\tconst local = line.toLocal( global, undefined, work );\r\n\t\t\treturn line.contains( local ) != null;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcalcHitPoint( global: IPoint, result: DChartSeriesHitResult ): boolean {\r\n\t\tconst line = this._line;\r\n\t\tif( line ) {\r\n\t\t\tconst work = DChartSeriesLinear.WORK;\r\n\t\t\tconst local = line.toLocal( global, undefined, work );\r\n\t\t\tresult.shape = line;\r\n\t\t\treturn line.calcHitPoint( local, this.toThreshold, null, this.calcHitPointHitTester, result );\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected toThreshold( this: unknown, strokeWidth: number, strokeScale: number ): number {\r\n\t\treturn +Infinity;\r\n\t}\r\n\r\n\tcalcHitPointHitTester(\r\n\t\tthis: unknown,\r\n\t\tx: number, y: number,\r\n\t\tp0x: number, p0y: number,\r\n\t\tp1x: number, p1y: number,\r\n\t\tindex: number,\r\n\t\tthreshold: number,\r\n\t\tresult: DChartSeriesHitResult\r\n\t): boolean {\r\n\t\tif( p0x <= x && x < p1x ) {\r\n\t\t\tconst l = p1x - p0x;\r\n\t\t\tif( 0.0001 < Math.abs( l ) ) {\r\n\t\t\t\tconst t = (x - p0x) / l;\r\n\t\t\t\tconst p2x = x;\r\n\t\t\t\tconst p2y = p0y + t * (p1y - p0y);\r\n\t\t\t\tconst distance = Math.abs(p2y - y);\r\n\t\t\t\tif( distance < threshold ) {\r\n\t\t\t\t\tconst position = result.shape!.transform.position;\r\n\t\t\t\t\tconst px = position.x;\r\n\t\t\t\t\tconst py = position.y;\r\n\t\t\t\t\tresult.x = result.p0x = result.p1x = px + p2x;\r\n\t\t\t\t\tresult.y = result.p0y = result.p1y = py + p2y;\r\n\t\t\t\t\tresult.t = t;\r\n\t\t\t\t\tresult.index = index;\r\n\t\t\t\t\tresult.distance = distance;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected onStateChange( newState: number, oldState: number ) {\r\n\t\tconst isActive = DBaseStates.isActive( newState );\r\n\t\tconst wasActive = DBaseStates.isActive( oldState );\r\n\t\tif( isActive !== wasActive ) {\r\n\t\t\tconst line = this._line;\r\n\t\t\tconst stroke = this._stroke;\r\n\t\t\tif( line && stroke ) {\r\n\t\t\t\tline.stroke.width = stroke.width * ( isActive ? 2 : 1 );\r\n\t\t\t}\r\n\t\t}\r\n\t\tsuper.onStateChange( newState, oldState );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DChartSelectionStyle } from \"./d-chart-selection\";\r\nimport {\r\n\tDChartSelectionShape, DChartSelectionShapeOptions,\r\n\tDThemeChartSelectionShape\r\n} from \"./d-chart-selection-shape\";\r\nimport { DChartSeries } from \"./d-chart-series\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { EShape } from \"./shape/e-shape\";\r\nimport { DThemes } from \"./theme/d-themes\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport abstract class DChartSelectionShapeBase implements DChartSelectionShape {\r\n\tprotected _isEnabled: boolean;\r\n\tprotected _shape?: EShape;\r\n\tprotected _style: DChartSelectionStyle;\r\n\tprotected _state: DBaseState;\r\n\tprotected _theme: DThemeChartSelectionShape;\r\n\r\n\tconstructor( options?: DChartSelectionShapeOptions ) {\r\n\t\tconst theme = this.toTheme( options );\r\n\t\tthis._theme = theme;\r\n\t\tconst state = ( options && options.state != null ? options.state : DBaseState.HOVERED );\r\n\t\tthis._state = state;\r\n\t\tthis._isEnabled = ( options && options.enable != null ? options.enable : theme.isEnabled( state ) );\r\n\t\tthis._shape = options && options.shape;\r\n\t\tthis._style = (options && options.style) || this.setStyle;\r\n\t}\r\n\r\n\tbind( container: DChartSeriesContainer ): void {\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tconst shape = this._shape = (this._shape || this.newShape( this._theme ));\r\n\t\t\tshape.attach( container.plotArea.axis.container );\r\n\t\t\tshape.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tconst shape = this._shape;\r\n\t\tif( shape ) {\r\n\t\t\tshape.detach();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newShape( theme: DThemeChartSelectionShape ): EShape {\r\n\t\treturn theme.newShape( this._state );\r\n\t}\r\n\r\n\tset( container: DChartSeriesContainer, mappedPosition: IPoint, series: DChartSeries ): void {\r\n\t\tthis.update( container, mappedPosition );\r\n\r\n\t\tconst shape = this._shape;\r\n\t\tif( shape ) {\r\n\t\t\tthis._style( shape, series );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setStyle( this: unknown, shape: EShape, series: DChartSeries ): void {\r\n\t\tconst seriesShape = series.shape;\r\n\t\tif( seriesShape ) {\r\n\t\t\tshape.stroke.color = seriesShape.stroke.color;\r\n\t\t}\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tconst shape = this._shape;\r\n\t\tif( shape ) {\r\n\t\t\tshape.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\tabstract update( container: DChartSeriesContainer, mappedPosition: IPoint ): void;\r\n\r\n\tprotected toTheme( options?: DChartSelectionShapeOptions ): DThemeChartSelectionShape {\r\n\t\tconst theme = ( options && options.theme );\r\n\t\tif( isString( theme ) ) {\r\n\t\t\treturn this.getTheme( theme );\r\n\t\t} else if( theme != null ) {\r\n\t\t\treturn theme;\r\n\t\t} else {\r\n\t\t\treturn this.getTheme( this.getType() );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getTheme( type: string ): DThemeChartSelectionShape {\r\n\t\treturn DThemes.getInstance().get( type );\r\n\t}\r\n\r\n\tprotected abstract getType(): string;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { DChartSelectionShapeBase } from \"./d-chart-selection-shape-base\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\n\r\nexport class DChartSelectionGridlineX extends DChartSelectionShapeBase {\r\n\tupdate( container: DChartSeriesContainer, mappedPosition: IPoint ): void {\r\n\t\tconst shape = this._shape;\r\n\t\tif( shape ) {\r\n\t\t\tconst mappedX = mappedPosition.x;\r\n\t\t\tconst height = container.plotArea.height;\r\n\t\t\tshape.transform.position.set( mappedX, height * 0.5 );\r\n\t\t\tshape.size.set( 0, height );\r\n\t\t\tshape.visible = this.isVisible( container, mappedX );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected isVisible( container: DChartSeriesContainer, mappedX: number ): boolean {\r\n\t\treturn ( 0 <= mappedX && mappedX <= container.plotArea.width );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartSelectionGridlineX\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { DChartSelectionShapeBase } from \"./d-chart-selection-shape-base\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\n\r\nexport class DChartSelectionGridlineY extends DChartSelectionShapeBase {\r\n\tupdate( container: DChartSeriesContainer, mappedPosition: IPoint ): void {\r\n\t\tconst shape = this._shape;\r\n\t\tif( shape ) {\r\n\t\t\tconst mappedY = mappedPosition.y;\r\n\t\t\tconst width = container.plotArea.width;\r\n\t\t\tshape.transform.position.set( width * 0.5, mappedY );\r\n\t\t\tshape.size.set( width, 0 );\r\n\t\t\tshape.visible = this.isVisible( container, mappedY );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected isVisible( container: DChartSeriesContainer, mappedY: number ): boolean {\r\n\t\treturn ( 0 <= mappedY && mappedY <= container.plotArea.height );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartSelectionGridlineY\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport {\r\n\tDChartSelectionGridlineContainer, DChartSelectionGridlineContainerOptions\r\n} from \"./d-chart-selection-gridline-container\";\r\nimport { DChartSelectionGridlineX } from \"./d-chart-selection-gridline-x\";\r\nimport { DChartSelectionGridlineY } from \"./d-chart-selection-gridline-y\";\r\nimport { DChartSelectionShape } from \"./d-chart-selection-shape\";\r\nimport { DChartSeries } from \"./d-chart-series\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\n\r\nexport class DChartSelectionGridlineContainerImpl implements DChartSelectionGridlineContainer {\r\n\tprotected _x: DChartSelectionShape;\r\n\tprotected _y: DChartSelectionShape;\r\n\r\n\tconstructor( options?: DChartSelectionGridlineContainerOptions ) {\r\n\t\tthis._x = new DChartSelectionGridlineX( options && options.x );\r\n\t\tthis._y = new DChartSelectionGridlineY( options && options.y );\r\n\t}\r\n\r\n\tget x(): DChartSelectionShape {\r\n\t\treturn this._x;\r\n\t}\r\n\r\n\tget y(): DChartSelectionShape {\r\n\t\treturn this._y;\r\n\t}\r\n\r\n\tbind( container: DChartSeriesContainer ): void {\r\n\t\tthis._x.bind( container );\r\n\t\tthis._y.bind( container );\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tthis._x.unbind();\r\n\t\tthis._y.unbind();\r\n\t}\r\n\r\n\tset( container: DChartSeriesContainer, mappedPosition: IPoint, series: DChartSeries ): void {\r\n\t\tthis._x.set( container, mappedPosition, series );\r\n\t\tthis._y.set( container, mappedPosition, series );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._x.unset();\r\n\t\tthis._y.unset();\r\n\t}\r\n\r\n\tupdate( container: DChartSeriesContainer, mappedPosition: IPoint ): void {\r\n\t\tthis._x.update( container, mappedPosition );\r\n\t\tthis._y.update( container, mappedPosition );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { DChartSelectionShapeBase } from \"./d-chart-selection-shape-base\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\n\r\nexport class DChartSelectionMarker extends DChartSelectionShapeBase {\r\n\tupdate( container: DChartSeriesContainer, mappedPosition: IPoint ): void {\r\n\t\tconst shape = this._shape;\r\n\t\tif( shape ) {\r\n\t\t\tshape.transform.position.copyFrom( mappedPosition );\r\n\t\t\tshape.visible = this.isVisible( container, mappedPosition );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected isVisible( container: DChartSeriesContainer, mappedPosition: IPoint ): boolean {\r\n\t\tconst x = mappedPosition.x;\r\n\t\tconst y = mappedPosition.y;\r\n\t\tconst plotArea = container.plotArea;\r\n\t\treturn ( 0 <= x && x <= plotArea.width && 0 <= y && y <= plotArea.height );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChartSelectionMarker\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Point, utils } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DChartCoordinate } from \"./d-chart-coordinate\";\r\nimport { DChartSelectionPoint } from \"./d-chart-selection\";\r\nimport { DChartSelectionGridlineContainer } from \"./d-chart-selection-gridline-container\";\r\nimport { DChartSelectionGridlineContainerImpl } from \"./d-chart-selection-gridline-container-impl\";\r\nimport { DChartSelectionMarker } from \"./d-chart-selection-marker\";\r\nimport { DChartSelectionSub, DChartSelectionSubOptions } from \"./d-chart-selection-sub\";\r\nimport { DChartSeries, DChartSeriesHitResult } from \"./d-chart-series\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { EShape } from \"./shape/e-shape\";\r\n\r\nexport class DChartSelectionSubImpl extends utils.EventEmitter implements DChartSelectionSub {\r\n\tprotected _container: DChartSeriesContainer | null;\r\n\tprotected _isEnabled: boolean;\r\n\tprotected _series: DChartSeries | null;\r\n\tprotected _coordinateX: DChartCoordinate | null;\r\n\tprotected _coordinateY: DChartCoordinate | null;\r\n\tprotected _position: Point;\r\n\tprotected _point: DChartSelectionPoint;\r\n\tprotected _work: Point;\r\n\tprotected _gridline: DChartSelectionGridlineContainer;\r\n\tprotected _marker: DChartSelectionMarker;\r\n\tprotected _state: DBaseState;\r\n\r\n\tconstructor( options: DChartSelectionSubOptions ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._container = null;\r\n\t\tthis._series = null;\r\n\t\tthis._isEnabled = ( options.enable != null ? options.enable : true );\r\n\t\tthis._gridline = new DChartSelectionGridlineContainerImpl( options.gridline );\r\n\t\tthis._marker = new DChartSelectionMarker( options.marker );\r\n\t\tthis._state = ( options.state != null ? options.state : DBaseState.HOVERED );\r\n\t\tthis._coordinateX = null;\r\n\t\tthis._coordinateY = null;\r\n\t\tthis._position = new Point();\r\n\t\tthis._point = ( options.point != null ? options.point : DChartSelectionPoint.CLOSER );\r\n\t\tthis._work = new Point();\r\n\r\n\t\t// Events\r\n\t\tconst on = options.on;\r\n\t\tif( on ) {\r\n\t\t\tfor( const name in on ) {\r\n\t\t\t\tconst handler = on[ name ];\r\n\t\t\t\tif( handler ) {\r\n\t\t\t\t\tthis.on( name, handler );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tbind( container: DChartSeriesContainer ): void {\r\n\t\tif( this._isEnabled ) {\r\n\t\t\tthis._container = container;\r\n\t\t\tthis._gridline.bind( container );\r\n\t\t\tthis._marker.bind( container );\r\n\t\t}\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tthis._marker.unbind();\r\n\t\tthis._gridline.unbind();\r\n\t\tthis._container = null;\r\n\t\tthis._coordinateX = null;\r\n\t\tthis._coordinateY = null;\r\n\t}\r\n\r\n\tget series(): DChartSeries | null {\r\n\t\treturn this._series;\r\n\t}\r\n\r\n\tget position(): Point {\r\n\t\treturn this._position;\r\n\t}\r\n\r\n\tget gridline(): DChartSelectionGridlineContainer {\r\n\t\treturn this._gridline;\r\n\t}\r\n\r\n\tget marker(): DChartSelectionMarker {\r\n\t\treturn this._marker;\r\n\t}\r\n\r\n\tset( series: DChartSeries, result: DChartSeriesHitResult | DChartSelectionSub ): void {\r\n\t\tconst container = this._container;\r\n\t\tconst coordinateX = this._coordinateX = series.coordinate.x;\r\n\t\tconst coordinateY = this._coordinateY = series.coordinate.y;\r\n\t\tif( container && coordinateX && coordinateY ) {\r\n\t\t\tconst transform = container.plotArea.container.localTransform;\r\n\t\t\tconst position = this._position;\r\n\t\t\tconst work = this._work;\r\n\t\t\tif( result instanceof DChartSeriesHitResult ) {\r\n\t\t\t\tlet x = result.x;\r\n\t\t\t\tlet y = result.y;\r\n\t\t\t\tswitch( this._point ) {\r\n\t\t\t\tcase DChartSelectionPoint.PREVIOUS:\r\n\t\t\t\t\tx = result.p0x;\r\n\t\t\t\t\ty = result.p0y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase DChartSelectionPoint.NEXT:\r\n\t\t\t\t\tx = result.p1x;\r\n\t\t\t\t\ty = result.p1y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase DChartSelectionPoint.CLOSER:\r\n\t\t\t\t\tif( Math.abs( result.p0x - result.x ) < Math.abs( result.p1x - result.x ) ) {\r\n\t\t\t\t\t\tx = result.p0x;\r\n\t\t\t\t\t\ty = result.p0y;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tx = result.p1x;\r\n\t\t\t\t\t\ty = result.p1y;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\twork.set( x, y );\r\n\t\t\t\ttransform.apply( work, work );\r\n\t\t\t\tposition.set(\r\n\t\t\t\t\tcoordinateX.unmap( coordinateX.transform.unmap( x ) ),\r\n\t\t\t\t\tcoordinateY.unmap( coordinateY.transform.unmap( y ) )\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tposition.copyFrom( result.position );\r\n\t\t\t\twork.set(\r\n\t\t\t\t\tcoordinateX.transform.map( coordinateX.map( position.x ) ),\r\n\t\t\t\t\tcoordinateY.transform.map( coordinateY.map( position.y ) )\r\n\t\t\t\t);\r\n\t\t\t\ttransform.apply( work, work );\r\n\t\t\t}\r\n\r\n\t\t\tthis._gridline.set( container, work, series );\r\n\t\t\tthis._marker.set( container, work, series );\r\n\r\n\t\t\tDApplications.update( container.plotArea );\r\n\t\t}\r\n\r\n\t\tconst oldSeries = this._series;\r\n\t\tif( oldSeries !== series ) {\r\n\t\t\tconst state = this._state;\r\n\t\t\tif( oldSeries ) {\r\n\t\t\t\toldSeries.setState( state, false );\r\n\t\t\t}\r\n\r\n\t\t\tthis._series = series;\r\n\t\t\tseries.setState( state, true );\r\n\t\t}\r\n\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\tprotected setStyle( this: unknown, shape: EShape, series: DChartSeries ): void {\r\n\t\tconst seriesShape = series.shape;\r\n\t\tif( seriesShape ) {\r\n\t\t\tshape.stroke.color = seriesShape.stroke.color;\r\n\t\t}\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tconst series = this._series;\r\n\t\tif( series ) {\r\n\t\t\tthis._series = null;\r\n\t\t\tthis._coordinateX = null;\r\n\t\t\tthis._coordinateY = null;\r\n\r\n\t\t\tseries.setState( this._state, false );\r\n\r\n\t\t\tthis._gridline.unset();\r\n\t\t\tthis._marker.unset();\r\n\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst container = this._container;\r\n\t\tconst coordinateX = this._coordinateX;\r\n\t\tconst coordinateY = this._coordinateY;\r\n\t\tif( container && coordinateX && coordinateY ) {\r\n\t\t\tconst position = this._position;\r\n\t\t\tconst work = this._work;\r\n\t\t\twork.set(\r\n\t\t\t\tcoordinateX.transform.map( coordinateX.map( position.x ) ),\r\n\t\t\t\tcoordinateY.transform.map( coordinateY.map( position.y ) )\r\n\t\t\t);\r\n\t\t\tcontainer.plotArea.container.localTransform.apply( work, work );\r\n\r\n\t\t\tthis._gridline.update( container, work );\r\n\t\t\tthis._marker.update( container, work );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, utils } from \"pixi.js\";\r\nimport { DBaseOnOptions } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DChartSelection, DChartSelectionPoint } from \"./d-chart-selection\";\r\nimport { DChartSelectionSub, DChartSelectionSubOptions } from \"./d-chart-selection-sub\";\r\nimport { DChartSelectionSubImpl } from \"./d-chart-selection-sub-impl\";\r\nimport { DChartSeriesHitResult } from \"./d-chart-series\";\r\nimport { DChartSeriesContainer } from \"./d-chart-series-container\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DChartSelectionSimpleOptions {\r\n\tselected?: DChartSelectionSubOptions;\r\n\thovered?: DChartSelectionSubOptions;\r\n\tpoint?: DChartSelectionPoint | (keyof typeof DChartSelectionPoint);\r\n\ton?: DBaseOnOptions;\r\n}\r\n\r\nexport class DChartSelectionSimple extends utils.EventEmitter implements DChartSelection {\r\n\tprotected static WORK_SELECT: DChartSeriesHitResult = new DChartSeriesHitResult();\r\n\r\n\tprotected _container: DChartSeriesContainer | null;\r\n\tprotected _selected: DChartSelectionSub;\r\n\tprotected _hovered: DChartSelectionSub;\r\n\r\n\tprotected _onClickBound!: ( e: interaction.InteractionEvent ) => void;\r\n\tprotected _onMoveBound!: ( e: interaction.InteractionEvent ) => void;\r\n\r\n\tconstructor( options?: DChartSelectionSimpleOptions ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._container = null;\r\n\t\tconst point = ( options && options.point != null ?\r\n\t\t\t( isString( options.point ) ? DChartSelectionPoint[ options.point ] : options.point ) :\r\n\t\t\tDChartSelectionPoint.CLOSER\r\n\t\t);\r\n\r\n\t\tthis._selected = this.newSelected( point, options && options.selected );\r\n\t\tthis._hovered = this.newHovered( point, options && options.hovered );\r\n\r\n\t\t// Events\r\n\t\tif( options ) {\r\n\t\t\tconst on = options.on;\r\n\t\t\tif( on != null ) {\r\n\t\t\t\tfor( const name in on ) {\r\n\t\t\t\t\tconst handler = on[ name ];\r\n\t\t\t\t\tif( handler ) {\r\n\t\t\t\t\t\tthis.on( name, handler );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tthis._onMoveBound = ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tthis.onMove( e );\r\n\t\t};\r\n\r\n\t\tthis._onClickBound = ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tthis.onClick( e );\r\n\t\t};\r\n\t}\r\n\r\n\tprotected newSelected(\r\n\t\tpoint: DChartSelectionPoint,\r\n\t\toptions?: DChartSelectionSubOptions\r\n\t): DChartSelectionSub {\r\n\t\treturn new DChartSelectionSubImpl(\r\n\t\t\tthis.toSubOptions(\r\n\t\t\t\tpoint,\r\n\t\t\t\toptions,\r\n\t\t\t\tDBaseState.ACTIVE\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\r\n\tprotected newHovered(\r\n\t\tpoint: DChartSelectionPoint,\r\n\t\toptions?: DChartSelectionSubOptions\r\n\t): DChartSelectionSub {\r\n\t\treturn new DChartSelectionSubImpl(\r\n\t\t\tthis.toSubOptions(\r\n\t\t\t\tpoint,\r\n\t\t\t\toptions,\r\n\t\t\t\tDBaseState.HOVERED\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toSubOptions(\r\n\t\tpoint: DChartSelectionPoint,\r\n\t\toptions: DChartSelectionSubOptions | undefined,\r\n\t\tstate: DBaseState\r\n\t): DChartSelectionSubOptions {\r\n\t\toptions = options || {};\r\n\r\n\t\tif( options.point == null ) {\r\n\t\t\toptions.point = point;\r\n\t\t}\r\n\r\n\t\tif( options.state == null ) {\r\n\t\t\toptions.state = state;\r\n\t\t}\r\n\r\n\t\tconst gridline = options.gridline || {};\r\n\t\tconst gridlineX = gridline.x || {};\r\n\t\tif( gridlineX.state == null ) {\r\n\t\t\tgridlineX.state = state;\r\n\t\t}\r\n\r\n\t\tconst gridlineY = gridline.y || {};\r\n\t\tif( gridlineY.state == null ) {\r\n\t\t\tgridlineY.state = state;\r\n\t\t}\r\n\r\n\t\tconst marker = options.marker || {};\r\n\t\tif( marker.state == null ) {\r\n\t\t\tmarker.state = state;\r\n\t\t}\r\n\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected onClick( e: interaction.InteractionEvent ): void {\r\n\t\tconst container = this._container;\r\n\t\tif( container && e.target === container.plotArea ) {\r\n\t\t\tconst hovered = this._hovered;\r\n\t\t\tconst series = hovered.series;\r\n\t\t\tconst selected = this._selected;\r\n\t\t\tif( series ) {\r\n\t\t\t\tselected.set( series, hovered );\r\n\t\t\t} else {\r\n\t\t\t\tselected.unset();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onMove( e: interaction.InteractionEvent ): void {\r\n\t\tconst container = this._container;\r\n\t\tif( container ) {\r\n\t\t\tconst hovered = this._hovered;\r\n\t\t\tif( e.target === container.plotArea ) {\r\n\t\t\t\tconst result = DChartSelectionSimple.WORK_SELECT;\r\n\t\t\t\tconst series = container.calcHitPoint( e.data.global, result );\r\n\t\t\t\tif( series ) {\r\n\t\t\t\t\thovered.set( series, result );\r\n\t\t\t\t} else {\r\n\t\t\t\t\thovered.unset();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\thovered.unset();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tbind( container: DChartSeriesContainer ): void {\r\n\t\tthis._container = container;\r\n\t\tthis._selected.bind( container );\r\n\t\tthis._hovered.bind( container );\r\n\t\tconst plotArea = container.plotArea;\r\n\t\tplotArea.on( UtilPointerEvent.move, this._onMoveBound );\r\n\t\tUtilPointerEvent.onClick( plotArea, this._onClickBound );\r\n\t}\r\n\r\n\tunbind(): void {\r\n\t\tconst container = this._container;\r\n\t\tthis._container = null;\r\n\t\tif( container ) {\r\n\t\t\tconst plotArea = container.plotArea;\r\n\t\t\tplotArea.off( UtilPointerEvent.move, this._onMoveBound );\r\n\t\t}\r\n\r\n\t\tthis._selected.unbind();\r\n\t\tthis._hovered.unbind();\r\n\t}\r\n\r\n\tget selected(): DChartSelectionSub {\r\n\t\treturn this._selected;\r\n\t}\r\n\r\n\tget hovered(): DChartSelectionSub {\r\n\t\treturn this._hovered;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tthis._selected.update();\r\n\t\tthis._hovered.update();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DChartPlotArea, DChartPlotAreaOptions} from \"./d-chart-plot-area\";\r\n\r\nexport interface DChartOptions<THEME extends DThemeChart> extends DBaseOptions<THEME> {\r\n\tplotArea: DChartPlotAreaOptions;\r\n}\r\n\r\nexport interface DThemeChart extends DThemeBase {\r\n}\r\n\r\nexport class DChart<\r\n\tTHEME extends DThemeChart = DThemeChart,\r\n\tOPTIONS extends DChartOptions<THEME> = DChartOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected _plotArea!: DChartPlotArea;\r\n\r\n\tprotected init( options?: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\r\n\t\tconst plotArea = new DChartPlotArea( this, options && options.plotArea );\r\n\t\tthis._plotArea = plotArea;\r\n\t\tthis.addChild( plotArea );\r\n\t}\r\n\r\n\tget plotArea(): DChartPlotArea {\r\n\t\treturn this._plotArea;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DChart\";\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tif( ! this._destroyed ) {\r\n\t\t\tthis._plotArea.destroy();\r\n\t\t\tsuper.destroy();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCommand } from \"./d-command\";\r\nimport { DCommandFlag } from \"./d-command-flag\";\r\n\r\nexport abstract class DCommandCreate implements DCommand {\r\n\tabstract execute(): Promise<unknown> | boolean;\r\n\r\n\tredo(): Promise<unknown> | boolean {\r\n\t\tthrow new Error(\"Method not implemented.\");\r\n\t}\r\n\r\n\tundo(): Promise<unknown> | boolean {\r\n\t\tthrow new Error(\"Method not implemented.\");\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tgetFlag(): DCommandFlag {\r\n\t\treturn DCommandFlag.UNSTORABLE | DCommandFlag.CLEAR;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCommand } from \"./d-command\";\r\nimport { DCommandFlag } from \"./d-command-flag\";\r\nimport { DControllers } from \"./d-controllers\";\r\n\r\nexport class DCommandDelete implements DCommand {\r\n\texecute(): Promise<unknown> | boolean {\r\n\t\treturn DControllers.getDocumentController().delete();\r\n\t}\r\n\r\n\tredo(): Promise<unknown> | boolean {\r\n\t\tthrow new Error(\"Method not implemented.\");\r\n\t}\r\n\r\n\tundo(): Promise<unknown> | boolean {\r\n\t\tthrow new Error(\"Method not implemented.\");\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tgetFlag(): DCommandFlag {\r\n\t\treturn DCommandFlag.UNSTORABLE | DCommandFlag.CLEAR;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCommand } from \"./d-command\";\r\nimport { DCommandFlag } from \"./d-command-flag\";\r\nimport { DControllers } from \"./d-controllers\";\r\n\r\nexport class DCommandSaveAs implements DCommand {\r\n\tprotected _name: string;\r\n\r\n\tconstructor( name: string ) {\r\n\t\tthis._name = name;\r\n\t}\r\n\r\n\texecute(): Promise<unknown> | boolean {\r\n\t\treturn DControllers.getDocumentController().saveAs( this._name );\r\n\t}\r\n\r\n\tredo(): Promise<unknown> | boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tundo(): Promise<unknown> | boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tgetFlag(): DCommandFlag {\r\n\t\treturn DCommandFlag.UNSTORABLE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCommand } from \"./d-command\";\r\nimport { DCommandFlag } from \"./d-command-flag\";\r\nimport { DControllers } from \"./d-controllers\";\r\n\r\nexport class DCommandSave implements DCommand {\r\n\texecute(): Promise<unknown> | boolean {\r\n\t\treturn DControllers.getDocumentController().save();\r\n\t}\r\n\r\n\tredo(): Promise<unknown> | boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tundo(): Promise<unknown> | boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tgetFlag(): DCommandFlag {\r\n\t\treturn DCommandFlag.UNSTORABLE;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { ObservablePoint } from \"pixi.js\";\r\nimport { DMapTileMappingPoint } from \"./d-map-tile-mapping\";\r\n\r\nexport class DDiagramCanvasTileMappingPointImpl extends ObservablePoint implements DMapTileMappingPoint {\r\n\tget lon(): number {\r\n\t\treturn this.x;\r\n\t}\r\n\r\n\tset lon( lon: number ) {\r\n\t\tthis.x = lon;\r\n\t}\r\n\r\n\tget lat(): number {\r\n\t\treturn this.y;\r\n\t}\r\n\r\n\tset lat( lat: number ) {\r\n\t\tthis.y = lat;\r\n\t}\r\n\r\n\ttoObject(): { lon: number, lat: number } {\r\n\t\treturn {\r\n\t\t\tlon: this.x,\r\n\t\t\tlat: this.y\r\n\t\t};\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramCanvasTileMapping } from \"./d-diagram-canvas-mapping\";\r\nimport { DDiagramCanvasTileMappingPointImpl } from \"./d-diagram-canvas-mapping-point-impl\";\r\nimport { DMapTileMappingPoint } from \"./d-map-tile-mapping\";\r\n\r\nexport class DDiagramCanvasTileMappingImpl implements DDiagramCanvasTileMapping {\r\n\tprotected _enable: boolean;\r\n\tprotected _from: DDiagramCanvasTileMappingPointImpl;\r\n\tprotected _to: DDiagramCanvasTileMappingPointImpl;\r\n\tprotected _cb: () => void;\r\n\r\n\tconstructor( cb: () => void, mapping?: DDiagramCanvasTileMapping );\r\n\tconstructor( cb: () => void, enable: boolean, lon0: number, lat0: number, lon1: number, lat1: number );\r\n\tconstructor(\r\n\t\tcb: () => void,\r\n\t\tmappingOrEnable?: DDiagramCanvasTileMapping | boolean,\r\n\t\tlon0?: number,\r\n\t\tlat0?: number,\r\n\t\tlon1?: number,\r\n\t\tlat1?: number\r\n\t) {\r\n\t\tthis._cb = cb;\r\n\t\tif( mappingOrEnable === true || mappingOrEnable === false ) {\r\n\t\t\tthis._enable = mappingOrEnable;\r\n\t\t\tthis._from = new DDiagramCanvasTileMappingPointImpl( cb, null, lon0, lat0 );\r\n\t\t\tthis._to = new DDiagramCanvasTileMappingPointImpl( cb, null, lon1, lat1 );\r\n\t\t} else if( mappingOrEnable != null ) {\r\n\t\t\tthis._enable = mappingOrEnable.enable;\r\n\t\t\tthis._from = new DDiagramCanvasTileMappingPointImpl( cb, null, mappingOrEnable.from.lon, mappingOrEnable.from.lat );\r\n\t\t\tthis._to = new DDiagramCanvasTileMappingPointImpl( cb, null, mappingOrEnable.to.lon, mappingOrEnable.to.lat );\r\n\t\t} else {\r\n\t\t\tthis._enable = false;\r\n\t\t\tthis._from = new DDiagramCanvasTileMappingPointImpl( cb, null, -180, +85.05112877980659 );\r\n\t\t\tthis._to = new DDiagramCanvasTileMappingPointImpl( cb, null, +180, -85.05112877980659 );\r\n\t\t}\r\n\t}\r\n\r\n\tget enable(): boolean {\r\n\t\treturn this._enable;\r\n\t}\r\n\r\n\tset enable( enable: boolean ) {\r\n\t\tif( this._enable !== enable ) {\r\n\t\t\tthis._enable = enable;\r\n\t\t\tthis._cb();\r\n\t\t}\r\n\t}\r\n\r\n\tget from(): DMapTileMappingPoint {\r\n\t\treturn this._from;\r\n\t}\r\n\r\n\tget to(): DMapTileMappingPoint {\r\n\t\treturn this._to;\r\n\t}\r\n\r\n\tserialize(): DDiagramCanvasTileMapping {\r\n\t\treturn {\r\n\t\t\tenable: this._enable,\r\n\t\t\tfrom: this._from.toObject(),\r\n\t\t\tto: this._to.toObject()\r\n\t\t};\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramCanvasBase } from \"./d-diagram-canvas-base\";\r\nimport { DDiagramCanvasTileMapping } from \"./d-diagram-canvas-mapping\";\r\nimport { DDiagramCanvasTileMappingImpl } from \"./d-diagram-canvas-mapping-impl\";\r\nimport { DMapTilePyramid } from \"./d-map-tile-pyramid\";\r\n\r\n/**\r\n * A tile pyramid factory.\r\n */\r\nexport type DDiagramCanvasTilePyramidFactory = ( canvas: DDiagramCanvasBase<any, any> ) => DMapTilePyramid;\r\n\r\nexport interface DDiagramCanvasTileOptions {\r\n\tfactory?: DDiagramCanvasTilePyramidFactory;\r\n\tmapping?: DDiagramCanvasTileMapping;\r\n}\r\n\r\nexport class DDiagramCanvasTile {\r\n\tprotected _canvas: DDiagramCanvasBase<any, any>;\r\n\tprotected _pyramid?: DMapTilePyramid;\r\n\tprotected _factory?: DDiagramCanvasTilePyramidFactory;\r\n\tprotected _mapping: DDiagramCanvasTileMappingImpl;\r\n\r\n\tconstructor( canvas: DDiagramCanvasBase<any, any>, options?: DDiagramCanvasTileOptions ) {\r\n\t\tthis._canvas = canvas;\r\n\t\tthis._factory = options && options.factory;\r\n\t\tthis._mapping = new DDiagramCanvasTileMappingImpl((): void => {\r\n\t\t\tthis.onMappingChange();\r\n\t\t}, options && options.mapping );\r\n\t}\r\n\r\n\tinit(): void {\r\n\t\tthis.onMappingChange();\r\n\t}\r\n\r\n\tprotected onMappingChange(): void {\r\n\t\tconst factory = this._factory;\r\n\t\tif( factory ) {\r\n\t\t\tconst mapping = this._mapping;\r\n\t\t\tif( mapping.enable ) {\r\n\t\t\t\tconst pyramid = this._pyramid;\r\n\t\t\t\tif( pyramid ) {\r\n\t\t\t\t\tpyramid.mapping = mapping;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._pyramid = factory( this._canvas ).fit();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst pyramid = this._pyramid;\r\n\t\t\t\tif( pyramid ) {\r\n\t\t\t\t\tthis._pyramid = undefined;\r\n\t\t\t\t\tpyramid.destroy();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget pyramid(): DMapTilePyramid | undefined {\r\n\t\treturn this._pyramid;\r\n\t}\r\n\r\n\tget factory(): DDiagramCanvasTilePyramidFactory | undefined {\r\n\t\treturn this._factory;\r\n\t}\r\n\r\n\tget mapping(): DDiagramCanvasTileMapping {\r\n\t\treturn this._mapping;\r\n\t}\r\n\r\n\tserialize(): { mapping: DDiagramCanvasTileMapping } {\r\n\t\treturn {\r\n\t\t\tmapping: this._mapping.serialize()\r\n\t\t};\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst pyramid = this._pyramid;\r\n\t\tif( pyramid != null ) {\r\n\t\t\tthis._pyramid = undefined;\r\n\t\t\tpyramid.destroy();\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramSerializedItem, DDiagramSerializedLayer } from \"./d-diagram-serialized\";\r\nimport { EShapeContainer } from \"./shape/e-shape-container\";\r\nimport { EShapeResourceManagerSerialization } from \"./shape/e-shape-resource-manager-serialization\";\r\n\r\nexport class DDiagramLayer extends EShapeContainer {\r\n\treference: number;\r\n\r\n\tconstructor( name: string ) {\r\n\t\tsuper();\r\n\t\tthis.name = name;\r\n\t\tthis.interactive = false;\r\n\t\tthis.reference = 0;\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tif( ! this._destroyed ) {\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\t\tchildren[ i ].destroy();\r\n\t\t\t}\r\n\t\t\tchildren.length = 0;\r\n\t\t\tsuper.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tserialize(\r\n\t\tlayer: number, manager: EShapeResourceManagerSerialization, items: DDiagramSerializedItem[]\r\n\t): DDiagramSerializedLayer {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst shape = children[ i ];\r\n\t\t\tconst item = shape.serialize( manager );\r\n\t\t\titem[ 16 ] = layer;\r\n\t\t\titems.push( item );\r\n\t\t}\r\n\r\n\t\treturn [\r\n\t\t\tthis.name || \"\"\r\n\t\t];\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DDiagramLayer } from \"./d-diagram-layer\";\r\nimport { DDiagramSerializedItem, DDiagramSerializedLayer } from \"./d-diagram-serialized\";\r\nimport { EShapeResourceManagerSerialization } from \"./shape/e-shape-resource-manager-serialization\";\r\n\r\nexport class DDiagramLayerContainer extends Container {\r\n\tpublic children!: DDiagramLayer[];\r\n\tprotected _active: DDiagramLayer | null;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._active = null;\r\n\t\tthis.interactive = false;\r\n\t\tthis.interactiveChildren = false;\r\n\t}\r\n\r\n\tget active(): DDiagramLayer | null {\r\n\t\treturn this._active;\r\n\t}\r\n\r\n\tset active( layer: DDiagramLayer | null ) {\r\n\t\tif( this._active !== layer && (layer == null || 0 <= this.children.indexOf( layer )) ) {\r\n\t\t\tthis._active = layer;\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tcreate( name: string, activate?: boolean ): DDiagramLayer {\r\n\t\tconst result = new DDiagramLayer( name );\r\n\t\tthis.attach( result, activate );\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds the specified layer and activates it if the `activate` is true.\r\n\t *\r\n\t * @param layer\r\n\t * @param activate\r\n\t */\r\n\tattach( layer: DDiagramLayer, activate?: boolean ): void {\r\n\t\tthis.addChild( layer );\r\n\t\tif( activate === true ) {\r\n\t\t\tthis._active = layer;\r\n\t\t}\r\n\t\tthis.emit( \"change\", this );\r\n\t\tDApplications.update( this );\r\n\t}\r\n\r\n\tattachAt( layer: DDiagramLayer, index: number, activate?: boolean ): void {\r\n\t\tthis.addChildAt( layer, index );\r\n\t\tif( activate === true ) {\r\n\t\t\tthis._active = layer;\r\n\t\t}\r\n\t\tthis.emit( \"change\", this );\r\n\t\tDApplications.update( this );\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the specified layer from this container and activates the specified layer.\r\n\t * This method does not destroy the secified layer.\r\n\t *\r\n\t * @param layer\r\n\t */\r\n\tdetach( layer: DDiagramLayer, active: DDiagramLayer | null ): void {\r\n\t\tconst children = this.children;\r\n\t\tconst index = children.indexOf( layer );\r\n\t\tif( 0 <= index ) {\r\n\t\t\tthis._active = active;\r\n\r\n\t\t\tchildren.splice( index, 1 );\r\n\t\t\t(layer as any).parent = undefined;\r\n\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the specified layer and activate the next layer.\r\n\t * This method does not destroy the specified layer.\r\n\t *\r\n\t * @param layer\r\n\t * @param activateNext\r\n\t */\r\n\tdelete( layer: DDiagramLayer, activateNext?: boolean ): number {\r\n\t\tconst children = this.children;\r\n\t\tconst index = children.indexOf( layer );\r\n\t\tif( 0 <= index ) {\r\n\t\t\tchildren.splice( index, 1 );\r\n\t\t\t(layer as any).parent = undefined;\r\n\r\n\t\t\tif( this._active === layer ) {\r\n\t\t\t\tif( activateNext === true ) {\r\n\t\t\t\t\tif( index < children.length ) {\r\n\t\t\t\t\t\tthis._active = children[ index ];\r\n\t\t\t\t\t} else if( 0 < children.length ) {\r\n\t\t\t\t\t\tthis._active = children[ index - 1 ];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._active = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._active = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t\treturn index;\r\n\t}\r\n\r\n\tget( index: number ): DDiagramLayer | null {\r\n\t\tconst child = this.children[ index ];\r\n\t\tif( child != null ) {\r\n\t\t\treturn child;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tconst children = this.children;\r\n\t\tif( 0 < children.length ) {\r\n\t\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\t(child as any).parent = null;\r\n\t\t\t\tchild.destroy();\r\n\t\t\t}\r\n\t\t\tchildren.length = 0;\r\n\r\n\t\t\tthis.emit( \"change\", this );\r\n\t\t\tDApplications.update( this );\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tif( ! this._destroyed ) {\r\n\t\t\tthis.clear();\r\n\t\t\tsuper.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this.children.length;\r\n\t}\r\n\r\n\tserialize(\r\n\t\tmanager: EShapeResourceManagerSerialization, items: DDiagramSerializedItem[]\r\n\t): DDiagramSerializedLayer[] {\r\n\t\tconst result: DDiagramSerializedLayer[] = [];\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tresult.push( child.serialize( i, manager, items ) );\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { IPoint } from \"pixi.js\";\r\nimport { DCanvas, DCanvasOptions, DThemeCanvas } from \"./d-canvas\";\r\nimport { DDiagramCanvasTile, DDiagramCanvasTileOptions } from \"./d-diagram-canvas-tile\";\r\nimport { DDiagramLayerContainer } from \"./d-diagram-layer-container\";\r\nimport { EShape } from \"./shape/e-shape\";\r\n\r\nexport interface DDiagramCanvasBaseOptions<\r\n\tTHEME extends DThemeDiagramCanvasBase = DThemeDiagramCanvasBase\r\n> extends DCanvasOptions<THEME> {\r\n\ttile?: DDiagramCanvasTileOptions;\r\n}\r\n\r\nexport interface DThemeDiagramCanvasBase extends DThemeCanvas {\r\n\r\n}\r\n\r\nexport class DDiagramCanvasBase<\r\n\tTHEME extends DThemeDiagramCanvasBase = DThemeDiagramCanvasBase,\r\n\tOPTIONS extends DDiagramCanvasBaseOptions<THEME> = DDiagramCanvasBaseOptions<THEME>\r\n> extends DCanvas<THEME, OPTIONS> {\r\n\tprotected _layer: DDiagramLayerContainer;\r\n\tprotected _tile: DDiagramCanvasTile;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\r\n\t\tconst layer = new DDiagramLayerContainer();\r\n\t\tthis._layer = layer;\r\n\t\tthis.addChild( layer );\r\n\r\n\t\tconst tile = this._tile = new DDiagramCanvasTile( this, options && options.tile );\r\n\t\ttile.init();\r\n\t}\r\n\r\n\tget tile(): DDiagramCanvasTile {\r\n\t\treturn this._tile;\r\n\t}\r\n\r\n\tget layer(): DDiagramLayerContainer {\r\n\t\treturn this._layer;\r\n\t}\r\n\r\n\tinitialize( shapes: EShape[] ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tif( ! this._destroyed ) {\r\n\t\t\tthis._tile.destroy();\r\n\t\t\tthis._layer.destroy();\r\n\t\t\tsuper.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\thitTest( global: IPoint, handler?: ( shape: EShape ) => boolean ): EShape | null {\r\n\t\tconst layers = this._layer.children;\r\n\t\tfor( let i = layers.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst layer = layers[ i ];\r\n\t\t\tconst shape = layer.hitTest( global, handler );\r\n\t\t\tif( shape != null ) {\r\n\t\t\t\treturn shape;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDiagramCanvasBase\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBackgroundStateAware } from \"./d-background\";\r\nimport { DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { UtilRgb } from \"./util/util-rgb\";\r\n\r\nexport class DDiagramCanvasEditorBackground implements DBackgroundStateAware {\r\n\tprotected _target: DBackgroundStateAware;\r\n\tprotected _base: number | null;\r\n\r\n\tconstructor( target: DBackgroundStateAware, base: number | null ) {\r\n\t\tthis._target = target;\r\n\t\tthis._base = base;\r\n\t}\r\n\r\n\tgetTheme(): DThemeBase {\r\n\t\treturn this._target.getTheme();\r\n\t}\r\n\r\n\tsetTheme( theme: DThemeBase ): void {\r\n\t\tthis._target.setTheme( theme );\r\n\t}\r\n\r\n\tgetBaseColor(): number | null {\r\n\t\treturn this._base;\r\n\t}\r\n\r\n\tsetBaseColor( baseColor: number | null ): void {\r\n\t\tthis._base = baseColor;\r\n\t}\r\n\r\n\tgetColor( state: DBaseState ): number | null {\r\n\t\tconst target = this._target;\r\n\t\tconst base = this._base;\r\n\t\tconst color = target.getColor( state );\r\n\t\tif( base != null ) {\r\n\t\t\tif( color != null ) {\r\n\t\t\t\treturn UtilRgb.blend( base, color, target.getAlpha( state ) );\r\n\t\t\t}\r\n\t\t\treturn base;\r\n\t\t}\r\n\t\treturn color;\r\n\t}\r\n\r\n\tget color(): DStateAwareOrValueMightBe<number | null> {\r\n\t\treturn this._target.color;\r\n\t}\r\n\r\n\tset color( color: DStateAwareOrValueMightBe<number | null> ) {\r\n\t\tthis._target.color = color;\r\n\t}\r\n\r\n\tgetAlpha( state: DBaseState ): number {\r\n\t\tconst base = this._base;\r\n\t\tif( base != null ) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\treturn this._target.getAlpha( state );\r\n\t}\r\n\r\n\tget alpha(): DStateAwareOrValueMightBe<number> {\r\n\t\treturn this._target.alpha;\r\n\t}\r\n\r\n\tset alpha( alpha: DStateAwareOrValueMightBe<number> ) {\r\n\t\tthis._target.alpha = alpha;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Graphics } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBaseBackgroundOptions } from \"./d-base\";\r\nimport { DDiagramCanvasBase, DDiagramCanvasBaseOptions, DThemeDiagramCanvasBase } from \"./d-diagram-canvas-base\";\r\nimport { DDiagramCanvasEditorBackground } from \"./d-diagram-canvas-editor-background\";\r\nimport { DDiagramSerialized, DDiagramSerializedItem, DDiagramSerializedVersion } from \"./d-diagram-serialized\";\r\nimport { EShapeResourceManagerSerialization } from \"./shape/e-shape-resource-manager-serialization\";\r\nimport { ESnapper } from \"./snapper/e-snapper\";\r\nimport { ESnapperTargetValueType } from \"./snapper/e-snapper-target-value\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\nexport interface DDiagramCanvasEditorBackgroundOptions extends DBaseBackgroundOptions {\r\n\tbase?: number | null;\r\n}\r\n\r\nexport interface DDiagramCanvasEditorOptions<\r\n\tTHEME extends DThemeDiagramCanvasEditor = DThemeDiagramCanvasEditor\r\n> extends DDiagramCanvasBaseOptions<THEME> {\r\n\tsnapper: ESnapper;\r\n\tbackground?: DDiagramCanvasEditorBackgroundOptions;\r\n}\r\n\r\nexport interface DThemeDiagramCanvasEditor extends DThemeDiagramCanvasBase {\r\n\tgetBackgroundBase(): number | null;\r\n}\r\n\r\nexport class DDiagramCanvasEditor<\r\n\tTHEME extends DThemeDiagramCanvasEditor = DThemeDiagramCanvasEditor,\r\n\tOPTIONS extends DDiagramCanvasEditorOptions<THEME> = DDiagramCanvasEditorOptions<THEME>\r\n> extends DDiagramCanvasBase<THEME, OPTIONS> {\r\n\tprotected _snapper: ESnapper;\r\n\tprotected _snapperGraphics: Graphics;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\r\n\t\tthis._background = new DDiagramCanvasEditorBackground(\r\n\t\t\tthis._background,\r\n\t\t\tthis.toBackgroundColorBase( this.theme, options )\r\n\t\t);\r\n\r\n\t\tthis.shadow = this.theme.newShadowWeak();\r\n\r\n\t\tconst snapperGraphics = new Graphics();\r\n\t\tsnapperGraphics.visible = false;\r\n\t\tthis.addChildAt( snapperGraphics, this.children.length - 1 );\r\n\t\tthis._snapperGraphics = snapperGraphics;\r\n\r\n\t\tconst snapper = options.snapper;\r\n\t\tsnapper.target.on( \"change\", (): void => {\r\n\t\t\tthis.toDirty();\r\n\t\t\tDApplications.update( this );\r\n\t\t});\r\n\t\tthis._snapper = snapper;\r\n\t}\r\n\r\n\tprotected toBackgroundColorBase( theme: THEME, options: OPTIONS ): number | null {\r\n\t\tconst background = options.background;\r\n\t\tconst backgroundBase = background && background.base;\r\n\t\treturn ( backgroundBase != null ? backgroundBase : theme.getBackgroundBase() );\r\n\t}\r\n\r\n\tserialize( id: number | undefined ): DDiagramSerialized {\r\n\t\tconst manager = new EShapeResourceManagerSerialization();\r\n\t\tconst items: DDiagramSerializedItem[] = [];\r\n\t\tconst background = this._background;\r\n\t\tconst backgroundColor = background.color;\r\n\t\tconst backgroundAlpha = background.alpha;\r\n\t\treturn {\r\n\t\t\tversion: DDiagramSerializedVersion,\r\n\t\t\tid,\r\n\t\t\tname: this.name,\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\tbackground: {\r\n\t\t\t\tcolor: isNumber( backgroundColor ) ? backgroundColor : 0xffffff,\r\n\t\t\t\talpha: isNumber( backgroundAlpha ) ? backgroundAlpha : 0\r\n\t\t\t},\r\n\t\t\ttile: this._tile.serialize(),\r\n\t\t\tresources: manager.serialize(),\r\n\t\t\tlayers: this._layer.serialize( manager, items ),\r\n\t\t\titems,\r\n\t\t\tsnap: this._snapper.serialize()\r\n\t\t};\r\n\t}\r\n\r\n\tonReflow(): void {\r\n\t\tsuper.onReflow();\r\n\r\n\t\tconst snapperGraphics = this._snapperGraphics;\r\n\t\tconst target = this._snapper.target;\r\n\t\tif( target.visible ) {\r\n\t\t\tconst borderColor = 0x1e87f0;\r\n\t\t\tconst borderWidth = 1;\r\n\t\t\tconst borderAlpha = 0.5;\r\n\t\t\tconst width = this.width + 0.5;\r\n\t\t\tconst height = this.height + 0.5;\r\n\t\t\tconst values = target.values;\r\n\t\t\tsnapperGraphics.clear();\r\n\t\t\tsnapperGraphics.lineStyle( 0, 0, 0, 0 );\r\n\t\t\tsnapperGraphics.beginFill( borderColor, borderAlpha );\r\n\t\t\tfor( let i = 0, imax = values.length; i < imax; ++i ) {\r\n\t\t\t\tconst value = values[ i ];\r\n\t\t\t\tif( value.type === ESnapperTargetValueType.VERTICAL ) {\r\n\t\t\t\t\tsnapperGraphics.drawRect( value.position, 0, borderWidth, height );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsnapperGraphics.drawRect( 0, value.position, width, borderWidth );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsnapperGraphics.endFill();\r\n\t\t\tsnapperGraphics.visible = true;\r\n\t\t} else {\r\n\t\t\tsnapperGraphics.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDiagramCanvasEditor\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramCanvasTileMapping } from \"./d-diagram-canvas-mapping\";\r\nimport { EShapeCorner } from \"./shape/e-shape-corner\";\r\nimport { EShapeStrokeSide } from \"./shape/e-shape-stroke-side\";\r\nimport { EShapeTagValueOrder } from \"./shape/e-shape-tag-value\";\r\nimport { EShapeTextStyle, EShapeTextWeight } from \"./shape/e-shape-text\";\r\nimport { EShapeTextAlignHorizontal } from \"./shape/e-shape-text-align-horizontal\";\r\nimport { EShapeTextAlignVertical } from \"./shape/e-shape-text-align-vertical\";\r\nimport { EShapeTextDirection } from \"./shape/e-shape-text-direction\";\r\nimport { EShapeType } from \"./shape/e-shape-type\";\r\n\r\nexport const DDiagramSerializedVersion: number = 1;\r\n\r\n/**\r\n * A serialized tag range.\r\n */\r\nexport interface DDiagramSerializedTagRange {\r\n\t/** A type. */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A lower bound. */\r\n\t[ 1 ]: number;\r\n\r\n\t/** An upper bound. */\r\n\t[ 2 ]: number;\r\n}\r\n\r\n/**\r\n * A serialized tag value.\r\n */\r\nexport interface DDiagramSerializedTagValue {\r\n\t/**\r\n\t * A resource index number of an ID.\r\n\t * Stored at DDiagramSerialized#resources.\r\n\t */\r\n\t[ 0 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of an initial value expression.\r\n\t * Stored at DDiagramSerialized#resources.\r\n\t */\r\n\t[ 1 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of a format expression.\r\n\t * Stored at DDiagramSerialized#resources.\r\n\t */\r\n\t[ 2 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of a serialized range, JSON.stringify(DDiagramSerializedTagRange).\r\n\t * Stored at DDiagramSerialized#resources.\r\n\t */\r\n\t[ 3 ]: number;\r\n\r\n\t/**\r\n\t * A capacity.\r\n\t */\r\n\t[ 4 ]: number;\r\n\r\n\t/**\r\n\t * A order.\r\n\t */\r\n\t[ 5 ]: EShapeTagValueOrder;\r\n}\r\n\r\n/**\r\n * A serialized fill.\r\n */\r\nexport interface DDiagramSerializedFill {\r\n\t/** 0: Enabled, 1: Disabled */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A color. */\r\n\t[ 1 ]: number;\r\n\r\n\t/** An alpha. */\r\n\t[ 2 ]: number;\r\n}\r\n\r\n/**\r\n * A serialized stroke.\r\n */\r\nexport interface DDiagramSerializedStroke {\r\n\t/** 0: Enabled, 1: Disabled */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A color. */\r\n\t[ 1 ]: number;\r\n\r\n\t/** An alpha. */\r\n\t[ 2 ]: number;\r\n\r\n\t/** A width. */\r\n\t[ 3 ]: number;\r\n\r\n\t/** An align. */\r\n\t[ 4 ]: number;\r\n\r\n\t/** A side. */\r\n\t[ 5 ]: EShapeStrokeSide;\r\n}\r\n\r\n/**\r\n * A serialized text outline.\r\n */\r\nexport interface DDiagramSerializedTextOutline {\r\n\t/** 0: Enabled, 1: Diabled */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A color. */\r\n\t[ 1 ]: number;\r\n\r\n\t/** An alpha. */\r\n\t[ 2 ]: number;\r\n\r\n\t/** A width. */\r\n\t[ 3 ]: number;\r\n}\r\n\r\n/**\r\n * A serialized text align.\r\n */\r\nexport interface DDiagramSerializedTextAlign {\r\n\t/** A horizontal align. */\r\n\t[ 0 ]: EShapeTextAlignHorizontal;\r\n\r\n\t/** A vertical align. */\r\n\t[ 1 ]: EShapeTextAlignVertical;\r\n}\r\n\r\n/**\r\n * A serialized text offset.\r\n */\r\nexport interface DDiagramSerializedTextOffset {\r\n\t/** A horizontal offset. */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A vertical offset. */\r\n\t[ 1 ]: number;\r\n}\r\n\r\n/**\r\n * A serialized text spacing.\r\n */\r\nexport interface DDiagramSerializedTextSpacing {\r\n\t/** A horizontal spacing. */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A vertical spacing. */\r\n\t[ 1 ]: number;\r\n}\r\n\r\n/**\r\n * A serialized text padding.\r\n */\r\nexport interface DDiagramSerializedTextPadding {\r\n\t/** A horizontal padding. */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A vertical padding. */\r\n\t[ 1 ]: number;\r\n}\r\n\r\n/**\r\n * A serialized text.\r\n */\r\nexport interface DDiagramSerializedText {\r\n\t/** A resource index number of a value. */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A color. */\r\n\t[ 1 ]: number;\r\n\r\n\t/** An alpha. */\r\n\t[ 2 ]: number;\r\n\r\n\t/** A resource index number of a font family. */\r\n\t[ 3 ]: number;\r\n\r\n\t/** A size. */\r\n\t[ 4 ]: number;\r\n\r\n\t/** A weight. */\r\n\t[ 5 ]: EShapeTextWeight;\r\n\r\n\t/**\r\n\t * A resource index number of a stringified serialized align,\r\n\t * JSON.stringify(DDiagramSerializedTextAlign).\r\n\t */\r\n\t[ 6 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of a stringified serialized offset,\r\n\t * JSON.stringify(DDiagramSerializedTextOffset).\r\n\t */\r\n\t[ 7 ]: number;\r\n\r\n\t/** A style. */\r\n\t[ 8 ]: EShapeTextStyle;\r\n\r\n\t/**\r\n\t * A resource index number of a stringified serialized outline,\r\n\t * JSON.stringify(DDiagramSerializedTextOutline).\r\n\t */\r\n\t[ 9 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of a stringified serialized spacing,\r\n\t * JSON.stringify(DDiagramSerializedTextSpacing).\r\n\t */\r\n\t[ 10 ]: number;\r\n\r\n\t/** A direction. */\r\n\t[ 11 ]: EShapeTextDirection;\r\n\r\n\t/**\r\n\t * A resource index number of a stringified serialized padding,\r\n\t * JSON.stringify(DDiagramSerializedTextPadding).\r\n\t */\r\n\t[ 12 ]: number;\r\n\r\n\t/** A clipping. (0: Off, 1: On) */\r\n\t[ 13 ]: number;\r\n}\r\n\r\n/**\r\n * A serialized item.\r\n */\r\nexport interface DDiagramSerializedItem {\r\n\t/** A type. */\r\n\t[ 0 ]: EShapeType;\r\n\r\n\t/** A resource index number of a ID. */\r\n\t[ 1 ]: number;\r\n\r\n\t/** A X-coordinate position. */\r\n\t[ 2 ]: number;\r\n\r\n\t/** A Y-coordinate position. */\r\n\t[ 3 ]: number;\r\n\r\n\t/** A width. */\r\n\t[ 4 ]: number;\r\n\r\n\t/** A height. */\r\n\t[ 5 ]: number;\r\n\r\n\t/** A rotation. */\r\n\t[ 6 ]: number;\r\n\r\n\t/** A skew. */\r\n\t[ 7 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of a stringified serialized fill,\r\n\t * JSON.stringify(DDiagramSerializedFill).\r\n\t */\r\n\t[ 8 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of a stringified serialized stroke,\r\n\t * JSON.stringify(DDiagramSerializedStroke).\r\n\t */\r\n\t[ 9 ]: number;\r\n\r\n\t/** A resource index number of a cursor. */\r\n\t[ 10 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of a stringified serialized text,\r\n\t * JSON.stringify(DDiagramSerializedText).\r\n\t */\r\n\t[ 11 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of stringified serialized tags,\r\n\t * JSON.stringify(DDiagramSerializedTagValue[]).\r\n\t */\r\n\t[ 12 ]: number;\r\n\r\n\t/** A radius. */\r\n\t[ 13 ]: number;\r\n\r\n\t/** A corner. */\r\n\t[ 14 ]: EShapeCorner;\r\n\r\n\t/** A resource index number of a shape-specific resource. */\r\n\t[ 15 ]: number;\r\n\r\n\t/** A layer index number. */\r\n\t[ 16 ]: number;\r\n\r\n\t/** Actions */\r\n\t[ 17 ]: number[];\r\n\r\n\t/** A resource index number of an image. */\r\n\t[ 18 ]: number;\r\n\r\n\t/**\r\n\t * A resource index number of a stringified serialized gradient.\r\n\t * A stringified serialized gradient is a stringified number array,\r\n\t * JSON.stringify(number[]).\r\n\t *\r\n\t * * The first number in the array is a direction in degree.\r\n\t * * The number at an index number 1 + 3 * n + 0 is a color of a n-th point.\r\n\t * * The number at an index number 1 + 3 * n + 1 is a alpha of a n-th point.\r\n\t * * The number at an index number 1 + 3 * n + 2 is a position of a n-th point whose range is [0, 1].\r\n\t */\r\n\t[ 19 ]: number;\r\n\r\n\t/** A children. */\r\n\t[ 20 ]: DDiagramSerializedItem[];\r\n\r\n\t/** A X pivot. */\r\n\t[ 21 ]: number;\r\n\r\n\t/** A Y pivot. */\r\n\t[ 22 ]: number;\r\n\r\n\t/** (interactive ? 1 : 0) | (unfocusable ? 2 : 0) */\r\n\t[ 23 ]: number;\r\n\r\n\t/** A resource index number of a shortcut. */\r\n\t[ 24 ]: number;\r\n\r\n\t/** A resource index number of a title. */\r\n\t[ 25 ]: number;\r\n}\r\n\r\n/**\r\n * A serialized layer.\r\n */\r\nexport interface DDiagramSerializedLayer {\r\n\t/** A name. */\r\n\t[ 0 ]: string;\r\n}\r\n\r\n/**\r\n * A serialized snap target.\r\n */\r\nexport interface DDiagramSerializedSnapTargetValue {\r\n\t/** A type (0: Horizontal, 1: Vertical). */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A position. */\r\n\t[ 1 ]: number;\r\n}\r\n\r\n/**\r\n * Serialized snap on guide settings.\r\n */\r\nexport interface DDiagramSerializedSnapTarget {\r\n\t/** Snap on guide (0: Off, 1: On) */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A visibility (0: Invisible, 1: Visible). */\r\n\t[ 1 ]: number;\r\n\r\n\t/** Snap targets. */\r\n\t[ 2 ]: DDiagramSerializedSnapTargetValue[];\r\n}\r\n\r\n/**\r\n * Serialized grid snap settings.\r\n */\r\nexport interface DDiagramSerializedSnapGrid {\r\n\t/** Snap on grid (0: Off, 1: On) */\r\n\t[ 0 ]: number;\r\n\r\n\t/** A grid size. */\r\n\t[ 1 ]: number;\r\n}\r\n\r\n/**\r\n * Serialized snap settings.\r\n */\r\nexport interface DDiagramSerializedSnap {\r\n\t/** Snap (0: Off, 1: On). */\r\n\t[ 0 ]: number;\r\n\r\n\t/** Snap on targets */\r\n\t[ 1 ]: DDiagramSerializedSnapTarget;\r\n\r\n\t/** Snap on grid */\r\n\t[ 2 ]: DDiagramSerializedSnapGrid;\r\n}\r\n\r\n/**\r\n * Serialized background settings.\r\n */\r\nexport interface DDiagramSerializedBackground {\r\n\tcolor?: number | null;\r\n\talpha?: number;\r\n}\r\n\r\n/**\r\n * Serialized tile settings.\r\n */\r\nexport interface DDiagramSerializedTile {\r\n\tmapping?: DDiagramCanvasTileMapping;\r\n}\r\n\r\n/**\r\n * A serialized diagram.\r\n */\r\nexport interface DDiagramSerialized {\r\n\tversion: number;\r\n\tid?: number;\r\n\tname: string;\r\n\twidth: number;\r\n\theight: number;\r\n\tbackground?: DDiagramSerializedBackground;\r\n\ttile?: DDiagramSerializedTile;\r\n\tresources: string[];\r\n\tlayers: DDiagramSerializedLayer[];\r\n\titems: DDiagramSerializedItem[];\r\n\tsnap?: DDiagramSerializedSnap;\r\n}\r\n\r\n/**\r\n * A simplified version of a serialized diagram.\r\n */\r\nexport interface DDiagramSerializedSimple {\r\n\tversion: number;\r\n\tid: number | undefined;\r\n\tname: string;\r\n\r\n\t/**\r\n\t * A stringified DDiagramSerialized,\r\n\t * JSON.stringiify(DDiagramSerialized).\r\n\t */\r\n\tdata: string;\r\n}\r\n\r\nexport interface DDiagramSerializedName {\r\n\tid: number;\r\n\tname: string;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DDiagramCanvasBase, DDiagramCanvasBaseOptions, DThemeDiagramCanvasBase } from \"./d-diagram-canvas-base\";\r\nimport { DDiagramCanvasIdMap } from \"./d-diagram-canvas-id-map\";\r\nimport { DDiagramCanvasTagMap } from \"./d-diagram-canvas-tag-map\";\r\nimport { EShape } from \"./shape/e-shape\";\r\nimport { EShapeBase } from \"./shape/variant/e-shape-base\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\n/**\r\n * A tag mapper.\r\n *\r\n * @param tag a tag\r\n * @returns a mapped tag\r\n */\r\nexport type DDiagramCanvasTagMapper = ( tag: string ) => string | null;\r\n\r\nexport interface DDiagramCanvasTagOptions {\r\n\t/**\r\n\t * A tag mapper.\r\n\t */\r\n\tmapper?: DDiagramCanvasTagMapper;\r\n}\r\n\r\nexport interface DDiagramCanvasOptions<\r\n\tTHEME extends DThemeDiagramCanvas = DThemeDiagramCanvas\r\n> extends DDiagramCanvasBaseOptions<THEME> {\r\n\t/**\r\n\t * A tag options.\r\n\t */\r\n\ttag?: DDiagramCanvasTagOptions;\r\n}\r\n\r\nexport interface DThemeDiagramCanvas extends DThemeDiagramCanvasBase {\r\n\r\n}\r\n\r\nconst defaultTagMapper = ( tag: string ) => tag;\r\n\r\nexport class DDiagramCanvas<\r\n\tTHEME extends DThemeDiagramCanvas = DThemeDiagramCanvas,\r\n\tOPTIONS extends DDiagramCanvasOptions<THEME> = DDiagramCanvasOptions<THEME>\r\n> extends DDiagramCanvasBase<THEME, OPTIONS> {\r\n\ttags: DDiagramCanvasTagMap;\r\n\ttagMapper: DDiagramCanvasTagMapper;\r\n\tinteractives: EShape[];\r\n\tactionables: EShape[];\r\n\tids: DDiagramCanvasIdMap;\r\n\r\n\tprotected _workLocal: Point;\r\n\tprotected _workGlobal: Point;\r\n\tprotected _lastOverShape: EShape | null;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis.tags = {};\r\n\t\tthis.tagMapper = (options.tag && options.tag.mapper) || defaultTagMapper;\r\n\t\tthis.interactives = [];\r\n\t\tthis.actionables = [];\r\n\t\tthis.ids = {};\r\n\t\tthis._workLocal = new Point();\r\n\t\tthis._workGlobal = new Point();\r\n\t\tthis._lastOverShape = null;\r\n\t}\r\n\r\n\tinitialize(): void {\r\n\t\tconst time = Date.now();\r\n\t\tconst tags = this.tags;\r\n\t\tconst tagMapper = this.tagMapper;\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst actionables = this.actionables;\r\n\t\tconst ids = this.ids;\r\n\t\tconst layers = this._layer.children;\r\n\r\n\t\tfor( let i = 0, imax = layers.length; i < imax; ++i ) {\r\n\t\t\tthis.initializeShapes( layers[ i ].children, tags, tagMapper, interactives, actionables, ids );\r\n\t\t}\r\n\r\n\t\tfor( let i = 0, imax = layers.length; i < imax; ++i ) {\r\n\t\t\tthis.updateShapes( layers[ i ].children, time );\r\n\t\t}\r\n\r\n\t\tthis.initializeFocus();\r\n\t}\r\n\r\n\tprotected initializeFocus(): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\tconst focusable = focusController.findFocusable( this, false, true, true );\r\n\t\t\tif( focusable ) {\r\n\t\t\t\tfocusController.setFocused( focusable, true, true );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected initializeShapes(\r\n\t\tshapes: EShape[], tags: DDiagramCanvasTagMap, tagMapper: DDiagramCanvasTagMapper,\r\n\t\tinteractives: EShape[], actionables: EShape[],\r\n\t\tids: DDiagramCanvasIdMap\r\n\t): void {\r\n\t\tfor( let i = 0, imax = shapes.length; i < imax; ++i ) {\r\n\t\t\tconst shape = shapes[ i ];\r\n\r\n\t\t\t// Tag mappings\r\n\t\t\tconst tag = shape.tag;\r\n\t\t\tfor( let j = 0, jmax = tag.size(); j < jmax; ++j ) {\r\n\t\t\t\tconst value = tag.get( j );\r\n\t\t\t\tif( value ) {\r\n\t\t\t\t\tconst valueId = value.id;\r\n\t\t\t\t\tif( 0 < valueId.length ) {\r\n\t\t\t\t\t\tconst mappedValueId = tagMapper( valueId );\r\n\t\t\t\t\t\tif( mappedValueId != null ) {\r\n\t\t\t\t\t\t\tlet values = tags[ mappedValueId ];\r\n\t\t\t\t\t\t\tif( values == null ) {\r\n\t\t\t\t\t\t\t\tvalues = [];\r\n\t\t\t\t\t\t\t\ttags[ mappedValueId ] = values;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvalues.push( value );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Id mappings\r\n\t\t\tconst shapeId = shape.id;\r\n\t\t\tif( 0 < shapeId.length ) {\r\n\t\t\t\tconst mapping: EShape[] | undefined = ids[ shapeId ];\r\n\t\t\t\tif( mapping == null ) {\r\n\t\t\t\t\tids[ shapeId ] = [ shape ];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmapping.push( shape );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Interactives\r\n\t\t\tconst runtime = shape.runtime;\r\n\t\t\tif( shape.interactive || (0 < shape.cursor.length) || (runtime && runtime.interactive) ) {\r\n\t\t\t\tinteractives.push( shape );\r\n\t\t\t}\r\n\r\n\t\t\t// Actionables\r\n\t\t\tif( runtime && 0 < runtime.actions.length ) {\r\n\t\t\t\tactionables.push( shape );\r\n\t\t\t}\r\n\r\n\t\t\t// Shortcuts\r\n\t\t\tconst shortcut = shape.shortcut;\r\n\t\t\tif( shortcut != null ) {\r\n\t\t\t\tUtilKeyboardEvent.on( this, shortcut, ( e: KeyboardEvent ): void => {\r\n\t\t\t\t\tshape.onShortcut( e );\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Children\r\n\t\t\tconst children = shape.children;\r\n\t\t\tif( 0 < children.length ) {\r\n\t\t\t\tthis.initializeShapes( children, tags, tagMapper, interactives, actionables, ids );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateShapes( shapes: EShape[], time: number ): void {\r\n\t\tfor( let i = 0, imax = shapes.length; i < imax; ++i ) {\r\n\t\t\tshapes[ i ].update( time );\r\n\t\t}\r\n\t}\r\n\r\n\tonShapeMove( e: interaction.InteractionEvent ): boolean {\r\n\t\tconst global = e.data.global;\r\n\t\tconst local = this._workLocal;\r\n\t\tconst interactives = this.interactives;\r\n\t\tlet found: EShape | null = null;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tfound = interactive;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( found ) {\r\n\t\t\tif( 0 < found.cursor.length ) {\r\n\t\t\t\tif( layer && layer.view.style.cursor !== found.cursor ) {\r\n\t\t\t\t\tlayer.view.style.cursor = found.cursor;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst lastOverShape = this._lastOverShape;\r\n\t\t\tif( found === lastOverShape ) {\r\n\t\t\t\tconst runtime = lastOverShape.runtime;\r\n\t\t\t\tif( runtime ) {\r\n\t\t\t\t\truntime.onPointerMove( lastOverShape, e );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._lastOverShape = found;\r\n\r\n\t\t\t\t// Previous\r\n\t\t\t\tif( lastOverShape ) {\r\n\t\t\t\t\tconst previousRuntime = lastOverShape.runtime;\r\n\t\t\t\t\tif( previousRuntime ) {\r\n\t\t\t\t\t\tpreviousRuntime.onPointerOut( lastOverShape, e );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Parents\r\n\t\t\t\t\tlet lastOverParent = lastOverShape.parent;\r\n\t\t\t\t\twhile( (lastOverParent instanceof EShapeBase) && lastOverParent !== found ) {\r\n\t\t\t\t\t\tconst parentRuntime = lastOverShape.runtime;\r\n\t\t\t\t\t\tif( parentRuntime ) {\r\n\t\t\t\t\t\t\tparentRuntime.onPointerOut( lastOverParent, e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlastOverParent = lastOverParent.parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Next\r\n\t\t\t\tconst runtime = found.runtime;\r\n\t\t\t\tif( runtime ) {\r\n\t\t\t\t\truntime.onPointerOver( found, e );\r\n\t\t\t\t}\r\n\t\t\t\tif( layer ) {\r\n\t\t\t\t\tlayer.view.title = ( found.title || \"\" );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Parents\r\n\t\t\t\tlet parent = found.parent;\r\n\t\t\t\twhile( parent instanceof EShapeBase ) {\r\n\t\t\t\t\tconst parentRuntime = parent.runtime;\r\n\t\t\t\t\tif( parentRuntime ) {\r\n\t\t\t\t\t\tparentRuntime.onPointerOver( parent, e );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparent = parent.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\tif( layer && layer.view.style.cursor !== \"auto\" ) {\r\n\t\t\t\tlayer.view.style.cursor = \"auto\";\r\n\t\t\t}\r\n\r\n\t\t\t// Previous\r\n\t\t\tconst lastOverShape = this._lastOverShape;\r\n\t\t\tthis._lastOverShape = null;\r\n\t\t\tif( lastOverShape ) {\r\n\t\t\t\tconst runtime = lastOverShape.runtime;\r\n\t\t\t\tif( runtime ) {\r\n\t\t\t\t\truntime.onPointerOut( lastOverShape, e );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Parents\r\n\t\t\t\tlet lastOverParent = lastOverShape.parent;\r\n\t\t\t\twhile( lastOverParent instanceof EShapeBase ) {\r\n\t\t\t\t\tconst parentRuntime = lastOverParent.runtime;\r\n\t\t\t\t\tif( parentRuntime ) {\r\n\t\t\t\t\t\tparentRuntime.onPointerOut( lastOverParent, e );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlastOverParent = lastOverParent.parent;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.view.title = \"\";\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tonShapeDown( e: interaction.InteractionEvent ): boolean {\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst global = e.data.global;\r\n\t\tconst local = this._workLocal;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tconst runtime = interactive.runtime;\r\n\t\t\t\t\tif( runtime ) {\r\n\t\t\t\t\t\truntime.onPointerDown( interactive, e );\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonShapeUp( e: interaction.InteractionEvent ): boolean {\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst global = e.data.global;\r\n\t\tconst local = this._workLocal;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tconst runtime = interactive.runtime;\r\n\t\t\t\t\tif( runtime ) {\r\n\t\t\t\t\t\truntime.onPointerUp( interactive, e );\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonShapeClick( e: interaction.InteractionEvent ): boolean {\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst global = e.data.global;\r\n\t\tconst local = this._workLocal;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tlet target: EShape = interactive;\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\tconst runtime = target.runtime;\r\n\t\t\t\t\t\tif( runtime ) {\r\n\t\t\t\t\t\t\truntime.onPointerClick( target, e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst parent = target.parent;\r\n\t\t\t\t\t\tif( parent instanceof EShapeBase ) {\r\n\t\t\t\t\t\t\ttarget = parent;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tonShapeDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean {\r\n\t\tconst interactives = this.interactives;\r\n\t\tconst global = UtilPointerEvent.toGlobal( e, interactionManager, this._workGlobal );\r\n\t\tconst local = this._workLocal;\r\n\t\tfor( let i = interactives.length - 1; 0 <= i; --i ) {\r\n\t\t\tconst interactive = interactives[ i ];\r\n\t\t\tif( interactive.visible ) {\r\n\t\t\t\tinteractive.toLocal( global, undefined, local );\r\n\t\t\t\tif( interactive.contains( local ) ) {\r\n\t\t\t\t\tlet target: EShape = interactive;\r\n\t\t\t\t\twhile( true ) {\r\n\t\t\t\t\t\tconst runtime = target.runtime;\r\n\t\t\t\t\t\tif( runtime ) {\r\n\t\t\t\t\t\t\truntime.onPointerDblClick( target, e );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst parent = target.parent;\r\n\t\t\t\t\t\tif( parent instanceof EShapeBase ) {\r\n\t\t\t\t\t\t\ttarget = parent;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDiagramCanvas\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"./d-base\";\r\nimport { DDiagramLayerContainer } from \"./d-diagram-layer-container\";\r\nimport { DDiagramSerialized, DDiagramSerializedSimple } from \"./d-diagram-serialized\";\r\nimport { EShape } from \"./shape/e-shape\";\r\nimport { EShapeDefaults } from \"./shape/e-shape-defaults\";\r\nimport { EShapeDeserializer } from \"./shape/e-shape-deserializer\";\r\n\r\nexport class DDiagrams {\r\n\tstatic toSerialized( target: DDiagramSerializedSimple | DDiagramSerialized ): DDiagramSerialized {\r\n\t\tif( \"data\" in target ) {\r\n\t\t\tconst result: DDiagramSerialized = JSON.parse( target.data );\r\n\t\t\tresult.id = target.id;\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn target;\r\n\t}\r\n\r\n\tstatic newLayer(\r\n\t\tserialized: DDiagramSerialized,\r\n\t\tcontainer: DDiagramLayerContainer\r\n\t): Promise<EShape[]> {\r\n\t\t// Layers\r\n\t\tconst pflayers = serialized.layers;\r\n\t\tfor( let i = 0, imax = pflayers.length; i < imax; ++i ) {\r\n\t\t\tcontainer.create( pflayers[ i ][ 0 ] || \"\" );\r\n\t\t}\r\n\r\n\t\t// Activate the first later if it exists\r\n\t\tif( 0 < container.size() ) {\r\n\t\t\tcontainer.active = container.children[ 0 ];\r\n\t\t}\r\n\r\n\t\t// Items\r\n\t\tconst pfresources = serialized.resources;\r\n\t\tconst pfitems = serialized.items;\r\n\t\tconst shapePromises = EShapeDeserializer.deserializeAll( pfitems, pfresources );\r\n\t\tif( shapePromises != null ) {\r\n\t\t\treturn shapePromises.then(( shapes: EShape[] ): EShape[] => {\r\n\t\t\t\tconst layers = container.children;\r\n\t\t\t\tfor( let i = 0, imax = shapes.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst pfitem = pfitems[ i ];\r\n\t\t\t\t\tconst shape = shapes[ i ];\r\n\t\t\t\t\tconst layer = layers[ pfitem[ 16 ] ];\r\n\t\t\t\t\tif( layer != null ) {\r\n\t\t\t\t\t\tshape.attach( layer );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn shapes;\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\treturn Promise.resolve([]);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic applyBackground(\r\n\t\tserialized: DDiagramSerialized,\r\n\t\tcanvas: DBase,\r\n\t\tcanvasContainer: DBase\r\n\t): void {\r\n\t\tconst background = serialized.background;\r\n\t\tconst backgroundColor = ( background && background.color != null ? background.color : 0xffffff );\r\n\t\tconst backgroundAlpha = ( background && background.alpha != null ? background.alpha : 1.0 );\r\n\t\tif( EShapeDefaults.IS_EDIT_MODE ) {\r\n\t\t\tconst canvasBackground = canvas.background;\r\n\t\t\tcanvasBackground.color = backgroundColor;\r\n\t\t\tcanvasBackground.alpha = backgroundAlpha;\r\n\t\t} else {\r\n\t\t\tconst canvasContainerBackground = canvasContainer.background;\r\n\t\t\tcanvasContainerBackground.color = backgroundColor;\r\n\t\t\tcanvasContainerBackground.alpha = backgroundAlpha;\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DApplications } from \"./d-applications\";\r\nimport {\r\n\tDCanvasContainer, DCanvasContainerOnOptions, DCanvasContainerOptions, DThemeCanvasContainer\r\n} from \"./d-canvas-container\";\r\nimport { DDiagramCanvasBase } from \"./d-diagram-canvas-base\";\r\nimport { DDiagramCanvasTilePyramidFactory } from \"./d-diagram-canvas-tile\";\r\nimport { DDiagramLayer } from \"./d-diagram-layer\";\r\nimport { DDiagramSerialized } from \"./d-diagram-serialized\";\r\nimport { DDiagrams } from \"./d-diagrams\";\r\nimport { EShape } from \"./shape/e-shape\";\r\n\r\nexport interface DDiagramBaseOnOptions<CANVAS> extends DCanvasContainerOnOptions<CANVAS> {\r\n\t/**\r\n\t * Triggered when all the shape initializations are finished.\r\n\t *\r\n\t * @param self a diagram\r\n\t */\r\n\tready?: ( self: any ) => void;\r\n}\r\n\r\nexport interface DDiagramBaseOptions<\r\n\tCANVAS extends DDiagramCanvasBase = DDiagramCanvasBase,\r\n\tTHEME extends DThemeDiagramBase = DThemeDiagramBase\r\n> extends DCanvasContainerOptions<CANVAS, THEME> {\r\n\t/**\r\n\t * A tile pyramid factory.\r\n\t */\r\n\ttile?: DDiagramCanvasTilePyramidFactory;\r\n\r\n\ton?: DDiagramBaseOnOptions<CANVAS>;\r\n}\r\n\r\nexport interface DThemeDiagramBase extends DThemeCanvasContainer {\r\n\r\n}\r\n\r\nexport abstract class DDiagramBase<\r\n\tCANVAS extends DDiagramCanvasBase = DDiagramCanvasBase,\r\n\tTHEME extends DThemeDiagramBase = DThemeDiagramBase,\r\n\tOPTIONS extends DDiagramBaseOptions<CANVAS, THEME> = DDiagramBaseOptions<CANVAS, THEME>\r\n> extends DCanvasContainer<CANVAS, THEME, OPTIONS> {\r\n\tprotected _serialized: DDiagramSerialized | null;\r\n\tprotected _tileFactory?: DDiagramCanvasTilePyramidFactory;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis._serialized = null;\r\n\t\tthis._tileFactory = options && options.tile;\r\n\t}\r\n\r\n\tset( serialized: DDiagramSerialized | null ) {\r\n\t\tconst oldSerialized = this._serialized;\r\n\t\tif( oldSerialized !== serialized ) {\r\n\t\t\tif( oldSerialized ) {\r\n\t\t\t\tthis._serialized = null;\r\n\t\t\t\tthis.onUnset();\r\n\t\t\t}\r\n\r\n\t\t\tthis._serialized = serialized;\r\n\t\t\tif( serialized ) {\r\n\t\t\t\tthis.onSet( serialized );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onSet( serialized: DDiagramSerialized ): void {\r\n\t\tconst canvas = this.newCanvas( serialized );\r\n\t\tDDiagrams.newLayer( serialized, canvas.layer ).then(( shapes: EShape[] ): void => {\r\n\t\t\tthis.initialize( shapes );\r\n\t\t\tcanvas.initialize( shapes );\r\n\t\t\tDApplications.update( this );\r\n\t\t\tthis.emit( \"ready\", this );\r\n\t\t});\r\n\t\tDDiagrams.applyBackground( serialized, canvas, this );\r\n\t\tthis.canvas = canvas;\r\n\t}\r\n\r\n\tprotected initialize( shapes: EShape[] ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected abstract newCanvas( serialized: DDiagramSerialized ): CANVAS;\r\n\r\n\tprotected onUnset(): void {\r\n\t\tconst canvas = this.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tthis.canvas = null;\r\n\t\t}\r\n\t}\r\n\r\n\tget(): DDiagramSerialized | null {\r\n\t\treturn this._serialized;\r\n\t}\r\n\r\n\tget layer(): DDiagramLayer | null {\r\n\t\tconst canvas = this.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\treturn canvas.layer.active;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDiagramBase\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DControllerDocument } from \"./d-controller-document\";\r\nimport { DControllers } from \"./d-controllers\";\r\nimport { DDiagramBase, DDiagramBaseOnOptions, DDiagramBaseOptions, DThemeDiagramBase } from \"./d-diagram-base\";\r\nimport { DDiagramCanvasEditor, DDiagramCanvasEditorOptions } from \"./d-diagram-canvas-editor\";\r\nimport { DDiagramSerialized, DDiagramSerializedSimple, DDiagramSerializedVersion } from \"./d-diagram-serialized\";\r\nimport { DDiagrams } from \"./d-diagrams\";\r\nimport { ESnapper } from \"./snapper/e-snapper\";\r\n\r\nexport interface DDiagramEditorController {\r\n\tget( id: number ): Promise<DDiagramSerializedSimple | DDiagramSerialized>;\r\n\tsave( simple: DDiagramSerializedSimple ): Promise<number>;\r\n\tdelete( id: number ): Promise<void>;\r\n}\r\n\r\nexport interface DDiagramEditorOnOptions extends DDiagramBaseOnOptions<DDiagramCanvasEditor> {\r\n\t/**\r\n\t * Triggered when a serialized data is changed without using the set / unset methods.\r\n\t * This happens, for instance, when the name or the ID of the serialized data is changed.\r\n\t *\r\n\t * @param self a diagram editor\r\n\t */\r\n\tchange?: ( self: any ) => void;\r\n\r\n\t/**\r\n\t * Triggered when an operation is successfully finished.\r\n\t *\r\n\t * @param operation an operation ID\r\n\t * @param self a diagram editor\r\n\t */\r\n\tsuccess?: ( operation: \"save\" | \"save-as\", self: any ) => void;\r\n\r\n\t/**\r\n\t * Triggered when an operation is failed.\r\n\t *\r\n\t * @param operation an operation ID\r\n\t * @param self a diagram editor\r\n\t */\r\n\tfail?: ( operation: \"save\" | \"save-as\", self: any ) => void;\r\n}\r\n\r\nexport interface DDiagramEditorOptions<\r\n\tTHEME extends DThemeDiagramEditor = DThemeDiagramEditor\r\n> extends DDiagramBaseOptions<DDiagramCanvasEditor, THEME> {\r\n\tcontroller: DDiagramEditorController;\r\n\ton?: DDiagramEditorOnOptions;\r\n}\r\n\r\nexport interface DThemeDiagramEditor extends DThemeDiagramBase {\r\n\r\n}\r\n\r\nexport class DDiagramEditor<\r\n\tTHEME extends DThemeDiagramEditor = DThemeDiagramEditor,\r\n\tOPTIONS extends DDiagramEditorOptions<THEME> = DDiagramEditorOptions<THEME>\r\n> extends DDiagramBase<DDiagramCanvasEditor, THEME, OPTIONS> implements DControllerDocument<DDiagramSerialized> {\r\n\tprotected _isChanged: boolean = false;\r\n\tprotected _controller: DDiagramEditorController;\r\n\tsnapper: ESnapper;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis._controller = options.controller;\r\n\t\tthis._isChanged = false;\r\n\r\n\t\tconst commands = DControllers.getCommandController();\r\n\t\tcommands.on( \"dirty\", (): void => {\r\n\t\t\tif( this._isChanged !== true ) {\r\n\t\t\t\tthis._isChanged = true;\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.snapper = new ESnapper( this );\r\n\t}\r\n\r\n\tprotected newCanvas( serialized: DDiagramSerialized ): DDiagramCanvasEditor {\r\n\t\treturn new DDiagramCanvasEditor( this.toCanvasOptions( serialized ) );\r\n\t}\r\n\r\n\tprotected toCanvasOptions( serialized: DDiagramSerialized ): DDiagramCanvasEditorOptions {\r\n\t\treturn {\r\n\t\t\tname: serialized.name,\r\n\t\t\twidth: serialized.width,\r\n\t\t\theight: serialized.height,\r\n\t\t\tsnapper: this.snapper,\r\n\t\t\ttile: {\r\n\t\t\t\tfactory: this._tileFactory,\r\n\t\t\t\tmapping: serialized.tile && serialized.tile.mapping\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tserialize(): DDiagramSerialized | null {\r\n\t\tconst canvas = this.canvas;\r\n\t\tconst serialized = this._serialized;\r\n\t\tif( canvas != null && serialized != null ) {\r\n\t\t\treturn canvas.serialize( serialized.id );\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tsave(): Promise<unknown> | boolean {\r\n\t\tconst serialized = this.serialize();\r\n\t\tif( serialized != null ) {\r\n\t\t\treturn this.controller.save({\r\n\t\t\t\tversion: serialized.version,\r\n\t\t\t\tid: serialized.id,\r\n\t\t\t\tname: serialized.name,\r\n\t\t\t\tdata: JSON.stringify( serialized )\r\n\t\t\t})\r\n\t\t\t.then(( newId: number ): void => {\r\n\t\t\t\tthis._isChanged = false;\r\n\t\t\t\tserialized.id = newId;\r\n\t\t\t\tthis._serialized = serialized;\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\tthis.emit( \"success\", \"save\", this );\r\n\t\t\t}, ( reason: any ): void => {\r\n\t\t\t\tthis.emit( \"fail\", \"save\", this );\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tsaveAs( name: string ): Promise<unknown> | boolean {\r\n\t\tconst serialized = this.serialize();\r\n\t\tif( serialized != null ) {\r\n\t\t\tserialized.id = undefined;\r\n\t\t\tserialized.name = name;\r\n\t\t\treturn this.controller.save({\r\n\t\t\t\tversion: serialized.version,\r\n\t\t\t\tid: serialized.id,\r\n\t\t\t\tname: serialized.name,\r\n\t\t\t\tdata: JSON.stringify( serialized )\r\n\t\t\t})\r\n\t\t\t.then(( newId: number ): void => {\r\n\t\t\t\tthis._isChanged = false;\r\n\t\t\t\tserialized.id = newId;\r\n\t\t\t\tthis._serialized = serialized;\r\n\t\t\t\tconst canvas = this.canvas;\r\n\t\t\t\tif( canvas != null ) {\r\n\t\t\t\t\tcanvas.name = name;\r\n\t\t\t\t}\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t\tthis.emit( \"success\", \"save-as\", this );\r\n\t\t\t}, ( reason: any ): void => {\r\n\t\t\t\tthis.emit( \"fail\", \"save-as\", this );\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tdelete(): Promise<unknown> | boolean {\r\n\t\tconst serialized = this._serialized;\r\n\t\tif( serialized != null ) {\r\n\t\t\tif( serialized.id != null ) {\r\n\t\t\t\treturn this.controller.delete( serialized.id )\r\n\t\t\t\t.then((): void => {\r\n\t\t\t\t\tthis.set( null );\r\n\t\t\t\t\tthis.emit( \"success\", \"delete\", this );\r\n\t\t\t\t}, ( reason: any ): void => {\r\n\t\t\t\t\tthis.emit( \"fail\", \"delete\", this );\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tthis.set( null );\r\n\t\t\t\tthis.emit( \"success\", \"delete\", this );\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcreate( name: string, width: number, height: number ): Promise<unknown> | boolean {\r\n\t\tthis.set({\r\n\t\t\tversion: DDiagramSerializedVersion,\r\n\t\t\tid: undefined,\r\n\t\t\tname,\r\n\t\t\twidth,\r\n\t\t\theight,\r\n\t\t\tresources: [],\r\n\t\t\tlayers: [[ \"Default layer\" ]],\r\n\t\t\titems: [],\r\n\t\t\tsnap: undefined\r\n\t\t});\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected onSet( serialized: DDiagramSerialized ): void {\r\n\t\tsuper.onSet( serialized );\r\n\t\tconst snap = serialized.snap;\r\n\t\tconst snapper = this.snapper;\r\n\t\tif( snap != null ) {\r\n\t\t\tsnapper.deserialize( snap );\r\n\t\t} else {\r\n\t\t\tsnapper.reset();\r\n\t\t}\r\n\t\tthis._isChanged = false;\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\tprotected onUnset(): void {\r\n\t\tsuper.onUnset();\r\n\t\tthis._isChanged = false;\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\topen( id: number ): Promise<unknown> | boolean {\r\n\t\treturn this._controller.get( id ).then(( serialized: DDiagramSerializedSimple | DDiagramSerialized ): void => {\r\n\t\t\tthis.set( DDiagrams.toSerialized( serialized ) );\r\n\t\t\tthis.emit( \"success\", \"open\", this );\r\n\t\t}, ( reason: any ): void => {\r\n\t\t\tthis.emit( \"fail\", \"open\", this );\r\n\t\t});\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tthis.set( null );\r\n\t}\r\n\r\n\tisChanged(): boolean {\r\n\t\treturn this._isChanged || this.isNew();\r\n\t}\r\n\r\n\tisNew(): boolean {\r\n\t\tconst serialized = this._serialized;\r\n\t\tif( serialized != null ) {\r\n\t\t\treturn serialized.id == null;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetName(): string | null {\r\n\t\tconst serialized = this._serialized;\r\n\t\tif( serialized != null ) {\r\n\t\t\treturn serialized.name;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tget controller(): DDiagramEditorController {\r\n\t\treturn this._controller;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDiagramEditor\";\r\n\t}\r\n}\r\n","import { utils } from \"pixi.js\";\r\nimport { DApplicationTarget } from \"./d-application-like\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DDiagramCanvasIdMap } from \"./d-diagram-canvas-id-map\";\r\nimport { EShape } from \"./shape/e-shape\";\r\n\r\nexport interface DDiagramShapeLayer {\r\n\tchildren: EShape[];\r\n}\r\n\r\nexport interface DDiagramShapeLayerContainer {\r\n\tchildren: DDiagramShapeLayer[];\r\n}\r\n\r\nexport interface DDiagramShapeCanvas {\r\n\tlayer: DDiagramShapeLayerContainer;\r\n\tids: DDiagramCanvasIdMap;\r\n\tactionables: EShape[];\r\n}\r\n\r\nexport interface DDiagramShapeDiagram extends DApplicationTarget {\r\n\tcanvas: DDiagramShapeCanvas | null;\r\n}\r\n\r\n/**\r\n * A shape helper class for diagrams.\r\n */\r\nexport class DDiagramShape extends utils.EventEmitter {\r\n\tprotected _diagram: DDiagramShapeDiagram;\r\n\tprotected _updateBound: () => void;\r\n\r\n\tconstructor( diagram: DDiagramShapeDiagram ) {\r\n\t\tsuper();\r\n\t\tthis._diagram = diagram;\r\n\t\tthis._updateBound = (): void => {\r\n\t\t\tDApplications.update( diagram );\r\n\t\t};\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst diagram = this._diagram;\r\n\t\tconst canvas = diagram.canvas;\r\n\t\tif( canvas ) {\r\n\t\t\tconst actionables = canvas.actionables;\r\n\t\t\tif( 0 < actionables.length ) {\r\n\t\t\t\tlet effect = -1;\r\n\t\t\t\tconst time = Date.now();\r\n\t\t\t\tfor( let i = 0, imax = actionables.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst actionable = actionables[ i ];\r\n\t\t\t\t\tactionable.update( time );\r\n\t\t\t\t\tconst runtime = actionable.runtime;\r\n\t\t\t\t\tif( runtime && time < runtime.effect ) {\r\n\t\t\t\t\t\tconst runtimeEffect = runtime.effect;\r\n\t\t\t\t\t\tif( time < runtimeEffect ) {\r\n\t\t\t\t\t\t\teffect = ( effect < 0 ? runtimeEffect : Math.min( effect, runtimeEffect ) );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif( 0 <= effect ) {\r\n\t\t\t\t\tsetTimeout( this._updateBound, effect - Date.now() );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget( id: string ): EShape | null {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tconst shapes = ( canvas && canvas.ids[ id ] );\r\n\t\treturn ( shapes && 0 < shapes.length ? shapes[ 0 ] : null );\r\n\t}\r\n\r\n\tgetAll( id: string ): EShape[] {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\treturn ( canvas && canvas.ids[ id ] ) || [];\r\n\t}\r\n\r\n\teach( callback: ( shape: EShape ) => (boolean | void), reverse = false ): EShape | null {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst layers = canvas.layer.children;\r\n\t\t\tif( ! reverse ) {\r\n\t\t\t\tfor( let i = 0, imax = layers.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst layer = layers[ i ];\r\n\t\t\t\t\tconst children = layer.children;\r\n\t\t\t\t\tfor( let j = 0, jmax = children.length; j < jmax; ++j ) {\r\n\t\t\t\t\t\tconst child = children[ j ];\r\n\t\t\t\t\t\tif( callback( child ) === false ) {\r\n\t\t\t\t\t\t\treturn child;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = layers.length - 1; 0 <= i; --i ) {\r\n\t\t\t\t\tconst layer = layers[ i ];\r\n\t\t\t\t\tconst children = layer.children;\r\n\t\t\t\t\tfor( let j = children.length - 1; 0 <= j; --j ) {\r\n\t\t\t\t\t\tconst child = children[ j ];\r\n\t\t\t\t\t\tif( callback( child ) === false ) {\r\n\t\t\t\t\t\t\treturn child;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n","import { DDiagramCanvasTagMap } from \"./d-diagram-canvas-tag-map\";\r\nimport { EShapeTagValueRangeType } from \"./shape/e-shape-tag-value-range\";\r\n\r\nexport interface DDiagramTagCanvas {\r\n\ttags: DDiagramCanvasTagMap;\r\n}\r\n\r\nexport interface DDiagramTagDiagram {\r\n\tcanvas: DDiagramTagCanvas | null;\r\n}\r\n\r\n/**\r\n * A tag helper class for diagrams.\r\n */\r\nexport class DDiagramTag {\r\n\tprotected _diagram: DDiagramTagDiagram;\r\n\r\n\tconstructor( diagram: DDiagramTagDiagram ) {\r\n\t\tthis._diagram = diagram;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tgetIds(): string[] {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\treturn Object.keys( canvas.tags );\r\n\t\t}\r\n\t\treturn [];\r\n\t}\r\n\r\n\teach( callback: ( tagId: string ) => (boolean | void) ): string | null {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst tags = canvas.tags;\r\n\t\t\tfor( const id in tags ) {\r\n\t\t\t\tif( callback( id ) === false ) {\r\n\t\t\t\t\treturn id;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tset( id: string, value: unknown, time?: number, from?: number | null, to?: number | null ): void {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst tagValues = canvas.tags[ id ];\r\n\t\t\tif( tagValues != null ) {\r\n\t\t\t\tfor( let i = 0, imax = tagValues.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst tagValue = tagValues[ i ];\r\n\t\t\t\t\tconst range = tagValue.range;\r\n\r\n\t\t\t\t\t// Range\r\n\t\t\t\t\trange.set( from, to );\r\n\r\n\t\t\t\t\t// Time\r\n\t\t\t\t\tif( time !== undefined ) {\r\n\t\t\t\t\t\ttagValue.time = time;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Value\r\n\t\t\t\t\ttagValue.value = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tclear( id: string ): void {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst tagValues = canvas.tags[ id ];\r\n\t\t\tif( tagValues != null ) {\r\n\t\t\t\tfor( let i = 0, imax = tagValues.length; i < imax; ++i ) {\r\n\t\t\t\t\ttagValues[ i ].clear();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetAll( id: string, values: unknown[], times?: number[], from?: number | null, to?: number | null ): void {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst tagValues = canvas.tags[ id ];\r\n\t\t\tif( tagValues != null ) {\r\n\t\t\t\tfor( let i = 0, imax = tagValues.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst tagValue = tagValues[ i ];\r\n\t\t\t\t\tconst range = tagValue.range;\r\n\r\n\t\t\t\t\t// Range\r\n\t\t\t\t\trange.set( from, to );\r\n\r\n\t\t\t\t\t// Time\r\n\t\t\t\t\tif( times !== undefined ) {\r\n\t\t\t\t\t\ttagValue.times = times;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Value\r\n\t\t\t\t\ttagValue.values = values;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetValue( id: string, value: unknown, time?: number ): void {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst tagValues = canvas.tags[ id ];\r\n\t\t\tif( tagValues != null ) {\r\n\t\t\t\tfor( let i = 0, imax = tagValues.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst tagValue = tagValues[ i ];\r\n\r\n\t\t\t\t\tif( time !== undefined ) {\r\n\t\t\t\t\t\ttagValue.time = time;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttagValue.value = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetValues( id: string, values: unknown[], times?: number[] ): void {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst tagValues = canvas.tags[ id ];\r\n\t\t\tif( tagValues != null ) {\r\n\t\t\t\tfor( let i = 0, imax = tagValues.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst tagValue = tagValues[ i ];\r\n\r\n\t\t\t\t\tif( times !== undefined ) {\r\n\t\t\t\t\t\ttagValue.times = times;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttagValue.values = values;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetTime( id: string, time: number ): void {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst tagValues = canvas.tags[ id ];\r\n\t\t\tif( tagValues != null ) {\r\n\t\t\t\tfor( let i = 0, imax = tagValues.length; i < imax; ++i ) {\r\n\t\t\t\t\ttagValues[ i ].time = time;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetTimes( id: string, times: number[] ): void {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst tagValues = canvas.tags[ id ];\r\n\t\t\tif( tagValues != null ) {\r\n\t\t\t\tfor( let i = 0, imax = tagValues.length; i < imax; ++i ) {\r\n\t\t\t\t\ttagValues[ i ].times = times;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetRange( id: string, from?: number | null, to?: number | null ): void {\r\n\t\tconst canvas = this._diagram.canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst tagValues = canvas.tags[ id ];\r\n\t\t\tif( tagValues != null ) {\r\n\t\t\t\tfor( let i = 0, imax = tagValues.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst range = tagValues[ i ].range;\r\n\t\t\t\t\tif( from !== undefined ) {\r\n\t\t\t\t\t\tif( from !== null ) {\r\n\t\t\t\t\t\t\trange.type |= EShapeTagValueRangeType.FROM;\r\n\t\t\t\t\t\t\trange.from = from;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trange.type &= ~EShapeTagValueRangeType.FROM;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( to !== undefined ) {\r\n\t\t\t\t\t\tif( to !== null ) {\r\n\t\t\t\t\t\t\trange.type |= EShapeTagValueRangeType.TO;\r\n\t\t\t\t\t\t\trange.to = to;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\trange.type &= ~EShapeTagValueRangeType.TO;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Renderer } from \"pixi.js\";\r\nimport { DDiagramBase, DDiagramBaseOptions, DThemeDiagramBase } from \"./d-diagram-base\";\r\nimport { DDiagramCanvas, DDiagramCanvasOptions, DDiagramCanvasTagOptions } from \"./d-diagram-canvas\";\r\nimport { DDiagramSerialized } from \"./d-diagram-serialized\";\r\nimport { DDiagramShape } from \"./d-diagram-shape\";\r\nimport { DDiagramTag } from \"./d-diagram-tag\";\r\nimport { EShapeActionRuntime } from \"./shape/action/e-shape-action-runtime\";\r\nimport { EShapeActionRuntimeOpen } from \"./shape/action/e-shape-action-runtime-open\";\r\nimport { EShapeActionValue } from \"./shape/action/e-shape-action-value\";\r\nimport { EShape } from \"./shape/e-shape\";\r\nimport { EShapeRuntime } from \"./shape/e-shape-runtime\";\r\nimport { EShapeRuntimes } from \"./shape/e-shape-runtimes\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DDiagramOptions<\r\n\tTHEME extends DThemeDiagram = DThemeDiagram\r\n> extends DDiagramBaseOptions<DDiagramCanvas, THEME> {\r\n\ttag?: DDiagramCanvasTagOptions;\r\n}\r\n\r\nexport interface DThemeDiagram extends DThemeDiagramBase {\r\n\r\n}\r\n\r\nexport class DDiagram<\r\n\tTHEME extends DThemeDiagram = DThemeDiagram,\r\n\tOPTIONS extends DDiagramOptions<THEME> = DDiagramOptions<THEME>\r\n> extends DDiagramBase<DDiagramCanvas, THEME, OPTIONS> {\r\n\ttag: DDiagramTag;\r\n\tshape: DDiagramShape;\r\n\topener?: ( target: string ) => void;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\r\n\t\t// Hover handling\r\n\t\tthis.on( UtilPointerEvent.move, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( UtilPointerEvent.contains( this, e.target ) ) {\r\n\t\t\t\tconst canvas = this.canvas;\r\n\t\t\t\tif( canvas ) {\r\n\t\t\t\t\tcanvas.onShapeMove( e );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Pointer down / up handling\r\n\t\tthis.on( UtilPointerEvent.up, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( UtilPointerEvent.contains( this, e.target ) ) {\r\n\t\t\t\tconst canvas = this.canvas;\r\n\t\t\t\tif( canvas ) {\r\n\t\t\t\t\tcanvas.onShapeUp( e );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Click handling\r\n\t\tthis.on( \"click\", ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( UtilPointerEvent.contains( this, e.target ) ) {\r\n\t\t\t\tconst canvas = this.canvas;\r\n\t\t\t\tif( canvas ) {\r\n\t\t\t\t\tcanvas.onShapeClick( e );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t//\r\n\t\tthis.tag = new DDiagramTag( this );\r\n\t\tthis.shape = new DDiagramShape( this );\r\n\t}\r\n\r\n\tprotected initialize( shapes: EShape[] ): void {\r\n\t\tconst formatterMap: { [format: string]: ( value: unknown ) => unknown } = {};\r\n\t\tconst initialMap: { [initial: string]: unknown | undefined } = {};\r\n\t\tconst actionMap: Map<EShapeActionValue, EShapeActionRuntime> = new Map<EShapeActionValue, EShapeActionRuntime>();\r\n\r\n\t\tfor( let i = 0, imax = shapes.length; i < imax; ++i ) {\r\n\t\t\tconst shape = shapes[ i ];\r\n\t\t\tconst runtimeConstructor = EShapeRuntimes[ shape.type ] || EShapeRuntime;\r\n\t\t\tconst runtime = shape.runtime = new (runtimeConstructor)( shape );\r\n\r\n\t\t\t// Tag\r\n\t\t\tconst tag = shape.tag;\r\n\t\t\tfor( let j = 0, jmax = tag.size(); j < jmax; ++j ) {\r\n\t\t\t\tconst value = tag.get( j );\r\n\t\t\t\tif( value ) {\r\n\t\t\t\t\t// Format\r\n\t\t\t\t\tconst tagFormat = value.format;\r\n\t\t\t\t\tconst tagInitial = value.initial;\r\n\t\t\t\t\tif( tagFormat in formatterMap ) {\r\n\t\t\t\t\t\tvalue.formatter = formatterMap[ tagFormat ];\r\n\t\t\t\t\t} else if( 0 < tagFormat.length ) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst formatter = Function(\r\n\t\t\t\t\t\t\t\t\"value\",\r\n\t\t\t\t\t\t\t\t`try {` +\r\n\t\t\t\t\t\t\t\t\t`return (${tagFormat});` +\r\n\t\t\t\t\t\t\t\t`} catch( e1 ) {` +\r\n\t\t\t\t\t\t\t\t\t`try {` +\r\n\t\t\t\t\t\t\t\t\t\t`return (${0 < tagInitial.length ? tagInitial : 0});` +\r\n\t\t\t\t\t\t\t\t\t`} catch( e2 ) {` +\r\n\t\t\t\t\t\t\t\t\t\t`return 0;` +\r\n\t\t\t\t\t\t\t\t\t`}` +\r\n\t\t\t\t\t\t\t\t`}`\r\n\t\t\t\t\t\t\t) as any;\r\n\t\t\t\t\t\t\tformatterMap[ tagFormat ] = formatter;\r\n\t\t\t\t\t\t\tvalue.formatter = formatter;\r\n\t\t\t\t\t\t} catch( e ) {\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Initial\r\n\t\t\t\t\tif( tagInitial in initialMap ) {\r\n\t\t\t\t\t\tvalue.value = initialMap[ tagInitial ];\r\n\t\t\t\t\t} else if( 0 < tagInitial.length ) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tvalue.value = initialMap[ tagInitial ] = (Function(\r\n\t\t\t\t\t\t\t\t`try {` +\r\n\t\t\t\t\t\t\t\t\t`return (${tagInitial});` +\r\n\t\t\t\t\t\t\t\t`} catch( e ) {` +\r\n\t\t\t\t\t\t\t\t\t`return 0;` +\r\n\t\t\t\t\t\t\t\t`}`\r\n\t\t\t\t\t\t\t)());\r\n\t\t\t\t\t\t} catch( e ) {\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Initialize runtime actions\r\n\t\t\tconst values = shape.action.values;\r\n\t\t\tconst actions = runtime.actions;\r\n\t\t\tfor( let j = 0, jmax = values.length; j < jmax; ++j ) {\r\n\t\t\t\tconst value = values[ j ];\r\n\t\t\t\tlet action: EShapeActionRuntime | undefined | null = actionMap.get( value );\r\n\t\t\t\tif( action == null ) {\r\n\t\t\t\t\taction = value.toRuntime( shape );\r\n\t\t\t\t\tif( action != null ) {\r\n\t\t\t\t\t\tif( action instanceof EShapeActionRuntimeOpen ) {\r\n\t\t\t\t\t\t\tif( shape.cursor.length <= 0 ) {\r\n\t\t\t\t\t\t\t\tshape.cursor = \"pointer\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tactionMap.set( value, action );\r\n\t\t\t\t\t\tactions.push( action );\r\n\t\t\t\t\t\truntime.reset |= action.reset;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tactions.push( action );\r\n\t\t\t\t\truntime.reset |= action.reset;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Children\r\n\t\t\tconst children = shape.children;\r\n\t\t\tif( 0 < children.length ) {\r\n\t\t\t\tthis.initialize( children );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newCanvas( serialized: DDiagramSerialized ): DDiagramCanvas {\r\n\t\treturn new DDiagramCanvas( this.toCanvasOptions( serialized ) );\r\n\t}\r\n\r\n\tprotected toCanvasOptions( serialized: DDiagramSerialized ): DDiagramCanvasOptions {\r\n\t\tconst options = this._options;\r\n\t\treturn {\r\n\t\t\tname: serialized.name,\r\n\t\t\twidth: serialized.width,\r\n\t\t\theight: serialized.height,\r\n\t\t\tbackground: {\r\n\t\t\t\tcolor: null\r\n\t\t\t},\r\n\t\t\tborder: {\r\n\t\t\t\tcolor: null\r\n\t\t\t},\r\n\t\t\ttile: {\r\n\t\t\t\tfactory: this._tileFactory,\r\n\t\t\t\tmapping: serialized.tile && serialized.tile.mapping\r\n\t\t\t},\r\n\t\t\ttag: options && options.tag\r\n\t\t};\r\n\t}\r\n\r\n\tprotected onDown( e: interaction.InteractionEvent ): void {\r\n\t\tconst canvas = this.canvas;\r\n\t\tif( canvas && canvas.onShapeDown( e ) ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsuper.onDown( e );\r\n\t}\r\n\r\n\tonDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean {\r\n\t\tconst canvas = this.canvas;\r\n\t\tif( canvas && canvas.onShapeDblClick( e, interactionManager ) ) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn super.onDblClick( e, interactionManager );\r\n\t}\r\n\r\n\trender( renderer: Renderer ): void {\r\n\t\tthis.shape.update();\r\n\t\tsuper.render( renderer );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDiagram\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\r\n\r\nexport interface DDialogConfirmMessageOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeDialogConfirmMessage = DThemeDialogConfirmMessage\r\n> extends DImageOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeDialogConfirmMessage extends DThemeImage {\r\n\r\n}\r\n\r\nexport class DDialogConfirmMessage<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeDialogConfirmMessage = DThemeDialogConfirmMessage,\r\n\tOPTIONS extends DDialogConfirmMessageOptions<VALUE, THEME> = DDialogConfirmMessageOptions<VALUE, THEME>\r\n> extends DImage<VALUE, THEME, OPTIONS> {\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogConfirmMessage\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"./d-base\";\r\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\r\nimport { DDialogConfirmMessage, DDialogConfirmMessageOptions } from \"./d-dialog-confirm-message\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DStateAwareOrValue } from \"./d-state-aware\";\r\nimport { isFunction } from \"./util/is-function\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport interface DDialogConfirmOptions<\r\n\tTHEME extends DThemeDialogConfirm = DThemeDialogConfirm\r\n> extends DDialogCommandOptions<THEME> {\r\n\tmessage?: DStateAwareOrValue<string> | DDialogConfirmMessageOptions | DDialogConfirmMessage;\r\n}\r\n\r\nexport interface DThemeDialogConfirm extends DThemeDialogCommand {\r\n\tgetMessage(): DStateAwareOrValue<string>;\r\n}\r\n\r\nexport class DDialogConfirm<\r\n\tTHEME extends DThemeDialogConfirm = DThemeDialogConfirm,\r\n\tOPTIONS extends DDialogConfirmOptions<THEME> = DDialogConfirmOptions<THEME>\r\n> extends DDialogCommand<THEME, OPTIONS> {\r\n\tprotected _message!: DDialogConfirmMessage;\r\n\r\n\tprotected onInit( layout: DLayoutVertical, options?: OPTIONS ) {\r\n\t\tsuper.onInit( layout, options );\r\n\t\tconst message = this.toMessage( this.theme, options );\r\n\t\tthis._message = message;\r\n\t\tlayout.addChild( message );\r\n\t}\r\n\r\n\tprotected toMessage( theme: DThemeDialogConfirm, options?: DDialogConfirmOptions ): DDialogConfirmMessage {\r\n\t\tif( options && options.message != null ) {\r\n\t\t\tconst message = options.message;\r\n\t\t\tif( isString( message ) || isFunction( message ) ) {\r\n\t\t\t\treturn this.newMessage(\r\n\t\t\t\t\tthis.toMessageOptions( message )\r\n\t\t\t\t);\r\n\t\t\t} else if( message instanceof DBase ) {\r\n\t\t\t\treturn message;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.newMessage(\r\n\t\t\t\t\tthis.toMessageOptionsMerged( message, theme.getMessage() )\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.newMessage(\r\n\t\t\tthis.toMessageOptions( theme.getMessage() )\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toMessageOptionsMerged(\r\n\t\toptions: DDialogConfirmMessageOptions,\r\n\t\tmessage: DStateAwareOrValue<string>\r\n\t): DDialogConfirmMessageOptions {\r\n\t\tif( options.text == null ) {\r\n\t\t\toptions.text =　{};\r\n\t\t}\r\n\t\tif( options.text.value === undefined ) {\r\n\t\t\toptions.text.value = message;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected toMessageOptions( message: DStateAwareOrValue<string> ): DDialogConfirmMessageOptions {\r\n\t\treturn {\r\n\t\t\ttext: {\r\n\t\t\t\tvalue: message\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tprotected newMessage( options: DDialogConfirmMessageOptions ): DDialogConfirmMessage {\r\n\t\treturn new DDialogConfirmMessage( options );\r\n\t}\r\n\r\n\tget message(): DDialogConfirmMessage {\r\n\t\treturn this._message;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogConfirm\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogConfirm, DDialogConfirmOptions, DThemeDialogConfirm } from \"./d-dialog-confirm\";\r\n\r\nexport interface DDialogConfirmDeleteOptions<\r\n\tTHEME extends DThemeDialogConfirm\r\n> extends DDialogConfirmOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeDialogConfirmDelete extends DThemeDialogConfirm {\r\n\r\n}\r\n\r\nexport class DDialogConfirmDelete<\r\n\tTHEME extends DThemeDialogConfirm = DThemeDialogConfirm,\r\n\tOPTIONS extends DDialogConfirmDeleteOptions<THEME> = DDialogConfirmDeleteOptions<THEME>\r\n> extends DDialogConfirm<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogConfirmDelete\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogConfirm, DDialogConfirmOptions, DThemeDialogConfirm } from \"./d-dialog-confirm\";\r\n\r\nexport interface DDialogConfirmDiscardOptions<\r\n\tTHEME extends DThemeDialogConfirm\r\n> extends DDialogConfirmOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeDialogConfirmDiscard extends DThemeDialogConfirm {\r\n\r\n}\r\n\r\nexport class DDialogConfirmDiscard<\r\n\tTHEME extends DThemeDialogConfirm = DThemeDialogConfirm,\r\n\tOPTIONS extends DDialogConfirmDiscardOptions<THEME> = DDialogConfirmDiscardOptions<THEME>\r\n> extends DDialogConfirm<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogConfirmDiscard\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogCommand, DDialogCommandOptions, DThemeDialogCommand } from \"./d-dialog-command\";\r\nimport { DInputTextAndLabel } from \"./d-input-text-and-label\";\r\nimport { DLayoutVertical } from \"./d-layout-vertical\";\r\n\r\nexport interface DDialogInputTextOptions<\r\n\tTHEME extends DThemeDialogInputText\r\n> extends DDialogCommandOptions<THEME> {\r\n\tlabel?: string;\r\n}\r\n\r\nexport interface DThemeDialogInputText extends DThemeDialogCommand {\r\n\tgetLabel(): string;\r\n\tgetLabelWidth(): number;\r\n}\r\n\r\nexport class DDialogInputText<\r\n\tTHEME extends DThemeDialogInputText = DThemeDialogInputText,\r\n\tOPTIONS extends DDialogInputTextOptions<THEME> = DDialogInputTextOptions<THEME>\r\n> extends DDialogCommand<THEME, OPTIONS> {\r\n\tprotected _inputAndLabel!: DInputTextAndLabel;\r\n\r\n\tprotected onInit( layout: DLayoutVertical, options?: OPTIONS ) {\r\n\t\tsuper.onInit( layout, options );\r\n\r\n\t\tconst theme = this.theme;\r\n\t\tthis._inputAndLabel = new DInputTextAndLabel({\r\n\t\t\tparent: layout,\r\n\t\t\twidth: \"padding\", height: \"auto\",\r\n\t\t\tinput: {\r\n\t\t\t\tweight: 1,\r\n\t\t\t\ton: {\r\n\t\t\t\t\tenter: () => {\r\n\t\t\t\t\t\tthis.onOk();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlabel: {\r\n\t\t\t\twidth: theme.getLabelWidth(),\r\n\t\t\t\ttext: {\r\n\t\t\t\t\tvalue: ( options != null && options.label != null ?\r\n\t\t\t\t\t\toptions.label : theme.getLabel()\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tspace: {\r\n\t\t\t\twidth: theme.getLabelWidth()\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tget input() {\r\n\t\treturn this._inputAndLabel.input;\r\n\t}\r\n\r\n\tget value(): string {\r\n\t\treturn this._inputAndLabel.input.value;\r\n\t}\r\n\r\n\tset value( value: string ) {\r\n\t\tthis._inputAndLabel.input.value = value;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogInputText\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDialogConfirm, DDialogConfirmOptions, DThemeDialogConfirm } from \"./d-dialog-confirm\";\r\n\r\nexport interface DDialogMessageOptions<THEME extends DThemeDialogMessage> extends DDialogConfirmOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeDialogMessage extends DThemeDialogConfirm {\r\n\r\n}\r\n\r\nexport class DDialogMessage<\r\n\tTHEME extends DThemeDialogMessage = DThemeDialogMessage,\r\n\tOPTIONS extends DDialogMessageOptions<THEME> = DDialogMessageOptions<THEME>\r\n> extends DDialogConfirm<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogMessage\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {\r\n\tDDialogConfirmMessage, DDialogConfirmMessageOptions, DThemeDialogConfirmMessage\r\n} from \"./d-dialog-confirm-message\";\r\n\r\nexport class DDialogProcessingMessage<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeDialogConfirmMessage = DThemeDialogConfirmMessage,\r\n\tOPTIONS extends DDialogConfirmMessageOptions<VALUE, THEME> = DDialogConfirmMessageOptions<VALUE, THEME>\r\n> extends DDialogConfirmMessage<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogProcessingMessage\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DDialogConfirm, DDialogConfirmOptions, DThemeDialogConfirm } from \"./d-dialog-confirm\";\r\nimport { DDialogConfirmMessage, DDialogConfirmMessageOptions } from \"./d-dialog-confirm-message\";\r\nimport { DDialogProcessingMessage } from \"./d-dialog-processing-message\";\r\n\r\nexport interface DDialogProcessingOptions<THEME extends DThemeDialogProcessing> extends DDialogConfirmOptions<THEME> {\r\n\tinterval?: number;\r\n}\r\n\r\nexport interface DThemeDialogProcessing extends DThemeDialogConfirm {\r\n\tgetInterval(): number;\r\n}\r\n\r\nexport class DDialogProcessing<\r\n\tTHEME extends DThemeDialogProcessing = DThemeDialogProcessing,\r\n\tOPTIONS extends DDialogProcessingOptions<THEME> = DDialogProcessingOptions<THEME>\r\n> extends DDialogConfirm<THEME, OPTIONS> {\r\n\tprotected _isDone: boolean;\r\n\tprotected _startTime: number;\r\n\tprotected _interval: number;\r\n\tprotected _timeoutId?: number;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis._isDone = true;\r\n\t\tthis._startTime =  0;\r\n\t\tthis._interval = ( options && options.interval != null ? options.interval : this.theme.getInterval() );\r\n\t}\r\n\r\n\tprotected newMessage( options: DDialogConfirmMessageOptions ): DDialogConfirmMessage {\r\n\t\treturn new DDialogProcessingMessage( options );\r\n\t}\r\n\r\n\tprotected onOpen() {\r\n\t\tthis._isDone = false;\r\n\t\tthis._startTime = Date.now();\r\n\t\tconst timeoutId = this._timeoutId;\r\n\t\tif( timeoutId != null ) {\r\n\t\t\tclearTimeout( timeoutId );\r\n\t\t}\r\n\t\tthis._message.setStates( DBaseState.NONE, DBaseState.SUCCEEDED | DBaseState.FAILED );\r\n\t\tconst buttonLayout = this._buttonLayout;\r\n\t\tif( buttonLayout != null ) {\r\n\t\t\tbuttonLayout.setDisabled( true );\r\n\t\t}\r\n\t\tsuper.onOpen();\r\n\t}\r\n\r\n\tprotected onDone(): void {\r\n\t\tconst buttonLayout = this._buttonLayout;\r\n\t\tif( buttonLayout != null ) {\r\n\t\t\tbuttonLayout.setDisabled( false );\r\n\t\t} else {\r\n\t\t\tthis.close();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onResolved( message?: string ): void {\r\n\t\tif( message != null ) {\r\n\t\t\tthis._message.text = message;\r\n\t\t}\r\n\t\tthis._message.setStates( DBaseState.SUCCEEDED, DBaseState.FAILED );\r\n\t\tthis.onDone();\r\n\t}\r\n\r\n\tprotected onRejected( message?: string ): void {\r\n\t\tif( message != null ) {\r\n\t\t\tthis._message.text = message;\r\n\t\t}\r\n\t\tthis._message.setStates( DBaseState.FAILED, DBaseState.SUCCEEDED );\r\n\t\tthis.onDone();\r\n\t}\r\n\r\n\tresolve( message?: string ): void {\r\n\t\tif( ! this._isDone ) {\r\n\t\t\tthis._isDone = true;\r\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\r\n\t\t\tconst delay = this._interval - elapsedTime;\r\n\t\t\tif( 0 < delay ) {\r\n\t\t\t\tthis._timeoutId = window.setTimeout((): void => {\r\n\t\t\t\t\tthis._timeoutId = undefined;\r\n\t\t\t\t\tthis.onResolved( message );\r\n\t\t\t\t}, delay );\r\n\t\t\t} else {\r\n\t\t\t\tthis.onResolved( message );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treject( message?: string ): void {\r\n\t\tif( ! this._isDone ) {\r\n\t\t\tthis._isDone = true;\r\n\t\t\tconst elapsedTime = Date.now() - this._startTime;\r\n\t\t\tconst delay = this._interval - elapsedTime;\r\n\t\t\tif( 0 < delay ) {\r\n\t\t\t\tthis._timeoutId = window.setTimeout((): void => {\r\n\t\t\t\t\tthis._timeoutId = undefined;\r\n\t\t\t\t\tthis.onRejected( message );\r\n\t\t\t\t}, delay );\r\n\t\t\t} else {\r\n\t\t\t\tthis.onRejected( message );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onCloseOn(): void {\r\n\t\tif( this._isDone ) {\r\n\t\t\tsuper.onCloseOn();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogProcessing\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DCommandSaveAs } from \"./d-command-save-as\";\r\nimport { DControllers } from \"./d-controllers\";\r\nimport { DDialogInputText, DDialogInputTextOptions, DThemeDialogInputText } from \"./d-dialog-input-text\";\r\n\r\nexport interface DDialogSaveAsOptions<THEME extends DThemeDialogSaveAs> extends DDialogInputTextOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeDialogSaveAs extends DThemeDialogInputText {\r\n\r\n}\r\n\r\nexport class DDialogSaveAs<\r\n\tTHEME extends DThemeDialogSaveAs = DThemeDialogSaveAs,\r\n\tOPTIONS extends DDialogSaveAsOptions<THEME> = DDialogSaveAsOptions<THEME>\r\n> extends DDialogInputText<THEME, OPTIONS> {\r\n\tprotected onOpen() {\r\n\t\tconst name = DControllers.getDocumentController().getName();\r\n\t\tif( name != null ) {\r\n\t\t\tthis._inputAndLabel.input.value = name;\r\n\t\t}\r\n\t\tsuper.onOpen();\r\n\t}\r\n\r\n\tprotected onOk() {\r\n\t\tsuper.onOk();\r\n\r\n\t\tconst name = this._inputAndLabel.input.value;\r\n\t\tDControllers.getCommandController().push( new DCommandSaveAs( name ) );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDialogSaveAs\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\n\r\nexport interface Owner {\r\n\tfocus(): void;\r\n}\r\n\r\nexport interface Parent {\r\n\tparent: unknown;\r\n}\r\n\r\nexport interface Closeable extends DisplayObject {\r\n\tclose(): void;\r\n}\r\n\r\nexport class DMenuContext {\r\n\tprotected _owner: Owner;\r\n\tprotected _closeables: Closeable[];\r\n\r\n\tconstructor( owner: Owner ) {\r\n\t\tthis._owner = owner;\r\n\t\tthis._closeables = [];\r\n\t}\r\n\r\n\tprotected indexOf( target: unknown ): number {\r\n\t\treturn this._closeables.indexOf( target as any );\r\n\t}\r\n\r\n\tprotected close( index: number ): void {\r\n\t\tconst closeables = this._closeables;\r\n\t\tconst imin = Math.max( 0, index );\r\n\t\tfor( let i = closeables.length - 1; imin <= i; --i ) {\r\n\t\t\tcloseables[ i ].close();\r\n\t\t}\r\n\t}\r\n\r\n\tadd( closeable: Closeable ): void {\r\n\t\tthis._closeables.push( closeable );\r\n\t}\r\n\r\n\ttrim( closeable: Closeable | null ): void {\r\n\t\tthis.close( this.indexOf( closeable ) + 1 );\r\n\t}\r\n\r\n\tremove( closeable: Closeable ): void {\r\n\t\tconst index = this.indexOf( closeable );\r\n\t\tif( 0 <= index ) {\r\n\t\t\tthis.close( index + 1 );\r\n\t\t\tthis._closeables.splice( index, 1 );\r\n\t\t\tif( index === 0 ) {\r\n\t\t\t\tthis._owner.focus();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, Point } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DLayoutVertical, DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\r\nimport { DMenuAlign } from \"./d-menu-align\";\r\nimport { Closeable, DMenuContext } from \"./d-menu-context\";\r\nimport { DMenuItem } from \"./d-menu-item\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\nimport { DMenus } from \"./d-menus\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { UtilAttach } from \"./util/util-attach\";\r\nimport { UtilClickOutside } from \"./util/util-click-outside\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\nimport { UtilOverlay } from \"./util/util-overlay\";\r\n\r\nexport interface DMenuOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenu = DThemeMenu\r\n> extends DLayoutVerticalOptions<THEME> {\r\n\talign?: (keyof typeof DMenuAlign) | DMenuAlign;\r\n\tfit?: boolean;\r\n\tsticky?: boolean;\r\n\titems?: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject | null | undefined>;\r\n}\r\n\r\nexport interface DThemeMenu extends DThemeLayoutVertical {\r\n\tgetOffsetX(): number;\r\n\tgetOffsetY(): number;\r\n}\r\n\r\nexport class DMenu<\r\n\tVALUE,\r\n\tTHEME extends DThemeMenu = DThemeMenu,\r\n\tOPTIONS extends DMenuOptions<VALUE, THEME> = DMenuOptions<VALUE, THEME>\r\n> extends DLayoutVertical<THEME, OPTIONS> {\r\n\tprotected _align!: DMenuAlign;\r\n\tprotected _fit!: boolean;\r\n\tprotected _sticky!: boolean;\r\n\tprotected _sub!: boolean;\r\n\tprotected _owner!: DBase<any, any> | null;\r\n\tprotected _context!: DMenuContext | null;\r\n\tprotected _overlay!: UtilOverlay;\r\n\tprotected _onPrerenderBound!: () => void;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._onPrerenderBound = (): void => {\r\n\t\t\tthis.onPrerender();\r\n\t\t};\r\n\r\n\t\tif( options != null ) {\r\n\t\t\tthis._align = ( options.align != null ?\r\n\t\t\t\t( isString( options.align ) ? DMenuAlign[ options.align ] : options.align ) :\r\n\t\t\t\tDMenuAlign.BOTTOM\r\n\t\t\t);\r\n\t\t\tthis._fit = ( options.fit != null ? options.fit : false );\r\n\t\t\tthis._sticky = ( options.sticky != null ? options.sticky : false );\r\n\t\t} else {\r\n\t\t\tthis._align = DMenuAlign.BOTTOM;\r\n\t\t\tthis._fit = false;\r\n\t\t\tthis._sticky = false;\r\n\t\t}\r\n\t\tthis._sub = false;\r\n\t\tthis._owner = null;\r\n\t\tthis.visible = false;\r\n\t\tthis._context = null;\r\n\t\tthis.setState( DBaseState.FOCUS_ROOT, true );\r\n\r\n\t\t// Event handlers\r\n\t\tUtilClickOutside.apply( this, (): void => {\r\n\t\t\tthis.close();\r\n\t\t});\r\n\r\n\t\tthis.on( \"select\", (): void => {\r\n\t\t\tthis.close();\r\n\t\t});\r\n\r\n\t\t// Items\r\n\t\tif( options && options.items ) {\r\n\t\t\tDMenus.newItems( this, options.items, this._sticky );\r\n\t\t}\r\n\r\n\t\t// Overlay\r\n\t\tthis._overlay = new UtilOverlay( options );\r\n\t}\r\n\r\n\tfindItem( value: VALUE ): DMenuItem<VALUE> | null {\r\n\t\tconst children = this.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof DMenuItem && child.value === value ) {\r\n\t\t\t\treturn child;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenu\";\r\n\t}\r\n\r\n\tgetContext(): DMenuContext | null {\r\n\t\treturn this._context;\r\n\t}\r\n\r\n\tgetCloseable(): Closeable | null {\r\n\t\treturn this;\r\n\t}\r\n\r\n\topen( owner: DBase<any, any>, closeable?: Closeable | null, context?: DMenuContext | null ): this {\r\n\t\tif( this.isHidden() ) {\r\n\t\t\tconst layer = this._overlay.pick( this );\r\n\t\t\tthis._owner = owner;\r\n\r\n\t\t\t// States\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\tconst child = children[ i ];\r\n\t\t\t\tif( child instanceof DBase ) {\r\n\t\t\t\t\tchild.setState( DBaseState.FOCUSED | DBaseState.HOVERED, false );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Position & size\r\n\t\t\tconst renderer = layer.renderer;\r\n\t\t\tconst onPrerenderBound = this._onPrerenderBound;\r\n\t\t\tif( this._sticky ) {\r\n\t\t\t\trenderer.on( \"prerender\", onPrerenderBound );\r\n\t\t\t} else {\r\n\t\t\t\trenderer.once( \"prerender\", onPrerenderBound );\r\n\t\t\t}\r\n\t\t\tif( this._fit ) {\r\n\t\t\t\tconst bounds = owner.getBounds();\r\n\t\t\t\tif( bounds != null ) {\r\n\t\t\t\t\tthis.width = bounds.width;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Target\r\n\t\t\tthis._sub = (context != null);\r\n\t\t\tcontext = context || new DMenuContext( owner );\r\n\t\t\tif( closeable != null ) {\r\n\t\t\t\tcontext.trim( closeable );\r\n\t\t\t}\r\n\t\t\tcontext.add( this );\r\n\t\t\tthis._context = context;\r\n\r\n\t\t\t// Stage\r\n\t\t\tlayer.stage.addChild( this );\r\n\r\n\t\t\t// Focus\r\n\t\t\tthis.focus();\r\n\r\n\t\t\t// Show\r\n\t\t\tsuper.show();\r\n\r\n\t\t\t// Event\r\n\t\t\tthis.emit( \"open\", this );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprotected onPrerender(): void {\r\n\t\tconst owner = this._owner;\r\n\t\tif( owner ) {\r\n\t\t\tconst bounds = owner.getBounds();\r\n\t\t\tif( bounds ) {\r\n\t\t\t\tif( this._fit ) {\r\n\t\t\t\t\tthis.width = bounds.width;\r\n\t\t\t\t}\r\n\t\t\t\tconst layer = this._overlay.picked;\r\n\t\t\t\tif( layer ) {\r\n\t\t\t\t\tconst theme = this.theme;\r\n\t\t\t\t\tUtilAttach.attach(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tbounds,\r\n\t\t\t\t\t\ttheme.getOffsetX(), theme.getOffsetY(),\r\n\t\t\t\t\t\tlayer.width, layer.height,\r\n\t\t\t\t\t\tthis._align\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tclose(): this {\r\n\t\tif( this.isShown() ) {\r\n\t\t\tconst context = this._context;\r\n\t\t\tif( context ) {\r\n\t\t\t\tcontext.remove( this );\r\n\t\t\t}\r\n\r\n\t\t\tconst layer = this._overlay.picked;\r\n\t\t\tif( layer ) {\r\n\t\t\t\tlayer.renderer.off( \"prerender\", this._onPrerenderBound );\r\n\t\t\t}\r\n\r\n\t\t\tthis._owner = null;\r\n\r\n\t\t\tsuper.hide();\r\n\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent ) {\r\n\t\t\t\tparent.removeChild( this );\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit( \"close\", this );\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tif( UtilKeyboardEvent.isArrowUpKey( e ) || UtilKeyboardEvent.isArrowDownKey( e ) ) {\r\n\t\t\tconst layer = this._overlay.picked;\r\n\t\t\tif( layer ) {\r\n\t\t\t\tconst focusController = layer.getFocusController();\r\n\t\t\t\tconst focused = focusController.getFocused();\r\n\t\t\t\tif( focused != null ) {\r\n\t\t\t\t\tconst direction = UtilKeyboardEvent.isArrowDownKey( e );\r\n\t\t\t\t\tconst next = focusController.findFocusable(\r\n\t\t\t\t\t\tfocused, false, focused.hasState( DBaseState.FOCUS_ROOT ) || direction, direction\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif( next != null ) {\r\n\t\t\t\t\t\tfocusController.setFocused( next, true, true );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn super.onKeyDown( e );\r\n\t}\r\n\r\n\tprotected containsGlobalPoint( point: Point ): boolean {\r\n\t\treturn ! this._sub;\r\n\t}\r\n}\r\n\r\nDMenus.setMenuCreator( ( options?: DMenuOptions<any> ) => new DMenu<any>( options ) );\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButtonBase, DButtonBaseOnOptions, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\r\nimport { DMenu, DMenuOptions, DThemeMenu } from \"./d-menu\";\r\nimport { DMenuItem } from \"./d-menu-item\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport interface DDropdownBaseOnOptions<VALUE, TEXT_VALUE> extends DButtonBaseOnOptions<VALUE> {\r\n\r\n}\r\n\r\n/**\r\n * Dropdown base options.\r\n */\r\nexport interface DDropdownBaseOptions<\r\n\tVALUE = unknown,\r\n\tTEXT_VALUE = string,\r\n\tTHEME extends DThemeDropdownBase<TEXT_VALUE> = DThemeDropdownBase<TEXT_VALUE>\r\n> extends DButtonBaseOptions<TEXT_VALUE, THEME> {\r\n\t/**\r\n\t * Menu options.\r\n\t */\r\n\tmenu?: DMenuOptions<VALUE> | DMenu<VALUE>;\r\n\r\n\ton?: DDropdownBaseOnOptions<VALUE, TEXT_VALUE>;\r\n}\r\n\r\n/**\r\n * A Dropdown base theme.\r\n */\r\nexport interface DThemeDropdownBase<TEXT_VALUE> extends DThemeButtonBase {\r\n\tgetTextFormatter(): ( value: TEXT_VALUE, caller: DDropdownBase ) => string;\r\n\tgetTextValue( state: DBaseState ): TEXT_VALUE;\r\n\tnewTextValue(): DStateAwareOrValueMightBe<TEXT_VALUE>;\r\n}\r\n\r\nexport class DDropdownBase<\r\n\tVALUE = unknown,\r\n\tTEXT_VALUE = string,\r\n\tTHEME extends DThemeDropdownBase<TEXT_VALUE> = DThemeDropdownBase<TEXT_VALUE>,\r\n\tOPTIONS extends DDropdownBaseOptions<VALUE, TEXT_VALUE, THEME> = DDropdownBaseOptions<VALUE, TEXT_VALUE, THEME>\r\n> extends DButtonBase<TEXT_VALUE, THEME, OPTIONS> {\r\n\tprotected _menu?: DMenu<VALUE>;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tthis.start();\r\n\t\t});\r\n\t}\r\n\r\n\tprotected toItemText( item: DMenuItem<VALUE> | null ): string | null {\r\n\t\tif( item ) {\r\n\t\t\tconst text = item.text;\r\n\t\t\tif( isString( text ) ) {\r\n\t\t\t\treturn text;\r\n\t\t\t} else if( text != null ) {\r\n\t\t\t\tconst computed = text( item.state );\r\n\t\t\t\tif( computed != null ) {\r\n\t\t\t\t\treturn computed;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected toMenu( theme: THEME, options?: OPTIONS ): DMenu<VALUE> {\r\n\t\tconst menu = options && options.menu;\r\n\t\treturn ( menu instanceof DMenu ? menu :\r\n\t\t\tnew DMenu<VALUE>( this.toMenuOptions( theme, menu ) )\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toMenuOptions( theme: THEME, options?: DMenuOptions<VALUE> ): DMenuOptions<VALUE, DThemeMenu> {\r\n\t\toptions = options || {};\r\n\t\tif( options.fit == null ) {\r\n\t\t\toptions.fit = true;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tget menu(): DMenu<VALUE> {\r\n\t\tlet menu = this._menu;\r\n\t\tif( menu == null ) {\r\n\t\t\tmenu = this.toMenu( this.theme, this._options );\r\n\t\t\tthis._menu = menu;\r\n\t\t}\r\n\t\treturn menu;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DDropdownBase\";\r\n\t}\r\n\r\n\tstart(): void {\r\n\t\tthis.menu.open( this );\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tthis.menu.close();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, utils } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DListItem, DListItemSelection } from \"./d-list-item\";\r\nimport { DMenu } from \"./d-menu\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport enum DMenuSidedSelectionMode {\r\n\tNONE,\r\n\tSINGLE,\r\n\tSINGLE_ONCE,\r\n\tDEFAULT = SINGLE_ONCE\r\n}\r\n\r\nexport interface DMenuSidedSelectionOnOptions {\r\n\t[ name: string ]: Function;\r\n}\r\n\r\nexport interface DMenuSidedSelectionOptions {\r\n\tmode?: (keyof typeof DMenuSidedSelectionMode) | DMenuSidedSelectionMode;\r\n\ton?: DMenuSidedSelectionOnOptions;\r\n\tfilter?: ( item: DBase | null ) => boolean;\r\n}\r\n\r\nconst defaultFilter = () => true;\r\n\r\nexport class DMenuSidedSelection extends utils.EventEmitter implements DListItemSelection {\r\n\tprotected _content: Container;\r\n\tprotected _item: DBase | null;\r\n\tprotected _isDirty: boolean;\r\n\tprotected _mode: DMenuSidedSelectionMode;\r\n\tprotected _filter: ( item: DBase | null ) => boolean;\r\n\r\n\tconstructor( content: Container, options?: DMenuSidedSelectionOptions ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._content = content;\r\n\t\tthis._item = null;\r\n\t\tthis._isDirty = true;\r\n\t\tthis._mode = ( options && options.mode != null ?\r\n\t\t\t(isString( options.mode ) ? DMenuSidedSelectionMode[ options.mode ] : options.mode) :\r\n\t\t\tDMenuSidedSelectionMode.DEFAULT\r\n\t\t);\r\n\t\tthis._filter = ( options && options.filter ) || this.getFilterDefault();\r\n\r\n\t\t// Events\r\n\t\tconst on = options && options.on;\r\n\t\tif( on ) {\r\n\t\t\tfor( const name in on ) {\r\n\t\t\t\tthis.on( name, on[ name ] );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoDirty() {\r\n\t\tthis._isDirty = true;\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tif( this._isDirty ) {\r\n\t\t\tthis._isDirty = false;\r\n\t\t\tthis.update_( this._content );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected hasMenu( child: any ): child is { menu: DMenu<any> } {\r\n\t\treturn child && child.menu instanceof DMenu;\r\n\t}\r\n\r\n\tprotected update_( root: Container ): void {\r\n\t\tconst children = root.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof DListItem ) {\r\n\t\t\t\tif( child.isActive() ) {\r\n\t\t\t\t\tthis.set_( child, false );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif( child instanceof Container ) {\r\n\t\t\t\tthis.update_( child );\r\n\t\t\t}\r\n\r\n\t\t\tif( this.hasMenu( child ) ) {\r\n\t\t\t\tthis.update_( child.menu );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tadd( item: DBase ): void {\r\n\t\tthis.update();\r\n\t\tthis.set_( item, true );\r\n\t}\r\n\r\n\tset( item: DBase ): void {\r\n\t\tthis.update();\r\n\t\tthis.set_( item, true );\r\n\t}\r\n\r\n\tget(): DBase | null {\r\n\t\tthis.update();\r\n\t\treturn this._item;\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn ( this._item ? 1 : 0 );\r\n\t}\r\n\r\n\tisEmpty(): boolean {\r\n\t\treturn this._item == null;\r\n\t}\r\n\r\n\tremove( item: DBase ): void {\r\n\t\tthis.update();\r\n\t\tif( this._item === item ) {\r\n\t\t\tthis.set_( null, true );\r\n\t\t}\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tthis.update();\r\n\t\tthis.set_( null, true );\r\n\t}\r\n\r\n\tprotected getFilterDefault(): ( item: DBase | null ) => boolean {\r\n\t\treturn defaultFilter;\r\n\t}\r\n\r\n\tprotected set_( item: DBase | null, emit: boolean ): void {\r\n\t\tconst oldItem = this._item;\r\n\t\tconst mode = this._mode;\r\n\t\tif( mode !== DMenuSidedSelectionMode.NONE && this._filter( item ) && oldItem !== item ) {\r\n\t\t\tthis.setState( oldItem, mode, false );\r\n\t\t\tthis._item = item;\r\n\t\t\tthis.setState( item, mode, true );\r\n\t\t\tif( emit ) {\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected setState( item: DBase | null, mode: DMenuSidedSelectionMode, isOn: boolean ): void {\r\n\t\tif( item ) {\r\n\t\t\tif( mode === DMenuSidedSelectionMode.SINGLE ) {\r\n\t\t\t\titem.setState( DBaseState.ACTIVE, isOn );\r\n\t\t\t} else {\r\n\t\t\t\titem.setState( DBaseState.ACTIVE | DBaseState.READ_ONLY, isOn );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDropdownBase, DDropdownBaseOptions, DThemeDropdownBase } from \"./d-dropdown-base\";\r\n\r\n/**\r\n * Dropdown options.\r\n */\r\nexport interface DDropdownOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeDropdown = DThemeDropdown\r\n> extends DDropdownBaseOptions<VALUE, string, THEME> {\r\n\r\n}\r\n\r\n/**\r\n * A dropdown theme.\r\n */\r\nexport interface DThemeDropdown extends DThemeDropdownBase<string> {\r\n\r\n}\r\n\r\nexport class DDropdown<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeDropdown = DThemeDropdown,\r\n\tOPTIONS extends DDropdownOptions<VALUE, THEME> = DDropdownOptions<VALUE, THEME>\r\n> extends DDropdownBase<VALUE, string, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DDropdown\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DExpandableHeaderOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeExpandableHeader = DThemeExpandableHeader\r\n> extends DImageOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeExpandableHeader extends DThemeImage {\r\n\r\n}\r\n\r\nexport class DExpandableHeader<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeExpandableHeader = DThemeExpandableHeader,\r\n\tOPTIONS extends DExpandableHeaderOptions<VALUE, THEME> = DExpandableHeaderOptions<VALUE, THEME>\r\n> extends DImage<VALUE, THEME, OPTIONS> {\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\r\n\t\tthis.on( UtilPointerEvent.down, (): void => {\r\n\t\t\tif( this.isActionable() ) {\r\n\t\t\t\tthis.onSelect();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected onSelect() {\r\n\t\tthis.emit( \"select\", this );\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tif( this.isActionable() && this.isFocused() && UtilKeyboardEvent.isActivateKey( e ) ) {\r\n\t\t\tthis.onSelect();\r\n\t\t}\r\n\r\n\t\treturn super.onKeyDown( e );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DExpandableHeader\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, DisplayObject } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DBaseStates } from \"./d-base-states\";\r\nimport { DExpandableHeader, DExpandableHeaderOptions } from \"./d-expandable-header\";\r\nimport { DLayoutVertical, DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\r\n\r\nexport interface DExpandableOptions<\r\n\tTHEME extends DThemeExpandable = DThemeExpandable\r\n> extends DLayoutVerticalOptions<THEME> {\r\n\theader?: DisplayObject | DExpandableHeaderOptions;\r\n\tbody: Container;\r\n}\r\n\r\nexport interface DThemeExpandable extends DThemeLayoutVertical {\r\n\r\n}\r\n\r\nexport class DExpandable<\r\n\tTHEME extends DThemeExpandable = DThemeExpandable,\r\n\tOPTIONS extends DExpandableOptions<THEME> = DExpandableOptions<THEME>\r\n> extends DLayoutVertical<THEME, OPTIONS> {\r\n\tprotected _header!: DisplayObject;\r\n\tprotected _body!: Container;\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\t// Header\r\n\t\tconst theme = this.theme;\r\n\t\tconst header = this.toHeader( theme, options );\r\n\t\tthis._header = header;\r\n\t\theader.on( \"select\", (): void => {\r\n\t\t\tthis.toggle();\r\n\t\t});\r\n\t\tthis.addChild( header );\r\n\r\n\t\t// Body\r\n\t\tconst body = this.toBody( theme, options );\r\n\t\tthis._body = body;\r\n\t\tthis.addChild( body );\r\n\r\n\t\t//\r\n\t\tif( this.isActive() ) {\r\n\t\t\tthis.onActivated();\r\n\t\t} else {\r\n\t\t\tthis.onDeactivated();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toHeader( theme: THEME, options?: OPTIONS ): DisplayObject {\r\n\t\tif( options && options.header ) {\r\n\t\t\tif( options.header instanceof DisplayObject ) {\r\n\t\t\t\treturn options.header;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.newHeader( theme, options.header );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.newHeader( theme );\r\n\t}\r\n\r\n\tprotected newHeader( theme: THEME, options?: DExpandableHeaderOptions ): DisplayObject {\r\n\t\treturn new DExpandableHeader( options );\r\n\t}\r\n\r\n\tprotected toBody( theme: THEME,  options: OPTIONS ): Container {\r\n\t\treturn options.body;\r\n\t}\r\n\r\n\topen(): void {\r\n\t\tthis.setActive( true );\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tthis.setActive( false );\r\n\t}\r\n\r\n\ttoggle(): void {\r\n\t\tthis.setActive( ! this.isActive() );\r\n\t}\r\n\r\n\tprotected onActivated(): void {\r\n\t\tconst body = this._body;\r\n\t\tif( body instanceof DBase ) {\r\n\t\t\tbody.show();\r\n\t\t} else {\r\n\t\t\tbody.visible = true;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onDeactivated(): void {\r\n\t\tconst body = this._body;\r\n\t\tif( body instanceof DBase ) {\r\n\t\t\tbody.hide();\r\n\t\t} else {\r\n\t\t\tbody.visible = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onStateChange( newState: DBaseState, oldState: DBaseState ): void {\r\n\t\tsuper.onStateChange( newState, oldState );\r\n\r\n\t\tif( DBaseStates.isActive( newState ) ) {\r\n\t\t\tif( ! DBaseStates.isActive( oldState ) ) {\r\n\t\t\t\tthis.onActivated();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( DBaseStates.isActive( oldState ) ) {\r\n\t\t\t\tthis.onDeactivated();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DExpandable\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DInputAndLabel, DInputAndLabelOptions, DThemeInputAndLabel } from \"./d-input-and-label\";\r\nimport { DInputInteger, DInputIntegerOptions, DThemeInputInteger } from \"./d-input-integer\";\r\n\r\nexport interface DInputIntegerAndLabelOptions<\r\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel\r\n> extends DInputAndLabelOptions<DInputIntegerOptions, THEME> {}\r\n\r\nexport class DInputIntegerAndLabel<\r\n\tTHEME extends DThemeInputAndLabel = DThemeInputAndLabel,\r\n\tOPTIONS extends DInputIntegerAndLabelOptions<THEME> = DInputIntegerAndLabelOptions<THEME>\r\n> extends DInputAndLabel<DInputInteger, DInputIntegerOptions, THEME, OPTIONS> {\r\n\tprotected createInput( options?: DInputIntegerOptions<DThemeInputInteger> ): DInputInteger {\r\n\t\treturn new DInputInteger( options );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMapCoordinate, DMapPoint } from \"./d-map-coordinate\";\r\n\r\nexport class DMapCoordinateEPSG3857 implements DMapCoordinate {\r\n\tprotected static CIRCUMFERENCE_HALF: number = Math.PI * 6378137 /* Approximate earth radius in meter */;\r\n\tprotected _tileSize: number;\r\n\r\n\tconstructor( tileSize: number = 256 ) {\r\n\t\tthis._tileSize = tileSize;\r\n\t}\r\n\r\n\tgetTileSize(): number {\r\n\t\treturn this._tileSize;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the given (lon, lat) point in WGS84 to (x, y) in EPSG:900913.\r\n\t * The origin of the converted point (x, y) is at the middle-left corner.\r\n\t * The `meters` can be the same instance that is passed in as the `lonlat`.\r\n\t *\r\n\t * @param lonlat (lon, lat) point\r\n\t * @param meters (x, y) point in meters converted from the given lonlat.\r\n\t * @return (x, y) point in meters\r\n\t * @see https://www.maptiler.com/google-maps-coordinates-tile-bounds-projection/\r\n\t * @see https://qiita.com/MALORGIS/items/1a9114dd090e5b891bf7\r\n\t */\r\n\tlonLatToMeters( lonlat: DMapPoint, meters: DMapPoint ): DMapPoint {\r\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\r\n\t\tmeters.x = lonlat.x * C / 180;\r\n\t\tmeters.y = Math.log( Math.tan( ( 90 + lonlat.y ) * Math.PI / 360 ) ) * C / Math.PI;\r\n\t\treturn meters;\r\n\t}\r\n\r\n\t/**\r\n\t * The `lonlat` can be the same instance that is passed in as the `meters`.\r\n\t *\r\n\t * @param meters\r\n\t * @param lonlat\r\n\t */\r\n\tmetersToLonLat( meters: DMapPoint, lonlat: DMapPoint ): DMapPoint {\r\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\r\n\t\tlonlat.x = meters.x / C * 180;\r\n\t\tlonlat.y = Math.atan( Math.exp( meters.y * Math.PI / C ) ) * 360 / Math.PI - 90;\r\n\t\treturn lonlat;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts pixel coordinates in given zoom level of pyramid to EPSG:900913.\r\n\t * The origin of the `pixels` is the top-left corner.\r\n\t * The `meters` can be the same instance that is passed in as the `pixels`.\r\n\t */\r\n\tpixelsToMeters( pixels: DMapPoint, tz: number, tileSize: number, meters: DMapPoint ): DMapPoint {\r\n\t\tconst R = this.toResolution( tz, tileSize );\r\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\r\n\t\tmeters.x = pixels.x * R - C;\r\n\t\tmeters.y = C - pixels.y * R;\r\n\t\treturn meters;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts EPSG:900913 to pyramid pixel coordinates in given zoom level.\r\n\t * The origin of the pixels is the top-left corner.\r\n\t * The `pixels` can be the same instance that is passed in as the `meters`.\r\n\t */\r\n\tmetersToPixels( meters: DMapPoint, tz: number, tileSize: number, pixels: DMapPoint ): DMapPoint {\r\n\t\tconst R = this.toResolution( tz, tileSize );\r\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\r\n\t\tpixels.x = ( meters.x + C ) / R;\r\n\t\tpixels.y = ( C - meters.y ) / R;\r\n\t\treturn pixels;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a tile covering region in given pixel coordinates.\r\n\t * The origin of the tile is the top-left corner.\r\n\t * The `tile` can be the same instance that is passed in as the `pixels`.\r\n\t */\r\n\tpixelsToTile( pixels: DMapPoint, tileSize: number, tile: DMapPoint ): DMapPoint {\r\n\t\ttile.x = Math.ceil( pixels.x / tileSize ) - 1;\r\n\t\ttile.y = Math.ceil( pixels.y / tileSize ) - 1;\r\n\t\treturn tile;\r\n\t}\r\n\r\n\t/**\r\n\t * The origin of the tile is the top-left corner.\r\n\t * The `tile` can be the same instance that is passed in as the `meters`.\r\n\t */\r\n\tmetersToTile( meters: DMapPoint, tz: number, tile: DMapPoint ): DMapPoint {\r\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\r\n\t\tconst Z = 1 << tz;\r\n\t\ttile.x = Math.ceil( 0.5 * ( meters.x / C + 1 ) * Z ) - 1;\r\n\t\ttile.y = Math.ceil( 0.5 * ( 1 - meters.y / C ) * Z ) - 1;\r\n\t\treturn tile;\r\n\t}\r\n\r\n\tlonLatToTile( lonlat: DMapPoint, tz: number, tile: DMapPoint ): DMapPoint {\r\n\t\treturn this.metersToTile( this.lonLatToMeters( lonlat, tile ), tz, tile );\r\n\t}\r\n\r\n\tlonLatToPixels( lonlat: DMapPoint, tz: number, tileSize: number, pixels: DMapPoint ): DMapPoint {\r\n\t\treturn this.metersToPixels( this.lonLatToMeters( lonlat, pixels ), tz, tileSize, pixels );\r\n\t}\r\n\r\n\tpixelsToLonLat( pixels: DMapPoint, tz: number, tileSize: number, lonlat: DMapPoint ): DMapPoint {\r\n\t\treturn this.metersToLonLat( this.pixelsToMeters( pixels, tz, tileSize, lonlat ), lonlat );\r\n\t}\r\n\r\n\t/**\r\n\t * The `pixels` can be the same instance that is passed in as the `tile`.\r\n\t */\r\n\ttileToPixels( tile: DMapPoint, tileSize: number, pixels: DMapPoint ): DMapPoint {\r\n\t\tpixels.x = tile.x * tileSize;\r\n\t\tpixels.y = tile.y * tileSize;\r\n\t\treturn pixels;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns bounds of the given tile in EPSG:900913 coordinates\r\n\t * The `meters` can be the same instance that is passed in as the `tile`.\r\n\t */\r\n\ttileToMeters( tile: DMapPoint, tz: number, meters: DMapPoint ): DMapPoint {\r\n\t\tconst R = this.toResolutionMeter( tz );\r\n\t\tconst C = DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF;\r\n\t\tmeters.x = tile.x * R + C;\r\n\t\tmeters.y = C - tile.y * R;\r\n\t\treturn meters;\r\n\t}\r\n\r\n\tprotected toResolutionMeter( tz: number ): number {\r\n\t\treturn ( 2 * DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF ) / ( 1 << tz );\r\n\t}\r\n\r\n\tprotected toResolution( tz: number, tileSize: number ): number {\r\n\t\treturn ( 2 * DMapCoordinateEPSG3857.CIRCUMFERENCE_HALF ) / ( tileSize << tz );\r\n\t}\r\n\r\n\ttoTileCount( tz: number ): number {\r\n\t\treturn (1 << tz);\r\n\t}\r\n\r\n\ttoTileCode( tz: number, tx: number, ty: number ): number {\r\n\t\treturn (tx << tz) + ty;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DMapCoordinate } from \"./d-map-coordinate\";\r\nimport { DMapCoordinateEPSG3857 } from \"./d-map-coordinate-epsg3857\";\r\n\r\nexport class DMapCoordinates {\r\n\tprotected static _default?: DMapCoordinate;\r\n\r\n\tstatic get DEFAULT(): DMapCoordinate {\r\n\t\tif( this._default == null ) {\r\n\t\t\tthis._default = new DMapCoordinateEPSG3857();\r\n\t\t}\r\n\t\treturn this._default;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, Renderer, resources, Sprite, Texture } from \"pixi.js\";\r\n\r\nexport class DMapTile {\r\n\ttx: number;\r\n\tty: number;\r\n\r\n\tprotected _sprite: Sprite;\r\n\r\n\tconstructor(\r\n\t\tparent: Container,\r\n\t\ttx: number, ty: number,\r\n\t\tpx: number, py: number,\r\n\t\tscale: number\r\n\t) {\r\n\t\tthis.tx = tx;\r\n\t\tthis.ty = ty;\r\n\t\tconst sprite = new Sprite( Texture.EMPTY );\r\n\t\t(sprite as any).parent = parent;\r\n\t\tsprite.position.set( px, py );\r\n\t\tsprite.scale.set( scale, scale );\r\n\t\tthis._sprite = sprite;\r\n\t}\r\n\r\n\tload( url: string, onLoaded: () => void ): void {\r\n\t\tconst texture = Texture.from( url, { resolution: 1 } );\r\n\t\tthis._sprite.texture = texture;\r\n\t\tif( texture.valid ) {\r\n\t\t\tonLoaded();\r\n\t\t} else {\r\n\t\t\ttexture.on( \"update\", onLoaded );\r\n\t\t}\r\n\t}\r\n\r\n\ttransform( px: number, py: number, scale: number ): void {\r\n\t\tconst sprite = this._sprite;\r\n\t\tsprite.position.set( px, py );\r\n\t\tsprite.scale.set( scale, scale );\r\n\t}\r\n\r\n\tget loaded(): boolean {\r\n\t\treturn this._sprite.texture.valid;\r\n\t}\r\n\r\n\trender( renderer: Renderer ): void {\r\n\t\tconst sprite = this._sprite;\r\n\t\tsprite.updateTransform();\r\n\t\tsprite.render( renderer );\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst sprite = this._sprite;\r\n\t\tconst texture = sprite.texture;\r\n\t\tconst resource = texture.baseTexture.resource;\r\n\t\tlet image: HTMLImageElement | null = null;\r\n\t\tif( resource instanceof resources.BaseImageResource ) {\r\n\t\t\tif( resource.source instanceof HTMLImageElement ) {\r\n\t\t\t\timage = resource.source;\r\n\t\t\t}\r\n\t\t}\r\n\t\ttexture.destroy( true );\r\n\t\tsprite.destroy();\r\n\t\tif( image ) {\r\n\t\t\timage.src = \"\";\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Point, Renderer } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DMapCoordinate } from \"./d-map-coordinate\";\r\nimport { DMapTile } from \"./d-map-tile\";\r\nimport { DMapTileMappingInternal } from \"./d-map-tile-mapping-internal\";\r\nimport { DMapTileUrlBuilder } from \"./d-map-tile-url-builder\";\r\n\r\nexport class DMapTilePlane {\r\n\tprotected static WORK: Point = new Point();\r\n\r\n\tprotected readonly _parent: DBase;\r\n\tprotected readonly _builder: DMapTileUrlBuilder;\r\n\tprotected readonly _tz: number;\r\n\tprotected _lon0: number;\r\n\tprotected _lat0: number;\r\n\tprotected _lon1: number;\r\n\tprotected _lat1: number;\r\n\tprotected readonly _tiles: Map<number, DMapTile>;\r\n\tprotected _renderer?: Renderer;\r\n\tprotected readonly _renderTileBound: ( tile: DMapTile ) => void;\r\n\tprotected _txmin: number;\r\n\tprotected _txmax: number;\r\n\tprotected _tymin: number;\r\n\tprotected _tymax: number;\r\n\tprotected readonly _deleteTileBound: ( tile: DMapTile, tileCode: number, tiles: Map<number, DMapTile> ) => void;\r\n\tprotected readonly _destroyTileBound: ( tile: DMapTile ) => void;\r\n\tprotected _tileCount: number;\r\n\tprotected _tileScale: number;\r\n\tprotected _tileScaleRelative: number;\r\n\tprotected _tileSize: number;\r\n\tprotected _mapping: DMapTileMappingInternal;\r\n\tprotected _coordinate: DMapCoordinate;\r\n\tprotected _isLoaded: boolean;\r\n\tprotected readonly _updateLoadingStateForEach: ( tile: DMapTile ) => void;\r\n\tprotected readonly _onLoaded: () => void;\r\n\tprotected readonly _onLoadedBound: () => void;\r\n\tprotected _isOnLoadedCalled: boolean;\r\n\tprotected _isOnLoadedAllowed: boolean;\r\n\r\n\tconstructor(\r\n\t\tparent: DBase,\r\n\t\tbuilder: DMapTileUrlBuilder,\r\n\t\ttz: number,\r\n\t\tmapping: DMapTileMappingInternal,\r\n\t\tcoordinate: DMapCoordinate,\r\n\t\tonLoaded: () => void\r\n\t) {\r\n\t\tthis._parent = parent;\r\n\t\tthis._builder = builder;\r\n\t\tthis._onLoaded = onLoaded;\r\n\t\tthis._isOnLoadedCalled = false;\r\n\t\tthis._isOnLoadedAllowed = true;\r\n\t\tthis._onLoadedBound = (): void => {\r\n\t\t\tthis.onLoaded();\r\n\t\t};\r\n\t\tthis._tz = tz;\r\n\t\tthis._lon0 = NaN;\r\n\t\tthis._lat0 = NaN;\r\n\t\tthis._lon1 = NaN;\r\n\t\tthis._lat1 = NaN;\r\n\t\tthis._tiles = new Map<number, DMapTile>();\r\n\t\tthis._renderTileBound = ( tile: DMapTile ): void => {\r\n\t\t\tthis.renderTile( tile );\r\n\t\t};\r\n\t\tthis._txmin = NaN;\r\n\t\tthis._txmax = NaN;\r\n\t\tthis._tymin = NaN;\r\n\t\tthis._tymax = NaN;\r\n\t\tthis._deleteTileBound = ( tile: DMapTile, tileCode: number, tiles: Map<number, DMapTile> ): void => {\r\n\t\t\tthis.deleteTile( tile, tileCode, tiles );\r\n\t\t};\r\n\t\tthis._destroyTileBound = ( tile: DMapTile ): void => {\r\n\t\t\tthis.destroyTile( tile );\r\n\t\t};\r\n\t\tthis._updateLoadingStateForEach = ( tile: DMapTile ): void => {\r\n\t\t\tif( ! tile.loaded ) {\r\n\t\t\t\tthis._isLoaded = false;\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis._tileCount = coordinate.toTileCount( tz );\r\n\t\tthis._tileScaleRelative = 1 / this._tileCount;\r\n\t\tthis._tileScale = mapping.scale * this._tileScaleRelative;\r\n\t\tthis._tileSize = coordinate.getTileSize() * mapping.scale;\r\n\t\tthis._mapping = mapping;\r\n\t\tthis._coordinate = coordinate;\r\n\t\tthis._isLoaded = true;\r\n\t}\r\n\r\n\tprotected newTile( tx: number, ty: number, px: number, py: number, scale: number ): DMapTile {\r\n\t\treturn new DMapTile( this._parent, tx, ty, px, py, scale );\r\n\t}\r\n\r\n\tprotected renderTile( tile: DMapTile ): void {\r\n\t\ttile.render( this._renderer! );\r\n\t}\r\n\r\n\tget tz(): number {\r\n\t\treturn this._tz;\r\n\t}\r\n\r\n\trender( renderer: Renderer ): void {\r\n\t\tthis._renderer = renderer;\r\n\t\tthis._tiles.forEach( this._renderTileBound );\r\n\t}\r\n\r\n\tmove( lon0: number, lat0: number, lon1: number, lat1: number ): void {\r\n\t\tconst oldLon0 = this._lon0;\r\n\t\tconst oldLat0 = this._lat0;\r\n\t\tconst oldLon1 = this._lon1;\r\n\t\tconst oldLat1 = this._lat1;\r\n\t\tif( oldLon0 !== lon0 || oldLat0 !== lat0 || oldLon1 !== lon1 || oldLat1 !== lat1 ) {\r\n\t\t\tthis._lon0 = lon0;\r\n\t\t\tthis._lat0 = lat0;\r\n\t\t\tthis._lon1 = lon1;\r\n\t\t\tthis._lat1 = lat1;\r\n\r\n\t\t\tconst tz = this._tz;\r\n\t\t\tconst coordinate = this._coordinate;\r\n\r\n\t\t\tconst work = DMapTilePlane.WORK;\r\n\t\t\twork.set( lon0, lat0 );\r\n\t\t\tcoordinate.lonLatToTile( work, tz, work );\r\n\t\t\tconst tx0 = work.x;\r\n\t\t\tconst ty0 = work.y;\r\n\r\n\t\t\twork.set( lon1, lat1 );\r\n\t\t\tcoordinate.lonLatToTile( work, tz, work );\r\n\t\t\tconst tx1 = work.x;\r\n\t\t\tconst ty1 = work.y;\r\n\r\n\t\t\tconst tileCount = this._tileCount;\r\n\t\t\tlet txmin = Math.max( 0, tx0 );\r\n\t\t\tlet txmax = Math.min( tileCount - 1, tx1 );\r\n\t\t\tlet tymin = Math.max( 0, ty0 );\r\n\t\t\tlet tymax = Math.min( tileCount - 1, ty1 );\r\n\t\t\tconst dtxmin = txmin - this._txmin;\r\n\t\t\tconst dtxmax = txmax - this._txmax;\r\n\t\t\tconst dtymin = tymin - this._tymin;\r\n\t\t\tconst dtymax = tymax - this._tymax;\r\n\r\n\t\t\tconst isTxMinChanged = dtxmin !== dtxmin || dtxmin < 0 || 1 < dtxmin;\r\n\t\t\tconst isTxMaxChanged = dtxmax !== dtxmax || 0 < dtxmax || dtxmax < -1;\r\n\t\t\tconst isTyMinChanged = dtymin !== dtymin || dtymin < 0 || 1 < dtymin;\r\n\t\t\tconst isTyMaxChanged = dtymax !== dtymax || 0 < dtymax || dtymax < -1;\r\n\t\t\tif( isTxMinChanged || isTxMaxChanged || isTyMinChanged || isTyMaxChanged ) {\r\n\t\t\t\tif( isTxMinChanged ) {\r\n\t\t\t\t\tthis._txmin = txmin;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttxmin = this._txmin;\r\n\t\t\t\t}\r\n\t\t\t\tif( isTxMaxChanged ) {\r\n\t\t\t\t\tthis._txmax = txmax;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttxmax = this._txmax;\r\n\t\t\t\t}\r\n\t\t\t\tif( isTyMinChanged ) {\r\n\t\t\t\t\tthis._tymin = tymin;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttymin = this._tymin;\r\n\t\t\t\t}\r\n\t\t\t\tif( isTyMaxChanged ) {\r\n\t\t\t\t\tthis._tymax = tymax;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttymax = this._tymax;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst tiles = this._tiles;\r\n\t\t\t\ttiles.forEach( this._deleteTileBound );\r\n\r\n\t\t\t\tconst ctx = (txmin + txmax) >> 1;\r\n\t\t\t\tconst cty = (tymin + tymax) >> 1;\r\n\t\t\t\tconst ltx = Math.max( ctx - txmin, txmax - ctx );\r\n\t\t\t\tconst lty = Math.max( cty - tymin, tymax - cty );\r\n\t\t\t\tconst lt = Math.max( ltx, lty );\r\n\r\n\t\t\t\tthis.toOffset( work );\r\n\t\t\t\tconst offsetX = work.x;\r\n\t\t\t\tconst offsetY = work.y;\r\n\r\n\t\t\t\tthis._isOnLoadedCalled = false;\r\n\t\t\t\tthis._isOnLoadedAllowed = false;\r\n\t\t\t\tthis.loadTile( tz, ctx, cty, offsetX, offsetY, work );\r\n\t\t\t\tfor( let it = 1; it <= lt; ++it ) {\r\n\t\t\t\t\tconst txa = ctx - it;\r\n\t\t\t\t\tif( txmin <= txa ) {\r\n\t\t\t\t\t\tthis.loadTilesY( tz, txa, cty, it, tymin, tymax, offsetX, offsetY, work );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst txb = ctx + it;\r\n\t\t\t\t\tif( txb <= txmax ) {\r\n\t\t\t\t\t\tthis.loadTilesY( tz, txb, cty, it, tymin, tymax, offsetX, offsetY, work );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst tya = cty - it;\r\n\t\t\t\t\tif( tymin <= tya ) {\r\n\t\t\t\t\t\tthis.loadTilesX( tz, ctx, it - 1, txmin, txmax, tya, offsetX, offsetY, work );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst tyb = cty + it;\r\n\t\t\t\t\tif( tyb <= tymax ) {\r\n\t\t\t\t\t\tthis.loadTilesX( tz, ctx, it - 1, txmin, txmax, tyb, offsetX, offsetY, work );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._isOnLoadedAllowed = true;\r\n\t\t\t\tif( this._isOnLoadedCalled ) {\r\n\t\t\t\t\tthis.onLoaded();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected loadTilesX(\r\n\t\ttz: number,\r\n\t\tctx: number, ltx: number, txmin: number, txmax: number,\r\n\t\tty: number,\r\n\t\tox: number, oy: number,\r\n\t\twork: Point\r\n\t): void {\r\n\t\tthis.loadTile( tz, ctx, ty, ox, oy, work );\r\n\t\tfor( let i = 1; i <= ltx; ++i ) {\r\n\t\t\tconst txa = ctx - i;\r\n\t\t\tif( txmin <= txa ) {\r\n\t\t\t\tthis.loadTile( tz, txa, ty, ox, oy, work );\r\n\t\t\t}\r\n\t\t\tconst txb = ctx + i;\r\n\t\t\tif( txb <= txmax ) {\r\n\t\t\t\tthis.loadTile( tz, txb, ty, ox, oy, work );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected loadTilesY(\r\n\t\ttz: number, tx: number,\r\n\t\tcty: number, lty: number, tymin: number, tymax: number,\r\n\t\tox: number, oy: number,\r\n\t\twork: Point\r\n\t): void {\r\n\t\tthis.loadTile( tz, tx, cty, ox, oy, work );\r\n\t\tfor( let i = 1; i <= lty; ++i ) {\r\n\t\t\tconst tya = cty - i;\r\n\t\t\tif( tymin <= tya ) {\r\n\t\t\t\tthis.loadTile( tz, tx, tya, ox, oy, work );\r\n\t\t\t}\r\n\t\t\tconst tyb = cty + i;\r\n\t\t\tif( tyb <= tymax ) {\r\n\t\t\t\tthis.loadTile( tz, tx, tyb, ox, oy, work );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected loadTile( tz: number, tx: number, ty: number, ox: number, oy: number, work: Point ): void {\r\n\t\tconst coordinate = this._coordinate;\r\n\t\tconst tileCode = coordinate.toTileCode( tz, tx, ty );\r\n\t\tconst tiles = this._tiles;\r\n\t\tlet tile = tiles.get( tileCode );\r\n\t\tif( tile == null ) {\r\n\t\t\tthis.toTilePosition( tx, ty, ox, oy, work );\r\n\t\t\ttile = this.newTile( tx, ty, work.x, work.y, this._tileScale );\r\n\t\t\ttiles.set( tileCode, tile );\r\n\t\t\ttile.load( this._builder( tz, tx, ty ), this._onLoadedBound );\r\n\t\t\tthis._isLoaded = false;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toTilePosition( tx: number, ty: number, ox: number, oy: number, result: Point ): Point {\r\n\t\tconst tileSize = this._tileSize;\r\n\t\tconst tileScaleRelative = this._tileScaleRelative;\r\n\t\tresult.set( tx, ty );\r\n\t\tthis._coordinate.tileToPixels( result, tileSize, result );\r\n\t\tresult.set( result.x * tileScaleRelative + ox, result.y * tileScaleRelative + oy );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected toOffset( result: Point ): Point {\r\n\t\tconst parent = this._parent;\r\n\t\tconst mapping = this._mapping;\r\n\t\tconst tileSize = this._tileSize;\r\n\t\tresult.set(\r\n\t\t\t-mapping.x * tileSize + parent.width * 0.5,\r\n\t\t\t-mapping.y * tileSize + parent.height * 0.5\r\n\t\t);\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected deleteTile( tile: DMapTile, tileCode: number, tiles: Map<number, DMapTile> ): void {\r\n\t\tconst tx = tile.tx;\r\n\t\tconst ty = tile.ty;\r\n\t\tif( tx < this._txmin || this._txmax < tx || ty < this._tymin || this._tymax < ty ) {\r\n\t\t\ttiles.delete( tileCode );\r\n\t\t\ttile.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst tiles = this._tiles;\r\n\t\ttiles.forEach( this._destroyTileBound );\r\n\t\ttiles.clear();\r\n\t}\r\n\r\n\tprotected destroyTile( tile: DMapTile ): void {\r\n\t\ttile.destroy();\r\n\t}\r\n\r\n\tprotected updateLoadingState(): void {\r\n\t\tthis._isLoaded = true;\r\n\t\tthis._tiles.forEach( this._updateLoadingStateForEach );\r\n\t}\r\n\r\n\tprotected onLoaded(): void {\r\n\t\tif( this._isOnLoadedAllowed ) {\r\n\t\t\tthis._onLoaded();\r\n\t\t} else {\r\n\t\t\tthis._isOnLoadedCalled = true;\r\n\t\t}\r\n\t}\r\n\r\n\tget loaded(): boolean {\r\n\t\tif( ! this._isLoaded ) {\r\n\t\t\tthis.updateLoadingState();\r\n\t\t}\r\n\t\treturn this._isLoaded;\r\n\t}\r\n\r\n\tget mapping(): DMapTileMappingInternal {\r\n\t\treturn this._mapping;\r\n\t}\r\n\r\n\tset mapping( mapping: DMapTileMappingInternal ) {\r\n\t\tconst coordinate = this._coordinate;\r\n\t\tconst tileScale = mapping.scale * this._tileScaleRelative;\r\n\t\tconst tileSize = coordinate.getTileSize() * mapping.scale;\r\n\t\tthis._tileScale = tileScale;\r\n\t\tthis._tileSize = tileSize;\r\n\t\tthis._mapping = mapping;\r\n\r\n\t\tconst work = DMapTilePlane.WORK;\r\n\t\tthis.toOffset( work );\r\n\t\tconst offsetX = work.x;\r\n\t\tconst offsetY = work.y;\r\n\r\n\t\tthis._tiles.forEach(( tile: DMapTile ): void => {\r\n\t\t\tthis.toTilePosition( tile.tx, tile.ty, offsetX, offsetY, work );\r\n\t\t\ttile.transform( work.x, work.y, tileScale );\r\n\t\t});\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Point, Renderer, utils } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DMapCoordinate } from \"./d-map-coordinate\";\r\nimport { DMapTileMapping } from \"./d-map-tile-mapping\";\r\nimport { DMapTileMappingInternal } from \"./d-map-tile-mapping-internal\";\r\nimport { DMapTilePlane } from \"./d-map-tile-plane\";\r\nimport { DMapTilePyramid, DMapTilePyramidOptions } from \"./d-map-tile-pyramid\";\r\nimport { DMapTileUrlBuilder } from \"./d-map-tile-url-builder\";\r\n\r\nexport class DMapTilePyramidImpl extends utils.EventEmitter implements DMapTilePyramid {\r\n\tprotected static WORK_LONLAT: Point = new Point();\r\n\r\n\tprotected readonly _canvas: DBase;\r\n\tprotected readonly _builder: DMapTileUrlBuilder;\r\n\tprotected readonly _planes: Array<DMapTilePlane | undefined>;\r\n\tprotected _z: number;\r\n\tprotected _tz: number;\r\n\tprotected _minZ: number;\r\n\tprotected _maxZ: number;\r\n\tprotected _mapping: DMapTileMapping;\r\n\tprotected _mappingInternal: DMapTileMappingInternal;\r\n\tprotected _coordinate: DMapCoordinate;\r\n\tprotected _onLoadedBound: () => void;\r\n\tprotected _fitBound: () => void;\r\n\tprotected _fitBoundTimeout: number | undefined;\r\n\tprotected _fitThrottledBound: () => void;\r\n\tprotected _fitThrottle: number;\r\n\r\n\tconstructor( options: DMapTilePyramidOptions ) {\r\n\t\tsuper();\r\n\t\tconst canvas = this._canvas = options.canvas;\r\n\t\tthis._builder = options.builder;\r\n\t\tconst mappingLonLat = this._mapping = options.mapping;\r\n\t\tconst coordinate = this._coordinate = options.coordinate;\r\n\t\tthis._mappingInternal = this.toMapping( canvas, mappingLonLat, coordinate );\r\n\t\tthis._z = NaN;\r\n\t\tthis._tz = NaN;\r\n\t\tthis._minZ = options.plane.min;\r\n\t\tthis._maxZ = options.plane.max;\r\n\t\tthis._planes = [];\r\n\t\tthis._onLoadedBound = (): void => {\r\n\t\t\tthis.onLoaded();\r\n\t\t};\r\n\t\tthis._fitBound = (): void => {\r\n\t\t\tthis._fitBoundTimeout = undefined;\r\n\t\t\tthis.fit();\r\n\t\t};\r\n\t\tthis._fitThrottle = options.plane.throttle;\r\n\t\tconst fitThrottledBound = this._fitThrottledBound = (): void => {\r\n\t\t\tthis.fitThrottled();\r\n\t\t};\r\n\t\tcanvas.on( \"scale\", fitThrottledBound );\r\n\t\tcanvas.on( \"move\", fitThrottledBound );\r\n\t\tcanvas.appendRenderable( this, true );\r\n\t}\r\n\r\n\tget coordinate(): DMapCoordinate {\r\n\t\treturn this._coordinate;\r\n\t}\r\n\r\n\tprotected fitThrottled(): void {\r\n\t\tif( this._fitBoundTimeout == null ) {\r\n\t\t\tthis._fitBoundTimeout = window.setTimeout( this._fitBound, this._fitThrottle );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toMapping( canvas: DBase, mapping: DMapTileMapping, coordinate: DMapCoordinate ): DMapTileMappingInternal {\r\n\t\tconst work = DMapTilePyramidImpl.WORK_LONLAT;\r\n\t\tconst tileSize = coordinate.getTileSize();\r\n\r\n\t\twork.set( mapping.from.lon, mapping.from.lat );\r\n\t\tcoordinate.lonLatToPixels( work, 0, tileSize, work );\r\n\t\tconst x0 = work.x;\r\n\t\tconst y0 = work.y;\r\n\r\n\t\twork.set( mapping.to.lon, mapping.to.lat );\r\n\t\tcoordinate.lonLatToPixels( work, 0, tileSize, work );\r\n\t\tconst x1 = work.x;\r\n\t\tconst y1 = work.y;\r\n\r\n\t\tconst dx = Math.abs(x1 - x0);\r\n\t\tconst dy = Math.abs(y1 - y0);\r\n\t\tconst dmin = 0.0000001;\r\n\t\tlet scale = 1;\r\n\t\tif( dmin < dx ) {\r\n\t\t\tif( dmin < dy ) {\r\n\t\t\t\tscale = Math.max( canvas.width / dx, canvas.height / dy );\r\n\t\t\t} else {\r\n\t\t\t\tscale = canvas.width / dx;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( dmin < dy ) {\r\n\t\t\t\tscale = canvas.height / dy;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tscale,\r\n\t\t\tx: 0.5 * (x1 + x0) / tileSize,\r\n\t\t\ty: 0.5 * (y1 + y0) / tileSize\r\n\t\t};\r\n\t}\r\n\r\n\tget mapping(): DMapTileMapping {\r\n\t\treturn this._mapping;\r\n\t}\r\n\r\n\tset mapping( mapping: DMapTileMapping ) {\r\n\t\tconst oldMapping = this._mappingInternal;\r\n\t\tconst newMapping = this.toMapping( this._canvas, mapping, this._coordinate );\r\n\t\tconst threshold = 0.0000001;\r\n\t\tif(\r\n\t\t\tthreshold < Math.abs(oldMapping.scale - newMapping.scale) ||\r\n\t\t\tthreshold < Math.abs(oldMapping.x - newMapping.x) ||\r\n\t\t\tthreshold < Math.abs(oldMapping.y - newMapping.y)\r\n\t\t) {\r\n\t\t\tthis._mappingInternal = newMapping;\r\n\r\n\t\t\tconst planes = this._planes;\r\n\t\t\tfor( let i = 0, imax = planes.length; i < imax; ++i ) {\r\n\t\t\t\tconst plane = planes[ i ];\r\n\t\t\t\tif( plane ) {\r\n\t\t\t\t\tplane.mapping = newMapping;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tDApplications.update( this._canvas );\r\n\r\n\t\t\tthis._fitThrottledBound();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newPlane( tz: number ): DMapTilePlane {\r\n\t\treturn new DMapTilePlane(\r\n\t\t\tthis._canvas,\r\n\t\t\tthis._builder,\r\n\t\t\ttz,\r\n\t\t\tthis._mappingInternal,\r\n\t\t\tthis._coordinate,\r\n\t\t\tthis._onLoadedBound\r\n\t\t);\r\n\t}\r\n\r\n\trender( renderer: Renderer ): void {\r\n\t\tconst tz = this._tz;\r\n\t\tconst planes = this._planes;\r\n\t\tfor( let i = 0; i < tz; ++i ) {\r\n\t\t\tconst plane = planes[ i ];\r\n\t\t\tif( plane != null ) {\r\n\t\t\t\tplane.render( renderer );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor( let i = planes.length - 1; tz < i; --i ) {\r\n\t\t\tconst plane = planes[ i ];\r\n\t\t\tif( plane != null ) {\r\n\t\t\t\tplane.render( renderer );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst planeTz = planes[ tz ];\r\n\t\tif( planeTz != null ) {\r\n\t\t\tplaneTz.render( renderer );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toTileZ( tz: number ): number {\r\n\t\treturn Math.min( this._maxZ, Math.max( this._minZ, Math.floor( tz ) ) );\r\n\t}\r\n\r\n\tupdateTransform(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected toZ( scale: number ): number {\r\n\t\treturn Math.log( this._mappingInternal.scale * scale ) / Math.log( 2 );\r\n\t}\r\n\r\n\tmove( scale: number, lon0: number, lat0: number, lon1: number, lat1: number ): this {\r\n\t\tconst planes = this._planes;\r\n\t\tconst z = this.toZ( scale );\r\n\t\tif( this._z !== z ) {\r\n\t\t\tthis._z = z;\r\n\r\n\t\t\tconst tz = this.toTileZ( z );\r\n\t\t\tif( this._tz !== tz ) {\r\n\t\t\t\tthis._tz = tz;\r\n\r\n\t\t\t\tlet newPlane = planes[ tz ];\r\n\t\t\t\tif( newPlane == null ) {\r\n\t\t\t\t\tnewPlane = this.newPlane( tz );\r\n\t\t\t\t\tplanes[ tz ] = newPlane;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst plane = planes[ this._tz ];\r\n\t\tif( plane != null ) {\r\n\t\t\tplane.move( lon0, lat0, lon1, lat1 );\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tfit(): this {\r\n\t\tconst canvas = this._canvas;\r\n\t\tif( canvas != null ) {\r\n\t\t\tconst container = canvas.parent;\r\n\t\t\tif( container != null ) {\r\n\t\t\t\tconst scale = canvas.scale;\r\n\t\t\t\tconst scaleX = scale.x;\r\n\t\t\t\tconst scaleY = scale.y;\r\n\t\t\t\tconst x = canvas.x;\r\n\t\t\t\tconst y = canvas.y;\r\n\t\t\t\tconst coordinate = this._coordinate;\r\n\t\t\t\tconst mapping = this._mappingInternal;\r\n\t\t\t\tconst tileSize = coordinate.getTileSize() * mapping.scale;\r\n\t\t\t\tconst x0 = mapping.x * tileSize - (x / scaleX + 0.5 * canvas.width);\r\n\t\t\t\tconst x1 = x0 + container.width / scaleX;\r\n\t\t\t\tconst y0 = mapping.y * tileSize - (y / scaleY + 0.5 * canvas.height);\r\n\t\t\t\tconst y1 = y0 + container.height / scaleY;\r\n\r\n\t\t\t\tconst work = DMapTilePyramidImpl.WORK_LONLAT;\r\n\t\t\t\twork.set( x0, y0 );\r\n\t\t\t\tcoordinate.pixelsToLonLat( work, 0, tileSize, work );\r\n\t\t\t\tconst lon0 = work.x;\r\n\t\t\t\tconst lat0 = work.y;\r\n\r\n\t\t\t\twork.set( x1, y1 );\r\n\t\t\t\tcoordinate.pixelsToLonLat( work, 0, tileSize, work );\r\n\t\t\t\tconst lon1 = work.x;\r\n\t\t\t\tconst lat1 = work.y;\r\n\r\n\t\t\t\tthis.move( scaleX, lon0, lat0, lon1, lat1 );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprotected destroyPlanesBefore( tz: number, planes: Array<DMapTilePlane | undefined> ): void {\r\n\t\tfor( let i = 0; i < tz; ++i ) {\r\n\t\t\tconst plane = planes[ i ];\r\n\t\t\tif( plane ) {\r\n\t\t\t\tplane.destroy();\r\n\t\t\t\tplanes[ i ] = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected destroyPlanesAfter( tz: number, planes: Array<DMapTilePlane | undefined> ): void {\r\n\t\tfor( let i = tz + 1, imax = planes.length; i < imax; ++i ) {\r\n\t\t\tconst plane = planes[ i ];\r\n\t\t\tif( plane ) {\r\n\t\t\t\tplane.destroy();\r\n\t\t\t\tplanes[ i ] = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected cleanup(): void {\r\n\t\tconst tz = this._tz;\r\n\t\tconst planes = this._planes;\r\n\t\tconst planeTz = planes[ tz ];\r\n\t\tif( planeTz && planeTz.loaded ) {\r\n\t\t\tthis.destroyPlanesBefore( tz, planes );\r\n\t\t\tthis.destroyPlanesAfter( tz, planes );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor( let i = tz + 1, imax = planes.length; i < imax; ++i ) {\r\n\t\t\tconst plane = planes[ i ];\r\n\t\t\tif( plane && plane.loaded ) {\r\n\t\t\t\tthis.destroyPlanesBefore( tz, planes );\r\n\t\t\t\tthis.destroyPlanesAfter( i, planes );\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor( let i = tz - 1; 0 <= i; --i ) {\r\n\t\t\tconst plane = planes[ i ];\r\n\t\t\tif( plane && plane.loaded ) {\r\n\t\t\t\tthis.destroyPlanesBefore( i, planes );\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onLoaded(): void {\r\n\t\tthis.cleanup();\r\n\t\tDApplications.update( this._canvas );\r\n\t}\r\n\r\n\tdestroy(): this {\r\n\t\tconst planes = this._planes;\r\n\t\tfor( let i = 0, imax = planes.length; i < imax; ++i ) {\r\n\t\t\tconst plane = planes[ i ];\r\n\t\t\tif( plane ) {\r\n\t\t\t\tplane.destroy();\r\n\t\t\t\tplanes[ i ] = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst canvas = this._canvas;\r\n\t\tconst fitThrottledBound = this._fitThrottledBound;\r\n\t\tcanvas.off( \"scale\", fitThrottledBound );\r\n\t\tcanvas.off( \"move\", fitThrottledBound );\r\n\t\tcanvas.removeRenderable( this, true );\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDiagramCanvasBase } from \"./d-diagram-canvas-base\";\r\nimport { DMapCoordinate } from \"./d-map-coordinate\";\r\nimport { DMapCoordinates } from \"./d-map-coordinates\";\r\nimport { DMapTilePyramid, DMapTilePyramidPlaneOptions } from \"./d-map-tile-pyramid\";\r\nimport { DMapTilePyramidImpl } from \"./d-map-tile-pyramid-impl\";\r\nimport { DMapTileUrlBuilder } from \"./d-map-tile-url-builder\";\r\n\r\nexport const DMapTileUrlBuilderKokudo: DMapTileUrlBuilder = ( tz: number, tx: number, ty: number ): string => {\r\n\tif( 5 <= tz ) {\r\n\t\treturn `https://cyberjapandata.gsi.go.jp/xyz/pale/${tz}/${tx}/${ty}.png`;\r\n\t} else if( 2 <= tz ) {\r\n\t\treturn `https://cyberjapandata.gsi.go.jp/xyz/std/${tz}/${tx}/${ty}.png`;\r\n\t} else {\r\n\t\treturn `https://cyberjapandata.gsi.go.jp/xyz/earthhillshade/${tz}/${tx}/${ty}.png`;\r\n\t}\r\n};\r\n\r\nexport const DMapTileUrlBuilderOsm: DMapTileUrlBuilder = ( tz: number, tx: number, ty: number ): string => {\r\n\treturn `https://${\"abc\"[( tx + ty ) % 3]}.tile.openstreetmap.org/${tz}/${tx}/${ty}.png`;\r\n};\r\n\r\nexport const DMapTileUrlBuilderOsmfj: DMapTileUrlBuilder = ( tz: number, tx: number, ty: number ): string => {\r\n\treturn `https://j.tile.openstreetmap.jp/${tz}/${tx}/${ty}.png`;\r\n};\r\n\r\nexport interface DMapTilePyramidsFromOptions {\r\n\tcanvas: DDiagramCanvasBase<any, any>;\r\n\tbuilder?: DMapTileUrlBuilder;\r\n\tcoordinate?: DMapCoordinate;\r\n\tplane?: Partial<DMapTilePyramidPlaneOptions>;\r\n}\r\n\r\nexport class DMapTilePyramids {\r\n\tprotected static MIN: number = 0;\r\n\tprotected static MAX: number = 18;\r\n\tprotected static THROTTLE: number = 333;\r\n\r\n\tprotected static toPlaneOptions( options: DMapTilePyramidsFromOptions ) {\r\n\t\tconst plane = options.plane;\r\n\t\tif( plane ) {\r\n\t\t\treturn {\r\n\t\t\t\tmin: ( plane.min != null ? plane.min : this.MIN ),\r\n\t\t\t\tmax: ( plane.max != null ? plane.max : this.MAX ),\r\n\t\t\t\tthrottle: ( plane.throttle != null ? plane.throttle : this.THROTTLE )\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tmin: this.MIN,\r\n\t\t\t\tmax: this.MAX,\r\n\t\t\t\tthrottle: this.THROTTLE\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tstatic from( options: DMapTilePyramidsFromOptions ): DMapTilePyramid {\r\n\t\treturn new DMapTilePyramidImpl({\r\n\t\t\tcanvas: options.canvas,\r\n\t\t\tbuilder: options.builder || DMapTileUrlBuilderOsmfj,\r\n\t\t\tmapping: options.canvas.tile.mapping,\r\n\t\t\tcoordinate: options.coordinate || DMapCoordinates.DEFAULT,\r\n\t\t\tplane: this.toPlaneOptions( options )\r\n\t\t});\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DMenu, DMenuOptions } from \"./d-menu\";\r\nimport { DMenuItem } from \"./d-menu-item\";\r\n\r\nexport interface DMenuBarItemOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuBarItem = DThemeMenuBarItem\r\n> extends DButtonOptions<VALUE, THEME> {\r\n\tmenu?: DMenuOptions<VALUE> | DMenu<VALUE>;\r\n}\r\n\r\nexport interface DThemeMenuBarItem extends DThemeButton {\r\n\r\n}\r\n\r\nexport class DMenuBarItem<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuBarItem = DThemeMenuBarItem,\r\n\tOPTIONS extends DMenuBarItemOptions<VALUE, THEME> = DMenuBarItemOptions<VALUE, THEME>\r\n> extends DButton<VALUE, THEME, OPTIONS> {\r\n\tprotected _menu!: DMenu<VALUE>;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._menu = this.toMenu( this.theme, options );\r\n\t\tthis._menu.on( \"select\", ( value: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE> ): void => {\r\n\t\t\tthis.onSelect( value, item, menu );\r\n\t\t});\r\n\t}\r\n\r\n\tprotected toMenu( theme: THEME, options?: OPTIONS ): DMenu<VALUE> {\r\n\t\tconst menu = options && options.menu;\r\n\t\tif( menu instanceof DMenu ) {\r\n\t\t\treturn menu;\r\n\t\t} else {\r\n\t\t\treturn new DMenu( this.toMenuOptions( theme, menu ) );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newMenu( theme: THEME, options?: DMenuOptions<VALUE> ): DMenu<VALUE> {\r\n\t\treturn new DMenu<VALUE>( this.toMenuOptions( theme, options ) );\r\n\t}\r\n\r\n\tprotected toMenuOptions( theme: THEME, options?: DMenuOptions<VALUE> ): DMenuOptions<VALUE> | undefined {\r\n\t\toptions = options || {};\r\n\t\tif( options.fit == null ) {\r\n\t\t\toptions.fit = false;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tthis._menu.close();\r\n\t}\r\n\r\n\tget menu() {\r\n\t\treturn this._menu;\r\n\t}\r\n\r\n\tprotected onSelect( value: VALUE, item: DMenuItem<VALUE>, menu: DMenu<VALUE> ): void {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent != null ) {\r\n\t\t\tparent.emit( \"select\", value, item, menu );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuBarItem\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Container, interaction, Point } from \"pixi.js\";\r\nimport { DMenuBarItem } from \"./d-menu-bar-item\";\r\nimport { Closeable } from \"./d-menu-context\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport class DMenuBarBlocker extends Container {\r\n\tconstructor( target: Closeable & Container ) {\r\n\t\tsuper();\r\n\t\tthis.renderable = false;\r\n\t\tthis.interactive = true;\r\n\r\n\t\tthis.on( UtilPointerEvent.down, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( e.target === this ) {\r\n\t\t\t\ttarget.close();\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.on( UtilPointerEvent.move, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( e.target === this ) {\r\n\t\t\t\tconst children = target.children;\r\n\t\t\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst child = children[ i ];\r\n\t\t\t\t\tif( child instanceof DMenuBarItem ) {\r\n\t\t\t\t\t\tchild.setHovered( child.containsPoint( e.data.global ) );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tcontainsPoint( global: Point ): boolean {\r\n\t\treturn true;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DBaseStates } from \"./d-base-states\";\r\nimport { DLayoutHorizontal, DLayoutHorizontalOptions, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DLayoutSpace, DLayoutSpaceOptions, DThemeLayoutSpace } from \"./d-layout-space\";\r\nimport { DMenuBarBlocker } from \"./d-menu-bar-blocker\";\r\nimport { DMenuBarItem, DMenuBarItemOptions, DThemeMenuBarItem } from \"./d-menu-bar-item\";\r\nimport { Closeable, DMenuContext } from \"./d-menu-context\";\r\nimport { UtilClickOutside } from \"./util/util-click-outside\";\r\nimport { UtilOverlay } from \"./util/util-overlay\";\r\n\r\nexport interface DMenuBarItemSpaceOptions<\r\n\tTHEME extends DThemeMenuBarItemSpace = DThemeMenuBarItemSpace\r\n> extends DLayoutSpaceOptions<THEME> {\r\n\tspace: true;\r\n}\r\n\r\nexport interface DThemeMenuBarItemSpace extends DThemeLayoutSpace {\r\n\r\n}\r\n\r\nexport interface DMenuBarOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuBar = DThemeMenuBar\r\n> extends DLayoutHorizontalOptions<THEME> {\r\n\titems?: Array<DMenuBarItemOptions<VALUE, DThemeMenuBarItem> | DMenuBarItemSpaceOptions | DisplayObject>;\r\n}\r\n\r\nexport interface DThemeMenuBar extends DThemeLayoutHorizontal {\r\n\r\n}\r\n\r\nexport class DMenuBar<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuBar = DThemeMenuBar,\r\n\tOPTIONS extends DMenuBarOptions<VALUE, THEME> = DMenuBarOptions<VALUE, THEME>\r\n>　extends DLayoutHorizontal<THEME, OPTIONS> {\r\n\tprotected _context!: DMenuContext | null;\r\n\tprotected _blocker!: DMenuBarBlocker;\r\n\tprotected _overlay!: UtilOverlay;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.setState( DBaseState.FOCUS_ROOT, true );\r\n\r\n\t\tif( options != null && options.items != null ) {\r\n\t\t\tconst items = options.items;\r\n\t\t\tUtilClickOutside.apply( this, (): void => {\r\n\t\t\t\tthis.close();\r\n\t\t\t});\r\n\t\t\tconst onItemStateChangeBound = ( newState: DBaseState, oldState: DBaseState, item: DMenuBarItem<VALUE> ): void => {\r\n\t\t\t\tthis.onItemStateChange( newState, oldState, item );\r\n\t\t\t};\r\n\t\t\tfor( let i = 0, imax = items.length; i < imax; ++i ) {\r\n\t\t\t\tconst itemOrItemOptions = items[ i ];\r\n\t\t\t\tconst item = ( itemOrItemOptions instanceof DisplayObject ? itemOrItemOptions :\r\n\t\t\t\t\t( \"space\" in itemOrItemOptions ? new DLayoutSpace( itemOrItemOptions ) :\r\n\t\t\t\t\t\tnew DMenuBarItem<VALUE>( itemOrItemOptions )\r\n\t\t\t\t\t)\r\n\t\t\t\t);\r\n\t\t\t\tif( item instanceof DMenuBarItem ) {\r\n\t\t\t\t\titem.on( \"statechange\", onItemStateChangeBound );\r\n\t\t\t\t}\r\n\t\t\t\tthis.addChild( item );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.on( \"select\", (): void => {\r\n\t\t\tthis.close();\r\n\t\t});\r\n\r\n\t\tthis._context = null;\r\n\t\tthis._blocker = new DMenuBarBlocker( this );\r\n\t\tthis._overlay = new UtilOverlay( options );\r\n\t}\r\n\r\n\tprotected onItemStateChange( newState: DBaseState, oldState: DBaseState, item: DMenuBarItem<VALUE> ): void {\r\n\t\tconst context = this._context;\r\n\t\tif( context == null ) {\r\n\t\t\tif( ! DBaseStates.isDisabled( newState ) ) {\r\n\t\t\t\tif( DBaseStates.isPressed( newState ) ) {\r\n\t\t\t\t\tif( item.menu.isHidden() ) {\r\n\t\t\t\t\t\titem.setPressed( false );\r\n\t\t\t\t\t\tthis.open( item );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( ! DBaseStates.isDisabled( newState ) ) {\r\n\t\t\t\tif( DBaseStates.isHovered( newState ) && ! DBaseStates.isHovered( oldState ) ) {\r\n\t\t\t\t\tconst menu = item.menu;\r\n\t\t\t\t\tif( menu.isHidden() ) {\r\n\t\t\t\t\t\tmenu.open( item, this, context );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetContext(): DMenuContext | null {\r\n\t\treturn this._context;\r\n\t}\r\n\r\n\tgetCloseable(): Closeable | null {\r\n\t\treturn this;\r\n\t}\r\n\r\n\topen( item: DMenuBarItem<VALUE> ): void {\r\n\t\tlet context = this._context;\r\n\t\tif( context == null ) {\r\n\t\t\tconst layer = this._overlay.pick( this );\r\n\t\t\tlayer.stage.addChild( this._blocker );\r\n\t\t\tcontext = this._context = new DMenuContext( this );\r\n\t\t\tcontext.trim( item );\r\n\t\t\tcontext.add( this );\r\n\t\t\titem.menu.open( item, this, context );\r\n\t\t}\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\tconst context = this._context;\r\n\t\tif( context != null ) {\r\n\t\t\tthis._context = null;\r\n\t\t\tcontext.remove( this );\r\n\t\t\tconst blocker = this._blocker;\r\n\t\t\tconst parent = blocker.parent;\r\n\t\t\tif( parent ) {\r\n\t\t\t\tparent.removeChild( blocker );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuBar\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DLayoutVerticalOptions, DThemeLayoutVertical } from \"./d-layout-vertical\";\r\n\r\nexport interface DMenuSidedContentOptions<\r\n\tTHEME extends DThemeMenuSidedContent = DThemeMenuSidedContent\r\n> extends DLayoutVerticalOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeMenuSidedContent extends DThemeLayoutVertical {\r\n\r\n}\r\n\r\nexport class DMenuSidedContent<\r\n\tTHEME extends DThemeMenuSidedContent = DThemeMenuSidedContent,\r\n\tOPTIONS extends DMenuSidedContentOptions<THEME> = DMenuSidedContentOptions<THEME>\r\n> extends DLayoutHorizontal<THEME, OPTIONS> {\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t}\r\n\r\n\tprotected initReflowable(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSidedContent\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\r\nimport { DDialogSelectOptions } from \"./d-dialog-select\";\r\nimport { DMenu, DMenuOptions } from \"./d-menu\";\r\nimport { DTableBodyCellButtonOptions } from \"./d-table-body-cell-button\";\r\nimport { DTableBodyCellCheckOptions } from \"./d-table-body-cell-check\";\r\nimport { DTableBodyCellColorOptions } from \"./d-table-body-cell-color\";\r\nimport { DTableBodyCellDateOptions } from \"./d-table-body-cell-date\";\r\nimport { DTableBodyCellDatetimeOptions } from \"./d-table-body-cell-datetime\";\r\nimport { DTableBodyCellIndexOptions } from \"./d-table-body-cell-index\";\r\nimport { DTableBodyCellInputIntegerOptions } from \"./d-table-body-cell-input-integer\";\r\nimport { DTableBodyCellInputRealOptions } from \"./d-table-body-cell-input-real\";\r\nimport { DTableBodyCellInputTextOptions } from \"./d-table-body-cell-input-text\";\r\nimport { DTableBodyCellLinkLinkOptions, DTableBodyCellLinkOptions } from \"./d-table-body-cell-link\";\r\nimport { DTableBodyCellSelectDialogOptions } from \"./d-table-body-cell-select-dialog\";\r\nimport { DTableBodyCellSelectMenuOptions } from \"./d-table-body-cell-select-menu\";\r\nimport { DTableBodyCellSelectMultipleOptions } from \"./d-table-body-cell-select-multiple\";\r\nimport { DTableBodyCellSelectPromiseOptions } from \"./d-table-body-cell-select-promise\";\r\nimport { DTableBodyCellTextOptions } from \"./d-table-body-cell-text\";\r\nimport { DTableBodyCellTimeOptions } from \"./d-table-body-cell-time\";\r\nimport { DTableBodyCellTreeOptions } from \"./d-table-body-cell-tree\";\r\nimport { DTableDataComparatorFunction, DTableDataComparatorObject } from \"./d-table-data-sorter\";\r\nimport { DTableHeaderCellOptions } from \"./d-table-header-cell\";\r\n\r\nexport enum DTableColumnType {\r\n\tINDEX,\r\n\tTEXT,\r\n\tINTEGER,\r\n\tREAL,\r\n\tCHECK,\r\n\tCHECK_SINGLE,\r\n\tCOLOR,\r\n\tBUTTON,\r\n\tSELECT,\r\n\tDATE,\r\n\tDATETIME,\r\n\tTIME,\r\n\tACTION,\r\n\tLINK,\r\n\tTREE\r\n}\r\n\r\nexport type DTableGetter<ROW, CELL> = ( row: ROW, columnIndex: number ) => CELL;\r\nexport type DTableSetter<ROW, CELL> = ( row: ROW, columnIndex: number, cell: CELL ) => void;\r\nexport type DTableFormatter<CELL> = ( cell: CELL ) => string;\r\nexport type DTableEditingFormatter<CELL> = ( cell: CELL ) => string;\r\nexport type DTableEditingUnformatter<CELL> = ( formatted: string ) => CELL;\r\nexport type DTableEditingValidator<CELL> = ( cell: CELL ) => string | null;\r\nexport type DTableSelectingGetter<CELL, DIALOG> = ( dialog: DIALOG ) => CELL;\r\nexport type DTableSelectingSetter<CELL, DIALOG> = ( dialog: DIALOG, cell: CELL ) => void;\r\nexport type DTableEditable<ROW> = ( row: ROW, columnIndex: number ) => boolean;\r\nexport type DTableRenderable<ROW> = ( row: ROW, columnIndex: number ) => boolean;\r\n\r\nexport type DTableBodyCellOptionsUnion<ROW> = DTableBodyCellTextOptions<ROW> | DTableBodyCellInputTextOptions<ROW> |\r\n\tDTableBodyCellInputIntegerOptions<ROW> | DTableBodyCellInputRealOptions<ROW> | DTableBodyCellIndexOptions<ROW> |\r\n\tDTableBodyCellColorOptions<ROW> | DTableBodyCellCheckOptions<ROW> | DTableBodyCellSelectDialogOptions<ROW> |\r\n\tDTableBodyCellSelectPromiseOptions<ROW> | DTableBodyCellSelectMenuOptions<ROW> | DTableBodyCellDateOptions<ROW> |\r\n\tDTableBodyCellDatetimeOptions<ROW> | DTableBodyCellTimeOptions<ROW> | DTableBodyCellButtonOptions<ROW> |\r\n\tDTableBodyCellLinkOptions<ROW> | DTableBodyCellSelectMultipleOptions<ROW> | DTableBodyCellTreeOptions<ROW>;\r\n\r\nexport type DTableBodyCellOptionsMerged<ROW> = DTableBodyCellTextOptions<ROW> & DTableBodyCellInputTextOptions<ROW> &\r\n\tDTableBodyCellInputIntegerOptions<ROW> & DTableBodyCellInputRealOptions<ROW> & DTableBodyCellIndexOptions<ROW> &\r\n\tDTableBodyCellColorOptions<ROW> & DTableBodyCellCheckOptions<ROW> & DTableBodyCellSelectDialogOptions<ROW> &\r\n\tDTableBodyCellSelectPromiseOptions<ROW> & DTableBodyCellSelectMenuOptions<ROW> & DTableBodyCellDateOptions<ROW> &\r\n\tDTableBodyCellDatetimeOptions<ROW> & DTableBodyCellTimeOptions<ROW> & DTableBodyCellButtonOptions<ROW> &\r\n\tDTableBodyCellLinkOptions<ROW> & DTableBodyCellSelectMenuOptions<ROW> & DTableBodyCellTreeOptions<ROW>;\r\n\r\nexport interface DTableColumnEditingOptions<ROW, CELL> {\r\n\tenable?: boolean | DTableEditable<ROW> | \"auto\" | \"AUTO\";\r\n\tformatter?: DTableEditingFormatter<CELL>;\r\n\tunformatter?: DTableEditingUnformatter<CELL>;\r\n\tvalidator?: DTableEditingValidator<CELL>;\r\n}\r\n\r\nexport interface DTableColumnEditing<ROW, CELL> {\r\n\tenable: boolean | DTableEditable<ROW>;\r\n\tformatter: DTableEditingFormatter<CELL>;\r\n\tunformatter: DTableEditingUnformatter<CELL>;\r\n\tvalidator?: DTableEditingValidator<CELL>;\r\n}\r\n\r\nexport interface DTableColumnSortingOptions<ROW> {\r\n\tenable?: boolean;\r\n\tcomparator?: DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW>;\r\n}\r\n\r\nexport interface DTableColumnSorting<ROW> {\r\n\tenable: boolean;\r\n\tcomparator?: DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW>;\r\n}\r\n\r\nexport interface DTableColumnSelectingDialog<VALUE> {\r\n\treadonly value: VALUE;\r\n\topen(): Promise<void>;\r\n}\r\n\r\nexport interface DTableColumnSelectingOptions<\r\n\tCELL,\r\n\tDIALOG_VALUE,\r\n\tDIALOG extends DTableColumnSelectingDialog<DIALOG_VALUE>\r\n> {\r\n\tgetter?: DTableSelectingGetter<CELL, DIALOG>;\r\n\tsetter?: DTableSelectingSetter<CELL, DIALOG>;\r\n\r\n\tmenu?: DMenuOptions<CELL> | DMenu<CELL>;\r\n\tmultiple?: DMenuOptions<CELL> | DMenu<CELL>;\r\n\tdialog?: DDialogSelectOptions<DIALOG_VALUE> | DIALOG;\r\n\tpromise?: () => Promise<CELL>;\r\n}\r\n\r\nexport interface DTableColumnSelecting<\r\n\tCELL,\r\n\tDIALOG_VALUE,\r\n\tDIALOG extends DTableColumnSelectingDialog<DIALOG_VALUE>\r\n> {\r\n\tgetter: DTableSelectingGetter<CELL, DIALOG>;\r\n\tsetter: DTableSelectingSetter<CELL, DIALOG>;\r\n\r\n\tmenu?: DMenu<CELL>;\r\n\tmultiple?: DMenu<CELL>;\r\n\tdialog?: DIALOG;\r\n\tpromise?: () => Promise<CELL>;\r\n}\r\n\r\nexport interface DTableColumnOptions<\r\n\tROW,\r\n\tCELL = any,\r\n\tDIALOG_VALUE = any,\r\n\tDIALOG extends DTableColumnSelectingDialog<DIALOG_VALUE> = any\r\n> {\r\n\tweight?: number;\r\n\twidth?: number;\r\n\r\n\ttype?: (keyof typeof DTableColumnType) | DTableColumnType;\r\n\tlabel?: string;\r\n\tgetter?: DTableGetter<ROW, CELL>;\r\n\tsetter?: DTableSetter<ROW, CELL>;\r\n\tpath?: string;\r\n\tdefault?: CELL;\r\n\tformatter?: DTableFormatter<CELL>;\r\n\talign?: (keyof typeof DAlignHorizontal) | DAlignHorizontal;\r\n\r\n\t/**\r\n\t * If the renderable is\r\n\t *\r\n\t * * true, cells get rendered.\r\n\t * * false, cells do not get rendered.\r\n\t * * a function, cells get rendered only when that function returns true.\r\n\t * * \"AUTO\", cells get rendered only when the cell data exit.\r\n\t */\r\n\trenderable?: boolean | DTableRenderable<ROW> | \"auto\" | \"AUTO\";\r\n\r\n\t/**\r\n\t * If the editable is\r\n\t *\r\n\t * * true, cells get editable.\r\n\t * * false, cells do not get editable.\r\n\t * * a function, cells are editable only when that function returns true.\r\n\t * * \"AUTO\", cells are editable only when the cell data exist.\r\n\t */\r\n\teditable?: boolean | DTableEditable<ROW> | \"auto\" | \"AUTO\";\r\n\tediting?: DTableColumnEditingOptions<ROW, CELL>;\r\n\r\n\tsortable?: boolean;\r\n\tsorting?: DTableColumnSortingOptions<ROW>;\r\n\r\n\theader?: DTableHeaderCellOptions<ROW>;\r\n\tbody?: DTableBodyCellOptionsUnion<ROW>;\r\n\r\n\tselecting?: DTableColumnSelectingOptions<CELL, DIALOG_VALUE, DIALOG>;\r\n\r\n\tcategory?: string | string[];\r\n\tfrozen?: boolean;\r\n\r\n\tlink?: DTableBodyCellLinkLinkOptions<ROW>;\r\n}\r\n\r\nexport interface DTableColumn<\r\n\tROW,\r\n\tCELL = unknown,\r\n\tDIALOG_VALUE = unknown,\r\n\tDIALOG extends DTableColumnSelectingDialog<DIALOG_VALUE> = DTableColumnSelectingDialog<DIALOG_VALUE>\r\n> {\r\n\tweight: number | undefined;\r\n\twidth: number | undefined;\r\n\r\n\ttype: DTableColumnType;\r\n\tlabel: string;\r\n\tgetter: DTableGetter<ROW, CELL>;\r\n\tsetter: DTableSetter<ROW, CELL>;\r\n\tformatter?: DTableFormatter<CELL>;\r\n\talign: DAlignHorizontal;\r\n\trenderable: boolean | DTableRenderable<ROW>;\r\n\r\n\tediting: DTableColumnEditing<ROW, CELL>;\r\n\tsorting: DTableColumnSorting<ROW>;\r\n\r\n\theader?: DTableHeaderCellOptions<ROW>;\r\n\tbody?: DTableBodyCellOptionsUnion<ROW>;\r\n\r\n\tselecting: DTableColumnSelecting<CELL, DIALOG_VALUE, DIALOG>;\r\n\r\n\tcategory?: string | string[];\r\n\tfrozen?: boolean;\r\n\toffset: number;\r\n\r\n\tlink?: DTableBodyCellLinkLinkOptions<ROW>;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject } from \"pixi.js\";\r\nimport { DBase, DBaseOptions } from \"./d-base\";\r\nimport { Closeable, DMenuContext } from \"./d-menu-context\";\r\nimport { DMenuItemOptionsUnion } from \"./d-menu-item-options-union\";\r\nimport { DMenuSidedContent, DMenuSidedContentOptions } from \"./d-menu-sided-content\";\r\nimport { DMenuSidedSelection, DMenuSidedSelectionOptions } from \"./d-menu-sided-selection\";\r\nimport { DMenuSideds } from \"./d-menu-sideds\";\r\nimport { DPane, DPaneOptions, DThemePane } from \"./d-pane\";\r\n\r\nexport interface DMenuSidedOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuSided = DThemeMenuSided,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DMenuSidedContentOptions\r\n> extends DPaneOptions<THEME, CONTENT_OPTIONS> {\r\n\titems?: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>;\r\n\tsticky?: boolean;\r\n\tselection?: DMenuSidedSelectionOptions | DMenuSidedSelection;\r\n}\r\n\r\nexport interface DThemeMenuSided extends DThemePane {\r\n\r\n}\r\n\r\nexport class DMenuSided<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeMenuSided = DThemeMenuSided,\r\n\tCONTENT_OPTIONS extends DMenuSidedContentOptions = DMenuSidedContentOptions,\r\n\tOPTIONS extends DMenuSidedOptions<VALUE, THEME, CONTENT_OPTIONS> = DMenuSidedOptions<VALUE, THEME, CONTENT_OPTIONS>\r\n> extends DPane<THEME, CONTENT_OPTIONS, OPTIONS> {\r\n\tprotected _context!: DMenuContext | null;\r\n\tprotected _selection!: DMenuSidedSelection;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tconst context = new DMenuContext( this );\r\n\t\tthis._context = context;\r\n\t\tcontext.add( this );\r\n\r\n\t\tconst items = options && options.items;\r\n\t\tif( items != null ) {\r\n\t\t\tconst sticky = ( options && options.sticky != null ? options.sticky : false );\r\n\t\t\tthis.newItems( items, sticky );\r\n\t\t}\r\n\r\n\t\tconst selection = options && options.selection;\r\n\t\tthis._selection = ( selection instanceof DMenuSidedSelection ?\r\n\t\t\tselection : this.newSelection( selection ) );\r\n\t}\r\n\r\n\tprotected newSelection( options?: DMenuSidedSelectionOptions ): DMenuSidedSelection {\r\n\t\treturn new DMenuSidedSelection( this._content, options );\r\n\t}\r\n\r\n\tprotected onChildrenDirty(): void {\r\n\t\tconst selection = this._selection;\r\n\t\tif( selection != null ) {\r\n\t\t\tselection.toDirty();\r\n\t\t}\r\n\t\tsuper.onChildrenDirty();\r\n\t}\r\n\r\n\tprotected newItems( items: Array<DMenuItemOptionsUnion<VALUE> | DisplayObject>, sticky: boolean ): void {\r\n\t\tDMenuSideds.newItems( this.content, items, sticky );\r\n\t}\r\n\r\n\tprotected newContent( options?: CONTENT_OPTIONS ): DBase {\r\n\t\treturn new DMenuSidedContent( options );\r\n\t}\r\n\r\n\tget selection(): DMenuSidedSelection {\r\n\t\treturn this._selection;\r\n\t}\r\n\r\n\tgetContext(): DMenuContext | null {\r\n\t\treturn this._context;\r\n\t}\r\n\r\n\tgetCloseable(): Closeable | null {\r\n\t\treturn this;\r\n\t}\r\n\r\n\topen(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tclose(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DMenuSided\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\n\r\nexport interface DNotificationOptions<THEME extends DThemeNotification> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeNotification extends DThemeBase {\r\n\r\n}\r\n\r\nexport class DNotification<\r\n\tTHEME extends DThemeNotification = DThemeNotification,\r\n\tOPTIONS extends DNotificationOptions<THEME> = DNotificationOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\r\n\r\nexport interface DPaginationDotsButtonOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePaginationDotsButton = DThemePaginationDotsButton\r\n> extends DButtonAmbientOptions<VALUE, THEME> {\r\n}\r\n\r\nexport interface DThemePaginationDotsButton extends DThemeButtonAmbient {\r\n\r\n}\r\n\r\nexport class DPaginationDotsButton<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePaginationDotsButton = DThemePaginationDotsButton,\r\n\tOPTIONS extends DPaginationDotsButtonOptions<VALUE, THEME> = DPaginationDotsButtonOptions<VALUE, THEME>\r\n> extends DButtonAmbient<VALUE, THEME, OPTIONS> {\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPaginationDotsButton\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton } from \"./d-button\";\r\nimport { DLayoutHorizontal, DLayoutHorizontalOptions, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DPaginationDotsButton } from \"./d-pagination-dots-button\";\r\n\r\nexport interface DPaginationDynamicButtonsOptions<\r\n\tTHEME extends DThemePaginationDynamicButtons> extends DLayoutHorizontalOptions<THEME> {\r\n\t\tstart?: number;\r\n\t\tend?: number;\r\n\t\tselected?: number;\r\n\t\tbutton: {\r\n\t\t\twidth: number,\r\n\t\t\tdotsLeft?: boolean,\r\n\t\t\tdotsRight?: boolean\r\n\t\t};\r\n}\r\n\r\nexport interface DThemePaginationDynamicButtons extends DThemeLayoutHorizontal {\r\n}\r\n\r\nexport class DPaginationDynamicButtons<\r\n\tTHEME extends DThemePaginationDynamicButtons = DThemePaginationDynamicButtons,\r\n\tOPTIONS extends DPaginationDynamicButtonsOptions<THEME> = DPaginationDynamicButtonsOptions<THEME>\r\n> extends DLayoutHorizontal<THEME, OPTIONS> {\r\n\tprotected _dotsBtnLeft!: DPaginationDotsButton;\r\n\tprotected _dotsBtnRight!: DPaginationDotsButton;\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis._dotsBtnLeft = new DPaginationDotsButton({\r\n\t\t\twidth: options.button.width,\r\n\t\t\tvisible: !!options.button.dotsLeft\r\n\t\t});\r\n\t\tthis._dotsBtnRight = new DPaginationDotsButton({\r\n\t\t\twidth: options.button.width,\r\n\t\t\tvisible: !!options.button.dotsRight\r\n\t\t});\r\n\t\tthis.addChild( this._dotsBtnLeft );\r\n\t\tthis.addChild( this._dotsBtnRight );\r\n\t}\r\n\r\n\tpublic update( options: DPaginationDynamicButtonsOptions<THEME> ) {\r\n\t\tif( options.start == null || options.end == null ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst btnsCount = options.end - options.start + 1 > 0 ? options.end - options.start + 1 : 0;\r\n\t\tlet pageButtons = ( this.children as DButton[] ).slice( 1, this.children.length - 1 );\r\n\t\tif( pageButtons.length < btnsCount ) {\r\n\t\t\tfor ( let i = pageButtons.length; i < btnsCount; i++ ) {\r\n\t\t\t\tconst btn = new DButton({\r\n\t\t\t\t\twidth: options.button.width\r\n\t\t\t\t});\r\n\t\t\t\tthis.addChildAt( btn, this.children.length - 1 );\r\n\t\t\t\tbtn.on( \"active\", ( clickedBtn: DButton ) => {\r\n\t\t\t\t\tthis.emit( \"active\", clickedBtn );\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// re-new \"pageButtons\" after add new buttons\r\n\t\t\tpageButtons = ( this.children as DButton[]).slice( 1, this.children.length - 1 );\r\n\r\n\t\t} else if( pageButtons.length > btnsCount ) {\r\n\t\t\tfor ( let i = btnsCount; i < pageButtons.length; i++ ) {\r\n\t\t\t\tpageButtons[ i ].hide();\r\n\t\t\t}\r\n\t\t}\r\n\t\t// update button text and active state\r\n\t\tfor ( let i = 0; i < btnsCount; i++ ) {\r\n\t\t\tconst btn = pageButtons[ i ];\r\n\t\t\tbtn.text = options.start + i + 1;\r\n\t\t\tbtn.setActive( options.start + i  === options.selected );\r\n\t\t\tif( btn.isHidden() ) {\r\n\t\t\t\tbtn.show();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// update visible state of dots buttons\r\n\t\tif( !!options.button.dotsLeft ) {\r\n\t\t\tthis._dotsBtnLeft.show();\r\n\t\t} else {\r\n\t\t\tthis._dotsBtnLeft.hide();\r\n\t\t}\r\n\t\tif( !!options.button.dotsRight ) {\r\n\t\t\tthis._dotsBtnRight.show();\r\n\t\t} else {\r\n\t\t\tthis._dotsBtnRight.hide();\r\n\t\t}\r\n\t}\r\n\tprotected getType(): string {\r\n\t\treturn \"DPaginationDynamicButtons\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonAmbient, DButtonAmbientOptions, DThemeButtonAmbient } from \"./d-button-ambient\";\r\n\r\nexport interface DPaginationNavigationButtonOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePaginationNavigationButton = DThemePaginationNavigationButton\r\n> extends DButtonAmbientOptions<VALUE, THEME> {\r\n}\r\n\r\nexport interface DThemePaginationNavigationButton extends DThemeButtonAmbient {\r\n\r\n}\r\n\r\nexport class DPaginationNavigationButton<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemePaginationNavigationButton = DThemePaginationNavigationButton,\r\n\tOPTIONS extends DPaginationNavigationButtonOptions<VALUE, THEME> = DPaginationNavigationButtonOptions<VALUE, THEME>\r\n> extends DButtonAmbient<VALUE, THEME, OPTIONS> {\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPaginationNavigationButton\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton } from \"./d-button\";\r\nimport { DLayoutHorizontal, DLayoutHorizontalOptions, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DPaginationDynamicButtons } from \"./d-pagination-dynamic-buttons\";\r\nimport { DPaginationNavigationButton } from \"./d-pagination-navigation-button\";\r\nimport { DThemes } from \"./theme\";\r\n\r\nexport interface DPaginationOptions<THEME extends DThemePagination> extends DLayoutHorizontalOptions<THEME> {\r\n\ttotal: number;\r\n\tselected?: number;\r\n\tbutton?: {\r\n\t\tfirst?: boolean;\r\n\t\tlast?: boolean;\r\n\t\twidth?: number;\r\n\t};\r\n}\r\n\r\nexport interface DThemePagination extends DThemeLayoutHorizontal {\r\n\tgetButtonWidth(): number;\r\n}\r\n\r\ninterface DPaginationButtonOption {\r\n\tfirst: boolean;\r\n\tlast: boolean;\r\n\twidth?: number;\r\n}\r\n\r\nexport class DPagination<\r\n\tTHEME extends DThemePagination = DThemePagination,\r\n\tOPTIONS extends DPaginationOptions<THEME> = DPaginationOptions<THEME>\r\n> extends DLayoutHorizontal<THEME, OPTIONS> {\r\n\tprotected _total!: number;\r\n\tprotected _selected!: number;\r\n\tprotected _buttonOptions!: DPaginationButtonOption;\r\n\tprotected _numberPageButtonVisible!: number;\r\n\tprotected DEFAULT_SELECTED!: number;\r\n\r\n\tprotected _firstPageBtn!: DButton;\r\n\tprotected _lastPageBtn!: DButton;\r\n\tprotected _dynamicPageBtns!: DPaginationDynamicButtons;\r\n\r\n\tprotected _previousBtn!: DPaginationNavigationButton;\r\n\tprotected _nextBtn!: DPaginationNavigationButton;\r\n\tprotected _goFirstBtn!: DPaginationNavigationButton;\r\n\tprotected _goLastBtn!: DPaginationNavigationButton;\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.DEFAULT_SELECTED = 0; // set default selected index page is page 0\r\n\t\t// get total pages\r\n\t\tthis._total = options.total;\r\n\t\t// get selected page\r\n\t\tthis._selected = options.selected ? options.selected : this.DEFAULT_SELECTED;\r\n\t\t// get button options\r\n\t\tthis._buttonOptions = {\r\n\t\t\tfirst: !! ( options.button && options.button.first ),\r\n\t\t\tlast: !! ( options.button && options.button.last ),\r\n\t\t\twidth: options.button && options.button.width\r\n\t\t};\r\n\r\n\t\tthis.initButtons( this.getButtonWidth() );\r\n\t\tthis.listenButtonClicked();\r\n\r\n\t\tthis.on( \"resize\",  (): void => {\r\n\t\t\tthis._numberPageButtonVisible = this.toNumberVisible();\r\n\t\t\tthis.update();\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Set selected page.\r\n\t *\r\n\t * @param selected page's index want to select.\r\n\t */\r\n\tset selected( selected: number ) {\r\n\t\tif( selected < 0 || selected >= this._total || !Number.isInteger( selected ) ) {\r\n\t\t\tselected = this.DEFAULT_SELECTED;\r\n\t\t}\r\n\t\tthis._selected = selected;\r\n\t\tthis.update();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get selected page.\r\n\t *\r\n\t * @returns index of selected page.\r\n\t */\r\n\tget selected() {\r\n\t\treturn this._selected;\r\n\t}\r\n\r\n\t/**\r\n\t * Set total page.\r\n\t *\r\n\t * @param total number of page want to present in pagination.\r\n\t */\r\n\tset total( total: number ) {\r\n\t\tif( total >= 0 && Number.isInteger( total ) ) {\r\n\t\t\tthis._total = total;\r\n\t\t\tthis._numberPageButtonVisible = this.toNumberVisible();\r\n\t\t\tthis.selected = this._selected;\r\n\t\t\tthis._lastPageBtn.text = this._total;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get total pages.\r\n\t *\r\n\t * @returns number of total pages.\r\n\t */\r\n\tget total() {\r\n\t\treturn this._total;\r\n\t}\r\n\r\n\tprotected initButtons( width: number ) {\r\n\t\tthis._previousBtn = new DPaginationNavigationButton({\r\n\t\t\twidth,\r\n\t\t\timage: {\r\n\t\t\t\tsource: DThemes.getInstance().getAtlas().mappings.pagination_navigation_button_previous\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._nextBtn = new DPaginationNavigationButton({\r\n\t\t\twidth,\r\n\t\t\timage: {\r\n\t\t\t\tsource: DThemes.getInstance().getAtlas().mappings.pagination_navigation_button_next\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._goFirstBtn = new DPaginationNavigationButton({\r\n\t\t\twidth,\r\n\t\t\timage: {\r\n\t\t\t\tsource: DThemes.getInstance().getAtlas().mappings.pagination_navigation_button_go_first\r\n\r\n\t\t\t},\r\n\t\t\tvisible: this._buttonOptions.first\r\n\t\t});\r\n\r\n\t\tthis._goLastBtn = new DPaginationNavigationButton({\r\n\t\t\twidth,\r\n\t\t\timage: {\r\n\t\t\t\tsource: DThemes.getInstance().getAtlas().mappings.pagination_navigation_button_go_last\r\n\r\n\t\t\t},\r\n\t\t\tvisible: this._buttonOptions.last\r\n\t\t});\r\n\r\n\t\tthis._dynamicPageBtns = new DPaginationDynamicButtons({\r\n\t\t\tbutton: {\r\n\t\t\t\twidth\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._firstPageBtn = new DButton({\r\n\t\t\twidth,\r\n\t\t\ttext: {\r\n\t\t\t\tvalue: 1\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._lastPageBtn = new DButton({\r\n\t\t\twidth,\r\n\t\t\ttext: {\r\n\t\t\t\tvalue: this._total\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.addChild( this._goFirstBtn );\r\n\t\tthis.addChild( this._previousBtn );\r\n\t\tthis.addChild( this._firstPageBtn );\r\n\t\tthis.addChild( this._dynamicPageBtns );\r\n\t\tthis.addChild( this._lastPageBtn );\r\n\t\tthis.addChild( this._nextBtn );\r\n\t\tthis.addChild( this._goLastBtn );\r\n\t}\r\n\r\n\tprotected listenButtonClicked() {\r\n\t\tthis._firstPageBtn.on( \"active\", ( btn: DButton ) => {\r\n\t\t\tthis.onClickPageButton( btn );\r\n\t\t});\r\n\t\tthis._lastPageBtn.on( \"active\", ( btn: DButton ) => {\r\n\t\t\tthis.onClickPageButton( btn );\r\n\t\t});\r\n\t\tthis._dynamicPageBtns.on( \"active\", ( btn: DButton ) => {\r\n\t\t\tthis.onClickPageButton( btn );\r\n\t\t});\r\n\t\tthis._goFirstBtn.on( \"active\", (btn: DButton) => {\r\n\t\t\tthis.selected = this.DEFAULT_SELECTED;\r\n\t\t});\r\n\t\tthis._goLastBtn.on( \"active\", (btn: DButton) => {\r\n\t\t\tthis.selected = this._total - 1;\r\n\t\t});\r\n\t\tthis._nextBtn.on( \"active\", (btn: DButton) => {\r\n\t\t\tif( this.selected !== this._total + 1 ) {\r\n\t\t\t\tthis.selected = this._selected + 1;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._previousBtn.on( \"active\", (btn: DButton) => {\r\n\t\t\tif( this._selected !== 0 ) {\r\n\t\t\t\tthis.selected = this._selected - 1;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected update() {\r\n\t\tlet startDynamic: number;\r\n\t\tlet endDynamic: number;\r\n\t\tlet dotsLeft: boolean;\r\n\t\tlet dotsRight: boolean;\r\n\t\tlet numberButtonsInLeft = 0;\r\n\t\tlet numberButtonsInRight = 0;\r\n\r\n\t\tthis.updateStaticButtons();\r\n\t\t// Number displayed buttons from first button to selected button when select center button of all buttons.\r\n\t\t// Not including selected button.\r\n\t\tconst numberButtonsFirstToCenter = Math.ceil( ( this._numberPageButtonVisible  - 1 ) * 0.5 );\r\n\t\tconst numberButtonsCenterToEnd = Math.floor( ( this._numberPageButtonVisible  - 1 ) * 0.5 );\r\n\r\n\t\tif( this._selected < numberButtonsFirstToCenter ) {\r\n\t\t\tnumberButtonsInLeft =  this._selected;\r\n\t\t\tnumberButtonsInRight = this._numberPageButtonVisible - numberButtonsInLeft - 1;\r\n\t\t} else if ( this._selected + numberButtonsCenterToEnd > this._total - 1 ) {\r\n\t\t\tnumberButtonsInRight = ( this._total - 1 ) - this.selected;\r\n\t\t\tnumberButtonsInLeft = this._numberPageButtonVisible - numberButtonsInRight - 1;\r\n\t\t} else {\r\n\t\t\tnumberButtonsInLeft = numberButtonsFirstToCenter;\r\n\t\t\tnumberButtonsInRight = numberButtonsCenterToEnd;\r\n\t\t}\r\n\r\n\t\tif( this._selected <= numberButtonsInLeft ) {\r\n\t\t\tstartDynamic  = 1;\r\n\t\t\tdotsLeft = false;\r\n\t\t} else {\r\n\t\t\tstartDynamic = this._selected - numberButtonsInLeft + 2;\r\n\t\t\tdotsLeft = true;\r\n\t\t}\r\n\r\n\t\tif( this._selected + numberButtonsInRight >= this._total - 1 ) {\r\n\t\t\tendDynamic = this._total - 2;\r\n\t\t\tdotsRight = false;\r\n\t\t} else {\r\n\t\t\tendDynamic = this._selected + numberButtonsInRight - 2;\r\n\t\t\tdotsRight = true;\r\n\t\t}\r\n\r\n\t\tthis._dynamicPageBtns.update({\r\n\t\t\tstart: startDynamic,\r\n\t\t\tend: endDynamic,\r\n\t\t\tselected: this._selected,\r\n\t\t\tbutton: {\r\n\t\t\t\twidth: this.getButtonWidth(),\r\n\t\t\t\tdotsLeft,\r\n\t\t\t\tdotsRight\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected updateStaticButtons() {\r\n\t\tif( this._total > 0 ) {\r\n\t\t\tthis._firstPageBtn.show();\r\n\t\t} else {\r\n\t\t\tthis._firstPageBtn.hide();\r\n\t\t}\r\n\t\tif( this._total > 1 ) {\r\n\t\t\tthis._lastPageBtn.show();\r\n\t\t} else {\r\n\t\t\tthis._lastPageBtn.hide();\r\n\t\t}\r\n\t\tconst isFirst = this._selected === this.DEFAULT_SELECTED;\r\n\t\tconst isLast = this._selected === this._total - 1 || this._total === 0;\r\n\t\tthis._firstPageBtn.setActive( isFirst );\r\n\t\tthis._lastPageBtn.setActive( isLast );\r\n\t\tthis._goFirstBtn.setDisabled( isFirst );\r\n\t\tthis._previousBtn.setDisabled( isFirst );\r\n\t\tthis._nextBtn.setDisabled( isLast );\r\n\t\tthis._goLastBtn.setDisabled( isLast );\r\n\t}\r\n\r\n\tprotected getButtonWidth() {\r\n\t\treturn this._buttonOptions.width ? this._buttonOptions.width : this.theme.getButtonWidth();\r\n\t}\r\n\r\n\tprotected toNumberVisible() {\r\n\t\tlet numberNavigationBtn = 2; // 2 buttons always displayed are \"next\" and \"previous\" button\r\n\t\tif( this._buttonOptions.first ) {\r\n\t\t\tnumberNavigationBtn++;\r\n\t\t}\r\n\t\tif( this._buttonOptions.last ) {\r\n\t\t\tnumberNavigationBtn++;\r\n\t\t}\r\n\t\tconst widthOfNavigationBtns = numberNavigationBtn * ( this.getButtonWidth() + this._margin.horizontal * 2 );\r\n\t\tconst widthOfPageBtns = this.width -  widthOfNavigationBtns;\r\n\t\tconst numberVisible = Math.floor( widthOfPageBtns / ( this.getButtonWidth() + this._margin.horizontal * 2 ) );\r\n\t\t/* set numberVisible is 5, if it less than 5\r\n\t\t\t If total pages less than numberVisible, set numberVisible equal total pages\r\n\t\t**/\r\n\t\treturn Math.min( this._total, Math.max( numberVisible, 5 ) );\r\n\t}\r\n\r\n\tprotected onClickPageButton( btn: DButton ) {\r\n\t\tconst btnIndex = Number( btn.text ) - 1;\r\n\t\tif( this._selected !== btnIndex ) {\r\n\t\t\tthis._selected = btnIndex;\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DPagination\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\n\r\nexport interface DPickerDatetimeRangeOptions<THEME extends DThemePickerDatetimeRange> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerDatetimeRange extends DThemeBase {\r\n\r\n}\r\n\r\nexport class DPickerDatetimeRange<\r\n\tTHEME extends DThemePickerDatetimeRange = DThemePickerDatetimeRange,\r\n\tOPTIONS extends DPickerDatetimeRangeOptions<THEME> = DPickerDatetimeRangeOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\n\r\nexport interface DPickerTimeRangeOptions<THEME extends DThemePickerTimeRange> extends DBaseOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemePickerTimeRange extends DThemeBase {\r\n\r\n}\r\n\r\nexport class DPickerTimeRange<\r\n\tTHEME extends DThemePickerTimeRange = DThemePickerTimeRange,\r\n\tOPTIONS extends DPickerTimeRangeOptions<THEME> = DPickerTimeRangeOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDropdownBase, DDropdownBaseOnOptions, DDropdownBaseOptions, DThemeDropdownBase } from \"./d-dropdown-base\";\r\nimport { DMenu } from \"./d-menu\";\r\nimport { DMenuItem } from \"./d-menu-item\";\r\nimport { DMenuItemCheck } from \"./d-menu-item-check\";\r\nimport { DMenuItemMenu } from \"./d-menu-item-menu\";\r\n\r\n/**\r\n * Mappings of event names and handlers.\r\n */\r\nexport interface DSelectMultipleOnOptions<VALUE> extends DDropdownBaseOnOptions<VALUE, DMenuItem<VALUE> | null> {\r\n\t/**\r\n\t * Called when a menu item is selected.\r\n\t *\r\n\t * @param value a value of a selected menu item\r\n\t * @param item a selected menu item\r\n\t * @param self an event emitter\r\n\t */\r\n\tmenuselect?: ( value: VALUE, item: DMenuItem<VALUE>, self: any ) => void;\r\n\r\n\t/**\r\n\t * Called when the selection is changed.\r\n\t *\r\n\t * @param newValues new selected values\r\n\t * @param oldValues old selected values\r\n\t * @param items selected items\r\n\t * @param self an event emitter\r\n\t */\r\n\tchange?: ( newValues: VALUE[], oldValues: VALUE[], items: Array<DMenuItem<VALUE>>, self: any ) => void;\r\n}\r\n\r\n/**\r\n * DSelect options.\r\n */\r\nexport interface DSelectMultipleOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSelectMultiple = DThemeSelectMultiple\r\n> extends DDropdownBaseOptions<VALUE, Array<DMenuItem<VALUE>>, THEME> {\r\n\t/**\r\n\t * A default values.\r\n\t */\r\n\tvalues?: VALUE[];\r\n\r\n\ton?: DSelectMultipleOnOptions<VALUE>;\r\n}\r\n\r\nexport interface DThemeSelectMultiple extends DThemeDropdownBase<Array<DMenuItem<any>>> {\r\n\r\n}\r\n\r\nexport class DSelectMultiple<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSelectMultiple = DThemeSelectMultiple,\r\n\tOPTIONS extends DSelectMultipleOptions<VALUE, THEME> = DSelectMultipleOptions<VALUE, THEME>\r\n> extends DDropdownBase<VALUE, Array<DMenuItem<VALUE>>, THEME, OPTIONS> {\r\n\tprotected _values!: VALUE[];\r\n\tprotected _onSelectedBound!: ( value: VALUE, child: DMenuItem<VALUE> ) => void;\r\n\tprotected _onClosedBound!: () => void;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._onSelectedBound = ( value: VALUE, child: DMenuItem<VALUE> ): void => {\r\n\t\t\tif( child instanceof DMenuItemCheck ) {\r\n\t\t\t\tconst oldValues = this._values;\r\n\t\t\t\tconst newValues: VALUE[] = [];\r\n\t\t\t\tconst newItems: Array<DMenuItem<VALUE>> = [];\r\n\t\t\t\tconst menu = this.menu;\r\n\t\t\t\tif( child.isActive() ) {\r\n\t\t\t\t\tthis.updateMenuItems( menu, oldValues, value, undefined, newValues, newItems );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.updateMenuItems( menu, oldValues, undefined, value, newValues, newItems );\r\n\t\t\t\t}\r\n\t\t\t\tthis._values = newValues;\r\n\t\t\t\tthis.onSelected( newValues, oldValues, newItems, true );\r\n\t\t\t} else {\r\n\t\t\t\tthis.emit( \"menuselect\", value, child, this );\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis._onClosedBound = (): void => {\r\n\t\t\tthis.onClosed();\r\n\t\t};\r\n\r\n\t\t// Default value\r\n\t\tthis._values = [];\r\n\t\tif( options && options.values !== undefined ) {\r\n\t\t\tthis.values = options.values;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onSelected( newValues: VALUE[], oldValues: VALUE[], items: Array<DMenuItem<VALUE>>, emit: boolean ): void {\r\n\t\t// Chante texts\r\n\t\tthis.text = items;\r\n\r\n\t\t// Event\r\n\t\tif( emit ) {\r\n\t\t\tthis.emit( \"change\", newValues, oldValues, items, this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onClosed(): void {\r\n\t\tconst menu = this.menu;\r\n\t\tmenu.off( \"select\", this._onSelectedBound );\r\n\t\tmenu.off( \"close\", this._onClosedBound );\r\n\t}\r\n\r\n\tstart(): void {\r\n\t\tconst menu = this.menu;\r\n\t\tmenu.on( \"select\", this._onSelectedBound );\r\n\t\tmenu.on( \"close\", this._onClosedBound );\r\n\t\tthis.updateMenuItems( menu, this._values );\r\n\t\tsuper.start();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a selected value or null.\r\n\t */\r\n\tget values(): VALUE[] {\r\n\t\treturn this._values;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets to the specified value.\r\n\t */\r\n\tset values( values: VALUE[] ) {\r\n\t\tconst oldValues = this._values;\r\n\t\tif( ! this.isSameValues( values, oldValues ) ) {\r\n\t\t\tconst newValues: VALUE[] = [];\r\n\t\t\tconst newItems: Array<DMenuItem<VALUE>> = [];\r\n\t\t\tthis.updateMenuItems( this.menu, values, undefined, undefined, newValues, newItems );\r\n\t\t\tthis._values = newValues;\r\n\t\t\tthis.onSelected( newValues, oldValues, newItems, false );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected isSameValues( a: VALUE[], b: VALUE[] ): boolean {\r\n\t\tif( a.length === b.length ) {\r\n\t\t\tfor( let i = 0, imax = a.length; i < imax; ++i ) {\r\n\t\t\t\tif( b.indexOf( a[ i ] ) < 0 ) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected updateMenuItems(\r\n\t\tmenu: DMenu<VALUE>,\r\n\t\toldValues: VALUE[],\r\n\t\taddedValue?: VALUE,\r\n\t\tremovedValue?: VALUE,\r\n\t\tnewValues?: VALUE[],\r\n\t\tnewItems?: Array<DMenuItem<VALUE>>\r\n\t): void {\r\n\t\tconst children = menu.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof DMenuItemMenu ) {\r\n\t\t\t\tthis.updateMenuItems( child.menu, oldValues, addedValue, removedValue, newValues, newItems );\r\n\t\t\t} else if( child instanceof DMenuItemCheck ) {\r\n\t\t\t\tconst childValue = child.value;\r\n\t\t\t\tif( removedValue !== undefined && removedValue === childValue ) {\r\n\t\t\t\t\tchild.setActive( false );\r\n\t\t\t\t} else if( ( addedValue !== undefined && child.value === addedValue ) || 0 <= oldValues.indexOf( child.value ) ) {\r\n\t\t\t\t\tif( newValues ) {\r\n\t\t\t\t\t\tnewValues.push( child.value );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif( newItems ) {\r\n\t\t\t\t\t\tnewItems.push( child );\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchild.setActive( true );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchild.setActive( false );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DSelectMultiple\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DDropdownBase, DDropdownBaseOnOptions, DDropdownBaseOptions, DThemeDropdownBase } from \"./d-dropdown-base\";\r\nimport { DMenu } from \"./d-menu\";\r\nimport { DMenuItem } from \"./d-menu-item\";\r\nimport { DMenuItemMenu } from \"./d-menu-item-menu\";\r\n\r\nexport interface DSelectOnOptions<VALUE> extends DDropdownBaseOnOptions<VALUE, DMenuItem<VALUE> | null> {\r\n\t/**\r\n\t * Called when a selection is changed.\r\n\t */\r\n\tchange?: ( newValue: VALUE | null, oldValue: VALUE | null, item: DMenuItem<VALUE> | null, self: any ) => void;\r\n}\r\n\r\n/**\r\n * DSelect options.\r\n */\r\nexport interface DSelectOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSelect = DThemeSelect\r\n> extends DDropdownBaseOptions<VALUE, DMenuItem<VALUE> | null, THEME> {\r\n\t/**\r\n\t * A default value.\r\n\t */\r\n\tvalue?: VALUE;\r\n\r\n\ton?: DSelectOnOptions<VALUE>;\r\n}\r\n\r\nexport interface DThemeSelect extends DThemeDropdownBase<DMenuItem<any> | null> {\r\n\r\n}\r\n\r\nexport class DSelect<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSelect = DThemeSelect,\r\n\tOPTIONS extends DSelectOptions<VALUE, THEME> = DSelectOptions<VALUE, THEME>\r\n> extends DDropdownBase<VALUE, DMenuItem<VALUE> | null, THEME, OPTIONS> {\r\n\tprotected _value!: VALUE | null;\r\n\tprotected _onSelectedBound!: ( value: VALUE, child: DMenuItem<VALUE> ) => void;\r\n\tprotected _onClosedBound!: () => void;\r\n\r\n\tconstructor( options?: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._onSelectedBound = ( value: VALUE, child: DMenuItem<VALUE> ): void => {\r\n\t\t\tthis.onSelected( value, child, true );\r\n\t\t};\r\n\t\tthis._onClosedBound = (): void => {\r\n\t\t\tthis.onClosed();\r\n\t\t};\r\n\r\n\t\t// Default value\r\n\t\tthis._value = null;\r\n\t\tif( options && options.value !== undefined ) {\r\n\t\t\tthis.value = options.value;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onSelected( newValue: VALUE | null, item: DMenuItem<VALUE> | null, emit: boolean ): void {\r\n\t\tif( this._value !== newValue ) {\r\n\t\t\t// Value\r\n\t\t\tconst oldValue = this._value;\r\n\t\t\tthis._value = newValue;\r\n\r\n\t\t\t// Text\r\n\t\t\tthis.text = item;\r\n\r\n\t\t\t// Event\r\n\t\t\tif( emit ) {\r\n\t\t\t\tthis.emit( \"change\", newValue, oldValue, item,  this );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onClosed(): void {\r\n\t\tconst menu = this.menu;\r\n\t\tmenu.off( \"select\", this._onSelectedBound );\r\n\t\tmenu.off( \"close\", this._onClosedBound );\r\n\t}\r\n\r\n\tstart(): void {\r\n\t\tconst menu = this.menu;\r\n\t\tmenu.on( \"select\", this._onSelectedBound );\r\n\t\tmenu.on( \"close\", this._onClosedBound );\r\n\t\tsuper.start();\r\n\t}\r\n\r\n\tprotected findMenuItem( menu: DMenu<VALUE>, value: VALUE | null ): DMenuItem<VALUE> | null {\r\n\t\tconst children = menu.children;\r\n\t\tfor( let i = 0, imax = children.length; i < imax; ++i ) {\r\n\t\t\tconst child = children[ i ];\r\n\t\t\tif( child instanceof DMenuItemMenu ) {\r\n\t\t\t\tconst result = this.findMenuItem( child.menu, value );\r\n\t\t\t\tif( result != null ) {\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t} else if( child instanceof DMenuItem ) {\r\n\t\t\t\tif( child.value === value ) {\r\n\t\t\t\t\treturn child;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a selected value or null.\r\n\t */\r\n\tget value(): VALUE | null {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets to the specified value.\r\n\t */\r\n\tset value( value: VALUE | null ) {\r\n\t\tconst item = this.findMenuItem( this.menu, value );\r\n\t\tif( item != null ) {\r\n\t\t\tthis.onSelected( value, item, false );\r\n\t\t} else {\r\n\t\t\tthis.onSelected( null, null, false );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DSelect\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { NineSlicePlane, Texture } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DShadow } from \"./d-shadow\";\r\n\r\nexport class DShadowImpl extends NineSlicePlane implements DShadow {\r\n\tprotected _offsetX: number;\r\n\tprotected _offsetY: number;\r\n\tprotected _shiftX: number;\r\n\tprotected _shiftY: number;\r\n\r\n\tconstructor( texture: Texture, width: number, height: number, offsetX: number, offsetY: number ) {\r\n\t\tsuper( texture, width, height, width, height );\r\n\r\n\t\tthis._offsetX = offsetX;\r\n\t\tthis._offsetY = offsetY;\r\n\t\tthis._shiftX = width * 0.5;\r\n\t\tthis._shiftY = height * 0.5;\r\n\r\n\t\tthis.interactive = false;\r\n\t\tthis.interactiveChildren = false;\r\n\r\n\t\ttexture.on( \"update\", (): void => {\r\n\t\t\tthis.onTextureUpdate();\r\n\t\t});\r\n\t}\r\n\r\n\tprotected onTextureUpdate(): void {\r\n\t\tthis.emit( \"update\", this );\r\n\t}\r\n\r\n\tonReflow( base: DBase, width: number, height: number ): void {\r\n\t\tconst sx = this._shiftX;\r\n\t\tconst sy = this._shiftY;\r\n\t\tthis.x = -sx + this._offsetX;\r\n\t\tthis.y = -sy + this._offsetY;\r\n\t\tthis.width = sx + width + sx;\r\n\t\tthis.height = sy + height + sy;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DTextBase, DTextBaseOptions, DThemeTextBase } from \"./d-text-base\";\r\n\r\nexport interface DSliderLabelOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderLabel = DThemeSliderLabel\r\n> extends DTextBaseOptions<VALUE, THEME> {\r\n\tvalue?: number;\r\n}\r\n\r\nexport interface DThemeSliderLabel extends DThemeTextBase {\r\n\r\n}\r\n\r\nexport class DSliderLabel<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderLabel = DThemeSliderLabel,\r\n\tOPTIONS extends DSliderLabelOptions<VALUE, THEME> = DSliderLabelOptions<VALUE, THEME>\r\n> extends DTextBase<VALUE, THEME, OPTIONS> {\r\n\tprotected _value!: number;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\r\n\t\tthis._value = options && options.value || 0;\r\n\t}\r\n\r\n\tset value( value: number ) {\r\n\t\tthis._value = value;\r\n\t}\r\n\r\n\tget value(): number {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DSliderLabel\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\n\r\nexport interface DSliderThumbOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderThumb = DThemeSliderThumb\r\n> extends DButtonOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeSliderThumb extends DThemeButton {\r\n\r\n}\r\n\r\nexport class DSliderThumb<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderThumb = DThemeSliderThumb,\r\n\tOPTIONS extends DSliderThumbOptions<VALUE, THEME> = DSliderThumbOptions<VALUE, THEME>\r\n> extends DButton<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DSliderThumb\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DTextBase, DTextBaseOptions, DThemeTextBase } from \"./d-text-base\";\r\n\r\nexport interface DSliderValueOptions<\r\n\tVALUE = number,\r\n\tTHEME extends DThemeSliderValue = DThemeSliderValue\r\n\t> extends DTextBaseOptions<VALUE, THEME> {\r\n\tvalue?: number;\r\n\tprecision?: number;\r\n\trounder?: ( value: number ) => number;\r\n}\r\n\r\nexport interface DThemeSliderValue extends DThemeTextBase {\r\n\tgetPrecision(): number;\r\n}\r\n\r\nexport class DSliderValue<\r\n\tVALUE = number,\r\n\tTHEME extends DThemeSliderValue = DThemeSliderValue,\r\n\tOPTIONS extends DSliderValueOptions<VALUE, THEME> = DSliderValueOptions<VALUE, THEME>\r\n\t> extends DTextBase<VALUE, THEME, OPTIONS> {\r\n\tprotected _value!: number;\r\n\tprotected _rounder!: ( value: number ) => number;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\r\n\t\tsuper.init( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\r\n\t\tthis._value = options && options.value || 0;\r\n\t\tthis._rounder = this.toRounder( options );\r\n\t}\r\n\r\n\ttoRounder( options?: OPTIONS ) {\r\n\t\tconst rounder = options && options.rounder;\r\n\t\tif ( rounder ) {\r\n\t\t\treturn rounder;\r\n\t\t}\r\n\r\n\t\tconst precision = ( options && options.precision ) ? options.precision : this.theme.getPrecision();\r\n\t\treturn ( value: number ) => {\r\n\t\t\tconst base = Math.pow( 10, precision );\r\n\t\t\treturn Math.round( value * base ) / base;\r\n\t\t};\r\n\t}\r\n\r\n\tset value( value: number ) {\r\n\t\tthis._value = value;\r\n\t}\r\n\r\n\tget value(): number {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\tget rounder(): ( value: number ) => number {\r\n\t\treturn this._rounder;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DSliderValue\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point } from \"pixi.js\";\r\nimport { DApplications } from \"./d-applications\";\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DSliderLabel, DSliderLabelOptions } from \"./d-slider-label\";\r\nimport { DSliderThumb, DSliderThumbOptions } from \"./d-slider-thumb\";\r\nimport { DSliderTrack, DSliderTrackOptions } from \"./d-slider-track\";\r\nimport { DSliderValue, DSliderValueOptions } from \"./d-slider-value\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport InteractionManager = interaction.InteractionManager;\r\n\r\nexport interface DSliderOptions<THEME extends DThemeSlider> extends DBaseOptions<THEME> {\r\n\tmin?: DSliderLabelOptions;\r\n\tmax?: DSliderLabelOptions;\r\n\tvalue?: DSliderValueOptions;\r\n\ttrack?: DSliderTrackOptions;\r\n\tthumb?: DSliderThumbOptions;\r\n}\r\n\r\nexport interface DThemeSlider extends DThemeBase {\r\n\r\n}\r\n\r\nexport abstract class DSlider<\r\n\tTHEME extends DThemeSlider = DThemeSlider,\r\n\tOPTIONS extends DSliderOptions<THEME> = DSliderOptions<THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected _track!: DSliderTrack;\r\n\tprotected _thumb!: DSliderThumb;\r\n\tprotected _trackSelected!: DSliderTrack;\r\n\tprotected _value!: DSliderValue;\r\n\tprotected _roundNumber!: number;\r\n\tprotected _offset!: number;\r\n\tprotected _yOffset!: number;\r\n\tprotected _ratioValue!: number;\r\n\tprotected _min!: DSliderLabel;\r\n\tprotected _max!: DSliderLabel;\r\n\tprotected _onThumbMoveBound!: ( e: InteractionEvent ) => void;\r\n\tprotected _onThumbUpBound!: ( e: InteractionEvent ) => void;\r\n\tprotected _onTrackUpBound!: ( e: InteractionEvent ) => void;\r\n\tprotected _onTrackSelectedUpBound!: ( e: InteractionEvent ) => void;\r\n\tprotected _interactionManager?: InteractionManager;\r\n\r\n\tprotected init( options?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._ratioValue = 0;\r\n\r\n\t\tthis._track = this.newTrack( options );\r\n\t\tthis.addChild( this._track );\r\n\t\tthis._trackSelected = this.newTrackSelected( options );\r\n\t\tthis._trackSelected.setActive( true );\r\n\t\tthis.addChild( this._trackSelected );\r\n\t\tthis._thumb = this.newThumb( options );\r\n\t\tthis.addChild( this._thumb );\r\n\t\tthis._min = this.newLabelMin( options );\r\n\t\tthis.addChild( this._min );\r\n\t\tthis._max = this.newLabelMax( options );\r\n\t\tthis.addChild( this._max );\r\n\t\tthis._value = this.newValue( options );\r\n\t\tthis.addChild( this._value );\r\n\r\n\t\t// Event listeners\r\n\t\tthis._track.on( UtilPointerEvent.down, ( e: InteractionEvent) => {\r\n\t\t\tthis._value.visible = true && !this.isDisabled();\r\n\t\t\tthis.onTrackDown( e.data.global );\r\n\t\t});\r\n\r\n\t\tthis._trackSelected.on( UtilPointerEvent.down, ( e: InteractionEvent) => {\r\n\t\t\tthis._value.visible = true && !this.isDisabled();\r\n\t\t\tthis.onTrackSelectedDown( e.data.global );\r\n\t\t});\r\n\r\n\t\tthis._onTrackUpBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onTrackUpBound( e );\r\n\t\t\tthis._value.visible = false;\r\n\t\t};\r\n\r\n\t\tthis._onTrackSelectedUpBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onTrackSelectedUpBound( e );\r\n\t\t\tthis._value.visible = false;\r\n\t\t};\r\n\r\n\t\tthis._thumb.on( UtilPointerEvent.down, ( e: InteractionEvent ) => {\r\n\t\t\tthis._value.visible = true;\r\n\t\t\tthis.onThumbDown( e );\r\n\t\t});\r\n\r\n\t\tthis._onThumbMoveBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onThumbMove( e );\r\n\t\t};\r\n\r\n\t\tthis._onThumbUpBound = ( e: InteractionEvent ): void => {\r\n\t\t\tthis.onThumbUp( e );\r\n\t\t\tthis._value.visible = false;\r\n\t\t};\r\n\r\n\t\t//\r\n\t\tthis.onValuesChanged();\r\n\t}\r\n\r\n\tprotected newThumb( options?: OPTIONS ): DSliderThumb {\r\n\t\treturn new DSliderThumb( options && options.thumb );\r\n\t}\r\n\r\n\tprotected newValue( options?: OPTIONS ): DSliderValue {\r\n\t\treturn new DSliderValue( this.toValueOptions( options && options.value ) );\r\n\t}\r\n\r\n\tprotected toValueOptions( options?: DSliderValueOptions ): DSliderValueOptions {\r\n\t\toptions = options || {};\r\n\t\tif( options.value == null ) {\r\n\t\t\toptions.value = 0;\r\n\t\t}\r\n\t\tconst text = options.text = options.text || {};\r\n\t\tif( text.value == null ) {\r\n\t\t\ttext.value = options.value;\r\n\t\t}\r\n\t\tif( options.visible == null ) {\r\n\t\t\toptions.visible = false;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected newLabelMin( options?: OPTIONS ): DSliderLabel {\r\n\t\treturn new DSliderLabel( this.toLabelMinOptions( options && options.min ) );\r\n\t}\r\n\r\n\tprotected toLabelMinOptions( options?: DSliderLabelOptions ): DSliderLabelOptions {\r\n\t\toptions = options || {};\r\n\t\tif( options.value == null ) {\r\n\t\t\toptions.value = 0;\r\n\t\t}\r\n\t\tconst text = options.text = options.text || {};\r\n\t\tif( text.value == null ) {\r\n\t\t\ttext.value = `${options.value}`;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected newLabelMax( options?: OPTIONS ): DSliderLabel {\r\n\t\treturn new DSliderLabel( this.toLabelMaxOptions( options && options.max ) );\r\n\t}\r\n\r\n\tprotected toLabelMaxOptions( options?: DSliderLabelOptions ): DSliderLabelOptions {\r\n\t\toptions = options || {};\r\n\t\tif( options.value == null ) {\r\n\t\t\toptions.value = 1;\r\n\t\t}\r\n\t\tconst text = options.text = options.text || {};\r\n\t\tif( text.value == null ) {\r\n\t\t\ttext.value = `${options.value}`;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected abstract newTrack( options?: OPTIONS ): DSliderTrack;\r\n\tprotected abstract newTrackSelected( options?: OPTIONS ): DSliderTrack;\r\n\r\n\tprotected abstract onPick( global: Point ): void;\r\n\tprotected abstract onValuesChanged(): void;\r\n\tprotected abstract moveThumbPosition( thumbCoordinate: number ): void;\r\n\r\n\tprotected getValueMargin(): number {\r\n\t\treturn 14;\r\n\t}\r\n\r\n\tprotected onTrackDown( global: Point ): void {\r\n\t\tif( this.isDisabled() ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\r\n\t\t\tthis._interactionManager = interactionManager;\r\n\t\t\tinteractionManager.on( UtilPointerEvent.up, this._onTrackUpBound );\r\n\t\t}\r\n\t\tthis.onPick( global );\r\n\t}\r\n\r\n\tprotected onTrackSelectedDown( global: Point ): void {\r\n\t\tif( this.isDisabled() ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\r\n\t\t\tthis._interactionManager = interactionManager;\r\n\t\t\tinteractionManager.on( UtilPointerEvent.up, this._onTrackSelectedUpBound );\r\n\t\t}\r\n\t\tthis.onPick( global );\r\n\t}\r\n\r\n\tprotected onTrackUpBound( e: InteractionEvent ): void {\r\n\t\tconst interactionManager = this._interactionManager;\r\n\t\tif( interactionManager ) {\r\n\t\t\tthis._interactionManager = undefined;\r\n\t\t\tinteractionManager.off( UtilPointerEvent.up, this._onTrackUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onTrackSelectedUpBound( e: InteractionEvent ): void {\r\n\t\tconst interactionManager = this._interactionManager;\r\n\t\tif( interactionManager ) {\r\n\t\t\tthis._interactionManager = undefined;\r\n\t\t\tinteractionManager.off( UtilPointerEvent.up, this._onTrackSelectedUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onThumbMove( e: InteractionEvent ): void {\r\n\t\tif( this.isDisabled() ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.onPick( e.data.global );\r\n\t}\r\n\r\n\tprotected onThumbDown( e: InteractionEvent ): void {\r\n\t\tconst layer = DApplications.getLayer( this );\r\n\t\tif( layer ) {\r\n\t\t\tconst interactionManager = layer.renderer.plugins.interaction;\r\n\t\t\tthis._interactionManager = interactionManager;\r\n\t\t\tinteractionManager.on( UtilPointerEvent.move, this._onThumbMoveBound );\r\n\t\t\tinteractionManager.on( UtilPointerEvent.up, this._onThumbUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onThumbUp( e: InteractionEvent ): void {\r\n\t\tconst interactionManager = this._interactionManager;\r\n\t\tif( interactionManager ) {\r\n\t\t\tthis._interactionManager = undefined;\r\n\t\t\tinteractionManager.off( UtilPointerEvent.move, this._onThumbMoveBound );\r\n\t\t\tinteractionManager.off( UtilPointerEvent.up, this._onThumbUpBound );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected updateValue(): void {\r\n\t\tconst min = this._min.value;\r\n\t\tconst max = this._max.value;\r\n\t\tconst value = this._value;\r\n\t\tvalue.value = value.rounder( min + this._ratioValue * ( max - min ) );\r\n\t\tvalue.text = value.value;\r\n\t}\r\n\r\n\tonResize( newWidth: number, newHeight: number, oldWidth: number, oldHeight: number ): void {\r\n\t\tsuper.onResize( newWidth, newHeight, oldWidth, oldHeight );\r\n\t\tthis.onValuesChanged();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets current value of slider\r\n\t */\r\n\tget value(): number {\r\n\t\treturn this._value.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets value for slider\r\n\t * - New value will be applied\r\n\t * - UI components will be changed arcording to new value\r\n\t */\r\n\tset value( value: number ) {\r\n\t\tvalue = Math.max( this._min.value, Math.min( this._max.value, value ) );\r\n\t\t// Adjust if value is new\r\n\t\tif( this._value.value !== value ) {\r\n\t\t\tthis._value.value = value;\r\n\t\t\tthis.onValuesChanged();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets min value of slider\r\n\t */\r\n\tget min(): number {\r\n\t\treturn this._min.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets min value for slider\r\n\t * - New min value will be applied\r\n\t * - UI components will be changed arcording to new value\r\n\t */\r\n\tset min( newMin: number ) {\r\n\t\tconst min = this._min;\r\n\t\tnewMin = Math.min( this._max.value, newMin );\r\n\t\tif( min.value !== newMin ) {\r\n\t\t\tconst value = this._value;\r\n\t\t\tmin.text = min.value = newMin;\r\n\t\t\tvalue.value = Math.max( newMin, value.value );\r\n\t\t\tthis.onValuesChanged();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets max value of slider\r\n\t */\r\n\tget max(): number {\r\n\t\treturn this._max.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets max value for slider\r\n\t * - New max value will be applied\r\n\t * - UI components will be changed arcording to new value\r\n\t */\r\n\tset max( newMax: number ) {\r\n\t\tconst max = this._max;\r\n\t\tnewMax = Math.max( this._min.value, newMax );\r\n\t\tif( max.value !== newMax ) {\r\n\t\t\tconst value = this._value;\r\n\t\t\tmax.text = max.value = newMax;\r\n\t\t\tvalue.value = Math.min( newMax, value.value );\r\n\t\t\tthis.onValuesChanged();\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DSlider\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\n\r\nexport interface DSliderTrackOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderTrack = DThemeSliderTrack\r\n> extends DButtonOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeSliderTrack extends DThemeButton {\r\n\r\n}\r\n\r\nexport class DSliderTrack<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderTrack = DThemeSliderTrack,\r\n\tOPTIONS extends DSliderTrackOptions<VALUE, THEME> = DSliderTrackOptions<VALUE, THEME>\r\n> extends DButton<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DSliderTrack\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DSliderTrack, DSliderTrackOptions, DThemeSliderTrack } from \"./d-slider-track\";\r\n\r\nexport interface DSliderTrackHorizontalOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderTrackHorizontal = DThemeSliderTrackHorizontal\r\n> extends DSliderTrackOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeSliderTrackHorizontal extends DThemeSliderTrack {\r\n\r\n}\r\n\r\nexport class DSliderTrackHorizontal<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderTrackHorizontal = DThemeSliderTrackHorizontal,\r\n\tOPTIONS extends DSliderTrackHorizontalOptions<VALUE, THEME> = DSliderTrackHorizontalOptions<VALUE, THEME>\r\n> extends DSliderTrack<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DSliderTrackHorizontal\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Point } from \"pixi.js\";\r\nimport { DSlider, DSliderOptions, DThemeSlider } from \"./d-slider\";\r\nimport { DSliderLabelOptions } from \"./d-slider-label\";\r\nimport { DSliderTrack } from \"./d-slider-track\";\r\nimport { DSliderTrackHorizontal } from \"./d-slider-track-horizontal\";\r\nimport { DSliderValueOptions } from \"./d-slider-value\";\r\n\r\nexport interface DSliderHorizontalOptions<THEME extends DThemeSliderHorizontal> extends DSliderOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeSliderHorizontal extends DThemeSlider {\r\n\r\n}\r\n\r\nexport class DSliderHorizontal<\r\n\tTHEME extends DThemeSliderHorizontal = DThemeSliderHorizontal,\r\n\tOPTIONS extends DSliderHorizontalOptions<THEME> = DSliderHorizontalOptions<THEME>\r\n> extends DSlider<THEME, OPTIONS> {\r\n\tprotected newTrack( options?: OPTIONS ): DSliderTrack {\r\n\t\treturn new DSliderTrackHorizontal( options && options.track );\r\n\t}\r\n\r\n\tprotected newTrackSelected( options?: OPTIONS ): DSliderTrack {\r\n\t\treturn new DSliderTrackHorizontal( options && options.track );\r\n\t}\r\n\r\n\tprotected toValueOptions( options?: DSliderValueOptions ): DSliderValueOptions {\r\n\t\toptions = super.toValueOptions( options );\r\n\t\tif( options.y == null ) {\r\n\t\t\toptions.y = ( p, s ) => p * 0.5 - s - this.getValueMargin();\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected toLabelMinOptions( options?: DSliderLabelOptions ): DSliderLabelOptions {\r\n\t\toptions = super.toLabelMinOptions( options );\r\n\t\tif( options.x == null ) {\r\n\t\t\toptions.x = ( p, s ) => -s * 0.5;\r\n\t\t}\r\n\t\tif( options.y == null ) {\r\n\t\t\toptions.y = ( p, s ) => -s;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected toLabelMaxOptions( options?: DSliderLabelOptions ): DSliderLabelOptions {\r\n\t\toptions = super.toLabelMaxOptions( options );\r\n\t\tif( options.x == null ) {\r\n\t\t\toptions.x = ( p, s ) => p - s * 0.5;\r\n\t\t}\r\n\t\tif( options.y == null ) {\r\n\t\t\toptions.y = ( p, s ) => -s;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected onPick( global: Point ): void {\r\n\t\tconst point = new Point(0, 0);\r\n\t\tthis.toLocal( global, undefined, point );\r\n\t\tconst x = Math.max( 0, Math.min( this._track.width, point.x ) );\r\n\t\tthis._ratioValue = x / this._track.width;\r\n\t\tthis.moveThumbPosition( x );\r\n\t}\r\n\r\n\tprotected onValuesChanged(): void {\r\n\t\tconst min = this._min.value;\r\n\t\tconst max = this._max.value;\r\n\t\tconst value = this._value.value;\r\n\t\tthis._ratioValue = ( value - min ) / ( max - min );\r\n\t\tconst x =  this._ratioValue * this._track.width;\r\n\t\tthis.moveThumbPosition( x );\r\n\t}\r\n\r\n\tprotected moveThumbPosition( x: number ): void {\r\n\t\tconst thumb = this._thumb;\r\n\t\tthumb.x = x - thumb.width * 0.5;\r\n\r\n\t\tthis._trackSelected.width = x;\r\n\r\n\t\tconst value = this._value;\r\n\t\tvalue.x = x - value.width * 0.5;\r\n\r\n\t\tthis.updateValue();\r\n\t}\r\n\r\n\tprotected toThumbCoordinate( x: number ): number {\r\n\t\treturn x - this._thumb.width * 0.5;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DSliderHorizontal\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DSliderTrack, DSliderTrackOptions, DThemeSliderTrack } from \"./d-slider-track\";\r\n\r\nexport interface DSliderTrackVerticalOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderTrackVertical = DThemeSliderTrackVertical\r\n> extends DSliderTrackOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeSliderTrackVertical extends DThemeSliderTrack {\r\n\r\n}\r\n\r\nexport class DSliderTrackVertical<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeSliderTrackVertical = DThemeSliderTrackVertical,\r\n\tOPTIONS extends DSliderTrackVerticalOptions<VALUE, THEME> = DSliderTrackVerticalOptions<VALUE, THEME>\r\n> extends DSliderTrack<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DSliderTrackVertical\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Point } from \"pixi.js\";\r\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\r\nimport { DSlider, DSliderOptions, DThemeSlider } from \"./d-slider\";\r\nimport { DSliderLabelOptions } from \"./d-slider-label\";\r\nimport { DSliderTrack } from \"./d-slider-track\";\r\nimport { DSliderTrackVertical } from \"./d-slider-track-vertical\";\r\n\r\nexport interface DSliderVerticalOptions<\r\n\tTHEME extends DThemeSliderVertical = DThemeSliderVertical\r\n> extends DSliderOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeSliderVertical extends DThemeSlider {\r\n\r\n}\r\n\r\nexport class DSliderVertical<\r\n\tTHEME extends DThemeSliderVertical = DThemeSliderVertical,\r\n\tOPTIONS extends DSliderVerticalOptions<THEME> = DSliderVerticalOptions<THEME>\r\n> extends DSlider<THEME, OPTIONS> {\r\n\tprotected newTrack( options?: OPTIONS ): DSliderTrack {\r\n\t\treturn new DSliderTrackVertical( options && options.track );\r\n\t}\r\n\r\n\tprotected newTrackSelected( options?: OPTIONS ): DSliderTrack {\r\n\t\treturn new DSliderTrackVertical( options && options.track );\r\n\t}\r\n\r\n\tprotected toLabelMinOptions( options?: DSliderLabelOptions ): DSliderLabelOptions {\r\n\t\toptions = super.toLabelMinOptions( options );\r\n\t\tif( options.x == null ) {\r\n\t\t\toptions.x = ( p, s ) => -s;\r\n\t\t}\r\n\t\tif( options.y == null ) {\r\n\t\t\toptions.y = ( p, s ) => p - s * 0.5;\r\n\t\t}\r\n\t\tconst text = options.text = options.text || {};\r\n\t\tconst textAlign = text.align = text.align || {};\r\n\t\tif( textAlign.horizontal == null ) {\r\n\t\t\ttextAlign.horizontal = DAlignHorizontal.RIGHT;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected toLabelMaxOptions( options?: DSliderLabelOptions ): DSliderLabelOptions {\r\n\t\toptions = super.toLabelMaxOptions( options );\r\n\t\tif( options.x == null ) {\r\n\t\t\toptions.x = ( p, s ) => -s;\r\n\t\t}\r\n\t\tif( options.y == null ) {\r\n\t\t\toptions.y = ( p, s ) => -s * 0.5;\r\n\t\t}\r\n\t\tconst text = options.text = options.text || {};\r\n\t\tconst textAlign = text.align = text.align || {};\r\n\t\tif( textAlign.horizontal == null ) {\r\n\t\t\ttextAlign.horizontal = DAlignHorizontal.RIGHT;\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\tprotected onPick( global: Point ): void {\r\n\t\tconst point = new Point( 0, 0 );\r\n\t\tthis.toLocal( global, undefined, point );\r\n\t\tconst height = this.height;\r\n\t\tconst y = Math.max( 0, Math.min( height, point.y ) );\r\n\t\tthis._ratioValue = ( height - y ) / height;\r\n\t\tthis.moveThumbPosition( y );\r\n\t}\r\n\r\n\tprotected onValuesChanged(): void {\r\n\t\tconst min = this._min.value;\r\n\t\tconst max = this._max.value;\r\n\t\tconst value = this._value.value;\r\n\t\tthis._ratioValue = ( value - min ) / ( max - min );\r\n\t\tconst y = this.height * ( 1 - this._ratioValue );\r\n\t\tthis.moveThumbPosition( y );\r\n\t}\r\n\r\n\tprotected moveThumbPosition( y: number ): void {\r\n\t\tconst thumb = this._thumb;\r\n\t\tthumb.y = y - thumb.height * 0.5;\r\n\r\n\t\tconst trackSelected = this._trackSelected;\r\n\t\ttrackSelected.y = y;\r\n\t\ttrackSelected.height = this.height - y;\r\n\r\n\t\tconst value = this._value;\r\n\t\tvalue.y = y - value.height - this.getValueMargin();\r\n\r\n\t\tthis.updateValue();\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DSliderVertical\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"./d-base\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport class DTableBodyCells {\r\n\tstatic setReadOnly<ROW>( target: DBase, row: ROW, columnIndex: number, columnData: DTableColumn<ROW> ): void {\r\n\t\ttarget.setReadOnly( this.toReadOnly( row, columnIndex, columnData ) );\r\n\t}\r\n\r\n\tstatic setRenderable<ROW>( target: DBase, row: ROW, columnIndex: number, columnData: DTableColumn<ROW> ): void {\r\n\t\tconst renderable = this.toRenderable( row, columnIndex, columnData );\r\n\t\ttarget.renderable = renderable;\r\n\t\ttarget.setDisabled( ! renderable );\r\n\t}\r\n\r\n\tstatic toReadOnly<ROW>( row: ROW, columnIndex: number, columnData: DTableColumn<ROW> ): boolean {\r\n\t\tconst enable = columnData.editing.enable;\r\n\t\tif( enable === true ) {\r\n\t\t\treturn false;\r\n\t\t} else if( enable === false ) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn ! enable( row, columnIndex );\r\n\t\t}\r\n\t}\r\n\tstatic toRenderable<ROW>( row: ROW, columnIndex: number, columnData: DTableColumn<ROW> ): boolean {\r\n\t\tconst renderable = columnData.renderable;\r\n\t\tif( renderable === true ) {\r\n\t\t\treturn true;\r\n\t\t} else if( renderable === false ) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn renderable( row, columnIndex );\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellSelectDialogOptions<\r\n\tROW = unknown,\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellSelectDialog = DThemeTableBodyCellSelectDialog\r\n> extends DButtonOptions<VALUE, THEME>, DTableBodyCellOptions<ROW> {\r\n\t/**\r\n\t * False to stop synchronization of the selected value and the text.\r\n\t */\r\n\tsync?: boolean;\r\n}\r\n\r\nexport interface DThemeTableBodyCellSelectDialog extends DThemeButton {\r\n\tisSyncEnabled(): boolean;\r\n}\r\n\r\nexport class DTableBodyCellSelectDialog<\r\n\tROW = unknown,\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellSelectDialog = DThemeTableBodyCellSelectDialog,\r\n\tOPTIONS extends DTableBodyCellSelectDialogOptions<ROW, VALUE, THEME> =\r\n\t\tDTableBodyCellSelectDialogOptions<ROW, VALUE, THEME>\r\n> extends DButton<VALUE, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\tprotected _isSyncEnabled!: boolean;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tconst column = options.column;\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = column.index;\r\n\t\tthis._columnData = column.data;\r\n\t\tthis._isSyncEnabled = this.toSync( this.theme, options );\r\n\t\tconst selecting = column.data.selecting;\r\n\t\tconst dialog = selecting.dialog;\r\n\t\tif( dialog != null ) {\r\n\t\t\tthis.on( \"active\", (): void => {\r\n\t\t\t\tselecting.setter( dialog, this.text );\r\n\t\t\t\tdialog.open().then(() => {\r\n\t\t\t\t\tconst newValue = selecting.getter( dialog );\r\n\t\t\t\t\tif( this._isSyncEnabled ) {\r\n\t\t\t\t\t\tconst oldValue = this.text;\r\n\t\t\t\t\t\tif( newValue !== oldValue ) {\r\n\t\t\t\t\t\t\tthis.text = newValue as VALUE;\r\n\t\t\t\t\t\t\tthis.onCellChange( newValue, oldValue );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.onCellChange( newValue, null );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onCellChange( newValue: unknown, oldValue: unknown ): void {\r\n\t\tconst row = this._row;\r\n\t\tif( row !== undefined ) {\r\n\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toSync( theme: THEME, options: OPTIONS ): boolean {\r\n\t\treturn ( options && options.sync != null ? options.sync : theme.isSyncEnabled() );\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tget value(): VALUE {\r\n\t\treturn this.text as VALUE;\r\n\t}\r\n\r\n\tset value( value: VALUE ) {\r\n\t\tthis.text = value;\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tif( forcibly ) {\r\n\t\t\tthis._textValue = value as VALUE;\r\n\t\t\tthis._textValueComputed = value as VALUE;\r\n\t\t\tthis.onTextChange();\r\n\t\t\tthis.createOrUpdateText();\r\n\t\t} else {\r\n\t\t\tthis.text = value as VALUE;\r\n\t\t}\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellSelectDialog\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {\r\n\tDTableBodyCellSelectDialog, DTableBodyCellSelectDialogOptions, DThemeTableBodyCellSelectDialog\r\n} from \"./d-table-body-cell-select-dialog\";\r\n\r\nexport interface DTableBodyCellActionDialogOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellActionDialog = DThemeTableBodyCellActionDialog\r\n> extends DTableBodyCellSelectDialogOptions<ROW, unknown, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeTableBodyCellActionDialog extends DThemeTableBodyCellSelectDialog {\r\n\r\n}\r\n\r\nexport class DTableBodyCellActionDialog<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellActionDialog = DThemeTableBodyCellActionDialog,\r\n\tOPTIONS extends DTableBodyCellActionDialogOptions<ROW, THEME> = DTableBodyCellActionDialogOptions<ROW, THEME>\r\n> extends DTableBodyCellSelectDialog<ROW, unknown, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellActionDialog\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DDropdown, DDropdownOptions, DThemeDropdown } from \"./d-dropdown\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellActionMenuOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellActionMenu = DThemeTableBodyCellActionMenu\r\n> extends DDropdownOptions<unknown, THEME>, DTableBodyCellOptions<ROW> {\r\n\r\n}\r\n\r\nexport interface DThemeTableBodyCellActionMenu extends DThemeDropdown {\r\n\r\n}\r\n\r\nexport class DTableBodyCellActionMenu<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellActionMenu = DThemeTableBodyCellActionMenu,\r\n\tOPTIONS extends DTableBodyCellActionMenuOptions<ROW, THEME> = DTableBodyCellActionMenuOptions<ROW, THEME>\r\n> extends DDropdown<unknown, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\tprotected _onSelectedBound!: ( selected: unknown ) => void;\r\n\tprotected _onClosedBound!: () => void;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tconst column = options.column;\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = column.index;\r\n\t\tthis._columnData = column.data;\r\n\t\tthis._onSelectedBound = ( selected: unknown ): void => {\r\n\t\t\tthis.onSelected( selected );\r\n\t\t};\r\n\t\tthis._onClosedBound = (): void => {\r\n\t\t\tthis.onClosed();\r\n\t\t};\r\n\t}\r\n\r\n\tprotected onSelected( selected: unknown ): void {\r\n\t\tconst columnData = this._columnData;\r\n\t\tconst row = this._row;\r\n\t\tif( row !== undefined ) {\r\n\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\tcolumnData.setter( row, columnIndex, selected );\r\n\t\t\tthis.emit( \"cellchange\", selected, null, row, rowIndex, columnIndex, this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onClosed(): void {\r\n\t\tconst menu = this.menu;\r\n\t\tmenu.off( \"select\", this._onSelectedBound );\r\n\t\tmenu.off( \"close\", this._onClosedBound );\r\n\t}\r\n\r\n\tstart(): void {\r\n\t\tconst menu = this.menu;\r\n\t\tmenu.on( \"select\", this._onSelectedBound );\r\n\t\tmenu.on( \"close\", this._onClosedBound );\r\n\t\tsuper.start();\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis.text = value as any;\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellActionMenu\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellSelectPromiseOptions<\r\n\tROW = unknown,\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellSelectPromise = DThemeTableBodyCellSelectPromise\r\n> extends DButtonOptions<VALUE, THEME>, DTableBodyCellOptions<ROW> {\r\n\t/**\r\n\t * False to stop synchronizing the resolved value and the text.\r\n\t */\r\n\tsync?: boolean;\r\n}\r\n\r\nexport interface DThemeTableBodyCellSelectPromise extends DThemeButton {\r\n\tisSyncEnabled(): boolean;\r\n}\r\n\r\nexport class DTableBodyCellSelectPromise<\r\n\tROW = unknown,\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellSelectPromise = DThemeTableBodyCellSelectPromise,\r\n\tOPTIONS extends DTableBodyCellSelectPromiseOptions<ROW, VALUE, THEME> =\r\n\t\tDTableBodyCellSelectPromiseOptions<ROW, VALUE, THEME>\r\n> extends DButton<VALUE, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\tprotected _isSyncEnabled!: boolean;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tconst column = options.column;\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = column.index;\r\n\t\tthis._columnData = column.data;\r\n\t\tthis._isSyncEnabled = this.toSync( this.theme, options );\r\n\t\tconst selecting = column.data.selecting;\r\n\t\tconst promise = selecting.promise;\r\n\t\tif( promise != null ) {\r\n\t\t\tthis.on( \"active\", (): void => {\r\n\t\t\t\tpromise().then(( newValue: unknown ): void => {\r\n\t\t\t\t\tif( this._isSyncEnabled ) {\r\n\t\t\t\t\t\tconst oldValue = this.text;\r\n\t\t\t\t\t\tif( newValue !== oldValue ) {\r\n\t\t\t\t\t\t\tthis.text = newValue as VALUE;\r\n\t\t\t\t\t\t\tthis.onCellChange( newValue, oldValue );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.onCellChange( newValue, null );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onCellChange( newValue: unknown, oldValue: unknown ): void {\r\n\t\tconst row = this._row;\r\n\t\tif( row !== undefined ) {\r\n\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toSync( theme: THEME, options: OPTIONS ): boolean {\r\n\t\treturn ( options && options.sync != null ? options.sync : theme.isSyncEnabled() );\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tget value(): VALUE {\r\n\t\treturn this._textValueComputed;\r\n\t}\r\n\r\n\tset value( value: VALUE ) {\r\n\t\tthis.text = value;\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tif( forcibly ) {\r\n\t\t\tthis._textValue = value as VALUE;\r\n\t\t\tthis._textValueComputed = value as VALUE;\r\n\t\t\tthis.onTextChange();\r\n\t\t\tthis.createOrUpdateText();\r\n\t\t} else {\r\n\t\t\tthis.text = value as VALUE;\r\n\t\t}\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellSelectPromise\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport {\r\n\tDTableBodyCellSelectPromise, DTableBodyCellSelectPromiseOptions, DThemeTableBodyCellSelectPromise\r\n} from \"./d-table-body-cell-select-promise\";\r\n\r\nexport interface DTableBodyCellActionPromiseOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellActionPromise = DThemeTableBodyCellActionPromise\r\n> extends DTableBodyCellSelectPromiseOptions<ROW, unknown, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeTableBodyCellActionPromise extends DThemeTableBodyCellSelectPromise {\r\n\r\n}\r\n\r\nexport class DTableBodyCellActionPromise<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellActionPromise = DThemeTableBodyCellActionPromise,\r\n\tOPTIONS extends DTableBodyCellActionPromiseOptions<ROW, THEME> = DTableBodyCellActionPromiseOptions<ROW, THEME>\r\n> extends DTableBodyCellSelectPromise<ROW, unknown, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellActionPromise\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellTextOptions<ROW, THEME extends DThemeTableBodyCellText = DThemeTableBodyCellText>\r\n\textends DImageBaseOptions<unknown, THEME>, DTableBodyCellOptions<ROW> {\r\n}\r\n\r\nexport interface DThemeTableBodyCellText extends DThemeImageBase {\r\n\tgetTextValue( state: DBaseState ): unknown;\r\n\tnewTextValue(): unknown;\r\n}\r\n\r\nexport class DTableBodyCellText<\r\n\tROW,\r\n\tTHEME extends DThemeTableBodyCellText = DThemeTableBodyCellText,\r\n\tOPTIONS extends DTableBodyCellTextOptions<ROW, THEME> = DTableBodyCellTextOptions<ROW, THEME>\r\n> extends DImageBase<unknown, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis.text = value;\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellText\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DBaseStates } from \"./d-base-states\";\r\nimport { DTableBodyCellText, DTableBodyCellTextOptions, DThemeTableBodyCellText } from \"./d-table-body-cell-text\";\r\nimport { UtilKeyboardEvent } from \"./util/util-keyboard-event\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DTableBodyCellButtonOptions<ROW, THEME extends DThemeTableBodyCellButton = DThemeTableBodyCellButton>\r\n\textends DTableBodyCellTextOptions<ROW, THEME> {\r\n}\r\n\r\nexport interface DThemeTableBodyCellButton extends DThemeTableBodyCellText {\r\n\r\n}\r\n\r\nexport class DTableBodyCellButton<\r\n\tROW,\r\n\tTHEME extends DThemeTableBodyCellButton = DThemeTableBodyCellButton,\r\n\tOPTIONS extends DTableBodyCellButtonOptions<ROW, THEME> = DTableBodyCellButtonOptions<ROW, THEME>\r\n> extends DTableBodyCellText<ROW, THEME, OPTIONS> {\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\t\tthis.buttonMode = true;\r\n\t\tthis.initOnClick( options );\r\n\t}\r\n\r\n\tprotected initOnClick( options: OPTIONS ): void {\r\n\t\tUtilPointerEvent.onClick( this, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tif( this.isActionable() ) {\r\n\t\t\t\tthis.onActive( e );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected onActive( e: KeyboardEvent | interaction.InteractionEvent ): void {\r\n\t\tthis.emit( \"active\", this );\r\n\t\tconst row = this._row;\r\n\t\tif( row !== undefined ) {\r\n\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\tthis._columnData.setter( row, columnIndex, null );\r\n\t\t\tthis.emit( \"cellchange\", null, null, row, rowIndex, columnIndex, this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onActivateKeyDown( e: KeyboardEvent ): void {\r\n\t\tif( this.isActionable() ) {\r\n\t\t\tthis.setPressed( true );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onActivateKeyUp( e: KeyboardEvent ): void {\r\n\t\tif( this.isActionable() ) {\r\n\t\t\tif( this.isPressed() ) {\r\n\t\t\t\tthis.onActive( e );\r\n\t\t\t}\r\n\t\t\tthis.setPressed( false );\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown( e: KeyboardEvent ): boolean {\r\n\t\tif( UtilKeyboardEvent.isActivateKey( e ) ) {\r\n\t\t\tthis.onActivateKeyDown( e );\r\n\t\t}\r\n\r\n\t\treturn super.onKeyDown( e );\r\n\t}\r\n\r\n\tonKeyUp( e: KeyboardEvent ): boolean {\r\n\t\tif( UtilKeyboardEvent.isActivateKey( e ) ) {\r\n\t\t\tthis.onActivateKeyUp( e );\r\n\t\t}\r\n\r\n\t\treturn super.onKeyUp( e );\r\n\t}\r\n\r\n\tprotected onStateChange( newState: number, oldState: number ): void {\r\n\t\tsuper.onStateChange( newState, oldState );\r\n\t\tthis.buttonMode = DBaseStates.isActionable( newState );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellButton\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButtonCheck, DButtonCheckOptions, DThemeButtonCheck } from \"./d-button-check\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn, DTableColumnType } from \"./d-table-column\";\r\nimport { DTableData } from \"./d-table-data\";\r\n\r\nexport interface DTableBodyCellCheckOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellCheck = DThemeTableBodyCellCheck\r\n> extends DButtonCheckOptions<unknown, THEME>, DTableBodyCellOptions<ROW> {\r\n}\r\n\r\nexport interface DThemeTableBodyCellCheck extends DThemeButtonCheck {\r\n\r\n}\r\n\r\nexport class DTableBodyCellCheck<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellCheck = DThemeTableBodyCellCheck,\r\n\tOPTIONS extends DTableBodyCellCheckOptions<ROW, THEME> = DTableBodyCellCheckOptions<ROW, THEME>\r\n> extends DButtonCheck<unknown, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tthis.onChange( true );\r\n\t\t});\r\n\r\n\t\tthis.on( \"inactive\", (): void => {\r\n\t\t\tthis.onChange( false );\r\n\t\t});\r\n\t}\r\n\r\n\tprotected onChangeSingle( rowIndex: number, columnIndex: number, columnData: DTableColumn<ROW> ) {\r\n\t\tconst tableBodyRow = this.parent;\r\n\t\tif( tableBodyRow ) {\r\n\t\t\tconst tableBody = tableBodyRow.parent as any;\r\n\t\t\tif( tableBody ) {\r\n\t\t\t\tlet isChanged = false;\r\n\t\t\t\tconst getter = columnData.getter;\r\n\t\t\t\tconst setter = columnData.setter;\r\n\t\t\t\tconst data = tableBody.data as DTableData<ROW>;\r\n\t\t\t\tdata.each(( row: ROW, index: number ): boolean => {\r\n\t\t\t\t\tif( rowIndex !== index && getter( row, columnIndex ) ) {\r\n\t\t\t\t\t\tsetter( row, columnIndex, false );\r\n\t\t\t\t\t\tisChanged = true;\r\n\t\t\t\t\t\tthis.emit( \"cellchange\", false, true, row, index, columnIndex, this );\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\t\t\t\tif( isChanged ) {\r\n\t\t\t\t\ttableBody.update( true );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onChange( newValue: boolean ): void {\r\n\t\tconst row = this._row;\r\n\t\tif( row !== undefined ) {\r\n\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\tconst columnData = this._columnData;\r\n\t\t\tcolumnData.setter( row, columnIndex, newValue );\r\n\t\t\tthis.emit( \"cellchange\", newValue, ! newValue, row, rowIndex, columnIndex, this );\r\n\t\t\tif( newValue && columnData.type === DTableColumnType.CHECK_SINGLE ) {\r\n\t\t\t\tthis.onChangeSingle( rowIndex, columnIndex, columnData );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis.setActive( !! value );\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellCheck\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\n\r\nexport enum DTableDataSelectionType {\r\n\tNONE,\r\n\tSINGLE,\r\n\tMULTIPLE\r\n}\r\n\r\nexport interface DTableDataSelectionOptions {\r\n\ttype?: (keyof typeof DTableDataSelectionType) | DTableDataSelectionType;\r\n}\r\n\r\nexport interface DTableDataSelection<ROW> extends utils.EventEmitter {\r\n\t/**\r\n\t * Returns a copy of an index array of selected rows.\r\n\t * The order of indices is an insertion order.\r\n\t */\r\n\treadonly indices: number[];\r\n\r\n\t/**\r\n\t * Returns a copy of an array of selected row value.\r\n\t * The order is an insertion order.\r\n\t */\r\n\treadonly rows: ROW[];\r\n\r\n\treadonly type: DTableDataSelectionType;\r\n\r\n\treadonly first: number | null;\r\n\treadonly last: number | null;\r\n\r\n\ttoggle( rowIndex: number ): void;\r\n\tadd( rowIndex: number ): void;\r\n\taddTo( rowIndex: number ): void;\r\n\taddRange( from: number, includeFrom: boolean, to: number, includeTo: boolean ): void;\r\n\taddAll( rowIndices: number[] ): void;\r\n\tcontains( rowIndex: number ): boolean;\r\n\tremove( rowIndex: number ): void;\r\n\tclear(): void;\r\n\tclearAndAdd( rowIndex: number ): void;\r\n\tclearAndAddAll( rowIndices: number[] ): void;\r\n\tshift( rowIndex: number, amount: number ): void;\r\n\tsize(): number;\r\n\tisEmpty(): boolean;\r\n\r\n\t/**\r\n\t * Returns an array of the (index, row value) pairs of selected rows.\r\n\t * The order of pairs is an insertion order.\r\n\t */\r\n\ttoArray(): Array<[ number, ROW ]>;\r\n\r\n\t/**\r\n\t * Returns an sorted array of the (index, row value) pairs of selected rows.\r\n\t */\r\n\ttoSortedArray(): Array<[ number, ROW ]>;\r\n\r\n\ttoObject(): {[index: number]: ROW};\r\n\r\n\ttoMap(): Map<number, ROW>;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButtonColor, DButtonColorOptions, DThemeButtonColor } from \"./d-button-color\";\r\nimport { DColorAndAlpha } from \"./d-color\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\nimport { isNumber } from \"./util/is-number\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport interface DTableBodyCellColorOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellColor = DThemeTableBodyCellColor\r\n> extends DButtonColorOptions<THEME>, DTableBodyCellOptions<ROW> {\r\n}\r\n\r\nexport interface DThemeTableBodyCellColor extends DThemeButtonColor {\r\n\r\n}\r\n\r\nconst clone = ( value: DColorAndAlpha ): DColorAndAlpha => {\r\n\treturn {\r\n\t\tcolor: value.color,\r\n\t\talpha: value.alpha\r\n\t};\r\n};\r\n\r\nconst hasColor = ( value: any ): value is { color: unknown } => {\r\n\treturn ( \"color\" in value );\r\n};\r\n\r\nconst hasAlpha = ( value: any ): value is { alpha: unknown } => {\r\n\treturn ( \"alpha\" in value );\r\n};\r\n\r\nexport class DTableBodyCellColor<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellColor = DThemeTableBodyCellColor,\r\n\tOPTIONS extends DTableBodyCellColorOptions<ROW, THEME> = DTableBodyCellColorOptions<ROW, THEME>\r\n> extends DButtonColor<THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\r\n\t\tthis.on( \"change\", ( newValue: DColorAndAlpha, oldValue: DColorAndAlpha ): void => {\r\n\t\t\tconst row = this._row;\r\n\t\t\tif( row !== undefined ) {\r\n\t\t\t\tconst newValueCloned = clone( newValue );\r\n\t\t\t\tconst oldValueCloned = clone( oldValue );\r\n\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\tthis._columnData.setter( row, columnIndex, newValueCloned );\r\n\t\t\t\tthis.emit( \"cellchange\", newValueCloned, oldValueCloned, row, rowIndex, columnIndex, this );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tnewValue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tconst value = this._value;\r\n\t\tif( isNumber( newValue ) ) {\r\n\t\t\tvalue.color = newValue;\r\n\t\t\tvalue.alpha = 1;\r\n\t\t} else if( isString( newValue ) ) {\r\n\t\t\tconst parsed = Number( newValue );\r\n\t\t\tif( parsed === parsed ) {\r\n\t\t\t\tvalue.color = parsed;\r\n\t\t\t} else {\r\n\t\t\t\tvalue.color = 0xffffff;\r\n\t\t\t}\r\n\t\t\tvalue.alpha = 1;\r\n\t\t} else if( newValue != null ) {\r\n\t\t\tif( hasColor( newValue ) ) {\r\n\t\t\t\tvalue.color = Number( newValue.color );\r\n\t\t\t} else {\r\n\t\t\t\tvalue.color = 0xffffff;\r\n\t\t\t}\r\n\t\t\tif( hasAlpha( newValue ) ) {\r\n\t\t\t\tvalue.alpha = Number( newValue.alpha );\r\n\t\t\t} else {\r\n\t\t\t\tvalue.alpha = 1;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvalue.color = 0xffffff;\r\n\t\t\tvalue.alpha = 1;\r\n\t\t}\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellColor\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DDialogDate, DDialogDateOptions } from \"./d-dialog-date\";\r\nimport { DDialogDates } from \"./d-dialog-dates\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\nexport interface DTableBodyCellDateOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellDate = DThemeTableBodyCellDate\r\n> extends DButtonOptions<Date, THEME>, DTableBodyCellOptions<ROW> {\r\n\tdialog?: DDialogDateOptions;\r\n}\r\n\r\nexport interface DThemeTableBodyCellDate extends DThemeButton {\r\n\tgetTextFormatter(): ( value: Date, caller: DTableBodyCellDate ) => string;\r\n\tgetTextValue( state: DBaseState ): Date;\r\n\tnewTextValue(): Date;\r\n}\r\n\r\nexport class DTableBodyCellDate<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellDate = DThemeTableBodyCellDate,\r\n\tOPTIONS extends DTableBodyCellDateOptions<ROW, THEME> = DTableBodyCellDateOptions<ROW, THEME>\r\n> extends DButton<Date, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _dialog?: DDialogDate;\r\n\tprotected _dialogOptions?: DDialogDateOptions;\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis._dialogOptions = options.dialog;\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst currentTime = this._textValueComputed.getTime();\r\n\t\t\tconst dialog = this.dialog;\r\n\t\t\tdialog.current = new Date( currentTime );\r\n\t\t\tdialog.new = new Date( currentTime );\r\n\t\t\tdialog.page = new Date( currentTime );\r\n\t\t\tdialog.open().then((): void => {\r\n\t\t\t\tconst newValue = dialog.new;\r\n\t\t\t\tconst oldValue = dialog.current;\r\n\t\t\t\tthis.text = new Date( newValue.getTime() );\r\n\t\t\t\tconst row = this._row;\r\n\t\t\t\tif( row !== undefined ) {\r\n\t\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tget dialog(): DDialogDate {\r\n\t\tlet dialog = this._dialog;\r\n\t\tif( dialog == null ) {\r\n\t\t\tconst dialogOptions = this._dialogOptions;\r\n\t\t\tif( dialogOptions != null ) {\r\n\t\t\t\tdialog = new DDialogDate( this._dialogOptions );\r\n\t\t\t} else {\r\n\t\t\t\tdialog = DDialogDates.getInstance();\r\n\t\t\t}\r\n\t\t\tthis._dialog = dialog;\r\n\t\t}\r\n\t\treturn dialog;\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tif( value instanceof Date ) {\r\n\t\t\tif( forcibly ) {\r\n\t\t\t\tthis._textValue = value;\r\n\t\t\t\tthis._textValueComputed = value;\r\n\t\t\t\tthis.onTextChange();\r\n\t\t\t\tthis.createOrUpdateText();\r\n\t\t\t} else {\r\n\t\t\t\tthis.text = value;\r\n\t\t\t}\r\n\t\t} else if( isNumber( value ) ) {\r\n\t\t\tconst textValueComputed = this._textValueComputed;\r\n\t\t\tif( textValueComputed.getTime() !== value ) {\r\n\t\t\t\ttextValueComputed.setTime( value );\r\n\t\t\t\tthis.onTextChange();\r\n\t\t\t\tthis.createOrUpdateText();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellDate\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DDialogDatetime, DDialogDatetimeOptions } from \"./d-dialog-datetime\";\r\nimport { DDialogDatetimes } from \"./d-dialog-datetimes\";\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerDatetimes } from \"./d-picker-datetimes\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\nexport interface DTableBodyCellDatetimeOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellDatetime = DThemeTableBodyCellDatetime\r\n> extends DButtonOptions<Date, THEME>, DTableBodyCellOptions<ROW> {\r\n\tdialog?: DDialogDatetimeOptions;\r\n}\r\n\r\nexport interface DThemeTableBodyCellDatetime extends DThemeButton {\r\n\tgetTextFormatter(): ( value: Date, caller: DTableBodyCellDatetime ) => string;\r\n\tgetTextValue( state: DBaseState ): Date;\r\n\tnewTextValue(): Date;\r\n}\r\n\r\nexport class DTableBodyCellDatetime<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellDatetime = DThemeTableBodyCellDatetime,\r\n\tOPTIONS extends DTableBodyCellDatetimeOptions<ROW, THEME> = DTableBodyCellDatetimeOptions<ROW, THEME>\r\n> extends DButton<Date, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected static DIALOG?: DDialogDatetime;\r\n\tprotected _dialog?: DDialogDatetime;\r\n\tprotected _dialogOptions?: DDialogDatetimeOptions;\r\n\tprotected _datetimeMask!: DPickerDatetimeMask;\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tthis._dialogOptions = options.dialog;\r\n\t\tthis._datetimeMask = DPickerDatetimes.toMask( options && options.dialog && options.dialog.picker );\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst currentTime = this._textValueComputed.getTime();\r\n\t\t\tconst dialog = this.dialog;\r\n\t\t\tdialog.current = new Date( currentTime );\r\n\t\t\tdialog.new = new Date( currentTime );\r\n\t\t\tdialog.page = new Date( currentTime );\r\n\t\t\tdialog.open().then((): void => {\r\n\t\t\t\tconst newValue = dialog.new;\r\n\t\t\t\tconst oldValue = dialog.current;\r\n\t\t\t\tthis.text = new Date( newValue.getTime() );\r\n\t\t\t\tconst row = this._row;\r\n\t\t\t\tif( row !== undefined ) {\r\n\t\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tgetDatetimeMask(): DPickerDatetimeMask {\r\n\t\treturn this._datetimeMask;\r\n\t}\r\n\r\n\tget dialog(): DDialogDatetime {\r\n\t\tlet dialog = this._dialog;\r\n\t\tif( dialog == null ) {\r\n\t\t\tconst dialogOptions = this._dialogOptions;\r\n\t\t\tif( dialogOptions != null ) {\r\n\t\t\t\tdialog = new DDialogDatetime( this._dialogOptions );\r\n\t\t\t} else {\r\n\t\t\t\tdialog = DDialogDatetimes.getInstance();\r\n\t\t\t}\r\n\t\t\tthis._dialog = dialog;\r\n\t\t}\r\n\t\treturn dialog;\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tif( value instanceof Date ) {\r\n\t\t\tif( forcibly ) {\r\n\t\t\t\tthis._textValue = value;\r\n\t\t\t\tthis._textValueComputed = value;\r\n\t\t\t\tthis.onTextChange();\r\n\t\t\t\tthis.createOrUpdateText();\r\n\t\t\t} else {\r\n\t\t\t\tthis.text = value;\r\n\t\t\t}\r\n\t\t} else if( isNumber( value ) ) {\r\n\t\t\tconst textValueComputed = this._textValueComputed;\r\n\t\t\tif( textValueComputed.getTime() !== value ) {\r\n\t\t\t\ttextValueComputed.setTime( value );\r\n\t\t\t\tthis.onTextChange();\r\n\t\t\t\tthis.createOrUpdateText();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellDatetime\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DImageBase, DImageBaseOptions, DThemeImageBase } from \"./d-image-base\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellIndexOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellIndex = DThemeTableBodyCellIndex\r\n> extends DImageBaseOptions<number, THEME>, DTableBodyCellOptions<ROW> {\r\n}\r\n\r\nexport interface DThemeTableBodyCellIndex extends DThemeImageBase {\r\n\tgetTextFormatter(): ( value: number, caller: DTableBodyCellIndex ) => string;\r\n\tgetTextValue( state: DBaseState ): number;\r\n\tnewTextValue(): number;\r\n}\r\n\r\nexport class DTableBodyCellIndex<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellIndex = DThemeTableBodyCellIndex,\r\n\tOPTIONS extends DTableBodyCellIndexOptions<ROW, THEME> = DTableBodyCellIndexOptions<ROW, THEME>\r\n> extends DImageBase<number, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis.text = rowIndex;\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellIndex\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DInputInteger, DInputIntegerOptions, DThemeInputInteger } from \"./d-input-integer\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellInputIntegerOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellInputInteger = DThemeTableBodyCellInputInteger\r\n> extends DInputIntegerOptions<THEME>, DTableBodyCellOptions<ROW> {\r\n}\r\n\r\nexport interface DThemeTableBodyCellInputInteger extends DThemeInputInteger {\r\n\r\n}\r\n\r\nexport class DTableBodyCellInputInteger<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellInputInteger = DThemeTableBodyCellInputInteger,\r\n\tOPTIONS extends DTableBodyCellInputIntegerOptions<ROW, THEME> = DTableBodyCellInputIntegerOptions<ROW, THEME>\r\n> extends DInputInteger<THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\t\tthis.on( \"change\", ( newValue: unknown, oldValue: unknown ): void => {\r\n\t\t\tconst row = this._row;\r\n\t\t\tif( row !== undefined ) {\r\n\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis.text = Number( value );\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellInputInteger\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DInputReal, DInputRealOptions, DThemeInputReal } from \"./d-input-real\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellInputRealOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellInputReal = DThemeTableBodyCellInputReal\r\n> extends DInputRealOptions<THEME>, DTableBodyCellOptions<ROW> {\r\n}\r\n\r\nexport interface DThemeTableBodyCellInputReal extends DThemeInputReal {\r\n\r\n}\r\n\r\nexport class DTableBodyCellInputReal<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellInputReal = DThemeTableBodyCellInputReal,\r\n\tOPTIONS extends DTableBodyCellInputRealOptions<ROW, THEME> = DTableBodyCellInputRealOptions<ROW, THEME>\r\n> extends DInputReal<THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\t\tthis.on( \"change\", ( newValue: unknown, oldValue: unknown ): void => {\r\n\t\t\tconst row = this._row;\r\n\t\t\tif( row !== undefined ) {\r\n\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis.text = Number( value );\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellInputReal\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DInputText, DInputTextOptions, DThemeInputText } from \"./d-input-text\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellInputTextOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellInputText = DThemeTableBodyCellInputText\r\n> extends DInputTextOptions<THEME>, DTableBodyCellOptions<ROW> {\r\n}\r\n\r\nexport interface DThemeTableBodyCellInputText extends DThemeInputText {\r\n\r\n}\r\n\r\nexport class DTableBodyCellInputText<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellInputText = DThemeTableBodyCellInputText,\r\n\tOPTIONS extends DTableBodyCellInputTextOptions<ROW, THEME> = DTableBodyCellInputTextOptions<ROW, THEME>\r\n> extends DInputText<THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\t\tthis.on( \"change\", ( newValue: unknown, oldValue: unknown ): void => {\r\n\t\t\tconst row = this._row;\r\n\t\t\tif( row !== undefined ) {\r\n\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis.text = String( value );\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellInputText\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DInputText, DInputTextOptions, DThemeInputText } from \"./d-input-text\";\r\n\r\nexport interface DTableBodyCellInputTreeInputOptions<\r\n\tTHEME extends DThemeTableBodyCellInputTreeInput = DThemeTableBodyCellInputTreeInput\r\n> extends DInputTextOptions<THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeTableBodyCellInputTreeInput extends DThemeInputText {\r\n\r\n}\r\n\r\nexport class DTableBodyCellInputTreeInput<\r\n\tTHEME extends DThemeTableBodyCellInputTreeInput = DThemeTableBodyCellInputTreeInput,\r\n\tOPTIONS extends DTableBodyCellInputTreeInputOptions<THEME> = DTableBodyCellInputTreeInputOptions<THEME>\r\n> extends DInputText<THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellInputTreeInput\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DButtonBase, DButtonBaseOptions, DThemeButtonBase } from \"./d-button-base\";\r\n\r\nexport interface DTableBodyCellInputTreeMarkerOptions<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellInputTreeMarker = DThemeTableBodyCellInputTreeMarker\r\n> extends DButtonBaseOptions<VALUE, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeTableBodyCellInputTreeMarker extends DThemeButtonBase {\r\n\r\n}\r\n\r\nexport class DTableBodyCellInputTreeMarker<\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellInputTreeMarker = DThemeTableBodyCellInputTreeMarker,\r\n\tOPTIONS extends DTableBodyCellInputTreeMarkerOptions<VALUE, THEME> = DTableBodyCellInputTreeMarkerOptions<VALUE, THEME>\r\n> extends DButtonBase<VALUE, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellInputTreeMarker\";\r\n\t}\r\n}\r\n","import { DBaseState } from \"./d-base-state\";\r\n\r\n/**\r\n * Cell states.\r\n */\r\nexport const DTableCellState = {\r\n\t/**\r\n\t * Cells of even rows.\r\n\t */\r\n\tEVEN: DBaseState.CUSTOM << 0,\r\n\r\n\t/**\r\n\t * Start cells in rows.\r\n\t */\r\n\tSTART: DBaseState.CUSTOM << 1,\r\n\r\n\t/**\r\n\t * End cells in rows.\r\n\t */\r\n\tEND: DBaseState.CUSTOM << 2,\r\n\r\n\t/**\r\n\t * Cells of frozen columns.\r\n\t */\r\n\tFROZEN: DBaseState.CUSTOM << 3,\r\n\r\n\t/**\r\n\t * Cells of a right-most frozen column.\r\n\t */\r\n\tFROZEN_END: DBaseState.CUSTOM << 4,\r\n\r\n\t/**\r\n\t * Header cells of columns sorted in the ascending order.\r\n\t */\r\n\tSORTED_ASCENDING: DBaseState.CUSTOM << 5,\r\n\r\n\t/**\r\n\t * Header cells of columns sorted in the descending order.\r\n\t */\r\n\tSORTED_DESCENDING: DBaseState.CUSTOM << 6,\r\n\r\n\t/**\r\n\t * Cells with a link which is opened in a new window.\r\n\t */\r\n\tNEW_WINDOW: DBaseState.CUSTOM << 7,\r\n\r\n\t/**\r\n\t * Cells with child cells.\r\n\t */\r\n\tHAS_CHILDREN: DBaseState.CUSTOM << 8,\r\n\r\n\t/**\r\n\t * Cells opened.\r\n\t */\r\n\tOPENED: DBaseState.CUSTOM << 9\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DLayoutHorizontal, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DTableBodyCellInputTextOptions } from \"./d-table-body-cell-input-text\";\r\nimport { DTableBodyCellInputTreeInput } from \"./d-table-body-cell-input-tree-input\";\r\nimport { DTableBodyCellInputTreeMarker } from \"./d-table-body-cell-input-tree-marker\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableCellState } from \"./d-table-cell-state\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\nexport interface DThemeTableBodyCellInputTree extends DThemeLayoutHorizontal {\r\n\tgetLevelPadding( level: number ): number;\r\n}\r\n\r\nexport class DTableBodyCellInputTree<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellInputTree = DThemeTableBodyCellInputTree\r\n> extends DLayoutHorizontal<THEME> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tprotected _marker!: DTableBodyCellInputTreeMarker;\r\n\tprotected _input!: DTableBodyCellInputTreeInput;\r\n\r\n\tconstructor( options: DTableBodyCellInputTextOptions<ROW> ) {\r\n\t\tsuper({\r\n\t\t\tweight: options.weight,\r\n\t\t\twidth: options.width\r\n\t\t});\r\n\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\r\n\t\t// Marker\r\n\t\tconst marker = new DTableBodyCellInputTreeMarker({\r\n\t\t\tvisible: false,\r\n\t\t\ton: {\r\n\t\t\t\tactive: () => {\r\n\t\t\t\t\tthis.onMarkerActive();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis._marker = marker;\r\n\t\tthis.addChild( marker );\r\n\r\n\t\t// Input\r\n\t\tconst input = new DTableBodyCellInputTreeInput({\r\n\t\t\tweight: 1,\r\n\t\t\ttext: options.text,\r\n\t\t\tediting: options.editing\r\n\t\t});\r\n\t\tthis._input = input;\r\n\t\tinput.on( \"change\", ( newValue: unknown, oldValue: unknown ): void => {\r\n\t\t\tconst row = this._row;\r\n\t\t\tif( row !== undefined ) {\r\n\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.addChild( input );\r\n\t}\r\n\r\n\tprotected onMarkerActive(): void {\r\n\t\tif( this._marker.state & DTableCellState.HAS_CHILDREN ) {\r\n\t\t\tconst row = this.parent;\r\n\t\t\tif( row ) {\r\n\t\t\t\tconst body = row.parent as any;\r\n\t\t\t\tif( body ) {\r\n\t\t\t\t\tconst data = body.data;\r\n\t\t\t\t\tif( data && data.toggle ) {\r\n\t\t\t\t\t\tdata.toggle( this._row );\r\n\t\t\t\t\t\tthis.emit( \"cellchange\", null, null, this._row, this._rowIndex, this._columnIndex, this );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis._input.visible = true;\r\n\t\tthis._input.text = String( value );\r\n\r\n\t\tconst marker = this._marker;\r\n\t\tif( isNumber( supplimental ) ) {\r\n\t\t\tconst isOpened = !! (supplimental & 0x1);\r\n\t\t\tconst hasChildren = !! (supplimental & 0x2);\r\n\t\t\tconst level = (supplimental >> 2);\r\n\t\t\tif( hasChildren ) {\r\n\t\t\t\tif( isOpened ) {\r\n\t\t\t\t\tmarker.setStates( DTableCellState.HAS_CHILDREN | DTableCellState.OPENED, DBaseState.DISABLED );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmarker.setStates( DTableCellState.HAS_CHILDREN, DBaseState.DISABLED | DTableCellState.OPENED );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( isOpened ) {\r\n\t\t\t\t\tmarker.setStates( DBaseState.DISABLED | DTableCellState.OPENED, DTableCellState.HAS_CHILDREN );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmarker.setStates( DBaseState.DISABLED, DTableCellState.HAS_CHILDREN | DTableCellState.OPENED );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tmarker.show();\r\n\t\t\tmarker.width = this.theme.getLevelPadding( level );\r\n\t\t} else {\r\n\t\t\tmarker.setStates( DBaseState.DISABLED, DTableCellState.OPENED | DTableCellState.HAS_CHILDREN );\r\n\t\t\tmarker.hide();\r\n\t\t}\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this._input, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t\tthis._input.visible = false;\r\n\t\tthis._marker.hide();\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellInputTree\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DLink, DLinkChecker, DLinkOptions, DLinkUrlMaker, DThemeLink } from \"./d-link\";\r\nimport { DLinkMenuItemId } from \"./d-link-menu-item-id\";\r\nimport { DLinkTarget } from \"./d-link-target\";\r\nimport { DMenu, DMenuOptions } from \"./d-menu\";\r\nimport {\r\n\tDTableBodyCellButton, DTableBodyCellButtonOptions, DThemeTableBodyCellButton\r\n} from \"./d-table-body-cell-button\";\r\nimport { DTableCellState } from \"./d-table-cell-state\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nexport type DTableBodyCellLinkUrlMaker<ROW> = (\r\n\trow: ROW, rowIndex: number, columnIndex: number, link: DTableBodyCellLink<ROW>\r\n) => string | null | Promise<string | null>;\r\nexport type DTableBodyCellLinkChecker<ROW> = (\r\n\trow: ROW, rowIndex: number, columnIndex: number, link: DTableBodyCellLink<ROW>\r\n) => boolean | Promise<boolean>;\r\n\r\nexport interface DTableBodyCellLinkLinkOptions<ROW> {\r\n\turl?: string | DTableBodyCellLinkUrlMaker<ROW>;\r\n\ttarget?: DLinkTarget;\r\n\tchecker?: DTableBodyCellLinkChecker<ROW>;\r\n\tmenu?: DMenuOptions<DLinkMenuItemId> | DMenu<DLinkMenuItemId>;\r\n}\r\n\r\nexport interface DTableBodyCellLinkOptions<\r\n\tROW,\r\n\tTHEME extends DThemeTableBodyCellLink = DThemeTableBodyCellLink\r\n> extends DTableBodyCellButtonOptions<ROW, THEME> {\r\n\tlink?: DTableBodyCellLinkLinkOptions<ROW>;\r\n}\r\n\r\nexport interface DThemeTableBodyCellLink extends DThemeTableBodyCellButton, DThemeLink {\r\n\r\n}\r\n\r\nexport class DTableBodyCellLink<\r\n\tROW,\r\n\tTHEME extends DThemeTableBodyCellLink = DThemeTableBodyCellLink,\r\n\tOPTIONS extends DTableBodyCellLinkOptions<ROW, THEME> = DTableBodyCellLinkOptions<ROW, THEME>\r\n> extends DTableBodyCellButton<ROW, THEME, OPTIONS> {\r\n\tprotected _link!: DLink;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected toLinkOptions( options: OPTIONS ): DLinkOptions | undefined {\r\n\t\tconst link = options.link;\r\n\t\tif( link ) {\r\n\t\t\treturn {\r\n\t\t\t\turl: this.toUrl( link.url ),\r\n\t\t\t\ttarget: link.target,\r\n\t\t\t\tchecker: this.toChecker( link.checker ),\r\n\t\t\t\tmenu: link.menu\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tprotected toUrl( url?: string | DTableBodyCellLinkUrlMaker<ROW> ): string | DLinkUrlMaker | undefined {\r\n\t\tif( isString( url ) || url == null ) {\r\n\t\t\treturn url;\r\n\t\t} else {\r\n\t\t\treturn () => {\r\n\t\t\t\tconst row = this._row;\r\n\t\t\t\tif( row !== undefined ) {\r\n\t\t\t\t\treturn url( row, this._rowIndex, this._columnIndex, this );\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toChecker( checker?: DTableBodyCellLinkChecker<ROW> ): DLinkChecker | undefined {\r\n\t\tif( checker != null ) {\r\n\t\t\treturn () => {\r\n\t\t\t\tconst row = this._row;\r\n\t\t\t\tif( row !== undefined ) {\r\n\t\t\t\t\treturn checker( row, this._rowIndex, this._columnIndex, this );\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ): void {\r\n\t\tif( options.link && options.link.target === DLinkTarget.NEW_WINDOW ) {\r\n\t\t\toptions.state = ( options.state || DBaseState.NONE ) || DTableCellState.NEW_WINDOW;\r\n\t\t}\r\n\t\tthis._link = new DLink( this.theme, this.toLinkOptions( options ) );\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tprotected initOnClick( options: OPTIONS ): void {\r\n\t\tthis._link.apply( this, ( e ) => this.onActive( e ) );\r\n\t}\r\n\r\n\tget url(): string | null | Promise<string | null> {\r\n\t\treturn this._link.url;\r\n\t}\r\n\r\n\tget menu(): DMenu<DLinkMenuItemId> {\r\n\t\treturn this._link.menu;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellLink\";\r\n\t}\r\n\r\n\tprotected onActive( e: KeyboardEvent | interaction.InteractionEvent ): void {\r\n\t\tthis.emit( \"active\", this );\r\n\t\tconst row = this._row;\r\n\t\tif( row !== undefined ) {\r\n\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\tthis._columnData.setter( row, columnIndex, null );\r\n\t\t\tthis.emit( \"cellchange\", null, null, row, rowIndex, columnIndex, this );\r\n\t\t\tthis.open( this._link.inNewWindow( e ) );\r\n\t\t}\r\n\t}\r\n\r\n\topen( inNewWindow: boolean ): void {\r\n\t\tthis._link.open( inNewWindow );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DSelect, DSelectOptions, DThemeSelect } from \"./d-select\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellSelectMenuOptions<\r\n\tROW = unknown,\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellSelectMenu = DThemeTableBodyCellSelectMenu\r\n> extends DSelectOptions<VALUE, THEME>, DTableBodyCellOptions<ROW> {\r\n\r\n}\r\n\r\nexport interface DThemeTableBodyCellSelectMenu extends DThemeSelect {\r\n\r\n}\r\n\r\nexport class DTableBodyCellSelectMenu<\r\n\tROW = unknown,\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellSelectMenu = DThemeTableBodyCellSelectMenu,\r\n\tOPTIONS extends DTableBodyCellSelectMenuOptions<ROW, VALUE, THEME> = DTableBodyCellSelectMenuOptions<ROW, VALUE, THEME>\r\n> extends DSelect<VALUE, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tconst column = options.column;\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = column.index;\r\n\t\tthis._columnData = column.data;\r\n\t\tthis.on( \"change\", ( newValue: unknown, oldValue: unknown ): void => {\r\n\t\t\tconst row = this._row;\r\n\t\t\tif( row !== undefined ) {\r\n\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis.value = value as VALUE;\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellSelectMenu\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DSelectMultiple, DSelectMultipleOptions, DThemeSelectMultiple } from \"./d-select-multiple\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\n\r\nexport interface DTableBodyCellSelectMultipleOptions<\r\n\tROW = unknown,\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellSelectMultiple = DThemeTableBodyCellSelectMultiple\r\n> extends DSelectMultipleOptions<VALUE, THEME>, DTableBodyCellOptions<ROW> {\r\n\r\n}\r\n\r\nexport interface DThemeTableBodyCellSelectMultiple extends DThemeSelectMultiple {\r\n\r\n}\r\n\r\nexport class DTableBodyCellSelectMultiple<\r\n\tROW = unknown,\r\n\tVALUE = unknown,\r\n\tTHEME extends DThemeTableBodyCellSelectMultiple = DThemeTableBodyCellSelectMultiple,\r\n\tOPTIONS extends DTableBodyCellSelectMultipleOptions<ROW, VALUE, THEME>\r\n\t\t= DTableBodyCellSelectMultipleOptions<ROW, VALUE, THEME>\r\n> extends DSelectMultiple<VALUE, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tconst column = options.column;\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = column.index;\r\n\t\tthis._columnData = column.data;\r\n\t\tthis.on( \"change\", ( newValues: unknown, oldValues: unknown ): void => {\r\n\t\t\tconst row = this._row;\r\n\t\t\tif( row !== undefined ) {\r\n\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\tthis._columnData.setter( row, columnIndex, newValues );\r\n\t\t\t\tthis.emit( \"cellchange\", newValues, oldValues, row, rowIndex, columnIndex, this );\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis.values = value as VALUE[];\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellSelectMultiple\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DThemeBase } from \"./d-base\";\r\nimport { DPadding } from \"./d-padding\";\r\n\r\nexport interface DBasePaddingAdjuster {\r\n\tleft: number;\r\n\ttop: number;\r\n\tright: number;\r\n\tbottom: number;\r\n}\r\n\r\nexport class DBasePaddingAdjustable implements DPadding {\r\n\tprotected _target: DPadding;\r\n\tprotected _adjuster: DBasePaddingAdjuster;\r\n\r\n\tconstructor( target: DPadding ) {\r\n\t\tthis._target = target;\r\n\t\tthis._adjuster = {\r\n\t\t\tleft: 0,\r\n\t\t\ttop: 0,\r\n\t\t\tright: 0,\r\n\t\t\tbottom: 0\r\n\t\t};\r\n\t}\r\n\r\n\tget adjuster(): DBasePaddingAdjuster {\r\n\t\treturn this._adjuster;\r\n\t}\r\n\r\n\tgetTheme(): DThemeBase {\r\n\t\treturn this._target.getTheme();\r\n\t}\r\n\r\n\tsetTheme( theme: DThemeBase ): void {\r\n\t\tthis._target.setTheme( theme );\r\n\t}\r\n\r\n\tgetLeft(): number {\r\n\t\treturn this._target.getLeft() + this._adjuster.left;\r\n\t}\r\n\r\n\tget left(): number | undefined {\r\n\t\treturn this._target.left;\r\n\t}\r\n\r\n\tset left( left: number | undefined ) {\r\n\t\tthis._target.left = left;\r\n\t}\r\n\r\n\tgetTop(): number {\r\n\t\treturn this._target.getTop() + this._adjuster.top;\r\n\t}\r\n\r\n\tget top(): number | undefined {\r\n\t\treturn this._target.top;\r\n\t}\r\n\r\n\tset top( top: number | undefined ) {\r\n\t\tthis._target.top = top;\r\n\t}\r\n\r\n\tgetRight(): number {\r\n\t\treturn this._target.getRight() + this._adjuster.right;\r\n\t}\r\n\r\n\tget right(): number | undefined {\r\n\t\treturn this._target.right;\r\n\t}\r\n\r\n\tset right( right: number | undefined ) {\r\n\t\tthis._target.right = right;\r\n\t}\r\n\r\n\tgetBottom(): number {\r\n\t\treturn this._target.getBottom() + this._adjuster.bottom;\r\n\t}\r\n\r\n\tget bottom(): number | undefined {\r\n\t\treturn this._target.bottom;\r\n\t}\r\n\r\n\tset bottom( bottom: number | undefined ) {\r\n\t\tthis._target.bottom = bottom;\r\n\t}\r\n\r\n\tset( padding: number ): void;\r\n\tset( topAndBottom: number, leftAndRight: number ): void;\r\n\tset( top: number, leftAndRight: number, bottom: number ): void;\r\n\tset( top: number, right: number, bottom: number, left: number ): void;\r\n\tset( top: number, right?: number, bottom?: number, left?: number ) {\r\n\t\tthis._target.set( top, right!, bottom!, left! );\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DBasePaddingAdjustable } from \"./d-base-padding-adjustable\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport {\r\n\tDTableBodyCellButton, DTableBodyCellButtonOptions, DThemeTableBodyCellButton\r\n} from \"./d-table-body-cell-button\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableCellState } from \"./d-table-cell-state\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\nexport interface DTableBodyCellTreeOptions<\r\n\tROW,\r\n\tTHEME extends DThemeTableBodyCellTree = DThemeTableBodyCellTree\r\n> extends DTableBodyCellButtonOptions<ROW, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeTableBodyCellTree extends DThemeTableBodyCellButton {\r\n\tgetLevelPadding( level: number ): number;\r\n}\r\n\r\nexport class DTableBodyCellTree<\r\n\tROW,\r\n\tTHEME extends DThemeTableBodyCellTree = DThemeTableBodyCellTree,\r\n\tOPTIONS extends DTableBodyCellTreeOptions<ROW, THEME> = DTableBodyCellTreeOptions<ROW, THEME>\r\n> extends DTableBodyCellButton<ROW, THEME, OPTIONS> {\r\n\tprotected _padding!: DBasePaddingAdjustable;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis._padding = new DBasePaddingAdjustable( this._padding );\r\n\t}\r\n\r\n\tprotected onActive( e: KeyboardEvent | interaction.InteractionEvent ): void {\r\n\t\tthis.emit( \"active\", this );\r\n\t\tconst row = this._row;\r\n\t\tif( row !== undefined ) {\r\n\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\tthis.emit( \"cellchange\", null, null, row, rowIndex, columnIndex, this );\r\n\r\n\t\t\tconst parent = this.parent;\r\n\t\t\tif( parent ) {\r\n\t\t\t\tconst body = parent.parent as any;\r\n\t\t\t\tif( body ) {\r\n\t\t\t\t\tconst data = body.data;\r\n\t\t\t\t\tif( data && data.toggle ) {\r\n\t\t\t\t\t\tdata.toggle( row );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tthis.text = value;\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\r\n\t\tconst adjuster = this._padding.adjuster;\r\n\t\tif( isNumber( supplimental ) ) {\r\n\t\t\tconst isOpened = !! (supplimental & 0x1);\r\n\t\t\tconst hasChildren = !! (supplimental & 0x2);\r\n\t\t\tconst level = (supplimental >> 2);\r\n\t\t\tif( hasChildren ) {\r\n\t\t\t\tif( isOpened ) {\r\n\t\t\t\t\tthis.setStates( DTableCellState.HAS_CHILDREN | DTableCellState.OPENED, DBaseState.NONE );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setStates( DTableCellState.HAS_CHILDREN, DTableCellState.OPENED );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( isOpened ) {\r\n\t\t\t\t\tthis.setStates( DTableCellState.OPENED, DTableCellState.HAS_CHILDREN );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setStates( DBaseState.NONE, DTableCellState.HAS_CHILDREN | DTableCellState.OPENED );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tadjuster.left = this.theme.getLevelPadding( level );\r\n\t\t} else {\r\n\t\t\tthis.setStates( DBaseState.NONE, DTableCellState.OPENED | DTableCellState.HAS_CHILDREN );\r\n\t\t\tadjuster.left = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellTree\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButton, DButtonOptions, DThemeButton } from \"./d-button\";\r\nimport { DDialogTime, DDialogTimeOptions } from \"./d-dialog-time\";\r\nimport { DPickerDatetimeMask } from \"./d-picker-datetime-mask\";\r\nimport { DPickerTimes } from \"./d-picker-times\";\r\nimport { DTableBodyCell, DTableBodyCellOptions } from \"./d-table-body-cell\";\r\nimport { DTableBodyCells } from \"./d-table-body-cells\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\nimport { isNumber } from \"./util/is-number\";\r\n\r\nexport interface DTableBodyCellTimeOptions<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellTime = DThemeTableBodyCellTime\r\n> extends DButtonOptions<Date, THEME>, DTableBodyCellOptions<ROW> {\r\n\tdialog?: DDialogTimeOptions;\r\n}\r\n\r\nexport interface DThemeTableBodyCellTime extends DThemeButton {\r\n\tgetTextFormatter(): ( value: Date, caller: DTableBodyCellTime ) => string;\r\n\tgetTextValue( state: DBaseState ): Date;\r\n\tnewTextValue(): Date;\r\n}\r\n\r\nexport class DTableBodyCellTime<\r\n\tROW = unknown,\r\n\tTHEME extends DThemeTableBodyCellTime = DThemeTableBodyCellTime,\r\n\tOPTIONS extends DTableBodyCellTimeOptions<ROW, THEME> = DTableBodyCellTimeOptions<ROW, THEME>\r\n> extends DButton<Date, THEME, OPTIONS> implements DTableBodyCell<ROW> {\r\n\tprotected static DIALOG?: DDialogTime;\r\n\tprotected _dialog?: DDialogTime;\r\n\tprotected _dialogOptions?: DDialogTimeOptions;\r\n\tprotected _datetimeMask!: DPickerDatetimeMask;\r\n\tprotected _row?: ROW;\r\n\tprotected _rowIndex!: number;\r\n\tprotected _columnIndex!: number;\r\n\tprotected _columnData!: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tthis._dialogOptions = options.dialog;\r\n\t\tthis._datetimeMask = DPickerTimes.toMask( options.dialog && options.dialog.picker );\r\n\t\tthis._rowIndex = 0;\r\n\t\tthis._columnIndex = options.column.index;\r\n\t\tthis._columnData = options.column.data;\r\n\r\n\t\tsuper.init( options );\r\n\r\n\t\tthis.on( \"active\", (): void => {\r\n\t\t\tconst currentTime = this._textValueComputed.getTime();\r\n\t\t\tconst dialog = this.dialog;\r\n\t\t\tdialog.current = new Date( currentTime );\r\n\t\t\tdialog.new = new Date( currentTime );\r\n\t\t\tdialog.open().then((): void => {\r\n\t\t\t\tconst newValue = dialog.new;\r\n\t\t\t\tconst oldValue = dialog.current;\r\n\t\t\t\tthis.text = new Date( newValue.getTime() );\r\n\t\t\t\tconst row = this._row;\r\n\t\t\t\tif( row !== undefined ) {\r\n\t\t\t\t\tconst rowIndex = this._rowIndex;\r\n\t\t\t\t\tconst columnIndex = this._columnIndex;\r\n\t\t\t\t\tthis._columnData.setter( row, columnIndex, newValue );\r\n\t\t\t\t\tthis.emit( \"cellchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprotected mergeState( stateLocal: DBaseState, stateParent: DBaseState ): DBaseState {\r\n\t\treturn super.mergeState( stateLocal, stateParent ) |\r\n\t\t\t( stateParent & DBaseState.HOVERED ? DBaseState.HOVERED : DBaseState.NONE );\r\n\t}\r\n\r\n\tgetDatetimeMask(): DPickerDatetimeMask {\r\n\t\treturn this._datetimeMask;\r\n\t}\r\n\r\n\tget dialog(): DDialogTime {\r\n\t\tlet dialog = this._dialog;\r\n\t\tif( dialog == null ) {\r\n\t\t\tconst dialogOptions = this._dialogOptions;\r\n\t\t\tif( dialogOptions != null ) {\r\n\t\t\t\tdialog = new DDialogTime( this._dialogOptions );\r\n\t\t\t} else {\r\n\t\t\t\tif( DTableBodyCellTime.DIALOG == null ) {\r\n\t\t\t\t\tDTableBodyCellTime.DIALOG = new DDialogTime();\r\n\t\t\t\t}\r\n\t\t\t\tdialog = DTableBodyCellTime.DIALOG;\r\n\t\t\t}\r\n\t\t\tthis._dialog = dialog;\r\n\t\t}\r\n\t\treturn dialog;\r\n\t}\r\n\r\n\tset(\r\n\t\tvalue: unknown, row: ROW, supplimental: unknown,\r\n\t\trowIndex: number, columnIndex: number,\r\n\t\tforcibly?: boolean\r\n\t): void {\r\n\t\tthis._row = row;\r\n\t\tthis._rowIndex = rowIndex;\r\n\t\tif( value instanceof Date ) {\r\n\t\t\tif( forcibly ) {\r\n\t\t\t\tthis._textValue = value;\r\n\t\t\t\tthis._textValueComputed = value;\r\n\t\t\t\tthis.onTextChange();\r\n\t\t\t\tthis.createOrUpdateText();\r\n\t\t\t} else {\r\n\t\t\t\tthis.text = value;\r\n\t\t\t}\r\n\t\t} else if( isNumber( value ) ) {\r\n\t\t\tconst textValueComputed = this._textValueComputed;\r\n\t\t\tif( textValueComputed.getTime() !== value ) {\r\n\t\t\t\ttextValueComputed.setTime( value );\r\n\t\t\t\tthis.onTextChange();\r\n\t\t\t\tthis.createOrUpdateText();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst columnData = this._columnData;\r\n\t\tDTableBodyCells.setReadOnly( this, row, columnIndex, columnData );\r\n\t\tDTableBodyCells.setRenderable( this, row, columnIndex, columnData );\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tthis._row = undefined;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyCellTime\";\r\n\t}\r\n}\r\n","import { DBaseState } from \"./d-base-state\";\r\n\r\n/**\r\n * Row states.\r\n */\r\nexport const DTableRowState = {\r\n\t/**\r\n\t * Even rows.\r\n\t */\r\n\tEVEN: DBaseState.CUSTOM << 0\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Rectangle, Renderer } from \"pixi.js\";\r\nimport { DBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DLayoutHorizontal, DLayoutHorizontalOptions, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DTableCellState } from \"./d-table-cell-state\";\r\nimport { DTableRowState } from \"./d-table-row-state\";\r\n\r\nexport interface DTableRowOptions<\r\n\tROW,\r\n\tCOLUMN,\r\n\tTHEME extends DThemeTableRow = DThemeTableRow\r\n> extends DLayoutHorizontalOptions<THEME> {\r\n\tcolumns?: COLUMN[];\r\n\tfrozen?: number;\r\n\teven?: boolean;\r\n}\r\n\r\nexport interface DThemeTableRow extends DThemeLayoutHorizontal {\r\n\r\n}\r\n\r\nexport interface DTableRowColumn {\r\n\tweight?: number;\r\n\tfrozen?: boolean;\r\n\toffset: number;\r\n}\r\n\r\nexport abstract class DTableRow<\r\n\tROW,\r\n\tCOLUMN extends DTableRowColumn,\r\n\tTHEME extends DThemeTableRow = DThemeTableRow,\r\n\tOPTIONS extends DTableRowOptions<ROW, COLUMN, THEME> = DTableRowOptions<ROW, COLUMN, THEME>\r\n> extends DLayoutHorizontal<THEME, OPTIONS> {\r\n\tprotected _columns!: COLUMN[];\r\n\tprotected _frozen!: number;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ): void {\r\n\t\tsuper.init( options );\r\n\r\n\t\t// State\r\n\t\tconst even = !! options.even;\r\n\t\tif( even ) {\r\n\t\t\tthis.setState( DTableRowState.EVEN, true );\r\n\t\t}\r\n\r\n\t\t// Frozen\r\n\t\tconst frozen = this._frozen = options.frozen ?? 0;\r\n\r\n\t\t// Cells\r\n\t\tconst columns = this._columns = options.columns || [];\r\n\t\tconst iend = this.toIndexEnd( columns );\r\n\t\tfor( let i = 0, imax = columns.length; i < imax; ++i ) {\r\n\t\t\tconst cell = this.newCell( columns[ i ], i, columns, options );\r\n\t\t\tconst cellState = this.toCellState( even, i, iend, frozen );\r\n\t\t\tif( cellState ) {\r\n\t\t\t\tcell.setState( cellState, true );\r\n\t\t\t}\r\n\t\t\tthis.addChild( cell );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toCellState( even: boolean, index: number, iend: number, frozen: number ): DBaseState {\r\n\t\treturn ( even ? DTableCellState.EVEN : DBaseState.NONE ) |\r\n\t\t\t( index === 0 ? DTableCellState.START : DBaseState.NONE ) |\r\n\t\t\t( index === iend ? DTableCellState.END : DBaseState.NONE ) |\r\n\t\t\t( index < frozen ? DTableCellState.FROZEN : DBaseState.NONE ) |\r\n\t\t\t( index === frozen - 1 ? DTableCellState.FROZEN_END : DBaseState.NONE );\r\n\t}\r\n\r\n\tprotected toIndexEnd( columns: COLUMN[] ): number {\r\n\t\tconst imax = columns.length;\r\n\t\tfor( let i = 0; i < imax; ++i ) {\r\n\t\t\tconst column = columns[ i ];\r\n\t\t\tif( column.weight !== undefined ) {\r\n\t\t\t\treturn imax - 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn imax;\r\n\t}\r\n\r\n\tprotected onRefit(): void {\r\n\t\tsuper.onRefit();\r\n\t\tthis.resetFrozenCellPosition();\r\n\t}\r\n\r\n\tupdateFrozenCellPosition( x: number ): void {\r\n\t\tconst columns = this._columns;\r\n\t\tconst cells = this.children;\r\n\t\tconst frozen = this._frozen;\r\n\t\tfor( let i = 0; i < frozen; ++i ) {\r\n\t\t\tconst column = columns[ i ];\r\n\t\t\tconst cell = cells[ i ];\r\n\t\t\tcell.position.x = -x + column.offset;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected resetFrozenCellPosition(): void {\r\n\t\tconst columns = this._columns;\r\n\t\tconst cells = this.children;\r\n\t\tconst frozen = this._frozen;\r\n\t\tconst x = this.getContentPositionX();\r\n\t\tfor( let i = 0; i < frozen; ++i ) {\r\n\t\t\tconst column = columns[ i ];\r\n\t\t\tconst cell = cells[ i ];\r\n\t\t\tcolumn.offset = cell.position.x;\r\n\t\t\tcell.position.x = -x + column.offset;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected abstract getContentPositionX(): number;\r\n\r\n\tgetClippingRect( target: DBase, result: Rectangle ): void {\r\n\t\tsuper.getClippingRect( target, result );\r\n\r\n\t\tconst frozen = this._frozen;\r\n\t\tif( 0 < frozen && target.parent === this ) {\r\n\t\t\tconst cells = this.children as DBase[];\r\n\t\t\tconst cellIndex = cells.indexOf( target );\r\n\t\t\tif( 0 <= cellIndex ) {\r\n\t\t\t\tif( frozen <= cellIndex ) {\r\n\t\t\t\t\tconst previous = cells[ cellIndex - 1 ];\r\n\t\t\t\t\tconst shiftX = previous.position.x + previous.width;\r\n\t\t\t\t\tresult.x += shiftX;\r\n\t\t\t\t\tresult.width -= shiftX;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trender( renderer: Renderer ) {\r\n\t\tif( this.visible && 0 < this.worldAlpha && this.renderable ) {\r\n\t\t\tthis.renderBefore( renderer );\r\n\t\t\tthis._render( renderer );\r\n\t\t\tconst children = this.children;\r\n\t\t\tfor( let i = children.length - 1; 0 <= i; --i ) {\r\n\t\t\t\tchildren[ i ].render( renderer );\r\n\t\t\t}\r\n\t\t\tthis.renderAfter( renderer );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected abstract newCell(\r\n\t\tcolumn: COLUMN,\r\n\t\tcolumnIndex: number,\r\n\t\tcolumns: COLUMN[],\r\n\t\toptions: OPTIONS\r\n\t): DBase;\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableRow\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"./d-base\";\r\nimport { DTableBodyCell } from \"./d-table-body-cell\";\r\nimport { DTableBodyCellActionDialog } from \"./d-table-body-cell-action-dialog\";\r\nimport { DTableBodyCellActionMenu } from \"./d-table-body-cell-action-menu\";\r\nimport { DTableBodyCellActionPromise } from \"./d-table-body-cell-action-promise\";\r\nimport { DTableBodyCellButton } from \"./d-table-body-cell-button\";\r\nimport { DTableBodyCellCheck } from \"./d-table-body-cell-check\";\r\nimport { DTableBodyCellColor } from \"./d-table-body-cell-color\";\r\nimport { DTableBodyCellDate } from \"./d-table-body-cell-date\";\r\nimport { DTableBodyCellDatetime } from \"./d-table-body-cell-datetime\";\r\nimport { DTableBodyCellIndex } from \"./d-table-body-cell-index\";\r\nimport { DTableBodyCellInputInteger } from \"./d-table-body-cell-input-integer\";\r\nimport { DTableBodyCellInputReal } from \"./d-table-body-cell-input-real\";\r\nimport { DTableBodyCellInputText } from \"./d-table-body-cell-input-text\";\r\nimport { DTableBodyCellInputTree } from \"./d-table-body-cell-input-tree\";\r\nimport { DTableBodyCellLink } from \"./d-table-body-cell-link\";\r\nimport { DTableBodyCellSelectDialog } from \"./d-table-body-cell-select-dialog\";\r\nimport { DTableBodyCellSelectMenu } from \"./d-table-body-cell-select-menu\";\r\nimport { DTableBodyCellSelectMultiple } from \"./d-table-body-cell-select-multiple\";\r\nimport { DTableBodyCellSelectPromise } from \"./d-table-body-cell-select-promise\";\r\nimport { DTableBodyCellText } from \"./d-table-body-cell-text\";\r\nimport { DTableBodyCellTime } from \"./d-table-body-cell-time\";\r\nimport { DTableBodyCellTree } from \"./d-table-body-cell-tree\";\r\nimport {\r\n\tDTableBodyCellOptionsMerged, DTableBodyCellOptionsUnion,\r\n\tDTableColumn, DTableColumnType\r\n} from \"./d-table-column\";\r\nimport { DTableRow, DTableRowOptions, DThemeTableRow } from \"./d-table-row\";\r\n\r\nexport interface DTableBodyRowOptions<\r\n\tROW,\r\n\tTHEME extends DThemeTableBodyRow = DThemeTableBodyRow\r\n> extends DTableRowOptions<ROW, DTableColumn<ROW>, THEME> {\r\n\theight?: number;\r\n\tcell?: Partial<DTableBodyCellOptionsMerged<ROW>>;\r\n}\r\n\r\nexport interface DThemeTableBodyRow extends DThemeTableRow {\r\n\r\n}\r\n\r\nconst isBodyCell = <T>( target: T ): target is T & DTableBodyCell<unknown> => {\r\n\treturn (target != null && \"set\" in target);\r\n};\r\n\r\ntype OnCellChange<ROW> = (\r\n\tnewValue: unknown, oldValue: unknown,\r\n\trow: ROW, rowIndex: number, columnIndex: number\r\n) => void;\r\n\r\nexport class DTableBodyRow<\r\n\tROW,\r\n\tTHEME extends DThemeTableBodyRow = DThemeTableBodyRow,\r\n\tOPTIONS extends DTableBodyRowOptions<ROW, THEME> = DTableBodyRowOptions<ROW, THEME>\r\n> extends DTableRow<ROW, DTableColumn<ROW>, THEME, OPTIONS> {\r\n\tprotected _row: ROW | undefined = undefined;\r\n\tprotected _onCellChangeBound!: OnCellChange<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tthis._onCellChangeBound = ( newValue, oldValue, row, rowIndex, columnIndex ): void => {\r\n\t\t\tthis.emit( \"rowchange\", newValue, oldValue, row, rowIndex, columnIndex, this );\r\n\t\t};\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tprotected newCell(\r\n\t\tcolumn: DTableColumn<ROW>,\r\n\t\tcolumnIndex: number,\r\n\t\tcolumns: Array<DTableColumn<ROW>>,\r\n\t\toptions: OPTIONS\r\n\t): DBase {\r\n\t\tconst cellOptions = this.toCellOptions( column, columnIndex, options ) as any;\r\n\t\tif( column.editing.enable !== false ) {\r\n\t\t\tconst cell = this.newCellEditable( column, columnIndex, cellOptions );\r\n\t\t\tcell.on( \"cellchange\", this._onCellChangeBound );\r\n\t\t\treturn cell;\r\n\t\t} else {\r\n\t\t\tconst cell = this.newCellUnediable( column, columnIndex, cellOptions );\r\n\t\t\tif( column.type === DTableColumnType.TREE ) {\r\n\t\t\t\tcell.on( \"cellchange\", this._onCellChangeBound );\r\n\t\t\t} else {\r\n\t\t\t\tcell.setReadOnly( true );\r\n\t\t\t}\r\n\t\t\treturn cell;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newCellEditable(\r\n\t\tcolumn: DTableColumn<ROW>,\r\n\t\tcolumnIndex: number,\r\n\t\toptions: any\r\n\t): DBase {\r\n\t\tswitch( column.type ) {\r\n\t\tcase DTableColumnType.INDEX:\r\n\t\t\treturn new DTableBodyCellIndex( options );\r\n\t\tcase DTableColumnType.TEXT:\r\n\t\t\treturn new DTableBodyCellInputText( options );\r\n\t\tcase DTableColumnType.TREE:\r\n\t\t\treturn new DTableBodyCellInputTree( options );\r\n\t\tcase DTableColumnType.INTEGER:\r\n\t\t\treturn new DTableBodyCellInputInteger( options );\r\n\t\tcase DTableColumnType.REAL:\r\n\t\t\treturn new DTableBodyCellInputReal( options );\r\n\t\tcase DTableColumnType.CHECK:\r\n\t\tcase DTableColumnType.CHECK_SINGLE:\r\n\t\t\treturn new DTableBodyCellCheck( options );\r\n\t\tcase DTableColumnType.COLOR:\r\n\t\t\treturn new DTableBodyCellColor( options );\r\n\t\tcase DTableColumnType.BUTTON:\r\n\t\t\treturn new DTableBodyCellButton( options );\r\n\t\tcase DTableColumnType.LINK:\r\n\t\t\treturn new DTableBodyCellLink( options );\r\n\t\tcase DTableColumnType.SELECT:\r\n\t\t\treturn this.newCellSelect( column, options );\r\n\t\tcase DTableColumnType.ACTION:\r\n\t\t\treturn this.newCellAction( column, options );\r\n\t\tcase DTableColumnType.DATE:\r\n\t\t\treturn new DTableBodyCellDate( options );\r\n\t\tcase DTableColumnType.DATETIME:\r\n\t\t\treturn new DTableBodyCellDatetime( options );\r\n\t\tcase DTableColumnType.TIME:\r\n\t\t\treturn new DTableBodyCellTime( options );\r\n\t\tdefault:\r\n\t\t\treturn new DTableBodyCellText( options );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newCellUnediable(\r\n\t\tcolumn: DTableColumn<ROW>,\r\n\t\tcolumnIndex: number,\r\n\t\toptions: any\r\n\t): DBase {\r\n\t\tswitch( column.type ) {\r\n\t\tcase DTableColumnType.INDEX:\r\n\t\t\treturn new DTableBodyCellIndex( options );\r\n\t\tcase DTableColumnType.TEXT:\r\n\t\t\treturn new DTableBodyCellText( options );\r\n\t\tcase DTableColumnType.TREE:\r\n\t\t\treturn new DTableBodyCellTree( options );\r\n\t\tcase DTableColumnType.INTEGER:\r\n\t\t\treturn new DTableBodyCellText( options );\r\n\t\tcase DTableColumnType.REAL:\r\n\t\t\treturn new DTableBodyCellText( options );\r\n\t\tcase DTableColumnType.CHECK:\r\n\t\tcase DTableColumnType.CHECK_SINGLE:\r\n\t\t\treturn new DTableBodyCellCheck( options );\r\n\t\tcase DTableColumnType.COLOR:\r\n\t\t\treturn new DTableBodyCellColor( options );\r\n\t\tcase DTableColumnType.BUTTON:\r\n\t\t\treturn new DTableBodyCellButton( options );\r\n\t\tcase DTableColumnType.LINK:\r\n\t\t\treturn new DTableBodyCellLink( options );\r\n\t\tcase DTableColumnType.SELECT:\r\n\t\t\treturn this.newCellSelect( column, options );\r\n\t\tcase DTableColumnType.ACTION:\r\n\t\t\treturn this.newCellAction( column, options );\r\n\t\tcase DTableColumnType.DATE:\r\n\t\t\treturn new DTableBodyCellDate( options );\r\n\t\tcase DTableColumnType.DATETIME:\r\n\t\t\treturn new DTableBodyCellDatetime( options );\r\n\t\tcase DTableColumnType.TIME:\r\n\t\t\treturn new DTableBodyCellTime( options );\r\n\t\tdefault:\r\n\t\t\treturn new DTableBodyCellText( options );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newCellSelect( column: DTableColumn<ROW>, options: any ): DBase {\r\n\t\tconst selecting = column.selecting;\r\n\t\tif( selecting.menu != null ) {\r\n\t\t\treturn new DTableBodyCellSelectMenu( options );\r\n\t\t} else if( selecting.multiple != null ) {\r\n\t\t\treturn new DTableBodyCellSelectMultiple( options );\r\n\t\t} else if( selecting.dialog != null ) {\r\n\t\t\treturn new DTableBodyCellSelectDialog( options );\r\n\t\t} else if( selecting.promise != null ) {\r\n\t\t\treturn new DTableBodyCellSelectPromise( options );\r\n\t\t} else {\r\n\t\t\treturn new DTableBodyCellText( options );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newCellAction( column: DTableColumn<ROW>, options: any ): DBase {\r\n\t\tconst selecting = column.selecting;\r\n\t\tif( selecting.menu != null ) {\r\n\t\t\treturn new DTableBodyCellActionMenu( options );\r\n\t\t} else if( selecting.dialog != null ) {\r\n\t\t\treturn new DTableBodyCellActionDialog( options );\r\n\t\t} else if( selecting.promise != null ) {\r\n\t\t\treturn new DTableBodyCellActionPromise( options );\r\n\t\t} else {\r\n\t\t\treturn new DTableBodyCellText( options );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toCellOptions(\r\n\t\tcolumn: DTableColumn<ROW>,\r\n\t\tcolumnIndex: number,\r\n\t\toptions: OPTIONS\r\n\t): DTableBodyCellOptionsUnion<ROW> {\r\n\t\tlet result = (column.body || options.cell) as DTableBodyCellOptionsMerged<ROW> | undefined;\r\n\t\tif( result != null ) {\r\n\t\t\tresult.weight = column.weight;\r\n\t\t\tresult.width = column.width;\r\n\t\t\tconst text = result.text = result.text || {};\r\n\t\t\tconst align = text.align = text.align || {};\r\n\t\t\talign.horizontal = column.align;\r\n\t\t\ttext.formatter = column.formatter;\r\n\t\t\tresult.column = {\r\n\t\t\t\tindex: columnIndex,\r\n\t\t\t\tdata: column\r\n\t\t\t};\r\n\t\t\tif( column.selecting.menu ) {\r\n\t\t\t\tresult.menu = column.selecting.menu;\r\n\t\t\t}\r\n\t\t\tif( column.selecting.multiple ) {\r\n\t\t\t\tresult.menu = column.selecting.menu;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresult = {\r\n\t\t\t\tweight: column.weight,\r\n\t\t\t\twidth: column.width,\r\n\t\t\t\ttext: {\r\n\t\t\t\t\tformatter: column.formatter,\r\n\t\t\t\t\talign: {\r\n\t\t\t\t\t\thorizontal: column.align\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcolumn: {\r\n\t\t\t\t\tindex: columnIndex,\r\n\t\t\t\t\tdata: column\r\n\t\t\t\t},\r\n\t\t\t\tmenu: column.selecting.menu || column.selecting.multiple\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif( column.editing.enable !== false ) {\r\n\t\t\tconst editing = result.editing = result.editing || {};\r\n\t\t\tediting.formatter = editing.formatter || column.editing.formatter;\r\n\t\t\tediting.unformatter = editing.unformatter || column.editing.unformatter as any;\r\n\t\t\tediting.validator = editing.validator || column.editing.validator as any;\r\n\t\t}\r\n\r\n\t\tif( column.link ) {\r\n\t\t\tresult.link = column.link;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBodyRow\";\r\n\t}\r\n\r\n\tset( row: ROW, supplimental: unknown, rowIndex: number, forcibly?: boolean ): void {\r\n\t\tif( forcibly || this._row !== row ) {\r\n\t\t\tthis._row = row;\r\n\r\n\t\t\tconst cells = this.children;\r\n\t\t\tconst cellsLength = cells.length;\r\n\t\t\tconst columns = this._columns;\r\n\t\t\tconst columnsLength = columns.length;\r\n\t\t\tfor( let i = 0, imax = Math.min( columnsLength, cellsLength ); i < imax; ++i ) {\r\n\t\t\t\tconst cell = cells[ i ];\r\n\t\t\t\tconst column = columns[ i ];\r\n\t\t\t\tif( isBodyCell( cell ) ) {\r\n\t\t\t\t\tcell.set( column.getter( row, i ), row, supplimental, rowIndex, i, forcibly );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit( \"set\", row, rowIndex, this );\r\n\t\t}\r\n\t}\r\n\r\n\tunset(): void {\r\n\t\tif( this._row !== undefined ) {\r\n\t\t\tthis._row = undefined;\r\n\r\n\t\t\tconst cells = this.children;\r\n\t\t\tfor( let i = 0, imax = cells.length; i < imax; ++i ) {\r\n\t\t\t\tconst cell = cells[ i ];\r\n\t\t\t\tif( isBodyCell( cell ) ) {\r\n\t\t\t\t\tcell.unset();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit( \"unset\", this );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getContentPositionX(): number {\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent ) {\r\n\t\t\tconst content = parent.parent;\r\n\t\t\tif( content ) {\r\n\t\t\t\treturn content.position.x;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DTableDataFilter, DTableDataFilterFunction, DTableDataFilterObject } from \"./d-table-data-filter\";\r\nimport { DTableDataSorter } from \"./d-table-data-sorter\";\r\nimport { isFunction } from \"./util/is-function\";\r\n\r\ninterface DTableDataFilterImplParent<ROW> {\r\n\treadonly sorter: DTableDataSorter<ROW>;\r\n\treadonly rows: ROW[];\r\n\tupdate(): void;\r\n}\r\n\r\nexport class DTableDataFilterImpl<ROW> extends utils.EventEmitter implements DTableDataFilter<ROW> {\r\n\tprotected _id: number;\r\n\tprotected _idUpdated: number;\r\n\tprotected _isApplied: boolean;\r\n\tprotected _sorterId: number;\r\n\tprotected _parent: DTableDataFilterImplParent<ROW>;\r\n\tprotected _filter: DTableDataFilterFunction<ROW> | DTableDataFilterObject<ROW> | null;\r\n\tprotected _filtered: number[] | null;\r\n\r\n\tconstructor( parent: DTableDataFilterImplParent<ROW> ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._id = 0;\r\n\t\tthis._idUpdated = -1;\r\n\t\tthis._isApplied = false;\r\n\t\tthis._sorterId = -1;\r\n\r\n\t\tthis._parent = parent;\r\n\t\tthis._filter = null;\r\n\t\tthis._filtered = null;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tapply(): void {\r\n\t\tthis._isApplied = true;\r\n\t\tthis._id += 1;\r\n\t\tthis._parent.update();\r\n\t}\r\n\r\n\tunapply(): void {\r\n\t\tif( this._isApplied ) {\r\n\t\t\tthis._isApplied = false;\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._parent.update();\r\n\t\t}\r\n\t}\r\n\r\n\tisApplied(): boolean {\r\n\t\treturn this._isApplied;\r\n\t}\r\n\r\n\tprotected newFiltered(): number[] | null {\r\n\t\tconst filter = this._filter;\r\n\t\tif( filter != null ) {\r\n\t\t\tconst filtered: number[] = [];\r\n\t\t\tconst parent = this._parent;\r\n\t\t\tconst sorter = parent.sorter;\r\n\t\t\tconst rows = parent.rows;\r\n\t\t\tif( isFunction( filter ) ) {\r\n\t\t\t\tconst indicesSorted = sorter.indices;\r\n\t\t\t\tif( indicesSorted ) {\r\n\t\t\t\t\tfor( let i = 0, imax = indicesSorted.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst indexSorted = indicesSorted[ i ];\r\n\t\t\t\t\t\tif( filter( rows[ indexSorted ], indexSorted ) ) {\r\n\t\t\t\t\t\t\tfiltered.push( i );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor( let i = 0, imax = rows.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tif( filter( rows[ i ], i ) ) {\r\n\t\t\t\t\t\t\tfiltered.push( i );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconst indicesSorted = sorter.indices;\r\n\t\t\t\tif( indicesSorted ) {\r\n\t\t\t\t\tfor( let i = 0, imax = indicesSorted.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tconst indexSorted = indicesSorted[ i ];\r\n\t\t\t\t\t\tif( filter.test( rows[ indexSorted ], indexSorted ) ) {\r\n\t\t\t\t\t\t\tfiltered.push( i );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor( let i = 0, imax = rows.length; i < imax; ++i ) {\r\n\t\t\t\t\t\tif( filter.test( rows[ i ], i ) ) {\r\n\t\t\t\t\t\t\tfiltered.push( i );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn filtered;\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tget(): DTableDataFilterFunction<ROW> | DTableDataFilterObject<ROW> | null {\r\n\t\treturn this._filter;\r\n\t}\r\n\r\n\tset( filter: DTableDataFilterFunction<ROW> | DTableDataFilterObject<ROW> | null ): void {\r\n\t\tif( this._filter !== filter ) {\r\n\t\t\tthis._filter = filter;\r\n\t\t}\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._id += 1;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tif( this._id !== this._idUpdated || this._parent.sorter.id !== this._sorterId ) {\r\n\t\t\tthis._idUpdated = this._id;\r\n\t\t\tthis._sorterId = this._parent.sorter.id;\r\n\t\t\tif( this._isApplied ) {\r\n\t\t\t\tthis._filtered = this.newFiltered();\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t} else if( this._filtered != null ) {\r\n\t\t\t\tthis._filtered = null;\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget indices(): number[] | null {\r\n\t\tthis.update();\r\n\t\treturn this._filtered;\r\n\t}\r\n\r\n\tmap( sortedIndex: number ): number | null {\r\n\t\tlet result = sortedIndex;\r\n\r\n\t\tconst indicesFiltered = this.indices;\r\n\t\tif( indicesFiltered ) {\r\n\t\t\tconst index = indicesFiltered.indexOf( result );\r\n\t\t\tif( 0 <= index ) {\r\n\t\t\t\tresult = index;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tunmap( index: number ): number {\r\n\t\tlet result = index;\r\n\r\n\t\tconst indicesFiltered = this.indices;\r\n\t\tif( indicesFiltered ) {\r\n\t\t\tresult = indicesFiltered[ result ];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n}\r\n","import { DTableData, DTableDataMapped, DTableDataMappedEachIteratee } from \"./d-table-data\";\r\n\r\nexport interface DTableDataListMappedParent<ROW> extends DTableData<ROW> {\r\n\treadonly rows: ROW[];\r\n\treadonly supplimentals?: unknown[];\r\n}\r\n\r\nexport class DTableDataListMapped<ROW> implements DTableDataMapped<ROW> {\r\n\tprotected _parent: DTableDataListMappedParent<ROW>;\r\n\r\n\tconstructor( parent: DTableDataListMappedParent<ROW> ) {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tmap( unmappedIndex: number ): number | null {\r\n\t\tconst parent = this._parent;\r\n\t\tconst sortedIndex = parent.sorter.map( unmappedIndex );\r\n\t\tif( sortedIndex != null ) {\r\n\t\t\treturn parent.filter.map( sortedIndex );\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tunmap( index: number ): number {\r\n\t\tconst parent = this._parent;\r\n\t\treturn parent.sorter.unmap(\r\n\t\t\tparent.filter.unmap( index )\r\n\t\t);\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\tconst parent = this._parent;\r\n\t\tconst indicesFiltered = parent.filter.indices;\r\n\t\treturn ( indicesFiltered != null ? indicesFiltered.length : parent.size() );\r\n\t}\r\n\r\n\tget( index: number ): ROW | null {\r\n\t\tconst parent = this._parent;\r\n\t\treturn parent.get( this.unmap( index ) );\r\n\t}\r\n\r\n\teach( iteratee: DTableDataMappedEachIteratee<ROW>, ifrom?: number, ito?: number ): void {\r\n\t\tconst parent = this._parent;\r\n\t\tconst rows = parent.rows;\r\n\t\tconst supplimentals = parent.supplimentals;\r\n\t\tconst indicesFiltered = parent.filter.indices;\r\n\t\tconst indicesSorted = parent.sorter.indices;\r\n\t\tifrom = ( ifrom != null ? Math.max( 0, ifrom ) : 0 );\r\n\t\tif( indicesFiltered ) {\r\n\t\t\tconst size = indicesFiltered.length;\r\n\t\t\tito = ( ito != null ? Math.min( size, ito ) : size );\r\n\t\t\tif( indicesSorted ) {\r\n\t\t\t\tfor( let i = ifrom; i < ito; ++i ) {\r\n\t\t\t\t\tconst unmappedIndex = indicesSorted[ indicesFiltered[ i ] ];\r\n\t\t\t\t\tconst row = rows[ unmappedIndex ];\r\n\t\t\t\t\tconst supplimental = ( supplimentals ? supplimentals[ unmappedIndex ] : null );\r\n\t\t\t\t\tif( iteratee( row, supplimental, i, unmappedIndex ) === false ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = ifrom; i < ito; ++i ) {\r\n\t\t\t\t\tconst unmappedIndex = indicesFiltered[ i ];\r\n\t\t\t\t\tconst row = rows[ unmappedIndex ];\r\n\t\t\t\t\tconst supplimental = ( supplimentals ? supplimentals[ unmappedIndex ] : null );\r\n\t\t\t\t\tif( iteratee( row, supplimental, i, unmappedIndex ) === false ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst size = rows.length;\r\n\t\t\tito = ( ito != null ? Math.min( size, ito ) : size );\r\n\t\t\tif( indicesSorted ) {\r\n\t\t\t\tfor( let i = ifrom; i < ito; ++i ) {\r\n\t\t\t\t\tconst unmappedIndex = indicesSorted[ i ];\r\n\t\t\t\t\tconst row = rows[ unmappedIndex ];\r\n\t\t\t\t\tconst supplimental = ( supplimentals ? supplimentals[ unmappedIndex ] : null );\r\n\t\t\t\t\tif( iteratee( row, supplimental, i, unmappedIndex ) === false ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = ifrom; i < ito; ++i ) {\r\n\t\t\t\t\tconst row = rows[ i ];\r\n\t\t\t\t\tconst supplimental = ( supplimentals ? supplimentals[ i ] : null );\r\n\t\t\t\t\tif( iteratee( row, supplimental, i, i ) === false ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DTableData } from \"./d-table-data\";\r\nimport { DTableDataSelection, DTableDataSelectionOptions, DTableDataSelectionType } from \"./d-table-data-selection\";\r\nimport { isString } from \"./util/is-string\";\r\n\r\nconst COMPARATOR = ( a: [number, unknown], b: [number, unknown] ): number => {\r\n\treturn a[ 0 ] - b[ 0 ];\r\n};\r\n\r\nexport interface DTableDataSelectionImplParent<ROW> extends DTableData<ROW> {\r\n\tupdate(): void;\r\n}\r\n\r\nexport class DTableDataSelectionImpl<ROW> extends utils.EventEmitter implements DTableDataSelection<ROW> {\r\n\tprotected _parent: DTableDataSelectionImplParent<ROW>;\r\n\tprotected _type: DTableDataSelectionType;\r\n\tprotected _indices: Set<number>;\r\n\r\n\tconstructor( parent: DTableDataSelectionImplParent<ROW>, options?: DTableDataSelectionOptions ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._parent = parent;\r\n\t\tthis._type = this.toType( options );\r\n\t\tthis._indices = new Set<number>();\r\n\t}\r\n\r\n\tprotected toType( options?: DTableDataSelectionOptions ): DTableDataSelectionType {\r\n\t\treturn ( options && options.type != null ?\r\n\t\t\t( isString( options.type ) ? DTableDataSelectionType[ options.type ] : options.type ) :\r\n\t\t\tDTableDataSelectionType.NONE\r\n\t\t);\r\n\t}\r\n\r\n\tget type(): DTableDataSelectionType {\r\n\t\treturn this._type;\r\n\t}\r\n\r\n\tprotected onChange(): void {\r\n\t\tthis._parent.update();\r\n\t\tthis.emit( \"change\", this );\r\n\t}\r\n\r\n\ttoggle( rowIndex: number ): void {\r\n\t\tconst indices = this._indices;\r\n\t\tif( indices.has( rowIndex ) ) {\r\n\t\t\tindices.delete( rowIndex );\r\n\t\t} else {\r\n\t\t\tindices.add( rowIndex );\r\n\t\t}\r\n\t\tthis.onChange();\r\n\t}\r\n\r\n\tadd( rowIndex: number ): void {\r\n\t\tconst indices = this._indices;\r\n\t\tconst oldSize = indices.size;\r\n\t\tindices.add( rowIndex );\r\n\t\tconst newSize = indices.size;\r\n\t\tif( oldSize !== newSize ) {\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tget first(): number | null {\r\n\t\tconst indices = this._indices;\r\n\t\tif( 0 < indices.size ) {\r\n\t\t\tlet result: number = NaN;\r\n\t\t\tindices.forEach(( index: number ): void => {\r\n\t\t\t\tif( result !== result ) {\r\n\t\t\t\t\tresult = index;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tget last(): number | null {\r\n\t\tconst indices = this._indices;\r\n\t\tif( 0 < indices.size ) {\r\n\t\t\tlet result: number = 0;\r\n\t\t\tindices.forEach(( index: number ): void => {\r\n\t\t\t\tresult = index;\r\n\t\t\t});\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\taddTo( rowIndex: number ): void {\r\n\t\tconst lastRowIndex = this.last;\r\n\t\tif( lastRowIndex != null ) {\r\n\t\t\tthis.addRange( lastRowIndex, false, rowIndex, true );\r\n\t\t}\r\n\t}\r\n\r\n\taddRange( from: number, includeFrom: boolean, to: number, includeTo: boolean ): void {\r\n\t\tconst indices = this._indices;\r\n\t\tconst oldSize = indices.size;\r\n\t\tif( from < to ) {\r\n\t\t\tfor( let i = from + (includeFrom ? 0 : 1), imax = to + (includeTo ? 1 : 0); i < imax; ++i ) {\r\n\t\t\t\tindices.add( i );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tfor( let i = to + (includeTo ? 0 : 1), imax = from + (includeFrom ? 1 : 0); i < imax; ++i ) {\r\n\t\t\t\tindices.add( i );\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst newSize = indices.size;\r\n\t\tif( oldSize !== newSize ) {\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\taddAll( rowIndices: number[] ): void {\r\n\t\tconst indices = this._indices;\r\n\t\tconst oldSize = indices.size;\r\n\t\tfor( let i = 0, imax = rowIndices.length; i < imax; ++i ) {\r\n\t\t\tindices.add( rowIndices[ i ] );\r\n\t\t}\r\n\t\tconst newSize = indices.size;\r\n\t\tif( oldSize !== newSize ) {\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tcontains( rowIndex: number ): boolean {\r\n\t\treturn this._indices.has( rowIndex );\r\n\t}\r\n\r\n\tremove( rowIndex: number ): void {\r\n\t\tif( this._indices.delete( rowIndex ) ) {\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tconst indices = this._indices;\r\n\t\tif( 0 < indices.size ) {\r\n\t\t\tindices.clear();\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tclearAndAdd( rowIndex: number ): void {\r\n\t\tconst indices = this._indices;\r\n\t\tif( ! indices.has( rowIndex ) || indices.size !== 1 ) {\r\n\t\t\tindices.clear();\r\n\t\t\tindices.add( rowIndex );\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tclearAndAddAll( rowIndices: number[] ): void {\r\n\t\tconst indices = this._indices;\r\n\t\tif( 0 < indices.size || 0 < rowIndices.length ) {\r\n\t\t\tindices.clear();\r\n\t\t\tfor( let i = 0, imax = rowIndices.length; i < imax; ++i ) {\r\n\t\t\t\tindices.add( rowIndices[ i ] );\r\n\t\t\t}\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tshift( rowIndex: number, amount: number ): void {\r\n\t\tconst shifted: number[] = [];\r\n\t\tconst indices = this._indices;\r\n\t\tindices.forEach(( index: number ): void => {\r\n\t\t\tif( rowIndex <= index ) {\r\n\t\t\t\tshifted.push( index );\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst shiftedLength = shifted.length;\r\n\t\tif( 0 < shiftedLength ) {\r\n\t\t\tfor( let i = 0, imax = shifted.length; i < imax; ++i ) {\r\n\t\t\t\tindices.delete( shifted[ i ] );\r\n\t\t\t}\r\n\t\t\tfor( let i = 0, imax = shifted.length; i < imax; ++i ) {\r\n\t\t\t\tindices.add( shifted[ i ] + amount );\r\n\t\t\t}\r\n\t\t\tthis.onChange();\r\n\t\t}\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._indices.size;\r\n\t}\r\n\r\n\tisEmpty(): boolean {\r\n\t\treturn this._indices.size === 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of an index array of selected rows.\r\n\t * The order of indices is an insertion order.\r\n\t */\r\n\tget indices(): number[] {\r\n\t\tconst result: number[] = [];\r\n\t\tthis._indices.forEach(( index: number ): void => {\r\n\t\t\tresult.push( index );\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a copy of an array of selected row value.\r\n\t * The order is an insertion order.\r\n\t */\r\n\tget rows(): ROW[] {\r\n\t\tconst result: ROW[] = [];\r\n\t\tconst parent = this._parent;\r\n\t\tthis._indices.forEach(( index: number ): void => {\r\n\t\t\tresult.push( parent.get( index )! );\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an array of the (index, row value) pairs of selected rows.\r\n\t * The order of pairs is an insertion order.\r\n\t */\r\n\ttoArray(): Array<[ number, ROW ]> {\r\n\t\tconst result: Array<[ number, ROW ]> = [];\r\n\t\tconst parent = this._parent;\r\n\t\tthis._indices.forEach(( index: number ): void => {\r\n\t\t\tresult.push([ index, parent.get( index )! ]);\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an sorted array of the (index, row value) pairs of selected rows.\r\n\t */\r\n\ttoSortedArray(): Array<[ number, ROW ]> {\r\n\t\treturn this.toArray().sort( COMPARATOR );\r\n\t}\r\n\r\n\ttoObject(): {[index: number]: ROW} {\r\n\t\tconst result: {[index: number]: ROW} = {};\r\n\t\tconst parent = this._parent;\r\n\t\tthis._indices.forEach(( index: number ): void => {\r\n\t\t\tresult[ index ] = parent.get( index )!;\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\ttoMap(): Map<number, ROW> {\r\n\t\tconst result: Map<number, ROW> = new Map<number, ROW>();\r\n\t\tconst parent = this._parent;\r\n\t\tthis._indices.forEach(( index: number ): void => {\r\n\t\t\tresult.set( index, parent.get( index )! );\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\n\r\n/**\r\n * A row comparator function.\r\n */\r\nexport type DTableDataComparatorFunction<ROW> =\r\n\t( rowA: ROW, rowB: ROW, indexA: number, indexB: number ) => number;\r\n\r\n/**\r\n * A row comparator object.\r\n */\r\nexport interface DTableDataComparatorObject<ROW> {\r\n\tcompare( rowA: ROW, rowB: ROW, indexA: number, indexB: number ): number;\r\n}\r\n\r\n/**\r\n * A sort order.\r\n */\r\nexport enum DTableDataOrder {\r\n\tASCENDING,\r\n\tDESCENDING\r\n}\r\n\r\n/**\r\n * Table data sorter.\r\n */\r\nexport interface DTableDataSorter<ROW> extends utils.EventEmitter {\r\n\treadonly id: number;\r\n\r\n\t/**\r\n\t * An indices of sorted rows.\r\n\t * Must not change this indices directly.\r\n\t */\r\n\treadonly indices: number[] | null;\r\n\r\n\t/**\r\n\t * A sort order.\r\n\t */\r\n\torder: DTableDataOrder;\r\n\r\n\t/**\r\n\t * Applys a sorting.\r\n\t */\r\n\tapply(): void;\r\n\r\n\t/**\r\n\t * Unapplys a sorting.\r\n\t */\r\n\tunapply(): void;\r\n\r\n\t/**\r\n\t * Returns true if a sorting is applied.\r\n\t */\r\n\tisApplied(): boolean;\r\n\r\n\t/**\r\n\t * Returns a current comparator.\r\n\t */\r\n\tget(): DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW> | null;\r\n\r\n\t/**\r\n\t * Sets to the given comparator.\r\n\t *\r\n\t * @param comparator A comparator\r\n\t */\r\n\tset( comparator: DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW> | null ): void;\r\n\r\n\t/**\r\n\t * Returns a sorted index of the specified unmapped index.\r\n\t *\r\n\t * @param unmappedIndex an unmapped index\r\n\t */\r\n\tmap( unmappedIndex: number ): number | null;\r\n\r\n\t/**\r\n\t * Returns an unmapped index of the specified sorted index.\r\n\t *\r\n\t * @param index a mapped index\r\n\t */\r\n\tunmap( index: number ): number;\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport {\r\n\tDTableDataComparatorFunction, DTableDataComparatorObject,\r\n\tDTableDataOrder, DTableDataSorter\r\n} from \"./d-table-data-sorter\";\r\nimport { isFunction } from \"./util/is-function\";\r\n\r\nexport interface DTableDataSorterImplParent<ROW> {\r\n\treadonly rows: ROW[];\r\n\tupdate(): void;\r\n}\r\n\r\nexport class DTableDataSorterImpl<ROW> extends utils.EventEmitter implements DTableDataSorter<ROW> {\r\n\tprotected _id: number;\r\n\tprotected _idUpdated: number;\r\n\tprotected _isApplied: boolean;\r\n\tprotected _parent: DTableDataSorterImplParent<ROW>;\r\n\tprotected _comparator: DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW> | null;\r\n\tprotected _sorted: number[] | null;\r\n\tprotected _order: DTableDataOrder;\r\n\r\n\tconstructor( parent: DTableDataSorterImplParent<ROW> ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._id = 0;\r\n\t\tthis._idUpdated = -1;\r\n\t\tthis._isApplied = false;\r\n\t\tthis._parent = parent;\r\n\t\tthis._comparator = null;\r\n\t\tthis._sorted = null;\r\n\t\tthis._order = DTableDataOrder.ASCENDING;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tget order(): DTableDataOrder {\r\n\t\treturn this._order;\r\n\t}\r\n\r\n\tset order( order: DTableDataOrder ) {\r\n\t\tthis._order = order;\r\n\t}\r\n\r\n\tapply(): void {\r\n\t\tthis._isApplied = true;\r\n\t\tthis._id += 1;\r\n\t\tthis._parent.update();\r\n\t}\r\n\r\n\tunapply(): void {\r\n\t\tif( this._isApplied ) {\r\n\t\t\tthis._isApplied = false;\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._parent.update();\r\n\t\t}\r\n\t}\r\n\r\n\tisApplied(): boolean {\r\n\t\treturn this._isApplied;\r\n\t}\r\n\r\n\tprotected newSorted(): number[] | null {\r\n\t\tconst comparator = this._comparator;\r\n\t\tif( comparator != null ) {\r\n\t\t\tconst parent = this._parent;\r\n\t\t\tconst sorted: number[] = [];\r\n\t\t\tconst rows: ROW[] = parent.rows;\r\n\t\t\tfor( let i = 0, imax = rows.length; i < imax; ++i ) {\r\n\t\t\t\tsorted.push( i );\r\n\t\t\t}\r\n\t\t\tsorted.sort( this.toComparator( rows, comparator ) );\r\n\t\t\treturn sorted;\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toComparator(\r\n\t\trows: ROW[],\r\n\t\tcomparator: DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW>\r\n\t): ( indexA: number, indexB: number) => number {\r\n\t\tconst order = this._order;\r\n\t\tif( isFunction( comparator ) ) {\r\n\t\t\tif( order === DTableDataOrder.ASCENDING ) {\r\n\t\t\t\treturn ( indexA: number, indexB: number ): number => {\r\n\t\t\t\t\treturn comparator(\r\n\t\t\t\t\t\trows[ indexA ], rows[ indexB ],\r\n\t\t\t\t\t\tindexA, indexB\r\n\t\t\t\t\t);\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn ( indexA: number, indexB: number ): number => {\r\n\t\t\t\t\treturn comparator(\r\n\t\t\t\t\t\trows[ indexB ], rows[ indexA ],\r\n\t\t\t\t\t\tindexB, indexA\r\n\t\t\t\t\t);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( order === DTableDataOrder.ASCENDING ) {\r\n\t\t\t\treturn ( indexA: number, indexB: number ): number => {\r\n\t\t\t\t\treturn comparator.compare(\r\n\t\t\t\t\t\trows[ indexA ], rows[ indexB ],\r\n\t\t\t\t\t\tindexA, indexB\r\n\t\t\t\t\t);\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\treturn ( indexA: number, indexB: number ): number => {\r\n\t\t\t\t\treturn comparator.compare(\r\n\t\t\t\t\t\trows[ indexB ], rows[ indexA ],\r\n\t\t\t\t\t\tindexB, indexA\r\n\t\t\t\t\t);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget(): DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW> | null {\r\n\t\treturn this._comparator;\r\n\t}\r\n\r\n\tset( comparator: DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW> | null ): void {\r\n\t\tif( this._comparator !== comparator ) {\r\n\t\t\tthis._comparator = comparator;\r\n\t\t}\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._id += 1;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tif( this._id !== this._idUpdated ) {\r\n\t\t\tthis._idUpdated = this._id;\r\n\t\t\tif( this._isApplied ) {\r\n\t\t\t\tthis._sorted = this.newSorted();\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t} else if( this._sorted != null ) {\r\n\t\t\t\tthis._sorted = null;\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget indices(): number[] | null {\r\n\t\tthis.update();\r\n\t\treturn this._sorted;\r\n\t}\r\n\r\n\tmap( unmappedIndex: number ): number | null {\r\n\t\tlet result = unmappedIndex;\r\n\r\n\t\tconst indicesSorted = this.indices;\r\n\t\tif( indicesSorted ) {\r\n\t\t\tconst index = indicesSorted.indexOf( result );\r\n\t\t\tif( 0 <= index ) {\r\n\t\t\t\tresult = index;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tunmap( index: number ): number {\r\n\t\tlet result = index;\r\n\r\n\t\tconst indicesSorted = this.indices;\r\n\t\tif( indicesSorted ) {\r\n\t\t\tresult = indicesSorted[ result ];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DisplayObject, interaction, Texture } from \"pixi.js\";\r\nimport { DBaseOptions } from \"./d-base\";\r\nimport { DContentOptions } from \"./d-content\";\r\nimport { DPane, DPaneOptions, DThemePane } from \"./d-pane\";\r\nimport { DThemeTreeItem, DTreeItem, DTreeItemOptions } from \"./d-tree-item\";\r\nimport { DTreeSelection } from \"./d-tree-selection\";\r\nimport { DThemes } from \"./theme\";\r\n\r\nexport enum DTreeAddedItemPosition {\r\n\tBEFORE,\r\n\tAFTER\r\n}\r\n\r\nexport interface DTreeOptions<\r\n\tTHEME extends DThemeTree = DThemeTree,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\r\n> extends DPaneOptions <THEME, CONTENT_OPTIONS> {\r\n\tvalue: DTreeItemRawData[];\r\n}\r\n\r\nexport interface DThemeTree extends DThemePane {\r\n\r\n}\r\n\r\nexport interface DTreeItemRawData {\r\n\ttext: string;\r\n\timage?: DisplayObject | Texture | null;\r\n\tchildren: DTreeItemRawData[];\r\n}\r\n\r\nexport interface DTreeAddedItemOptions {\r\n\titem: DTreeItemRawData;\r\n\tsibling: DTreeItemRawData;\r\n\tpositon: DTreeAddedItemPosition;\r\n}\r\n\r\nexport class DTree<\r\n\tTHEME extends DThemeTree = DThemeTree,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\r\n\tOPTIONS extends DTreeOptions <THEME, CONTENT_OPTIONS> = DTreeOptions <THEME, CONTENT_OPTIONS>\r\n> extends DPane <THEME, CONTENT_OPTIONS, OPTIONS> {\r\n\tprotected _itemOptions!: WeakMap<DTreeItemRawData, DTreeItemOptions>;\r\n\tprotected _itemOptionsShowable!: DTreeItemOptions[];\r\n\tprotected _selection!: DTreeSelection;\r\n\tprotected _value!: DTreeItemRawData[];\r\n\tprotected _itemIndexMappedStart!: number;\r\n\tprotected _itemIndexMappedEnd!: number;\r\n\tprivate _itemY!: number;\r\n\tprivate _itemHeight!: number;\r\n\tprivate _removeItem!: DTreeItemRawData | null;\r\n\tprivate _addItemOptions!: DTreeAddedItemOptions | null;\r\n\r\n\tprotected init( options ?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\tthis._itemOptions = new WeakMap();\r\n\t\tthis._selection = new DTreeSelection();\r\n\t\tthis._itemOptionsShowable = [];\r\n\t\tthis._itemIndexMappedStart = 0;\r\n\t\tthis._itemIndexMappedEnd = 0;\r\n\t\tthis._itemY = 0;\r\n\r\n\t\tconst itemTheme: DThemeTreeItem = DThemes.getInstance().get( \"DTreeItem\" );\r\n\t\tthis._itemHeight = Number( itemTheme.getHeight() );\r\n\r\n\t\tthis._value = options && options.value ? options.value : [];\r\n\t\tthis.updateData( null, this._value, 0 );\r\n\r\n\t\tthis._content.on( \"move\", (): void => {\r\n\t\t\tthis.update();\r\n\t\t});\r\n\r\n\t\tthis._content.on( \"resize\", (): void => {\r\n\t\t\tthis._content.removeChildren();\r\n\t\t\tthis.update();\r\n\t\t});\r\n\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tprotected update() {\r\n\t\tconst content = this._content;\r\n\t\tconst items = content.children as DTreeItem[] ;\r\n\t\t// calculate content height\r\n\t\tcontent.height = this._itemOptionsShowable.length * this._itemHeight;\r\n\t\tconst contentY = content.position.y;\r\n\t\tconst height = this.height;\r\n\t\tconst itemIndexMappedStart = ( 0 - contentY ) / this._itemHeight - 2 < 0 ?\r\n\t\t\t0 :\r\n\t\t\tMath.floor( ( 0 - contentY ) / this._itemHeight ) - 2;\r\n\r\n\t\tconst itemIndexMappedEnd = ( height - contentY ) / this._itemHeight + 2 < this._itemOptionsShowable.length - 1 ?\r\n\t\t\tMath.floor( ( height - contentY ) / this._itemHeight ) + 2 :\r\n\t\t\tthis._itemOptionsShowable.length;\r\n\r\n\t\t// get items options are shown in Dpane content frame\r\n\t\tconst itemOptionsShown = this._itemOptionsShowable.slice( itemIndexMappedStart, itemIndexMappedEnd );\r\n\r\n\t\tif ( items.length < itemOptionsShown.length ) {\r\n\t\t\tfor ( let i = items.length; i < itemOptionsShown.length; i++ ) {\r\n\t\t\t\tconst itemOptions = itemOptionsShown[ i ];\r\n\t\t\t\tconst treeItem = new DTreeItem( itemOptions );\r\n\t\t\t\tcontent.addChild( treeItem );\r\n\t\t\t\t// listen select item event\r\n\t\t\t\ttreeItem.on( \"select\", ( e: interaction.InteractionEvent ): void => {\r\n\t\t\t\t\tif( !this.isDisabled() ) {\r\n\t\t\t\t\t\tthis.onSelect( treeItem.getRawData(), e );\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// listen toggle item event\r\n\t\t\t\ttreeItem.on( \"toggle\", (): void => {\r\n\t\t\t\t\tif( treeItem.isParent() ) {\r\n\t\t\t\t\t\tif( !this.isDisabled() ) {\r\n\t\t\t\t\t\t\tthis.toggle( treeItem.getRawData() );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t} else if ( items.length > itemOptionsShown.length ) {\r\n\t\t\tfor ( let i = itemOptionsShown.length; i < items.length; i++ ) {\r\n\t\t\t\titems[ i ].hide();\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor ( let i = 0; i < itemOptionsShown.length; i++ ) {\r\n\t\t\titems[ i ] = items[ i ].update( itemOptionsShown[ i ],\r\n\t\t\t\tthis._selection.contains( itemOptionsShown[ i ].rawData ) );\r\n\t\t\tif( items[ i ].isHidden() ) {\r\n\t\t\t\titems[ i ].show();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected reload( expandAll?: boolean ) {\r\n\t\t// reset data of tree widget\r\n\t\tthis._itemOptionsShowable.length = 0;\r\n\t\tthis._itemY = 0;\r\n\t\t// re-render tree\r\n\t\tthis.updateData( null, this._value, 0, expandAll );\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t * Getter method to access raw data.\r\n\t *\r\n\t * @returns raw data.\r\n\t */\r\n\tget value() {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\t/**\r\n\t * Toggle an tree parent item,\r\n\t * Expand an collapsed tree item or collapse an expanded item.\r\n\t *\r\n\t * @param item Reference data of item want to toggle in “value” array.\r\n\t */\r\n\tpublic toggle( item: DTreeItemRawData ) {\r\n\t\t\tconst itemOptions = this._itemOptions.get( item );\r\n\t\t\tif( itemOptions ) {\r\n\t\t\t\titemOptions.expanded = !itemOptions.expanded;\r\n\t\t\t\tthis.reload();\r\n\t\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Expand a collapsed tree item.\r\n\t *\r\n\t * @param item Reference data of item want to expand in “value” array.\r\n\t */\r\n\tpublic expand( item: DTreeItemRawData ) {\r\n\t\tconst itemOptions = this._itemOptions.get( item );\r\n\t\tif( itemOptions ) {\r\n\t\t\titemOptions.expanded = true;\r\n\t\t\tthis.reload();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Collapse an expanded tree item.\r\n\t *\r\n\t * @param item Reference data of item want to collapse in “value” array.\r\n\t */\r\n\tpublic collapse( item: DTreeItemRawData ) {\r\n\t\tconst itemOptions = this._itemOptions.get( item );\r\n\t\tif( itemOptions ) {\r\n\t\t\titemOptions.expanded = false;\r\n\t\t\tthis.reload();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Expand all tree item.\r\n\t */\r\n\tpublic expandAll() {\r\n\t\tthis.reload( true );\r\n\t}\r\n\r\n\t/**\r\n\t * Collapse all tree item.\r\n\t */\r\n\tpublic collapseAll() {\r\n\t\tthis.reload( false );\r\n\t}\r\n\r\n\t/**\r\n\t * Check if an item is collapsed.\r\n\t *\r\n\t * @param item Reference data of item want to check in “value” array.\r\n\t *\r\n\t * @returns collapse status of the item.\r\n\t */\r\n\tpublic isCollapsed( item: DTreeItemRawData ) {\r\n\t\tconst itemOptions = this._itemOptions.get( item );\r\n\t\treturn itemOptions && !itemOptions.expanded;\r\n\t}\r\n\r\n\t/**\r\n\t * Check if an item is expanded.\r\n\t *\r\n\t * @param item Reference data of item want to check in “value” array.\r\n\t *\r\n\t * @returns expand status of the item.\r\n\t */\r\n\tpublic isExpanded( item: DTreeItemRawData ) {\r\n\t\tconst itemOptions = this._itemOptions.get( item );\r\n\t\treturn itemOptions && itemOptions.expanded;\r\n\t}\r\n\r\n\t/**\r\n\t * Clear all tree item.\r\n\t */\r\n\tpublic clear() {\r\n\t\tthis._value = [];\r\n\t\tthis.reload();\r\n\t}\r\n\r\n\t/**\r\n\t * Remove a tree item\r\n\t *\r\n\t * @param item Reference data of item want to remove in “value” array.\r\n\t */\r\n\tpublic remove( item: DTreeItemRawData ) {\r\n\t\tthis._removeItem = item;\r\n\t\tthis.reload();\r\n\t}\r\n\r\n\t/**\r\n\t * Add a tree item\r\n\t *\r\n\t * @param item data of new item want to add to tree.\r\n\t * @param parent Reference data of parent item will contain the adding item.\r\n\t * If the parent is undefined, the item will be added at the top level.\r\n\t * If the parent is not undefined, the item will be inserted as a child of the given parent item.\r\n\t */\r\n\tpublic add( item: DTreeItemRawData, parent?: DTreeItemRawData ) {\r\n\t\tif( parent ) {\r\n\t\t\tif( parent.children ) {\r\n\t\t\t\tparent.children.push( item );\r\n\t\t\t} else {\r\n\t\t\t\tparent.children = [ item ];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._value.push( item );\r\n\t\t}\r\n\t\tthis.reload();\r\n\t}\r\n\r\n\t/**\r\n\t * Add the given item will be inserted before the given sibling item.\r\n\t *\r\n\t * @param item data of new item want to add to tree.\r\n\t * @param sibling Reference data of parent item will be using like anchor to add new item.\r\n\t */\r\n\tpublic addBefore( item: DTreeItemRawData, sibling: DTreeItemRawData ) {\r\n\t\tthis._addItemOptions = {\r\n\t\t\titem,\r\n\t\t\tsibling,\r\n\t\t\tpositon: DTreeAddedItemPosition.BEFORE\r\n\t\t};\r\n\t\tthis.reload();\r\n\t}\r\n\r\n\t/**\r\n\t * Add the given item will be inserted after the given sibling item.\r\n\t *\r\n\t * @param item data of new item want to add to tree.\r\n\t * @param sibling Reference data of parent item will be using like anchor to add new item.\r\n\t */\r\n\tpublic addAfter( item: DTreeItemRawData, sibling: DTreeItemRawData ) {\r\n\t\tthis._addItemOptions = {\r\n\t\t\titem,\r\n\t\t\tsibling,\r\n\t\t\tpositon: DTreeAddedItemPosition.AFTER\r\n\t\t};\r\n\t\tthis.reload();\r\n\t}\r\n\r\n\t/**\r\n\t * Iterate over all the items.\r\n\t *\r\n\t * @param iteratee  boolean function. If the iteratee explicitly returns false, an iteration stops.\r\n\t * @param item data of browsed item.\r\n\t */\r\n\tpublic each( iteratee: (item: DTreeItemRawData) => boolean ): void {\r\n\t\tthis.inOrder(this._value, iteratee);\r\n\t}\r\n\r\n\t/**\r\n\t * The recursive function performs item browsing in the tree.\r\n\t */\r\n\tprivate inOrder(items: DTreeItemRawData[], iteratee: (item: DTreeItemRawData) => boolean) {\r\n\t\tfor (const item of items) {\r\n\t\t\tif(!iteratee (item)) {\r\n\t\t\t\treturn;\r\n\t\t\t} else if( item.children ) {\r\n\t\t\t\tthis.inOrder(item.children, iteratee);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get selection object.\r\n\t * @returns selection.\r\n\t */\r\n\tget selection() {\r\n\t\treturn this._selection;\r\n\t}\r\n\r\n\tprivate updateData(\r\n\t\tparentItemOptions: DTreeItemOptions | null,\r\n\t\titems: DTreeItemRawData[],\r\n\t\tlevel: number,\r\n\t\texpandAll?: boolean\r\n\t\t) {\r\n\r\n\t\tfor ( let i = 0; i < items.length; i++ ) {\r\n\t\t\tconst item = items[ i ];\r\n\t\t\t// handle remove item\r\n\t\t\tif( item === this._removeItem ) {\r\n\t\t\t\t// remove item from this._value.\r\n\t\t\t\titems.splice( i, 1 );\r\n\t\t\t\tthis._removeItem = null;\r\n\t\t\t\ti--;\r\n\t\t\t\tif ( parentItemOptions && items.length === 0 ) {\r\n\t\t\t\t\tparentItemOptions.isParent  = false;\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t// handle add item\r\n\t\t\tif( this._addItemOptions && item === this._addItemOptions.sibling ) {\r\n\t\t\t\tif( this._addItemOptions.positon === DTreeAddedItemPosition.AFTER ) {\r\n\t\t\t\t\titems.splice( i + 1, 0, this._addItemOptions.item );\r\n\t\t\t\t\tthis._addItemOptions = null;\r\n\t\t\t\t} else if ( this._addItemOptions.positon === DTreeAddedItemPosition.BEFORE ) {\r\n\t\t\t\t\titems.splice( i, 0, this._addItemOptions.item );\r\n\t\t\t\t\ti--;\r\n\t\t\t\t\tthis._addItemOptions = null;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst isParent: boolean = item.children && ( item.children.length > 0 );\r\n\t\t\tconst text = item.text ? item.text : \"\";\r\n\r\n\t\t\tconst itemImage = item.image ? item.image : null;\r\n\t\t\tlet isItemExisted = false;\r\n\t\t\tlet itemOptions = this._itemOptions.get( item );\r\n\t\t\tlet expanded = false; // set default expand status of item is false\r\n\t\t\tif( expandAll != null ) {\r\n\t\t\t\texpanded = expandAll;\r\n\t\t\t} else if ( itemOptions ) {\r\n\t\t\t\texpanded = itemOptions.expanded;\r\n\t\t\t}\r\n\r\n\t\t\tif( itemOptions != null ) {\r\n\t\t\t\titemOptions.rawData = item;\r\n\t\t\t\titemOptions.text = text;\r\n\t\t\t\titemOptions.y = this._itemY;\r\n\t\t\t\titemOptions.isParent = isParent;\r\n\t\t\t\titemOptions.expanded = expanded;\r\n\t\t\t\titemOptions.image = itemImage;\r\n\t\t\t\tisItemExisted = true;\r\n\t\t\t} else {\r\n\t\t\t\titemOptions = {\r\n\t\t\t\t\trawData: item,\r\n\t\t\t\t\ttext,\r\n\t\t\t\t\tlevel,\r\n\t\t\t\t\ty: this._itemY,\r\n\t\t\t\t\tisParent,\r\n\t\t\t\t\texpanded,\r\n\t\t\t\t\timage: itemImage\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\t/* displayed items need to satisfy 1 of the 2 conditions:\r\n\t\t\t1. is root item\r\n\t\t\t2. the parent item is show and expand\r\n\t\t\t*/\r\n\t\t\tif ( parentItemOptions == null ||\r\n\t\t\t\t( parentItemOptions &&\r\n\t\t\t\t\tparentItemOptions.expanded &&\r\n\t\t\t\t\tparentItemOptions.showable ) ) {\r\n\t\t\t\titemOptions.showable = true;\r\n\t\t\t\tthis._itemOptionsShowable.push( itemOptions );\r\n\t\t\t\tthis._itemY += this._itemHeight;\r\n\t\t\t} else {\r\n\t\t\t\titemOptions.showable = false;\r\n\t\t\t}\r\n\t\t\tif ( !isItemExisted ) {\r\n\t\t\t\tthis._itemOptions.set( item, itemOptions );\r\n\t\t\t}\r\n\t\t\tif ( item && item.children ) {\r\n\t\t\t\tthis.updateData( itemOptions, item.children, level + 1, expandAll );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onSelect( item: DTreeItemRawData, e: interaction.InteractionEvent ) {\r\n\t\t// multi select by \"ctr\" key + click\r\n\t\tif( e.data.originalEvent.ctrlKey ) {\r\n\t\t\tthis._selection.toggle( item );\r\n\t\t// multi select by \"shift\" key + click\r\n\t\t} else if ( e.data.originalEvent.shiftKey ) {\r\n\t\t\tconst lastSelection = this._selection.get( this._selection.size() - 1 );\r\n\t\t\tif( lastSelection ) {\r\n\t\t\t\tthis._selection.clear();\r\n\t\t\t\tconst selectionY = Number( this._itemOptions.get( item )?.y );\r\n\t\t\t\tconst lastSelectionY = Number( this._itemOptions.get ( lastSelection )?.y );\r\n\t\t\t\tconst maxY = selectionY < lastSelectionY ?\r\n\t\t\t\t\tlastSelectionY - this._itemHeight :\r\n\t\t\t\t\tselectionY;\r\n\t\t\t\tconst minY = selectionY < lastSelectionY ?\r\n\t\t\t\t\tselectionY :\r\n\t\t\t\t\tlastSelectionY + this._itemHeight;\r\n\r\n\t\t\t\tthis._itemOptionsShowable.every( ( itemOptions ) => {\r\n\t\t\t\t\tif( itemOptions.y >= minY && itemOptions.y <= maxY && itemOptions.showable) {\r\n\t\t\t\t\t\tthis._selection.add( itemOptions.rawData );\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn itemOptions.y < maxY;\r\n\t\t\t\t} );\r\n\t\t\t\tthis._selection.add( lastSelection );\r\n\r\n\t\t\t}\r\n\t\t// single select\r\n\t\t} else {\r\n\t\t\tthis._selection.clear();\r\n\t\t\tthis._selection.add( item );\r\n\t\t}\r\n\t\tthis.updateActiveState();\r\n\t}\r\n\r\n\t/* update active state of all shown item.\r\n\t*\r\n\t**/\r\n\tpublic updateActiveState() {\r\n\t\tconst items = this._content.children as DTreeItem[];\r\n\t\titems.forEach( ( item ) => {\r\n\t\t\titem.updateActiveState( this._selection.contains( item.getRawData() ) );\r\n\t\t});\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTree\";\r\n\t}\r\n}\r\n","import { utils } from \"pixi.js\";\r\nimport { DTableData, DTableDataMapped, DTableDataOptions, DTableDataParent } from \"./d-table-data\";\r\nimport { DTableDataFilter } from \"./d-table-data-filter\";\r\nimport { DTableDataFilterImpl } from \"./d-table-data-filter-impl\";\r\nimport { DTableDataListMapped } from \"./d-table-data-list-mapped\";\r\nimport { DTableDataSelection } from \"./d-table-data-selection\";\r\nimport { DTableDataSelectionImpl } from \"./d-table-data-selection-impl\";\r\nimport { DTableDataSorter } from \"./d-table-data-sorter\";\r\nimport { DTableDataSorterImpl } from \"./d-table-data-sorter-impl\";\r\n\r\nexport interface DTableDataListOptions<ROW> extends DTableDataOptions<ROW> {\r\n\trows?: ROW[];\r\n}\r\n\r\nexport class DTableDataList<ROW> extends utils.EventEmitter implements DTableData<ROW> {\r\n\tprotected _parent: DTableDataParent | null;\r\n\tprotected _rows: ROW[];\r\n\tprotected _filter: DTableDataFilterImpl<ROW>;\r\n\tprotected _sorter: DTableDataSorterImpl<ROW>;\r\n\tprotected _selection: DTableDataSelectionImpl<ROW>;\r\n\tprotected _mapped: DTableDataMapped<ROW>;\r\n\r\n\tconstructor( options?: DTableDataListOptions<ROW> ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._parent = null;\r\n\t\tthis._mapped = new DTableDataListMapped<ROW>( this );\r\n\t\tthis._rows = this.toRows( options && options.rows );\r\n\t\tthis._selection = new DTableDataSelectionImpl<ROW>( this, options && options.selection );\r\n\t\tthis._filter = new DTableDataFilterImpl<ROW>( this );\r\n\t\tthis._sorter = new DTableDataSorterImpl<ROW>( this );\r\n\t\tif( options ) {\r\n\t\t\t// Filter\r\n\t\t\tconst filter = options.filter;\r\n\t\t\tif( filter ) {\r\n\t\t\t\tthis._filter.set( filter );\r\n\t\t\t}\r\n\r\n\t\t\t// Comparator\r\n\t\t\tconst comparator = options.comparator;\r\n\t\t\tif( comparator ) {\r\n\t\t\t\tthis._sorter.set( comparator );\r\n\t\t\t}\r\n\r\n\t\t\t// Events\r\n\t\t\tconst on = options.on;\r\n\t\t\tif( on ) {\r\n\t\t\t\tfor( const name in on ) {\r\n\t\t\t\t\tconst handler = on[ name ];\r\n\t\t\t\t\tif( handler ) {\r\n\t\t\t\t\t\tthis.on( name, handler );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tbind( parent: DTableDataParent ): void {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tprotected toRows( row?: ROW[] ): ROW[] {\r\n\t\tconst result: ROW[] = [];\r\n\t\tif( row != null ) {\r\n\t\t\tfor( let i = 0, imax = row.length; i < imax; ++i ) {\r\n\t\t\t\tresult.push( row[ i ] );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tget rows(): ROW[] {\r\n\t\treturn this._rows;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tconst parent = this._parent;\r\n\t\tif( parent ) {\r\n\t\t\tparent.update();\r\n\t\t}\r\n\t}\r\n\r\n\tlock(): void {\r\n\t\tconst parent = this._parent;\r\n\t\tif( parent ) {\r\n\t\t\tparent.lock();\r\n\t\t}\r\n\t}\r\n\r\n\tunlock(): void {\r\n\t\tconst parent = this._parent;\r\n\t\tif( parent ) {\r\n\t\t\tparent.unlock( false );\r\n\t\t\tparent.update();\r\n\t\t}\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this._rows.length;\r\n\t}\r\n\r\n\tclear(): void {\r\n\t\tconst rows = this._rows;\r\n\t\tif( 0 < rows.length ) {\r\n\t\t\trows.length = 0;\r\n\t\t\tthis.lock();\r\n\t\t\tthis._selection.clear();\r\n\t\t\tthis._sorter.toDirty();\r\n\t\t\tthis._filter.toDirty();\r\n\t\t\tthis.unlock();\r\n\t\t}\r\n\t}\r\n\r\n\tclearAndAdd( row: ROW ): void {\r\n\t\tconst rows = this._rows;\r\n\t\trows.length = 0;\r\n\t\trows.push( row );\r\n\t\tthis.lock();\r\n\t\tthis._selection.clear();\r\n\t\tthis._sorter.toDirty();\r\n\t\tthis._filter.toDirty();\r\n\t\tthis.unlock();\r\n\t}\r\n\r\n\tclearAndAddAll( newRows: ROW[] ): void {\r\n\t\tconst rows = this._rows;\r\n\t\trows.length = 0;\r\n\t\tfor( let i = 0, imax = newRows.length; i < imax; ++i ) {\r\n\t\t\trows.push( newRows[ i ] );\r\n\t\t}\r\n\t\tthis.lock();\r\n\t\tthis._selection.clear();\r\n\t\tthis._sorter.toDirty();\r\n\t\tthis._filter.toDirty();\r\n\t\tthis.unlock();\r\n\t}\r\n\r\n\tadd( row: ROW, index?: number ): void {\r\n\t\tconst rows = this._rows;\r\n\t\tconst selection = this._selection;\r\n\t\tconst sorter = this._sorter;\r\n\t\tconst filter = this._filter;\r\n\t\tif( index == null ) {\r\n\t\t\trows.push( row );\r\n\t\t\tthis.lock();\r\n\t\t\tsorter.toDirty();\r\n\t\t\tfilter.toDirty();\r\n\t\t\tthis.unlock();\r\n\t\t} else if( 0 <= index && index < rows.length ) {\r\n\t\t\trows.splice( index, 0, row );\r\n\t\t\tthis.lock();\r\n\t\t\tselection.shift( index, 1 );\r\n\t\t\tsorter.toDirty();\r\n\t\t\tfilter.toDirty();\r\n\t\t\tthis.unlock();\r\n\t\t}\r\n\t}\r\n\r\n\taddAll( newRows: ROW[], index?: number ): void {\r\n\t\tconst rows = this._rows;\r\n\t\tconst rowsLength = rows.length;\r\n\t\tconst selection = this._selection;\r\n\t\tconst sorter = this._sorter;\r\n\t\tconst filter = this._filter;\r\n\t\tif( index == null ) {\r\n\t\t\tconst newRowsLength = newRows.length;\r\n\t\t\tfor( let i = 0, imax = newRowsLength; i < imax; ++i ) {\r\n\t\t\t\trows.push( newRows[ i ] );\r\n\t\t\t}\r\n\t\t\tthis.lock();\r\n\t\t\tsorter.toDirty();\r\n\t\t\tfilter.toDirty();\r\n\t\t\tthis.unlock();\r\n\t\t} else if( 0 <= index && index < rowsLength ) {\r\n\t\t\tconst newRowsLength = newRows.length;\r\n\t\t\tfor( let i = 0; i < newRowsLength; ++i ) {\r\n\t\t\t\trows.splice( index + i, 0, newRows[ i ] );\r\n\t\t\t}\r\n\t\t\tthis.lock();\r\n\t\t\tselection.shift( index, newRowsLength );\r\n\t\t\tsorter.toDirty();\r\n\t\t\tfilter.toDirty();\r\n\t\t\tthis.unlock();\r\n\t\t}\r\n\t}\r\n\r\n\tget( index: number ): ROW | null {\r\n\t\tconst rows = this._rows;\r\n\t\tif( 0 <= index && index < rows.length ) {\r\n\t\t\treturn rows[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tset( index: number, row: ROW ): ROW | null {\r\n\t\tconst rows = this._rows;\r\n\t\tif( 0 <= index && index < rows.length ) {\r\n\t\t\tconst result = rows[ index ];\r\n\t\t\trows[ index ] = row;\r\n\t\t\tthis.lock();\r\n\t\t\tthis._sorter.toDirty();\r\n\t\t\tthis._filter.toDirty();\r\n\t\t\tthis.unlock();\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tremove( index: number ): ROW | null {\r\n\t\tconst rows = this._rows;\r\n\t\tif( 0 <= index && index < rows.length ) {\r\n\t\t\tconst result = rows.splice( index, 1 )[ 0 ];\r\n\t\t\tthis.lock();\r\n\t\t\tthis._selection.remove( index );\r\n\t\t\tthis._sorter.toDirty();\r\n\t\t\tthis._filter.toDirty();\r\n\t\t\tthis.unlock();\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\teach( iteratee: ( row: ROW, index: number ) => boolean | void, ifrom?: number, ito?: number ): void {\r\n\t\tconst rows = this._rows;\r\n\t\tifrom = ( ifrom != null ? Math.max( 0, ifrom ) : 0 );\r\n\t\tito = ( ito != null ? Math.min( rows.length, ito ) : rows.length );\r\n\t\tfor( let i = ifrom; i < ito; ++i ) {\r\n\t\t\tconst row = rows[ i ];\r\n\t\t\tif( iteratee( row, i ) === false ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget selection(): DTableDataSelection<ROW> {\r\n\t\treturn this._selection;\r\n\t}\r\n\r\n\tget filter(): DTableDataFilter<ROW> {\r\n\t\treturn this._filter;\r\n\t}\r\n\r\n\tget sorter(): DTableDataSorter<ROW> {\r\n\t\treturn this._sorter;\r\n\t}\r\n\r\n\tget mapped(): DTableDataMapped<ROW> {\r\n\t\treturn this._mapped;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction, Point, Rectangle } from \"pixi.js\";\r\nimport InteractionEvent = interaction.InteractionEvent;\r\nimport { DBase, DBaseOptions, DThemeBase } from \"./d-base\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DButtonBase } from \"./d-button-base\";\r\nimport { DTableBodyRow, DTableBodyRowOptions } from \"./d-table-body-row\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\nimport { DTableData, DTableDataOptions } from \"./d-table-data\";\r\nimport { DTableDataList, DTableDataListOptions } from \"./d-table-data-list\";\r\nimport { DTableDataSelection, DTableDataSelectionType } from \"./d-table-data-selection\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DTableBodyOptions<\r\n\tROW,\r\n\tDATA extends DTableData<ROW> = DTableDataList<ROW>,\r\n\tTHEME extends DThemeTableBody = DThemeTableBody\r\n> extends DBaseOptions<THEME> {\r\n\tcolumns?: Array<DTableColumn<ROW>>;\r\n\trow?: DTableBodyRowOptions<ROW>;\r\n\tdata?: DTableDataListOptions<ROW> | DATA;\r\n\toffset?: number;\r\n\tfrozen?: number;\r\n}\r\n\r\nexport interface DThemeTableBody extends DThemeBase {\r\n\tgetRowHeight(): number;\r\n}\r\n\r\nconst toRowOptions = <ROW, DATA extends DTableData<ROW>>(\r\n\ttheme: DThemeTableBody,\r\n\toptions: DTableBodyOptions<ROW, DATA>,\r\n\tselectionType: DTableDataSelectionType\r\n): DTableBodyRowOptions<ROW> => {\r\n\tconst columns = options.columns || [];\r\n\tlet result = options.row;\r\n\tif( result != null ) {\r\n\t\tif( result.height == null ) {\r\n\t\t\tresult.height = theme.getRowHeight();\r\n\t\t}\r\n\t\tif( result.columns === undefined ) {\r\n\t\t\tresult.columns = columns;\r\n\t\t}\r\n\t\tif( result.interactive == null && selectionType !== DTableDataSelectionType.NONE ) {\r\n\t\t\tresult.interactive = \"SELF\";\r\n\t\t}\r\n\t\tif( result.frozen == null ) {\r\n\t\t\tresult.frozen = options.frozen;\r\n\t\t}\r\n\t} else {\r\n\t\tresult = {\r\n\t\t\tcolumns,\r\n\t\t\theight: theme.getRowHeight(),\r\n\t\t\tinteractive: ( selectionType !== DTableDataSelectionType.NONE ? \"SELF\" : undefined ),\r\n\t\t\tfrozen: options.frozen\r\n\t\t};\r\n\t}\r\n\treturn result as DTableBodyRowOptions<ROW>;\r\n};\r\n\r\nconst isDTableData = <ROW>( target?: ROW[] | DTableDataOptions<ROW> | DTableData<ROW> ): target is DTableData<ROW> => {\r\n\treturn ( target != null && \"mapped\" in target );\r\n};\r\n\r\ntype OnRowChange<ROW> = (\r\n\tnewValue: unknown, oldValue: unknown,\r\n\trow: ROW, rowIndex: number, columnIndex: number\r\n) => void;\r\n\r\nexport class DTableBody<\r\n\tROW,\r\n\tDATA extends DTableData<ROW> = DTableDataList<ROW>,\r\n\tTHEME extends DThemeTableBody = DThemeTableBody,\r\n\tOPTIONS extends DTableBodyOptions<ROW, DATA, THEME> = DTableBodyOptions<ROW, DATA, THEME>\r\n> extends DBase<THEME, OPTIONS> {\r\n\tprotected static WORK_ON_CLICK = new Point();\r\n\tprotected _columns!: Array<DTableColumn<ROW>>;\r\n\tprotected _rowHeight!: number;\r\n\tprotected _rowIndexMappedStart!: number;\r\n\tprotected _rowIndexMappedEnd!: number;\r\n\tprotected _rowOptions!: DTableBodyRowOptions<ROW>;\r\n\tprotected _updateRowsCount!: number;\r\n\tprotected _isUpdateRowsCalled!: boolean;\r\n\tprotected _isUpdateRowsCalledForcibly!: boolean;\r\n\tprotected _workRows!: Array<DTableBodyRow<ROW>>;\r\n\tprotected _onRowChangeBound!: OnRowChange<ROW>;\r\n\r\n\tprotected _data!: DATA;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis.setState( DBaseState.UNFOCUSABLE, true );\r\n\t\tthis._data.emit( \"init\", this._data );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tthis.transform.position.y = options.offset || 0;\r\n\t\tthis._onRowChangeBound = ( newValue, oldValue, row, rowIndex, columnIndex ): void => {\r\n\t\t\tdata.emit( \"change\", newValue, oldValue, row, rowIndex, columnIndex, data );\r\n\t\t};\r\n\t\tsuper.init( options );\r\n\r\n\t\tconst data = ( isDTableData( options.data ) ? options.data :\r\n\t\t\tnew DTableDataList<ROW>( options.data ) as unknown as DATA\r\n\t\t);\r\n\t\tthis._data = data;\r\n\t\tdata.bind( this );\r\n\t\tconst theme = this.theme;\r\n\t\tconst rowOptions = toRowOptions( theme, options, data.selection.type );\r\n\t\tthis._rowOptions = rowOptions;\r\n\t\tthis._rowHeight = ( rowOptions.height != null ? rowOptions.height : theme.getRowHeight() );\r\n\t\tthis._columns = rowOptions.columns || [];\r\n\t\tthis._rowIndexMappedStart = 0;\r\n\t\tthis._rowIndexMappedEnd = 0;\r\n\t\tthis._updateRowsCount = 0;\r\n\t\tthis._isUpdateRowsCalled = false;\r\n\t\tthis._isUpdateRowsCalledForcibly = false;\r\n\t\tthis._workRows = [];\r\n\t}\r\n\r\n\tonResize( newWidth: number, newHeight: number, oldWidth: number, oldHeight: number ): void {\r\n\t\tsuper.onResize( newWidth, newHeight, oldWidth, oldHeight );\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tget selection(): DTableDataSelection<ROW> {\r\n\t\treturn this._data.selection;\r\n\t}\r\n\r\n\tlock(): void {\r\n\t\tthis._updateRowsCount += 1;\r\n\t\tif( this._updateRowsCount === 1 ) {\r\n\t\t\tthis._isUpdateRowsCalled = false;\r\n\t\t\tthis._isUpdateRowsCalledForcibly = false;\r\n\t\t}\r\n\t}\r\n\r\n\tunlock( callIfNeeded: boolean ): void {\r\n\t\tthis._updateRowsCount -= 1;\r\n\t\tif( this._updateRowsCount === 0 ) {\r\n\t\t\tif( callIfNeeded && this._isUpdateRowsCalled ) {\r\n\t\t\t\tthis.update( this._isUpdateRowsCalledForcibly );\r\n\t\t\t}\r\n\t\t\tthis._isUpdateRowsCalled = false;\r\n\t\t\tthis._isUpdateRowsCalledForcibly = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates rows. If the `forcibly` is true, some dirty checkings for\r\n\t * avoiding unnecessary state changes are skipped.\r\n\t *\r\n\t * @param forcibly true to update forcibly\r\n\t */\r\n\tupdate( forcibly?: boolean ): void {\r\n\t\tif( 0 < this._updateRowsCount ) {\r\n\t\t\tthis._isUpdateRowsCalled = true;\r\n\t\t\tif( forcibly ) {\r\n\t\t\t\tthis._isUpdateRowsCalledForcibly = true;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst content = this.parent;\r\n\t\tconst rows = this.children as Array<DTableBodyRow<ROW>>;\r\n\t\tconst height = content.parent.height;\r\n\t\tconst rowHeight = this._rowHeight;\r\n\r\n\t\tconst data = this._data;\r\n\t\tconst dataMappedSize = data.mapped.size();\r\n\r\n\t\tconst oldRowIndexMappedStart = this._rowIndexMappedStart;\r\n\t\tlet oldRowIndexMappedEnd = this._rowIndexMappedEnd;\r\n\t\tlet oldRowCount = oldRowIndexMappedEnd - oldRowIndexMappedStart;\r\n\r\n\t\tconst y = this.transform.position.y;\r\n\t\tconst newHeight = y + dataMappedSize * rowHeight;\r\n\t\tconst newContentHeight = Math.max( height, newHeight );\r\n\t\tconst newContentY = Math.max( height - newContentHeight, content.position.y );\r\n\r\n\t\tconst newRowIndexMappedLowerBound = Math.floor( (0 - (newContentY + y)) / rowHeight );\r\n\t\tconst newRowIndexMappedUpperBound = Math.floor( (height - (newContentY + y)) / rowHeight );\r\n\t\tconst newRowIndexMappedStart = newRowIndexMappedLowerBound - ( newRowIndexMappedLowerBound % 2 === 0 ? 2 : 1 );\r\n\t\tlet newRowIndexMappedEnd = newRowIndexMappedUpperBound +\r\n\t\t\t((newRowIndexMappedUpperBound - newRowIndexMappedStart + 1) % 2 === 0 ? 3 : 2);\r\n\t\tlet newRowCount = newRowIndexMappedEnd - newRowIndexMappedStart;\r\n\t\tif( newRowCount < oldRowCount && oldRowCount - 2 <= newRowCount ) {\r\n\t\t\tnewRowCount = oldRowCount;\r\n\t\t\tnewRowIndexMappedEnd = newRowIndexMappedStart + newRowCount;\r\n\t\t}\r\n\r\n\t\tif( oldRowCount < newRowCount ) {\r\n\t\t\tfor( let i = oldRowCount; i < newRowCount; ++i ) {\r\n\t\t\t\tconst oldRowIndexMapped = oldRowIndexMappedStart + i;\r\n\t\t\t\tconst newRow = this.newRow( (oldRowIndexMapped % 2) === 0 );\r\n\t\t\t\tthis.addChild( newRow );\r\n\t\t\t}\r\n\t\t\toldRowCount = newRowCount;\r\n\t\t\toldRowIndexMappedEnd = oldRowIndexMappedStart + oldRowCount;\r\n\t\t} else if( newRowCount < oldRowCount ) {\r\n\t\t\tfor( let i = oldRowCount - 1; newRowCount <= i; --i ) {\r\n\t\t\t\tthis.removeChild( rows[ i ] );\r\n\t\t\t}\r\n\t\t\toldRowCount = newRowCount;\r\n\t\t\toldRowIndexMappedEnd = oldRowIndexMappedStart + oldRowCount;\r\n\t\t}\r\n\r\n\t\tthis._rowIndexMappedStart = newRowIndexMappedStart;\r\n\t\tthis._rowIndexMappedEnd = newRowIndexMappedEnd;\r\n\r\n\t\tconst rowIndexMappedStartDelta = newRowIndexMappedStart - oldRowIndexMappedStart;\r\n\t\tconst rowIndexMappedStartDeltaAbs = Math.abs(rowIndexMappedStartDelta);\r\n\t\tconst rowsLength = rows.length;\r\n\t\tif( 0 < rowIndexMappedStartDeltaAbs && rowIndexMappedStartDeltaAbs < rowsLength ) {\r\n\t\t\tconst work = this._workRows;\r\n\t\t\tif( 0 < rowIndexMappedStartDelta ) {\r\n\t\t\t\tfor( let i = 0; i < rowIndexMappedStartDeltaAbs; ++i ) {\r\n\t\t\t\t\twork.push( this.resetRow( rows[ i ] ) );\r\n\t\t\t\t}\r\n\t\t\t\tfor( let i = rowIndexMappedStartDeltaAbs; i < rowsLength; ++i ) {\r\n\t\t\t\t\trows[ i - rowIndexMappedStartDeltaAbs ] = rows[ i ];\r\n\t\t\t\t}\r\n\t\t\t\tfor( let i = 0; i < rowIndexMappedStartDeltaAbs; ++i ) {\r\n\t\t\t\t\trows[ rowsLength - rowIndexMappedStartDeltaAbs + i ] = work[ i ];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tfor( let i = 0; i < rowIndexMappedStartDeltaAbs; ++i ) {\r\n\t\t\t\t\twork.push( this.resetRow( rows[ rowsLength - rowIndexMappedStartDeltaAbs + i ] ) );\r\n\t\t\t\t}\r\n\t\t\t\tfor( let i = rowsLength - rowIndexMappedStartDeltaAbs - 1; 0 <= i; --i ) {\r\n\t\t\t\t\trows[ i + rowIndexMappedStartDeltaAbs ] = rows[ i ];\r\n\t\t\t\t}\r\n\t\t\t\tfor( let i = 0; i < rowIndexMappedStartDeltaAbs; ++i ) {\r\n\t\t\t\t\trows[ i ] = work[ i ];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\twork.length = 0;\r\n\t\t}\r\n\r\n\t\tconst selection = data.selection;\r\n\t\tdata.mapped.each(( datum: ROW, supplimental: unknown, index: number, unmappedIndex: number ): void | boolean => {\r\n\t\t\tconst row = rows[ index - newRowIndexMappedStart ];\r\n\t\t\trow.position.y = index * rowHeight;\r\n\t\t\tif( selection.contains( unmappedIndex ) ) {\r\n\t\t\t\trow.setStates( DBaseState.ACTIVE, DBaseState.DISABLED );\r\n\t\t\t} else {\r\n\t\t\t\trow.setStates( DBaseState.NONE, DBaseState.ACTIVE | DBaseState.DISABLED );\r\n\t\t\t}\r\n\t\t\trow.set( datum, supplimental, unmappedIndex, forcibly );\r\n\t\t}, newRowIndexMappedStart, newRowIndexMappedStart + rowsLength );\r\n\r\n\t\tfor( let i = 0; newRowIndexMappedStart + i < 0 && i < rowsLength; ++i ) {\r\n\t\t\tconst row = rows[ i ];\r\n\t\t\trow.position.y = ( newRowIndexMappedStart + i ) * rowHeight;\r\n\t\t\trow.setStates( DBaseState.DISABLED, DBaseState.ACTIVE );\r\n\t\t\trow.unset();\r\n\t\t}\r\n\r\n\t\tfor( let i = rowsLength - 1; dataMappedSize <= newRowIndexMappedStart + i && 0 <= i; --i ) {\r\n\t\t\tconst row = rows[ i ];\r\n\t\t\trow.position.y = ( newRowIndexMappedStart + i ) * rowHeight;\r\n\t\t\trow.setStates( DBaseState.DISABLED, DBaseState.ACTIVE );\r\n\t\t\trow.unset();\r\n\t\t}\r\n\r\n\t\tthis.lock();\r\n\t\tcontent.position.y = newContentY;\r\n\t\tcontent.height = newContentHeight;\r\n\t\tthis.height = newHeight;\r\n\t\tthis.unlock( false );\r\n\t}\r\n\r\n\tprotected resetRow( row: DTableBodyRow<ROW> ): DTableBodyRow<ROW> {\r\n\t\trow.blur( true );\r\n\t\tconst cells = row.children;\r\n\t\tfor( let i = 0, imax = cells.length; i < imax; ++i ) {\r\n\t\t\tconst cell = cells[ i ];\r\n\t\t\tif( cell instanceof DBase ) {\r\n\t\t\t\tcell.setPressed( false );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn row;\r\n\t}\r\n\r\n\tprotected newRow( isEven: boolean ): DTableBodyRow<ROW> {\r\n\t\tconst options = this._rowOptions;\r\n\t\toptions.even = isEven;\r\n\t\tconst result = new DTableBodyRow<ROW>( options );\r\n\t\tresult.on( \"rowchange\", this._onRowChangeBound );\r\n\t\treturn result;\r\n\t}\r\n\r\n\tonParentMove( x: number, y: number ): void {\r\n\t\tsuper.onParentMove( x, y );\r\n\t\tthis.updateFrozenCellPosition( x );\r\n\t}\r\n\r\n\tprotected updateFrozenCellPosition( x: number ): void {\r\n\t\tconst frozen = this._rowOptions.frozen;\r\n\t\tif( frozen != null && 0 < frozen ) {\r\n\t\t\tconst rows = this.children as Array<DTableBodyRow<ROW>>;\r\n\t\t\tfor( let i = 0, imax = rows.length; i < imax; ++i ) {\r\n\t\t\t\trows[ i ].updateFrozenCellPosition( x );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetClippingRect( target: DBase, result: Rectangle ): void {\r\n\t\tsuper.getClippingRect( target, result );\r\n\r\n\t\tconst parent = this.parent;\r\n\t\tif( parent ) {\r\n\t\t\tconst shiftY = -parent.transform.position.y;\r\n\t\t\tresult.y += shiftY;\r\n\t\t\tresult.height -= shiftY;\r\n\t\t}\r\n\t}\r\n\r\n\tonRowClicked( e: InteractionEvent ): void {\r\n\t\tif( this.isActionable() ) {\r\n\t\t\tconst local = DTableBody.WORK_ON_CLICK;\r\n\t\t\tlocal.copyFrom( e.data.global );\r\n\t\t\tthis.toLocal( local, undefined, local, false );\r\n\t\t\tif( 0 <= this.parent.position.y + local.y ) {\r\n\t\t\t\tconst rowIndexMapped = Math.floor( local.y / this._rowHeight );\r\n\t\t\t\tconst data = this._data;\r\n\t\t\t\tconst mapped = data.mapped;\r\n\t\t\t\tconst selection = data.selection;\r\n\t\t\t\tif( 0 <= rowIndexMapped && rowIndexMapped < mapped.size() ) {\r\n\t\t\t\t\tconst isSingle = ( selection.type === DTableDataSelectionType.SINGLE );\r\n\t\t\t\t\tconst isNotSingle = ! isSingle;\r\n\t\t\t\t\tconst originalEvent = e.data.originalEvent;\r\n\t\t\t\t\tconst ctrlKey = originalEvent.ctrlKey;\r\n\t\t\t\t\tconst shiftKey = originalEvent.shiftKey;\r\n\t\t\t\t\tconst rowIndex = mapped.unmap( rowIndexMapped );\r\n\t\t\t\t\tif( isSingle || selection.isEmpty() || ! ( isNotSingle && ( ctrlKey || shiftKey ) ) ) {\r\n\t\t\t\t\t\tselection.clearAndAdd( rowIndex );\r\n\t\t\t\t\t} else if( ctrlKey ) {\r\n\t\t\t\t\t\tselection.toggle( rowIndex );\r\n\t\t\t\t\t} else if( shiftKey ) {\r\n\t\t\t\t\t\tconst lastRowIndex = selection.last;\r\n\t\t\t\t\t\tif( lastRowIndex != null ) {\r\n\t\t\t\t\t\t\tconst sorter = data.sorter;\r\n\t\t\t\t\t\t\tconst filter = data.filter;\r\n\t\t\t\t\t\t\tconst rowIndexSorted = sorter.map( rowIndex );\r\n\t\t\t\t\t\t\tconst lastRowIndexSorted = sorter.map( lastRowIndex );\r\n\t\t\t\t\t\t\tif( rowIndexSorted != null && lastRowIndexSorted != null ) {\r\n\t\t\t\t\t\t\t\tlet istart = lastRowIndexSorted + 1;\r\n\t\t\t\t\t\t\t\tlet iend = rowIndexSorted + 1;\r\n\t\t\t\t\t\t\t\tif( rowIndexSorted < lastRowIndexSorted ) {\r\n\t\t\t\t\t\t\t\t\tistart = rowIndexSorted;\r\n\t\t\t\t\t\t\t\t\tiend = lastRowIndexSorted;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif( istart < iend ) {\r\n\t\t\t\t\t\t\t\t\tconst rowIndices: number[] = [];\r\n\t\t\t\t\t\t\t\t\tconst indicesFiltered = filter.indices;\r\n\t\t\t\t\t\t\t\t\tconst indicesSorted = sorter.indices;\r\n\t\t\t\t\t\t\t\t\tif( indicesFiltered ) {\r\n\t\t\t\t\t\t\t\t\t\tif( indicesSorted ) {\r\n\t\t\t\t\t\t\t\t\t\t\tfor( let i = 0, imax = indicesFiltered.length; i < imax; ++i ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst indexFiltered = indicesFiltered[ i ];\r\n\t\t\t\t\t\t\t\t\t\t\t\tif( istart <= indexFiltered && indexFiltered < iend ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\trowIndices.push( indicesSorted[ indexFiltered ] );\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tfor( let i = 0, imax = indicesFiltered.length; i < imax; ++i ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst indexFiltered = indicesFiltered[ i ];\r\n\t\t\t\t\t\t\t\t\t\t\t\tif( istart <= indexFiltered && indexFiltered < iend ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\trowIndices.push( indexFiltered );\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tif( indicesSorted ) {\r\n\t\t\t\t\t\t\t\t\t\t\tfor( let i = istart; i < iend; ++i ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\trowIndices.push( indicesSorted[ i ] );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tfor( let i = istart; i < iend; ++i ) {\r\n\t\t\t\t\t\t\t\t\t\t\t\trowIndices.push( i );\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tselection.addAll( rowIndices );\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean {\r\n\t\tlet result = false;\r\n\t\tconst data = this._data;\r\n\t\tif( this.isActionable() && data.selection.type !== DTableDataSelectionType.NONE ) {\r\n\t\t\tconst local = UtilPointerEvent.toGlobal( e, interactionManager, DTableBody.WORK_ON_CLICK );\r\n\t\t\tthis.toLocal( local, undefined, local, false );\r\n\t\t\tconst x = local.x;\r\n\t\t\tconst y = local.y;\r\n\t\t\tif( 0 <= this.parent.position.y + y ) {\r\n\t\t\t\tconst rowIndexMapped = Math.floor( y / this._rowHeight );\r\n\t\t\t\tif( 0 <= rowIndexMapped && rowIndexMapped < data.mapped.size() ) {\r\n\t\t\t\t\tconst index = rowIndexMapped - this._rowIndexMappedStart;\r\n\t\t\t\t\tconst rows = this.children as Array<DTableBodyRow<ROW>>;\r\n\t\t\t\t\tif( 0 <= index && index < rows.length ) {\r\n\t\t\t\t\t\tconst row = rows[ index ];\r\n\t\t\t\t\t\tconst cells = row.children as DBase[];\r\n\t\t\t\t\t\tconst cellsLength = cells.length;\r\n\t\t\t\t\t\tconst columns = this._columns;\r\n\t\t\t\t\t\tconst columnsLength = columns.length;\r\n\t\t\t\t\t\tfor( let i = 0, imax = Math.min( cellsLength, columnsLength ); i < imax; ++i ) {\r\n\t\t\t\t\t\t\tconst cell = cells[ cellsLength - i - 1 ];\r\n\t\t\t\t\t\t\tif( cell.isActionable() ) {\r\n\t\t\t\t\t\t\t\tconst dx = x - cell.position.x;\r\n\t\t\t\t\t\t\t\tif( 0 <= dx && dx <= cell.width ) {\r\n\t\t\t\t\t\t\t\t\tcell.focus();\r\n\t\t\t\t\t\t\t\t\tif( cell instanceof DButtonBase ) {\r\n\t\t\t\t\t\t\t\t\t\tcell.onClick( e );\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tresult = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tresult = super.onDblClick( e, interactionManager ) || result;\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableBody\";\r\n\t}\r\n\r\n\tget data(): DATA {\r\n\t\treturn this._data;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\n\r\nexport interface DTableCategoryCellOptions<\r\n\tTHEME extends DThemeTableCategoryCell = DThemeTableCategoryCell\r\n> extends DImageOptions<string | null, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeTableCategoryCell extends DThemeImage {\r\n\tgetTextFormatter(): ( value: string | null, caller: DTableCategoryCell ) => string;\r\n\tgetTextValue( state: DBaseState ): string | null;\r\n\tnewTextValue(): DStateAwareOrValueMightBe<string | null>;\r\n}\r\n\r\nexport class DTableCategoryCell<\r\n\tTHEME extends DThemeTableCategoryCell = DThemeTableCategoryCell,\r\n\tOPTIONS extends DTableCategoryCellOptions<THEME> = DTableCategoryCellOptions<THEME>\r\n> extends DImage<string | null, THEME, OPTIONS> {\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableCategoryCell\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"./d-base\";\r\nimport { DTableCategoryCell, DTableCategoryCellOptions } from \"./d-table-category-cell\";\r\nimport { DTableRow, DTableRowOptions, DThemeTableRow } from \"./d-table-row\";\r\n\r\nexport interface DTableCategoryColumn {\r\n\tlabel?: string;\r\n\tweight?: number;\r\n\twidth?: number;\r\n\toffset: number;\r\n}\r\n\r\nexport interface DTableCategoryOptions<\r\n\tTHEME extends DThemeTableCategory = DThemeTableCategory\r\n> extends DTableRowOptions<unknown, DTableCategoryColumn, THEME> {\r\n\toffset?: number;\r\n\tcell?: DTableCategoryCellOptions;\r\n}\r\n\r\nexport interface DThemeTableCategory extends DThemeTableRow {\r\n\r\n}\r\n\r\nexport class DTableCategory<\r\n\tTHEME extends DThemeTableCategory = DThemeTableCategory,\r\n\tOPTIONS extends DTableCategoryOptions<THEME> = DTableCategoryOptions<THEME>\r\n> extends DTableRow<unknown, DTableCategoryColumn, THEME, OPTIONS> {\r\n\tprotected _offset!: number;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tthis._offset = this.transform.position.y = options.offset || 0;\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tonParentMove( x: number, y: number ): void {\r\n\t\tsuper.onParentMove( x, y );\r\n\t\tthis.transform.position.y = -y + this._offset;\r\n\t\tthis.updateFrozenCellPosition( x );\r\n\t}\r\n\r\n\tprotected getContentPositionX(): number {\r\n\t\tconst content = this.parent;\r\n\t\tif( content ) {\r\n\t\t\treturn content.position.x;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tprotected newCell(\r\n\t\tcolumn: DTableCategoryColumn,\r\n\t\tcolumnIndex: number,\r\n\t\tcolumns: DTableCategoryColumn[],\r\n\t\toptions: OPTIONS\r\n\t): DBase {\r\n\t\treturn new DTableCategoryCell( this.toCellOptions( column, options ) );\r\n\t}\r\n\r\n\tprotected toCellOptions(\r\n\t\tcolumn: DTableCategoryColumn,\r\n\t\toptions: OPTIONS\r\n\t): DTableCategoryCellOptions {\r\n\t\tconst result = options.cell;\r\n\t\tif( result ) {\r\n\t\t\tresult.weight = column.weight;\r\n\t\t\tresult.width = column.width;\r\n\t\t\tconst text = result.text = result.text || {};\r\n\t\t\ttext.value = text.value || column.label;\r\n\t\t\treturn result;\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tweight: column.weight,\r\n\t\t\t\twidth: column.width,\r\n\t\t\t\ttext: {\r\n\t\t\t\t\tvalue: column.label\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableCategory\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport { DTableDataFilter, DTableDataFilterFunction, DTableDataFilterObject } from \"./d-table-data-filter\";\r\nimport { DTableDataTreeItem } from \"./d-table-data-tree-item\";\r\nimport { isFunction } from \"./util/is-function\";\r\n\r\ninterface DTableDataFilterTreeParent<NODE> {\r\n\treadonly nodes: NODE[] | undefined;\r\n\tisOpened( node: NODE ): boolean;\r\n\tupdate(): void;\r\n}\r\n\r\nexport class DTableDataFilterTree<NODE extends DTableDataTreeItem<NODE, NODE>>\r\n\textends utils.EventEmitter implements DTableDataFilter<NODE> {\r\n\tprotected _id: number;\r\n\tprotected _idUpdated: number;\r\n\tprotected _isApplied: boolean;\r\n\tprotected _parent: DTableDataFilterTreeParent<NODE>;\r\n\tprotected _filter: DTableDataFilterFunction<NODE> | DTableDataFilterObject<NODE> | null;\r\n\tprotected _filtered: number[] | null;\r\n\r\n\tconstructor( parent: DTableDataFilterTreeParent<NODE> ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._id = 0;\r\n\t\tthis._idUpdated = -1;\r\n\t\tthis._isApplied = false;\r\n\r\n\t\tthis._parent = parent;\r\n\t\tthis._filter = null;\r\n\t\tthis._filtered = null;\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\tapply(): void {\r\n\t\tthis._isApplied = true;\r\n\t\tthis._id += 1;\r\n\t\tthis._parent.update();\r\n\t}\r\n\r\n\tunapply(): void {\r\n\t\tif( this._isApplied ) {\r\n\t\t\tthis._isApplied = false;\r\n\t\t\tthis._id += 1;\r\n\t\t\tthis._parent.update();\r\n\t\t}\r\n\t}\r\n\r\n\tisApplied(): boolean {\r\n\t\treturn this._isApplied;\r\n\t}\r\n\r\n\tprotected isFiltered(\r\n\t\tnode: NODE, index: number,\r\n\t\tfilter: DTableDataFilterFunction<NODE> | DTableDataFilterObject<NODE>\r\n\t): boolean {\r\n\t\tif( isFunction( filter ) ) {\r\n\t\t\treturn filter( node, index );\r\n\t\t} else {\r\n\t\t\treturn filter.test( node, index );\r\n\t\t}\r\n\t}\r\n\r\n\tprotected hasFiltered(\r\n\t\tparent: DTableDataFilterTreeParent<NODE>,\r\n\t\tnodes: NODE[],\r\n\t\tfilter: DTableDataFilterFunction<NODE> | DTableDataFilterObject<NODE>\r\n\t): boolean {\r\n\t\tfor( let i = 0, imax = nodes.length; i < imax; ++i ) {\r\n\t\t\tconst node = nodes[ i ];\r\n\t\t\tif( this.isFiltered( node, -1, filter ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif( node.children != null && 0 < node.children.length && this.hasFiltered( parent, node.children, filter ) ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected addAllToFiltered(\r\n\t\tparent: DTableDataFilterTreeParent<NODE>,\r\n\t\tnodes: NODE[],\r\n\t\tfiltered: number[],\r\n\t\tcursor: [ number ]\r\n\t): void {\r\n\t\tfor( let i = 0, imax = nodes.length; i < imax; ++i ) {\r\n\t\t\tconst node = nodes[ i ];\r\n\t\t\tfiltered.push( cursor[ 0 ] );\r\n\t\t\tcursor[ 0 ] += 1;\r\n\t\t\tif( node.children != null && 0 < node.children.length && parent.isOpened( node ) ) {\r\n\t\t\t\tthis.addAllToFiltered( parent, node.children, filtered, cursor );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected newFilteredSub(\r\n\t\tparent: DTableDataFilterTreeParent<NODE>,\r\n\t\tnodes: NODE[],\r\n\t\tfilter: DTableDataFilterFunction<NODE> | DTableDataFilterObject<NODE>,\r\n\t\tfiltered: number[],\r\n\t\tcursor: [ number ]\r\n\t): boolean {\r\n\t\tlet result = false;\r\n\t\tfor( let i = 0, imax = nodes.length; i < imax; ++i ) {\r\n\t\t\tconst node = nodes[ i ];\r\n\t\t\tconst index = cursor[ 0 ];\r\n\t\t\tcursor[ 0 ] += 1;\r\n\t\t\tconst isFiltered = this.isFiltered( node, index, filter );\r\n\t\t\tif( node.children != null && 0 < node.children.length ) {\r\n\t\t\t\tif( parent.isOpened( node ) ) {\r\n\t\t\t\t\tif( isFiltered ) {\r\n\t\t\t\t\t\tfiltered.push( index );\r\n\t\t\t\t\t\tresult = true;\r\n\t\t\t\t\t\tthis.addAllToFiltered( parent, node.children, filtered, cursor );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst position = filtered.length;\r\n\t\t\t\t\t\tif( this.newFilteredSub( parent, node.children, filter, filtered, cursor ) ) {\r\n\t\t\t\t\t\t\tfiltered.splice( position, 0, index );\r\n\t\t\t\t\t\t\tresult = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if( isFiltered || this.hasFiltered( parent, node.children, filter ) ) {\r\n\t\t\t\t\tfiltered.push( index );\r\n\t\t\t\t\tresult = true;\r\n\t\t\t\t}\r\n\t\t\t} else if( isFiltered ) {\r\n\t\t\t\tfiltered.push( index );\r\n\t\t\t\tresult = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected newFiltered(): number[] | null {\r\n\t\tconst filter = this._filter;\r\n\t\tif( filter != null ) {\r\n\t\t\tconst filtered: number[] = [];\r\n\t\t\tconst parent = this._parent;\r\n\t\t\tconst nodes = parent.nodes;\r\n\t\t\tif( nodes ) {\r\n\t\t\t\tconst cursor: [ number ] = [ 0 ];\r\n\t\t\t\tthis.newFilteredSub( parent, nodes, filter, filtered, cursor );\r\n\t\t\t}\r\n\t\t\treturn filtered;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tget(): DTableDataFilterFunction<NODE> | DTableDataFilterObject<NODE> | null {\r\n\t\treturn this._filter;\r\n\t}\r\n\r\n\tset( filter: DTableDataFilterFunction<NODE> | DTableDataFilterObject<NODE> | null ): void {\r\n\t\tif( this._filter !== filter ) {\r\n\t\t\tthis._filter = filter;\r\n\t\t}\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\tthis._id += 1;\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\tif( this._id !== this._idUpdated ) {\r\n\t\t\tthis._idUpdated = this._id;\r\n\t\t\tif( this._isApplied ) {\r\n\t\t\t\tthis._filtered = this.newFiltered();\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t} else if( this._filtered != null ) {\r\n\t\t\t\tthis._filtered = null;\r\n\t\t\t\tthis.emit( \"change\", this );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget indices(): number[] | null {\r\n\t\tthis.update();\r\n\t\treturn this._filtered;\r\n\t}\r\n\r\n\tmap( sortedIndex: number ): number | null {\r\n\t\tlet result = sortedIndex;\r\n\r\n\t\tconst indices = this.indices;\r\n\t\tif( indices ) {\r\n\t\t\tconst index = indices.indexOf( result );\r\n\t\t\tif( 0 <= index ) {\r\n\t\t\t\tresult = index;\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tunmap( index: number ): number {\r\n\t\tlet result = index;\r\n\r\n\t\tconst indices = this.indices;\r\n\t\tif( indices ) {\r\n\t\t\tresult = indices[ result ];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { utils } from \"pixi.js\";\r\nimport {\r\n\tDTableDataComparatorFunction, DTableDataComparatorObject,\r\n\tDTableDataOrder, DTableDataSorter\r\n} from \"./d-table-data-sorter\";\r\n\r\nexport class DTableDataSorterTree<NODE> extends utils.EventEmitter implements DTableDataSorter<NODE> {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget id(): number {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tget order(): DTableDataOrder {\r\n\t\treturn DTableDataOrder.ASCENDING;\r\n\t}\r\n\r\n\tset order( order: DTableDataOrder ) {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tapply(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tunapply(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tisApplied(): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tget(): DTableDataComparatorFunction<NODE> | DTableDataComparatorObject<NODE> | null {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tset( comparator: DTableDataComparatorFunction<NODE> | DTableDataComparatorObject<NODE> | null ): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\ttoDirty(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tupdate(): void {\r\n\t\t// DO NOTHING\r\n\t}\r\n\r\n\tget indices(): number[] | null {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tmap( unmappedIndex: number ): number | null {\r\n\t\treturn unmappedIndex;\r\n\t}\r\n\r\n\tunmap( index: number ): number {\r\n\t\treturn index;\r\n\t}\r\n}\r\n","import { utils } from \"pixi.js\";\r\nimport { DTableData, DTableDataMapped, DTableDataOptions, DTableDataParent } from \"./d-table-data\";\r\nimport { DTableDataFilter } from \"./d-table-data-filter\";\r\nimport { DTableDataFilterTree } from \"./d-table-data-filter-tree\";\r\nimport { DTableDataListMapped } from \"./d-table-data-list-mapped\";\r\nimport { DTableDataSelection } from \"./d-table-data-selection\";\r\nimport { DTableDataSelectionImpl } from \"./d-table-data-selection-impl\";\r\nimport { DTableDataSorter } from \"./d-table-data-sorter\";\r\nimport { DTableDataSorterTree } from \"./d-table-data-sorter-tree\";\r\nimport { DTableDataTreeItem } from \"./d-table-data-tree-item\";\r\n\r\nexport interface DTableDataTreeOptions<NODE> extends DTableDataOptions<NODE> {\r\n\tnodes?: NODE[];\r\n}\r\n\r\nexport class DTableDataTree<NODE extends DTableDataTreeItem<NODE, NODE>> extends utils.EventEmitter\r\n\timplements DTableData<NODE> {\r\n\tprotected _parent: DTableDataParent | null;\r\n\tprotected _nodes?: NODE[];\r\n\tprotected _rows: NODE[];\r\n\tprotected _isRowsDirty: boolean;\r\n\tprotected _supplimentals: number[];\r\n\tprotected _flags: WeakMap<NODE, number>;\r\n\tprotected _filter: DTableDataFilterTree<NODE>;\r\n\tprotected _sorter: DTableDataSorterTree<NODE>;\r\n\tprotected _selection: DTableDataSelectionImpl<NODE>;\r\n\tprotected _mapped: DTableDataMapped<NODE>;\r\n\r\n\tconstructor( options?: DTableDataTreeOptions<NODE> ) {\r\n\t\tsuper();\r\n\r\n\t\tthis._parent = null;\r\n\t\tthis._mapped = new DTableDataListMapped<NODE>( this );\r\n\t\tthis._rows = [];\r\n\t\tthis._isRowsDirty = false;\r\n\t\tthis._supplimentals = [];\r\n\t\tthis._flags = new WeakMap<NODE, number>();\r\n\t\tthis._selection = new DTableDataSelectionImpl<NODE>( this, options && options.selection );\r\n\t\tthis._filter = new DTableDataFilterTree<NODE>( this );\r\n\t\tthis._sorter = new DTableDataSorterTree<NODE>();\r\n\t\tif( options ) {\r\n\t\t\t// Filter\r\n\t\t\tconst filter = options.filter;\r\n\t\t\tif( filter ) {\r\n\t\t\t\tthis._filter.set( filter );\r\n\t\t\t}\r\n\r\n\t\t\t// Events\r\n\t\t\tconst on = options.on;\r\n\t\t\tif( on ) {\r\n\t\t\t\tfor( const name in on ) {\r\n\t\t\t\t\tconst handler = on[ name ];\r\n\t\t\t\t\tif( handler ) {\r\n\t\t\t\t\t\tthis.on( name, handler );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Update rows\r\n\t\tthis.nodes = options && options.nodes;\r\n\t}\r\n\r\n\tbind( parent: DTableDataParent ): void {\r\n\t\tthis._parent = parent;\r\n\t}\r\n\r\n\tget nodes(): NODE[] | undefined {\r\n\t\treturn this._nodes;\r\n\t}\r\n\r\n\tset nodes( nodes: NODE[] | undefined ) {\r\n\t\tthis._nodes = nodes;\r\n\t\tthis._isRowsDirty = true;\r\n\t\tthis._filter.toDirty();\r\n\t\tthis.update( true );\r\n\t}\r\n\r\n\tget rows(): NODE[] {\r\n\t\tif( this._isRowsDirty ) {\r\n\t\t\tthis._isRowsDirty = false;\r\n\t\t\tthis.updateRows( this._nodes );\r\n\t\t}\r\n\t\treturn this._rows;\r\n\t}\r\n\r\n\tget supplimentals(): number[] {\r\n\t\treturn this._supplimentals;\r\n\t}\r\n\r\n\tprotected updateRows( nodes: NODE[] | undefined ): void {\r\n\t\tconst rows = this._rows;\r\n\t\tconst supplimentals = this._supplimentals;\r\n\t\tconst flags = this._flags;\r\n\t\tif( nodes != null ) {\r\n\t\t\tconst irows = this.updateRows_( nodes, 0, 0, rows, supplimentals, flags );\r\n\t\t\tif( irows !== rows.length ) {\r\n\t\t\t\trows.length = irows;\r\n\t\t\t\tsupplimentals.length = irows;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\trows.length = 0;\r\n\t\t\tsupplimentals.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toSupplimental( ilevel: number, hasChildren: boolean, isOpened: boolean ) {\r\n\t\treturn (ilevel << 2) | (hasChildren ? 2 : 0) | (isOpened ? 1 : 0);\r\n\t}\r\n\r\n\tprotected updateRows_(\r\n\t\tnodes: NODE[],\r\n\t\tirows: number,\r\n\t\tilevel: number,\r\n\t\trows: NODE[],\r\n\t\tsupplimentals: number[],\r\n\t\tflags: WeakMap<NODE, number>\r\n\t): number {\r\n\t\tfor( let i = 0, imax = nodes.length; i < imax; ++i ) {\r\n\t\t\tconst node = nodes[ i ];\r\n\t\t\tconst children = node.children;\r\n\t\t\tconst isOpened = flags.has( node );\r\n\t\t\tconst supplimental = this.toSupplimental( ilevel, !! (children && 0 < children.length), isOpened );\r\n\t\t\tif( irows < rows.length ) {\r\n\t\t\t\trows[ irows ] = node;\r\n\t\t\t\tsupplimentals[ irows ] = supplimental;\r\n\t\t\t} else {\r\n\t\t\t\trows.push( node );\r\n\t\t\t\tsupplimentals.push( supplimental );\r\n\t\t\t}\r\n\t\t\tirows += 1;\r\n\r\n\t\t\tif( isOpened && children ) {\r\n\t\t\t\tirows = this.updateRows_( children, irows, ilevel + 1, rows, supplimentals, flags );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn irows;\r\n\t}\r\n\r\n\tupdate( forcibly?: boolean ): void {\r\n\t\tconst parent = this._parent;\r\n\t\tif( parent ) {\r\n\t\t\tparent.update( forcibly );\r\n\t\t}\r\n\t}\r\n\r\n\tsize(): number {\r\n\t\treturn this.rows.length;\r\n\t}\r\n\r\n\tget( index: number ): NODE | null {\r\n\t\tconst rows = this.rows;\r\n\t\tif( 0 <= index && index < rows.length ) {\r\n\t\t\treturn rows[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\topen( node: NODE ): void {\r\n\t\tconst flags = this._flags;\r\n\t\tif( ! flags.has( node ) ) {\r\n\t\t\tflags.set( node, 1 );\r\n\t\t\tthis._isRowsDirty = true;\r\n\t\t\tthis._filter.toDirty();\r\n\t\t\tthis.update( true );\r\n\t\t}\r\n\t}\r\n\r\n\tclose( node: NODE ): void {\r\n\t\tconst flags = this._flags;\r\n\t\tif( flags.has( node ) ) {\r\n\t\t\tflags.delete( node );\r\n\t\t\tthis._isRowsDirty = true;\r\n\t\t\tthis._filter.toDirty();\r\n\t\t\tthis.update( true );\r\n\t\t}\r\n\t}\r\n\r\n\tisOpened( node: NODE ): boolean {\r\n\t\treturn this._flags.has( node );\r\n\t}\r\n\r\n\ttoggle( node: NODE ): void {\r\n\t\tconst flags = this._flags;\r\n\t\tif( flags.has( node ) ) {\r\n\t\t\tflags.delete( node );\r\n\t\t} else {\r\n\t\t\tflags.set( node, 1 );\r\n\t\t}\r\n\t\tthis._isRowsDirty = true;\r\n\t\tthis._filter.toDirty();\r\n\t\tthis.update( true );\r\n\t}\r\n\r\n\teach( iteratee: ( node: NODE, index: number ) => boolean | void, ifrom?: number, ito?: number ): void {\r\n\t\tconst rows = this.rows;\r\n\t\tifrom = ( ifrom != null ? Math.max( 0, ifrom ) : 0 );\r\n\t\tito = ( ito != null ? Math.min( rows.length, ito ) : rows.length );\r\n\t\tfor( let i = ifrom; i < ito; ++i ) {\r\n\t\t\tconst row = rows[ i ];\r\n\t\t\tif( iteratee( row, i ) === false ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget selection(): DTableDataSelection<NODE> {\r\n\t\treturn this._selection;\r\n\t}\r\n\r\n\tget filter(): DTableDataFilter<NODE> {\r\n\t\treturn this._filter;\r\n\t}\r\n\r\n\tget sorter(): DTableDataSorter<NODE> {\r\n\t\treturn this._sorter;\r\n\t}\r\n\r\n\tget mapped(): DTableDataMapped<NODE> {\r\n\t\treturn this._mapped;\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DBaseState } from \"./d-base-state\";\r\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\r\nimport { DStateAwareOrValueMightBe } from \"./d-state-aware\";\r\nimport { DTableCellState } from \"./d-table-cell-state\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\nimport {\r\n\tDTableDataComparatorFunction, DTableDataComparatorObject,\r\n\tDTableDataOrder, DTableDataSorter\r\n} from \"./d-table-data-sorter\";\r\nimport { DTableHeaderTable } from \"./d-table-header\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DTableHeaderCellHeader<ROW> {\r\n\treadonly table: DTableHeaderTable<ROW> | null;\r\n}\r\n\r\nexport interface DTableHeaderCellOptions<\r\n\tROW,\r\n\tTHEME extends DThemeTableHeaderCell = DThemeTableHeaderCell\r\n> extends DImageOptions<string | null, THEME> {\r\n\theader: DTableHeaderCellHeader<ROW>;\r\n\tcolumn: DTableColumn<ROW>;\r\n}\r\n\r\nexport interface DThemeTableHeaderCell extends DThemeImage {\r\n\tgetTextFormatter(): ( value: string | null, caller: DTableHeaderCell<unknown> ) => string;\r\n\tgetTextValue( state: DBaseState ): string | null;\r\n\tnewTextValue(): DStateAwareOrValueMightBe<string | null>;\r\n}\r\n\r\nexport class DTableHeaderCell<\r\n\tROW,\r\n\tTHEME extends DThemeTableHeaderCell = DThemeTableHeaderCell,\r\n\tOPTIONS extends DTableHeaderCellOptions<ROW, THEME> = DTableHeaderCellOptions<ROW, THEME>\r\n> extends DImage<string | null, THEME, OPTIONS> {\r\n\tprotected _sorter?: DTableDataSorter<ROW>;\r\n\tprotected _onSorterChangeBound?: () => void;\r\n\tprotected _comparator?: DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW>;\r\n\tprotected _header: DTableHeaderCellHeader<ROW>;\r\n\tprotected _column: DTableColumn<ROW>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t\tthis._header = options.header;\r\n\t\tthis._column = options.column;\r\n\t\tthis._comparator = options.column.sorting.comparator;\r\n\r\n\t\tconst sorting = options.column.sorting;\r\n\t\tif( sorting.enable ) {\r\n\t\t\tUtilPointerEvent.onClick( this, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\t\tthis.onClick();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tget sorter(): DTableDataSorter<ROW> | null {\r\n\t\tlet sorter = this._sorter || null;\r\n\t\tif( sorter == null ) {\r\n\t\t\tconst table = this._header.table;\r\n\t\t\tif( table ) {\r\n\t\t\t\tsorter = table.data.sorter;\r\n\t\t\t\tthis._sorter = sorter;\r\n\t\t\t\tthis._onSorterChangeBound = this._onSorterChangeBound || (() => {\r\n\t\t\t\t\tthis.onSorterChange();\r\n\t\t\t\t});\r\n\t\t\t\tsorter.on( \"change\", this._onSorterChangeBound );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn sorter;\r\n\t}\r\n\r\n\tget comparator(): DTableDataComparatorFunction<ROW> | DTableDataComparatorObject<ROW> | null {\r\n\t\treturn this._comparator || null;\r\n\t}\r\n\r\n\tonClick(): void {\r\n\t\tconst comparator = this._comparator;\r\n\t\tif( comparator ) {\r\n\t\t\tconst sorter = this.sorter;\r\n\t\t\tif( sorter ) {\r\n\t\t\t\tif( sorter.get() === comparator ) {\r\n\t\t\t\t\tif( sorter.order === DTableDataOrder.ASCENDING ) {\r\n\t\t\t\t\t\tsorter.order = DTableDataOrder.DESCENDING;\r\n\t\t\t\t\t\tsorter.apply();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsorter.set( null );\r\n\t\t\t\t\t\tsorter.apply();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsorter.set( comparator );\r\n\t\t\t\t\tsorter.order = DTableDataOrder.ASCENDING;\r\n\t\t\t\t\tsorter.apply();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onSorterChange(): void {\r\n\t\tconst sorter = this._sorter;\r\n\t\tconst comparator = this._comparator;\r\n\t\tif( sorter && comparator ) {\r\n\t\t\tconst SORTED_ASCENDING = DTableCellState.SORTED_ASCENDING;\r\n\t\t\tconst SORTED_DESCENDING = DTableCellState.SORTED_DESCENDING;\r\n\t\t\tif( sorter.isApplied() && sorter.get() === comparator ) {\r\n\t\t\t\tif( sorter.order === DTableDataOrder.ASCENDING ) {\r\n\t\t\t\t\tthis.setStates( SORTED_ASCENDING, SORTED_DESCENDING );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.setStates( SORTED_DESCENDING, SORTED_ASCENDING );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.setState( SORTED_ASCENDING | SORTED_DESCENDING, false );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableHeaderCell\";\r\n\t}\r\n\r\n\tdestroy(): void {\r\n\t\tconst sorter = this._sorter;\r\n\t\tconst onSorterChangeBound = this._onSorterChangeBound;\r\n\t\tif( sorter && onSorterChangeBound ) {\r\n\t\t\tsorter.off( \"change\", onSorterChangeBound );\r\n\t\t}\r\n\t\tthis._sorter = undefined;\r\n\t\tthis._onSorterChangeBound = undefined;\r\n\t\tthis._comparator = undefined;\r\n\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { DBase } from \"./d-base\";\r\nimport { DTableColumn } from \"./d-table-column\";\r\nimport { DTableData } from \"./d-table-data\";\r\nimport { DTableHeaderCell, DTableHeaderCellOptions } from \"./d-table-header-cell\";\r\nimport { DTableRow, DTableRowOptions, DThemeTableRow } from \"./d-table-row\";\r\n\r\nexport interface DTableHeaderTable<ROW> {\r\n\treadonly data: DTableData<ROW>;\r\n}\r\n\r\nexport interface DTableHeaderOptions<\r\n\tROW,\r\n\tTHEME extends DThemeTableHeader = DThemeTableHeader\r\n> extends DTableRowOptions<ROW, DTableColumn<ROW>, THEME> {\r\n\ttable?: DTableHeaderTable<ROW>;\r\n\toffset?: number;\r\n\tcell?: DTableHeaderCellOptions<ROW>;\r\n}\r\n\r\nexport interface DThemeTableHeader extends DThemeTableRow {\r\n\r\n}\r\n\r\nexport class DTableHeader<\r\n\tROW,\r\n\tTHEME extends DThemeTableHeader = DThemeTableHeader,\r\n\tOPTIONS extends DTableHeaderOptions<ROW, THEME> = DTableHeaderOptions<ROW, THEME>\r\n> extends DTableRow<ROW, DTableColumn<ROW>, THEME, OPTIONS> {\r\n\tprotected _table!: DTableHeaderTable<ROW> | null;\r\n\tprotected _offset!: number;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\tthis._table = options.table || null;\r\n\t\tthis._offset = this.transform.position.y = options.offset || 0;\r\n\t\tthis._frozen = options.frozen ?? 0;\r\n\t\tsuper.init( options );\r\n\t}\r\n\r\n\tget table(): DTableHeaderTable<ROW> | null {\r\n\t\treturn this._table;\r\n\t}\r\n\r\n\tonParentMove( x: number, y: number ): void {\r\n\t\tsuper.onParentMove( x, y );\r\n\t\tthis.transform.position.y = -y + this._offset;\r\n\t\tthis.updateFrozenCellPosition( x );\r\n\t}\r\n\r\n\tprotected getContentPositionX(): number {\r\n\t\tconst content = this.parent;\r\n\t\tif( content ) {\r\n\t\t\treturn content.position.x;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tprotected newCell(\r\n\t\tcolumn: DTableColumn<ROW>,\r\n\t\tcolumnIndex: number,\r\n\t\tcolumns: Array<DTableColumn<ROW>>,\r\n\t\toptions: OPTIONS\r\n\t): DBase {\r\n\t\treturn new DTableHeaderCell<ROW>( this.toCellOptions( column, options ) );\r\n\t}\r\n\r\n\tprotected toCellOptions(\r\n\t\tcolumn: DTableColumn<ROW>,\r\n\t\toptions: OPTIONS\r\n\t): DTableHeaderCellOptions<ROW> {\r\n\t\tconst result = column.header || options.cell;\r\n\t\tif( result != null ) {\r\n\t\t\tif( result.weight === undefined ) {\r\n\t\t\t\tresult.weight = column.weight;\r\n\t\t\t}\r\n\t\t\tif( result.width === undefined ) {\r\n\t\t\t\tresult.width = column.width;\r\n\t\t\t}\r\n\t\t\tif( result.text === undefined ) {\r\n\t\t\t\tresult.text = {\r\n\t\t\t\t\tvalue: column.label\r\n\t\t\t\t};\r\n\t\t\t} else if( result.text.value === undefined ) {\r\n\t\t\t\tresult.text.value = column.label;\r\n\t\t\t}\r\n\t\t\tif( result.header === undefined ) {\r\n\t\t\t\tresult.header = this;\r\n\t\t\t}\r\n\t\t\tif( result.column === undefined ) {\r\n\t\t\t\tresult.column = column;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tweight: column.weight,\r\n\t\t\t\twidth: column.width,\r\n\t\t\t\ttext: {\r\n\t\t\t\t\tvalue: column.label\r\n\t\t\t\t},\r\n\t\t\t\theader: this,\r\n\t\t\t\tcolumn\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTableHeader\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { interaction } from \"pixi.js\";\r\nimport { DDialogSelectOptions } from \"../ui/d-dialog-select\";\r\nimport { DAlignHorizontal } from \"./d-align-horizontal\";\r\nimport { DBaseOptions } from \"./d-base\";\r\nimport { DContentOptions } from \"./d-content\";\r\nimport { DCoordinateSize } from \"./d-coordinate\";\r\nimport { DDialogSelect } from \"./d-dialog-select\";\r\nimport { DMenu, DMenuOptions } from \"./d-menu\";\r\nimport { DPane, DPaneOptions, DThemePane } from \"./d-pane\";\r\nimport { DTableBody, DTableBodyOptions } from \"./d-table-body\";\r\nimport { DTableCategory, DTableCategoryColumn, DTableCategoryOptions } from \"./d-table-category\";\r\nimport {\r\n\tDTableColumn, DTableColumnEditing, DTableColumnOptions,\r\n\tDTableColumnSelecting, DTableColumnSelectingDialog, DTableColumnSelectingOptions, DTableColumnSorting,\r\n\tDTableColumnType, DTableEditable, DTableGetter, DTableRenderable, DTableSetter\r\n} from \"./d-table-column\";\r\nimport { DTableData, DTableDataOptions } from \"./d-table-data\";\r\nimport { DTableDataList, DTableDataListOptions } from \"./d-table-data-list\";\r\nimport { DTableDataSelectionType } from \"./d-table-data-selection\";\r\nimport { DTableDataComparatorFunction } from \"./d-table-data-sorter\";\r\nimport { DTableHeader, DTableHeaderOptions } from \"./d-table-header\";\r\nimport { isArray } from \"./util/is-array\";\r\nimport { isString } from \"./util/is-string\";\r\nimport { toString } from \"./util/to-string\";\r\nimport { UtilPointerEvent } from \"./util/util-pointer-event\";\r\n\r\nexport interface DTableOptions<\r\n\tROW,\r\n\tDATA extends DTableData<ROW> = DTableDataList<ROW>,\r\n\tTHEME extends DThemeTable = DThemeTable,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions\r\n> extends DPaneOptions<THEME, CONTENT_OPTIONS> {\r\n\tcolumns: Array<DTableColumnOptions<ROW>>;\r\n\tcategory?: DTableCategoryOptions;\r\n\theader?: DTableHeaderOptions<ROW>;\r\n\tbody?: DTableBodyOptions<ROW, DATA>;\r\n\tdata?: ROW[] | DTableDataListOptions<ROW> | DATA;\r\n}\r\n\r\nexport interface DThemeTable extends DThemePane {\r\n\r\n}\r\n\r\nconst defaultGetter = <ROW, CELL>( row: ROW, columnIndex: number ): CELL => {\r\n\treturn (row as any)[ columnIndex ];\r\n};\r\n\r\nconst defaultSetter = <ROW, CELL>( row: ROW, columnIndex: number, cell: CELL ): void => {\r\n\t(row as any)[ columnIndex ] = cell;\r\n};\r\n\r\nconst defaultGetterEmpty = <CELL>(): CELL => \"\" as any;\r\n\r\nconst defaultSetterEmpty = (): void => {\r\n\t// DO NOTHING\r\n};\r\n\r\nconst toPathGetter = <ROW, CELL>( path: string[], def?: CELL ): DTableGetter<ROW, CELL> => {\r\n\tif( path.length <= 1 ) {\r\n\t\tconst key = path[ 0 ];\r\n\t\tif( def === undefined ) {\r\n\t\t\treturn ( row: ROW ): CELL => {\r\n\t\t\t\treturn (row as any)[ key ];\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn ( row: ROW ): CELL => {\r\n\t\t\t\treturn key in row ? (row as any)[ key ] : def;\r\n\t\t\t};\r\n\t\t}\r\n\t} else {\r\n\t\tif( def === undefined ) {\r\n\t\t\treturn ( row: ROW ): CELL => {\r\n\t\t\t\tfor( let i = 0, imax = path.length - 1; i < imax; ++i ) {\r\n\t\t\t\t\trow = (row as any)[ path[ i ] ];\r\n\t\t\t\t}\r\n\t\t\t\treturn (row as any)[ path[ path.length - 1 ] ];\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn ( row: ROW ): CELL => {\r\n\t\t\t\tfor( let i = 0, imax = path.length - 1; i < imax; ++i ) {\r\n\t\t\t\t\trow = (row as any)[ path[ i ] ];\r\n\t\t\t\t}\r\n\t\t\t\tconst key = path[ path.length - 1 ];\r\n\t\t\t\treturn key in row ? (row as any)[ key ] : def;\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst toPathSetter = <ROW, CELL>( path: string[] ): DTableSetter<ROW, CELL> => {\r\n\tif( path.length <= 1 ) {\r\n\t\tconst key = path[ 0 ];\r\n\t\treturn ( row: ROW, columnIndex: number, cell: CELL ): void => {\r\n\t\t\t(row as any)[ key ] = cell;\r\n\t\t};\r\n\t} else {\r\n\t\treturn ( row: ROW, columnIndex: number, cell: CELL ): void => {\r\n\t\t\tfor( let i = 0, imax = path.length - 1; i < imax; ++i ) {\r\n\t\t\t\trow = (row as any)[ path[ i ] ] || {};\r\n\t\t\t}\r\n\t\t\t(row as any)[ path[ path.length - 1 ] ] = cell;\r\n\t\t};\r\n\t}\r\n};\r\n\r\nconst defaultEditingUnformatter = <CELL>( formatted: string ): CELL => {\r\n\treturn formatted as any;\r\n};\r\n\r\nconst toColumnAlign = <ROW, CELL>(\r\n\toptions: DTableColumnOptions<ROW, CELL>,\r\n\ttype: DTableColumnType\r\n): DAlignHorizontal => {\r\n\tif( options.align != null ) {\r\n\t\tif( isString( options.align ) ) {\r\n\t\t\treturn DAlignHorizontal[ options.align ];\r\n\t\t} else {\r\n\t\t\treturn options.align;\r\n\t\t}\r\n\t}\r\n\tswitch( type ) {\r\n\tcase DTableColumnType.TEXT:\r\n\t\treturn DAlignHorizontal.LEFT;\r\n\tcase DTableColumnType.REAL:\r\n\tcase DTableColumnType.INTEGER:\r\n\t\treturn DAlignHorizontal.RIGHT;\r\n\tcase DTableColumnType.BUTTON:\r\n\tcase DTableColumnType.INDEX:\r\n\tcase DTableColumnType.SELECT:\r\n\tcase DTableColumnType.ACTION:\r\n\tcase DTableColumnType.LINK:\r\n\t\treturn DAlignHorizontal.CENTER;\r\n\tdefault:\r\n\t\treturn DAlignHorizontal.LEFT;\r\n\t}\r\n};\r\n\r\nconst toColumnDataChecker = <ROW>( path: string[] | null ): DTableEditable<ROW> => {\r\n\tif( path != null ) {\r\n\t\tif( path.length <= 1 ) {\r\n\t\t\tconst key = path[ 0 ];\r\n\t\t\treturn ( row: ROW ): boolean => {\r\n\t\t\t\treturn key in row;\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn ( row: any ): boolean => {\r\n\t\t\t\tfor( let i = 0, imax = path.length; i < imax; ++i ) {\r\n\t\t\t\t\tconst part = path[ i ];\r\n\t\t\t\t\tif( part in row ) {\r\n\t\t\t\t\t\trow = row[ part ];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\treturn ( row: any, columnIndex: number ): boolean => {\r\n\t\treturn columnIndex < row.length;\r\n\t};\r\n};\r\n\r\nconst toColumnEditingEnable = <ROW>(\r\n\tenable: boolean | DTableEditable<ROW> | \"auto\" | \"AUTO\" | undefined,\r\n\tpath: string[] | null\r\n): boolean | DTableEditable<ROW> => {\r\n\tif( isString( enable ) ) {\r\n\t\treturn toColumnDataChecker( path );\r\n\t} else if( enable != null ) {\r\n\t\treturn enable;\r\n\t} else {\r\n\t\treturn false;\r\n\t}\r\n};\r\n\r\nconst toColumnEditing = <ROW, CELL>(\r\n\toptions: DTableColumnOptions<ROW, CELL>,\r\n\tpath: string[] | null\r\n): DTableColumnEditing<ROW, CELL> => {\r\n\tconst editing = options.editing;\r\n\tif( editing ) {\r\n\t\treturn {\r\n\t\t\tenable: toColumnEditingEnable( editing.enable != null ? editing.enable : options.editable, path ),\r\n\t\t\tformatter: editing.formatter || toString,\r\n\t\t\tunformatter: editing.unformatter || defaultEditingUnformatter,\r\n\t\t\tvalidator: editing.validator\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tenable: toColumnEditingEnable( options.editable, path ),\r\n\t\tformatter: toString,\r\n\t\tunformatter: defaultEditingUnformatter\r\n\t};\r\n};\r\n\r\nconst toComparator = <ROW, CELL>(\r\n\tgetter: DTableGetter<ROW, CELL>,\r\n\tindex: number\r\n): DTableDataComparatorFunction<ROW> => {\r\n\treturn ( rowA: ROW, rowB: ROW ): number => {\r\n\t\tconst valueA = getter( rowA, index ) as any;\r\n\t\tconst valueB = getter( rowB, index ) as any;\r\n\t\treturn ( valueA < valueB ? -1 : ( valueB < valueA ? +1 : 0 ) );\r\n\t};\r\n};\r\n\r\nconst toColumnSorting = <ROW, CELL>(\r\n\tgetter: DTableGetter<ROW, CELL>,\r\n\tindex: number,\r\n\toptions: DTableColumnOptions<ROW, CELL>\r\n): DTableColumnSorting<ROW> => {\r\n\tconst sorting = options.sorting;\r\n\tif( sorting ) {\r\n\t\tconst enable = sorting.enable === true || options.sortable === true;\r\n\t\tif( enable ) {\r\n\t\t\treturn {\r\n\t\t\t\tenable,\r\n\t\t\t\tcomparator: sorting.comparator || toComparator( getter, index )\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tenable\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\tif( options.sortable === true ) {\r\n\t\treturn {\r\n\t\t\tenable: true,\r\n\t\t\tcomparator: toComparator( getter, index )\r\n\t\t};\r\n\t} else {\r\n\t\treturn {\r\n\t\t\tenable: false\r\n\t\t};\r\n\t}\r\n};\r\n\r\nconst toColumnMenu = ( options?: DMenuOptions<unknown> | DMenu<unknown> ): DMenu<unknown> | undefined => {\r\n\tif( options == null ) {\r\n\t\treturn undefined;\r\n\t} else if( options instanceof DMenu ) {\r\n\t\treturn options;\r\n\t} else {\r\n\t\treturn new DMenu( options );\r\n\t}\r\n};\r\n\r\nconst toColumnDialog = (\r\n\toptions?: DDialogSelectOptions<unknown> | DTableColumnSelectingDialog<unknown>\r\n): DTableColumnSelectingDialog<unknown> | undefined => {\r\n\tif( options == null ) {\r\n\t\treturn undefined;\r\n\t} else if( \"open\" in options ) {\r\n\t\treturn options;\r\n\t} else {\r\n\t\treturn new DDialogSelect( options );\r\n\t}\r\n};\r\n\r\nconst defaultSelectingGetter = ( dialog: DTableColumnSelectingDialog<unknown> ): unknown => {\r\n\treturn dialog.value;\r\n};\r\n\r\nconst defaultSelectingSetter = (): void => {\r\n\t// DO NOTHING\r\n};\r\n\r\nconst toColumnSelecting = (\r\n\toptions: DTableColumnSelectingOptions<any, any, any> | undefined\r\n): DTableColumnSelecting<any, any, any> => {\r\n\tif( options ) {\r\n\t\treturn {\r\n\t\t\tgetter: options.getter || defaultSelectingGetter,\r\n\t\t\tsetter: options.setter || defaultSelectingSetter,\r\n\t\t\tmenu: toColumnMenu( options.menu ),\r\n\t\t\tmultiple: toColumnMenu( options.multiple ),\r\n\t\t\tdialog: toColumnDialog( options.dialog ),\r\n\t\t\tpromise: options.promise\r\n\t\t};\r\n\t}\r\n\treturn {\r\n\t\tgetter: defaultSelectingGetter,\r\n\t\tsetter: defaultSelectingSetter\r\n\t};\r\n};\r\n\r\nconst toColumnGetter = <ROW, CELL>(\r\n\toptions: DTableColumnOptions<ROW, CELL>,\r\n\ttype: DTableColumnType,\r\n\tparts: string[] | null\r\n): DTableGetter<ROW, CELL> => {\r\n\tconst getter = options.getter;\r\n\tif( getter ) {\r\n\t\treturn getter;\r\n\t}\r\n\tswitch( type ) {\r\n\tcase DTableColumnType.ACTION:\r\n\tcase DTableColumnType.LINK:\r\n\t\treturn defaultGetterEmpty;\r\n\tdefault:\r\n\t\tif( parts == null ) {\r\n\t\t\treturn defaultGetter;\r\n\t\t} else {\r\n\t\t\treturn toPathGetter( parts, options.default );\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst toColumnSetter = <ROW, CELL>(\r\n\toptions: DTableColumnOptions<ROW, CELL>,\r\n\ttype: DTableColumnType,\r\n\tpath: string[] | null\r\n): DTableSetter<ROW, CELL> => {\r\n\tconst setter = options.setter;\r\n\tif( setter ) {\r\n\t\treturn setter;\r\n\t}\r\n\tswitch( type ) {\r\n\tcase DTableColumnType.BUTTON:\r\n\tcase DTableColumnType.ACTION:\r\n\tcase DTableColumnType.LINK:\r\n\t\treturn defaultSetterEmpty;\r\n\tdefault:\r\n\t\tif( path == null ) {\r\n\t\t\treturn defaultSetter;\r\n\t\t} else {\r\n\t\t\treturn toPathSetter( path );\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst toColumnPath = <ROW, CELL>(\r\n\toptions: DTableColumnOptions<ROW, CELL>\r\n): string[] | null => {\r\n\treturn options.path != null ? options.path.split( \".\" ) : null;\r\n};\r\n\r\nconst toColumnRenderable = <ROW, CELL>(\r\n\toptions: DTableColumnOptions<ROW, CELL>,\r\n\tpath: string[] | null\r\n): boolean | DTableRenderable<ROW> => {\r\n\tconst renderable = options.renderable;\r\n\tif( isString( renderable ) ) {\r\n\t\treturn toColumnDataChecker( path );\r\n\t} else if( renderable != null ) {\r\n\t\treturn renderable;\r\n\t}\r\n\treturn true;\r\n};\r\n\r\nconst toColumn = <ROW, CELL>(\r\n\tindex: number,\r\n\toptions: DTableColumnOptions<ROW, CELL>\r\n): DTableColumn<ROW, CELL> => {\r\n\tconst weight = ( options.weight != null ? options.weight :\r\n\t\t( options.width != null ? undefined : +1 )\r\n\t);\r\n\tconst width = ( weight != null ? undefined :\r\n\t\t( options.width != null ? options.width : 100 )\r\n\t);\r\n\tconst type = ( options.type != null ?\r\n\t\t( isString( options.type ) ? DTableColumnType[ options.type ] : options.type ) :\r\n\t\tDTableColumnType.TEXT\r\n\t);\r\n\tconst align = toColumnAlign( options, type );\r\n\tconst label = options.label || \"\";\r\n\tconst path = toColumnPath( options );\r\n\tconst getter = toColumnGetter( options, type, path );\r\n\tconst setter = toColumnSetter( options, type, path );\r\n\treturn {\r\n\t\tweight,\r\n\t\twidth,\r\n\t\ttype,\r\n\t\tlabel,\r\n\t\tgetter,\r\n\t\tsetter,\r\n\t\tformatter: options.formatter,\r\n\t\trenderable: toColumnRenderable( options, path ),\r\n\t\talign,\r\n\r\n\t\tediting: toColumnEditing( options, path ),\r\n\t\tsorting: toColumnSorting( getter, index, options ),\r\n\r\n\t\theader: options.header,\r\n\t\tbody: options.body,\r\n\r\n\t\tselecting: toColumnSelecting( options.selecting ),\r\n\r\n\t\tcategory: options.category,\r\n\t\tfrozen: options.frozen,\r\n\t\toffset: 0.0,\r\n\r\n\t\tlink: options.link\r\n\t};\r\n};\r\n\r\nconst toColumns = <ROW, CELL>(\r\n\toptions: Array<DTableColumnOptions<ROW, CELL>>\r\n): Array<DTableColumn<ROW, CELL>> => {\r\n\tconst result = [];\r\n\tfor( let i = 0, imax = options.length; i < imax; ++i ) {\r\n\t\tresult.push( toColumn( i, options[ i ] ) );\r\n\t}\r\n\treturn result;\r\n};\r\n\r\nconst toFrozen = <ROW, CELL>(\r\n\tcolumns: Array<DTableColumn<ROW, CELL>>\r\n): number => {\r\n\tfor( let i = columns.length - 1; 0 <= i; --i ) {\r\n\t\tif( columns[ i ].frozen === true ) {\r\n\t\t\treturn i + 1;\r\n\t\t}\r\n\t}\r\n\treturn 0;\r\n};\r\n\r\nexport class DTable<\r\n\tROW,\r\n\tDATA extends DTableData<ROW> = DTableDataList<ROW>,\r\n\tTHEME extends DThemeTable = DThemeTable,\r\n\tCONTENT_OPTIONS extends DBaseOptions = DContentOptions,\r\n\tOPTIONS extends DTableOptions<ROW, DATA, THEME, CONTENT_OPTIONS> = DTableOptions<ROW, DATA, THEME, CONTENT_OPTIONS>\r\n>  extends DPane<THEME, CONTENT_OPTIONS, OPTIONS> {\r\n\tprotected _categories!: DTableCategory[];\r\n\tprotected _header!: DTableHeader<ROW> | null;\r\n\tprotected _body!: DTableBody<ROW, DATA>;\r\n\r\n\tconstructor( options: OPTIONS ) {\r\n\t\tsuper( options );\r\n\t}\r\n\r\n\tprotected init( options: OPTIONS ) {\r\n\t\t// Column\r\n\t\tconst columns = toColumns( options.columns );\r\n\r\n\t\t// Frozen\r\n\t\tconst frozen = toFrozen( columns );\r\n\r\n\t\t// Categories\r\n\t\tconst categories = this.newCategories( options, columns, frozen );\r\n\t\tthis._categories = categories;\r\n\r\n\t\t// Header\r\n\t\tlet headerOffset = 0;\r\n\t\tfor( let i = 0, imax = categories.length; i < imax; ++i ) {\r\n\t\t\theaderOffset += categories[ i ].height;\r\n\t\t}\r\n\t\tconst header = this.newHeader( options, columns, frozen, headerOffset );\r\n\t\tthis._header = header;\r\n\r\n\t\t// Body\r\n\t\tconst bodyOffset = headerOffset + ((header && header.height) || 0);\r\n\t\tconst body = this.newBody( options, columns, frozen, bodyOffset );\r\n\t\tthis._body = body;\r\n\r\n\t\t// Super\r\n\t\tsuper.init( options );\r\n\r\n\t\t// Content\r\n\t\tconst content = this._content;\r\n\t\tcontent.setWidth( this.toContentWidth( options ) );\r\n\t\tcontent.addChild( body );\r\n\t\tif( header ) {\r\n\t\t\tcontent.addChild( header );\r\n\t\t}\r\n\t\tfor( let i = categories.length - 1; 0 <= i; --i ) {\r\n\t\t\tcontent.addChild( categories[ i ] );\r\n\t\t}\r\n\t\tcontent.on( \"move\", (): void => {\r\n\t\t\tbody.update();\r\n\t\t});\r\n\t\tcontent.on( \"resize\", (): void => {\r\n\t\t\tbody.update();\r\n\t\t});\r\n\t\tif( body.data.selection.type !== DTableDataSelectionType.NONE ) {\r\n\t\t\tUtilPointerEvent.onClick( this, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\t\tbody.onRowClicked( e );\r\n\t\t\t});\r\n\t\t}\r\n\t\tbody.update();\r\n\t}\r\n\r\n\tonResize( newWidth: number, newHeight: number, oldWidth: number, oldHeight: number ): void {\r\n\t\tconst body = this._body;\r\n\t\tbody.lock();\r\n\t\tsuper.onResize( newWidth, newHeight, oldWidth, oldHeight );\r\n\t\tbody.update();\r\n\t\tbody.unlock( true );\r\n\t}\r\n\r\n\tprotected getCategoryCount( columns: Array<DTableColumn<ROW>> ): number {\r\n\t\tlet result = 0;\r\n\t\tfor( let i = 0, imax = columns.length; i < imax; ++i ) {\r\n\t\t\tconst category = columns[ i ].category;\r\n\t\t\tif( category != null ) {\r\n\t\t\t\tconst count = isString( category ) ? 1 : category.length;\r\n\t\t\t\tresult = Math.max( result, count );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected toCategoryLabel( index: number, category: string | string[] | undefined ): string | undefined {\r\n\t\tif( category ) {\r\n\t\t\tif( isString( category ) ) {\r\n\t\t\t\tif( index === 0 ) {\r\n\t\t\t\t\treturn category;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( index < category.length ) {\r\n\t\t\t\t\treturn category[ index ];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tprotected isSameCategory(\r\n\t\tindex: number,\r\n\t\ta: string | string[] | undefined,\r\n\t\tb: string | string[] | undefined\r\n\t): boolean {\r\n\t\tif( a != null ) {\r\n\t\t\tif( b != null ) {\r\n\t\t\t\tif( isString( a ) ) {\r\n\t\t\t\t\tif( isString( b ) ) {\r\n\t\t\t\t\t\tif( 0 < index ) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn a === b;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif( 0 < index ) {\r\n\t\t\t\t\t\t\treturn b.length <= index;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn b.length === 1 && a === b[ 0 ];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif( isString( b ) ) {\r\n\t\t\t\t\t\tif( 0 < index ) {\r\n\t\t\t\t\t\t\treturn a.length <= index;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn a.length === 1 && a[ 0 ] === b;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif( a.length <= index && b.length <= index ) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t} else if( b.length === a.length ) {\r\n\t\t\t\t\t\t\tfor( let i = index, imax = a.length; i < imax; ++i ) {\r\n\t\t\t\t\t\t\t\tif( a[ i ] !== b[ i ] ) {\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif( isString( a ) ) {\r\n\t\t\t\t\tif( 0 < index ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif( a.length <= index ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif( b != null ) {\r\n\t\t\t\tif( isString( b ) ) {\r\n\t\t\t\t\tif( 0 < index ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif( b.length <= index ) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toCategoryColumns(\r\n\t\tindex: number,\r\n\t\tcolumns: Array<DTableColumn<ROW>>,\r\n\t\tfrozen: number\r\n\t): DTableCategoryColumn[] {\r\n\t\tconst result: DTableCategoryColumn[] = [];\r\n\t\tlet tcolumn: DTableColumn<ROW> | null = null;\r\n\t\tlet ccolumn: DTableCategoryColumn | null = null;\r\n\t\tfor( let i = 0, imax = columns.length; i < imax; ++i ) {\r\n\t\t\tconst column = columns[ i ];\r\n\t\t\tif( i !== frozen && ccolumn && tcolumn && this.isSameCategory( index, tcolumn.category, column.category ) ) {\r\n\t\t\t\tif( ccolumn.weight != null && column.weight != null ) {\r\n\t\t\t\t\tccolumn.weight += column.weight;\r\n\t\t\t\t} else if( ccolumn.width != null && column.width != null ) {\r\n\t\t\t\t\tccolumn.width += column.width;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttcolumn = column;\r\n\t\t\t\t\tccolumn = {\r\n\t\t\t\t\t\tlabel: this.toCategoryLabel( index, column.category ),\r\n\t\t\t\t\t\tweight: column.weight,\r\n\t\t\t\t\t\twidth: column.width,\r\n\t\t\t\t\t\toffset: 0.0\r\n\t\t\t\t\t};\r\n\t\t\t\t\tresult.push( ccolumn );\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttcolumn = column;\r\n\t\t\t\tccolumn = {\r\n\t\t\t\t\tlabel: this.toCategoryLabel( index, column.category ),\r\n\t\t\t\t\tweight: column.weight,\r\n\t\t\t\t\twidth: column.width,\r\n\t\t\t\t\toffset: 0.0\r\n\t\t\t\t};\r\n\t\t\t\tresult.push( ccolumn );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tprotected toCategoryOptions(\r\n\t\tindex: number,\r\n\t\toptions: DTableCategoryOptions | undefined,\r\n\t\tcolumns: Array<DTableColumn<ROW>>,\r\n\t\tfrozen: number,\r\n\t\toffset: number\r\n\t): DTableCategoryOptions {\r\n\t\tif( options ) {\r\n\t\t\tif( options.columns === undefined ) {\r\n\t\t\t\toptions.columns = this.toCategoryColumns( index, columns, frozen );\r\n\t\t\t}\r\n\t\t\tif( options.frozen == null ) {\r\n\t\t\t\toptions.frozen = frozen;\r\n\t\t\t}\r\n\t\t\tif( options.offset == null ) {\r\n\t\t\t\toptions.offset = offset;\r\n\t\t\t}\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tcolumns: this.toCategoryColumns( index, columns, frozen ),\r\n\t\t\tfrozen,\r\n\t\t\toffset\r\n\t\t};\r\n\t}\r\n\r\n\tprotected newCategories( options: OPTIONS, columns: Array<DTableColumn<ROW>>, frozen: number ): DTableCategory[] {\r\n\t\tconst count = this.getCategoryCount( columns );\r\n\t\tconst result: DTableCategory[] = [];\r\n\t\tlet offset: number = 0;\r\n\t\tfor( let i = count - 1; 0 <= i; --i ) {\r\n\t\t\tconst category = new DTableCategory( this.toCategoryOptions( i, options.category, columns, frozen, offset ) );\r\n\t\t\tresult.push( category );\r\n\t\t\toffset += category.height;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tonDblClick( e: MouseEvent | TouchEvent, interactionManager: interaction.InteractionManager ): boolean {\r\n\t\tconst result = this._body.onDblClick( e, interactionManager );\r\n\t\treturn super.onDblClick( e, interactionManager ) || result;\r\n\t}\r\n\r\n\tprotected getScrollBarOffsetVerticalStart( size: number ): number {\r\n\t\treturn size * 0.5 + this._body.position.y;\r\n\t}\r\n\r\n\tprotected toContentWidth( options: OPTIONS ): DCoordinateSize {\r\n\t\tlet columnWidthTotal = 0;\r\n\t\tconst columns = options.columns;\r\n\t\tif( columns ) {\r\n\t\t\tfor( let i = 0, imax = columns.length; i < imax; ++i ) {\r\n\t\t\t\tconst column = columns[ i ];\r\n\t\t\t\tconst columnWidth = column.width;\r\n\t\t\t\tif( columnWidth != null ) {\r\n\t\t\t\t\tcolumnWidthTotal += columnWidth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif( 0 < columnWidthTotal ) {\r\n\t\t\treturn ( p: number ): number => {\r\n\t\t\t\treturn Math.max( p, columnWidthTotal );\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn \"100%\";\r\n\t}\r\n\r\n\tprotected hasHeader( options: OPTIONS ): boolean {\r\n\t\tconst columns = options.columns;\r\n\t\tfor( let i = 0, imax = columns.length; i < imax; ++i ) {\r\n\t\t\tif( columns[ i ].label != null ) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprotected newHeader(\r\n\t\toptions: OPTIONS,\r\n\t\tcolumns: Array<DTableColumn<ROW>>,\r\n\t\tfrozen: number,\r\n\t\toffset: number\r\n\t): DTableHeader<ROW> | null {\r\n\t\tif( this.hasHeader( options ) ) {\r\n\t\t\treturn new DTableHeader( this.toHeaderOptions( options.header, columns, frozen, offset ) );\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected toHeaderOptions(\r\n\t\toptions: DTableHeaderOptions<ROW> | undefined,\r\n\t\tcolumns: Array<DTableColumn<ROW>>,\r\n\t\tfrozen: number,\r\n\t\toffset: number\r\n\t): DTableHeaderOptions<ROW> {\r\n\t\tif( options ) {\r\n\t\t\tif( options.columns === undefined ) {\r\n\t\t\t\toptions.columns = columns;\r\n\t\t\t}\r\n\t\t\tif( options.frozen == null ) {\r\n\t\t\t\toptions.frozen = frozen;\r\n\t\t\t}\r\n\t\t\tif( options.offset === undefined ) {\r\n\t\t\t\toptions.offset = offset;\r\n\t\t\t}\r\n\t\t\tif( options.table === undefined ) {\r\n\t\t\t\toptions.table = this;\r\n\t\t\t}\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\treturn {\r\n\t\t\tcolumns,\r\n\t\t\tfrozen,\r\n\t\t\toffset,\r\n\t\t\ttable: this\r\n\t\t};\r\n\t}\r\n\r\n\tprotected newBody(\r\n\t\toptions: OPTIONS,\r\n\t\tcolumns: Array<DTableColumn<ROW>>,\r\n\t\tfrozen: number,\r\n\t\toffset: number\r\n\t): DTableBody<ROW, DATA> {\r\n\t\treturn new DTableBody<ROW, DATA>(\r\n\t\t\tthis.toBodyOptions( options.body, columns, frozen, offset, options.data )\r\n\t\t);\r\n\t}\r\n\r\n\tprotected toBodyOptions(\r\n\t\toptions: DTableBodyOptions<ROW, DATA> | undefined,\r\n\t\tcolumns: Array<DTableColumn<ROW>>,\r\n\t\tfrozen: number,\r\n\t\toffset: number,\r\n\t\tdata: ROW[] | DTableDataOptions<ROW> | DATA | undefined\r\n\t): DTableBodyOptions<ROW, DATA> {\r\n\t\tif( options != null ) {\r\n\t\t\tif( options.columns === undefined ) {\r\n\t\t\t\toptions.columns = columns;\r\n\t\t\t}\r\n\t\t\tif( options.frozen == null ) {\r\n\t\t\t\toptions.frozen = frozen;\r\n\t\t\t}\r\n\t\t\tif( options.offset === undefined ) {\r\n\t\t\t\toptions.offset = offset;\r\n\t\t\t}\r\n\t\t\tif( options.data === undefined && data !== undefined ) {\r\n\t\t\t\tif( isArray( data ) ) {\r\n\t\t\t\t\toptions.data = {\r\n\t\t\t\t\t\trows: data\r\n\t\t\t\t\t};\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptions.data = data;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif( options.height === undefined && options.weight === undefined ) {\r\n\t\t\t\toptions.weight = 1;\r\n\t\t\t}\r\n\t\t\treturn options;\r\n\t\t}\r\n\t\tif( isArray( data ) ) {\r\n\t\t\treturn {\r\n\t\t\t\tcolumns,\r\n\t\t\t\tfrozen,\r\n\t\t\t\toffset,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\trows: data\r\n\t\t\t\t},\r\n\t\t\t\tweight: 1\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\tcolumns,\r\n\t\t\t\tfrozen,\r\n\t\t\t\toffset,\r\n\t\t\t\tdata,\r\n\t\t\t\tweight: 1\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTable\";\r\n\t}\r\n\r\n\tget categories(): DTableCategory[] {\r\n\t\treturn this._categories;\r\n\t}\r\n\r\n\tget header(): DTableHeader<ROW> | null {\r\n\t\treturn this._header;\r\n\t}\r\n\r\n\tget body(): DTableBody<ROW, DATA> {\r\n\t\treturn this._body;\r\n\t}\r\n\r\n\tget data(): DATA {\r\n\t\treturn this._body.data;\r\n\t}\r\n}\r\n","import { DBaseState } from \"./d-base-state\";\r\n\r\n/**\r\n * Tree item states.\r\n */\r\nexport const DTreeItemState = {\r\n\t/**\r\n\t * the parent item is expanded\r\n\t */\r\n\tEXPANDED: DBaseState.CUSTOM << 0,\r\n\t\r\n\t/**\r\n\t * the parent item is collapsed\r\n\t */\r\n\tCOLLAPSED: DBaseState.CUSTOM << 1,\r\n\t\r\n\t/**\r\n\t * the child item is selected\r\n\t */\r\n\tSELECTED: DBaseState.CUSTOM << 2\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\r\n\r\nexport interface DTreeItemTextAndImageOptions<\r\n\tTHEME extends DThemeTreeItemTextAndImage = DThemeTreeItemTextAndImage\r\n> extends DImageOptions <string, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeTreeItemTextAndImage extends DThemeImage {\r\n\r\n}\r\n\r\nexport class DTreeItemTextAndImage<\r\n\tTHEME extends DThemeTreeItemTextAndImage = DThemeTreeItemTextAndImage,\r\n\tOPTIONS extends DTreeItemTextAndImageOptions<THEME> = DTreeItemTextAndImageOptions<THEME>\r\n> extends DImage<string, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DTreeItemTextAndImage\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\nimport { DImage, DImageOptions, DThemeImage } from \"./d-image\";\r\n\r\nexport interface DTreeItemToggleIconOptions<\r\n\tTHEME extends DThemeTreeItemToggleIcon = DThemeTreeItemToggleIcon\r\n> extends DImageOptions<string, THEME> {\r\n\r\n}\r\n\r\nexport interface DThemeTreeItemToggleIcon extends DThemeImage {\r\n\r\n}\r\n\r\nexport class DTreeItemToggleIcon<\r\n\tTHEME extends DThemeTreeItemToggleIcon = DThemeTreeItemToggleIcon,\r\n\tOPTIONS extends DTreeItemToggleIconOptions<THEME> = DTreeItemToggleIconOptions<THEME>\r\n> extends DImage <string, THEME, OPTIONS> {\r\n\tprotected getType(): string {\r\n\t\treturn \"DTreeItemToggleIcon\";\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\nimport { DisplayObject, interaction, Texture } from \"pixi.js\";\r\nimport { DLayoutHorizontal, DLayoutHorizontalOptions, DThemeLayoutHorizontal } from \"./d-layout-horizontal\";\r\nimport { DTreeItemRawData } from \"./d-tree\";\r\nimport { DTreeItemState } from \"./d-tree-item-state\";\r\nimport { DTreeItemTextAndImage } from \"./d-tree-item-text-and-image\";\r\nimport { DTreeItemToggleIcon} from \"./d-tree-item-toggle-icon\";\r\nimport { UtilPointerEvent } from \"./util\";\r\n\r\nexport interface DTreeItemOptions<\r\n\tTHEME extends DThemeTreeItem = DThemeTreeItem\r\n> extends DLayoutHorizontalOptions <THEME> {\r\n\ttext: string;\r\n\tisParent: boolean;\r\n\texpanded: boolean;\r\n\trawData: DTreeItemRawData;\r\n\ty: number;\r\n\tlevel: number;\r\n\tshowable?: boolean;\r\n\timage?: DisplayObject | Texture | null;\r\n}\r\n\r\nexport interface DThemeTreeItem extends DThemeLayoutHorizontal {\r\n\tgetPaddingByLevel( level: number ): number;\r\n}\r\n\r\nconst toText = ( options?: DTreeItemOptions ): string => {\r\n\tif ( options ) {\r\n\t\treturn options.text;\r\n\t}\r\n\treturn \"\";\r\n};\r\n\r\nconst isParent = ( options?: DTreeItemOptions ): boolean => {\r\n\treturn !! ( options && options.isParent );\r\n};\r\n\r\nconst isExpanded = ( options?: DTreeItemOptions ): boolean => {\r\n\treturn !! ( options && options.expanded );\r\n};\r\n\r\nconst toImage = ( options?: DTreeItemOptions ): DisplayObject | Texture | null => {\r\n\treturn options && options.image ? options.image : null;\r\n};\r\n\r\nconst toYCoordinate = ( options?: DTreeItemOptions ): number => {\r\n\treturn options ? options.y : 0;\r\n};\r\n\r\nconst toRawData = ( options?: DTreeItemOptions ): DTreeItemRawData => {\r\n\treturn options ? options.rawData : {\r\n\t\ttext: \"\",\r\n\t\tchildren: []\r\n\t};\r\n};\r\n\r\nconst toPaddingLeft = <THEME extends DThemeTreeItem>(\r\n\ttheme: DThemeTreeItem,\r\n\toptions?: DTreeItemOptions<THEME>\r\n): number => {\r\n\tconst level = options ? options.level : 0;\r\n\treturn theme.getPaddingByLevel( level );\r\n};\r\n\r\nconst toTreeItemTextAndImage = ( options?: DTreeItemOptions ): DTreeItemTextAndImage => {\r\n\treturn new DTreeItemTextAndImage({\r\n\t\ttext: {\r\n\t\t\tvalue: toText( options )\r\n\t\t},\r\n\t\timage: {\r\n\t\t\tsource: toImage( options )\r\n\t\t}\r\n\t});\r\n};\r\n\r\nexport class DTreeItem<\r\n\tTHEME extends DThemeTreeItem = DThemeTreeItem,\r\n\tOPTIONS extends DTreeItemOptions <THEME> = DTreeItemOptions <THEME>\r\n> extends DLayoutHorizontal < THEME, OPTIONS > {\r\n\tprotected _isParent!: boolean;\r\n\tprotected _isExpanded!: boolean;\r\n\tprotected _rawData!: DTreeItemRawData;\r\n\tprotected _textAndImage!: DTreeItemTextAndImage;\r\n\tprotected _icon!: DTreeItemToggleIcon;\r\n\r\n\tprotected init( options ?: OPTIONS ) {\r\n\t\tsuper.init( options );\r\n\t\t// get isParent option\r\n\t\tthis._isParent = isParent( options );\r\n\t\t// get isExpand option\r\n\t\tthis._isExpanded = isExpanded( options );\r\n\t\t// get raw data\r\n\t\tthis._rawData = toRawData( options );\r\n\r\n\t\tthis._icon = new DTreeItemToggleIcon();\r\n\t\tthis._textAndImage = toTreeItemTextAndImage( options );\r\n\r\n\t\tthis.addChild( this._icon );\r\n\t\tthis.addChild( this._textAndImage );\r\n\r\n\t\tthis._icon.on( UtilPointerEvent.down, (): void => {\r\n\t\t\tthis.onToggle();\r\n\t\t});\r\n\t\tthis._textAndImage.on( UtilPointerEvent.down, ( e: interaction.InteractionEvent ): void => {\r\n\t\t\tthis.onSelect( e );\r\n\t\t});\r\n\r\n\t\t// update states\r\n\t\tthis.updateStates( false );\r\n\t}\r\n\r\n\tprotected onSelect( e: interaction.InteractionEvent ): void {\r\n\t\tthis.emit( \"select\", e );\r\n\t}\r\n\r\n\tpublic onToggle(): void {\r\n\t\tthis.emit( \"toggle\" );\r\n\t}\r\n\r\n\tpublic isExpanded(): boolean {\r\n\t\treturn this._isExpanded;\r\n\t}\r\n\r\n\tpublic isParent(): boolean {\r\n\t\treturn this._isParent;\r\n\t}\r\n\r\n\tpublic getRawData(): DTreeItemRawData {\r\n\t\treturn this._rawData;\r\n\t}\r\n\r\n\tpublic update( options: OPTIONS, isActive: boolean ) {\r\n\t\tthis._textAndImage.text = toText( options );\r\n\t\tthis._textAndImage.image = toImage( options );\r\n\t\tthis._rawData = toRawData( options );\r\n\t\tthis._padding.left = toPaddingLeft( this.theme, options );\r\n\t\tthis.position.y = toYCoordinate( options );\r\n\t\tthis._isParent = isParent( options );\r\n\t\tthis._isExpanded = isExpanded( options );\r\n\t\tthis.updateStates( isActive );\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpublic updateActiveState( isActive: boolean ) {\r\n\t\tthis.setActive( isActive );\r\n\t\tthis._icon.setState( DTreeItemState.SELECTED, isActive );\r\n\t\tthis._textAndImage.setState( DTreeItemState.SELECTED, isActive );\r\n\t}\r\n\r\n\tprotected updateStates( isActive: boolean ): void {\r\n\t\tthis.updateActiveState( isActive );\r\n\t\tthis._icon.setState( DTreeItemState.COLLAPSED, !this._isExpanded && this._isParent );\r\n\t\tthis._icon.setState( DTreeItemState.EXPANDED, !!this._isExpanded && this._isParent );\r\n\t}\r\n\r\n\tprotected getType(): string {\r\n\t\treturn \"DTreeItem\";\r\n\t}\r\n}\r\n","import { DTreeItemRawData } from \"./d-tree\";\r\n\r\n/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nexport class DTreeSelection {\r\n\tprotected _selection!: DTreeItemRawData[];\r\n\r\n\tconstructor() {\r\n\t\tthis._selection = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Select an item.\r\n\t * Add item data to this._selection if it not exist in this._selection.\r\n\t *\r\n\t * @param item Reference data of item want to remove in “value” array.\r\n\t */\r\n\tpublic add( item: DTreeItemRawData ) {\r\n\t\tif( this._selection.indexOf( item ) === -1 ) {\r\n\t\t\tthis._selection.push( item );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Un-select an item.\r\n\t * remove item data to this._selection if it exist in this._selection.\r\n\t *\r\n\t * @param item Reference data of item want to remove in “value” array.\r\n\t */\r\n\tpublic remove( item: DTreeItemRawData ) {\r\n\t\tconst itemIndex = this._selection.indexOf( item );\r\n\t\tif( itemIndex !== -1 ) {\r\n\t\t\tthis._selection.splice( itemIndex, 1 );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Select/un-select an item.\r\n\t * If item data not exist in this._selection, add it to this._selection.\r\n\t * If item data exist in this._selection, remove it to this._selection.\r\n\t *\r\n\t * @param item Reference data of item want to remove in “value” array.\r\n\t */\r\n\tpublic toggle( item: DTreeItemRawData ) {\r\n\t\tconst itemIndex = this._selection.indexOf( item );\r\n\t\tif( itemIndex !== -1 ) {\r\n\t\t\tthis._selection.splice( itemIndex, 1 );\r\n\t\t} else {\r\n\t\t\tthis._selection.push( item );\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Un-select all item.\r\n\t *\r\n\t */\r\n\tpublic clear() {\r\n\t\tthis._selection.length = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Get selected item by index.\r\n\t *\r\n\t * @param index index of item in this._selection\r\n\t *\r\n\t * @returns  Reference data of selected item in “value” array.\r\n\t */\r\n\tpublic get( index: number ): DTreeItemRawData | null {\r\n\t\tconst selection = this._selection;\r\n\t\tif( 0 <= index && index < selection.length ) {\r\n\t\t\treturn selection[ index ];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * Check item is selected or not.\r\n\t *\r\n\t * @param item Reference data of item want to remove in “value” array.\r\n\t *\r\n\t * @returns selected state of checked item.\r\n\t */\r\n\tpublic contains( item: DTreeItemRawData ) {\r\n\t\treturn this._selection.indexOf( item ) !== -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Get number of selected .\r\n\t *\r\n\t * @returns number of selected.\r\n\t */\r\n\tpublic size() {\r\n\t\treturn this._selection.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Iterate over selected items.\r\n\t *\r\n\t * @param iteratee  boolean function. If the iteratee explicitly returns false, an iteration stops.\r\n\t * @param item data of browsed item.\r\n\t */\r\n\tpublic each( iteratee: ( item: DTreeItemRawData ) => boolean ) {\r\n\t\tfor (const item of this._selection) {\r\n\t\t\tif( !iteratee( item ) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Point } from \"pixi.js\";\r\n\r\nexport class ESnapperResultScale {\r\n\tdistance: number;\r\n\tscale: Point;\r\n\r\n\tconstructor() {\r\n\t\tthis.distance = NaN;\r\n\t\tthis.scale = new Point();\r\n\t}\r\n}\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { isNumber } from \"./is-number\";\r\nimport { isString } from \"./is-string\";\r\n\r\nexport const toLabel = ( target: any ): string => {\r\n\tif( target != null ) {\r\n\t\tif( isString( target ) ) {\r\n\t\t\treturn target;\r\n\t\t} else if( isNumber( target ) ) {\r\n\t\t\treturn String( target );\r\n\t\t} else if( \"name\" in target ) {\r\n\t\t\treturn target.name;\r\n\t\t} else if( \"label\" in target ) {\r\n\t\t\treturn target.label;\r\n\t\t} else if( \"id\" in target ) {\r\n\t\t\treturn target.id;\r\n\t\t}\r\n\t}\r\n\treturn \"\";\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { Texture } from \"pixi.js\";\r\nimport { toSvgUrl } from \"./to-svg-url\";\r\n\r\nexport const toSvgTexture = ( svg: string, resolution: number ): Texture => {\r\n\treturn Texture.from( toSvgUrl( svg ), {\r\n\t\tresolution\r\n\t});\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapeImageElements } from \"../e-shape-image-elements\";\r\nimport { EShapeImage } from \"./e-shape-image\";\r\n\r\nexport const createImage = ( dataUrl: string ): Promise<EShapeImage> => {\r\n\treturn EShapeImageElements.toImageElement( dataUrl ).then(( imageElement: HTMLImageElement ): EShapeImage => {\r\n\t\treturn new EShapeImage( imageElement );\r\n\t});\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport { EShapePointsStyle } from \"../e-shape-points-style\";\r\nimport { EShapeLine } from \"./e-shape-line\";\r\n\r\nexport const createLine = (\r\n\tpoints: number[],\r\n\tsegments: number[],\r\n\tstrokeWidth: number,\r\n\tstyle: EShapePointsStyle\r\n): EShapeLine => {\r\n\treturn new EShapeLine( points, segments, strokeWidth, style );\r\n};\r\n\r\nexport const toLineStrokeWidth = ( index: number, resources: string[] ): number => {\r\n\tif( 0 <= index && index < resources.length  ) {\r\n\t\ttry {\r\n\t\t\treturn JSON.parse( resources[ index ] )[ 3 ];\r\n\t\t} catch( e ) {\r\n\t\t\t//\r\n\t\t}\r\n\t}\r\n\treturn 8;\r\n};\r\n","/*\r\n * Copyright (C) 2019 Toshiba Corporation\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\nimport * as ui from \"./wcardinal/ui\";\r\n\r\nui.loadAll();\r\n\r\nconst global = window as any;\r\nglobal.wcardinal = global.wcardinal || {};\r\nglobal.wcardinal.ui = ui;\r\n"],"names":["EShapeType","EShapeDeserializers","EShapePointsStyle","EShapeUploadeds","EShapeTextWeight","EShapeTextStyle","EShapeTextAlignHorizontal","EShapeTextAlignVertical","EShapeTextDirection","toDash","length","strokeWidth","style","result","set","NON_SOLID_MASK","DOTTED","DOTTED_DENSELY","DOTTED_LOOSELY","DASHED","DASHED_DENSELY","DASHED_LOOSELY","toScaleInvariant","nonExpandingWidth","NON_EXPANDING_WIDTH","nonShrinkingWidth","NON_SHRINKING_WIDTH","nonScalingDotAndDash","NON_SCALING_DOT_AND_DASH","BAR_WORK_POINT","Point","this","_target","_position","Object","UtilCharacterIterator","position","target","istart","iend","i","code","charCodeAt","isLowSurrogate","isVariationSelector","nextBreak","findNextBreak","substring","except","_instance","instance","init","EShapeBarPosition","toLength","p0x","p0y","p1x","p1y","dx01","dy01","Math","sqrt","TEXT_WORK_POINT","toTextBufferCount","shape","ceil","text","value","buildTextClipping","clippings","voffset","vcount","imax","buildTextIndex","indices","ioffset","icount","ii","j","buildTextStep","steps","textAtlas","textSize","textOutlineWidth","textWeight","antialiasWeight","scale","font","size","outlineWidth","weight","NORMAL","getTextBBox","halign","valign","hoffset","hpadding","vpadding","width","height","x0","y0","x1","y1","x2","y2","x3","y3","hnx","hny","vnx","vny","LEFT","TOP","x","y","MIDDLE","BOTTOM","OUTSIDE_TOP","OUTSIDE_BOTTOM","CENTER","RIGHT","OUTSIDE_LEFT","OUTSIDE_RIGHT","toNormalized","dx","dy","defx","defy","d","l","li","buildTextVertex","vertices","uvs","originX","originY","sizeX","sizeY","textValue","textStyle","textAlignHorizontal","textAlignVertical","textOffsetHorizontal","textOffsetVertical","textSpacingHorizontal","textSpacingVertical","textDirection","textPaddingHorizontal","textPaddingVertical","textClipping","textWorld","textureUvs","internalTransform","sx","sy","work","apply","hl","a","b","vl","c","heightChar","lineHeight","max","lineWidth","textAtlasCharacters","characters","iterator","from","advancePrevious","hasNext","character","next","data","advance","tx0","ty0","lineWidthMaximum","NaN","LEFT_TO_RIGHT","TOP_TO_BOTTOM","align","rotateAlignVerticalRight","rotateAlignHorizontalRight","BOTTOM_TO_TOP","rotateAlignVerticalLeft","rotateAlignHorizontalLeft","dwidth","uvx0","uvx1","uvx3","uvy0","uvy1","uvy3","duvx01","duvy01","duvx03","duvy03","lhx","lhy","snx","sny","offsetY","oyx","oyy","offsetItalic","bx0","by0","bx3","by3","cx0","cy0","cx3","cy3","lineCount","iv","lineWidthPrevious","ax","ay","dots","bx","by","writeCharacter","writeCharacterEmpty","adjustTextAlignment","ivmax","atlas","dataOffsetX","origin","dataWidth","dx0","dy0","dx1","dy1","px0","py0","px1","py1","dux0","duy0","dux1","duy1","dvx0","dvy0","dvx1","dvy1","moveText","vertexIndex","textCount","moveTextHalf","offset","nx","ny","moveTextFull","extendStatics","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","prototype","create","DBaseState","parent","_parent","_id","_values","_segments","_style","_size","_updatedSize","_updatedParentSizeX","_updatedParentSizeY","_updatedPosition","EShapeBarPoints","abs","parentSize","parentSizeX","parentSizeY","psxh","psyh","computedSize","getComputedSize","values","update","segments","moveTo","undefined","source","newValues","newSegments","newStyle","newPosition","newSize","isChanged","updateUploaded","transform","point","push","manager","add","resourceId","resources","resource","parsed","JSON","parse","threshold","range","tester","DApplications","INSTANCES","instances","Error","index","indexOf","stage","toStage","layer","application","getLayerBase","getLayerOverlay","render","EShapeCopyPart","EShapeAction","splice","sources","destinations","isEquals","indexA","indexB","tmp","serialize","EShapeRuntimeReset","EShapeRuntimeState","isString","toString","call","UtilKeyboardEvent","e","key","which","ctrlKey","shiftKey","expressionOrShortcut","event_1","expression","arrowIndex","keyExpression","trim","keys","toLowerCase","split","shortcut","shift","toUpperCase","setShortcutKeyAndWhich","alt","ctrl","event","parts","join","handler","toShortcut","document","body","addEventListener","altKey","isActionable","emit","preventDefault","EShapeCorner","EShapeStrokeSide","rotation","actions","fill","toObject","stroke","cursor","reset","NONE","written","effect","state","interactive","EShapeRuntime","disabled","CLICKED","CHANGED","hovered","getLayer","DOWN","PRESSED","focusController","getFocusController","setFocused","findFocusableParent","UP","isActivateKey","onPointerDown","onPointerUp","onPointerClick","newState","oldState","time","tag","isEffectTimeUp","disallowUploadedUpdate","onUpdate","allowUploadedUpdate","PERSISTENT","executeActions","resetUnwrittenProperties","execute","POSITION_X","POSITION_Y","VISIBILITY","visible","COLOR_FILL","color","alpha","COLOR_STROKE","COLOR_TEXT","COLOR_TEXT_OUTLINE","outline","HEIGHT","WIDTH","ROTATION","TEXT","CURSOR","_super","_this","Matrix","EShapeTransformImpl","onChange","onTransformChange","updateSkew","_currentLocalID","_localID","_parentID","_worldID","parentTransform","oldLocalId","oldWorldId","updateTransform","newLocalId","newWorldId","localTransform","copyTo","prepend","Transform","toPadded","str","strLength","padding","UtilRgb","trimmed","Number","r","g","colorA","colorB","t","ar","ag","ab","br","bg","bb","w1","min","w0","amount","blend","EShapeGradients","gradient","points","direction","parseGradient","serialized","serializeGradient","stops","toCode","radian","PI","cos","sin","btoa","type","id","newTransform","_onTransformChangeLock","_isOnTransformChanged","action","_visible","_uploadedUpdateLock","_isUploadedUpdated","_isUploadedUpdatedRecursively","_boundsTransformId","_boundsInternalTransformId","_boundsLocalTransformId","_state","_stateLocal","UNFOCUSABLE","children","selected","reference","EShapeBase","onTransformChange_","updateUploadedRecursively","parent_1","onChildTransformChange","invokeOnTransformChange","uploaded","root","toDirty","at","detach","IDENTITY","childrenSerialized","child","image","src","toGradientId","pivot","shortcutId","title","titleId","skew","radius","corner","serializeImage","serializeChildren","unfocusable","s","rect","toLocalRect","WORK_RECT","containsAbs","containsText","containsChildren","world","tx","ty","th","tv","applyInverse","childResult","contains","shadowed","containsAbsBBox","skipUpdate","copyFrom","worldTransform","bounds","_bounds","Rectangle","worldId","getWorldId","getBounds_","boundsInternal","_boundsInternal","currentLocalId","getLocalIdCurrent","boundsLocal","_boundsLocal","px","py","getBoundsSize","xmin","ymin","xmax","ymax","destroy","stateLocal","mergeState","getState","onStateChange","stateParent","DISABLED","FOCUSED","FOCUSED_IN","runtime","onParentStateChange","newStateParent","oldStateParent","isOn","updateState","focused","hasState","HOVERED","isHovered","setState","ACTIVE","isActive","READ_ONLY","isReadOnly","isDisabled","DRAGGING","isDragging","unforcusable","onPointerDblClick","onKeyDown","onKeyUp","part","ALL","TRANSFORM","sourceTransform","SIZE","STYLE","copy","ACTION","addAll","POINTS","sourcePoints","clone","STATE","utils","EventEmitter","EShapeTagValueOrder","EShapeTagValueRangeType","EShapeDefaults","enable","_enable","_color","_alpha","EShapeFillImpl","stringified","fills","get","deserialized","side","_width","_align","_side","EShapeStrokeImpl","strokes","DBorderMask","_type","_from","_to","EShapeTagValueRangeImpl","parent_2","to","parent_3","FROM","TO","parent_4","FROM_TO","copy_","parent_5","ranges","INDEX_COMPARATOR","initial","format","_value","_time","_capacity","_order","ASCENDING","EShapeTagValueImpl","newValue","formatter","capacity","order","unshift","count","normalize","newTime","times","_times","parent_6","newTimes","parent_7","parent_8","parent_9","parent_10","sorted","slice","sort","parent_11","parent_12","idSerialized","initialSerialized","formatSerialized","rangeSerialized","tagValues","deserialize","EShapeTagImpl","inherited","RANGE_DUMMY","nvalue","EMPTY_ARRAY","tags","horizontal","vertical","_horizontal","_vertical","EShapeTextAlignImpl","aligns","EShapeTextOffsetImpl","margins","EShapeTextOutlineImpl","textOutlines","family","_family","_weight","spacing","_direction","_clipping","EShapeTextImpl","isCompatible","clipping","isChangedDirty","isChangedUploaded","alignSerialized","offsetSerialized","outlineSerialized","spacingSerialized","paddingSerialized","texts","newFill","newStroke","_radius","RADIUS","_corner","newText","EShapePrimitive","ObservablePoint","onSizeChange","SIZE_X","SIZE_Y","FILL_COLOR","FILL_ALPHA","STROKE_COLOR","STROKE_ALPHA","STROKE_WIDTH","STROKE_ALIGN","STROKE_SIDE","TEXT_VALUE","TEXT_FAMILY","TEXT_SIZE","_image","imageSrc","EShapeLineBase","container","getPixelScale","toThreshold","strokeScale","getStrokeWidthScale","toHitThreshold","calcHitPointAbs","calcHitPointAbsHitTester","d0x","d0y","d1x","d1y","BAR","EShapeBar","buildColor","colors","ic","buffer","transformLocalId","vertexOffset","vertexCount","indexOffset","indexCount","colorFill","alphaFill","colorStroke","alphaStroke","strokeAlign","strokeSide","texture","textureTransformId","EShapeUploadedBase","getLocalId","Texture","WHITE","textureAny","_uvs","updateUvs","_updateID","isEnabled","updateColorFills","colorFills","updateColorStrokes","colorStrokes","updateColorFill","updateColorStroke","builder","baseTexture","tvcount","ticount","textFamily","textTexture","textTextureTransformId","textColor","textAlpha","textOutlineColor","textOutlineAlpha","textVertexOffset","textIndexOffset","textVertexCount","textIndexCount","EShapeTextUploaded","updateClippings","updateIndices","updateTextVertex","updateTextColorFill","updateTextColorStroke","updateTextStep","updateColorFillAndStroke","toTextureTransformId","isCharChanged","isCharSizeChanged","isCharStyleChanged","isCharAlignChanged","isCharOffsetChanged","isCharSpacingChanged","isCharDirectionChanged","isClippingChanged","isTextureChanged","updateVertices","shapeSize","Float32Array","toTextureUvs","textOutline","updateSteps","buildUnit","textBaseTexture","pointsId","pointsStyle","EShapeBarUploaded","buildBarClipping","buildBarIndex","initText","updateVertexStepAndColorFill","updateColor","updateUv","updateText","isSizeChanged","isStrokeWidthChanged","toTransformLocalId","isTransformChanged","isPointsIdChanged","isPointsStyleChanged","pointValues","pointsSize","pv0","pv1","pv2","pv3","p2x","p2y","distance","ratio","p3x","p3y","scaleInvariant","icf","is","dash","dash0","dash1","buildBarVertexStepAndColorFill","iuv","toTexture","createBarUploaded","tcount","check","isArray","isNumber","EShapeActionBases","isFunction","theme","options","callback","_theme","_callback","background","DBaseBackground","getBackgroundColor","getBackgroundAlpha","DCornerMask","border","_mask","mask","DBaseBorder","getBorderColor","getBorderAlpha","getBorderWidth","getBorderAlign","getBorderMask","DBaseInteractive","DBaseCorner","getCornerRadius","getCornerMask","DLayoutClearType","NodeType","_offset","DBaseOutline","getOutlineColor","getOutlineAlpha","getOutlineWidth","getOutlineOffset","getOutlineAlign","getOutlineMask","_left","_top","_right","_bottom","left","top","right","bottom","DBasePadding","getPaddingLeft","getPaddingTop","getPaddingRight","getPaddingBottom","cb","scope","_point","DBasePoint","arguments","equals","borderSize","cornerMask","Uint16Array","_height","_texture","_borderSize","_cornerMask","_isDirty","_textureId","_vertexBuffer","getBuffer","_vertices","_uvBuffer","_indexBuffer","getIndex","_indices","DBaseBackgroundMeshGeometry","array","u0","u1","u2","u3","v0","v1","v2","v3","fillVertices","valid","textureId","getTextureId","w","h","ctl","TOP_LEFT","ctr","TOP_RIGHT","cbl","BOTTOM_LEFT","cbr","BOTTOM_RIGHT","ia","fillUvsCorner","fillIndices","fillUvs","MeshGeometry","MeshMaterial","DBaseBackgroundMesh","shader","geometry","renderer","_render","Mesh","borderMask","_borderMask","DBaseBorderMeshGeometry","b1","b2","uz","vz","bt","bl","DBaseBorderMesh","base","cornerRadius","getRadius","cornerHeight","getMask","backgroundPlane","_backgroundPlane","getBackgroundTexture","appendRenderable","borderWidth","getWidth","borderPlane","_borderPlane","getBorderTexture","outlineMask","outlinePlane","_outlinePlane","DBaseOutlineMesh","_lastBackgroundCornerRadius","_lastBorderCornerRadius","_lastBorderWidth","_lastOutlineCornerRadius","_lastOutlineWidth","addReflowable","DBaseReflowable","backgroundColor","getColor","backgroundAlpha","getAlpha","tint","borderColor","borderAlpha","borderAlign","getAlign","borderOffset","outlineColor","outlineAlpha","outlineOffset","getOffset","outlineAlign","outlineOffsetAccumulative","DBaseStates","ACTIVE_IN","INVALID","SUCCEEDED","FAILED","destination","destinationState","when","on","newSourceState","isNotActive","bind","AutoFlag","TOKEN_MAPPING_OPERATOR","+","-","*","/","(",")",",","TOKEN_MAPPING_LITERAL","%","nodes","toToken","toParensesis","toUnary","toArithmetic","node","_node","DScalarExpression","ifrom","ito","nodeType","nodeTypePrev","jnode","toComma","operand","iprev","toCommaOf","toUnaryNode","operatorA","operatorB","toArithmeticNode","tokens","matched","TOKEN_REGEX","exec","token","tokenTypeOperator","parsedToken","parseFloat","tokenTypeLiteral","self","current","evaluate","args","POSITION_CENTER","POSITION_PADDING","SIZE_MAXIMIZED","SIZE_PADDING","DScalarFunctions","coordinate","scalarExpression_1","calculate","scalar_1","scalarExpression_2","scalar_2","DThemes","DEFAULT_THEME_CLASS","INSTANCE","defaultThemeClass","getDefaultThemeClass","UtilPointerEvent","interactionManager","touches","changedTouches","touch","mapPositionToPoint","clientX","clientY","touchable","isDowned_1","downX_1","downY_1","interactionManagerBound_1","cleanup_1","off","up_1","onUp_1","up","global","CLICK_DISTANCE_THRESHOLD","isValidDistance_1","down","global_1","global_2","plugins","interaction","once","onClick","onLongClick","isDowned_2","downX_2","downY_2","timeoutId_1","interactionManagerBound_2","cleanupTimeout_1","clearTimeout","cleanup_2","up_2","onUp_2","move_1","onMove_1","isValidDistance_2","move","global_3","originalEvent","window","setTimeout","LONG_CLICK_THRESHOLD","isDowned_3","downX_3","downY_3","clickTime_1","timeStamp","DBLCLICK_INTERVAL_THRESHOLD","item","targetOrChild","DMouseModifier","onPositionChanged","_scale","onScaleChanged","_skew","onSkewChanged","_options","scalarSet","_scalarSet","_autoFlags","_hasDirty","_isChildrenDirty","_shadow","_name","name","getInstance","toTheme","getThemeDefault","_befores","_afters","_reflowables","_clearType","clear","getClearType","_padding","layout","toChildrenDirty","toDirtyAndUpdate","_background","_border","_outline","initReflowable","getX","getY","toWidthAuto","getHeight","toHeightAuto","getInteractive","SELF","interactiveChildren","CHILDREN","name_1","_title","getTitle","getWeight","_onShadowUpdateBound","shadow","getShadow","newShadowWeak","newShadow","over","onOver","out","onOut","onDown","onUp","isDirty","hasDirty","toParentHasDirty","toParentChildrenDirty","blur","shortcuts","_shortcuts","toShortcuts","onShortcutBound","onShortcut","getCursor","states","addChild","DBase","renderable","phase","list","reflowable","reflowables","onChildrenChange","moveChildren","oldWidth","oldHeight","widthResized","heightResized","resized","onResize","getParentOfSize","getLeft","getTop","newWidth","newHeight","resizeChildren","getType","scalar","isWidthAuto","isHeightAuto","applyTitle","view","toHasDirty","onChildrenDirty","isPressed","isInvalid","isSucceeded","isFailed","isFocused","recursively","getFocused","oldStateLocal","newStateLocal","statesOn","statesOff","onFocused","onBlured","onChildFocused","setTheme","refit","onRefit","hasRefitableWidth","hasRefitableHeight","resize","getRight","getBottom","isRefitable","onReflow","reflow","previous","removeReflowable","removeRenderable","prependRenderable","onParentResize","parentWidth","parentHeight","parentPadding","paddingWidth","paddingHeight","newX","newY","onParentMove","deltas","isEventTarget","onDownThis","lastDownPoint","_lastDownPoint","focusOnClosest","onUpThis","setHovered","worldAlpha","renderBefore","renderAfter","befores","before","afters","after","WORK_CONTAINS_POINT","addPoint","_calculateBounds","containsGlobalPoint","containsLocalPoint","Container","DBaseOverflowMask","tl","tr","beginFill","lineStyle","lineTo","arcTo","endFill","Graphics","DDragMode","DMouseModifiers","oe","CTRL","ALT","SHIFT","modifier","OR","EShapeActionValueBlinkType","DAnimationTimings","_startTime","_duration","duration","_durationInverse","_reverse","_onTime","onTime","_onTimeBaseBound","onTimeBase","_onStart","onStart","_onEnd","onEnd","_timing","timing","ELASTIC","DAnimationBase","reverse","stop","Date","now","toTime","isReverse","elapsedTime","ds","dt","UtilDragEasingHistory","onMove","_histories","_historiesSorted","_historyBegin","_historyEnd","_dx","_dy","_ds","_dt","_animation","onEase","LINEAR","_durationPosition","_durationScale","_onMove","UtilDragEasing","histories","HISTORY_CAPACITY","oldHistoryEnd","newHistoryEnd","oldHistoryBegin","unsorted","begin","end","total","history_1","history_2","history_3","ldt","adt","updateHistoriesSorted","sortedLength","history_4","d0","d1","animation","start","_modifier","_checker","checker","defaultChecker","match","toChecker","_interactionManager","_center","_scalingCenter","easing","_easing","onEasingMove","toEasingOptions","_onDownBound","_onMoveBound","_onEndBound","_down","_move","_up","UtilDrag","center","touchesLength","first","centerX","centerY","squareDistance","stopPropagation","calcCenterAndScale","setDragging","newScale","oldScale","oldTime","EPSILON","scalingCenter","toTarget","stopper","_toTarget","_stopper","mode","getDragMode","getDragModifier","getDragDurationPosition","getDragDurationScale","TOUCH","_bind","ON","_dragUtil","toNormalizedScale","scaleRatio","cx","cy","DViewDragImpl","dragUtil","_newScaleX","_newScaleY","_newX","_newY","_oldScaleX","_oldScaleY","_oldX","_oldY","DViewTransformImpl","scaleX","scaleY","Y","_workRect","zoom","_zoomPoint","_zoomMin","getZoomMin","_zoomMax","getZoomMax","_zoomKeepRatio","keepRatio","getZoomKeepRatio","wheelZoom","wheel","_isWheelZoomEnabled","isWheelZoomEnabled","_wheelZoomSpeed","speed","getWheelZoomSpeed","_wheelZoomModifier","getWheelZoomModifier","_wheelZoomChecker","dblClickZoom","dblclick","_isDblClickZoomEnabled","isDblClickZoomEnabled","_dblClickZoomSpeed","getDblClickZoomSpeed","_dblClickZoomModifier","getDblClickZoomModifier","_dblClickZoomChecker","_dblclickZoomDuration","getDblClickZoomDuration","wheelTranslation","translation","_isWheelTranslationEnabled","isWheelTranslationEnabled","_wheelTranslationSpeed","getWheelTranslationSpeed","_wheelTranslationModifier","getWheelTranslationModifier","_wheelTranslationChecker","_drag","drag","_transform","DViewImpl","targetRect","getLocalBounds","newTargetX","newTargetY","targetX","targetY","targetWidth","targetHeight","newTargetScaleX","newTargetScaleY","newTargetScale","factor","targetScale","oldScaleX","oldScaleY","newScaleX","newScaleY","scaleRatioX","scaleRatioY","local","toLocal","zoomAt","toGlobal","deltaY","lowest","zoomAtGlobal","deltaX","DCanvasContainer","_canvas","_view","canvas","_overflowMask","isOverflowMaskEnabled","getOrCreateOverflowMask","updateContentSize","removeChild","canvasX","canvasY","vresult","onWheel","sresult","onDblClick","overflowMask","EShapeActionRuntime","def","defLiteral","Function","conditionDefault","condition","toExpression","interval","EShapeActionRuntimeBlink","dinterval","elapsed","toOff","toOn","EShapeActionRuntimeConditional","COLOR","EShapeActionRuntimeBlinkBrighten","toBaseFill","brighten","toBaseStroke","toBaseText","toBaseTextOutline","EShapeActionRuntimeBlinkColorFill","EShapeActionRuntimeBlinkColorStroke","EShapeActionRuntimeBlinkDarken","darken","COLOR_FILL_AND_STROKE","EShapeActionRuntimeBlinkOpacity","EShapeActionRuntimeBlinkVisibility","EShapeActionValueType","EShapeActionValueBase","toLabel","subtype","EShapeActionValueSubtyped","EShapeActionValueChangeColorTarget","EShapeActionValues","BLINK","EShapeActionValueBlink","BRIGHTEN","DARKEN","OPACITY","conditionId","toResource","UtilAlpha","alphaA","alphaB","EShapeActionValueChangeColorType","blendDefault","ALPHA","EShapeActionRuntimeChangeColor","baseFill","baseStroke","baseText","baseOutline","EShapeActionRuntimeChangeColorAll","setAll","EShapeActionRuntimeChangeColorFill","EShapeActionRuntimeChangeColorFillAndStroke","sets","EShapeActionRuntimeChangeColorStroke","EShapeActionRuntimeChangeColorText","EShapeActionRuntimeChangeColorTextOutline","EShapeActionValueChangeTextType","CHANGE_COLOR","EShapeActionValueChangeColor","FILL","STROKE","FILL_AND_STROKE","TEXT_OUTLINE","blendId","brightnessDefault","brightness","EShapeActionRuntimeChangeColorBrightness","toColorAdjusted","EShapeActionRuntimeChangeColorBrightnessAll","EShapeActionRuntimeChangeColorBrightnessFill","EShapeActionRuntimeChangeColorBrightnessFillAndStroke","EShapeActionRuntimeChangeColorBrightnessStroke","EShapeActionRuntimeChangeColorBrightnessText","EShapeActionRuntimeChangeColorBrightnessTextOutline","EShapeActionValueChangeColorBrightness","BRIGHTNESS","brightnessId","colorDefault","alphaDefault","EShapeActionRuntimeChangeColorCode","EShapeActionRuntimeChangeColorCodeAll","EShapeActionRuntimeChangeColorCodeFill","EShapeActionRuntimeChangeColorCodeFillAndStroke","EShapeActionRuntimeChangeColorCodeStroke","EShapeActionRuntimeChangeColorCodeText","EShapeActionRuntimeChangeColorCodeTextOutline","EShapeActionValueChangeColorCode","CODE","colorId","alphaId","nameDefault","EShapeActionRuntimeChangeCursor","CHANGE_CURSOR","EShapeActionValueChangeCursor","nameId","FormatNodeA","step","date","getHours","FormatNodea","FormatNodeD","String","getDate","FormatNoded","precision","FormatNodee","toExponential","FormatNodePrecision","FormatNodef","toFixed","FormatNodefsi","toAbs","format_","unitInverse","postfix","FormatNodeg","toPrecision","FormatNodeH","FormatNodeh","FormatNodeM","getMonth","FormatNodem","getMinutes","FormatNodemi","getMilliseconds","FormatNodeP","FormatNodep","FormatNodePadding","FormatNodeParenthesis","FormatNodePlus","FormatNodeRP","round","FormatNoderp","M","D","H","m","mi","FormatNodesdt","FormatNodeSpace","FormatNodessi","FormatNodeString","FormatNodeY","getFullYear","FormatNodey","FormatNodez","z","getTimezoneOffset","floor","FormatNoderd","FormatNodes","getSeconds","REGEXP","previousIndex","isDateRequired","lastIndex","all","toModifiedNodeDatetime2","toModifiedNodeDatetime3","toModifiedNodeNumber","NumberFormatterImpl","setTime","NumberFormatters","numberDefault","number","EShapeActionRuntimeChangeTextNumber","textDefault","EShapeActionRuntimeChangeTextText","EShapeActionValueMiscType","CHANGE_TEXT","EShapeActionValueChangeText","NUMBER","valueId","EShapeActionRuntimeEmitEvent","toContainer","EMIT_EVENT","EShapeActionValueEmitEvent","ASCII_CHARACTERS","reserved","ref","life","DynamicFontAtlasCharacterOrigin","_gl","_shaderProgram","_vertexPositionAttribute","_textureCoordAttribute","_samplerUniform","_sizeUniform","_vb","_uvb","createElement","_onLostBound","_onRestoreBound","restore","_onUnloadBound","DynamicSDFFontGenerator","isContextLost","config","antialias","depth","stencil","premultipliedAlpha","gl","getContext","clearColor","makeVertexBuffer","makeUvBuffer","makeShaders","createShader","FRAGMENT_SHADER","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","console","error","getShaderInfoLog","vertexShader","getShader","fragmentShader","shaderProgram","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","deleteShader","useProgram","getAttribLocation","getUniformLocation","getError","deleteProgram","viewport","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","deleteTexture","vb","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","deleteBuffer","uvb","COLOR_BUFFER_BIT","vertexPositionAttribute","enableVertexAttribArray","vertexAttribPointer","FLOAT","textureCoordAttribute","activeTexture","TEXTURE0","uniform1i","uniform2f","drawArrays","TRIANGLE_STRIP","copyCanvas","copyContext","drawImage","destroyVertexBuffer","destroyUvBuffer","destroyShaders","removeEventListener","WebGLLoseContext","getExtension","loseContext","_INSTANCE","fontFamily","_generator","_font","DynamicSDFFontAtlas","toFontFamily","italic","_characters","_length","addChar","DynamicFontAtlasCharacter","generator","context","characterSize","toPowerOf2","fontStyle","textAlign","textBaseline","lineCap","lineJoin","miterLimit","fillStyle","measureText","characterWidth","characterHeight","clearRect","fillText","updateTexture","read","stringify","toJson","getAutoFontFamily","FONT_FAMILY_AUTO","getFontFamilly","input","_onInputKeyDownBound","onInputKeyDown","_onInputBlurBound","onInputBlur","_updateInputBound","updateInput","_onInputChangeBound","onInputChange","_onInputInputBound","onInputInput","_updateInputBoundRenderer","EShapeActionRuntimeMiscInputData","getRootElement","appendChild","createInput","setAttribute","getInputType","getInputStyle","readonly","removeAttribute","paddingHorizontal","matrix","getInputStylePosition","getInputStyleMargin","getInputStyleText","getInputStyleBackground","getInputStyleBorder","getInputStylePadding","getInputStyleOutline","isFocusKey","hide","getFocusDirection","focusable","findFocusable","focus","isOkKey","HTMLInputElement","onInput","newShape","oldShape","getInput","initInput","updateInputBound","display","select","EShapeActionRuntimeMiscInput","data_1","getData","isShown","show","_","EShapeActionValueOpenType","MISC","EShapeActionValueMisc","INPUT","targetDefault","EShapeActionRuntimeOpenFlow","opener","EShapeActionRuntimeOpen","EShapeActionRuntimeOpenPage","open","EShapeActionRuntimeOpenPageInplace","location","href","EShapeActionValueShowHideType","OPEN","EShapeActionValueOpen","FLOW","PAGE","PAGE_INPLACE","targetId","EShapeActionValueTransformMoveType","EShapeActionValueTransformType","visibility","SHOW","EShapeActionRuntimeShowHide","SHOW_HIDE","EShapeActionValueShowHide","amountDefault","EShapeActionRuntimeTransformMoveAbsoluteX","EShapeActionRuntimeTransformMove","EShapeActionRuntimeTransformMoveAbsoluteY","POSITION","EShapeActionRuntimeTransformMoveForwardOrBackward","writtenPositionX","writtenPositionY","oldPositionX","oldPositionY","EShapeActionRuntimeTransformMoveLeftOrRight","EShapeActionRuntimeTransformMoveRelativeX","EShapeActionRuntimeTransformMoveRelativeY","opetype","EShapeActionValueOpetyped","EShapeActionValueTransformResizeType","MOVE","EShapeActionValueTransformMove","ABSOLUTE_X","ABSOLUTE_Y","FORWARD_OR_BACKWARD","LEFT_OR_RIGHT","RELATIVE_X","RELATIVE_Y","amountId","EShapeSizes","toRounded","centerMode","isPerfect","hsize","EShapeActionValueTransformRotateType","sizeRelativeDefault","sizeAbsoluteDefault","RELATIVE_SIZE","ABSOLUTE_SIZE","RELATIVE_HEIGHT","ABSOLUTE_HEIGHT","RELATIVE_WIDTH","ABSOLUTE_WIDTH","EShapeActionRuntimeTransformResize","dsx","dsy","EShapeActionRuntimeTransformResizeHeightAbsolute","sizeAbsolute","oldSizeY","adjustPosition","EShapeActionRuntimeTransformResizeHeightRelative","sizeRelative","EShapeActionRuntimeTransformResizeSizeAbsolute","writtenWidth","writtenHeight","oldSizeX","EShapeActionRuntimeTransformResizeSizeRelative","EShapeActionRuntimeTransformResizeWidthAbsolute","EShapeActionRuntimeTransformResizeWidthRelative","RESIZE","EShapeActionValueTransformResize","EShapeActionRuntimeTransformRotate","oldRotation","newRotation","EShapeActionRuntimeTransformRotateAbsolute","EShapeActionRuntimeTransformRotateRelative","ROTATE","EShapeActionValueTransformRotate","ABSOLUTE","RELATIVE","EShapeActionValueDeserializer","toSerialized","COLOR_AND_ALPHA","EShapeImageElements","dataUrl","imageElements","cachedImageElement","HTMLImageElement","Promise","resolve","reject","imageElement","onload","onabort","onerror","Map","extensions","EShapeDeserializer","shapeDeserializer","childrenPromise","childrenOrPromises","childSerialized","childOrPromise","toShape","then","serializedActions","gradientId","deserializeGradient","imagePromise","imageId","toImageElement","serializeds","EShapeResourceManagerDeserialization","shapes","resolved","jmax","deserializeBar","loadShapeBar","buildStep","swx","swy","STEP_VALUES","toStep","dpc0","pc0","pc1","swc","pc","CIRCLE_WORLD_SIZE","CIRCLE_WORK_POINT","buildCircleClipping","buildCircleIndex","buildCircleVertex","worldSize","x4","y4","x7","y7","buildCircleStep","buildCircleUv","EShapeCircleUploaded","updateCircleVertexAndStep","updateCircleUv","isStrokeChanged","createCircle","CIRCLE","EShapeCircle","ay2","ax2","wx","wy","wx2","wy2","deserializeCircle","loadShapeCircle","EShapeGroupUploaded","createGroupUploaded","EShapeGroupFillEditor","EShapeGroupPoints","toPoints","internalTransformParentInverse","EShapeTransforms","editor","EShapeEditor","invert","identity","disallowOnTransformChange","allowOnTransformChange","keepSize","newLocalTransform","append","applyLocal","rx","atan2","ry","shapeBase","EShapeGroupSizeLayout","baseX","baseY","pivotX","pivotY","childBase","WORK_TRANSFORM","translate","_layouts","EShapeGroupSizeEditor","ox","oy","calcRect","_workRectForFit","layouts","workPoint","_workPoint","workRect","_workRectForCalcRect","getBoundsLocal","enlarge","onChange_","newLayout","EShapeGroupSizeViewer","EShapeGroupStrokeEditor","EShapeGroupTextAlignEditor","EShapeGroupTextOffsetEditor","EShapeGroupTextOutlineEditor","EShapeGroupTextPaddingEditor","EShapeGroupTextSpacingEditor","EShapeGroupTextEditor","GROUP","newGroupSize","newGroupFill","newGroupStroke","newGroupText","newGroupPoints","EShapeGroup","IS_EDIT_MODE","result_1","fit","_points","deserializeGroup","loadShapeGroup","EShapeGroupSizeShadowed","GROUP_SHADOWED","EShapeGroupShadowed","deserializeGroupShadowed","loadShapeGroupShadowed","RECTANGLE_WORLD_SIZE","RECTANGLE_WORK_POINT","buildRectangleClipping","bri","buildRectangleClippingVertical","cbx","cby","buildRectangleIndex","buildRectangleVertex","bx1","by1","bx2","by2","buildRectangleVertexVertical","xc","yc","x5","y5","x6","y6","xcl","ycl","x8","y8","x9","y9","x10","y10","x11","y11","x12","y12","x13","y13","xcr","ycr","x14","y14","x15","y15","x16","y16","x17","y17","buildRectangleStep","worldSizeX","worldSizeY","swt","pt0","swr","pr0","swb","pb0","swl","pl0","pm0","buildRectangleStepVertical","buildRectangleStepHorizontal","buildRectangleUv","buildRectangleUvVertical","x01","y01","x02","y02","x23","y23","x03","y03","xbu","ybu","xbb","ybb","EShapeRectangleUploaded","updateVertexClippingStepAndUv","isVertexChanged","createRectangleUploaded","RECTANGLE","EShapeRectangle","TOP_OR_LEFT","BOTTOM_OR_LEFT","TOP_OR_RIGHT","BOTTOM_OR_RIGHT","IMAGE","EShapeImage","deserializeImage","loadShapeImage","IMAGE_SDF_WORLD_SIZE","IMAGE_SDF_WORK_POINT","buildImageSdfClipping","buildImageSdfIndex","buildImageSdfStep","textureWidth","textureHeight","scaleBase","scaleZ","outlinePosition","buildImageSdfVertex","buildImageSdfUv","textureUv","EShapeImageSdfUploaded","updateVertexAndStep","resolution","isTextureSizeChanged","createImageSdfUploaded","IMAGE_SDF","EShapeImageSdf","deserializeImageSdf","EShapeLabelUploaded","updateLabelVertex","updateLabelUv","createLabelUploaded","LABEL","EShapeLabel","deserializeLabel","loadShapeLabel","toIndexOf","i0","i1","i2","LINE_WORK_POINT","toLineVertexCount","pointCount","buildLineClipping","pointsClosed","icmax","buildLineIndex","iimax","io","buildLineUv","dx32","dy32","lengthInverse","iuvmax","buildLineVertexStepAndColorFill","pointSegments","lmax","lprev","lnext","llop","llo","pprevx","pprevy","pnextx","pnexty","pseg","psegnext","icfprev","loffset","pfirstx","pfirsty","psegfirst","pvl0","pvl1","plastx","plasty","pseglast","psecondx","psecondy","psegsecond","nextIndex","pvn0","pvn1","pnextxn","pnextyn","loffsetprev","pointId","EShapeLineUploaded","updateLineClipping","updateLineVertexStepAndColorFill","updateLineUv","CLOSED","isPointChanged","createLineUploaded","minX","maxX","minY","maxY","pointsLength","_valuesBase","_valuesBaseLength","_sizeBase","EShapeLinePoints","ssx","ssy","sizeBase","hasSizeBaseX","hasSizeBaseY","valuesBase","fitToParentSize","isUpdated","valuesBaseLength","newValuesLength","iupdate","newSegmentsLength","rangeResult","WORK_RANGE","lineOrPoints","LINE","EShapeLine","deserializeLine","loadShapeLine","toLineOfAnyPointCount","buildLineOfAnyColor","vcountPerPoint","colorDef","alphaDef","isStaticColor","isStaticAlpha","createLineOfAnyUploaded","icountPerPoint","buildNullClipping","buildNullVertex","buildNullStep","buildNullUv","copyClipping","icd","ics","copyIndex","idiv","iid","iis","copyStep","iss0","isd","iss","copyUvs","iuvd","iuvs","copyVertex","pointsValues","pointOffset","isStaticX","isStaticY","ip","ivd","ivs","isStatic","toComputed","EShapeLineOfAnyPointsFillImpl","frame","DynamicAtlasItem","resolutionInverse","DynamicAtlasItemEmpty","DynamicAtlasItemFontAtlas","DynamicAtlasItemImage","_text","DynamicAtlasItemText","DynamicAtlasItemWhite","save","fillRect","_baseTexture","BaseTexture","mipmap","MIPMAP_MODES","OFF","_idToDatum","_sortedData","_predefined","empty","white","DynamicAtlas","maxRowHeight","datum","minHeight","applyFrame","ITEM_COMPARATOR","idToDatum","forcibly","cleanup","canvasWidth","calcCanvasWidth","canvasHeight","updateFrames","renderFrames","setRealSize","applyFrames","predefined","fontId","hex2string","metrics","TextMetrics","measureFont","ascent","descent","fontSize","fontColor","_context","DynamicFontAtlasFont","_unrefCount","_revision","_revisionUpdated","scaleMode","SCALE_MODES","add_","DynamicFontAtlas","getAdvance","targets","remove_","strokeStyle","cleanup_","fontHeight","realWidth","realHeight","updateAll","colorToAltas","forEach","destroyAll","_atlases","_resolution","DynamicFontAtlases","atlases","colorToAtlas","remove","DynamicSDFFontAtlases","addAscii","newAtlas","baseAtlas","getBaseTexture","atlasId","isNaN","newInstance","Lazy","toCeilingIndex","toSvgUrl","svg","Image","BaseImageResource","crossOrigin","crossorigin","autoLoad","load","SVGResource","_load","onError","run","ua","navigator","userAgent","extension","INSTALLED","UtilAttachAlign","margin","_ratio","_margin","_frames","_svg","_nextX","_nextY","UtilSvgAtlasBuilder","path","frames","build","built","_built","force","devicePixelRatio","pow","log","LN2","url","scaling","frames_1","UtilFileAs","UtilAttach","offsetX","clippingWidth","clippingHeight","adjust","positionFirst","positionSecond","clippingSize","UtilClickOutside","getSelection","element","selection","createRange","selectNodeContents","removeAllRanges","addRange","toClipboardData","clipboardData","UtilClipboard","clipboard","writeText","ClipboardEvent","setData","copyUsingWindow","div","textContent","execCommand","copyUsingDiv","span","innerText","attachShadow","copyUsingSpan","UtilExtractor","skipUpdateTransform","RenderTexture","renderTexture","pixels","Uint8Array","readPixels","ignorePremutipliedAlpha","canvasRenderTarget","CanvasRenderTarget","imageData","getImageData","Extract","arrayPostDivide","putImageData","scaledWidth","scaledHeight","scaledImageData","quality","toDataURL","UtilFileDownloader","filename","click","contents","blob","Blob","msSaveBlob","downloadUrl","URL","createObjectURL","UtilExtract","toResolution","toSkipUpdateTransform","toRenderer","toPixels","premultiplied","ignore","toIgnorePremultipliedAlpha","toScale","toCanvas","toBase64","base64","EShapeCapability","as","facade","_input","_as","_facade","UtilFileOpener","getOrCreateInput","onCancel","input_1","stopImmediatePropagation","files","file","fileReader","FileReader","onOpen","onAboart","readAsText","DATA_URL","readAsDataURL","BINARY_STRING","readAsBinaryString","ARRAY_BUTTER","readAsArrayBuffer","UtilHsv","v","UtilName","mapping","_mapping","_layer","_application","last","UtilOverlay","UtilPromise","UtilRgba","_backgroundCache","_backgroundAttribute","_borderCache","_borderAttribute","_onUpdate","UtilTexturePlane","attr","realRadius","realSize","toCornerBr","toCornerTl","toSvg","make","cache","newBackground","maskToTexture","newBorder","UtilTexture","onLoad","_current","_lastUpdate","_updateId","UtilTransition","updateId","lastUpdate","remaining","_names","documentMode","UtilWheelEvent","useCapture","names","name_2","_lineHeight","getLineHeight","_pageHeight","detail","wheelDelta","wheelDeltaY","wheelDeltaX","axis","HORIZONTAL_AXIS","delta","_timestamp","_lowest","shouldAdjust","deltaMode","getPageHeight","defX","defY","_x","_y","_defX","_defY","_limit","_limitComputed","_limitId","_limitParentLength","EShapeLineOfAnyPointsPointImpl","limit","updateLimitComputed","limitId","limitParentLength","calcLimit","parentLenght","EShapeLineOfAnyPointsStrokeImpl","_valuesLength","_fill","_stroke","EShapeLineOfAnyPointsImpl","valuesLength","getLimit","o","pointCountReserved","pointSizeId","pointOffsetId","pointFillId","pointStrokeId","EShapeLineOfAnyUploaded","pointFill","isPointFillChanged","isFillEnabled","isFillChanged","pointStroke","isPointStrokeChanged","isStrokeEnabled","EShapeLineOfCirclesUploaded","updateLineOfAnyColorFill","updateLineOfAnyColorStroke","pointSize","isPointSizeChanged","pointSizeX","pointSizeY","voffsetReserved","vcountReserved","createLineOfCirclesUploaded","other","LINE_OF_CIRCLES","_tester","containsPointAbs","_testerBBox","containsPointAbsBBox","EShapeLineOfCircles","deserializeLineOfCircles","loadShapeLineOfCircles","DAlignHorizontal","DAlignVertical","DAlignWith","EShapeCapabilities","mappings","PRIMITIVE","capability","RECTANGLE_ROUNDED_WORLD_SIZE","RECTANGLE_ROUNDED_WORK_POINT","buildRectangleRoundedIndex","buildRectangleRoundedVertex","dxh","dyh","dxhr","dyhr","dxv","dyv","dxvr","dyvr","x20","y20","x18","y18","x19","y19","x22","y22","x21","y21","buildRectangleRoundedClipping","rxc","ryc","buildRectangleRoundedStep","swtc","ptc0","swrc","prc0","swbc","pbc0","swlc","plc0","plr0","ptb0","buildRectangleRoundedUv","ruvx","ruvy","EShapeLineOfRectangleRoundedsUploaded","isCornerChanged","createLineOfRectangleRoundedsUploaded","RECTANGLE_ROUNDED","EShapeRectangleRounded","containsAbs_","wr","hasLeftSide","hasTopSide","hasBottomSide","hasRightSide","LINE_OF_RECTANGLE_ROUNDEDS","EShapeLineOfRectangleRoundeds","deserializeLineOfRectangleRoundeds","loadShapeLineOfRectangleRoundeds","BORDER_RADIUS","EShapeLineOfRectanglesUploaded","createLineOfRectanglesUploaded","LINE_OF_RECTANGLES","EShapeLineOfRectangles","deserializeLineOfRectangles","loadShapeLineOfRectangles","TRIANGLE_ROUNDED_WORLD_SIZE","TRIANGLE_ROUNDED_WORK_POINT","buildTriangleRoundedIndex","buildTriangleRoundedVertex","sz","sw","rz","dx14","dy14","dx47r","dy47r","dx71","dy71","xb","yb","buildTriangleRoundedClipping","buildTriangleRoundedStep","wsr","pr1","p0","p1","buildTriangleRoundedUv","EShapeLineOfTriangleRoundedsUploaded","isRadiusChanged","createLineOfTriangleRoundedsUploaded","TRIANGLE","EShapeTriangle","ay1","aw","TRIANGLE_ROUNDED","EShapeTriangleRounded","r12","r13","xl","yl","n","ni","nlx","nly","nrx","nry","det","deti","containsCorner_","az","c0","c1","c2","containsCorner","LINE_OF_TRIANGLE_ROUNDEDS","EShapeLineOfTriangleRoundeds","deserializeLineOfTriangleRoundeds","loadShapeLineOfTriangleRoundeds","TRIANGLE_WORLD_SIZE","TRIANGLE_WORK_POINT","buildTriangleClipping","buildTriangleIndex","buildTriangleVertex","buildTriangleStep","buildTriangleUv","EShapeLineOfTrianglesUploaded","updateVertexStepAndUvs","createLineOfTrianglesUploaded","LINE_OF_TRIANGLES","EShapeLineOfTriangles","deserializeLineOfTriangles","loadShapeLineOfTriangles","EShapeNullUploaded","createNullUploaded","NULL","EShapeNull","deserializeNull","loadShapeNull","deserializeRectangle","loadShapeRectangle","EShapeRectangleRoundedUploaded","createRectangleRoundedUploaded","deserializeRectangleRounded","loadShapeRectangleRounded","EShapeTriangleUploaded","updateVertexStepAndUv","createTriangleUploaded","deserializeTriangle","loadShapeTriangle","EShapeTriangleRoundedUploaded","createTriangleRoundedUploaded","deserializeTriangleRounded","loadShapeTriangleRounded","loadShapeAll","DDynamicTextMeasureResultCharacter","clipped","DDynamicTextMeasureResult","newLine","DDynamicTextMeasure","RESULT","pop","DDynamicTextGeometry","vertexBuffer","uvBuffer","indexBuffer","measure","requiredTextSize","requiredVertexSize","requiredIndexSize","vo","_idApproved","DDynamicTextStyle","FONT","_fontFamily","_fontSize","getFontSize","_fontStyle","_fontVariant","fontVariant","_fontWeight","fontWeight","_fontIdId","_fontId","_fontIdApproved","_fillApproved","_onChange","newFontId","EMPTY","_isGeometryDirty","_atlas","update_","_textApproved","_atlasRevisionUpdated","_clippingWidthDelta","DDynamicText","textApproved","fontIdApproved","fillApproved","approve","getDynamicFontAtlases","geometryWidth","geometryHeight","getRevisionUpdate","revisionUpdate","_clippingWidth","newClippingWidth","getClippingWidth","DLinkMenuItemId","DLinkTarget","DImageBaseThemeWrapperSecondary","getSecondaryImageAlignHorizontal","getSecondaryImageAlignVertical","getSecondaryImageAlignWith","getSecondaryImageMarginHorizontal","getSecondaryImageMarginVertial","getSecondaryImageTintColor","getSecondaryImageTintAlpha","getSecondaryImageSource","DImageBaseThemeWrapperTertiary","getTertiaryImageAlignHorizontal","getTertiaryImageAlignVertical","getTertiaryImageAlignWith","getTertiaryImageMarginHorizontal","getTertiaryImageMarginVertial","getTertiaryImageTintColor","getTertiaryImageTintAlpha","getTertiaryImageSource","applyMask","with","getImageAlignWith","getImageAlignVertical","getImageAlignHorizontal","toImageAlign","getImageMarginVertial","getImageMarginHorizontal","toImageMargin","_tint","toImageTint","_bound","_source","_computed","_textAlign","_applyMask","DImagePiece","getImageSource","updateTint","bound","getImageTintColor","getImageTintAlpha","isTintAware","toTintColor","toTintAlpha","newComputed","computeSource","oldComputed","oldImage","Sprite","newImage","computed","DBaseOverflowMaskSimple","drawRect","DTextBase","_textValue","newTextValue","toTextValue","_textValueComputed","computeTextValue","_textColor","_textAlpha","_textStyle","getFontWeight","getFontStyle","getFontVariant","getTextStyleClipping","toTextStyle","getTextAlignVertical","getTextAlignHorizontal","toTextAlign","_textFormatter","getTextFormatter","toTextFormatter","_textDynamic","dynamic","isTextDynamic","toTextDynamic","_isOverflowMaskEnabled","onTextChange","createOrUpdateText","updateTextValue","getTextValue","formatted","createText","updateTextPosition","Text","getTextColor","getTextAlpha","newTextValueComputed","updateTextColor","DImageBase","_onChangeBound","_applyMaskBound","_images","newImages","images","toImageOptions","hasSecondaryImageSource","hasTertiaryImageSource","imageSource","updateTextAndImage","pl","pr","pt","pb","noText","textLeftFirst","textTopFirst","textRightLastMargin","textBottomLastMargin","textLeft","textRight","textTop","textBottom","paddingLeft","paddingRight","paddingTop","paddingBottom","borderLeft","borderRight","borderTop","borderBottom","updateSource","updateBound","imageImage","imageBoundWidth","imageBound","imageBoundHeight","imageMargin","imageMarginHorizontal","imageMarginVertical","PADDING","BORDER","textLeftAdjust","textCenterAdjust","textRightAdjust","textTopAdjust","textMiddleAdjust","textBottomAdjust","setClippingWidthDelta","textWidth","textHeight","paddingCenterAdjust","paddingMiddleAdjust","borderCenterAdjust","borderMiddleAdjust","DImage","DListItem","buttonMode","toValue","hasSelection","onSelect","DMenuItem","getCloseable","DMenuItemText","initOnClick","initOnOver","initShortcuts","_shortcutMargin","getShortcutTextMargin","shortcutTextValue","_shortcutText","shortcutText","updateShortcutText","closeable","DMenuItemCheck","setActive","DLayoutDirection","DMenus","creator","CREATORS","CREATOR_DEFAULT","MENU_CREATOR","creators","creatorDefault","sticky","created","newItemOf","items","DisplayObject","newItem","newItemsOf","_url","_menuOptions","menu","DLink","_menu","getLinkMenuOptions","toMenu","onMenuSelect","newMenu","OPEN_LINK_IN_NEW_WINDOW","COPY_LINK_ADDRESS","NEW_WINDOW","isHidden","inNewWindow","checked","a_1","rel","InteractionEvent","metaKey","button","DMenuItemLinkState","CUSTOM","DMenuItemLink","toUrl","_link","toLinkOptions","DMenuAlign","DMenuItemMenu","initHover","close","DListItemSeparatorReflowable","middle","DListItemSeparator","DMenuItemSeparator","DLayoutSpace","DMenuItemSpace","loadMenuItem","addItemCreator","toSubMenuOptions","setItemCreatorDefault","ESnapperTargetValueType","isVisible","DLayout","themeMargin","getMargin","toMargin","getDirection","toDirection","_cornerAdjust","getCornerAdjust","toCornerAdjust","_multiplicity","row","column","getMultiplicity","toMultiplicity","getReverse","toReverse","multiplicity","clearType","BEFORE","AFTER","baseSize","VERTICAL","marginNext","marginVertical","marginHorizontal","weightTotal","getWeightTotal","cornerAdjustWork","requiredSize","CORNER_ADJUST_WORK","irow","weightTotalInverse","spaceLeft","getSpaceLeft","k","icolumn1","irow1","icolumn0","findRowIndexPrevious","hasClearTypeAfter","icolumn2","findRowIndexNext","hasClearTypeBefore","ncolumn","countColumn","toCornerMaskColumn","icolumn","irow0","findColumnIndexPrevious","irow2","findColumnIndexNext","nrow","countRow","toCornerMaskRow","hasClearType","DLayoutVertical","DMenuItemExpandableBody","DMenuItemExpandableHeader","DMenuItemExpandables","DMenuItemExpandable","header","toHeader","_header","toggle","toBody","_body","newItems","onActivated","onDeactivated","newHeader","newBody","DMenuItemExpandableItemCheck","DMenuItemExpandableItemLink","DMenuItemExpandableItemSeparator","DMenuItemExpandableItemSpace","DMenuItemExpandableItemText","loadMenuItemExpandable","DMenuSidedItemCheck","DMenuSidedItemLink","DMenuSidedItemMenu","DMenuSidedItemSeparator","DMenuSidedItemSpace","DMenuSidedItemText","DMenuSideds","loadMenuSidedItem","DMenuSidedItemExpandables","DMenuSidedItemExpandable","DMenuSidedItemExpandableItemCheck","DMenuSidedItemExpandableItemLink","DMenuItemExpandableItemMenu","DMenuSidedItemExpandableItemMenu","DMenuSidedItemExpandableItemSeparator","DMenuSidedItemExpandableItemSpace","DMenuSidedItemExpandableItemText","loadMenuSidedItemExpandable","loadMenuItemAll","loadAll","createImageSdf","convertToSdf","EShapeGroupFillViewer","EShapeGroupStrokeViewer","EShapeGroupTextAlignViewer","EShapeGroupTextOffsetViewer","EShapeGroupTextOutlineViewer","EShapeGroupTextPaddingViewer","EShapeGroupTextSpacingViewer","EShapeGroupTextViewer","units","EShapeBufferUnitBuilder","unit","EShapeBufferUnit","ntriangles","nindices","nvertices","_vertexCapacity","_vertexCount","_clippingBuffer","_stepBuffer","_colorFillBuffer","_colorStrokeBuffer","isIndicesShort","Uint32Array","_indexCapacity","_indexCount","indexCountRequested","_renderer","_builder","_geometry","EShapeBuffer","clippingBuffer","stepBuffer","colorFillBuffer","colorStrokeBuffer","Buffer","Geometry","addIndex","addAttribute","getGeometry","unitCount","DRAW_MODES","TRIANGLES","unit0","unit1","ioffset0","ioffset1","uniforms","sampler","draw","vindex","iindex","getVertexOffset","getIndexOffset","noMoreThanOne","getVertexCount","getIndexCount","creater","DUMMY_SHAPES","EShapeRendererIteratorDatum","_index","_datum","_data","EShapeRendererIterator","datumIndex","newDatum","EShapeRenderer","SHADER","Shader","_shader","_iterator","_bufferSizeMax","getBufferSizeMax","webGLVersion","uint32ElementIndex","fontAtlases","defaultTexture","textureItem","newTextureItem","updateAtlas","updateAtlases","fontAtlas","updateFontAtlas","updateFontAtlases","buffers","getBuffers","getAntialiasWeight","getAtlas","getFontAtlases","getDefaultTexture","repack","updateBuffers","pixelScale","toPixelScale","translationMatrix","toArray","setBlendMode","correctBlendMode","BLEND_MODES","buffersLength","upload","ib","bufferSize","bufferSizeMax","jb","ibmax","ObjectRenderer","_childrenId","_childrenIdRendered","_fontAtlases","_pixelScale","_pixelScaleId","_work","_buffers","EShapeContainer","childrenId","childrenIdRendered","isChildrenDirty","shapeRenderer","_shapeRenderer","batch","setObjectRenderer","render_","worldID","childLocal","containsBBox","EShapeSearch","toDepth","isParent","shapeParent","findChildById","findChildByType","matcher","findChild","findChildrenByType","findChildren","EShapeDeleter","generateListOfDetachedShapes","COMPARATOR_INDEX","resourceToIndex","EShapeResourceManagerSerialization","EShapeRuntimes","_isEnabled","ESnapperGrid","disable","ESnapperResult","snapped","newDistance","oldDistance","ESnapperModifierAnchor","ESnapperTargetValue","_isVisible","ESnapperTarget","valueA","DCommandFlag","_normals","_lengths","_workScale","_workSnapResultX","_workSnapResultY","_workScaleResult","_workTranslate","_workSnapRectangle","_workSnap","grid","ESnapper","prepare","snap","workTranslate","newDx","newDy","baseRotation","deltaRotation","gridSize","getGridSizeRotation","newRotationDegree","toDegree","newRotationDegreeResidual","toRadian","anchor","normals","lengths","calcNormalizedVector","TOP_CENTER","MIDDLE_LEFT","MIDDLE_RIGHT","BOTTOM_CENTER","normal","mx","setScaleSnappedResult","my","calcScaleSnapped1D","detA","mdx","mdy","pointO","pointX","pointY","calcScaleSnapped2D","calcScaleSnappedX","calcScaleSnappedY","calcScaleSnappedXY","_isStarted","DAnimationEmpty","_shiftX","_shiftY","_onPrerenderBound","onPrerender","_onPostrenderBound","onPostrender","DAnimationFadeIn","_storedTime","removeEventListeners","_storedTarget","addEventListeners","disallowUpdate","allowUpdate","storedTime","unsafe","_storedX","_storedY","_storedAlpha","DApplicationPadding","_root","_overlay","overlay","getBoundingClientRect","bbox","transparent","_pixi","autoStart","DApplicationLayerOptions","updateWidthAndHeight","pixi","isFocusable","isFocusableContainer","DControllerDefaultFocus","_focused","mightBeFocusable","FOCUS_ROOT","includesTarget","includesTargetChildren","findFocusableNext","found","isFocusRoot","findFocusablePrevious","DDialogCloseOn","DCommandClear","UNSTORABLE","CLEAR","DCommandRedo","DCommandUndo","isCommandStorable","command","getFlag","_done","_waiting","_executing","DControllerDefaultCommand","done","waiting","command_1","undo","onSuccess","onFail","redo","isClear","isStorable","isRedoable","isUndoable","DControllerKeyboard","hasOnKeyDown","hasOnKeyUp","DControllers","KEYBOARD","COMMAND","DOCUMENT","getPixiApplicationOptions","stageAny","_isUpdateAllowed","_refitLimit","_reflowLimit","_renderBound","_renderId","rootElement","elementContainer","_elementContainer","isOverlay","thirdChild","insertBefore","oldOnChildrenChange_1","updateVisibility","firstChild","rootElementStyle","getComputedStyle","overflow","viewStyle","hasFocus","onBlurBound","getKeyboardController","getPadding","wheelGlobal","wheelEventUtil","wheelEvent","hitTest","DApplicationLayer","requestAnimationFrame","screen","ilimit","_focus","_dynamicFontAtlases","Application","toRootElement","Renderer","__plugins","accessibility","_base","newLayerBase","_isOverlayEnabled","DApplication","querySelector","toLayerBaseOptions","toLayerOverlayOptions","newLayerOverlay","DBoard","DButtonBase","_isToggle","isToggle","initOnPress","group","setPressed","onToggleStart","onToggleEnd","onActivate","onActivateKeyDown","onActivateKeyUp","DButton","DButtonAmbient","DButtonCheck","DButtonCheckRight","DButtonPrimary","DHtmlElementWhen","DDialog","_focusable","_isOpened","onAnimationEnd","_closeOn","closeOn","CLICK_OUTSIDE","onCloseOn","firstFocusable","pick","onClose","ESC","isCancelKey","DLayoutHorizontal","DDialogCommand","getLayoutX","getLayoutY","getLayoutWidth","getLayoutHeight","onInit","ok","getOk","cancel","getCancel","buttonLayout","_buttonLayout","_buttonCancel","active","_buttonOk","onOk","_promise","_resolve","_reject","DPickerDatetimeMask","DHtmlElement","clipper","clipperCreator","getClipperCreator","_clipper","_clipperCreator","_clipperRect","elementCreator","getElementCreator","_element","_elementCreator","_elementStyle","_elementRect","_isElementShown","_onElementFocusedBound","onElementFocused","_before","_beforeCreator","getBeforeCreator","_beforeStyle","_onBeforeFocusedBound","onBeforeFocused","_after","_afterCreator","getAfterCreator","_afterStyle","_onAfterFocusedBound","onAfterFocused","_select","getSelect","_doSelectBound","doSelect","getWhen","_when","_isStartRequested","ALWAYS","wasStarted","onEndByBlured","isStartable","doStart","updateElement","getClipper","getBefore","getElement","getAfter","elementRect","getElementRect","clipperRect","getClipperRect","setClipperStyle","setElementStyle","setBeforeStyle","setAfterStyle","onElementAttached","scrollTop","scrollLeft","HTMLTextAreaElement","getClippingRect","activeElement","containsPoint","mouse","onElementDetached","getElementContainer","_clipperStyle","worldVisible","DInput","_editingValidationResult","_editingValidator","editing","validator","getEditingValidator","_description","description","_editingFormatter","getEditingFormatter","_editingUnformatter","unformatter","getEditingUnformatter","validate","setInvalid","editingValidationResult","oldValue","DInputNumber","_step","getStep","_min","getMin","toMin","_max","getMax","toMax","updateInputStep","updateInputMin","updateInputMax","valueAsString","initInputStep","initInputMin","initInputMax","DInputReal","DText","DInputLabel","_label","label","space","DInputAndLabel","DInputRealAndLabel","DInputText","DInputTextAndLabel","colorAndAlpha","onColorChange","onAlphaChange","_colorAndAlpha","_onColorChange","_onAlphaChange","DPickerColorAndAlpha","recents","_recents","DPickerColorRecent","recent","DPickerColor","_currentPicker","_newPicker","_recent","_new","setColorNew","setAlphaNew","setColorCurrent","setAlphaCurrent","_pointerPoint","mainWidth","getMainWidth","mainHeight","getMainHeight","mainBaseSprite","_mainBaseSprite","mainSprite","_mainSprite","getMainTexture","_onMainMoveBound","onMainMove","_onMainUpBound","onMainUp","onMainDown","baseSprite","_baseSprite","getBaseMargin","_onBaseMoveBound","onBaseMove","_onBaseUpBound","onBaseUp","onBaseDown","alphaCheckerboardSprite","_alphaCheckerboardSprite","getAlphaCheckerboardTexture","getBaseHeight","alphaSprite","getAlphaTexture","_onAlphaMoveBound","onAlphaMove","_onAlphaUpBound","onAlphaUp","onAlphaDown","mainPointerSprite","_mainPointerSprite","getMainPointerTexture","getMainPointerColor","getMainPointerAlpha","alphaPointerSprite","_alphaPointerSprite","getAlphaPointerTexture","getAlphaPointerColor","getAlphaPointerAlpha","basePointerSprite","_basePointerSprite","getBasePointerTexture","getBasePointerColor","getBasePointerAlpha","_recentColorSprites","recentColorSprites","recentColorCount","getRecentColorCount","recentColorWidth","getRecentColorWidth","recentColorHeight","getRecentColorHeight","recentColorWidthHalf","recentColorHeightHalf","recentColorMargin","getRecentColorMargin","recentColorY","getAlphaHeight","getRecentMargin","recentCheckerboardTexture","getRecentCheckerboardTexture","RECENT_COLORS","getRecents","onRecentChange","onRecentClick","checkerboardSprite","currentTarget","sprite","recentColorAndAlpha","inputMargin","getInputMargin","inputY","inputWidth","inputAndLabelColor","_inputAndLabelColor","getInputLabelWidth","fromCode","inputAndLabelAlpha","_inputAndLabelAlpha","sampleWidth","getSampleWidth","sampleHeight","getSampleHeight","sampleX","sampleY","sampleCurrentCheckerboardSprite","_sampleCurrentCheckerboardSprite","getSampleCheckerboardTexture","sampleCurrentSprite","_sampleCurrentSprite","sampleNewCheckerboardSprite","_sampleNewCheckerboardSprite","sampleNewSprite","_sampleNewSprite","onMainPick","hw","ux","uy","toMainHex","onColorNew","toMainColor","hsv","fromRgb","toRgb","ns","nv","onBasePick","toBaseHex","onColorBase","toBaseColor","onAlphaPick","onAlphaNew","sprites","_selected","DPickerColorGradientPoint","POINT_SORTER","second","_workColor","DPickerColorGradientData","isSelectionChanged","rgb0","hex2rgb","r0","g0","b0","rgb1","r1","g1","rgb","rgb2hex","oldDirection","oldSelected","pointsCopy","pointLike","nPointsPerData","_nPointsPerData","_colors","_lastHitIndex","_parts","uSampler","DPickerColorGradientDataView","setColors","setColorsHex","setColorsWhite","setVertices","setUvs","newIndices","setColorsPoint","isEqual","ap","bp","apj","bpj","DPickerColorGradientRecent","DPickerColorGradient","gradientPointsWidth","getGradientPointsWidth","gradientPointsMargin","getGradientPointsMargin","picker","_picker","onAnchorColorChange","onAnchorAlphaChange","setRectangle","getLastHitIndex","onViewDown","_onAnchorDownBound","onAnchorDown","_onAnchorMoveBound","onAnchorMove","_onAnchorUpBound","onAnchorUp","_anchors","inputLabelWidth","inputDirectionMargin","getGradientDirectionMargin","inputDirectionTexture","getGradientDirectionTexture","inputLeft","inputDirection","change","recentColumn","getGradientRecentColumn","recentWidth","getGradientRecentWidth","recentMargin","getGradientRecentMargin","recentWidthAndMargin","RECENT_COLOR_GRADIENT","getGradientRecents","getGradientRecentCount","getCapacity","onRecentUpdate","lastHitIndex","updateAnchors","onAnchorSelect","recentData","fromObject","addAt","toAnchorPosition","onAnchorDragStart","new","anchorTexture","getGradientAnchorTexture","anchorOutlinedTexture","getGradientAnchorOutlinedTexture","anchors","anchorSize","newAnchor","oldAnchor","isDeleteKey","DDialogColorGradient","DButtonColorGradient","_dialogOptions","dialog","getViewBaseTexture","_dialog","DIALOG","DDialogColor","DButtonColor","updateTextForcibly","dialogNew","dialogCurrent","toImageTintOptions","dialogOptions","DButtonDanger","DPickerDatetimeButtonBack","DPickerDatetimeButtonDate","DPickerDatetimeButtonNext","DPickerDatetimeLabel","DPickerDatetimeLabelDate","DPickerDatetimeSpace","DInputInteger","DListSelectionMode","_date","_inclusive","inclusive","DPickerTimeBound","DPickerTimeBoundHours","lower","lowerDate","constant","DATE","hour","lowerDateHours","SECONDS","MINUTES","minute","upper","upperDate","upperDateHours","DPickerTimeBoundMinutes","HOURS","lowerDateMinutes","upperDateMinutes","DPickerTimeBoundSeconds","newConstant","hours","minutes","seconds","DPickerTimeBounds","test","getTime","setSeconds","setMinutes","setHours","setDate","am","bm","ad","bd","ah","bh","compare","toBoundOptions","onNewChanged","DPickerTime","_dateCurrent","dateCurrentTime","_dateNew","_dateBounds","getLowerBound","isLowerBoundInclusive","getUpperBound","isUpperBoundInclusive","toBoundsOptions","newChildren","dateCurrent","dateNew","_inputHours","_inputMinutes","_inputSeconds","currentTime","onReset","dateBounds","inputHours","inputMinutes","inputSeconds","newInputHours","newInputMinutes","newInputSeconds","newTimeLayout","newTimeLayoutChildren","getTimeLayoutWidth","getTimeLayoutHeight","newMinuteSeparator","newSecondSeparator","getMinuteSeparator","getSecondSeparator","inputOptions","getHoursOptions","adjustInputOptions","onHoursChanged","getMinutesOptions","onMinutesChanged","getSecondsOptions","onSecondsChanged","DPickerDatetime","_datePage","_dateButtons","newDateButtons","_dateDecorator","decorator","getDateDecorator","newLabel","newBackButton","newNextButton","newDateLabels","datePage","onPageChanged","setFullYear","buttons","spaceCount","getDay","getDayStart","dateDecorator","dateCount","dateNewDate","setDisabled","labelText","labelTextAlign","getLabelFormatter","toLabelOptions","buttonOptions","back","getBackButtonOptions","getNextButtonOptions","dateLabels","getDayLabels","dayStart","newDateLabel","newSpace","newDateButton","onDateButtonClicked","setMonth","DPickerDate","DDialogDate","page","DDialogDates","DButtonDate","DDialogDatetime","DDialogDatetimes","DPickerDates","DPickerTimes","DPickerDatetimes","hms","DButtonDatetime","_datetimeMask","toMask","DButtonFileAs","DButtonFile","_opener","onOpening","_buttons","_active","_stateOn","_stateOff","_onActiveBound","onActive","DButtonGroup","DButtonLink","link","DButtonRadio","DButtonRadioRight","commandController","getCommandController","DButtonSecondary","DChartAxisPosition","DChartAxisTickPosition","content","_content","_mode","SINGLE","DListSelection","getChildIndex","MULTIPLE","targetIndex","DContent","DScrollBar","_start","_end","thumb","_thumb","createThumb","onRegionChange","DScrollBarThumb","onDragMove","getMinimumSize","DScrollBarThumbReflowableHorizontal","DScrollBarThumbHorizontal","DScrollBarHorizontal","getLocalPosition","newStart","thumbMinimumSize","barStart","barSize","DScrollBarThumbReflowableVertical","DScrollBarThumbVertocal","DScrollBarVertical","DPane","toContent","initScrollBar","initDrag","dragMode","position_1","toContentX","toContentY","verticalBar","_verticalBar","bar","toBarOptionsVertical","onRegionMoveY","horizontalBar","_horizontalBar","toBarOptionsHorizontal","onRegionMoveX","onContentChanged","updateScrollBar","newContent","getWheelContentX","getWheelContentY","getWheelSpeed","updateScrollBarRegions","updateScrollBarVisibilities","updateScrollBarPositions","verticalBarWidth","verticalBarOffsetStart","getScrollBarOffsetVerticalStart","verticalBarOffsetEnd","getScrollBarOffsetVerticalEnd","horizontalBarHeight","horizontalBarOffsetStart","getScrollBarOffsetHorizontalStart","horizontalBarOffsetEnd","getScrollBarOffsetHorizontalEnd","setRegion","isChangedHorizontal","updateScrollBarVisibility","isChangedVertical","isRegionVisible","WORK_ON_FOCUSED","contentX","contentY","contentWidth","contentHeight","DList","_selection","newSelection","findItem","updateChildPosition","updateChildVisibility","scrollLimit","itemY","DDialogSelectList","DDialogSelectListItem","search","_search","_idCompleted","_result","DDialogSelectSearh","searchResult","DNote","toNoteOptions","DDialogSelect","_itemTextFormatter","getItemTextFormatter","toItemTextFormatter","_list","noteNoItems","note","noItems","getNoteNoItemsText","toNoteNoItemsOptions","_noteNoItems","noteSearching","getNoteSearchingText","toNoteSearchingOptions","_noteSearching","controller","toSearch","results","onSearched","transition","isDone","getResult","itemTextFormatter","childrenLength","searchResultsLength","minLength","removeChildAt","newChild","addChildAt","defaultGetter","defaultSetter","DButtonSelect","toOptions","getter","setter","dialogFormatter","DDialogTime","DDialogTimes","DButtonTime","DCanvas","DChartCoordinateDirection","EShapePointsStyles","_coordinateIndex","toPosition","_tick","toTickContainer","_bar","toBar","DChartAxisBaseOptionParser","getPosition","getStyle","toBarStroke","tick","getTickEnable","major","toTickMajor","minor","toMinorTick","getMajorTickPosition","optionsStyle","getMajorTickStyle","optionsStroke","toTickMajorStroke","getMajorTickCount","getMajorTickSize","toTickPosition","toMajorTickText","toMajorTickFormatter","gridline","toTickMajorGridline","getMajorTickGridlineStyle","getMajorTickGridlineEnable","toTickMajorGridlineStroke","tickPosition","OUTSIDE","getMinorTickPosition","getMinorTickStyle","getMinorTickCount","getMinorTickSize","toTickMinorStroke","toStroke","getStrokeEnable","getStrokeColor","getStrokeAlpha","getStrokeWidth","getStrokeAlign","getStrokeSide","optionsA","optionsB","getMajorTickStrokeEnable","getMajorTickStrokeColor","getMajorTickStrokeAlpha","getMajorTickStrokeWidth","getMajorTickStrokeAlign","getMajorTickStrokeSide","getMajorTickGridlineStrokeEnable","getMajorTickGridlineStrokeColor","getMajorTickGridlineStrokeAlpha","getMajorTickGridlineStrokeWidth","getMajorTickGridlineStrokeAlign","getMajorTickGridlineStrokeSide","getMinorTickStrokeEnable","getMinorTickStrokeColor","getMinorTickStrokeAlpha","getMinorTickStrokeWidth","getMinorTickStrokeAlign","getMinorTickStrokeSide","getMajorTickTextFormat","toMajorTickTextColor","toMajorTickTextAlign","toMajorTickTextOffset","toMajorTickTextOutline","toMajorTickTextSpacing","toTickMajorTextDirection","toMajorTickTextPadding","getMajorTickTextAlignHorizontal","getMajorTickTextAlignVertical","getMajorTickTextPaddingHorizontal","getMajorTickTextPaddingVertical","getMajorTickTextDirection","getMajorTickTextColor","toLabelColor","toLabelAlign","toLabelOffset","toLabelOutline","toLabelSpacing","toLabelDirection","toLabelPadding","getLabelAlignHorizontal","getLabelAlignVertical","getLabelPaddingHorizontal","getLabelPaddingVertical","getLabelDirection","getLabelColor","parser","coordinateIndex","_majorTicks","Float64Array","_minorTicks","DChartAxisBase","barShape","plotArea","plotAreaWidth","plotAreaHeight","domainMin","domainMax","majorShapes","minorShapes","gridlineShapes","shapePositionY","majorCount","majorFormatter","minorCountPerMajor","minorCount","majorTicks","minorTicks","ticks","majorShape","imajorTick","majorTickPosition","majotTickPositionX","majorTickStep","gridlineShape","minorShape","iminorTick","minorTickPosition","minorTickProjectedPosition","shapePositionX","majotTickPositionY","getBoundsInContainer","domainFrom","unmap","domainTo","updateTicksX","updateTicksY","_container","tickShapeContainer","barPosition","attach","tickMajor","gridlinePosition","gridlineCount","gridlineStyle","tickMajorShapes","tickMajorCount","tickMajorSize","tickMajorPosition","tickMajorStyle","tickMajorShape","tickMinor","tickMinorShapes","tickMinorCount","tickMinorSize","tickMinorPosition","tickMinorStyle","tickMinorShape","tickMajorGridlineShapes","updateBar","updateTicks","_plotArea","DChartAxisContainerImpl","axes","DChartAxisX","DChartAxisXDatetime","DChartAxisY","DCHART_COLOR_SET_1","DCHART_COLOR_SET_2","DChartColorSet2","DChartSelectionPoint","DChartCoordinateContainerSubImpl","coordinateOrIndex","removed","unbind","mark","X","cxs","cys","DChartCoordinateContainerImpl","rangeFrom","rangeTo","DChartCoordinateLinearTick","power","LN10","toStepScale","majorPosition","rangeMin","rangeMax","iresult","minorPosition","majorResult","minorResult","majorStep","calcStepMajor","map","imajorResult","iminorResult","idomainStart","idomainEnd","minorStep","calcStepMinor","imajor","iminor","majorProjectedPosition","minorProjectedPosition","_translate","_itranslate","_iscale","DChartCoordinateTransformImpl","isZero","ratioi","newTranslate","oldTranslate","stride","itranslate","iscale","DChartCoordinateTransformMarkImpl","DChartRegionImpl","_mark","DChartCoordinateLinear","doFit","doFit_","toFitDomain","toFitRange","series","getDomain","getRange","pixelFrom","pixelTo","region","regionFrom","regionTo","regionSize","newTranslation","DChartCoordinateLogTick","domainFromMapped","domainToMapped","domainMinMapped","domainMaxMapped","majorStepMapped","idomainStartMapped","idomainEndMapped","minorStepMapped","majorPositionMapped","minorPositionMapped","DChartCoordinateLog","regionFromMapped","regionSizeMapped","DChartLegendItem","DChartLegend","DChartOverview","DChartPlotAreaContainer","_lastBoundsID","getBounds","isFirst","getBoundsInternal","DChartSeriesHitResult","DChartSeriesFillComputedImpl","DChartSeriesScalars","outer","inner","DChartSeriesPaddingComputedImpl","DChartSeriesPointComputedImpl","DChartSeriesStrokeComputedImpl","_domain","_range","DChartSeriesFillImpl","DChartSeriesStrokeImpl","DChartSeriesPointImpl","DChartSeriesPaddingImpl","listLength","DChartSeriesContainerImpl","domain","tmp1","tmp2","WORK_CALCHITPOINT","closest","calcHitPoint","chart","_chart","_blendStartTime","_blendDuration","_blendTimeout","_onBlendBound","onBlend","DChartPlotArea","_isViewDirty","_isBoundsInContainerDirty","_coordinate","_series","_axis","_boundsInContainer","blendTimeout","DChartRegionImplObservable","newFrom","newTo","_coordinateIndexX","_coordinateIndexY","_coordinateIdUpdatedX","_coordinateIdUpdatedY","_coordinateTransformIdUpdatedX","_coordinateTransformIdUpdatedY","DChartSeriesBaseCoordinateContainer","coordinateX","coordinateY","coordinateIdX","coordinateIdY","isCoordinateXChanged","isCoordinateYChanged","coordinateTransformIdX","coordinateTransformIdY","isCoordinateTransformXChanged","isCoordinateTransformYChanged","_regionPointId","DChartSeriesBase","updateRegion","_line","_pointId","_pointIdUpdated","DChartSeriesLineOfAny","line","newLineOfAny","initLine","sizeDefault","getSizeDefault","offsetDefault","getOffsetDefault","newOffset","isCoordinateChanged","isCoordinateTransformChanged","isTransformDirty","updateLine","xcoordinate","ycoordinate","ivalues","mapAll","adjustLineRegion","WORK_REGION","applyLine","calcRegion","xraw","yraw","WORK","calcHitPointTestRange","calcHitPointHitTester","_barCount","_barIndex","_xcoordinateId","_xcoordinateTransformId","DChartSeriesBar","newPadding","barIndex","barCount","xcoordinateId","xcoordinateTransformId","updateBarCountAndIndex","totalBandWidth","totalBarWidth","barWidth","barX","sizes","sizesLength","offsets","offsetsLength","isize","DChartSeriesLineOfCircles","DChartSeriesLineOfRectangleRoundeds","DChartSeriesLineOfRectangles","_sizeId","DChartSeriesLineOfTriangles","DChartSeriesLineOfTriangleRoundeds","_centerX","_centerY","DChartSeriesLine","isPointsDirty","segmentsLength","isegments","segment","_idUpdated","_a","_b","_x0","_y0","DChartSeriesExpressionParametersImpl","_plotAreaSizeXUpdated","_plotAreaSizeYUpdated","_parameters","DChartSeriesLinear","parameters","isParametersChanged","isPlotAreaSizeChagned","toClean","plotAreaSizeX","plotAreaSizeY","aabs","babs","xfrom0","xto0","xfrom1","xto1","yfrom0","yto0","yfrom1","yto1","_shape","setStyle","DChartSelectionShapeBase","mappedPosition","seriesShape","getTheme","DChartSelectionGridlineX","mappedX","DChartSelectionGridlineY","mappedY","DChartSelectionGridlineContainerImpl","unset","DChartSelectionMarker","_gridline","_marker","marker","_coordinateX","_coordinateY","CLOSER","DChartSelectionSubImpl","PREVIOUS","NEXT","oldSeries","newSelected","_hovered","newHovered","_onClickBound","DChartSelectionSimple","toSubOptions","gridlineX","gridlineY","WORK_SELECT","DChart","_destroyed","DCommandCreate","DCommandDelete","getDocumentController","delete","DCommandSaveAs","saveAs","DCommandSave","DDiagramCanvasTileMappingPointImpl","lon","lat","mappingOrEnable","lon0","lat0","lon1","lat1","_cb","DDiagramCanvasTileMappingImpl","_factory","factory","onMappingChange","DDiagramCanvasTile","pyramid","_pyramid","DDiagramLayer","DDiagramLayerContainer","activate","activateNext","_tile","tile","DDiagramCanvasBase","layers","DDiagramCanvasEditorBackground","baseColor","toBackgroundColorBase","snapperGraphics","_snapperGraphics","snapper","_snapper","DDiagramCanvasEditor","backgroundBase","getBackgroundBase","version","defaultTagMapper","tagMapper","mapper","interactives","actionables","ids","_workLocal","_workGlobal","_lastOverShape","DDiagramCanvas","initializeShapes","updateShapes","initializeFocus","mappedValueId","shapeId","this_1","lastOverShape","onPointerMove","previousRuntime","onPointerOut","lastOverParent","parentRuntime","onPointerOver","DDiagrams","pflayers","pfresources","pfitems","shapePromises","deserializeAll","pfitem","canvasContainer","canvasBackground","canvasContainerBackground","_serialized","_tileFactory","DDiagramBase","oldSerialized","onUnset","onSet","newCanvas","newLayer","initialize","applyBackground","_controller","_isChanged","DDiagramEditor","toCanvasOptions","newId","reason","isNew","diagram","_diagram","_updateBound","DDiagramShape","actionable","runtimeEffect","DDiagramTag","tagValue","onShapeMove","onShapeUp","onShapeClick","DDiagram","formatterMap","initialMap","actionMap","runtimeConstructor","tagFormat","tagInitial","toRuntime","onShapeDown","onShapeDblClick","DDialogConfirmMessage","DDialogConfirm","message","toMessage","_message","newMessage","toMessageOptions","toMessageOptionsMerged","getMessage","DDialogConfirmDelete","DDialogConfirmDiscard","DDialogInputText","_inputAndLabel","enter","getLabelWidth","getLabel","DDialogMessage","DDialogProcessingMessage","_isDone","_interval","getInterval","DDialogProcessing","timeoutId","_timeoutId","setStates","onDone","delay","onResolved","onRejected","DDialogSaveAs","getName","owner","_owner","_closeables","DMenuContext","closeables","imin","DMenu","_fit","_sticky","_sub","onPrerenderBound","picked","getOffsetX","getOffsetY","isArrowUpKey","isArrowDownKey","setMenuCreator","DMenuSidedSelectionMode","DDropdownBase","toMenuOptions","DDropdown","DExpandableHeader","DExpandable","DInputIntegerAndLabel","tileSize","_tileSize","DMapCoordinateEPSG3857","lonlat","meters","C","CIRCUMFERENCE_HALF","tan","atan","exp","tz","R","Z","metersToTile","lonLatToMeters","metersToPixels","metersToLonLat","pixelsToMeters","toResolutionMeter","DMapCoordinates","_default","_sprite","DMapTile","onLoaded","_onLoaded","_isOnLoadedCalled","_isOnLoadedAllowed","_onLoadedBound","_tz","_lon0","_lat0","_lon1","_lat1","_tiles","_renderTileBound","renderTile","_txmin","_txmax","_tymin","_tymax","_deleteTileBound","tileCode","tiles","deleteTile","_destroyTileBound","destroyTile","_updateLoadingStateForEach","loaded","_isLoaded","_tileCount","toTileCount","_tileScaleRelative","_tileScale","getTileSize","DMapTilePlane","oldLon0","oldLat0","oldLon1","oldLat1","lonLatToTile","tx1","ty1","tileCount","txmin","txmax","tymin","tymax","dtxmin","dtxmax","dtymin","dtymax","isTxMinChanged","isTxMaxChanged","isTyMinChanged","isTyMaxChanged","ctx","cty","ltx","lty","lt","toOffset","loadTile","it","txa","loadTilesY","txb","tya","loadTilesX","tyb","toTileCode","toTilePosition","newTile","tileScaleRelative","tileToPixels","updateLoadingState","tileScale","mappingLonLat","_mappingInternal","toMapping","_z","_minZ","plane","_maxZ","_planes","_fitBound","_fitBoundTimeout","_fitThrottle","throttle","fitThrottledBound","_fitThrottledBound","fitThrottled","DMapTilePyramidImpl","WORK_LONLAT","lonLatToPixels","oldMapping","newMapping","planes","planeTz","toZ","toTileZ","newPlane","pixelsToLonLat","destroyPlanesBefore","destroyPlanesAfter","DMapTileUrlBuilderOsmfj","DMapTilePyramids","MIN","MAX","THROTTLE","DEFAULT","toPlaneOptions","DMenuBarItem","DMenuBarBlocker","DMenuBar","onItemStateChangeBound","onItemStateChange","itemOrItemOptions","_blocker","blocker","DMenuSidedContent","DTableColumnType","defaultFilter","_item","_filter","filter","getFilterDefault","DMenuSidedSelection","set_","hasMenu","oldItem","DMenuSided","DPaginationDotsButton","DPaginationDynamicButtons","_dotsBtnLeft","dotsLeft","_dotsBtnRight","dotsRight","btnsCount","pageButtons","btn","clickedBtn","DPaginationNavigationButton","DPagination","DEFAULT_SELECTED","_total","_buttonOptions","initButtons","getButtonWidth","listenButtonClicked","_numberPageButtonVisible","toNumberVisible","isInteger","_lastPageBtn","_previousBtn","pagination_navigation_button_previous","_nextBtn","pagination_navigation_button_next","_goFirstBtn","pagination_navigation_button_go_first","_goLastBtn","pagination_navigation_button_go_last","_dynamicPageBtns","_firstPageBtn","onClickPageButton","startDynamic","endDynamic","numberButtonsInLeft","numberButtonsInRight","updateStaticButtons","numberButtonsFirstToCenter","numberButtonsCenterToEnd","isLast","numberNavigationBtn","widthOfNavigationBtns","widthOfPageBtns","numberVisible","btnIndex","DSelectMultiple","_onSelectedBound","oldValues","updateMenuItems","onSelected","_onClosedBound","onClosed","isSameValues","addedValue","removedValue","childValue","DSelect","findMenuItem","_offsetX","_offsetY","onTextureUpdate","DShadowImpl","NineSlicePlane","DSliderLabel","DSliderThumb","DSliderValue","_rounder","toRounder","rounder","getPrecision","DSlider","_ratioValue","_track","newTrack","_trackSelected","newTrackSelected","newThumb","newLabelMin","newLabelMax","onTrackDown","onTrackSelectedDown","_onTrackUpBound","onTrackUpBound","_onTrackSelectedUpBound","onTrackSelectedUpBound","onThumbDown","_onThumbMoveBound","onThumbMove","_onThumbUpBound","onThumbUp","onValuesChanged","toValueOptions","toLabelMinOptions","toLabelMaxOptions","onPick","newMin","newMax","DSliderTrack","DSliderTrackHorizontal","DSliderHorizontal","track","getValueMargin","moveThumbPosition","updateValue","DSliderTrackVertical","DSliderVertical","trackSelected","DTableBodyCells","columnIndex","columnData","setReadOnly","toReadOnly","toRenderable","DTableBodyCellSelectDialog","_rowIndex","_columnIndex","_columnData","_isSyncEnabled","toSync","selecting","onCellChange","_row","rowIndex","sync","isSyncEnabled","supplimental","setRenderable","DTableBodyCellActionDialog","DTableBodyCellActionMenu","DTableBodyCellSelectPromise","promise","DTableBodyCellActionPromise","DTableBodyCellText","DTableBodyCellButton","DTableDataSelectionType","DTableBodyCellCheck","tableBodyRow","tableBody","isChanged_1","getter_1","setter_1","each","CHECK_SINGLE","onChangeSingle","DTableBodyCellColor","newValueCloned","oldValueCloned","hasColor","hasAlpha","DTableBodyCellDate","textValueComputed","DTableBodyCellDatetime","DTableBodyCellIndex","DTableBodyCellInputInteger","DTableBodyCellInputReal","DTableBodyCellInputText","DTableBodyCellInputTreeInput","DTableBodyCellInputTreeMarker","DTableCellState","EVEN","START","END","FROZEN","FROZEN_END","SORTED_ASCENDING","SORTED_DESCENDING","HAS_CHILDREN","OPENED","onMarkerActive","DTableBodyCellInputTree","isOpened","level","getLevelPadding","DTableBodyCellLink","DTableBodyCellSelectMenu","DTableBodyCellSelectMultiple","_adjuster","DBasePaddingAdjustable","DTableBodyCellTree","adjuster","DTableBodyCellTime","DTableRowState","DTableRow","even","frozen","_frozen","columns","_columns","toIndexEnd","cell","newCell","cellState","toCellState","resetFrozenCellPosition","cells","getContentPositionX","cellIndex","shiftX","isBodyCell","DTableBodyRow","_onCellChangeBound","cellOptions","toCellOptions","newCellEditable","newCellUnediable","TREE","INDEX","INTEGER","REAL","CHECK","BUTTON","LINK","SELECT","newCellSelect","newCellAction","DATETIME","TIME","multiple","cellsLength","columnsLength","_isApplied","_sorterId","_filtered","DTableDataFilterImpl","indicesSorted","filtered","sorter","rows","indexSorted","newFiltered","sortedIndex","indicesFiltered","DTableDataListMapped","unmappedIndex","iteratee","supplimentals","DTableDataOrder","COMPARATOR","toType","Set","DTableDataSelectionImpl","has","oldSize","result_2","lastRowIndex","includeFrom","includeTo","rowIndices","shifted","DTreeAddedItemPosition","_comparator","_sorted","DTableDataSorterImpl","comparator","toComparator","newSorted","_mapped","_rows","toRows","_sorter","DTableDataList","lock","unlock","newRows","rowsLength","newRowsLength","DTableBody","_onRowChangeBound","rowOptions","selectionType","getRowHeight","toRowOptions","_rowOptions","_rowHeight","_rowIndexMappedStart","_rowIndexMappedEnd","_updateRowsCount","_isUpdateRowsCalled","_isUpdateRowsCalledForcibly","_workRows","callIfNeeded","rowHeight","dataMappedSize","mapped","oldRowIndexMappedStart","oldRowIndexMappedEnd","oldRowCount","newContentHeight","newContentY","newRowIndexMappedLowerBound","newRowIndexMappedUpperBound","newRowIndexMappedStart","newRowIndexMappedEnd","newRowCount","oldRowIndexMapped","newRow","rowIndexMappedStartDelta","rowIndexMappedStartDeltaAbs","resetRow","isEven","updateFrozenCellPosition","shiftY","WORK_ON_CLICK","rowIndexMapped","isSingle","isNotSingle","isEmpty","clearAndAdd","rowIndexSorted","lastRowIndexSorted","indexFiltered","DTableCategoryCell","DTableCategory","DTableDataFilterTree","isFiltered","hasFiltered","addAllToFiltered","newFilteredSub","DTableDataSorterTree","_isRowsDirty","_supplimentals","_flags","WeakMap","DTableDataTree","_nodes","updateRows","flags","irows","updateRows_","ilevel","hasChildren","toSupplimental","_column","sorting","DTableHeaderCell","table","_onSorterChangeBound","onSorterChange","DESCENDING","isApplied","onSorterChangeBound","DTableHeader","_table","defaultGetterEmpty","defaultSetterEmpty","defaultEditingUnformatter","toColumnDataChecker","key_3","toColumnEditingEnable","toColumnEditing","editable","rowA","rowB","valueB","toColumnSorting","sortable","toColumnMenu","toColumnDialog","defaultSelectingGetter","defaultSelectingSetter","toColumnSelecting","toColumnRenderable","toColumn","toColumnAlign","toColumnPath","key_1","toPathGetter","default","toColumnGetter","key_2","toPathSetter","toColumnSetter","category","DTable","toColumns","toFrozen","categories","newCategories","_categories","headerOffset","bodyOffset","setWidth","toContentWidth","onRowClicked","tcolumn","ccolumn","isSameCategory","toCategoryLabel","toCategoryColumns","getCategoryCount","toCategoryOptions","columnWidthTotal","columnWidth","hasHeader","toHeaderOptions","toBodyOptions","DTreeItemState","EXPANDED","COLLAPSED","SELECTED","DTreeItemTextAndImage","DTreeItemToggleIcon","toText","isExpanded","expanded","toImage","toRawData","rawData","DTreeItem","_isParent","_isExpanded","_rawData","_icon","_textAndImage","toTreeItemTextAndImage","onToggle","updateStates","getPaddingByLevel","toPaddingLeft","toYCoordinate","updateActiveState","DTreeSelection","itemIndex","_i","DTree","_itemOptions","_itemOptionsShowable","_itemIndexMappedStart","_itemIndexMappedEnd","_itemY","itemTheme","_itemHeight","updateData","removeChildren","itemIndexMappedStart","itemIndexMappedEnd","itemOptionsShown","itemOptions","treeItem","getRawData","expandAll","reload","_removeItem","sibling","_addItemOptions","positon","inOrder","items_1","parentItemOptions","itemImage","isItemExisted","showable","lastSelection","selectionY","lastSelectionY","maxY_1","minY_1","every","wcardinal","ui"],"mappings":"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"}